背景与问题：
我正在将一个原生微信小程序项目迁移到 uni-app 框架。后端继续使用腾讯云开发（TCB）。我发现了一个核心的兼容性问题：
原生小程序通过 wx.cloud.callFunction 调用云函数时，用户身份 OPENID 会被自动注入到云函数的 wxContext 中。
uni-app 使用 TCB 的 JS SDK (this.$tcb.callFunction) 调用云函数时，wxContext 不会被自动注入。因此，必须在前端手动获取 openid，并将其作为参数显式传递给云函数。
核心目标：
请修改我提供的所有前端 .vue 文件和后端云函数 index.js 文件，解决上述兼容性问题，确保在 uni-app 环境下，所有云函数调用都能正确、安全地识别用户身份。
修改原则与具体指令：
一、 后端云函数修改指南 (所有 functions/*/index.js)
统一 openid 获取逻辑：
在每个云函数的 main 入口，必须修改获取 openid 的代码。
新的逻辑必须同时兼容两种调用方式：优先从 wxContext 获取（兼容原生调用），如果获取不到，则必须从 event 参数中获取。
标准实现代码如下，请应用到所有云函数：
code
JavaScript
const wxContext = cloud.getWXContext();
// [关键修改] 兼容 uni-app 的 openid 传递方式
const openid = wxContext.OPENID || event.openid;

if (!openid) {
  return {
    success: false,
    message: '无法获取用户 openid，请重新登录',
    code: 'NO_OPENID'
  };
}
数据库操作：
确保所有后续的数据库查询、更新、删除操作，都使用这个新获取的、可靠的 openid 变量。例如，db.collection('users').where({ _openid: openid })。
排除 login 云函数：
login 云函数是用来获取 openid 的，它自身不需要这个修改。请检查并跳过 login 云函数。
二、 前端 Vue 组件修改指南 (所有 .vue 文件)
统一云函数调用方式：
定位项目中所有使用 this.$tcb.callFunction 的地方。
在每一次调用的 data 对象中，都必须添加 openid 字段。
获取 openid 的来源：
openid 应从全局状态管理（如 getApp().globalData.openid、Vuex store）或本地缓存中获取。假设它已经通过 login 云函数获取并存储在 getApp().globalData.openid 中。
标准实现代码如下，请将所有调用都修改为类似格式：
修改前可能的样子：
code
JavaScript
this.$tcb.callFunction({
    name: 'someFunction',
    data: {
        param1: 'value1'
    }
})
修改后必须的样子：
code
JavaScript
const openid = getApp().globalData.openid;
if (!openid) {
    uni.showToast({ title: '用户未登录', icon: 'none' });
    return;
}

this.$tcb.callFunction({
    name: 'someFunction',
    data: {
        // [关键修改] 新增 openid 字段
        openid: openid,
        // 保留原有参数
        param1: 'value1'
    }
})