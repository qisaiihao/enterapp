(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-fans-fans"],{"139b":function(t,e,a){a("795c"),a("64aa"),a("5c47"),a("a1c1"),a("c223"),a("f7a5");var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(t).padStart(e,"0")},o=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",a=t instanceof Date?t:new Date(t);if(Number.isNaN(a.getTime()))return"";var o={yyyy:String(a.getFullYear()),MM:n(a.getMonth()+1),dd:n(a.getDate()),HH:n(a.getHours()),mm:n(a.getMinutes()),ss:n(a.getSeconds())};return e.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(t){return o[t]}))};t.exports={formatTimeAgo:function(t){var e=new Date,a=new Date(t),n=e.getTime()-a.getTime(),o=Math.floor(n/1e3),i=Math.floor(o/60),r=Math.floor(i/60),s=Math.floor(r/24);if(s>=7){var l=a.getFullYear(),c=("0"+(a.getMonth()+1)).slice(-2),u=("0"+a.getDate()).slice(-2);return"".concat(l,"-").concat(c,"-").concat(u)}return s>=1?"".concat(s,"天前"):r>=1?"".concat(r,"小时前"):i>=1?"".concat(i,"分钟前"):"刚刚"},formatRelativeTime:function(t){var e=Date.now(),a=t instanceof Date?t.getTime():new Date(t).getTime();if(Number.isNaN(a))return"";var n=e-a,i=Math.floor(Math.abs(n)/1e3),r=n>=0?"前":"后";if(i<60)return"刚刚";var s=Math.floor(i/60);if(s<60)return"".concat(s,"分钟").concat(r);var l=Math.floor(s/60);if(l<24)return"".concat(l,"小时").concat(r);var c=Math.floor(l/24);return c<7?"".concat(c,"天").concat(r):o(a,"yyyy-MM-dd")},formatDate:o}},"3b7d":function(t,e,a){"use strict";a.r(e);var n=a("832c"),o=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=o.a},"3dbb":function(t,e,a){"use strict";a.r(e);var n=a("4249"),o=a("3b7d");for(var i in o)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return o[t]}))}(i);a("ea19");var r=a("828b"),s=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,"c0822888",null,!1,n["a"],void 0);e["default"]=s.exports},4249:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[t.isLoading&&0===t.fans.length?a("v-uni-view",{staticClass:"loading"},[a("v-uni-text",[t._v("加载中...")])],1):t.fans.length>0?[a("v-uni-view",{staticClass:"list"},t._l(t.fans,(function(e,n){return a("v-uni-view",{key:n,staticClass:"fan-item"},[a("v-uni-view",{staticClass:"user-info",attrs:{"data-openid":e._openid},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openUserProfile.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"avatar",attrs:{src:e.avatarUrl||t.defaultAvatar,mode:"aspectFill","data-index":n},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.onAvatarError.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"info-text"},[a("v-uni-text",{staticClass:"name"},[t._v(t._s(e.nickName||"微信用户"))]),a("v-uni-text",{staticClass:"bio"},[t._v(t._s(e.bio||"这个人很懒，什么都没留下~"))]),e.followedAtText?a("v-uni-text",{staticClass:"follow-time"},[t._v("关注于 "+t._s(e.followedAtText))]):t._e(),e.isMutual?a("v-uni-view",{staticClass:"mutual-label"},[t._v("互相关注")]):t._e()],1)],1),a("v-uni-button",{staticClass:"follow-btn",attrs:{size:"mini","data-openid":e._openid,"data-index":n,loading:t.pendingOpenid===e._openid,disabled:t.pendingOpenid===e._openid},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.onToggleFollow.apply(void 0,arguments)}}},[t._v(t._s(e.isMutual?"取消关注":"关注"))])],1)})),1)]:a("v-uni-view",{staticClass:"empty"},[a("v-uni-text",[t._v("还没有粉丝，快去多发点内容吧~")])],1),t.fans.length>0?a("v-uni-view",{staticClass:"footer-hint"},[t.isLoading?a("v-uni-view",{staticClass:"loading-more"},[t._v("加载中...")]):t.hasMore?t._e():a("v-uni-view",{staticClass:"loading-more"},[t._v("已经到底啦")])],1):t._e()],2)},o=[]},"57e2e":function(t,e,a){var n=a("803d");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=a("967d").default;o("02144746",n,!0,{sourceMap:!1,shadowMode:!1})},"73e1":function(t,e,a){"use strict";var n=a("29d8");t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(n)},"795c":function(t,e,a){"use strict";var n=a("8bdb"),o=a("db04").start,i=a("73e1");n({target:"String",proto:!0,forced:i},{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},"803d":function(t,e,a){var n=a("c86c");e=n(!1),e.push([t.i,".container[data-v-c0822888]{padding:%?32?%;background-color:#f7f8fa;min-height:100vh}.list[data-v-c0822888]{display:flex;flex-direction:column;gap:%?24?%}.fan-item[data-v-c0822888]{display:flex;align-items:center;justify-content:space-between;background-color:#fff;border-radius:%?16?%;padding:%?24?% %?28?%;box-shadow:0 %?6?% %?18?% rgba(0,0,0,.05)}.user-info[data-v-c0822888]{display:flex;align-items:center;flex:1;gap:%?20?%;overflow:hidden}.avatar[data-v-c0822888]{width:%?88?%;height:%?88?%;border-radius:50%;background-color:#f0f0f0}.info-text[data-v-c0822888]{display:flex;flex-direction:column;gap:%?8?%;overflow:hidden}.name[data-v-c0822888]{font-size:%?30?%;color:#333;font-weight:600}.bio[data-v-c0822888]{font-size:%?24?%;color:#888;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:%?420?%}.follow-time[data-v-c0822888]{font-size:%?22?%;color:#b0b0b0}.mutual-label[data-v-c0822888]{display:inline-block;margin-top:%?4?%;padding:%?4?% %?16?%;border-radius:%?999?%;font-size:%?24?%;background-color:#e6f4ff;color:#1f6fd2}.follow-btn[data-v-c0822888]{margin-left:%?24?%;border:none;background-color:#9ed7ee;color:#fff;border-radius:%?999?%;padding:0 %?28?%;height:%?64?%!important;line-height:%?64?%!important}.follow-btn.following[data-v-c0822888]{background-color:#f0f0f0;color:#666}.follow-btn[data-v-c0822888]::after{border:none}.follow-btn[disabled][data-v-c0822888]{opacity:.6}.loading[data-v-c0822888],\n.loading-more[data-v-c0822888]{margin-top:%?32?%;text-align:center;color:#999;font-size:%?26?%}.empty[data-v-c0822888]{margin-top:%?120?%;text-align:center;color:#999;font-size:%?28?%}.footer-hint[data-v-c0822888]{margin-top:%?24?%}",""]),t.exports=e},"832c":function(t,e,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(a("39d8")),i=n(a("9b1b"));a("bf0f"),a("fd3c"),a("c223");var r=a("139b"),s=r.formatRelativeTime,l=a("11ca"),c=l.cloudCall,u={data:function(){return{fans:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:20,pendingOpenid:null,defaultAvatar:"/static/images/avatar.png",total:""}},onLoad:function(){this.markFollowNotificationsRead(),this.loadFans(!0)},onPullDownRefresh:function(){this.loadFans(!0)},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadFans()},methods:(0,o.default)({formatTime:void 0,callCloudFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(t,e,Object.assign({pageTag:"fans",context:this,requireAuth:!0},a))},loadFans:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading){e&&(this.setData({page:0,hasMore:!0}),this.markFollowNotificationsRead());var a=e?0:this.page;this.setData({isLoading:!0}),this.callCloudFunction("follow",{action:"getFollowerList",skip:a*this.PAGE_SIZE,limit:this.PAGE_SIZE}).then((function(n){if(n.result&&n.result.success){var o=n.result.list||[],r=o.map((function(e){return(0,i.default)((0,i.default)({},e),{},{followedAtText:e.followedAt?t.formatTime(e.followedAt):""})})),s=e?r:t.fans.concat(r);t.setData({fans:s,page:a+1,hasMore:!!n.result.hasMore,total:n.result.total||s.length})}else uni.showToast({title:n.result&&n.result.message?n.result.message:"加载失败",icon:"none"})})).catch((function(t){console.error("获取粉丝列表失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),e&&uni.stopPullDownRefresh()}))}},markFollowNotificationsRead:function(){this.callCloudFunction("follow",{action:"markFollowNotificationsRead"}).catch((function(t){console.error("标记关注消息已读失败:",t)}))},onToggleFollow:function(t){var e=this,a=t.currentTarget.dataset.openid,n=t.currentTarget.dataset.index;a&&void 0!==n&&!this.pendingOpenid&&(this.setData({pendingOpenid:a}),this.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:a}).then((function(t){if(t.result&&t.result.success){var i=!!t.result.isFollowing;e.setData((0,o.default)({},"fans[".concat(n,"].isMutual"),i)),uni.showToast({title:i?"关注成功":"已取消关注",icon:"success"}),e.refreshFanStatus(a,n)}else uni.showToast({title:t.result&&t.result.message?t.result.message:"操作失败",icon:"none"})})).catch((function(t){console.error("操作粉丝关注状态失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){e.setData({pendingOpenid:null})})))},refreshFanStatus:function(t,e){var a=this;this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:t}).then((function(t){t.result&&t.result.success&&a.setData((0,o.default)({},"fans[".concat(e,"].isMutual"),!!t.result.isMutual))})).catch((function(t){console.error("刷新粉丝状态失败:",t)}))},onAvatarError:function(t){var e=t.currentTarget.dataset.index;void 0!==e&&this.setData((0,o.default)({},"fans[".concat(e,"].avatarUrl"),this.defaultAvatar))},openUserProfile:function(t){var e=t.currentTarget.dataset.openid;e&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(e)})}},"formatTime",(function(t){return s(t)}))};e.default=u},db04:function(t,e,a){"use strict";var n=a("bb80"),o=a("c435"),i=a("9e70"),r=a("f298"),s=a("862c"),l=n(r),c=n("".slice),u=Math.ceil,d=function(t){return function(e,a,n){var r,d,f=i(s(e)),v=o(a),g=f.length,h=void 0===n?" ":i(n);return v<=g||""===h?f:(r=v-g,d=l(h,u(r/h.length)),d.length>r&&(d=c(d,0,r)),t?f+d:d+f)}};t.exports={start:d(!1),end:d(!0)}},ea19:function(t,e,a){"use strict";var n=a("57e2e"),o=a.n(n);o.a}}]);