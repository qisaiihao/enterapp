(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-feedback-admin-feedback-admin"],{"38f6":function(n,e,r){var t=r("c86c");e=t(!1),e.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* 管理员反馈查看页面样式 */.container[data-v-fe22c140]{min-height:100vh;background-color:#f5f5f5;padding-top:0}\r\n/* 头部 */.header[data-v-fe22c140]{display:flex;align-items:center;justify-content:space-between;padding:%?20?% %?30?%;background-color:#fff;border-bottom:%?1?% solid #eee;position:-webkit-sticky;position:sticky;top:0;z-index:100}.header-left[data-v-fe22c140],\r\n.header-right[data-v-fe22c140]{width:%?60?%;height:%?60?%;display:flex;align-items:center;justify-content:center}.back-icon[data-v-fe22c140],\r\n.refresh-icon[data-v-fe22c140]{font-size:%?36?%;color:#333;font-weight:700}.header-title[data-v-fe22c140]{font-size:%?32?%;font-weight:600;color:#333}\r\n/* 反馈列表 */.feedback-list[data-v-fe22c140]{padding:%?20?%}.feedback-item[data-v-fe22c140]{background-color:#fff;border-radius:%?16?%;padding:%?30?%;margin-bottom:%?20?%;box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1)}.feedback-item.processed[data-v-fe22c140]{opacity:.7;background-color:#f8f8f8}\r\n/* 反馈头部 */.feedback-header[data-v-fe22c140]{display:flex;justify-content:space-between;align-items:center;margin-bottom:%?20?%}.user-info[data-v-fe22c140]{display:flex;flex-direction:column}.user-name[data-v-fe22c140]{font-size:%?28?%;font-weight:600;color:#333;margin-bottom:%?8?%}.feedback-time[data-v-fe22c140]{font-size:%?24?%;color:#999}.status-badge[data-v-fe22c140]{padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?22?%;font-weight:500}.status-badge.pending[data-v-fe22c140]{background-color:#fff2e8;color:#fa8c16}.status-badge.processed[data-v-fe22c140]{background-color:#f6ffed;color:#52c41a}\r\n/* 反馈内容 */.feedback-content[data-v-fe22c140]{margin-bottom:%?20?%}.content-text[data-v-fe22c140]{font-size:%?28?%;color:#333;line-height:1.6;white-space:pre-wrap}\r\n/* 反馈图片 */.feedback-images[data-v-fe22c140]{margin-bottom:%?20?%}.image-grid[data-v-fe22c140]{display:flex;flex-wrap:wrap;gap:%?10?%}.feedback-image[data-v-fe22c140]{width:%?120?%;height:%?120?%;border-radius:%?8?%;background-color:#f0f0f0}\r\n/* 操作按钮 */.feedback-actions[data-v-fe22c140]{display:flex;justify-content:flex-end;gap:%?20?%}.action-btn[data-v-fe22c140]{border-radius:%?20?%;font-size:%?24?%;padding:0 %?20?%;height:%?60?%;line-height:%?60?%}.process-btn[data-v-fe22c140]{background-color:#52c41a;color:#fff;border:none}.delete-btn[data-v-fe22c140]{background-color:#ff4d4f;color:#fff;border:none}.action-btn[data-v-fe22c140]::after{border:none}\r\n/* 空状态 */.empty-state[data-v-fe22c140]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% 0}.empty-icon[data-v-fe22c140]{font-size:%?80?%;margin-bottom:%?20?%}.empty-text[data-v-fe22c140]{font-size:%?28?%;color:#999}\r\n/* 加载状态 */.loading-more[data-v-fe22c140],\r\n.no-more[data-v-fe22c140]{text-align:center;padding:%?40?% 0;font-size:%?24?%;color:#999}",""]),n.exports=e},3941:function(n,e,r){"use strict";r.r(e);var t=r("e9e1"),a=r.n(t);for(var i in t)["default"].indexOf(i)<0&&function(n){r.d(e,n,(function(){return t[n]}))}(i);e["default"]=a.a},"3d89":function(n,e,r){var t=r("38f6");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[n.i,t,""]]),t.locals&&(n.exports=t.locals);var a=r("967d").default;a("0824449b",t,!0,{sourceMap:!1,shadowMode:!1})},"66f0":function(n,e,r){"use strict";var t=r("3d89"),a=r.n(t);a.a},"73e1":function(n,e,r){"use strict";var t=r("29d8");n.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(t)},"795c":function(n,e,r){"use strict";var t=r("8bdb"),a=r("db04").start,i=r("73e1");t({target:"String",proto:!0,forced:i},{padStart:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},"820e":function(n,e,r){"use strict";r.d(e,"b",(function(){return t})),r.d(e,"c",(function(){return a})),r.d(e,"a",(function(){}));var t=function(){var n=this,e=n.$createElement,r=n._self._c||e;return r("v-uni-view",{staticClass:"container",style:"padding-top: "+n.statusBarHeight+"px;"},[r("v-uni-view",{staticClass:"header",style:"top: "+n.statusBarHeight+"px;"},[r("v-uni-view",{staticClass:"header-left",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.goBack.apply(void 0,arguments)}}},[r("v-uni-text",{staticClass:"back-icon"},[n._v("←")])],1),r("v-uni-text",{staticClass:"header-title"},[n._v("反馈管理")]),r("v-uni-view",{staticClass:"header-right",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.refreshFeedbackList.apply(void 0,arguments)}}},[r("v-uni-text",{staticClass:"refresh-icon"},[n._v("🔄")])],1)],1),r("v-uni-view",{staticClass:"feedback-list"},[n.feedbackList.length>0?n._l(n.feedbackList,(function(e,t){return r("v-uni-view",{key:t,class:"feedback-item "+(e.isProcessed?"processed":"")},[r("v-uni-view",{staticClass:"feedback-header"},[r("v-uni-view",{staticClass:"user-info"},[r("v-uni-text",{staticClass:"user-name"},[n._v(n._s(e.userName||"匿名用户"))]),r("v-uni-text",{staticClass:"feedback-time"},[n._v(n._s(e.formattedCreateTime))])],1),r("v-uni-view",{class:"status-badge "+(e.isProcessed?"processed":"pending")},[n._v(n._s(e.isProcessed?"已处理":"待处理"))])],1),r("v-uni-view",{staticClass:"feedback-content"},[r("v-uni-text",{staticClass:"content-text"},[n._v(n._s(e.content))])],1),e.imageUrls&&e.imageUrls.length>0?r("v-uni-view",{staticClass:"feedback-images"},[r("v-uni-view",{staticClass:"image-grid"},n._l(e.imageUrls,(function(t,a){return r("v-uni-image",{key:a,staticClass:"feedback-image",attrs:{src:t,mode:"aspectFill","data-src":t,"data-urls":e.imageUrls},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.previewImage.apply(void 0,arguments)}}})})),1)],1):n._e(),r("v-uni-view",{staticClass:"feedback-actions"},[e.isProcessed?n._e():r("v-uni-button",{staticClass:"action-btn process-btn",attrs:{size:"mini","data-id":e._id,"data-index":t},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.markAsProcessed.apply(void 0,arguments)}}},[n._v("标记已处理")]),r("v-uni-button",{staticClass:"action-btn delete-btn",attrs:{size:"mini","data-id":e._id,"data-index":t},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.deleteFeedback.apply(void 0,arguments)}}},[n._v("删除")])],1)],1)})):r("v-uni-view",{staticClass:"empty-state"},[r("v-uni-text",{staticClass:"empty-icon"},[n._v("📝")]),r("v-uni-text",{staticClass:"empty-text"},[n._v("暂无反馈")])],1),n.loading?r("v-uni-view",{staticClass:"loading-more"},[r("v-uni-text",[n._v("加载中...")])],1):!n.hasMore&&n.feedbackList.length>0?r("v-uni-view",{staticClass:"no-more"},[r("v-uni-text",[n._v("--- 没有更多了 ---")])],1):n._e()],2)],1)},a=[]},"962f":function(n,e,r){r("795c"),r("64aa"),r("5c47"),r("a1c1"),r("c223"),r("f7a5");var t=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(n).padStart(e,"0")},a=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",r=n instanceof Date?n:new Date(n);if(Number.isNaN(r.getTime()))return"";var a={yyyy:String(r.getFullYear()),MM:t(r.getMonth()+1),dd:t(r.getDate()),HH:t(r.getHours()),mm:t(r.getMinutes()),ss:t(r.getSeconds())};return e.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(n){return a[n]}))};n.exports={formatTimeAgo:function(n){var e=new Date,r=new Date(n),t=e.getTime()-r.getTime(),a=Math.floor(t/1e3),i=Math.floor(a/60),o=Math.floor(i/60),s=Math.floor(o/24);if(s>=7){var c=r.getFullYear(),u=("0"+(r.getMonth()+1)).slice(-2),d=("0"+r.getDate()).slice(-2);return"".concat(c,"-").concat(u,"-").concat(d)}return s>=1?"".concat(s,"天前"):o>=1?"".concat(o,"小时前"):i>=1?"".concat(i,"分钟前"):"刚刚"},formatRelativeTime:function(n){var e=Date.now(),r=n instanceof Date?n.getTime():new Date(n).getTime();if(Number.isNaN(r))return"";var t=e-r,i=Math.floor(Math.abs(t)/1e3),o=t>=0?"前":"后";if(i<60)return"刚刚";var s=Math.floor(i/60);if(s<60)return"".concat(s,"分钟").concat(o);var c=Math.floor(s/60);if(c<24)return"".concat(c,"小时").concat(o);var u=Math.floor(c/24);return u<7?"".concat(u,"天").concat(o):a(r,"yyyy-MM-dd")},formatDate:a}},"967d":function(n,e,r){"use strict";function t(n,e){for(var r=[],t={},a=0;a<e.length;a++){var i=e[a],o=i[0],s=i[1],c=i[2],u=i[3],d={id:n+":"+a,css:s,media:c,sourceMap:u};t[o]?t[o].parts.push(d):r.push(t[o]={id:o,parts:[d]})}return r}r.r(e),r.d(e,"default",(function(){return v}));var a="undefined"!==typeof document;if("undefined"!==typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},o=a&&(document.head||document.getElementsByTagName("head")[0]),s=null,c=0,u=!1,d=function(){},f=null,l="undefined"!==typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function v(n,e,r,a){u=r,f=a||{};var o=t(n,e);return g(o),function(e){for(var r=[],a=0;a<o.length;a++){var s=o[a],c=i[s.id];c.refs--,r.push(c)}e?(o=t(n,e),g(o)):o=[];for(a=0;a<r.length;a++){c=r[a];if(0===c.refs){for(var u=0;u<c.parts.length;u++)c.parts[u]();delete i[c.id]}}}}function g(n){for(var e=0;e<n.length;e++){var r=n[e],t=i[r.id];if(t){t.refs++;for(var a=0;a<t.parts.length;a++)t.parts[a](r.parts[a]);for(;a<r.parts.length;a++)t.parts.push(h(r.parts[a]));t.parts.length>r.parts.length&&(t.parts.length=r.parts.length)}else{var o=[];for(a=0;a<r.parts.length;a++)o.push(h(r.parts[a]));i[r.id]={id:r.id,refs:1,parts:o}}}}function p(){var n=document.createElement("style");return n.type="text/css",o.appendChild(n),n}function h(n){var e,r,t=document.querySelector('style[data-vue-ssr-id~="'+n.id+'"]');if(t){if(u)return d;t.parentNode.removeChild(t)}if(l){var a=c++;t=s||(s=p()),e=b.bind(null,t,a,!1),r=b.bind(null,t,a,!0)}else t=p(),e=k.bind(null,t),r=function(){t.parentNode.removeChild(t)};return e(n),function(t){if(t){if(t.css===n.css&&t.media===n.media&&t.sourceMap===n.sourceMap)return;e(n=t)}else r()}}var m=function(){var n=[];return function(e,r){return n[e]=r,n.filter(Boolean).join("\n")}}();function b(n,e,r,t){var a=r?"":B(t.css);if(n.styleSheet)n.styleSheet.cssText=m(e,a);else{var i=document.createTextNode(a),o=n.childNodes;o[e]&&n.removeChild(o[e]),o.length?n.insertBefore(i,o[e]):n.appendChild(i)}}function k(n,e){var r=B(e.css),t=e.media,a=e.sourceMap;if(t&&n.setAttribute("media",t),f.ssrId&&n.setAttribute("data-vue-ssr-id",e.id),a&&(r+="\n/*# sourceURL="+a.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),n.styleSheet)n.styleSheet.cssText=r;else{while(n.firstChild)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(r))}}var w=/%\?([+-]?\d+(\.\d+)?)\?%/g,y=/\.\?%PAGE\?%/g,x=/\?%PAGE\?%\[data-v-[a-z0-9]{8}\]/g,C=/uni-page-body\[data-v-[a-z0-9]{8}\]/g,M=/var\(--status-bar-height\)/gi,T=/var\(--window-top\)/gi,L=/var\(--window-bottom\)/gi,A=/var\(--window-left\)/gi,_=/var\(--window-right\)/gi;function B(n){var e=function(){var n="function"===typeof getApp&&getApp();return n&&n.$route&&n.$route.meta&&n.$route.meta.name||""}();if("undefined"!==typeof uni&&!uni.canIUse("css.var")){var r=function(){var n="function"===typeof getApp&&getApp();if(n&&n.$route&&n.$route.meta&&n.$route.meta.name)return{top:n.$route.meta.windowTop,bottom:n.$route.meta.isTabBar?50:0};return{top:0,bottom:0}}();n=n.replace(M,"0px").replace(T,r.top+"px").replace(L,r.bottom+"px").replace(A,"0px").replace(_,"0px")}return n.replace(x,e).replace(y,"").replace(C,"body."+e+" uni-page-body").replace(/\{[\s\S]+?\}|@media.+?\{/g,(function(n){return"undefined"===typeof uni?n:n.replace(w,(function(n,e){return uni.upx2px(e)+"px"}))}))}},c86c:function(n,e,r){"use strict";n.exports=function(n){var e=[];return e.toString=function(){return this.map((function(e){var r=function(n,e){var r=n[1]||"",t=n[3];if(!t)return r;if(e&&"function"===typeof btoa){var a=function(n){var e=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e);return"/*# ".concat(r," */")}(t),i=t.sources.map((function(n){return"/*# sourceURL=".concat(t.sourceRoot||"").concat(n," */")}));return[r].concat(i).concat([a]).join("\n")}return[r].join("\n")}(e,n);return e[2]?"@media ".concat(e[2]," {").concat(r,"}"):r})).join("")},e.i=function(n,r,t){"string"===typeof n&&(n=[[null,n,""]]);var a={};if(t)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(a[o]=!0)}for(var s=0;s<n.length;s++){var c=[].concat(n[s]);t&&a[c[0]]||(r&&(c[2]?c[2]="".concat(r," and ").concat(c[2]):c[2]=r),e.push(c))}},e}},db04:function(n,e,r){"use strict";var t=r("bb80"),a=r("c435"),i=r("9e70"),o=r("f298"),s=r("862c"),c=t(o),u=t("".slice),d=Math.ceil,f=function(n){return function(e,r,t){var o,f,l=i(s(e)),v=a(r),g=l.length,p=void 0===t?" ":i(t);return v<=g||""===p?l:(o=v-g,f=c(p,d(o/p.length)),f.length>o&&(f=u(f,0,o)),n?l+f:f+l)}};n.exports={start:f(!1),end:f(!0)}},e0d6:function(n,e,r){"use strict";r.r(e);var t=r("820e"),a=r("3941");for(var i in a)["default"].indexOf(i)<0&&function(n){r.d(e,n,(function(){return a[n]}))}(i);r("66f0");var o=r("828b"),s=Object(o["a"])(a["default"],t["b"],t["c"],!1,null,"fe22c140",null,!1,t["a"],void 0);e["default"]=s.exports},e9e1:function(n,e,r){"use strict";r("6a54");var t=r("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,r("4626"),r("7a76"),r("c9b5"),r("5ac7"),r("bf0f"),r("2797"),r("c223"),r("8f71");var a=t(r("39d8")),i=t(r("2634")),o=t(r("2fdc")),s=r("962f"),c=s.formatRelativeTime,u=r("edf3"),d=u.previewImage,f=r("38db"),l=f.cloudCall,v={data:function(){return{feedbackList:[],loading:!1,hasMore:!0,page:0,pageSize:10,isAdmin:!1,currentUserOpenid:"",statusBarHeight:0,imageUrl:""}},onLoad:function(){var n=uni.getSystemInfoSync();this.setData({statusBarHeight:n.statusBarHeight}),uni.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#ffffff"}),this.checkAdminPermission()},onShow:function(){this.isAdmin&&this.refreshFeedbackList()},onPullDownRefresh:function(){this.refreshFeedbackList(),uni.stopPullDownRefresh()},onReachBottom:function(){this.hasMore&&!this.loading&&this.loadFeedbackList()},methods:{callCloudFunction:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(n,e,Object.assign({pageTag:"feedback-admin",context:this},r))},checkAdminPermission:function(){var n=this;return(0,o.default)((0,i.default)().mark((function e(){var r,t,a,o;return(0,i.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.callCloudFunction("getOpenId",{});case 3:if(r=e.sent,!r.result||!r.result.openid){e.next=17;break}if(t=r.result.openid,a=["ojYBd1_A3uCbQ1LGcHxWxOAeA5SE","ojYBd14JG3-ghYuGCI2WHmkMc9nE"],o=a.includes(t),console.log("反馈管理页面 - 当前用户:",t),console.log("反馈管理页面 - 是否为管理员:",o),n.setData({currentUserOpenid:t,isAdmin:o}),o){e.next=14;break}return uni.showModal({title:"权限不足",content:"您没有权限访问反馈管理功能",showCancel:!1,success:function(){uni.navigateBack()}}),e.abrupt("return");case 14:n.loadFeedbackList(),e.next=18;break;case 17:throw new Error("无法获取用户信息");case 18:e.next=26;break;case 20:e.prev=20,e.t0=e["catch"](0),console.log("CatchClause",e.t0),console.log("CatchClause",e.t0),console.error("权限检查失败:",e.t0),uni.showModal({title:"错误",content:"权限检查失败，无法访问此页面",showCancel:!1,success:function(){uni.navigateBack()}});case 26:case"end":return e.stop()}}),e,null,[[0,20]])})))()},loadFeedbackList:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.loading){var r=this.page,t=this.pageSize,a=e?0:r;this.setData({loading:!0}),this.callCloudFunction("feedbackManager",{action:"getFeedbackList",skip:a*t,limit:t}).then((function(r){if(r.result&&r.result.success){var i=r.result.feedbackList||[];i.forEach((function(e){e.formattedCreateTime=n.formatTime(e.createTime)}));var o=e?i:n.feedbackList.concat(i);n.setData({feedbackList:o,page:a+1,hasMore:i.length===t})}else{var s;uni.showToast({title:(null===(s=r.result)||void 0===s?void 0:s.message)||"加载失败",icon:"none"})}})).catch((function(n){console.error("加载反馈列表失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({loading:!1})}))}},refreshFeedbackList:function(){this.setData({feedbackList:[],page:0,hasMore:!0}),this.loadFeedbackList(!0)},formatTime:function(n){return c(n)},previewImage:function(n){return d(n,{fallbackToast:!1})},deleteFeedback:function(n){var e=n.currentTarget.dataset.id,r=n.currentTarget.dataset.index,t=this;uni.showModal({title:"确认删除",content:"确定要删除这条反馈吗？",confirmColor:"#ff4d4f",success:function(n){n.confirm&&(uni.showLoading({title:"删除中..."}),this.callCloudFunction("feedbackManager",{action:"deleteFeedback",feedbackId:e}).then((function(n){if(uni.hideLoading(),n.result&&n.result.success){uni.showToast({title:"删除成功",icon:"success"});var e=t.feedbackList.filter((function(n,e){return e!==r}));t.setData({feedbackList:e})}else{var a;uni.showToast({title:(null===(a=n.result)||void 0===a?void 0:a.message)||"删除失败",icon:"none"})}})).catch((function(n){uni.hideLoading(),console.error("删除反馈失败:",n),uni.showToast({title:"删除失败",icon:"none"})})))}})},markAsProcessed:function(n){var e=n.currentTarget.dataset.id,r=n.currentTarget.dataset.index,t=this;uni.showLoading({title:"处理中..."}),this.callCloudFunction("feedbackManager",{action:"markAsProcessed",feedbackId:e}).then((function(n){var e,i;(uni.hideLoading(),n.result&&n.result.success)?(uni.showToast({title:"已标记为处理",icon:"success"}),t.setData((e={},(0,a.default)(e,"feedbackList[".concat(r,"].isProcessed"),!0),(0,a.default)(e,"feedbackList[".concat(r,"].processedTime"),new Date),e))):uni.showToast({title:(null===(i=n.result)||void 0===i?void 0:i.message)||"操作失败",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("标记处理失败:",n),uni.showToast({title:"操作失败",icon:"none"})}))},goBack:function(){uni.navigateBack()}}};e.default=v},edf3:function(n,e,r){function t(n){if(!n)return{current:"",urls:[]};if(n.currentTarget&&n.currentTarget.dataset){var e=n.currentTarget.dataset,r=e.src||e.current||e.url||Array.isArray(e.urls)&&e.urls[0]||"",t=e.originalImageUrls||e.urls||e.urlList,a=Array.isArray(t)?t.filter(Boolean):"string"===typeof t&&t?[t]:[];return{current:r,urls:a}}var i=n.current||n.src||Array.isArray(n.urls)&&n.urls[0]||Array.isArray(n.list)&&n.list[0]||"",o=Array.isArray(n.urls)?n.urls.filter(Boolean):Array.isArray(n.list)?n.list.filter(Boolean):[];return{current:i,urls:o}}function a(n){"undefined"!==typeof uni&&uni.showToast&&uni.showToast({title:n,icon:"none"})}r("8f71"),r("bf0f"),n.exports={previewImage:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.fallbackToast,i=void 0===r||r,o=t(n);if(!o.current&&0===o.urls.length)return i&&a("图片数据缺失"),!1;var s=o.urls.length?o.urls:[o.current],c=o.current||s[0];return c&&0!==s.length?uni.previewImage({current:c,urls:s}):(i&&a("图片不可预览"),!1)}}}}]);