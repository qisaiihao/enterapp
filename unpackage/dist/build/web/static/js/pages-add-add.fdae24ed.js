(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-add-add"],{"422e":function(n,r,t){"use strict";var e=t("59cf"),a=t.n(e);a.a},"50d0":function(n,r,t){"use strict";t.r(r);var e=t("c26f"),a=t("979d");for(var i in a)["default"].indexOf(i)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(i);t("422e");var o=t("828b"),s=Object(o["a"])(a["default"],e["b"],e["c"],!1,null,"7fa41c58",null,!1,e["a"],void 0);r["default"]=s.exports},"59cf":function(n,r,t){var e=t("b614");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("83ac47ea",e,!0,{sourceMap:!1,shadowMode:!1})},"6e3f":function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=e(t("b7c7")),i=e(t("fcf3"));t("bf0f"),t("7a76"),t("c9b5"),t("4626"),t("5ac7"),t("0c26"),t("fd3c"),t("18f7"),t("de6c"),t("dc89"),t("2425"),t("c223"),t("dd2b"),t("8f71"),t("5ef2"),t("aa9c"),t("f7a5");var o=t("11ca"),s=o.cloudCall,l={data:function(){return{title:"",content:"",imageList:[],maxImageCount:9,publishMode:"normal",isOriginal:!1,showPoemSubmenu:!1,canPublish:!1,selectedTags:[],customTag:"",showTagSelector:!1,currentCategoryIndex:0,allExistingTags:[],matchedTags:[],showMatchedTags:!1,isPublished:!1,isTemporaryHide:!1,author:"",keyboardHeight:0,tagCategories:[{name:"内容主题",icon:"📝",tags:["爱情","亲情","友情","乡愁","思念","孤独","咏物","山水","田园","季节","春天","夏日","秋风","冬雪","人生","理想","哲理","时间","青春","成长","生死","怀古","咏史","边塞","战争","爱国","城市","乡村","生活","旅行","饮食","劳动"]},{name:"情感基调",icon:"💭",tags:["治愈","温暖","浪漫","唯美","悲伤","伤感","惆怅","寂寞","豪放","豁达","激昂","热血","婉约","细腻","清新","宁静","励志","鼓舞","坚定","充满希望","讽刺","批判","深沉","引人深思"]},{name:"形式体裁",icon:"📖",tags:["古体诗","近体诗","五言","七言","绝句","律诗","词","曲","乐府","骚体","现代诗","自由诗","散文诗","十四行诗","叙事诗","俳句","短歌","史诗","长诗","短诗","微型诗","三行诗"]},{name:"意象元素",icon:"🌙",tags:["月亮","星星","太阳","宇宙","银河","风","雨","雪","云","雾","河流","大海","山峰","森林","花","草","树","麦田","落叶","梅","兰","竹","菊","鸟","马","蝉","鱼","蝴蝶","酒","剑","琴","灯","船","镜子","红色","白色","蓝色","金色"]},{name:"风格流派",icon:"🎭",tags:["唐诗","宋词","元曲","先秦","两汉","魏晋","建安风骨","朦胧诗","新月派","浪漫主义","现实主义","象征主义","现代主义","意象派","垮掉的一代","中文诗","英文诗","日文诗","法文诗","翻译诗","中国","英国","美国","日本","俄罗斯"]},{name:"场景用途",icon:"🎯",tags:["晚安诗","早安问候","节日祝福","春节","中秋","情人节","毕业季","婚礼致辞","旅行途中","雨天读诗","写给孩子","致敬母亲","送给朋友","适合摘抄","可以用作签名"]}],tags:[]}},onLoad:function(n){this.loadAllExistingTags(),"edit"===n.mode?this.loadEditingDraft():this.loadDraft(),this.preventPageScroll()},onShow:function(){this.preventPageScroll()},onUnload:function(){this.isPublished||this.checkAndSaveDraft()},onHide:function(){this.isPublished||this.isTemporaryHide||this.checkAndSaveDraft(),this.setData({isTemporaryHide:!1})},methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(n,r,Object.assign({pageTag:"add",context:this,requireAuth:!0},t))},uploadFile:function(n,r){var e=this;return new Promise((function(a,i){var o=t("fd09"),s=o.getCurrentPlatform,l=o.getCloudFunctionMethod,c=(s(),l());"tcb"===c?e.uploadFileViaCloudFunction(n,r).then(a).catch(i):"wx-cloud"===c?wx.cloud&&wx.cloud.uploadFile?wx.cloud.uploadFile({cloudPath:n,filePath:r,success:function(n){a(n)},fail:function(n){i(n)}}):i(new Error("微信云开发不可用")):i(new Error("不支持的云函数调用方式: ".concat(c)))}))},uploadFileViaCloudFunction:function(n,r){var t=this,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((function(a,i){if("undefined"!==typeof window&&"undefined"!==typeof FileReader)fetch(r).then((function(n){if(!n.ok)throw new Error("HTTP error! status: ".concat(n.status));return n.blob()})).then((function(o){var s=new FileReader;s.onload=function(){var o=s.result;if(!o||"string"!==typeof o)return console.error("❌ [Add页面] FileReader结果无效:",o),void i(new Error("文件读取失败"));var l=o.split(",")[1];console.log("🔍 [Add页面] 文件转换为base64完成，长度: ".concat(l.length)),l.length>6291456&&console.warn("⚠️ [Add页面] base64文件过大，尝试进一步压缩"),t.callCloudFunction("upload",{cloudPath:n,fileContent:l}).then((function(n){console.log("上传云函数返回结果:",n),n&&n.result&&n.result.success?a({fileID:n.result.fileID,cloudPath:n.result.cloudPath}):i(new Error("上传云函数返回格式错误"))})).catch((function(o){var s;e<2&&("request:fail"===o.errMsg||null!==(s=o.message)&&void 0!==s&&s.includes("fail"))?(console.log("🔄 [Add页面] 上传失败，准备重试 (".concat(e+1,"/2)")),setTimeout((function(){t.uploadFileViaCloudFunction(n,r,e+1).then(a).catch(i)}),1e3*(e+1))):i(o)}))},s.onerror=function(){console.error("❌ [Add页面] FileReader读取失败"),i(new Error("文件读取失败"))},s.readAsDataURL(o)})).catch((function(n){console.error("❌ [Add页面] 获取文件blob失败:",n),i(new Error("获取文件失败: "+n.message))}));else{console.log("🔍 [Add页面] App环境使用uni-app API读取文件");try{var o=uni.getFileSystemManager();o&&o.readFile?o.readFile({filePath:r,encoding:"base64",success:function(r){var e=r.data;console.log("🔍 [Add页面] 文件读取完成，base64长度: ".concat(e.length)),t.callCloudFunction("upload",{cloudPath:n,fileContent:e}).then((function(n){console.log("App环境上传云函数返回结果:",n),n&&n.result&&n.result.success?a({fileID:n.result.fileID,cloudPath:n.result.cloudPath}):i(new Error("上传云函数返回格式错误"))})).catch(i)},fail:function(n){console.error("❌ [Add页面] 文件读取失败：",n),i(new Error("文件读取失败: ".concat(n.errMsg||"未知错误")))}}):(console.error("❌ [Add页面] getFileSystemManager不可用"),i(new Error("文件系统API不可用")))}catch(s){console.error("❌ [Add页面] 文件系统API调用失败:",s),i(new Error("文件系统API不可用"))}}}))},preventPageScroll:function(){try{uni.pageScrollTo({scrollTop:0,duration:0})}catch(n){console.log("CatchClause",n),console.log("CatchClause",n),console.log("preventPageScroll error:",n)}},onTitleInput:function(n){this.setData({title:n.detail.value}),this.checkCanPublish()},onContentInput:function(n){var r=n.detail,t=r.value;r.cursor;this.setData({content:t}),this.checkCanPublish()},onContainerTap:function(n){console.log("容器被点击，准备隐藏键盘"),setTimeout((function(){uni.hideKeyboard()}),100)},onTextareaTap:function(n){console.log("textarea被点击，应该获取焦点")},onTextareaFocus:function(n){console.log("textarea获得焦点，键盘高度:",n.detail.height);var r=n.detail.height;if(!r||0===r){var t=uni.getSystemInfoSync();console.log("系统信息:",t),r=Math.min(.4*t.windowHeight,300),console.log("使用默认键盘高度:",r)}this.setData({keyboardHeight:r})},onTextareaBlur:function(){console.log("textarea失去焦点"),this.setData({keyboardHeight:0})},onAuthorInput:function(n){this.setData({author:n.detail.value}),this.checkCanPublish()},checkCanPublish:function(){var n=this.imageList.length>0,r=this.title&&this.title.trim(),t=this.content&&this.content.trim(),e=n||r&&t;if("poem"===this.publishMode&&!this.isOriginal){var a=this.author&&this.author.trim();e=e&&a}this.setData({canPublish:e})},switchMode:function(){"normal"===this.publishMode?this.showPoemSubmenu?this.setData({showPoemSubmenu:!1}):this.setData({showPoemSubmenu:!0,showTagSelector:!1}):(this.setData({publishMode:"normal",isOriginal:!1,showPoemSubmenu:!1,maxImageCount:9}),this.checkCanPublish())},selectPoemMode:function(n){var r="true"===n.currentTarget.dataset.original;this.setData({publishMode:"poem",isOriginal:r,showPoemSubmenu:!1,imageList:this.imageList.length>1?[]:this.imageList,maxImageCount:1}),this.checkCanPublish()},handleChooseImage:function(){var n=this,r=this,t=this.maxImageCount-this.imageList.length;t<=0?uni.showToast({title:"最多只能上传9张图片",icon:"none"}):(this.setData({isTemporaryHide:!0}),uni.chooseImage({count:t,sizeType:["original"],sourceType:["album","camera"],success:function(n){uni.showLoading({title:"处理中..."}),console.log("wx.chooseImage 返回的详细文件信息:",n.tempFiles);var t=n.tempFiles.map((function(n){var t=n.path,e=n.size;if(console.log("获取到图片 ".concat(t," 的原始大小:"),(e/1024).toFixed(2),"KB"),e>5242880)throw new Error("图片文件过大 (".concat((e/1024/1024).toFixed(2),"MB)，请选择小于5MB的图片"));var a=e>2e5,i={originalPath:t,imageSize:e,needCompression:a,previewUrl:t,compressedPath:t,originalUrl:"",compressedUrl:""};return a?r.compressImage(i):Promise.resolve(i)}));Promise.all(t).then((function(n){uni.hideLoading(),r.updateImageList(n),r.checkCanPublish()})).catch((function(n){uni.hideLoading(),console.error("图片处理失败:",n);var r="图片处理失败";n.message&&n.message.includes("图片文件过大")?r=n.message:n.message&&(r="图片处理失败: ".concat(n.message)),uni.showModal({title:"错误",content:r,showCancel:!1,confirmText:"确定"})}))},fail:function(r){console.log("选择图片取消或失败:",r),n.setData({isTemporaryHide:!1})}}))},compressImage:function(n){var r=this;return new Promise((function(e){var a=t("fd09"),i=a.getCurrentPlatform,o=i();"h5"===o?(console.log("🔍 [Add页面] H5环境使用Canvas压缩图片"),r.compressImageWithCanvas(n).then(e).catch((function(){console.log("Canvas压缩失败，使用原图"),n.compressedPath=n.originalPath,n.previewUrl=n.originalPath,e(n)}))):(console.log("🔍 [Add页面] 小程序/App环境使用uni.compressImage"),uni.compressImage({src:n.originalPath,quality:80,success:function(r){n.compressedPath=r.tempFilePath,n.previewUrl=r.tempFilePath,e(n)},fail:function(r){console.log("压缩失败，使用原图:",r),n.compressedPath=n.originalPath,n.previewUrl=n.originalPath,e(n)}}))}))},compressImageWithCanvas:function(n){return new Promise((function(r,t){var e=new Image;e.crossOrigin="anonymous",e.onload=function(){try{var a=document.createElement("canvas"),i=a.getContext("2d"),o=e.width,s=e.height;o>s?o>1200&&(s=1200*s/o,o=1200):s>1200&&(o=1200*o/s,s=1200),a.width=o,a.height=s,i.drawImage(e,0,0,o,s),a.toBlob((function(e){if(e){var a=URL.createObjectURL(e);n.compressedPath=a,n.previewUrl=a,console.log("✅ [Add页面] Canvas压缩成功，新尺寸:",o,"x",s),r(n)}else t(new Error("Canvas压缩失败"))}),"image/jpeg",.6)}catch(l){console.error("Canvas压缩过程出错:",l),t(l)}},e.onerror=function(){t(new Error("图片加载失败"))},e.src=n.originalPath}))},updateImageList:function(n){var r=this.imageList,t=r.concat(n);this.setData({imageList:t})},removeImage:function(n){var r=n.currentTarget.dataset.index,t=this.imageList;t.splice(r,1),this.setData({imageList:t}),this.checkCanPublish()},submitPost:function(){if(this.canPublish){var n=this.title&&this.title.trim(),r=this.content&&this.content.trim();if(!n||r){if("poem"===this.publishMode&&!this.isOriginal){var t=this.author&&this.author.trim();if(!t)return void uni.showToast({title:"非原创诗歌必须填写作者",icon:"none"})}console.log("提交帖子:",{imageList:this.imageList,title:this.title,content:this.content}),"poem"!==this.publishMode||this.isOriginal?(uni.showLoading({title:"发布中..."}),this.imageList.length>0?this.uploadImagesAndSubmit():this.submitTextOnly()):this.checkDuplicatePoem()}else uni.showToast({title:"请输入正文内容",icon:"none"})}else uni.showToast({title:"请至少上传图片或输入内容",icon:"none"})},checkDuplicatePoem:function(){var n=this;uni.showLoading({title:"检查中..."}),this.callCloudFunction("checkDuplicatePoem",{title:this.title.trim(),author:this.author.trim(),isOriginal:this.isOriginal}).then((function(r){uni.hideLoading(),console.log("重复检查结果:",r.result),r.result.success?r.result.isDuplicate?n.showDuplicateConfirmDialog(r.result.duplicateCount):n.proceedWithPublish():uni.showToast({title:"检查失败，请重试",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("检查重复失败:",n),uni.showToast({title:"网络错误，请重试",icon:"none"})}))},showDuplicateConfirmDialog:function(n){var r=this;uni.showModal({title:"发现重复诗歌",content:"已有 ".concat(n," 篇相同的诗歌发布，是否继续发布？"),confirmText:"继续发布",cancelText:"取消发布",success:function(n){n.confirm?r.proceedWithPublish():console.log("用户取消发布重复诗歌")}})},proceedWithPublish:function(){uni.showLoading({title:"发布中..."}),this.imageList.length>0?this.uploadImagesAndSubmit():this.submitTextOnly()},uploadImagesAndSubmit:function(){var n=this,r=(new Date).getTime(),t=this.imageList;console.log("开始上传图片:",t.length+"张");var e=t.map((function(t,e){return new Promise((function(a,o){var s=r+e,l="post_images/".concat(s,"_compressed.jpg");n.uploadFile(l,t.compressedPath).then((function(r){console.log("压缩图上传成功:",r),console.log("压缩图fileID:",r.fileID),console.log("压缩图fileID类型:",(0,i.default)(r.fileID));var e=r.fileID;if(t.needCompression){var o="post_images/".concat(s,"_original.jpg");return n.uploadFile(o,t.originalPath).then((function(n){console.log("原图上传成功:",n),console.log("原图fileID:",n.fileID),console.log("原图fileID类型:",(0,i.default)(n.fileID)),a({compressedUrl:e,originalUrl:n.fileID})}))}a({compressedUrl:e,originalUrl:e})})).catch(o)}))}));Promise.all(e).then((function(r){return console.log("所有图片上传完成:",r),n.submitWithContentCheck(r)})).catch((function(r){console.error("上传失败:",r),n.publishFail(r)}))},submitToDatabase:function(n){var r=this;console.log("提交到数据库:",{uploadResults:n,title:this.title,content:this.content,publishMode:this.publishMode,isOriginal:this.isOriginal}),console.log("uploadResults详细信息:",n),console.log("uploadResults长度:",n.length);var t=n.map((function(n){return n.compressedUrl})),e=n.map((function(n){return n.originalUrl}));console.log("处理后的图片URLs:",{imageUrls:t,originalImageUrls:e,imageUrlsType:t.map((function(n){return(0,i.default)(n)})),originalImageUrlsType:e.map((function(n){return(0,i.default)(n)})),imageUrlsValues:t.map((function(n){return n?n.substring(0,50)+"...":"null/undefined"}))});var a="";if("poem"===this.publishMode)if(this.isOriginal){var o=uni.getStorageSync("userInfo"),s=o?o.nickName:"匿名用户";a=this.author&&this.author.trim()?this.author.trim():s}else a=this.author&&this.author.trim()?this.author.trim():"";var l={title:this.title,content:this.content,createTime:new Date,votes:0,isPoem:"poem"===this.publishMode,isOriginal:this.isOriginal,author:a,tags:this.selectedTags||[]};t.length>0&&(l.imageUrl=t[0],l.imageUrls=t,l.originalImageUrl=e[0],l.originalImageUrls=e,"poem"===this.publishMode&&t.length>0&&(l.poemBgImage=t[0]));var c=t.filter((function(n){return n})),u=e.filter((function(n){return n}));console.log("传递给云函数的参数:",{fileIDs:c,originalFileIDs:u,fileIDsLength:c.length,originalFileIDsLength:u.length});var d={title:this.title,content:this.content,fileIDs:c,originalFileIDs:u,publishMode:this.publishMode,isOriginal:this.isOriginal,author:this.author,tags:this.selectedTags||[]};return this.callCloudFunction("contentCheck",d).then((function(n){var t;(console.log("数据库提交成功:",n),n&&n.result&&0===n.result.code)?r.publishSuccess({_id:n.result.postId}):(console.error("云函数返回失败:",n),r.publishFail(new Error((null===(t=n.result)||void 0===t?void 0:t.msg)||"云函数返回失败")))})).catch((function(n){console.error("数据库提交失败:",n),r.publishFail(n)}))},submitTextOnly:function(){this.submitWithContentCheck([])},submitWithContentCheck:function(n){return console.log("开始内容审核和提交:",{uploadResults:n,title:this.title,content:this.content,publishMode:this.publishMode,isOriginal:this.isOriginal,author:this.author,tags:this.selectedTags}),console.log("⚠️ 内容审核已暂时关闭，直接发布内容"),this.submitToDatabase(n)},publishSuccess:function(n){uni.hideLoading(),uni.showToast({title:"发布成功！"});try{uni.setStorageSync("shouldRefreshIndex",!0),uni.setStorageSync("shouldRefreshProfile",!0),uni.setStorageSync("shouldRefreshPoem",!0),uni.setStorageSync("shouldRefreshMountain",!0);var r=getApp(),e=r&&r.globalData&&r.globalData.openid;try{var a=t("80fa"),i=a.emitPostCreated;i(e)}catch(o){e&&uni.$emit&&uni.$emit("post-created",{userId:e})}}catch(o){console.log("CatchClause",o),console.log("CatchClause",o)}this.setData({isPublished:!0}),this.clearDraft(),uni.navigateBack({delta:1})},publishFail:function(n){uni.hideLoading(),console.error("[发布流程] 失败：",n);var r="发布失败";n&&n.message?r="发布失败: ".concat(n.message):n&&n.errMsg&&(r="发布失败: ".concat(n.errMsg)),uni.showModal({title:"发布失败",content:r,showCancel:!1,confirmText:"确定"})},onImageError:function(n){uni.showToast({title:"图片加载失败",icon:"none"}),console.error("图片加载失败",n)},toggleTagSelector:function(){this.setData({showTagSelector:!this.showTagSelector})},selectTag:function(n){var r=n.currentTarget.dataset.tag,t=this.selectedTags;if(t.includes(r)){var e=t.indexOf(r);t.splice(e,1)}else{if(!(t.length<5))return void uni.showToast({title:"最多选择5个标签",icon:"none"});t.push(r)}this.setData({selectedTags:t})},onCustomTagInput:function(n){var r=this,t=n.detail.value;console.log("【标签输入】用户输入:",t),this.setData({customTag:t}),this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout((function(){console.log("【标签搜索】开始搜索匹配标签:",t),r.searchMatchingTags(t)}),300)},addCustomTag:function(){var n=this.customTag.trim();if(n)if(this.selectedTags.includes(n))uni.showToast({title:"标签已存在",icon:"none"});else if(this.selectedTags.length>=5)uni.showToast({title:"最多选择5个标签",icon:"none"});else{var r=[].concat((0,a.default)(this.selectedTags),[n]);this.setData({selectedTags:r,customTag:""})}else uni.showToast({title:"请输入标签",icon:"none"})},removeTag:function(n){var r=n.currentTarget.dataset.tag,t=this.selectedTags.filter((function(n){return n!==r}));this.setData({selectedTags:t})},switchCategory:function(n){var r=n.currentTarget.dataset.index;this.setData({currentCategoryIndex:r})},getCurrentCategoryTags:function(){return this.tagCategories[this.currentCategoryIndex].tags},loadAllExistingTags:function(){var n=this;console.log("【标签加载】开始加载所有已有标签..."),this.callCloudFunction("getAllTags",{}).then((function(r){console.log("【标签加载】云函数返回结果:",r),r.result&&r.result.success?(n.setData({allExistingTags:r.result.tags}),console.log("【标签加载】已加载所有标签:",r.result.tags.length,"个标签:",r.result.tags)):console.error("【标签加载】云函数返回失败:",r.result)})).catch((function(n){console.error("【标签加载】获取标签失败:",n)}))},searchMatchingTags:function(n){var r=this;if(console.log("【标签搜索】搜索参数:",{inputValue:n,inputLength:n?n.length:0,allExistingTags:this.allExistingTags,selectedTags:this.selectedTags}),!n||n.length<2)return console.log("【标签搜索】输入长度不足，清空匹配结果"),void this.setData({matchedTags:[],showMatchedTags:!1});var t=this.allExistingTags;console.log("【标签搜索】开始匹配，总标签数:",t.length);var e=t.filter((function(t){var e=t.toLowerCase().includes(n.toLowerCase()),a=!r.selectedTags.includes(t);return console.log('【标签搜索】检查标签"'.concat(t,'": 匹配=').concat(e,", 未选中=").concat(a)),e&&a})).slice(0,5);console.log("【标签搜索】匹配结果:",e),this.setData({matchedTags:e,showMatchedTags:e.length>0}),console.log("【标签搜索】设置状态:",{matchedTags:e,showMatchedTags:e.length>0})},selectMatchedTag:function(n){var r=n.currentTarget.dataset.tag;if(this.selectedTags.includes(r))uni.showToast({title:"标签已存在",icon:"none"});else if(this.selectedTags.length>=5)uni.showToast({title:"最多选择5个标签",icon:"none"});else{var t=[].concat((0,a.default)(this.selectedTags),[r]);this.setData({selectedTags:t,customTag:"",showMatchedTags:!1,matchedTags:[]})}},hasContent:function(){var n=this.title&&this.title.trim(),r=this.content&&this.content.trim(),t=this.imageList.length>0,e=this.selectedTags.length>0;return n||r||t||e},checkAndSaveDraft:function(){var n=this;this.hasContent()&&uni.showModal({title:"保存草稿",content:"检测到您有未完成的内容，是否保存为草稿？",confirmText:"保存",cancelText:"不保存",success:function(r){r.confirm?n.saveDraft():n.clearDraft()}})},saveDraft:function(){var n=this,r={title:this.title,content:this.content,imageList:this.imageList,publishMode:this.publishMode,isOriginal:this.isOriginal,selectedTags:this.selectedTags,customTag:this.customTag,author:this.author,saveTime:new Date};uni.showLoading({title:"保存中..."}),this.callCloudFunction("getMyProfileData",{action:"saveDraft",draftData:r}).then((function(r){var t;(uni.hideLoading(),r.result&&r.result.success)?(uni.showToast({title:"草稿已保存",icon:"success"}),n.clearDraft()):(console.error("保存草稿失败:",r.result),uni.showToast({title:(null===(t=r.result)||void 0===t?void 0:t.message)||"保存草稿失败",icon:"none"}))})).catch((function(n){uni.hideLoading(),console.error("保存草稿失败:",n),uni.showToast({title:"网络错误，保存失败",icon:"none"})}))},loadDraft:function(){var n=this;try{var r=uni.getStorageSync("publish_draft");if(r&&r.saveTime){var t=(new Date).getTime(),e=t-r.saveTime;e<6048e5?uni.showModal({title:"恢复草稿",content:"检测到您有未完成的草稿，是否恢复？",confirmText:"恢复",cancelText:"重新开始",success:function(t){t.confirm?(n.setData({title:r.title||"",content:r.content||"",imageList:r.imageList||[],publishMode:r.publishMode||"normal",isOriginal:r.isOriginal||!1,selectedTags:r.selectedTags||[],customTag:r.customTag||"",author:r.author||"",maxImageCount:"poem"===r.publishMode?1:9}),n.checkCanPublish(),uni.showToast({title:"草稿已恢复",icon:"success"})):n.clearDraft()}}):this.clearDraft()}}catch(a){console.log("CatchClause",a),console.log("CatchClause",a),console.error("加载草稿失败:",a)}},loadEditingDraft:function(){try{var n=uni.getStorageSync("editing_draft");n&&(this.setData({title:n.title||"",content:n.content||"",imageList:n.imageList||[],publishMode:n.publishMode||"normal",isOriginal:n.isOriginal||!1,selectedTags:n.selectedTags||[],customTag:n.customTag||"",author:n.author||"",maxImageCount:"poem"===n.publishMode?1:9}),this.checkCanPublish(),uni.showToast({title:"草稿已加载",icon:"success"}),uni.removeStorageSync("editing_draft"))}catch(r){console.log("CatchClause",r),console.log("CatchClause",r),console.error("加载编辑草稿失败:",r),uni.showToast({title:"加载草稿失败",icon:"none"})}},clearDraft:function(){try{uni.removeStorageSync("publish_draft")}catch(n){console.log("CatchClause",n),console.log("CatchClause",n),console.error("清除草稿失败:",n)}}}};r.default=l},"967d":function(n,r,t){"use strict";function e(n,r){for(var t=[],e={},a=0;a<r.length;a++){var i=r[a],o=i[0],s=i[1],l=i[2],c=i[3],u={id:n+":"+a,css:s,media:l,sourceMap:c};e[o]?e[o].parts.push(u):t.push(e[o]={id:o,parts:[u]})}return t}t.r(r),t.d(r,"default",(function(){return g}));var a="undefined"!==typeof document;if("undefined"!==typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},o=a&&(document.head||document.getElementsByTagName("head")[0]),s=null,l=0,c=!1,u=function(){},d=null,h="undefined"!==typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function g(n,r,t,a){c=t,d=a||{};var o=e(n,r);return f(o),function(r){for(var t=[],a=0;a<o.length;a++){var s=o[a],l=i[s.id];l.refs--,t.push(l)}r?(o=e(n,r),f(o)):o=[];for(a=0;a<t.length;a++){l=t[a];if(0===l.refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete i[l.id]}}}}function f(n){for(var r=0;r<n.length;r++){var t=n[r],e=i[t.id];if(e){e.refs++;for(var a=0;a<e.parts.length;a++)e.parts[a](t.parts[a]);for(;a<t.parts.length;a++)e.parts.push(m(t.parts[a]));e.parts.length>t.parts.length&&(e.parts.length=t.parts.length)}else{var o=[];for(a=0;a<t.parts.length;a++)o.push(m(t.parts[a]));i[t.id]={id:t.id,refs:1,parts:o}}}}function p(){var n=document.createElement("style");return n.type="text/css",o.appendChild(n),n}function m(n){var r,t,e=document.querySelector('style[data-vue-ssr-id~="'+n.id+'"]');if(e){if(c)return u;e.parentNode.removeChild(e)}if(h){var a=l++;e=s||(s=p()),r=b.bind(null,e,a,!1),t=b.bind(null,e,a,!0)}else e=p(),r=w.bind(null,e),t=function(){e.parentNode.removeChild(e)};return r(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap)return;r(n=e)}else t()}}var v=function(){var n=[];return function(r,t){return n[r]=t,n.filter(Boolean).join("\n")}}();function b(n,r,t,e){var a=t?"":S(e.css);if(n.styleSheet)n.styleSheet.cssText=v(r,a);else{var i=document.createTextNode(a),o=n.childNodes;o[r]&&n.removeChild(o[r]),o.length?n.insertBefore(i,o[r]):n.appendChild(i)}}function w(n,r){var t=S(r.css),e=r.media,a=r.sourceMap;if(e&&n.setAttribute("media",e),d.ssrId&&n.setAttribute("data-vue-ssr-id",r.id),a&&(t+="\n/*# sourceURL="+a.sources[0]+" */",t+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),n.styleSheet)n.styleSheet.cssText=t;else{while(n.firstChild)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(t))}}var C=/%\?([+-]?\d+(\.\d+)?)\?%/g,T=/\.\?%PAGE\?%/g,x=/\?%PAGE\?%\[data-v-[a-z0-9]{8}\]/g,y=/uni-page-body\[data-v-[a-z0-9]{8}\]/g,k=/var\(--status-bar-height\)/gi,D=/var\(--window-top\)/gi,P=/var\(--window-bottom\)/gi,I=/var\(--window-left\)/gi,M=/var\(--window-right\)/gi;function S(n){var r=function(){var n="function"===typeof getApp&&getApp();return n&&n.$route&&n.$route.meta&&n.$route.meta.name||""}();if("undefined"!==typeof uni&&!uni.canIUse("css.var")){var t=function(){var n="function"===typeof getApp&&getApp();if(n&&n.$route&&n.$route.meta&&n.$route.meta.name)return{top:n.$route.meta.windowTop,bottom:n.$route.meta.isTabBar?50:0};return{top:0,bottom:0}}();n=n.replace(k,"0px").replace(D,t.top+"px").replace(P,t.bottom+"px").replace(I,"0px").replace(M,"0px")}return n.replace(x,r).replace(T,"").replace(y,"body."+r+" uni-page-body").replace(/\{[\s\S]+?\}|@media.+?\{/g,(function(n){return"undefined"===typeof uni?n:n.replace(C,(function(n,r){return uni.upx2px(r)+"px"}))}))}},"979d":function(n,r,t){"use strict";t.r(r);var e=t("6e3f"),a=t.n(e);for(var i in e)["default"].indexOf(i)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(i);r["default"]=a.a},b614:function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* pages/add/add.wxss */uni-page-body[data-v-7fa41c58]{height:100vh;overflow:hidden /* 页面级别禁止滚动 */}.container[data-v-7fa41c58]{background:#fff;height:100vh; /* 改为固定高度，确保在iOS下正确计算 */display:flex;flex-direction:column;padding-bottom:%?120?%; /* 为底部工具栏留出空间，避免内容被遮挡 */box-sizing:border-box; /* 确保padding计算在内 */overflow:hidden; /* 防止整个页面滚动 */position:relative; /* 确保定位上下文 */transition:padding-bottom .3s ease-out /* 为 padding 变化添加过渡 */}\r\n/* 发布按钮样式 */.publish-btn[data-v-7fa41c58]{background:#e0e0e0;color:#999;padding:%?16?% %?32?%;border-radius:%?50?%;font-size:%?28?%;transition:all .3s ease;margin-left:auto}.publish-btn.active[data-v-7fa41c58]{background:#9ed7ee;color:#fff}\r\n/* 图片预览区域 */.image-section[data-v-7fa41c58]{padding:%?30?%;background:#f8f9fa}.image-preview-scroll[data-v-7fa41c58]{width:100%;white-space:nowrap}.image-preview-container[data-v-7fa41c58]{display:flex;gap:%?20?%;padding:0 %?10?%}.image-preview-item[data-v-7fa41c58]{position:relative;width:%?200?%;height:%?200?%;border-radius:%?12?%;overflow:hidden;flex-shrink:0}.preview-image[data-v-7fa41c58]{width:100%;height:100%;border-radius:%?12?%}.image-remove-btn[data-v-7fa41c58]{position:absolute;top:%?-8?%;right:%?-8?%;width:%?40?%;height:%?40?%;background:#f44;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:%?24?%;font-weight:700;box-shadow:0 %?2?% %?8?% rgba(0,0,0,.2)}.add-image-btn[data-v-7fa41c58]{width:%?200?%;height:%?200?%;border:%?2?% dashed #ddd;border-radius:%?12?%;display:flex;align-items:center;justify-content:center;background:#fff;transition:all .3s ease;flex-shrink:0}.add-image-btn[data-v-7fa41c58]:active{background:#f5f5f5;border-color:#9ed7ee}.add-icon[data-v-7fa41c58]{font-size:%?60?%;color:#999}\r\n/* 内容输入区域 */.content-section[data-v-7fa41c58]{padding:%?30?%;padding-bottom:%?30?%; /* 进一步减少底部间距，让输入框更接近底部工具栏 */background:#fff;flex:1;display:flex;flex-direction:column;min-height:0; /* 关键：允许flex子元素收缩 */overflow:hidden; /* 防止内容溢出 */position:relative /* 确保定位上下文 */}.title-input-wrapper[data-v-7fa41c58]{margin-bottom:%?30?%}.title-input[data-v-7fa41c58]{width:100%;height:%?80?%;border:none;border-bottom:%?1?% solid #f0f0f0;font-size:%?32?%;padding:0;background:transparent}.title-input[data-v-7fa41c58]:focus{border-bottom-color:#2897ad}.content-input-wrapper[data-v-7fa41c58]{position:relative;flex:1;display:flex;flex-direction:column;margin-bottom:%?0?%; /* 最小化底部间距，让输入框更接近底边栏 */min-height:0; /* 关键：允许flex子元素收缩 */overflow:hidden /* 防止内容溢出 */}.content-textarea[data-v-7fa41c58]{flex:1;width:100%;height:100%; /* 固定高度，填充父容器 */border:none;font-size:%?30?%;line-height:1.6;padding:0;background:transparent;resize:none;overflow-y:auto; /* 允许垂直滚动 */overflow-x:hidden; /* 禁止水平滚动 */-webkit-appearance:none;appearance:none;-webkit-box-sizing:border-box;box-sizing:border-box;\r\n    /* 确保在iOS上正确显示 */-webkit-user-select:text;user-select:text;-webkit-touch-callout:default;\r\n    /* 防止iOS上的默认样式干扰 */border-radius:0;outline:none;\r\n    /* 确保滚动行为 */-webkit-overflow-scrolling:touch; /* iOS平滑滚动 */position:relative /* 确保定位上下文 */}.char-count[data-v-7fa41c58]{position:absolute;bottom:%?10?%; /* 移到textarea外面，给文字留出空间 */right:0;font-size:%?24?%;color:#666;background:#fdfdfd;padding:%?8?% %?12?%;border-radius:%?6?%;box-shadow:none;pointer-events:none /* 防止遮挡textarea的点击 */}\r\n/* 作者输入区域样式 */.author-input-wrapper[data-v-7fa41c58]{margin-bottom:%?30?%}.author-input[data-v-7fa41c58]{width:100%;height:%?80?%;border:none;border-bottom:%?1?% solid #f0f0f0;font-size:%?32?%;padding:0;background:transparent}.author-input[data-v-7fa41c58]:focus{border-bottom-color:#9ed7ee}\r\n/* 写诗子菜单 */.poem-submenu[data-v-7fa41c58]{position:fixed;bottom:%?120?%;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);background:#fff;border-radius:%?12?%;padding:%?20?%;display:flex;gap:%?40?%;z-index:99;box-shadow:0 %?-4?% %?20?% rgba(0,0,0,.1);-webkit-animation:slideUp-data-v-7fa41c58 .3s ease;animation:slideUp-data-v-7fa41c58 .3s ease;border:%?1?% solid #f0f0f0;margin-left:%?-98?% /* 向左偏移，对齐写诗按钮 */}.submenu-item[data-v-7fa41c58]{display:flex;flex-direction:column;align-items:center;padding:%?10?%;transition:all .3s ease}.submenu-item[data-v-7fa41c58]:active{-webkit-transform:scale(.95);transform:scale(.95)}.submenu-icon[data-v-7fa41c58]{font-size:%?40?%;margin-bottom:%?8?%}.submenu-text[data-v-7fa41c58]{font-size:%?22?%;color:#666}@-webkit-keyframes slideUp-data-v-7fa41c58{from{-webkit-transform:translateX(-50%) translateY(100%);transform:translateX(-50%) translateY(100%);opacity:0}to{-webkit-transform:translateX(-50%) translateY(0);transform:translateX(-50%) translateY(0);opacity:1}}@keyframes slideUp-data-v-7fa41c58{from{-webkit-transform:translateX(-50%) translateY(100%);transform:translateX(-50%) translateY(100%);opacity:0}to{-webkit-transform:translateX(-50%) translateY(0);transform:translateX(-50%) translateY(0);opacity:1}}\r\n/* 底部工具栏 */.toolbar[data-v-7fa41c58]{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:%?1?% solid #f0f0f0;padding:%?20?% %?30?%;display:flex;align-items:center;gap:%?40?%;z-index:100;transition:bottom .3s ease-out /* 为位置变化添加过渡 */}.toolbar-item[data-v-7fa41c58]{display:flex;flex-direction:column;align-items:center;padding:%?10?%;transition:all .3s ease}.toolbar-item[data-v-7fa41c58]:active{-webkit-transform:scale(.95);transform:scale(.95)}.toolbar-icon[data-v-7fa41c58]{font-size:%?40?%;margin-bottom:%?8?%}.toolbar-text[data-v-7fa41c58]{font-size:%?22?%;color:#666}\r\n/* 标签选择区域样式 */.tag-section[data-v-7fa41c58]{position:fixed; /* 确保标签选择器是基于窗口定位的 */bottom:%?120?%; /* 初始位置在工具栏上方 */left:0;right:0;background:#f8f9fa;border-radius:%?12?%;padding:%?20?%;z-index:90; /* z-index 比工具栏低，但比内容高 */transition:bottom .3s ease-out /* 为位置变化添加过渡 */}.tag-header[data-v-7fa41c58]{display:flex;justify-content:space-between;align-items:center;padding:%?10?% 0;border-bottom:1px solid #eee;margin-bottom:%?20?%}.tag-title[data-v-7fa41c58]{font-size:%?30?%;font-weight:700;color:#333}.tag-count[data-v-7fa41c58]{font-size:%?24?%;color:#999}.tag-toggle[data-v-7fa41c58]{font-size:%?26?%;color:#9ed7ee}.selected-tags[data-v-7fa41c58]{display:flex;flex-wrap:wrap;gap:%?10?%;margin-bottom:%?20?%}.selected-tag[data-v-7fa41c58]{display:flex;align-items:center;background:#9ed7ee;color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%}.remove-tag[data-v-7fa41c58]{margin-left:%?8?%;font-size:%?20?%;font-weight:700;cursor:pointer}.tag-selector[data-v-7fa41c58]{-webkit-animation:slideDown-data-v-7fa41c58 .3s ease;animation:slideDown-data-v-7fa41c58 .3s ease}\r\n/* 分类选择器样式 */.category-selector[data-v-7fa41c58]{margin-bottom:%?20?%;border-bottom:1px solid #eee;padding-bottom:%?15?%}.category-scroll[data-v-7fa41c58]{width:100%;white-space:nowrap}.category-list[data-v-7fa41c58]{display:flex;gap:%?15?%;padding:0 %?10?%}.category-item[data-v-7fa41c58]{display:flex;flex-direction:column;align-items:center;padding:%?10?% %?15?%;border-radius:%?12?%;background:#f5f5f5;transition:all .3s ease;min-width:%?80?%;flex-shrink:0}.category-item.active[data-v-7fa41c58]{background:#9ed7ee;color:#fff}.category-icon[data-v-7fa41c58]{font-size:%?24?%;margin-bottom:%?5?%}.category-name[data-v-7fa41c58]{font-size:%?20?%;text-align:center;line-height:1.2}\r\n/* 当前分类标签样式 */.current-category-tags[data-v-7fa41c58]{display:flex;flex-wrap:wrap;gap:%?10?%;margin-bottom:%?20?%}.preset-tag[data-v-7fa41c58]{padding:%?8?% %?16?%;background:#fff;border:1px solid #ddd;border-radius:%?20?%;font-size:%?24?%;color:#666;transition:all .3s ease}.preset-tag.selected[data-v-7fa41c58]{background:#9ed7ee;color:#fff;border-color:#9ed7ee}.custom-tag-input[data-v-7fa41c58]{display:flex;align-items:center;gap:%?10?%}.custom-tag-input uni-input[data-v-7fa41c58]{flex:1;height:%?60?%;border:1px solid #ddd;border-radius:%?8?%;padding:0 %?15?%;font-size:%?26?%}.custom-tag-input uni-button[data-v-7fa41c58]{background:#9ed7ee;color:#fff;border:none;border-radius:%?8?%;padding:0 %?20?%;height:%?60?%;font-size:%?24?%}\r\n/* 匹配标签推荐样式 */.matched-tags[data-v-7fa41c58]{margin-top:%?15?%;padding:%?15?%;background:#f8f9fa;border-radius:%?8?%;border:1px solid #e9ecef}.matched-tags-title[data-v-7fa41c58]{font-size:%?24?%;color:#666;margin-bottom:%?10?%}.matched-tags-list[data-v-7fa41c58]{display:flex;flex-wrap:wrap;gap:%?8?%}.matched-tag[data-v-7fa41c58]{background:#e3f2fd;color:#1976d2;padding:%?6?% %?12?%;border-radius:%?12?%;font-size:%?22?%;border:1px solid #bbdefb;transition:all .2s ease}.matched-tag[data-v-7fa41c58]:active{background:#bbdefb;-webkit-transform:scale(.95);transform:scale(.95)}@-webkit-keyframes slideDown-data-v-7fa41c58{from{opacity:0;-webkit-transform:translateY(%?-10?%);transform:translateY(%?-10?%)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes slideDown-data-v-7fa41c58{from{opacity:0;-webkit-transform:translateY(%?-10?%);transform:translateY(%?-10?%)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}",""]),n.exports=r},c26f:function(n,r,t){"use strict";t.d(r,"b",(function(){return e})),t.d(r,"c",(function(){return a})),t.d(r,"a",(function(){}));var e=function(){var n=this,r=n.$createElement,t=n._self._c||r;return t("v-uni-view",{staticClass:"container",style:"padding-bottom: calc(120rpx + "+n.keyboardHeight+"px);"},[n.imageList.length>0?t("v-uni-view",{staticClass:"image-section"},[t("v-uni-scroll-view",{staticClass:"image-preview-scroll",attrs:{"scroll-x":!0,"show-scrollbar":!1}},[t("v-uni-view",{staticClass:"image-preview-container"},[n._l(n.imageList,(function(r,e){return t("v-uni-view",{key:e,staticClass:"image-preview-item"},[t("v-uni-image",{staticClass:"preview-image",attrs:{src:r.previewUrl,mode:"aspectFill"},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onImageError.apply(void 0,arguments)}}}),t("v-uni-view",{staticClass:"image-remove-btn",attrs:{"data-index":e},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.removeImage.apply(void 0,arguments)}}},[n._v("×")])],1)})),n.imageList.length<n.maxImageCount?t("v-uni-view",{staticClass:"add-image-btn",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.handleChooseImage.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"add-icon"},[n._v("+")])],1):n._e()],2)],1)],1):n._e(),t("v-uni-view",{staticClass:"content-section"},[t("v-uni-view",{staticClass:"title-input-wrapper"},[t("v-uni-input",{staticClass:"title-input",attrs:{placeholder:"标题",maxlength:"50",value:n.title},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onTitleInput.apply(void 0,arguments)}}})],1),"poem"===n.publishMode?t("v-uni-view",{staticClass:"author-input-wrapper"},[t("v-uni-input",{staticClass:"author-input",attrs:{placeholder:n.isOriginal?"作者（可选，不填默认使用您的昵称）":"作者（必填）",maxlength:"20",value:n.author},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onAuthorInput.apply(void 0,arguments)}}})],1):n._e(),t("v-uni-view",{staticClass:"content-input-wrapper"},[t("v-uni-textarea",{staticClass:"content-textarea",attrs:{placeholder:"此刻你想要分享...",maxlength:"1500",value:n.content,"show-confirm-bar":!1,"adjust-position":!1},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onContentInput.apply(void 0,arguments)},focus:function(r){arguments[0]=r=n.$handleEvent(r),n.onTextareaFocus.apply(void 0,arguments)},blur:function(r){arguments[0]=r=n.$handleEvent(r),n.onTextareaBlur.apply(void 0,arguments)},click:function(r){arguments[0]=r=n.$handleEvent(r),n.onTextareaTap.apply(void 0,arguments)}}}),n.content.length>1400?t("v-uni-view",{staticClass:"char-count"},[n._v(n._s(n.content.length)+"/1500")]):n._e()],1)],1),n.showPoemSubmenu?t("v-uni-view",{staticClass:"poem-submenu"},[t("v-uni-view",{staticClass:"submenu-item",attrs:{"data-original":!0},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.selectPoemMode.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"submenu-icon"},[n._v("✨")]),t("v-uni-view",{staticClass:"submenu-text"},[n._v("原创")])],1),t("v-uni-view",{staticClass:"submenu-item",attrs:{"data-original":!1},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.selectPoemMode.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"submenu-icon"},[n._v("📖")]),t("v-uni-view",{staticClass:"submenu-text"},[n._v("非原创")])],1)],1):n._e(),t("v-uni-view",{staticClass:"toolbar",style:"bottom: "+n.keyboardHeight+"px;"},[t("v-uni-view",{staticClass:"toolbar-item",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.handleChooseImage.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"toolbar-icon"},[n._v("📷")]),t("v-uni-view",{staticClass:"toolbar-text"},[n._v("图片")])],1),t("v-uni-view",{staticClass:"toolbar-item",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.toggleTagSelector.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"toolbar-icon"},[n._v("#")]),t("v-uni-view",{staticClass:"toolbar-text"},[n._v("标签")])],1),t("v-uni-view",{staticClass:"toolbar-item",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.switchMode.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"toolbar-icon"},[n._v(n._s("normal"===n.publishMode?"📝":"🎭"))]),t("v-uni-view",{staticClass:"toolbar-text"},[n._v(n._s("normal"===n.publishMode?"写诗":"普通"))])],1),t("v-uni-view",{class:"publish-btn "+(n.canPublish?"active":""),on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.submitPost.apply(void 0,arguments)}}},[n._v("发布")])],1),n.showTagSelector?t("v-uni-view",{staticClass:"tag-section",style:"bottom: calc(120rpx + "+n.keyboardHeight+"px);"},[t("v-uni-view",{staticClass:"tag-header"},[t("v-uni-text",{staticClass:"tag-title"},[n._v("添加标签")]),t("v-uni-text",{staticClass:"tag-count"},[n._v(n._s(n.selectedTags.length)+"/5")]),t("v-uni-text",{staticClass:"tag-toggle",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.toggleTagSelector.apply(void 0,arguments)}}},[n._v("收起")])],1),n.selectedTags.length>0?t("v-uni-view",{staticClass:"selected-tags"},n._l(n.selectedTags,(function(r,e){return t("v-uni-view",{key:e,staticClass:"selected-tag"},[t("v-uni-text",[n._v(n._s(r))]),t("v-uni-text",{staticClass:"remove-tag",attrs:{"data-tag":r},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.removeTag.apply(void 0,arguments)}}},[n._v("×")])],1)})),1):n._e(),n.showTagSelector?t("v-uni-view",{staticClass:"tag-selector"},[t("v-uni-view",{staticClass:"category-selector"},[t("v-uni-scroll-view",{staticClass:"category-scroll",attrs:{"scroll-x":!0,"show-scrollbar":!1}},[t("v-uni-view",{staticClass:"category-list"},n._l(n.tagCategories,(function(r,e){return t("v-uni-view",{key:e,class:"category-item "+(n.currentCategoryIndex===e?"active":""),attrs:{"data-index":e},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.switchCategory.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"category-icon"},[n._v(n._s(r.icon))]),t("v-uni-text",{staticClass:"category-name"},[n._v(n._s(r.name))])],1)})),1)],1)],1),t("v-uni-view",{staticClass:"current-category-tags"},n._l(n.tagCategories[n.currentCategoryIndex].tags,(function(r,e){return t("v-uni-view",{key:e,class:"preset-tag "+(n.selectedTags.includes(r)?"selected":""),attrs:{"data-tag":r},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.selectTag.apply(void 0,arguments)}}},[n._v(n._s(r))])})),1),t("v-uni-view",{staticClass:"custom-tag-input"},[t("v-uni-input",{attrs:{placeholder:"输入自定义标签",value:n.customTag,maxlength:"10"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onCustomTagInput.apply(void 0,arguments)}}}),t("v-uni-button",{attrs:{size:"mini"},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.addCustomTag.apply(void 0,arguments)}}},[n._v("添加")])],1),n.showMatchedTags&&n.matchedTags.length>0?t("v-uni-view",{staticClass:"matched-tags"},[t("v-uni-view",{staticClass:"matched-tags-title"},[n._v("推荐标签：")]),t("v-uni-view",{staticClass:"matched-tags-list"},n._l(n.matchedTags,(function(r,e){return t("v-uni-view",{key:e,staticClass:"matched-tag",attrs:{"data-tag":r},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.selectMatchedTag.apply(void 0,arguments)}}},[n._v(n._s(r))])})),1)],1):n._e()],1):n._e()],1):n._e()],1)},a=[]},c86c:function(n,r,t){"use strict";n.exports=function(n){var r=[];return r.toString=function(){return this.map((function(r){var t=function(n,r){var t=n[1]||"",e=n[3];if(!e)return t;if(r&&"function"===typeof btoa){var a=function(n){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),t="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r);return"/*# ".concat(t," */")}(e),i=e.sources.map((function(n){return"/*# sourceURL=".concat(e.sourceRoot||"").concat(n," */")}));return[t].concat(i).concat([a]).join("\n")}return[t].join("\n")}(r,n);return r[2]?"@media ".concat(r[2]," {").concat(t,"}"):t})).join("")},r.i=function(n,t,e){"string"===typeof n&&(n=[[null,n,""]]);var a={};if(e)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(a[o]=!0)}for(var s=0;s<n.length;s++){var l=[].concat(n[s]);e&&a[l[0]]||(t&&(l[2]?l[2]="".concat(t," and ").concat(l[2]):l[2]=t),r.push(l))}},r}}}]);