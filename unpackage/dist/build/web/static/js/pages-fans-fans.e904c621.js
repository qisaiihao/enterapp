(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-fans-fans"],{"2d52":function(t,e,a){var n=a("c86c");e=n(!1),e.push([t.i,".container[data-v-1d33956d]{padding:%?32?%;background-color:#f7f8fa;min-height:100vh}.list[data-v-1d33956d]{display:flex;flex-direction:column;gap:%?24?%}.fan-item[data-v-1d33956d]{display:flex;align-items:center;justify-content:space-between;background-color:#fff;border-radius:%?16?%;padding:%?24?% %?28?%;box-shadow:0 %?6?% %?18?% rgba(0,0,0,.05)}.user-info[data-v-1d33956d]{display:flex;align-items:center;flex:1;gap:%?20?%;overflow:hidden}.avatar[data-v-1d33956d]{width:%?88?%;height:%?88?%;border-radius:50%;background-color:#f0f0f0}.info-text[data-v-1d33956d]{display:flex;flex-direction:column;gap:%?8?%;overflow:hidden}.name[data-v-1d33956d]{font-size:%?30?%;color:#333;font-weight:600}.bio[data-v-1d33956d]{font-size:%?24?%;color:#888;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:%?420?%}.follow-time[data-v-1d33956d]{font-size:%?22?%;color:#b0b0b0}.mutual-label[data-v-1d33956d]{display:inline-block;margin-top:%?4?%;padding:%?4?% %?16?%;border-radius:%?999?%;font-size:%?24?%;background-color:#e6f4ff;color:#1f6fd2}.follow-btn[data-v-1d33956d]{margin-left:%?24?%;border:none;background-color:#9ed7ee;color:#fff;border-radius:%?999?%;padding:0 %?28?%;height:%?64?%!important;line-height:%?64?%!important}.follow-btn.following[data-v-1d33956d]{background-color:#f0f0f0;color:#666}.follow-btn[data-v-1d33956d]::after{border:none}.follow-btn[disabled][data-v-1d33956d]{opacity:.6}.loading[data-v-1d33956d],\r\n.loading-more[data-v-1d33956d]{margin-top:%?32?%;text-align:center;color:#999;font-size:%?26?%}.empty[data-v-1d33956d]{margin-top:%?120?%;text-align:center;color:#999;font-size:%?28?%}.footer-hint[data-v-1d33956d]{margin-top:%?24?%}",""]),t.exports=e},"5901f":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){}));var n=function(){var t=this.$createElement,e=this._self._c||t;return e("v-uni-view",{staticClass:"container"},[this.fans.length>0?e("v-uni-view",{staticClass:"footer-hint"},[this.hasMore?this._e():e("v-uni-view",{staticClass:"loading-more"},[this._v("已经到底啦")])],1):this._e()],1)},o=[]},7161:function(t,e,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(a("39d8")),i=n(a("9b1b"));a("bf0f"),a("fd3c"),a("c223");var r=a("962f"),s=r.formatRelativeTime,l=a("38db"),d=l.cloudCall,c={data:function(){return{fans:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:20,pendingOpenid:null,defaultAvatar:"/images/avatar.png",total:""}},onLoad:function(){this.markFollowNotificationsRead(),this.loadFans(!0)},onPullDownRefresh:function(){this.loadFans(!0)},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadFans()},methods:(0,o.default)({formatTime:void 0,callCloudFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(t,e,Object.assign({pageTag:"fans",context:this,requireAuth:!0},a))},loadFans:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading){e&&(this.setData({page:0,hasMore:!0}),this.markFollowNotificationsRead());var a=e?0:this.page;this.setData({isLoading:!0}),this.callCloudFunction("follow",{action:"getFollowerList",skip:a*this.PAGE_SIZE,limit:this.PAGE_SIZE}).then((function(n){if(n.result&&n.result.success){var o=n.result.list||[],r=o.map((function(e){return(0,i.default)((0,i.default)({},e),{},{followedAtText:e.followedAt?t.formatTime(e.followedAt):""})})),s=e?r:t.fans.concat(r);t.setData({fans:s,page:a+1,hasMore:!!n.result.hasMore,total:n.result.total||s.length})}else uni.showToast({title:n.result&&n.result.message?n.result.message:"加载失败",icon:"none"})})).catch((function(t){console.error("获取粉丝列表失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),e&&uni.stopPullDownRefresh()}))}},markFollowNotificationsRead:function(){this.callCloudFunction("follow",{action:"markFollowNotificationsRead"}).catch((function(t){console.error("标记关注消息已读失败:",t)}))},onToggleFollow:function(t){var e=this,a=t.currentTarget.dataset.openid,n=t.currentTarget.dataset.index;a&&void 0!==n&&!this.pendingOpenid&&(this.setData({pendingOpenid:a}),this.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:a}).then((function(t){if(t.result&&t.result.success){var i=!!t.result.isFollowing;e.setData((0,o.default)({},"fans[".concat(n,"].isMutual"),i)),uni.showToast({title:i?"关注成功":"已取消关注",icon:"success"}),e.refreshFanStatus(a,n)}else uni.showToast({title:t.result&&t.result.message?t.result.message:"操作失败",icon:"none"})})).catch((function(t){console.error("操作粉丝关注状态失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){e.setData({pendingOpenid:null})})))},refreshFanStatus:function(t,e){var a=this;this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:t}).then((function(t){t.result&&t.result.success&&a.setData((0,o.default)({},"fans[".concat(e,"].isMutual"),!!t.result.isMutual))})).catch((function(t){console.error("刷新粉丝状态失败:",t)}))},onAvatarError:function(t){var e=t.currentTarget.dataset.index;void 0!==e&&this.setData((0,o.default)({},"fans[".concat(e,"].avatarUrl"),this.defaultAvatar))},openUserProfile:function(t){var e=t.currentTarget.dataset.openid;e&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(e)})}},"formatTime",(function(t){return s(t)}))};e.default=c},"73e1":function(t,e,a){"use strict";var n=a("29d8");t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(n)},"795c":function(t,e,a){"use strict";var n=a("8bdb"),o=a("db04").start,i=a("73e1");n({target:"String",proto:!0,forced:i},{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},8692:function(t,e,a){"use strict";a.r(e);var n=a("5901f"),o=a("b5a1");for(var i in o)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return o[t]}))}(i);a("fb9d");var r=a("828b"),s=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,"1d33956d",null,!1,n["a"],void 0);e["default"]=s.exports},"962f":function(t,e,a){a("795c"),a("64aa"),a("5c47"),a("a1c1"),a("c223"),a("f7a5");var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(t).padStart(e,"0")},o=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",a=t instanceof Date?t:new Date(t);if(Number.isNaN(a.getTime()))return"";var o={yyyy:String(a.getFullYear()),MM:n(a.getMonth()+1),dd:n(a.getDate()),HH:n(a.getHours()),mm:n(a.getMinutes()),ss:n(a.getSeconds())};return e.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(t){return o[t]}))};t.exports={formatTimeAgo:function(t){var e=new Date,a=new Date(t),n=e.getTime()-a.getTime(),o=Math.floor(n/1e3),i=Math.floor(o/60),r=Math.floor(i/60),s=Math.floor(r/24);if(s>=7){var l=a.getFullYear(),d=("0"+(a.getMonth()+1)).slice(-2),c=("0"+a.getDate()).slice(-2);return"".concat(l,"-").concat(d,"-").concat(c)}return s>=1?"".concat(s,"天前"):r>=1?"".concat(r,"小时前"):i>=1?"".concat(i,"分钟前"):"刚刚"},formatRelativeTime:function(t){var e=Date.now(),a=t instanceof Date?t.getTime():new Date(t).getTime();if(Number.isNaN(a))return"";var n=e-a,i=Math.floor(Math.abs(n)/1e3),r=n>=0?"前":"后";if(i<60)return"刚刚";var s=Math.floor(i/60);if(s<60)return"".concat(s,"分钟").concat(r);var l=Math.floor(s/60);if(l<24)return"".concat(l,"小时").concat(r);var d=Math.floor(l/24);return d<7?"".concat(d,"天").concat(r):o(a,"yyyy-MM-dd")},formatDate:o}},b5a1:function(t,e,a){"use strict";a.r(e);var n=a("7161"),o=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=o.a},c84f:function(t,e,a){var n=a("2d52");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=a("967d").default;o("5a06b5b6",n,!0,{sourceMap:!1,shadowMode:!1})},db04:function(t,e,a){"use strict";var n=a("bb80"),o=a("c435"),i=a("9e70"),r=a("f298"),s=a("862c"),l=n(r),d=n("".slice),c=Math.ceil,f=function(t){return function(e,a,n){var r,f,u=i(s(e)),h=o(a),g=u.length,v=void 0===n?" ":i(n);return h<=g||""===v?u:(r=h-g,f=l(v,c(r/v.length)),f.length>r&&(f=d(f,0,r)),t?u+f:f+u)}};t.exports={start:f(!1),end:f(!0)}},fb9d:function(t,e,a){"use strict";var n=a("c84f"),o=a.n(n);o.a}}]);