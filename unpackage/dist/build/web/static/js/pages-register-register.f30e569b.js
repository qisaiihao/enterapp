(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-register-register"],{"0cca":function(n,r,t){var a=t("c86c");r=a(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* 注册页面样式 */.container[data-v-174a3598]{display:flex;flex-direction:column;align-items:center;padding:%?120?% %?60?% %?60?%;height:100vh;background:linear-gradient(135deg,#f5f7fa,#c3cfe2)}.title[data-v-174a3598]{font-size:%?56?%;font-weight:700;margin-bottom:%?20?%;color:#333;text-align:center}.subtitle[data-v-174a3598]{font-size:%?28?%;color:#666;margin-bottom:%?80?%;text-align:center}.form-wrapper[data-v-174a3598]{width:100%;max-width:%?600?%}\r\n/* 头像上传区域 */.avatar-uploader[data-v-174a3598]{display:flex;align-items:center;gap:%?20?%;margin-bottom:%?30?%}.avatar-preview[data-v-174a3598]{width:%?120?%;height:%?120?%;border-radius:50%;overflow:hidden;position:relative;background:#f2f2f2;display:flex;align-items:center;justify-content:center}.avatar-preview uni-image[data-v-174a3598]{width:100%;height:100%}.avatar-tip[data-v-174a3598]{position:absolute;bottom:%?6?%;font-size:%?20?%;color:#666;background:hsla(0,0%,100%,.7);padding:%?2?% %?6?%;border-radius:%?6?%}.avatar-upload-btn[data-v-174a3598]{background-color:#1c9bd6;color:#fff;border-radius:%?8?%;height:%?72?%;line-height:%?72?%;padding:0 %?30?%}.input-wrapper[data-v-174a3598]{margin-bottom:%?30?%;background:#fff;border-radius:%?16?%;padding:%?30?%;box-shadow:0 %?4?% %?20?% rgba(0,0,0,.1)}.input-label[data-v-174a3598]{display:block;font-size:%?28?%;color:#333;margin-bottom:%?20?%;font-weight:500}.input-field[data-v-174a3598]{width:100%;font-size:%?32?%;color:#333;border:none;outline:none;background:transparent}.input-field[data-v-174a3598]::-webkit-input-placeholder{color:#999}.input-field[data-v-174a3598]::placeholder{color:#999}.register-button[data-v-174a3598]{width:100%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:%?32?%;font-weight:500;border-radius:%?16?%;padding:%?30?%;margin:%?60?% 0 %?40?%;border:none;box-shadow:0 %?8?% %?25?% rgba(102,126,234,.3);transition:all .3s ease}.register-button[data-v-174a3598]:active{-webkit-transform:translateY(%?2?%);transform:translateY(%?2?%);box-shadow:0 %?4?% %?15?% rgba(102,126,234,.3)}.register-button[data-v-174a3598]:disabled{background:#ccc;box-shadow:none;-webkit-transform:none;transform:none}.register-button.loading[data-v-174a3598]{background:#ccc;box-shadow:none}.login-link-wrapper[data-v-174a3598]{display:flex;justify-content:center;align-items:center;margin-top:%?40?%}.login-text[data-v-174a3598]{font-size:%?28?%;color:#666;margin-right:%?10?%}.login-link[data-v-174a3598]{font-size:%?28?%;color:#667eea;font-weight:500;text-decoration:underline}\r\n/* 白色背景 + 顶部头像 + 底部悬浮按钮 */.white-page[data-v-174a3598]{background:#fff;min-height:100vh;position:relative}.container[data-v-174a3598]{display:flex;flex-direction:column;align-items:center;padding:%?60?% %?40?% %?140?%;background:#fff}.avatar-top[data-v-174a3598]{display:flex;flex-direction:column;align-items:center;margin:%?20?% 0 %?40?%}.avatar-preview[data-v-174a3598]{width:%?160?%;height:%?160?%;border-radius:50%;overflow:hidden;background:#f2f2f2;border:%?6?% solid #f1f1f1;box-shadow:0 %?6?% %?16?% rgba(0,0,0,.06)}.avatar-preview uni-image[data-v-174a3598]{width:100%;height:100%;display:block}.avatar-cta[data-v-174a3598]{margin-top:%?12?%;font-size:%?24?%;color:#999}.form-wrapper[data-v-174a3598]{width:100%;max-width:%?640?%}.input-wrapper[data-v-174a3598]{margin-bottom:%?24?%;background:transparent;border-radius:0;padding:0;border:none;box-shadow:none}.input-label[data-v-174a3598]{display:block;font-size:%?26?%;color:#888;margin-bottom:%?12?%}.input-field[data-v-174a3598]{width:100%;height:%?88?%;border:none;outline:none;background:#f5f6f7;border-radius:%?9999?%;padding:0 %?26?%;font-size:%?30?%;color:#333}\r\n/* 回车键形状按钮 */.enter-key-btn[data-v-174a3598]{position:fixed;right:%?40?%;bottom:%?40?%;width:%?220?%;height:%?180?%;cursor:pointer;transition:all .2s ease}.enter-key-btn[data-v-174a3598]:active{-webkit-transform:scale(.95);transform:scale(.95)}.enter-key-btn.disabled[data-v-174a3598]{opacity:.5;pointer-events:none}.enter-key-btn .ek-layer[data-v-174a3598]{position:absolute;inset:0}\r\n/* L 形剪裁：右侧竖条 + 底部横条 */.enter-key-btn .ek-border[data-v-174a3598]{background:#333;-webkit-filter:drop-shadow(0 %?6?% %?12?% rgba(0,0,0,.18));filter:drop-shadow(0 %?6?% %?12?% rgba(0,0,0,.18));-webkit-clip-path:polygon(55% 0,100% 0,100% 100%,0 100%,0 60%,55% 60%,55% 0);clip-path:polygon(55% 0,100% 0,100% 100%,0 100%,0 60%,55% 60%,55% 0);border-radius:%?24?%}.enter-key-btn .ek-fill[data-v-174a3598]{background:#fff;-webkit-clip-path:polygon(57% 2%,100% 2%,100% 100%,2% 100%,2% 62%,57% 62%,57% 2%);clip-path:polygon(57% 2%,100% 2%,100% 100%,2% 100%,2% 62%,57% 62%,57% 2%);border-radius:%?22?%}.enter-key-btn .ek-text[data-v-174a3598]{position:absolute;bottom:%?24?%;left:%?24?%;font-size:%?28?%;color:#333;font-weight:500}.login-link-wrapper.subtle[data-v-174a3598]{color:#999}",""]),n.exports=r},"13d3":function(n,r,t){"use strict";var a=t("7a50"),e=t.n(a);e.a},3059:function(n,r,t){"use strict";t.d(r,"b",(function(){return a})),t.d(r,"c",(function(){return e})),t.d(r,"a",(function(){}));var a=function(){var n=this,r=n.$createElement,t=n._self._c||r;return t("v-uni-view",{staticClass:"white-page"},[t("v-uni-view",{staticClass:"container"},[t("v-uni-view",{staticClass:"avatar-top"},[t("v-uni-view",{staticClass:"avatar-preview",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onChooseAvatar.apply(void 0,arguments)}}},[t("v-uni-image",{attrs:{src:n.localAvatarTempPath||"/static/images/avatar.png",mode:"aspectFill"}})],1),t("v-uni-text",{staticClass:"avatar-cta"},[n._v("点击更换头像")])],1),t("v-uni-view",{staticClass:"form-wrapper compact"},[t("v-uni-view",{staticClass:"input-wrapper"},[t("v-uni-text",{staticClass:"input-label"},[n._v("Poem ID")]),t("v-uni-input",{staticClass:"input-field",attrs:{type:"text",placeholder:"请输入 Poem ID"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onPoemIdInput.apply(void 0,arguments)}},model:{value:n.poemId,callback:function(r){n.poemId=r},expression:"poemId"}})],1),t("v-uni-view",{staticClass:"input-wrapper"},[t("v-uni-text",{staticClass:"input-label"},[n._v("密码")]),t("v-uni-input",{staticClass:"input-field",attrs:{type:"password",placeholder:"请输入密码"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onPasswordInput.apply(void 0,arguments)}},model:{value:n.password,callback:function(r){n.password=r},expression:"password"}})],1),t("v-uni-view",{staticClass:"input-wrapper"},[t("v-uni-text",{staticClass:"input-label"},[n._v("确认密码")]),t("v-uni-input",{staticClass:"input-field",attrs:{type:"password",placeholder:"请再次输入密码"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onConfirmPasswordInput.apply(void 0,arguments)}},model:{value:n.confirmPassword,callback:function(r){n.confirmPassword=r},expression:"confirmPassword"}})],1),t("v-uni-view",{staticClass:"input-wrapper"},[t("v-uni-text",{staticClass:"input-label"},[n._v("昵称")]),t("v-uni-input",{staticClass:"input-field",attrs:{type:"text",placeholder:"请输入昵称"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onNickNameInput.apply(void 0,arguments)}},model:{value:n.nickName,callback:function(r){n.nickName=r},expression:"nickName"}})],1),t("v-uni-view",{staticClass:"login-link-wrapper subtle"},[t("v-uni-text",{staticClass:"login-text"},[n._v("已有账号？")]),t("v-uni-text",{staticClass:"login-link",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.goToLogin.apply(void 0,arguments)}}},[n._v("去登录")])],1)],1)],1),t("v-uni-view",{staticClass:"enter-key-btn",class:{disabled:!n.canRegister||n.isRegistering},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onRegister.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"ek-layer ek-border"}),t("v-uni-view",{staticClass:"ek-layer ek-fill"},[t("v-uni-text",{staticClass:"ek-text"},[n._v("Enter ↵")])],1)],1)],1)},e=[]},"4e4a":function(n,r,t){"use strict";t.r(r);var a=t("3059"),e=t("f48e");for(var i in e)["default"].indexOf(i)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(i);t("13d3");var o=t("828b"),s=Object(o["a"])(e["default"],a["b"],a["c"],!1,null,"174a3598",null,!1,a["a"],void 0);r["default"]=s.exports},"7a50":function(n,r,t){var a=t("0cca");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var e=t("967d").default;e("191b98c2",a,!0,{sourceMap:!1,shadowMode:!1})},9787:function(n,r,t){"use strict";t("6a54");var a=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e=a(t("2634")),i=a(t("2fdc"));t("0c26"),t("bf0f"),t("7a76"),t("c9b5"),t("c223"),t("4626"),t("5ac7");getApp();var o=t("11ca"),s=o.cloudCall,l={data:function(){return{poemId:"",password:"",confirmPassword:"",nickName:"",isRegistering:!1,localAvatarTempPath:"",avatarFileID:"",isUploadingAvatar:!1}},computed:{canRegister:function(){return this.poemId.trim()&&this.password.trim()&&this.confirmPassword.trim()&&this.nickName.trim()&&this.password===this.confirmPassword}},onLoad:function(){},methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(n,r,Object.assign({pageTag:"register",context:this},t))},uploadAvatarViaCloudFunction:function(n){var r=this;return new Promise((function(t,a){if("undefined"===typeof window||"undefined"===typeof FileReader)try{var e=uni.getFileSystemManager&&uni.getFileSystemManager();if(!e)return a(new Error("不支持的环境"));e.readFile({filePath:n,encoding:"base64",success:function(n){var e=n.data;r.callCloudFunction("upload",{cloudPath:"user_avatars/".concat(Date.now(),"_").concat(Math.floor(1e3*Math.random()),".jpg"),fileContent:e}).then((function(n){n&&n.result&&n.result.success?t(n.result.fileID):a(new Error("上传失败"))})).catch(a)},fail:function(n){return a(n)}})}catch(i){a(i)}else fetch(n).then((function(n){if(!n.ok)throw new Error("HTTP "+n.status);return n.blob()})).then((function(n){var e=new FileReader;e.onload=function(){var n=e.result;if(!n||"string"!==typeof n)return a(new Error("读取失败"));var i=n.split(",")[1];r.callCloudFunction("upload",{cloudPath:"user_avatars/".concat(Date.now(),"_").concat(Math.floor(1e3*Math.random()),".jpg"),fileContent:i}).then((function(n){n&&n.result&&n.result.success?t(n.result.fileID):a(new Error("上传失败"))})).catch(a)},e.onerror=function(){return a(new Error("读取失败"))},e.readAsDataURL(n)})).catch(a)}))},onChooseAvatar:function(){var n=this;if(!this.isUploadingAvatar){var r=function(r){r&&(n.isUploadingAvatar=!0,n.localAvatarTempPath=r,n.uploadAvatarViaCloudFunction(r).then((function(r){n.avatarFileID=r,uni.showToast({title:"头像上传成功",icon:"success"})})).catch((function(r){console.error("上传头像失败:",r),n.avatarFileID="",uni.showToast({title:"头像上传失败",icon:"none"})})).finally((function(){n.isUploadingAvatar=!1})))};uni.chooseMedia?uni.chooseMedia({count:1,mediaType:["image"],sourceType:["album","camera"],success:function(n){var t=n.tempFiles&&n.tempFiles[0];r(t&&(t.tempFilePath||t.filePath))},fail:function(n){n&&n.errMsg&&n.errMsg.includes("cancel")||uni.showToast({title:"选择失败",icon:"none"})}}):uni.chooseImage({count:1,sizeType:["compressed","original"],sourceType:["album","camera"],success:function(n){r(n.tempFilePaths&&n.tempFilePaths[0])},fail:function(n){n&&n.errMsg&&n.errMsg.includes("cancel")||uni.showToast({title:"选择失败",icon:"none"})}})}},performAuth:function(){var n=this;return(0,i.default)((0,e.default)().mark((function r(){return(0,e.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log("🔐 [Register] 开始认证流程"),r.abrupt("return",new Promise((function(r,a){var e=t("fd09"),i=e.getCurrentPlatform,o=i();if("h5"===o||"app"===o)if(n.$tcb&&n.$tcb.auth){var s=n.$tcb.auth().currentUser;s?(console.log("✅ [注册] 用户已登录，跳过匿名登录"),r(s)):(console.log("🔐 [注册] 尝试匿名登录..."),n.$tcb.auth().signInAnonymously().then((function(n){console.log("✅ [注册] 匿名登录成功:",n),r(n)})).catch(a))}else a(new Error("TCB认证不可用"));else if("miniprogram"===o)if(wx.cloud&&wx.cloud.auth){var l=wx.cloud.auth().currentUser;l?(console.log("✅ [注册] 用户已登录，跳过匿名登录"),r(l)):(console.log("🔐 [注册] 尝试匿名登录..."),wx.cloud.auth().signInAnonymously().then((function(n){console.log("✅ [注册] 匿名登录成功:",n),r(n)})).catch(a))}else a(new Error("微信云开发认证不可用"));else a(new Error("不支持的平台: ".concat(o)))})));case 2:case"end":return r.stop()}}),r)})))()},onPoemIdInput:function(n){this.poemId=n.detail.value},onPasswordInput:function(n){this.password=n.detail.value},onConfirmPasswordInput:function(n){this.confirmPassword=n.detail.value},onNickNameInput:function(n){this.nickName=n.detail.value},onRegister:function(){var n=this;return(0,i.default)((0,e.default)().mark((function r(){var t,a,i,o,s,l;return(0,e.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.canRegister&&!n.isRegistering){r.next=2;break}return r.abrupt("return");case 2:if(n.password===n.confirmPassword){r.next=5;break}return uni.showToast({title:"两次输入的密码不一致",icon:"none",duration:3e3}),r.abrupt("return");case 5:return n.isRegistering=!0,uni.showLoading({title:"注册中...",mask:!0}),r.prev=7,r.next=10,n.performAuth();case 10:return r.next=12,n.callCloudFunction("registerUser",{poemId:n.poemId.trim(),password:n.password.trim(),nickName:n.nickName.trim(),avatarFileID:n.avatarFileID||""});case 12:t=r.sent,console.log("🔍 [注册] 云函数返回结果:",t),t.result&&t.result.success?(a=t.result.userInfo,i=t.result.openid,console.log("✅ [注册] 注册成功:",a),o=getApp(),o.globalData.userInfo=a,o.globalData.openid=i,uni.setStorageSync("userInfo",a),uni.setStorageSync("userOpenId",i),uni.showToast({title:"注册成功",icon:"success"}),setTimeout((function(){uni.switchTab({url:"/pages/poem-square/poem-square"})}),1e3)):(l=(null===(s=t.result)||void 0===s?void 0:s.message)||"注册失败，请重试",uni.showToast({title:l,icon:"none",duration:3e3})),r.next=21;break;case 17:r.prev=17,r.t0=r["catch"](7),console.error("❌ [注册] 注册失败:",r.t0),uni.showToast({title:"注册失败，请重试",icon:"none",duration:3e3});case 21:return r.prev=21,uni.hideLoading(),n.isRegistering=!1,r.finish(21);case 25:case"end":return r.stop()}}),r,null,[[7,17,21,25]])})))()},goToLogin:function(){uni.navigateBack()}}};r.default=l},f48e:function(n,r,t){"use strict";t.r(r);var a=t("9787"),e=t.n(a);for(var i in a)["default"].indexOf(i)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(i);r["default"]=e.a}}]);