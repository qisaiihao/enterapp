(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-post-detail-post-detail"],{"0691":function(n,r,t){"use strict";var e=t("f0b9"),a=t.n(e);a.a},"0fca":function(n,r,t){"use strict";t.r(r);var e=t("518f"),a=t.n(e);for(var o in e)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(o);r["default"]=a.a},"221b":function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,".install_tip_back[data-v-a8601b98]{position:fixed;top:0;right:0;bottom:0;left:0;background-color:rgba(0,0,0,.4);z-index:1}.install_tip_close[data-v-a8601b98]{position:absolute;right:%?10?%;top:%?10?%;width:32px;height:32px\n    /* background-color: red; */}.install_tip_detail[data-v-a8601b98]{position:fixed;background-color:#fff;right:0;bottom:0;left:0;border-radius:%?40?% %?40?% 0 0;padding:%?50?% %?50?% %?100?% %?50?%;z-index:9}.install_tip_detail_title[data-v-a8601b98]{font-weight:400;font-size:%?40?%;text-align:center}.install_tip_detail_tip[data-v-a8601b98]{font-size:%?25?%;color:rgba(0,0,0,.4);margin-top:%?20?%;text-align:left}.install_tip_detail_buttons[data-v-a8601b98]{padding-top:%?50?%;display:flex}.install_tip_detail_button[data-v-a8601b98]{color:#07c160;font-weight:500;background-color:rgba(0,0,0,.1);width:40%;text-align:center;\n    /* height: 90rpx; */border-radius:%?10?%;margin:0 auto}.install_tip_detail_button_primary[data-v-a8601b98]{background-color:#07c160;color:#fff}",""]),n.exports=r},"2b90":function(n,r,t){var e=t("bdbb").default,a=t("4550").default;t("5c47"),t("a1c1"),t("c223"),t("64aa");function o(n){return"undefined"===typeof uni||"function"!==typeof uni.createSelectorQuery?null:uni.createSelectorQuery().in(n)}function i(n,r,t){if("function"!==typeof n.setData){for(var o=r.replace(/\[(.*?)\]/g,".$1").replace(/^\./,""),i=o.split("."),s=n,l=0;l<i.length-1;l+=1){var c=i[l];s[c]&&"object"===e(s[c])||(s[c]={}),s=s[c]}s[i[i.length-1]]=t}else n.setData(a({},r,t))}n.exports={data:function(){return{__galleryImageMeta:{}}},created:function(){"undefined"===typeof this.swiperHeights&&(this.swiperHeights={}),"undefined"===typeof this.imageClampHeights&&(this.imageClampHeights={}),"undefined"===typeof this.imageCache&&(this.imageCache={})},methods:{onImageLoad:function(n){if(n&&n.detail&&n.currentTarget){var r=n.currentTarget.dataset||{},t=n.detail,e=t.width,a=t.height;if(e&&a){var o=function(n){return void 0!==n.galleryKey&&null!==n.galleryKey?n.galleryKey:void 0!==n.postindex&&null!==n.postindex?n.postindex:void 0!==n.postIndex&&null!==n.postIndex?n.postIndex:void 0!==n.index&&null!==n.index?n.index:void 0!==n.postid&&null!==n.postid?n.postid:void 0!==n.postId&&null!==n.postId?n.postId:void 0!==n.imgindex?"gallery-".concat(n.imgindex):"gallery"}(r),i="undefined"!==typeof r.imgindex?r.imgindex:r.imgIndex||0,s=r.type||r.imageType||"single",l="".concat(o,"_").concat(i);this.__galleryImageMeta&&(this.__galleryImageMeta[l]={width:e,height:a}),this.imageCache&&(this.imageCache[l]={width:e,height:a});var c=Number(this.galleryMinImageRatio)||9/16,d=Number(this.galleryMaxImageRatio)||16/9;if("multi"===s&&0===Number(i)){var u=r.swiperSelector||r.gallerySelector||"#swiper-".concat(o);this.__updateSwiperHeight({key:o,selector:u,originalWidth:e,originalHeight:a,minRatio:c,maxRatio:d})}if("single"===s){var f=r.singleSelector||r.imageSelector||"#single-image-".concat(o);this.__updateClampHeight({key:o,selector:f,originalWidth:e,originalHeight:a,minRatio:c})}}}},__updateSwiperHeight:function(n){var r=this,t=n.key,e=n.selector,a=n.originalWidth,s=n.originalHeight,l=n.minRatio,c=n.maxRatio;if(e){var d=o(this);d&&d.select(e).boundingClientRect((function(n){if(n&&n.width){var e=a/s,o=function(n,r,t){return n>t?t:n<r?r:n}(e,l,c),d=n.width/o;i(r,"swiperHeights[".concat(t,"]"),d)}})).exec()}},__updateClampHeight:function(n){var r=this,t=n.key,e=n.selector,a=n.originalWidth,s=n.originalHeight,l=n.minRatio,c=a/s;if(!(c>=l)){var d=e?o(this):null;if(e&&d)d.select(e).boundingClientRect((function(n){if(n&&n.width){var e=n.width/l;i(r,"imageClampHeights.".concat(t),e)}})).exec();else if(this.galleryFallbackWidth){var u=this.galleryFallbackWidth/l;i(this,"imageClampHeights.".concat(t),u)}}}}}},"320b":function(n,r,t){"use strict";t.r(r);var e=t("df21"),a=t("0fca");for(var o in a)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(o);t("5e09");var i=t("828b"),s=Object(i["a"])(a["default"],e["b"],e["c"],!1,null,"ef2749aa",null,!1,e["a"],void 0);r["default"]=s.exports},3255:function(n,r,t){var e=t("d242");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("8455b0aa",e,!0,{sourceMap:!1,shadowMode:!1})},"3b34":function(n,r,t){"use strict";t("6a54"),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e={data:function(){return{showTip:!1}},props:{showTipProps:Boolean,title:String,content:String},watch:{showTipProps:function(n){this.setData({showTip:n})}},methods:{onClose:function(){this.setData({showTip:!this.showTip})}},created:function(){}};r.default=e},"3ccb":function(n,r,t){"use strict";t.r(r);var e=t("3b34"),a=t.n(e);for(var o in e)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(o);r["default"]=a.a},4550:function(n,r,t){t("6a54");var e=t("8bcf");n.exports=function(n,r,t){return r=e(r),r in n?Object.defineProperty(n,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[r]=t,n},n.exports.__esModule=!0,n.exports["default"]=n.exports},4982:function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,'\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* pages/post-detail/post-detail.wxss */.container[data-v-ef2749aa]{padding:%?20?%;background-color:#f7f8fa;min-height:100vh;padding-bottom:%?140?%}.loading-container[data-v-ef2749aa]{display:flex;justify-content:center;align-items:center;height:%?400?%;background-color:#fff;border-radius:%?16?%;margin:%?30?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.loading-text[data-v-ef2749aa]{font-size:%?28?%;color:#999}.error-container[data-v-ef2749aa]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% %?40?%;text-align:center}.error-icon[data-v-ef2749aa]{font-size:%?120?%;margin-bottom:%?30?%;opacity:.6}.error-text[data-v-ef2749aa]{font-size:%?32?%;color:#666}.post-detail-card[data-v-ef2749aa]{position:relative;background-color:#fff;border-radius:%?16?%;padding:%?30?%;margin-bottom:%?20?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.post-detail-card.original-post[data-v-ef2749aa]{border:%?3?% solid #ebc88d;box-shadow:0 %?6?% %?24?% rgba(235,200,141,.4),0 %?4?% %?12?% rgba(0,0,0,.05);position:relative}.post-detail-card.original-post[data-v-ef2749aa]::before{content:"";position:absolute;top:%?-2?%;left:%?-2?%;right:%?-2?%;bottom:%?-2?%;background:linear-gradient(45deg,#ebc88d,#f4d03f,#ebc88d);border-radius:%?18?%;z-index:-1;opacity:.6;-webkit-filter:blur(%?10?%);filter:blur(%?10?%)}.author-info[data-v-ef2749aa]{display:flex;align-items:center;justify-content:flex-start;margin-bottom:%?20?%;gap:%?20?%}.author-basic[data-v-ef2749aa]{display:flex;align-items:center;flex:1;min-width:0;gap:%?12?%;flex-wrap:wrap}.follow-btn[data-v-ef2749aa]{padding:0 %?28?%;height:%?60?%;line-height:%?60?%;background-color:#9ed7ee;color:#fff;border:none;border-radius:%?999?%;font-size:%?26?%;flex-shrink:0;margin-left:auto}.follow-btn.following[data-v-ef2749aa]{background-color:#f0f0f0;color:#666}.follow-btn[data-v-ef2749aa]::after{border:none}.follow-btn[disabled][data-v-ef2749aa]{opacity:.7}.author-avatar[data-v-ef2749aa]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;background-color:#f5f5f5}.author-name[data-v-ef2749aa]{font-weight:700;font-size:%?28?%;color:#333}.post-title[data-v-ef2749aa]{font-size:%?36?%;font-weight:700;margin-bottom:%?15?%;line-height:1.4;color:#333;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.poem-author[data-v-ef2749aa]{font-size:%?28?%;color:#333;text-align:left;margin:%?10?% 0 %?15?% 0;font-weight:700;letter-spacing:%?2?%}.post-content[data-v-ef2749aa]{font-size:%?28?%;line-height:1.6;margin-bottom:%?20?%;white-space:pre-wrap;color:#666;word-break:break-word}.image-container[data-v-ef2749aa]{position:relative;width:100%;margin:%?20?% 0;background-color:#f5f5f5}.post-image[data-v-ef2749aa]{width:100%;height:auto;display:block;background-color:#f5f5f5;transition:-webkit-transform .3s ease;transition:transform .3s ease;transition:transform .3s ease,-webkit-transform .3s ease}.post-image[data-v-ef2749aa]:active{-webkit-transform:scale(1.05);transform:scale(1.05)}.post-image.single-image[data-v-ef2749aa]{width:100%!important;height:auto!important;display:block!important;background-color:#f5f5f5}.image-count-indicator[data-v-ef2749aa]{position:absolute;top:%?20?%;right:%?20?%;background-color:rgba(0,0,0,.6);color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%;z-index:10;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}.post-meta[data-v-ef2749aa]{margin-bottom:%?15?%}.post-time[data-v-ef2749aa]{font-size:%?24?%;color:#999;opacity:.8}.vote-section[data-v-ef2749aa]{display:flex;justify-content:flex-start;align-items:center;padding-top:%?20?%;margin-top:%?20?%;border-top:%?1?% solid #f0f0f0}.actions-left[data-v-ef2749aa]{display:flex;align-items:center}.vote-count[data-v-ef2749aa],\r\n.comment-count[data-v-ef2749aa]{display:flex;align-items:center;font-size:%?28?%;color:#999;margin-left:%?20?%;transition:color .2s ease}.vote-count[data-v-ef2749aa]{margin-left:%?0?%}.action-emoji[data-v-ef2749aa]{font-size:%?28?%;margin-right:%?8?%}.action-text[data-v-ef2749aa]{font-size:%?28?%;color:inherit}.like-icon-container[data-v-ef2749aa]{margin-left:%?20?%;display:flex;align-items:center;justify-content:center;padding:%?8?%;border-radius:%?8?%;transition:all .2s ease}.like-icon-container[data-v-ef2749aa]:active{-webkit-transform:scale(.95);transform:scale(.95)}.vote-count.voted[data-v-ef2749aa]{color:#ff4757}.button-group[data-v-ef2749aa]{display:flex;align-items:center}.favorite-button[data-v-ef2749aa]{background-color:#ffc300;color:#fff;border:none;border-radius:%?8?%;font-size:%?24?%;padding:%?8?% %?16?%;line-height:1.2;transition:all .2s ease}.favorite-button[data-v-ef2749aa]:active{background-color:#e6b000}.favorite-button[data-v-ef2749aa]::after{border:none}.favorite-button.favorited[data-v-ef2749aa]{background-color:#999;color:#fff}.favorite-button.favorited[data-v-ef2749aa]:active{background-color:#777}.like-icon[data-v-ef2749aa]{width:%?48?%;height:%?48?%}.comment-section[data-v-ef2749aa]{background-color:#fff;border-radius:%?16?%;padding:%?30?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.section-title[data-v-ef2749aa]{font-size:%?32?%;font-weight:700;margin-bottom:%?20?%;padding-bottom:%?15?%;border-bottom:%?1?% solid #f0f0f0;color:#333}.comment-list[data-v-ef2749aa]{margin-top:%?20?%}.comment-item[data-v-ef2749aa]{display:flex;margin-bottom:%?30?%;padding-bottom:%?20?%;border-bottom:%?1?% solid #f5f5f5}.comment-item[data-v-ef2749aa]:last-child{border-bottom:none;margin-bottom:0}.comment-avatar[data-v-ef2749aa]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;flex-shrink:0;background-color:#f5f5f5}.comment-main[data-v-ef2749aa]{display:flex;flex-direction:column;flex:1;min-width:0}.comment-author[data-v-ef2749aa]{font-size:%?28?%;color:#333;font-weight:700;margin-bottom:%?8?%}.comment-content[data-v-ef2749aa]{font-size:%?28?%;color:#666;line-height:1.5;word-break:break-word;margin-bottom:%?10?%}.comment-image-grid[data-v-ef2749aa]{display:flex;flex-direction:column;gap:%?12?%;margin-bottom:%?12?%}.comment-image[data-v-ef2749aa]{width:100%;height:%?400?%;border-radius:%?12?%;background-color:#f2f2f2;display:block;object-fit:cover}.reply-image-grid[data-v-ef2749aa]{margin-top:%?10?%}.comment-footer[data-v-ef2749aa]{display:flex;justify-content:flex-start;align-items:center;width:100%}.comment-time[data-v-ef2749aa]{font-size:%?24?%;color:#999;opacity:.8}.comment-actions[data-v-ef2749aa]{display:flex;align-items:center}.like-section[data-v-ef2749aa]{display:flex;align-items:center;padding:%?8?% %?12?%;margin-right:%?15?%;transition:all .2s ease}.like-section[data-v-ef2749aa]:active{-webkit-transform:scale(.95);transform:scale(.95)}.like-section .like-icon[data-v-ef2749aa]{width:%?32?%;height:%?32?%;margin-right:%?8?%}.like-count[data-v-ef2749aa]{font-size:%?26?%;color:#666}.delete-btn[data-v-ef2749aa]{display:flex;align-items:center;padding:%?8?% %?12?%;margin-right:%?15?%;transition:opacity .2s ease}.delete-btn[data-v-ef2749aa]:active{opacity:.7}.delete-text[data-v-ef2749aa]{font-size:%?26?%;color:#ff4d4f}.reply-btn[data-v-ef2749aa]{display:flex;align-items:center;padding:%?8?% %?12?%;transition:opacity .2s ease}.reply-btn[data-v-ef2749aa]:active{opacity:.7}.reply-text[data-v-ef2749aa]{font-size:%?26?%;color:#9ed7ee}.replies-container[data-v-ef2749aa]{margin-top:%?15?%;padding-left:%?20?%;border-left:%?2?% solid #f0f0f0}.reply-item[data-v-ef2749aa]{display:flex;margin-bottom:%?15?%}.reply-avatar[data-v-ef2749aa]{width:%?40?%;height:%?40?%;border-radius:50%;margin-right:%?10?%;flex-shrink:0;background-color:#f5f5f5}.reply-main[data-v-ef2749aa]{display:flex;flex-direction:column;flex:1;min-width:0}.reply-author[data-v-ef2749aa]{font-size:%?24?%;color:#333;font-weight:700;margin-bottom:%?4?%}.reply-content[data-v-ef2749aa]{font-size:%?26?%;color:#666;line-height:1.4;word-break:break-word}.reply-to[data-v-ef2749aa]{color:#9ed7ee;font-weight:700}.reply-footer[data-v-ef2749aa]{display:flex;justify-content:flex-start;align-items:center;margin-top:%?8?%}.reply-time[data-v-ef2749aa]{font-size:%?22?%;color:#999;opacity:.8}.reply-actions[data-v-ef2749aa]{display:flex;align-items:center}.show-more-replies[data-v-ef2749aa]{padding:%?10?% 0;transition:opacity .2s ease}.show-more-replies[data-v-ef2749aa]:active{opacity:.7}.show-more-text[data-v-ef2749aa]{font-size:%?24?%;color:#9ed7ee}.no-comment-tip[data-v-ef2749aa]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?60?% %?40?%;text-align:center}.empty-icon[data-v-ef2749aa]{font-size:%?80?%;margin-bottom:%?20?%;opacity:.6}.empty-text[data-v-ef2749aa]{font-size:%?28?%;color:#999}.input-overlay[data-v-ef2749aa]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.4);z-index:99;opacity:0;pointer-events:none;transition:opacity .3s ease}.input-overlay.show[data-v-ef2749aa]{opacity:1;pointer-events:auto}.comment-input-area[data-v-ef2749aa]{position:fixed;left:0;right:0;bottom:0;background-color:#fff;z-index:100;transition:bottom .2s ease-out;padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom)}.collapsed-bar[data-v-ef2749aa]{padding:%?16?% %?30?%;display:flex;align-items:center;border-top:%?1?% solid #f0f0f0}.collapsed-input-placeholder[data-v-ef2749aa]{flex:1;height:%?68?%;line-height:%?68?%;padding:0 %?24?%;background-color:#f7f8fa;border-radius:%?34?%;font-size:%?28?%;color:#999}.expanded-container[data-v-ef2749aa]{padding:%?20?% %?30?%;display:flex;flex-direction:column;border-top:%?1?% solid #f0f0f0}.expanded-textarea[data-v-ef2749aa]{width:100%;min-height:%?180?%;max-height:%?350?%;padding:%?20?% %?24?%;background-color:#fff;border-radius:0;font-size:%?30?%;line-height:1.6;box-sizing:border-box;border:none;-webkit-appearance:none;-webkit-box-sizing:border-box;-webkit-user-select:text;-webkit-touch-callout:default;outline:none}.expanded-actions[data-v-ef2749aa]{display:flex;justify-content:space-between;align-items:center;margin-top:%?20?%;width:100%}.action-icons[data-v-ef2749aa]{display:flex;gap:%?24?%}.action-icon[data-v-ef2749aa]{width:%?64?%;height:%?64?%;border-radius:50%;background:#f3f5f7;display:flex;align-items:center;justify-content:center;transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease}.action-icon[data-v-ef2749aa]:active{-webkit-transform:scale(.92);transform:scale(.92);background:#e6eef3}.action-icon-text[data-v-ef2749aa]{font-size:%?36?%}.selected-comment-images[data-v-ef2749aa]{display:flex;flex-wrap:wrap;gap:%?12?%;margin-top:%?16?%}.selected-image-item[data-v-ef2749aa]{position:relative;width:%?150?%;height:%?150?%;border-radius:%?12?%;overflow:hidden}.selected-image-thumb[data-v-ef2749aa]{width:100%;height:100%;background-color:#f2f2f2;display:block}.remove-image-btn[data-v-ef2749aa]{position:absolute;top:%?6?%;right:%?6?%;width:%?36?%;height:%?36?%;border-radius:50%;background:rgba(0,0,0,.55);color:#fff;font-size:%?24?%;display:flex;align-items:center;justify-content:center}.emoji-panel[data-v-ef2749aa]{margin-top:%?16?%;padding:%?20?% %?18?%;background:#f6f7f9;border-radius:%?16?%;display:flex;flex-wrap:wrap;gap:%?18?%}.emoji-item[data-v-ef2749aa]{font-size:%?36?%;padding:%?6?% %?10?%}.reply-prompt[data-v-ef2749aa]{display:flex;justify-content:flex-start;align-items:center;margin-bottom:%?15?%;padding:0 %?10?%}.reply-prompt-text[data-v-ef2749aa]{font-size:%?26?%;color:#666}.cancel-reply .cancel-text[data-v-ef2749aa]{font-size:%?26?%;color:#9ed7ee}.submit-button[data-v-ef2749aa]{width:%?120?%!important;height:%?64?%!important;line-height:%?64?%!important;background-color:#9ed7ee;color:#fff;border-radius:%?32?%;font-size:%?28?%;padding:0!important;margin:0!important;border:none!important;box-sizing:border-box!important;flex-shrink:0;transition:background-color .2s ease}.submit-button[disabled][data-v-ef2749aa]{background-color:#b3e6c9;color:#fff}.submit-button[data-v-ef2749aa]::after{border:none}.swiper-wrapper[data-v-ef2749aa]{position:relative;width:100%}.image-swiper[data-v-ef2749aa]{width:100%;background-color:#f0f0f0;border-radius:%?12?%;overflow:hidden}.swiper-item[data-v-ef2749aa]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.post-image[data-v-ef2749aa]{max-width:100%;max-height:100%}.image-count-indicator[data-v-ef2749aa]{position:absolute;bottom:%?20?%;right:%?20?%;background-color:rgba(0,0,0,.6);color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%;z-index:10;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}.post-tags[data-v-ef2749aa]{margin:%?30?% 0 %?10?% 0;line-height:1.5}.post-tag[data-v-ef2749aa]{color:#24375f;font-size:%?26?%;margin-right:%?10?%;transition:all .2s ease;cursor:pointer}.post-tag[data-v-ef2749aa]:active{color:#1a2a4a;opacity:.8}.mutual-tag[data-v-ef2749aa]{font-size:%?24?%;padding:%?4?% %?16?%;border-radius:%?999?%;background-color:#e6f4ff;color:#1f6fd2;flex-shrink:0}.followed-tag[data-v-ef2749aa]{font-size:%?24?%;padding:%?4?% %?16?%;border-radius:%?999?%;background-color:#f4ebff;color:#7c55c7;flex-shrink:0}',""]),n.exports=r},"518f":function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=e(t("9b1b")),o=e(t("2634")),i=e(t("fcf3")),s=e(t("2fdc"));t("bf0f"),t("fd3c"),t("f3f7"),t("18f7"),t("de6c"),t("2797"),t("9db6"),t("08eb"),t("0c26"),t("8f71"),t("c223"),t("f7a5"),t("5ef2"),t("dd2b"),t("64aa"),t("bd06"),t("aa77"),t("7a76"),t("c9b5");var l=e(t("f7a1")),c=e(t("84be")),d=t("7386"),u=e(t("c605")),f=e(t("f7a1")),p=e(t("84be")),m=(getApp(),t("fe58")),v=t("df61"),g=v.togglePostLike,h=t("8e86"),w=h.previewImage,b=t("139b"),y=b.formatRelativeTime,C=(t("a7cb"),t("05f6")),x=t("11ca"),k=x.cloudCall,_=t("2b90"),I={components:{cloudTipModal:l.default,folderSelector:c.default},mixins:[_],data:function(){return{post:null,comments:[],newComment:"",commentCount:0,isLoading:!0,isSubmitDisabled:!0,replyToComment:null,replyToAuthor:"",showUploadTip:!1,votingInProgress:!1,imageContainerHeight:null,swiperHeights:{},imageClampHeights:{},showFavoriteModal:!1,isInputExpanded:!1,keyboardHeight:0,isFocus:!1,viewStartTime:0,currentPostId:null,isFavorited:!1,favoriteButtonText:"收藏",favoriteButtonClass:"favorite-button",showFollowButton:!1,isFollowing:!1,followPending:!1,isFollowedByAuthor:!1,isMutualFollow:!1,commentImages:[],maxCommentImages:3,showEmojiPanel:!1,emojiList:["😀","😁","😂","🤣","😊","😍","😎","🤔","😢","🙏","👍","👎"],isSubmittingComment:!1,imgindex:0,img:"",commentIndex:0,commentImage:"",imageIndex:0,replyIndex:0,reply:{authorAvatar:"",_openid:"",authorName:"",content:"",imageUrls:"",formattedCreateTime:"",_id:"",liked:"",likeIcon:"",likes:"",canDelete:""},replyImage:"",replyImageIndex:0}},onLoad:function(n){var r=n.id;r?(this.setData({currentPostId:r}),this.loadPostDetail(r)):(this.setData({isLoading:!1}),uni.showToast({title:"无效的帖子ID",icon:"none"}))},onShow:function(){this.setData({viewStartTime:Date.now()})},onUnload:function(){this.recordViewBehavior()},onHide:function(){this.isInputExpanded&&this.collapseInput(),this.recordViewBehavior()},methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return k(n,r,Object.assign({pageTag:"post-detail",context:this},t))},loadPostDetail:function(n){var r=this;uni.showLoading({title:"加载中..."}),this.callCloudFunction("getPostDetail",{postId:n},{injectOpenId:!1}).then(function(){var n=(0,s.default)((0,o.default)().mark((function n(t){var e,a;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.result||!t.result.post){n.next=18;break}return e=t.result.post,e.formattedCreateTime=r.formatTime(e.createTime),e.likeIcon=m.getLikeIcon(e.votes||0,e.isVoted||!1),n.next=6,(0,d.hydrateTempUrls)([e]);case 6:(0,d.warmTempUrlsFromPosts)([e]),console.log("loadPostDetail完整返回数据:",t.result),console.log("loadPostDetail获取到的commentCount:",t.result.commentCount,"类型:",(0,i.default)(t.result.commentCount)),console.log("loadPostDetail获取到的post.commentCount:",e.commentCount,"类型:",(0,i.default)(e.commentCount)),a=t.result.commentCount||e.commentCount||0,console.log("最终使用的commentCount:",a),r.setData({post:e,commentCount:a}),console.log("loadPostDetail设置后的commentCount:",r.commentCount),r.getComments(e&&e._id?e._id:""),r.prepareFollowState(e._openid),n.next=19;break;case 18:uni.showToast({title:"帖子加载失败",icon:"none"});case 19:case"end":return n.stop()}}),n)})));return function(r){return n.apply(this,arguments)}}()).catch((function(n){console.error("Failed to get post detail",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){r.setData({isLoading:!1}),uni.hideLoading()}))},getComments:function(n){var r=this;this.callCloudFunction("getComments",{postId:n},{injectOpenId:!1}).then(function(){var n=(0,s.default)((0,o.default)().mark((function n(t){var e,i,s,l,c,d;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.result||!t.result.comments){n.next=24;break}if(e=r.openid||uni.getStorageSync("openid"),i=t.result.comments.map((function(n){var t=(0,a.default)((0,a.default)({},n),{},{formattedCreateTime:r.formatTime(n.createTime),likeIcon:m.getLikeIcon(n.likes||0,n.liked||!1),canDelete:n._openid===e,imageUrls:n.imageUrls||[],originalImageUrls:n.originalImageUrls||[]});return n.replies&&(t.replies=n.replies.map((function(n){return(0,a.default)((0,a.default)({},n),{},{formattedCreateTime:r.formatTime(n.createTime),likeIcon:m.getLikeIcon(n.likes||0,n.liked||!1),canDelete:n._openid===e,imageUrls:n.imageUrls||[],originalImageUrls:n.originalImageUrls||[]})}))),t})),n.prev=3,s=new Set,i.forEach((function(n){(Array.isArray(n.imageUrls)?n.imageUrls:[]).forEach((function(n){"string"===typeof n&&n.startsWith("cloud://")&&s.add(n)})),(Array.isArray(n.replies)?n.replies:[]).forEach((function(n){return(Array.isArray(n.imageUrls)?n.imageUrls:[]).forEach((function(n){"string"===typeof n&&n.startsWith("cloud://")&&s.add(n)}))}))})),!(s.size>0)){n.next=11;break}return n.next=9,u.default.getTempUrls(Array.from(s));case 9:l=n.sent,i.forEach((function(n){Array.isArray(n.imageUrls)&&(n.imageUrls=n.imageUrls.map((function(n){return l[n]||n}))),Array.isArray(n.replies)&&(n.replies=n.replies.map((function(n){return(0,a.default)((0,a.default)({},n),{},{imageUrls:Array.isArray(n.imageUrls)?n.imageUrls.map((function(n){return l[n]||n})):n.imageUrls})})))}));case 11:n.next=15;break;case 13:n.prev=13,n.t0=n["catch"](3);case 15:console.log("getComments返回的commentCount:",t.result.commentCount),console.log("comments数组长度:",i.length),console.log("当前页面的commentCount:",r.commentCount),c=t.result.commentCount||i.length,d=c>r.commentCount,r.setData({comments:i,commentCount:d?c:r.commentCount}),console.log("更新后的commentCount:",r.commentCount),n.next=25;break;case 24:uni.showToast({title:"评论加载失败",icon:"none"});case 25:case"end":return n.stop()}}),n,null,[[3,13]])})));return function(r){return n.apply(this,arguments)}}()).catch((function(n){console.error("Failed to get comments",n),uni.showToast({title:"网络错误",icon:"none"})}))},onVote:function(n){var r=this,t=n.currentTarget.dataset.postid;if(!this.votingInProgress){this.setData({votingInProgress:!0});var e=this.post,a=e.votes,o=e.isVoted,i=o?a-1:a+1,s=!o,l=m.getLikeIcon(i,s);this.setData({"post.votes":i,"post.isVoted":s,"post.likeIcon":l}),g(t,{pageTag:"post-detail",context:this,currentVotes:a,currentIsLiked:o,requireAuth:!0}).then((function(n){if(n.success)r.setData({"post.votes":n.votes,"post.isVoted":n.isLiked,"post.likeIcon":n.likeIcon});else{var t=n.rollback||{votes:a,isLiked:o,likeIcon:m.getLikeIcon(a,o)};r.setData({"post.votes":t.votes,"post.isVoted":t.isLiked,"post.likeIcon":t.likeIcon})}})).catch((function(n){console.error("【帖子详情点赞】调用 likeService 失败",n),r.setData({"post.votes":a,"post.isVoted":o,"post.likeIcon":m.getLikeIcon(a,o)})})).finally((function(){r.setData({votingInProgress:!1})}))}},onFavorite:function(){this.isFavorited?uni.showToast({title:"已经收藏过了",icon:"none"}):this.setData({showFavoriteModal:!0})},hideFavoriteModal:function(){this.setData({showFavoriteModal:!1})},onFavoriteSuccess:function(){this.hideFavoriteModal(),this.setData({isFavorited:!0,favoriteButtonText:"已收藏",favoriteButtonClass:"favorite-button favorited"}),uni.showToast({title:"收藏成功",icon:"success"});try{var n=getApp(),r=n&&n.globalData&&n.globalData.openid,t=this.post&&this.post._id;r&&t&&uni.$emit&&uni.$emit("favorite-changed",{userId:r,postId:t,favored:!0})}catch(e){}},handlePreview:function(n){var r=w(n,{fallbackToast:!1});return r||uni.showToast({title:"图片加载失败",icon:"none"}),r},onImageError:function(n){console.error("图片加载失败",n)},onAvatarError:function(n){console.error("头像加载失败",n)},updateSubmitState:function(){var n=(this.newComment||"").trim().length>0,r=Array.isArray(this.commentImages)&&this.commentImages.length>0,t=!n&&!r||this.isSubmittingComment;this.isSubmitDisabled!==t&&this.setData({isSubmitDisabled:t})},onCommentInput:function(n){var r=this;this.setData({newComment:n.detail.value},(function(){r.updateSubmitState()}))},toggleEmojiPanel:function(){var n=!this.showEmojiPanel,r={showEmojiPanel:n,isFocus:!n};n&&(r.keyboardHeight=0,uni.hideKeyboard()),this.setData(r)},insertEmoji:function(n){var r=this,t=n.currentTarget.dataset.emoji;if(t){var e=(this.newComment||"")+t;this.setData({newComment:e},(function(){r.updateSubmitState()}))}},closeEmojiPanel:function(){this.showEmojiPanel&&this.setData({showEmojiPanel:!1})},chooseCommentImages:function(){var n=this;this.closeEmojiPanel();var r=this.commentImages?this.commentImages.length:0,t=this.maxCommentImages-r;t<=0?uni.showToast({title:"最多选择3张图片",icon:"none"}):(this.isInputExpanded||this.expandInput(),uni.chooseImage({count:t,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(r){var t=r.tempFiles||(r.tempFilePaths||[]).map((function(n){return{tempFilePath:n,size:0}})),e=t.map((function(r){return n.prepareCommentImage(r)}));Promise.all(e).then((function(r){var t=r.filter((function(n){return!!n}));if(0!==t.length){var e=(n.commentImages||[]).concat(t);n.setData({commentImages:e.slice(0,n.maxCommentImages)},(function(){n.updateSubmitState(),n.setData({isInputExpanded:!0,isFocus:!1})}))}})).catch((function(n){console.error("评论图片处理失败:",n),uni.showToast({title:"图片处理失败",icon:"none"})}))},fail:function(n){n&&n.errMsg&&-1===n.errMsg.indexOf("cancel")&&(console.error("选择评论图片失败:",n),uni.showToast({title:"无法选择图片",icon:"none"}))}}))},prepareCommentImage:function(n){var r=this;return new Promise((function(t){var e=n.tempFilePath||n.path||(Array.isArray(n.tempFilePaths)?n.tempFilePaths[0]:"");if(e){var a=n.size||0,o=a>204800,i={id:"comment_"+Date.now()+"_"+Math.floor(1e5*Math.random()),originalPath:e,previewUrl:e,compressedPath:e,size:a,needCompression:o};o?r.compressCommentImage(i).then((function(n){t(n)})).catch((function(n){console.warn("评论图片压缩异常:",n),i.compressedPath=i.originalPath,i.previewUrl=i.originalPath,i.needCompression=!1,t(i)})):t(i)}else t(null)}))},compressCommentImage:function(n){return new Promise((function(r){(function t(e){uni.compressImage({src:n.originalPath,quality:e,success:function(a){uni.getFileInfo({filePath:a.tempFilePath,success:function(o){var i=o.size;console.log("压缩质量".concat(e,"%，文件大小: ").concat((i/1024).toFixed(2),"KB")),i>204800&&e>30?(console.log("文件大小".concat((i/1024).toFixed(2),"KB超过200KB，继续压缩...")),t(e-10)):(n.compressedPath=a.tempFilePath,n.previewUrl=a.tempFilePath,n.compressedSize=i,console.log("最终压缩质量".concat(e,"%，文件大小: ").concat((i/1024).toFixed(2),"KB")),r(n))},fail:function(){n.compressedPath=a.tempFilePath,n.previewUrl=a.tempFilePath,r(n)}})},fail:function(a){console.warn("压缩质量".concat(e,"%失败:"),a),e>30?t(e-10):(n.compressedPath=n.originalPath,n.previewUrl=n.originalPath,n.needCompression=!1,r(n))}})})(60)}))},removeCommentImage:function(n){var r=this,t=n.currentTarget.dataset.index;if(void 0!==t){var e=(this.commentImages||[]).slice();e.splice(t,1),this.setData({commentImages:e},(function(){r.updateSubmitState()}))}},previewSelectedCommentImage:function(n){var r=n.currentTarget.dataset.index||0,t=this.commentImages||[];if(t.length){var e=t.map((function(n){return n.previewUrl})).filter(Boolean);if(e.length){var a=e[r]||e[0];return w({current:a,urls:e},{fallbackToast:!1})}}},uploadCommentImages:function(){var n=this,r=this.commentImages||[];if(!r.length)return Promise.resolve([]);var t=this.getCurrentUserId()||"guest",e=Date.now();return Promise.all(r.map((function(r,a){var o=(t||"guest")+"_"+e+"_"+a,i="comment_images/"+o+"_compressed.jpg";return n.uploadFile(i,r.compressedPath||r.previewUrl||r.originalPath).then((function(t){if(r.needCompression){var e="comment_images/"+o+"_original.jpg";return n.uploadFile(e,r.originalPath).then((function(n){return{compressedUrl:t.fileID,originalUrl:n.fileID}}))}return{compressedUrl:t.fileID,originalUrl:t.fileID}}))})))},previewCommentImageFromList:function(n){var r=Number(n.currentTarget.dataset.commentIndex),t=n.currentTarget.dataset.replyIndex,e="undefined"===typeof t?-1:Number(t),a=Number(n.currentTarget.dataset.imageIndex)||0,o=n.currentTarget.dataset.isReply,i=!0===o||"true"===o,s=[];if(!Number.isNaN(r)&&r>=0){var l=this.comments[r];if(l)if(i&&Array.isArray(l.replies)&&e>=0){var c=l.replies[e];c&&(Array.isArray(c.originalImageUrls)&&c.originalImageUrls.length>0?s=c.originalImageUrls:Array.isArray(c.imageUrls)&&(s=c.imageUrls))}else Array.isArray(l.originalImageUrls)&&l.originalImageUrls.length>0?s=l.originalImageUrls:Array.isArray(l.imageUrls)&&(s=l.imageUrls)}if(s&&s.length){var d=s.filter(Boolean);if(d.length){var u=d[a]||d[0];return w({current:u,urls:d},{fallbackToast:!1})}}},onSubmitComment:function(){var n=(0,s.default)((0,o.default)().mark((function n(){var r,t,e,a,i,s,l,c,d,u,f,p,m;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!this.isSubmitDisabled&&!this.isSubmittingComment){n.next=2;break}return n.abrupt("return");case 2:if(r=(this.newComment||"").trim(),t=r.length>0,e=Array.isArray(this.commentImages)&&this.commentImages.length>0,t||e){n.next=8;break}return uni.showToast({title:"请输入内容或添加图片",icon:"none"}),n.abrupt("return");case 8:if(a=this.post&&this.post._id?this.post._id:"",a){n.next=12;break}return uni.showToast({title:"帖子信息缺失",icon:"none"}),n.abrupt("return");case 12:return i=this.replyToComment,s=this.replyToAuthor,this.setData({isSubmittingComment:!0}),this.updateSubmitState(),uni.showLoading({title:"提交中..."}),n.prev=17,n.next=20,this.uploadCommentImages();case 20:return l=n.sent,c=l.map((function(n){return n.compressedUrl})),d=l.map((function(n){return n.originalUrl})),n.next=25,this.callCloudFunction("addComment",{postId:a,content:r,parentId:i,replyToAuthorName:s,imageUrls:c,originalImageUrls:d},{requireAuth:!0});case 25:u=n.sent,uni.hideLoading(),u.result&&u.result.success?(uni.showToast({title:"评论成功"}),f=this.commentCount+1,this.setData({newComment:"",commentImages:[],showEmojiPanel:!1,commentCount:f}),this.updateSubmitState(),this.collapseInput(),this.getComments(a),p=getCurrentPages(),p.length>1&&(m=p[p.length-2],"pages/index/index"!==m.route&&"pages/profile/profile"!==m.route||"function"!==typeof m.updatePostCommentCount||m.updatePostCommentCount(a,f))):uni.showToast({title:u.result&&u.result.message||"评论失败",icon:"none"}),n.next=37;break;case 30:n.prev=30,n.t0=n["catch"](17),console.log("CatchClause",n.t0),console.log("CatchClause",n.t0),uni.hideLoading(),console.error("Failed to add comment with media:",n.t0),uni.showToast({title:"评论失败",icon:"none"});case 37:return n.prev=37,this.setData({isSubmittingComment:!1}),this.updateSubmitState(),n.finish(37);case 41:case"end":return n.stop()}}),n,this,[[17,30,37,41]])})));return function(){return n.apply(this,arguments)}}(),showReplyInput:function(n){console.log("--- showReplyInput function triggered ---"),console.log("收到的 data- attributes:",n.currentTarget.dataset);var r=n.currentTarget.dataset.commentId,t=n.currentTarget.dataset.authorName;this.setData({replyToComment:r,replyToAuthor:t}),console.log("设置后的回复状态:",{replyToComment:this.replyToComment,replyToAuthor:this.replyToAuthor}),this.expandInput()},cancelReply:function(){this.setData({replyToComment:null,replyToAuthor:""}),console.log("回复状态已被取消")},onDeleteComment:function(n){var r=this,t=n.currentTarget.dataset,e=t.commentId,o=t.parentId;e&&uni.showModal({title:"删除评论",content:"确定要删除这条评论吗？",confirmColor:"#ff4d4f",success:function(n){n.confirm&&(uni.showLoading({title:"正在删除",mask:!0}),r.callCloudFunction("deleteComment",{commentId:e},{requireAuth:!0}).then((function(n){if(n.result&&n.result.success){var t,i=Math.max(1,n.result.deletedCount||1);if(o){t=r.comments.map((function(n){return(0,a.default)((0,a.default)({},n),{},{replies:n.replies?n.replies.slice():[]})}));var s=t.findIndex((function(n){return n._id===o}));-1!==s&&(t[s].replies=t[s].replies.filter((function(n){return n._id!==e})))}else t=r.comments.filter((function(n){return n._id!==e}));var l=Math.max(0,r.commentCount-i);r.setData({comments:t,commentCount:l});var c=getCurrentPages();if(c.length>1){var d=c[c.length-2];"function"===typeof d.updatePostCommentCount&&d.updatePostCommentCount(r.post&&r.post._id?r.post._id:"",l)}uni.showToast({title:"已删除",icon:"success"})}else uni.showToast({title:n.result&&n.result.message||"删除失败",icon:"none"})})).catch((function(n){console.error("Failed to delete comment",n),uni.showToast({title:"删除失败",icon:"none"})})).finally((function(){uni.hideLoading()})))}})},toggleLikeComment:function(n){var r=this,t=n.currentTarget.dataset.commentId,e=this.post&&this.post._id?this.post._id:"",a=this.comments,o=this.findComment(a,t),i=o.comment;o.isReply;if(i){var s=!i.liked,l=i.likes||0;i.liked=s,i.likes=l+(s?1:-1),i.likeIcon=m.getLikeIcon(i.likes,i.liked),this.setData({comments:a}),this.callCloudFunction("likeComment",{commentId:t,postId:e},{requireAuth:!0}).then((function(n){n.result&&n.result.success?i.likes!==n.result.likes&&r.updateCommentLikeStatus(t,s,n.result.likes):(r.updateCommentLikeStatus(t,!s,l),uni.showToast({title:"操作失败",icon:"none"}))})).catch((function(n){r.updateCommentLikeStatus(t,!s,l),console.error("Failed to like comment",n),uni.showToast({title:"网络错误",icon:"none"})}))}},updateCommentLikeStatus:function(n,r,t){var e=this.comments,a=this.findComment(e,n),o=a.comment;a.isReply;o&&(o.liked=r,o.likes=t,o.likeIcon=m.getLikeIcon(o.likes,o.liked),this.setData({comments:e}))},findComment:function(n,r){for(var t=0;t<n.length;t++){if(n[t]._id===r)return{comment:n[t],isReply:!1};if(n[t].replies)for(var e=0;e<n[t].replies.length;e++)if(n[t].replies[e]._id===r)return{comment:n[t].replies[e],isReply:!0}}return{comment:null,isReply:!1}},toggleShowAllReplies:function(n){var r=n.currentTarget.dataset.commentId,t=this.comments,e=t.find((function(n){return n._id===r}));e&&(e.showAllReplies=!e.showAllReplies,this.setData({comments:t}))},formatTime:function(n){return y(n)},prepareFollowState:function(n){var r=this.getCurrentUserId();if(console.log("【关注状态】prepareFollowState调用:",{authorOpenid:n,currentUserId:r,isSameUser:n===r}),!n||!r||n===r)return console.log("【关注状态】不显示关注按钮 - 自己或无效用户"),void this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByAuthor:!1,isMutualFollow:!1});console.log("【关注状态】显示关注按钮"),this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByAuthor:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(n)},fetchFollowStatusWithCache:function(n){var r=this;if(n){var t=this.getCurrentUserId();t&&C.getFollowStatus(t,n).then((function(n){n&&r.setData({isFollowing:n.isFollowing,isFollowedByAuthor:n.isFollowedByAuthor,isMutualFollow:n.isMutualFollow})}))}},fetchFollowStatus:function(n){var r=this;n&&this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:n},{requireAuth:!0}).then((function(n){n.result&&n.result.success?r.setData({isFollowing:!!n.result.isFollowing,isFollowedByAuthor:!!n.result.isFollower,isMutualFollow:!!n.result.isMutual}):console.warn("检查关注状态失败",n.result)})).catch((function(n){console.error("检查关注状态调用失败:",n)}))},onFollowTap:function(){var n=this;if(!this.followPending&&this.post){var r=this.post._openid;if(r){var t=this.getCurrentUserId();t?(this.setData({followPending:!0}),C.toggleFollowStatus(t,r).then((function(r){r?(n.setData({isFollowing:r.isFollowing,isFollowedByAuthor:r.isFollowedByAuthor,isMutualFollow:r.isMutualFollow}),uni.showToast({title:r.isFollowing?"关注成功":"已取消关注",icon:"success"})):uni.showToast({title:"操作失败",icon:"none"})})).catch((function(n){console.error("切换关注状态失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({followPending:!1})}))):uni.showToast({title:"请先登录",icon:"none"})}}},getCurrentUserId:function(){return this.openid||uni.getStorageSync("openid")||uni.getStorageSync("userOpenId")},retryLoad:function(){this.currentPostId&&(this.setData({isLoading:!0,post:null}),this.loadPostDetail(this.currentPostId))},navigateToUserProfile:function(n){var r=n.currentTarget.dataset.userId;if(r){var t=this.openid;r===t?(console.log("【帖子详情】点击的是自己头像，切换到我的页面"),uni.switchTab({url:"/pages/profile/profile"})):(console.log("【帖子详情】点击的是他人头像，跳转到用户主页"),uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(r)}))}},preventBubble:function(){},expandInput:function(){this.setData({isInputExpanded:!0,isFocus:!0,showEmojiPanel:!1})},onInputFocus:function(n){console.log("键盘弹起，高度为:",n.detail.height),this.setData({keyboardHeight:n.detail.height,showEmojiPanel:!1})},onInputBlur:function(){var n=this;setTimeout((function(){n.setData({isFocus:!1,keyboardHeight:0})}),100)},collapseInput:function(){this.setData({isInputExpanded:!1,isFocus:!1,keyboardHeight:0,replyToComment:null,replyToAuthor:"",showEmojiPanel:!1})},recordViewBehavior:function(){if(this.currentPostId&&this.viewStartTime){var n=Math.floor((Date.now()-this.viewStartTime)/1e3);n<3||this.callCloudFunction("recordView",{postId:this.currentPostId,viewDuration:n}).then((function(n){console.log("浏览记录已保存",n)})).catch((function(n){console.error("浏览记录保存失败:",n)}))}},onTagClick:function(n){var r=n.currentTarget.dataset.tag;console.log("点击标签:",r),uni.navigateTo({url:"/pages/tag-filter/tag-filter?tag=".concat(encodeURIComponent(r)),success:function(){console.log("跳转到标签筛选页面成功")},fail:function(n){console.error("跳转到标签筛选页面失败",n),uni.showToast({title:"跳转失败",icon:"none"})}})},uploadFile:function(n,r){var e=this;return console.log("🔍 [帖子详情页] 上传文件: ".concat(n),r),new Promise((function(a,o){var i=t("fd09"),s=i.getCurrentPlatform,l=i.getCloudFunctionMethod,c=s(),d=l();console.log("🔍 [帖子详情页] 运行环境检测 - 平台: ".concat(c,", 方法: ").concat(d)),"tcb"===d?e.$tcb&&e.$tcb.uploadFile?(console.log("🔍 [帖子详情页] TCB环境上传文件: ".concat(n)),e.$tcb.uploadFile({cloudPath:n,filePath:r}).then(a).catch(o)):(console.error("❌ [帖子详情页] TCB实例不可用"),o(new Error("TCB实例不可用"))):"wx-cloud"===d?wx.cloud&&wx.cloud.uploadFile?(console.log("🔍 [帖子详情页] 小程序环境上传文件: ".concat(n)),wx.cloud.uploadFile({cloudPath:n,filePath:r,success:function(r){console.log("✅ [帖子详情页] 文件上传成功: ".concat(n),r),a(r)},fail:function(r){console.error("❌ [帖子详情页] 文件上传失败: ".concat(n),r),o(r)}})):(console.error("❌ [帖子详情页] 微信云开发不可用"),o(new Error("微信云开发不可用"))):(console.error("❌ [帖子详情页] 不支持的文件上传方式: ".concat(d)),o(new Error("不支持的文件上传方式: ".concat(d))))}))}}};r.default=I,r.default.components=Object.assign({"cloud-tip-modal":f.default,"folder-selector":p.default},r.default.components||{})},"56c9":function(n,r,t){t("9e15"),t("884b"),t("01a2"),t("e39c"),t("bf0f"),t("7a76"),t("c9b5"),t("64aa");var e=t("bdbb")["default"];n.exports=function(n,r){if("object"!==e(n)||null===n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var a=t.call(n,r||"default");if("object"!==e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(n)},n.exports.__esModule=!0,n.exports["default"]=n.exports},"5e09":function(n,r,t){"use strict";var e=t("f005"),a=t.n(e);a.a},7386:function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.hydrateTempUrls=function(){return l.apply(this,arguments)},r.warmTempUrlsFromPosts=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=new Set;n.forEach((function(n){return s(n).forEach((function(n){return r.add(n)}))})),r.size>0&&i.default.warm(Array.from(r))};var a=e(t("2634")),o=e(t("2fdc"));t("9db6"),t("aa9c"),t("bf0f"),t("2797"),t("f3f7"),t("18f7"),t("de6c"),t("08eb"),t("fd3c");var i=e(t("c605"));function s(n){var r=[],t=function(n){"string"===typeof n&&n.startsWith("cloud://")&&r.push(n)};return t(n.imageUrl),t(n.originalImageUrl),t(n.authorAvatar),t(n.poemBgImage),Array.isArray(n.imageUrls)&&n.imageUrls.forEach(t),Array.isArray(n.originalImageUrls)&&n.originalImageUrls.forEach(t),r}function l(){return l=(0,o.default)((0,a.default)().mark((function n(){var r,t,e,o,l=arguments;return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=l.length>0&&void 0!==l[0]?l[0]:[],Array.isArray(r)&&0!==r.length){n.next=3;break}return n.abrupt("return",r);case 3:if(t=new Set,r.forEach((function(n){return s(n).forEach((function(n){return t.add(n)}))})),0!==t.size){n.next=7;break}return n.abrupt("return",r);case 7:return n.next=9,i.default.getTempUrls(Array.from(t));case 9:return e=n.sent,o=function(n){return"string"===typeof n&&e[n]?e[n]:n},r.forEach((function(n){n.imageUrl&&(n.imageUrl=o(n.imageUrl)),n.originalImageUrl&&(n.originalImageUrl=o(n.originalImageUrl)),n.authorAvatar&&(n.authorAvatar=o(n.authorAvatar)),n.poemBgImage&&(n.poemBgImage=o(n.poemBgImage)),Array.isArray(n.imageUrls)&&(n.imageUrls=n.imageUrls.map(o)),Array.isArray(n.originalImageUrls)&&(n.originalImageUrls=n.originalImageUrls.map(o))})),n.abrupt("return",r);case 13:case"end":return n.stop()}}),n)}))),l.apply(this,arguments)}},"84be":function(n,r,t){"use strict";t.r(r);var e=t("b348"),a=t("daaa");for(var o in a)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(o);t("9820");var i=t("828b"),s=Object(i["a"])(a["default"],e["b"],e["c"],!1,null,"3a05c372",null,!1,e["a"],void 0);r["default"]=s.exports},"8bcf":function(n,r,t){var e=t("bdbb")["default"],a=t("56c9");n.exports=function(n){var r=a(n,"string");return"symbol"===e(r)?r:String(r)},n.exports.__esModule=!0,n.exports["default"]=n.exports},"967d":function(n,r,t){"use strict";function e(n,r){for(var t=[],e={},a=0;a<r.length;a++){var o=r[a],i=o[0],s=o[1],l=o[2],c=o[3],d={id:n+":"+a,css:s,media:l,sourceMap:c};e[i]?e[i].parts.push(d):t.push(e[i]={id:i,parts:[d]})}return t}t.r(r),t.d(r,"default",(function(){return p}));var a="undefined"!==typeof document;if("undefined"!==typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},i=a&&(document.head||document.getElementsByTagName("head")[0]),s=null,l=0,c=!1,d=function(){},u=null,f="undefined"!==typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function p(n,r,t,a){c=t,u=a||{};var i=e(n,r);return m(i),function(r){for(var t=[],a=0;a<i.length;a++){var s=i[a],l=o[s.id];l.refs--,t.push(l)}r?(i=e(n,r),m(i)):i=[];for(a=0;a<t.length;a++){l=t[a];if(0===l.refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete o[l.id]}}}}function m(n){for(var r=0;r<n.length;r++){var t=n[r],e=o[t.id];if(e){e.refs++;for(var a=0;a<e.parts.length;a++)e.parts[a](t.parts[a]);for(;a<t.parts.length;a++)e.parts.push(g(t.parts[a]));e.parts.length>t.parts.length&&(e.parts.length=t.parts.length)}else{var i=[];for(a=0;a<t.parts.length;a++)i.push(g(t.parts[a]));o[t.id]={id:t.id,refs:1,parts:i}}}}function v(){var n=document.createElement("style");return n.type="text/css",i.appendChild(n),n}function g(n){var r,t,e=document.querySelector('style[data-vue-ssr-id~="'+n.id+'"]');if(e){if(c)return d;e.parentNode.removeChild(e)}if(f){var a=l++;e=s||(s=v()),r=w.bind(null,e,a,!1),t=w.bind(null,e,a,!0)}else e=v(),r=b.bind(null,e),t=function(){e.parentNode.removeChild(e)};return r(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap)return;r(n=e)}else t()}}var h=function(){var n=[];return function(r,t){return n[r]=t,n.filter(Boolean).join("\n")}}();function w(n,r,t,e){var a=t?"":E(e.css);if(n.styleSheet)n.styleSheet.cssText=h(r,a);else{var o=document.createTextNode(a),i=n.childNodes;i[r]&&n.removeChild(i[r]),i.length?n.insertBefore(o,i[r]):n.appendChild(o)}}function b(n,r){var t=E(r.css),e=r.media,a=r.sourceMap;if(e&&n.setAttribute("media",e),u.ssrId&&n.setAttribute("data-vue-ssr-id",r.id),a&&(t+="\n/*# sourceURL="+a.sources[0]+" */",t+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),n.styleSheet)n.styleSheet.cssText=t;else{while(n.firstChild)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(t))}}var y=/%\?([+-]?\d+(\.\d+)?)\?%/g,C=/\.\?%PAGE\?%/g,x=/\?%PAGE\?%\[data-v-[a-z0-9]{8}\]/g,k=/uni-page-body\[data-v-[a-z0-9]{8}\]/g,_=/var\(--status-bar-height\)/gi,I=/var\(--window-top\)/gi,F=/var\(--window-bottom\)/gi,T=/var\(--window-left\)/gi,P=/var\(--window-right\)/gi;function E(n){var r=function(){var n="function"===typeof getApp&&getApp();return n&&n.$route&&n.$route.meta&&n.$route.meta.name||""}();if("undefined"!==typeof uni&&!uni.canIUse("css.var")){var t=function(){var n="function"===typeof getApp&&getApp();if(n&&n.$route&&n.$route.meta&&n.$route.meta.name)return{top:n.$route.meta.windowTop,bottom:n.$route.meta.isTabBar?50:0};return{top:0,bottom:0}}();n=n.replace(_,"0px").replace(I,t.top+"px").replace(F,t.bottom+"px").replace(T,"0px").replace(P,"0px")}return n.replace(x,r).replace(C,"").replace(k,"body."+r+" uni-page-body").replace(/\{[\s\S]+?\}|@media.+?\{/g,(function(n){return"undefined"===typeof uni?n:n.replace(y,(function(n,r){return uni.upx2px(r)+"px"}))}))}},9820:function(n,r,t){"use strict";var e=t("3255"),a=t.n(e);a.a},"9d3a":function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,t("bf0f"),t("0c26");var a=e(t("39d8")),o=t("11ca"),i=o.cloudCall,s={data:function(){return{folders:[],isLoading:!0,selectedFolderId:"",showCreateModal:!1,newFolderName:"",showClone:!1}},props:{show:{type:Boolean,default:!1},postId:{type:String,default:""}},watch:(0,a.default)({show:function(n){n&&this.loadFolders()}},"show",{handler:function(n,r){this.showClone=n},immediate:!0}),methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(n,r,Object.assign({pageTag:"folder-selector",context:this,requireAuth:!0},t))},loadFolders:function(){var n=this;console.log("开始加载收藏夹列表..."),this.setData({isLoading:!0});var r=this.$requireOpenid&&this.$requireOpenid();r?this.callCloudFunction("getMyProfileData",{action:"getFavoriteFolders",openid:r}).then((function(r){if(console.log("folder-selector获取收藏夹:",r),r.result&&r.result.success){var t=r.result.folders||[];console.log("获取到收藏夹数量:",t.length);var e=n.selectedFolderId;e&&!t.some((function(n){return n._id===e}))&&(console.log("清空失效的选中状态"),n.setData({selectedFolderId:""})),n.setData({folders:t,isLoading:!1})}else{var a;uni.showToast({title:(null===(a=r.result)||void 0===a?void 0:a.message)||"加载失败",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})}})).catch((function(r){console.error("获取收藏夹失败:",r),uni.showToast({title:"网络错误",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})})):this.setData({isLoading:!1,folders:[],selectedFolderId:""})},selectFolder:function(n){var r=n.currentTarget.dataset.folderId;this.setData({selectedFolderId:r})},confirmFavorite:function(){var n=this,r=this.selectedFolderId,e=this.postId;if(console.log("确认收藏，postId:",e,"folderId:",r),r){if(!e)return console.error("postId 为空，无法收藏"),void uni.showToast({title:"参数错误：帖子ID为空",icon:"none"});var a=this.$requireOpenid&&this.$requireOpenid();a&&(uni.showLoading({title:"收藏中..."}),this.callCloudFunction("getMyProfileData",{action:"addToFavorite",postId:e,folderId:r,openid:a}).then((function(r){if(uni.hideLoading(),console.log("确认收藏返回结果:",r),r&&r.result)if(r.result.success){uni.showToast({title:"收藏成功"}),console.log("收藏成功，开始关闭弹窗"),n.setData({selectedFolderId:""}),setTimeout((function(){n.hideModal()}),1500),n.$emit("favoriteSuccess");try{var a=getApp(),o=a&&a.globalData&&a.globalData.openid,i=t("80fa"),s=i.emitFavoriteChanged;s({userId:o,postId:e,favored:!0})}catch(l){}}else console.error("收藏业务失败:",r.result),uni.showToast({title:r.result.message||"收藏失败",icon:"none"});else console.error("收藏返回格式异常:",r),uni.showToast({title:"收藏失败：返回格式错误",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("收藏云函数调用失败:",n),uni.showToast({title:"网络错误："+(n.errMsg||"未知错误"),icon:"none"})})))}else uni.showToast({title:"请选择收藏夹",icon:"none"})},createFolder:function(){this.setData({showCreateModal:!0,newFolderName:""})},hideCreateModal:function(){this.setData({showCreateModal:!1,newFolderName:""})},onFolderNameInput:function(n){var r=n.detail.value;this.setData({newFolderName:r})},createNewFolder:function(){var n=this,r=this.newFolderName.trim();if(r){this.setData({newFolderName:r}),console.log("组件开始创建收藏夹，名称:",r);var t=this.$requireOpenid&&this.$requireOpenid();t&&(uni.showLoading({title:"创建中..."}),this.callCloudFunction("getMyProfileData",{action:"createFavoriteFolder",folderName:r,openid:t}).then((function(r){uni.hideLoading(),console.log("组件创建收藏夹返回结果:",r),r&&r.result?r.result.success?(uni.showToast({title:"创建成功",duration:2e3}),n.setData({showCreateModal:!1}),setTimeout((function(){n.loadFolders()}),300)):(console.error("组件创建收藏夹业务失败:",r.result),uni.showToast({title:r.result.message||"创建失败",icon:"none",duration:3e3})):(console.error("组件创建收藏夹返回格式异常:",r),uni.showToast({title:"创建失败：返回格式错误",icon:"none",duration:3e3}))})).catch((function(n){uni.hideLoading(),console.error("组件创建收藏夹云函数调用失败:",n),uni.showToast({title:"创建失败: "+(n.errMsg||"网络错误"),icon:"none",duration:3e3})})))}else uni.showToast({title:"请输入收藏夹名称",icon:"none"})},hideModal:function(){console.log("=== 点击关闭按钮，开始隐藏弹窗 ==="),console.log("当前状态：",{show:this.show,showCreateModal:this.showCreateModal,selectedFolderId:this.selectedFolderId}),this.setData({selectedFolderId:"",showClone:!1,showCreateModal:!1,newFolderName:""}),console.log("=== 弹窗已隐藏，状态已重置 ==="),this.$emit("hide")},trueFun:function(){console.log("占位：函数 true 未声明")}},created:function(){}};r.default=s},a6d2:function(n,r,t){"use strict";t.d(r,"b",(function(){return e})),t.d(r,"c",(function(){return a})),t.d(r,"a",(function(){}));var e=function(){var n=this,r=n.$createElement,t=n._self._c||r;return n.showTip?t("v-uni-view",{staticClass:"install_tip"},[t("v-uni-view",{staticClass:"install_tip_back"}),t("v-uni-view",{staticClass:"install_tip_detail"},[t("v-uni-image",{staticClass:"install_tip_close",attrs:{src:"/static/images/icons/close.png"},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onClose.apply(void 0,arguments)}}}),t("v-uni-view",{staticClass:"install_tip_detail_title"},[n._v(n._s(n.title))]),t("v-uni-view",{staticClass:"install_tip_detail_tip"},[n._v(n._s(n.content))])],1)],1):n._e()},a=[]},b348:function(n,r,t){"use strict";t.d(r,"b",(function(){return e})),t.d(r,"c",(function(){return a})),t.d(r,"a",(function(){}));var e=function(){var n=this,r=n.$createElement,t=n._self._c||r;return t("v-uni-view",[n.showClone?t("v-uni-view",{staticClass:"modal-overlay"},[t("v-uni-view",{staticClass:"modal-content"},[t("v-uni-view",{staticClass:"modal-header"},[t("v-uni-view",{staticClass:"modal-title"},[n._v("选择收藏夹")]),t("v-uni-view",{staticClass:"close-btn",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.hideModal.apply(void 0,arguments)}}},[n._v("×")])],1),t("v-uni-view",{staticClass:"modal-body"},[n.isLoading?t("v-uni-view",{staticClass:"loading-container"},[t("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1):n.folders.length>0?t("v-uni-view",{staticClass:"folders-list"},n._l(n.folders,(function(r,e){return t("v-uni-view",{key:e,class:"folder-item "+(n.selectedFolderId===r._id?"selected":""),attrs:{"data-folder-id":r._id},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.selectFolder.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"folder-icon"},[n._v("📁")]),t("v-uni-view",{staticClass:"folder-info"},[t("v-uni-view",{staticClass:"folder-name"},[n._v(n._s(r.name))]),t("v-uni-view",{staticClass:"folder-count"},[n._v(n._s(r.itemCount)+" 个收藏")])],1),n.selectedFolderId===r._id?t("v-uni-view",{staticClass:"selected-icon"},[n._v("✓")]):n._e()],1)})),1):t("v-uni-view",{staticClass:"empty-state"},[t("v-uni-view",{staticClass:"empty-icon"},[n._v("📁")]),t("v-uni-view",{staticClass:"empty-text"},[n._v("还没有收藏夹")]),t("v-uni-view",{staticClass:"empty-subtext"},[n._v("先创建一个收藏夹吧")])],1)],1),t("v-uni-view",{staticClass:"modal-footer"},[t("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.createFolder.apply(void 0,arguments)}}},[n._v("创建收藏夹")]),t("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.selectedFolderId},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.confirmFavorite.apply(void 0,arguments)}}},[n._v("确认收藏")])],1)],1)],1):n._e(),n.showCreateModal?t("v-uni-view",{staticClass:"modal-overlay"},[t("v-uni-view",{staticClass:"modal-content create-modal"},[t("v-uni-view",{staticClass:"modal-header"},[t("v-uni-view",{staticClass:"modal-title"},[n._v("创建收藏夹")]),t("v-uni-view",{staticClass:"close-btn",on:{click:[function(r){arguments[0]=r=n.$handleEvent(r),n.hideCreateModal.apply(void 0,arguments)},function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.trueFun.apply(void 0,arguments)}]}},[n._v("×")])],1),t("v-uni-view",{staticClass:"modal-body"},[t("v-uni-input",{staticClass:"folder-name-input",attrs:{placeholder:"请输入收藏夹名称",value:n.newFolderName,focus:!0},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onFolderNameInput.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.trueFun.apply(void 0,arguments)}}})],1),t("v-uni-view",{staticClass:"modal-footer"},[t("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.hideCreateModal.apply(void 0,arguments)}}},[n._v("取消")]),t("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.newFolderName},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.createNewFolder.apply(void 0,arguments)}}},[n._v("创建")])],1)],1)],1):n._e()],1)},a=[]},c86c:function(n,r,t){"use strict";n.exports=function(n){var r=[];return r.toString=function(){return this.map((function(r){var t=function(n,r){var t=n[1]||"",e=n[3];if(!e)return t;if(r&&"function"===typeof btoa){var a=function(n){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),t="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r);return"/*# ".concat(t," */")}(e),o=e.sources.map((function(n){return"/*# sourceURL=".concat(e.sourceRoot||"").concat(n," */")}));return[t].concat(o).concat([a]).join("\n")}return[t].join("\n")}(r,n);return r[2]?"@media ".concat(r[2]," {").concat(t,"}"):t})).join("")},r.i=function(n,t,e){"string"===typeof n&&(n=[[null,n,""]]);var a={};if(e)for(var o=0;o<this.length;o++){var i=this[o][0];null!=i&&(a[i]=!0)}for(var s=0;s<n.length;s++){var l=[].concat(n[s]);e&&a[l[0]]||(t&&(l[2]?l[2]="".concat(t," and ").concat(l[2]):l[2]=t),r.push(l))}},r}},d242:function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* components/folder-selector/folder-selector.wxss */.modal-overlay[data-v-3a05c372]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[data-v-3a05c372]{background:#fff;border-radius:%?16?%;margin:%?40?%;width:calc(100% - %?80?%);max-width:%?600?%;max-height:80vh;display:flex;flex-direction:column}.modal-header[data-v-3a05c372]{display:flex;align-items:center;justify-content:space-between;padding:%?30?% %?40?%;border-bottom:%?1?% solid #f0f0f0}.modal-title[data-v-3a05c372]{font-size:%?36?%;font-weight:500;color:#333}.close-btn[data-v-3a05c372]{font-size:%?48?%;color:#999;line-height:1;position:relative;z-index:1001}.modal-body[data-v-3a05c372]{flex:1;padding:%?20?% 0;max-height:60vh;overflow-y:auto}.loading-container[data-v-3a05c372]{display:flex;justify-content:center;align-items:center;height:%?200?%}.loading-text[data-v-3a05c372]{color:#999;font-size:%?28?%}.folders-list[data-v-3a05c372]{padding:0 %?40?%}.folder-item[data-v-3a05c372]{display:flex;align-items:center;padding:%?24?% 0;border-bottom:%?1?% solid #f8f8f8}.folder-item[data-v-3a05c372]:last-child{border-bottom:none}.folder-item.selected[data-v-3a05c372]{background:rgba(7,193,96,.1);border-radius:%?8?%;padding:%?24?% %?20?%;margin:0 %?-20?%}.folder-icon[data-v-3a05c372]{font-size:%?40?%;margin-right:%?20?%}.folder-info[data-v-3a05c372]{flex:1}.folder-name[data-v-3a05c372]{font-size:%?30?%;color:#333;font-weight:500;margin-bottom:%?4?%}.folder-count[data-v-3a05c372]{font-size:%?24?%;color:#999}.selected-icon[data-v-3a05c372]{font-size:%?32?%;color:#9ed7ee;font-weight:700}.empty-state[data-v-3a05c372]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:%?200?%;padding:%?40?%}.empty-icon[data-v-3a05c372]{font-size:%?60?%;margin-bottom:%?16?%;opacity:.5}.empty-text[data-v-3a05c372]{font-size:%?28?%;color:#666;margin-bottom:%?8?%}.empty-subtext[data-v-3a05c372]{font-size:%?24?%;color:#999}.modal-footer[data-v-3a05c372]{display:flex;gap:%?20?%;padding:%?30?% %?40?%;border-top:%?1?% solid #f0f0f0}.modal-btn[data-v-3a05c372]{flex:1;height:%?80?%;border-radius:%?8?%;font-size:%?28?%;border:none;display:flex;align-items:center;justify-content:center;position:relative;z-index:1001}.secondary-btn[data-v-3a05c372]{background:#f5f5f5;color:#666}.primary-btn[data-v-3a05c372]{background:#9ed7ee;color:#fff}.primary-btn[data-v-3a05c372]:disabled{background:#ccc;color:#999}\r\n/* 创建收藏夹弹窗样式 */.create-modal .modal-body[data-v-3a05c372]{padding:%?40?%}.folder-name-input[data-v-3a05c372]{width:100%;height:%?80?%;padding:0 %?20?%;border:%?2?% solid #e0e0e0;border-radius:%?8?%;font-size:%?30?%;box-sizing:border-box}.folder-name-input[data-v-3a05c372]:focus{border-color:#9ed7ee}",""]),n.exports=r},daaa:function(n,r,t){"use strict";t.r(r);var e=t("9d3a"),a=t.n(e);for(var o in e)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(o);r["default"]=a.a},df21:function(n,r,t){"use strict";t.d(r,"b",(function(){return a})),t.d(r,"c",(function(){return o})),t.d(r,"a",(function(){return e}));var e={folderSelector:t("84be").default},a=function(){var n=this,r=n.$createElement,t=n._self._c||r;return t("v-uni-view",[t("v-uni-view",{staticClass:"container"},[n.isLoading?[t("v-uni-view",{staticClass:"loading-container"},[t("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1)]:n.post&&n.post._id?[t("v-uni-view",{class:"post-detail-card "+(n.post.isOriginal?"original-post":"")},[t("v-uni-view",{staticClass:"author-info"},[t("v-uni-view",{staticClass:"author-basic"},[n.post.authorAvatar?t("v-uni-image",{staticClass:"author-avatar",attrs:{src:n.post.authorAvatar,mode:"aspectFill","data-user-id":n.post._openid},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onAvatarError.apply(void 0,arguments)},click:function(r){arguments[0]=r=n.$handleEvent(r),n.navigateToUserProfile.apply(void 0,arguments)}}}):n._e(),t("v-uni-text",{staticClass:"author-name"},[n._v(n._s(n.post.authorName))]),n.isMutualFollow?t("v-uni-view",{staticClass:"mutual-tag"},[n._v("互相关注")]):n.isFollowedByAuthor?t("v-uni-view",{staticClass:"followed-tag"},[n._v("TA关注了你")]):n._e()],1),n.showFollowButton?t("v-uni-button",{class:"follow-btn "+(n.isFollowing?"following":""),attrs:{loading:n.followPending,disabled:n.followPending},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onFollowTap.apply(void 0,arguments)}}},[n._v(n._s(n.isFollowing?"已关注":"关注"))]):n._e()],1),t("v-uni-view",{staticClass:"post-title"},[n._v(n._s(n.post.title))]),n.post.isPoem&&n.post.author?t("v-uni-view",{staticClass:"poem-author"},[n._v(n._s(n.post.author))]):n._e(),n.post.content?t("v-uni-view",{staticClass:"post-content"},[n._v(n._s(n.post.content))]):n._e(),n.post.tags&&n.post.tags.length>0?t("v-uni-view",{staticClass:"post-tags"},n._l(n.post.tags,(function(r,e){return t("v-uni-text",{key:e,staticClass:"post-tag",attrs:{"data-tag":r},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onTagClick.apply(void 0,arguments)}}},[n._v("#"+n._s(r))])})),1):n._e(),n.post.imageUrl||n.post.imageUrls&&n.post.imageUrls.length>0?t("v-uni-view",{staticClass:"image-container",attrs:{id:"detail-image-container"}},[n.post.imageUrls&&1===n.post.imageUrls.length?[t("v-uni-image",{style:"width: 100%; height: "+(n.post&&n.post._id&&n.imageClampHeights[n.post._id]?n.imageClampHeights[n.post._id]+"px":"auto")+"; object-fit: "+(n.post&&n.post._id&&n.imageClampHeights[n.post._id]?"cover":"contain")+"; background-color: #f0f0f0;",attrs:{id:"single-image-"+(n.post&&n.post._id?n.post._id:""),src:n.post.imageUrls[0],mode:n.post&&n.post._id&&n.imageClampHeights[n.post._id]?"aspectFill":"widthFix","data-postid":n.post&&n.post._id?n.post._id:"","data-type":"single","data-src":n.post.imageUrls[0],"data-original-image-urls":n.post.originalImageUrls||n.post.imageUrls,"lazy-load":!0},on:{load:function(r){arguments[0]=r=n.$handleEvent(r),n.onImageLoad.apply(void 0,arguments)},error:function(r){arguments[0]=r=n.$handleEvent(r),n.onImageError.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.handlePreview.apply(void 0,arguments)}}})]:n.post.imageUrls&&n.post.imageUrls.length>1?[t("v-uni-swiper",{staticClass:"image-swiper",style:"width: 100%; height: "+(n.swiperHeights[0]?n.swiperHeights[0]+"px":"220px")+";",attrs:{id:"swiper-"+(n.post&&n.post._id?n.post._id:""),"indicator-dots":!0,circular:!0}},[n._l(n.post.imageUrls,(function(r,e){return[t("v-uni-swiper-item",[t("v-uni-image",{staticStyle:{width:"100%",height:"100%","object-fit":"cover","background-color":"#f0f0f0"},attrs:{src:r,mode:"aspectFill","data-postid":n.post&&n.post._id?n.post._id:"","data-postindex":"0","data-imgindex":e,"data-type":"multi","data-src":r,"data-original-image-urls":n.post.originalImageUrls||n.post.imageUrls,"lazy-load":!0},on:{load:function(r){arguments[0]=r=n.$handleEvent(r),n.onImageLoad.apply(void 0,arguments)},error:function(r){arguments[0]=r=n.$handleEvent(r),n.onImageError.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.handlePreview.apply(void 0,arguments)}}})],1)]}))],2)]:n._e()],2):n._e(),t("v-uni-view",{staticClass:"post-meta"},[t("v-uni-text",{staticClass:"post-time"},[n._v(n._s(n.post.formattedCreateTime))])],1),t("v-uni-view",{staticClass:"vote-section",on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.preventBubble.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"actions-left"},[t("v-uni-button",{class:n.favoriteButtonClass,attrs:{size:"mini"},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onFavorite.apply(void 0,arguments)}}},[n._v(n._s(n.favoriteButtonText))])],1),t("v-uni-view",{staticClass:"button-group"},[t("v-uni-view",{staticClass:"comment-count"},[t("v-uni-text",{staticClass:"action-emoji"},[n._v("💬")]),t("v-uni-text",{staticClass:"action-text"},[n._v(n._s(n.commentCount))])],1),t("v-uni-view",{staticClass:"like-icon-container",attrs:{"data-postid":n.post&&n.post._id?n.post._id:""},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onVote.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"like-icon",attrs:{src:n.post.likeIcon,mode:"aspectFit"}})],1),t("v-uni-view",{class:"vote-count "+(n.post.isVoted?"voted":"")},[t("v-uni-text",{staticClass:"action-text"},[n._v(n._s(n.post.votes||0))])],1)],1)],1)],1),t("v-uni-view",{staticClass:"comment-section"},[t("v-uni-view",{staticClass:"section-title"},[n._v("共"+n._s(n.commentCount)+" 条评论")]),t("v-uni-view",{staticClass:"comment-list"},[n.comments.length>0?n._l(n.comments,(function(r,e){return t("v-uni-view",{key:e,staticClass:"comment-item"},[t("v-uni-image",{staticClass:"comment-avatar",attrs:{src:r.authorAvatar,mode:"aspectFill","data-user-id":r._openid},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onAvatarError.apply(void 0,arguments)},click:function(r){arguments[0]=r=n.$handleEvent(r),n.navigateToUserProfile.apply(void 0,arguments)}}}),t("v-uni-view",{staticClass:"comment-main"},[t("v-uni-view",{staticClass:"comment-author"},[n._v(n._s(r.authorName))]),t("v-uni-view",{staticClass:"comment-content"},[n._v(n._s(r.content))]),r.imageUrls&&r.imageUrls.length?t("v-uni-view",{staticClass:"comment-image-grid"},n._l(r.imageUrls,(function(r,a){return t("v-uni-image",{key:a,staticClass:"comment-image",attrs:{src:r,mode:"aspectFill","data-comment-index":e,"data-image-index":a,"data-is-reply":!1},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.previewCommentImageFromList.apply(void 0,arguments)}}})})),1):n._e(),t("v-uni-view",{staticClass:"comment-footer"},[t("v-uni-view",{staticClass:"comment-time"},[n._v(n._s(r.formattedCreateTime))]),t("v-uni-view",{staticClass:"comment-actions"},[t("v-uni-view",{staticClass:"like-section",attrs:{"data-comment-id":r._id,"data-liked":r.liked},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.toggleLikeComment.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"like-icon",attrs:{src:r.likeIcon}}),t("v-uni-text",{staticClass:"like-count"},[n._v(n._s(r.likes||0))])],1),r.canDelete?t("v-uni-view",{staticClass:"delete-btn",attrs:{"data-comment-id":r._id},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onDeleteComment.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"delete-text"},[n._v("删除")])],1):n._e(),t("v-uni-view",{staticClass:"reply-btn",attrs:{"data-comment-id":r._id,"data-author-name":r.authorName},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.showReplyInput.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"reply-text"},[n._v("回复")])],1)],1)],1),r.replies&&r.replies.length>0?t("v-uni-view",{staticClass:"replies-container"},[n._l(r.replies,(function(a,o){return o<(r.showAllReplies?r.replies.length:3)?t("v-uni-view",{key:o,staticClass:"reply-item"},[t("v-uni-image",{staticClass:"reply-avatar",attrs:{src:a.authorAvatar,mode:"aspectFill","data-user-id":a._openid},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onAvatarError.apply(void 0,arguments)},click:function(r){arguments[0]=r=n.$handleEvent(r),n.navigateToUserProfile.apply(void 0,arguments)}}}),t("v-uni-view",{staticClass:"reply-main"},[t("v-uni-view",{staticClass:"reply-author"},[n._v(n._s(a.authorName))]),t("v-uni-view",{staticClass:"reply-content"},[t("v-uni-text",{staticClass:"reply-to"},[n._v("回复@"+n._s(r.authorName)+"：")]),t("v-uni-text",[n._v(n._s(a.content))])],1),a.imageUrls&&a.imageUrls.length?t("v-uni-view",{staticClass:"comment-image-grid reply-image-grid"},n._l(a.imageUrls,(function(r,a){return t("v-uni-image",{key:a,staticClass:"comment-image",attrs:{src:r,mode:"aspectFill","data-comment-index":e,"data-reply-index":o,"data-image-index":a,"data-is-reply":!0},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.previewCommentImageFromList.apply(void 0,arguments)}}})})),1):n._e(),t("v-uni-view",{staticClass:"reply-footer"},[t("v-uni-view",{staticClass:"reply-time"},[n._v(n._s(a.formattedCreateTime))]),t("v-uni-view",{staticClass:"reply-actions"},[t("v-uni-view",{staticClass:"like-section",attrs:{"data-comment-id":a._id,"data-liked":a.liked},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.toggleLikeComment.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"like-icon",attrs:{src:a.likeIcon}}),t("v-uni-text",{staticClass:"like-count"},[n._v(n._s(a.likes||0))])],1),a.canDelete?t("v-uni-view",{staticClass:"delete-btn",attrs:{"data-comment-id":a._id,"data-parent-id":r._id},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onDeleteComment.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"delete-text"},[n._v("删除")])],1):n._e(),t("v-uni-view",{staticClass:"reply-btn",attrs:{"data-comment-id":r._id,"data-author-name":a.authorName},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.showReplyInput.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"reply-text"},[n._v("回复")])],1)],1)],1)],1)],1):n._e()})),r.replies.length>3&&!r.showAllReplies?t("v-uni-view",{staticClass:"show-more-replies",attrs:{"data-comment-id":r._id},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.toggleShowAllReplies.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"show-more-text"},[n._v("显示"+n._s(r.replies.length-3)+"条回复")])],1):n._e(),r.replies.length>3&&r.showAllReplies?t("v-uni-view",{staticClass:"show-more-replies",attrs:{"data-comment-id":r._id},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.toggleShowAllReplies.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"show-more-text"},[n._v("收起回复")])],1):n._e()],2):n._e()],1)],1)})):[t("v-uni-view",{staticClass:"no-comment-tip"},[t("v-uni-view",{staticClass:"empty-icon"},[n._v("💬")]),t("v-uni-view",{staticClass:"empty-text"},[n._v("暂无评论，快来抢沙发吧！")])],1)]],2)],1)]:[t("v-uni-view",{staticClass:"error-container"},[t("v-uni-view",{staticClass:"error-icon"},[n._v("❌")]),t("v-uni-view",{staticClass:"error-text"},[n._v("帖子加载失败或不存在")])],1)]],2),t("v-uni-view",{class:"input-overlay "+(n.isInputExpanded?"show":""),on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.collapseInput.apply(void 0,arguments)}}}),t("v-uni-view",{staticClass:"comment-input-area",style:"bottom: "+n.keyboardHeight+"px;"},[n.isInputExpanded?n._e():t("v-uni-view",{staticClass:"collapsed-bar",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.expandInput.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"collapsed-input-placeholder"},[n._v("留下你的精彩评论...")])],1),n.isInputExpanded?t("v-uni-view",{staticClass:"expanded-container"},[n.replyToComment?t("v-uni-view",{staticClass:"reply-prompt"},[t("v-uni-text",{staticClass:"reply-prompt-text"},[n._v("回复 "+n._s(n.replyToAuthor)+"：")]),t("v-uni-view",{staticClass:"cancel-reply",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.cancelReply.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"cancel-text"},[n._v("取消")])],1)],1):n._e(),t("v-uni-textarea",{staticClass:"expanded-textarea",attrs:{placeholder:"留下你的精彩评论...",value:n.newComment,focus:n.isFocus,"auto-height":!0,maxlength:"500","show-confirm-bar":!1,"adjust-position":!1},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onCommentInput.apply(void 0,arguments)},focus:function(r){arguments[0]=r=n.$handleEvent(r),n.onInputFocus.apply(void 0,arguments)},blur:function(r){arguments[0]=r=n.$handleEvent(r),n.onInputBlur.apply(void 0,arguments)}}}),n.commentImages.length?t("v-uni-view",{staticClass:"selected-comment-images"},n._l(n.commentImages,(function(r,e){return t("v-uni-view",{key:e,staticClass:"selected-image-item",attrs:{"data-index":e}},[t("v-uni-image",{staticClass:"selected-image-thumb",attrs:{src:r.previewUrl,mode:"aspectFill","data-index":e},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.previewSelectedCommentImage.apply(void 0,arguments)}}}),t("v-uni-view",{staticClass:"remove-image-btn",attrs:{"data-index":e},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.removeCommentImage.apply(void 0,arguments)}}},[n._v("✕")])],1)})),1):n._e(),t("v-uni-view",{staticClass:"expanded-actions"},[t("v-uni-view",{staticClass:"action-icons"},[t("v-uni-view",{staticClass:"action-icon",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.chooseCommentImages.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"action-icon-text"},[n._v("🖼️")])],1),t("v-uni-view",{staticClass:"action-icon",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.toggleEmojiPanel.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"action-icon-text"},[n._v("😊")])],1)],1),t("v-uni-button",{staticClass:"submit-button",attrs:{disabled:n.isSubmitDisabled},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onSubmitComment.apply(void 0,arguments)}}},[n._v("发送")])],1),n.showEmojiPanel?t("v-uni-view",{staticClass:"emoji-panel"},n._l(n.emojiList,(function(r,e){return t("v-uni-text",{key:e,staticClass:"emoji-item",attrs:{"data-emoji":r},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.insertEmoji.apply(void 0,arguments)}}},[n._v(n._s(r))])})),1):n._e()],1):n._e()],1),t("cloud-tip-modal",{attrs:{showUploadTip:n.showUploadTip}}),t("folder-selector",{attrs:{show:n.showFavoriteModal,"post-id":n.post&&n.post._id?n.post._id:""},on:{hide:function(r){arguments[0]=r=n.$handleEvent(r),n.hideFavoriteModal.apply(void 0,arguments)},favoriteSuccess:function(r){arguments[0]=r=n.$handleEvent(r),n.onFavoriteSuccess.apply(void 0,arguments)}}})],1)},o=[]},df61:function(n,r,t){var e=t("dd7e").default,a=t("46c5").default;t("64aa"),t("dc8a"),t("8f71"),t("bf0f"),t("9db6"),t("2797"),t("de6c"),t("7a76"),t("c9b5");var o=t("11ca"),i=o.cloudCall,s=t("fe58"),l=t("3ab8").default;function c(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=Number(n);return Number.isFinite(t)?t:r}function d(n,r,t){if("function"===typeof n)try{return n(r,t)}catch(e){console.warn("[likeService] likeIcon resolver 执行失败",e)}return s.getLikeIcon(r,t)}function u(n){var r=n.votes,t=n.isLiked,e=n.icon;return{votes:r,isLiked:t,likeIcon:e}}function f(n,r,t,e){try{if(!n)return;var a=l.getStats?l.getStats():{},o=Object.keys(a),i=o.filter((function(n){return"posts:home"===n||"posts:discover"===n||n.startsWith("posts:tag:")||n.startsWith("me:posts")||n.startsWith("userPosts:")}));i.forEach((function(a){try{var o=l.namespace(a),i=o.keys&&o.keys()||[];i.forEach((function(a){try{o.update(a,(function(a){if(!Array.isArray(a))return a;for(var o=0;o<a.length;o+=1){var i=a[o];!i||i._id!==n&&i.id!==n||(i.votes=r,i.isVoted=t,i.likeIcon=e,!0)}return a}))}catch(i){}}))}catch(s){}}))}catch(s){console.warn("[likeService] updatePostInCaches failed",s)}}function p(n){if("undefined"!==typeof uni&&"function"===typeof uni.showToast)try{uni.showToast({title:n||"操作失败，请稍后重试",icon:"none"})}catch(r){console.warn("[likeService] showToast 调用失败",r)}}function m(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.pageTag,t=void 0===r?"like-service":r,e=n.context,a=void 0===e?null:e,o=n.currentVotes,i=void 0===o?0:o,l=n.currentIsLiked,d=void 0!==l&&l,u=n.likeIconResolver,f=void 0===u?s.getLikeIcon:u,p=n.requireAuth,m=void 0===p||p,v=n.retry,g=void 0===v?0:v,h=n.updateCache,w=void 0===h||h,b=n.showErrorToast,y=void 0===b||b,C=n.cloudOptions,x=void 0===C?{}:C;return{pageTag:t,context:a,currentVotes:c(i,0),currentIsLiked:Boolean(d),likeIconResolver:f,requireAuth:m,retry:g,updateCache:w,showErrorToast:y,cloudOptions:x}}function v(){return v=a(e().mark((function n(r){var t,a,o,s,l,v,g,h,w,b,y,C,x,k,_,I,F,T,P,E,U,D,A,S=arguments;return e().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t=S.length>1&&void 0!==S[1]?S[1]:{},r){n.next=3;break}return n.abrupt("return",Promise.reject(new Error("[likeService] postId 不能为空")));case 3:return a=m(t),o=a.pageTag,s=a.context,l=a.currentVotes,v=a.currentIsLiked,g=a.likeIconResolver,h=a.requireAuth,w=a.retry,b=a.updateCache,y=a.showErrorToast,C=a.cloudOptions,x=c(l,0),k=Boolean(v),_=d(g,x,k),I=u({votes:x,isLiked:k,icon:_}),n.prev=8,n.next=11,i("vote",{postId:r},Object.assign({pageTag:"likeService:".concat(o),context:s,requireAuth:h,retry:w},C));case 11:F=n.sent,n.next=19;break;case 14:return n.prev=14,n.t0=n["catch"](8),console.error("[likeService] 调用云函数失败",n.t0),y&&p(n.t0&&n.t0.message),n.abrupt("return",{success:!1,error:n.t0,rollback:I});case 19:if(T=F&&F.result?F.result:F,P=T&&!0===T.success,P){n.next=26;break}return E=T&&T.message?T.message:"操作失败，请稍后重试",console.warn("[likeService] 云函数返回失败结果",T),y&&p(E),n.abrupt("return",{success:!1,error:T,rollback:I});case 26:return U=c(T.votes,x),D=Boolean(T.isLiked),A=d(g,U,D),b&&f(r,U,D,A),n.abrupt("return",{success:!0,votes:U,isLiked:D,likeIcon:A,response:T});case 31:case"end":return n.stop()}}),n,null,[[8,14]])}))),v.apply(this,arguments)}n.exports={togglePostLike:function(n){return v.apply(this,arguments)}}},f005:function(n,r,t){var e=t("4982");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("794aab24",e,!0,{sourceMap:!1,shadowMode:!1})},f0b9:function(n,r,t){var e=t("221b");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("9b847392",e,!0,{sourceMap:!1,shadowMode:!1})},f7a1:function(n,r,t){"use strict";t.r(r);var e=t("a6d2"),a=t("3ccb");for(var o in a)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(o);t("0691");var i=t("828b"),s=Object(i["a"])(a["default"],e["b"],e["c"],!1,null,"a8601b98",null,!1,e["a"],void 0);r["default"]=s.exports},fe58:function(n,r){n.exports={getLikeIcon:function(n,r){var t="";return t=n<=3?r?"seedplus.png":"seed.png":n<=7?r?"leafplus.png":"leaf.png":n<=15?r?"flowerplus .png":"flower.png":r?"peachplus.png":"peach.png","/static/images/"+t},getLikeIconDescription:function(n){return n<=3?"种子":n<=7?"叶子":n<=15?"花":"果实"}}}}]);