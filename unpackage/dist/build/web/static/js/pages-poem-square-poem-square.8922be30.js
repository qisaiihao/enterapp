(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-poem-square-poem-square"],{1505:function(t,e,a){"use strict";var n=a("8e76"),o=a.n(n);o.a},"1e76":function(t,e,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(a("39d8")),i=n(a("2634")),r=n(a("2fdc"));a("5c47"),a("8f71"),a("bf0f"),a("5ef2"),a("2797"),a("c223"),a("7a76"),a("c9b5");var s=n(a("724b")),c=n(a("71b6")),u=n(a("c4b7")),l=n(a("71b6")),d=a("38db"),p=d.cloudCall,g=a("9167"),f={onShow:function(){try{uni.hideTabBar({animation:!1})}catch(t){}try{this.$refs.customTabBar&&this.$refs.customTabBar.syncSelected&&this.$refs.customTabBar.syncSelected()}catch(t){}},components:{skeleton:c.default,topBar:u.default,AppTabBar:s.default},data:function(){return{postList:[],page:0,hasMore:!0,isLoading:!0,isLoadingMore:!1,lastUsedColorIndex:-1,backgroundColors:["#a4c4bd","#c9cfcf","#906161","#909388"],showPageIndicator:!1,votingInProgress:{},fetchingSignatures:{}}},onLoad:function(){this.getIndexData()},onPullDownRefresh:function(){console.log("„Äêpoem-square„Äëüì± ‰∏ãÊãâÂà∑Êñ∞ÔºåÈáçÊñ∞Ëé∑ÂèñÊï∞ÊçÆ"),this.getIndexData((function(){uni.stopPullDownRefresh()}))},onPageScroll:function(t){var e=this;this._scrollTimer&&clearTimeout(this._scrollTimer),this._scrollTimer=setTimeout((function(){if(e.hasMore&&!e.isLoadingMore&&!e.isLoading)try{var a=uni.getSystemInfoSync(),n=a.windowHeight;uni.createSelectorQuery().in(e).select("#post-list-container").boundingClientRect((function(a){if(a&&a.height){var o=a.height-t.scrollTop-n,i=1.5*n;o<i&&(e.showPageIndicator=!0,e.getPostList((function(){e.showPageIndicator=!1})))}})).exec()}catch(o){}}),100)},methods:{callCloudFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p(t,e,Object.assign({pageTag:"poem-square",context:this,requireAuth:!1},a))},getIndexData:function(){var t=this;this.isLoading=!0,this.page=0,this.postList=[],this.getPostList((function(){t.isLoading=!1}))},generateRandomBackgroundColor:function(){var t=this.backgroundColors,e=this.lastUsedColorIndex;if(-1===e){var a=Math.floor(Math.random()*t.length);return this.lastUsedColorIndex=a,t[a]}var n=t.filter((function(t,a){return a!==e})),o=n[Math.floor(Math.random()*n.length)];return this.lastUsedColorIndex=t.indexOf(o),o},getPostList:function(t){var e=this;return(0,r.default)((0,i.default)().mark((function a(){var n,o;return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.isLoadingMore){a.next=2;break}return a.abrupt("return");case 2:return e.isLoadingMore=!0,a.prev=3,a.next=6,e.callCloudFunction("getPostList",{skip:10*e.page,limit:10,isPoem:!0,isOriginal:!0});case 6:n=a.sent,o=n&&n.result&&n.result.posts?n.result.posts:[],o.forEach((function(t){t.backgroundColor=e.generateRandomBackgroundColor(),t.textColor="#222",t.isExpanded=!1,t.authorSignature="",t.likeIcon=g&&g.getLikeIcon?g.getLikeIcon(t.votes||0,!!t.isVoted):""})),e.postList=0===e.page?o:e.postList.concat(o),e.page+=1,e.hasMore=10===o.length,e.postList.forEach((function(t,a){t._openid&&!t.authorSignature&&e.fetchAuthorSignature(t._openid,a)})),a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](3),uni.showToast({title:"Âä†ËΩΩÂ§±Ë¥•",icon:"none"});case 18:return a.prev=18,e.isLoadingMore=!1,"function"===typeof t&&t(),a.finish(18);case 22:case"end":return a.stop()}}),a,null,[[3,15,18,22]])})))()},togglePostExpansion:function(t){var e=t.currentTarget.dataset.index,a=this.postList[e],n=!a.isExpanded;this.setData((0,o.default)({},"postList[".concat(e,"].isExpanded"),n)),a._openid&&!a.authorSignature&&this.fetchAuthorSignature(a._openid,e)},onCommentClick:function(t){var e=t.currentTarget.dataset.postid;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(e)})},onLikeIconError:function(){},fetchAuthorSignature:function(t,e){var a=this;return(0,r.default)((0,i.default)().mark((function n(){var r,s;return(0,i.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t&&!a.fetchingSignatures[t]){n.next=2;break}return n.abrupt("return");case 2:return a.fetchingSignatures[t]=!0,n.prev=3,n.next=6,a.callCloudFunction("getUserProfile",{userId:t});case 6:r=n.sent,r.result&&r.result.success&&r.result.userInfo&&r.result.userInfo.signatureUrl?(s=r.result.userInfo.signatureUrl,console.log("„Äêpoem-square„ÄëËé∑ÂèñÂà∞‰ΩúËÄÖÁ≠æÂêç:",s),a.setData((0,o.default)({},"postList[".concat(e,"].authorSignature"),s))):(console.log("„Äêpoem-square„Äë‰ΩúËÄÖÊú™ËÆæÁΩÆÁ≠æÂêç"),a.setData((0,o.default)({},"postList[".concat(e,"].authorSignature"),""))),n.next=14;break;case 10:n.prev=10,n.t0=n["catch"](3),console.error("„Äêpoem-square„ÄëËé∑Âèñ‰ΩúËÄÖÁ≠æÂêçÂ§±Ë¥•:",n.t0),a.setData((0,o.default)({},"postList[".concat(e,"].authorSignature"),""));case 14:return n.prev=14,delete a.fetchingSignatures[t],n.finish(14);case 17:case"end":return n.stop()}}),n,null,[[3,10,14,17]])})))()},onSignatureLoad:function(t){console.log("„Äêpoem-square„ÄëÁ≠æÂêçÂõæÁâáÂä†ËΩΩÊàêÂäü:",t)},onSignatureError:function(t){console.error("„Äêpoem-square„ÄëÁ≠æÂêçÂõæÁâáÂä†ËΩΩÂ§±Ë¥•:",t)},onVote:function(t){var e=this;return(0,r.default)((0,i.default)().mark((function a(){var n,r,s,c,u,l;return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=t.currentTarget.dataset.postid,r=t.currentTarget.dataset.index,!e.votingInProgress[n]){a.next=4;break}return a.abrupt("return");case 4:return e.setData((0,o.default)({},"votingInProgress.".concat(n),!0)),s=e.postList,c=s[r].votes||0,u=!!s[r].isVoted,s[r].votes=u?c-1:c+1,s[r].isVoted=!u,s[r].likeIcon=g.getLikeIcon(s[r].votes,s[r].isVoted),e.setData({postList:s}),a.prev=12,a.next=15,e.callCloudFunction("vote",{postId:n});case 15:if(l=a.sent,l&&l.result&&l.result.success){a.next=18;break}throw new Error("vote failed");case 18:"number"===typeof l.result.votes&&l.result.votes!==s[r].votes&&e.setData((0,o.default)({},"postList[".concat(r,"].votes"),l.result.votes)),a.next=28;break;case 21:a.prev=21,a.t0=a["catch"](12),s[r].votes=c,s[r].isVoted=u,s[r].likeIcon=g.getLikeIcon(c,u),e.setData({postList:s}),uni.showToast({title:"Êìç‰ΩúÂ§±Ë¥•",icon:"none"});case 28:return a.prev=28,e.setData((0,o.default)({},"votingInProgress.".concat(n),!1)),a.finish(28);case 31:case"end":return a.stop()}}),a,null,[[12,21,28,31]])})))()},touchStart:function(){},touchEnd:function(){}}};e.default=f,e.default.components=Object.assign({skeleton:l.default},e.default.components||{})},"252c":function(t,e,a){"use strict";a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return n}));var n={topBar:a("c4b7").default,skeleton:a("71b6").default},o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"poem-square white-bg",on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.touchEnd.apply(void 0,arguments)}}},[a("top-bar"),t.isLoading?a("v-uni-view",[a("skeleton")],1):a("v-uni-view",{staticClass:"square-mode-container"},[0===t.postList.length?a("v-uni-view",{staticClass:"empty-state"},[a("v-uni-view",{staticClass:"empty-icon"},[t._v("üò∂")]),a("v-uni-view",{staticClass:"empty-text"},[t._v("ËøôÈáåËøòÊ≤°ÊúâÂÜÖÂÆπ")]),a("v-uni-view",{staticClass:"empty-subtext"},[t._v("ÂéªÂπøÂú∫ÂèëÂ∏É‰∏ÄÊù°ÂêßÔΩû")])],1):t._e(),a("v-uni-view",{attrs:{id:"post-list-container"}},t._l(t.postList,(function(e,n){return a("v-uni-view",{key:e._id||n,class:"post-item-wrapper color-"+(n%4+1),style:{backgroundColor:e.backgroundColor}},[a("v-uni-view",{staticClass:"post-content-navigator",attrs:{"data-index":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.togglePostExpansion.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"post-item"},[e.content?a("v-uni-view",{class:"post-content "+(e.isExpanded?"expanded":"collapsed"),style:{color:e.textColor,whiteSpace:"pre-wrap"}},[e.isExpanded?[t._v(t._s(e.content))]:[e.highlightLines&&e.highlightLines.length>0?t._l(e.highlightLines,(function(e,n){return a("v-uni-text",{key:"line-"+n,staticStyle:{"font-weight":"700",display:"block"}},[t._v(t._s(e))])})):[t._v(t._s(e.content))]]],2):t._e(),e.isExpanded&&e.authorSignature?a("v-uni-view",{staticClass:"user-signature"},[a("v-uni-image",{staticClass:"signature-image",attrs:{src:e.authorSignature,mode:"aspectFit"},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.onSignatureError.apply(void 0,arguments)},load:function(e){arguments[0]=e=t.$handleEvent(e),t.onSignatureLoad.apply(void 0,arguments)}}})],1):t._e(),!e.isExpanded&&e.authorSignature?a("v-uni-view",{staticClass:"user-signature-small"},[a("v-uni-image",{staticClass:"signature-image-small",attrs:{src:e.authorSignature,mode:"aspectFit"},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.onSignatureError.apply(void 0,arguments)},load:function(e){arguments[0]=e=t.$handleEvent(e),t.onSignatureLoad.apply(void 0,arguments)}}})],1):t._e()],1)],1),e.isExpanded?a("v-uni-view",{staticClass:"vote-section",style:{backgroundColor:e.backgroundColor}},[a("v-uni-view",{staticClass:"actions-left"},[a("v-uni-view",{staticClass:"like-icon-container",attrs:{"data-postid":e._id,"data-index":n},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.onVote.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"like-icon",attrs:{src:e.likeIcon||"/static/images/seed.png",mode:"aspectFit"},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.onLikeIconError.apply(void 0,arguments)}}})],1),a("v-uni-view",{staticClass:"comment-count",attrs:{"data-postid":e._id},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.onCommentClick.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"comment-emoji"},[t._v("üí¨")])],1)],1),a("v-uni-view",{staticClass:"button-group"})],1):t._e()],1)})),1),a("v-uni-view",{staticClass:"loading-footer"},[t.isLoadingMore?[a("v-uni-text",[t._v("Âä†ËΩΩ‰∏≠...")])]:!t.hasMore&&t.postList.length>0?[a("v-uni-text",[t._v("‚Äî‚Äî Âà∞Â∫ïÂï¶ ‚Äî‚Äî")])]:t._e()],2)],1),t.showPageIndicator?a("v-uni-view",{staticClass:"page-indicator"},[a("v-uni-view",{staticClass:"page-indicator-text"},[t._v("Âä†ËΩΩÊõ¥Â§ö...")])],1):t._e(),a("app-tab-bar",{ref:"customTabBar"})],1)},i=[]},7148:function(t,e,a){"use strict";a.r(e);var n=a("1e76"),o=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=o.a},8359:function(t,e,a){var n=a("c86c");e=n(!1),e.push([t.i,".white-bg[data-v-ab2e5326]{background:#fff;min-height:100vh}.square-mode-container[data-v-ab2e5326]{padding:%?40?%;margin-bottom:%?200?%;padding-top:%?80?%; /* ÂáèÂ∞ë‰∏äËæπË∑ù */display:flex;flex-direction:column;align-items:center /* Â±Ö‰∏≠Âç°Áâá */}.empty-state[data-v-ab2e5326]{text-align:center;padding:%?100?% 0;color:#999}.empty-icon[data-v-ab2e5326]{font-size:%?80?%;margin-bottom:%?20?%}.empty-text[data-v-ab2e5326]{font-size:%?32?%;margin-bottom:%?10?%;color:#666}.empty-subtext[data-v-ab2e5326]{font-size:%?24?%;color:#999}\r\n/* poem.css inspired card styles */.post-item-wrapper[data-v-ab2e5326]{width:calc(100% - %?80?%); /* ÂìçÂ∫îÂºèÂÆΩÂ∫¶ÔºöÂ±èÂπïÂÆΩÂ∫¶ÂáèÂéªÂ∑¶Âè≥ÂêÑ40rpxËæπË∑ù */margin-left:%?40?%; /* Â∑¶ËæπË∑ù */margin-right:%?40?%; /* Âè≥ËæπË∑ù */border-radius:%?30?%; /* 15px * 2 */margin-bottom:%?40?%; /* ÂáèÂ∞ëÈó¥Ë∑ùÔºåËÆ©Âç°ÁâáÊõ¥Á¥ßÂáë */overflow:hidden;box-shadow:0 %?8?% %?8?% rgba(0,0,0,.25); /* 0px 4px 4px * 2 */transition:-webkit-transform .3s ease;transition:transform .3s ease;transition:transform .3s ease,-webkit-transform .3s ease;border:none}\r\n/* Color variants inspired by poem.css */.post-item-wrapper.color-1[data-v-ab2e5326]{background:rgba(125,47,47,.7)}.post-item-wrapper.color-2[data-v-ab2e5326]{background:rgba(114,118,101,.7)}.post-item-wrapper.color-3[data-v-ab2e5326]{background:rgba(211,223,221,.7)}.post-item-wrapper.color-4[data-v-ab2e5326]{background:rgba(157,210,199,.7)}.post-item-wrapper[data-v-ab2e5326]:active{-webkit-transform:scale(.98);transform:scale(.98)}.post-content-navigator[data-v-ab2e5326]{display:block}.post-item[data-v-ab2e5326]{padding:%?30?% %?60?% %?30?% %?80?%;position:relative}\r\n/* Ëøõ‰∏ÄÊ≠•ÂáèÂ∞ë‰∏ä‰∏ãpaddingÔºåÊñáÂ≠óÂæÄÂ∑¶ÁßªÂä® */\r\n/* Typography inspired by poem.css */.post-content[data-v-ab2e5326]{font-family:Inter,sans-serif;font-style:normal;font-weight:500;font-size:%?28?%; /* Ë∞ÉÂ∞èÂ≠ó‰ΩìÔºö14px * 2 */line-height:%?38?%; /* Ë∞ÉÊï¥Ë°åË∑ùÔºö19px * 2 */margin:%?30?% 0;width:100%;color:#fff}\r\n/* Text colors for different backgrounds */.color-3 .post-content[data-v-ab2e5326]{color:#000 /* For lighter background rgba(211, 223, 221, 0.7) */}\r\n/* ÊäòÂè†ÊÄÅÔºöÂ§öÁ´ØÂÖºÂÆπÁöÑ‰∏âË°åË£ÅÂàáÔºàÂèÇËÄÉÂéüÂßãÂ∞èÁ®ãÂ∫èÂÆûÁé∞Ôºâ */.post-content.collapsed[data-v-ab2e5326]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden;text-overflow:ellipsis}.post-content.expanded[data-v-ab2e5326]{display:block;overflow:visible}.comment-emoji[data-v-ab2e5326]{font-size:%?40?%}.vote-section[data-v-ab2e5326]{display:flex;justify-content:space-between;align-items:center;padding:%?25?% %?50?%}.actions-left[data-v-ab2e5326]{flex:1;display:flex;align-items:center;gap:%?20?%}.button-group[data-v-ab2e5326]{display:flex;align-items:center;gap:%?30?%}.comment-count[data-v-ab2e5326]{display:flex;align-items:center;gap:%?8?%;padding:%?10?% %?15?%}.vote-count[data-v-ab2e5326]{display:flex;align-items:center;gap:%?8?%;padding:%?10?% %?15?%;border-radius:%?20?%;background:hsla(0,0%,100%,.9);box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1)}.comment-icon[data-v-ab2e5326]{width:%?80?%;height:%?80?%}.like-icon[data-v-ab2e5326]{width:%?60?%;height:%?60?%;margin-top:5px}\r\n/* Áî®Êà∑Á≠æÂêçÊ†∑Âºè */.user-signature[data-v-ab2e5326]{position:absolute;bottom:%?-25?%; /* ‰ªé15rpxÂæÄ‰∏ãÁßªÂä®40rpx */right:%?60?%;z-index:10;pointer-events:none /* Èò≤Ê≠¢Á≠æÂêçÂΩ±ÂìçÁÇπÂáª‰∫ã‰ª∂ */}.signature-image[data-v-ab2e5326]{width:%?180?%;height:%?90?%;opacity:.8; /* Á®çÂæÆÈÄèÊòéÔºå‰∏çÊä¢Â§∫‰∏ªË¶ÅÂÜÖÂÆπÁöÑÊ≥®ÊÑèÂäõ */-webkit-filter:drop-shadow(0 %?2?% %?4?% rgba(0,0,0,.1));filter:drop-shadow(0 %?2?% %?4?% rgba(0,0,0,.1)); /* Ê∑ªÂä†ËΩªÂæÆÈò¥ÂΩ± */display:block; /* Á°Æ‰øùÂõæÁâáÊ≠£Á°ÆÊòæÁ§∫ */background:transparent /* Á°Æ‰øùËÉåÊôØÈÄèÊòé */}\r\n/* Â∞èÁ≠æÂêçÊ†∑Âºè - ÊäòÂè†Áä∂ÊÄÅ‰∏ãÊòæÁ§∫ */.user-signature-small[data-v-ab2e5326]{position:absolute;bottom:%?30?%;right:%?60?%;z-index:10;pointer-events:none /* Èò≤Ê≠¢Á≠æÂêçÂΩ±ÂìçÁÇπÂáª‰∫ã‰ª∂ */}.signature-image-small[data-v-ab2e5326]{width:%?100?%;height:%?50?%;opacity:.6; /* Êõ¥ÈÄèÊòéÔºå‰∏çÊä¢Â§∫‰∏ªË¶ÅÂÜÖÂÆπÁöÑÊ≥®ÊÑèÂäõ */-webkit-filter:drop-shadow(0 %?1?% %?2?% rgba(0,0,0,.1));filter:drop-shadow(0 %?1?% %?2?% rgba(0,0,0,.1)); /* Ê∑ªÂä†ËΩªÂæÆÈò¥ÂΩ± */display:block; /* Á°Æ‰øùÂõæÁâáÊ≠£Á°ÆÊòæÁ§∫ */background:transparent /* Á°Æ‰øùËÉåÊôØÈÄèÊòé */}.loading-footer[data-v-ab2e5326]{text-align:center;color:#666;padding:%?30?% 0 %?120?%}.page-indicator[data-v-ab2e5326]{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background:rgba(0,0,0,.7);color:#fff;padding:%?20?% %?40?%;border-radius:%?40?%;z-index:1000;font-size:%?28?%}.page-indicator-text[data-v-ab2e5326]{text-align:center}",""]),t.exports=e},"8e76":function(t,e,a){var n=a("8359");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=a("967d").default;o("7448b288",n,!0,{sourceMap:!1,shadowMode:!1})},f432:function(t,e,a){"use strict";a.r(e);var n=a("252c"),o=a("7148");for(var i in o)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return o[t]}))}(i);a("1505");var r=a("828b"),s=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,"ab2e5326",null,!1,n["a"],void 0);e["default"]=s.exports}}]);