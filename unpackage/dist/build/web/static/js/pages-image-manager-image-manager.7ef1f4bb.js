(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-image-manager-image-manager"],{"139b":function(t,e,a){a("795c"),a("64aa"),a("5c47"),a("a1c1"),a("c223"),a("f7a5");var i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(t).padStart(e,"0")},n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",a=t instanceof Date?t:new Date(t);if(Number.isNaN(a.getTime()))return"";var n={yyyy:String(a.getFullYear()),MM:i(a.getMonth()+1),dd:i(a.getDate()),HH:i(a.getHours()),mm:i(a.getMinutes()),ss:i(a.getSeconds())};return e.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(t){return n[t]}))};t.exports={formatTimeAgo:function(t){var e=new Date,a=new Date(t),i=e.getTime()-a.getTime(),n=Math.floor(i/1e3),o=Math.floor(n/60),r=Math.floor(o/60),s=Math.floor(r/24);if(s>=7){var c=a.getFullYear(),l=("0"+(a.getMonth()+1)).slice(-2),u=("0"+a.getDate()).slice(-2);return"".concat(c,"-").concat(l,"-").concat(u)}return s>=1?"".concat(s,"天前"):r>=1?"".concat(r,"小时前"):o>=1?"".concat(o,"分钟前"):"刚刚"},formatRelativeTime:function(t){var e=Date.now(),a=t instanceof Date?t.getTime():new Date(t).getTime();if(Number.isNaN(a))return"";var i=e-a,o=Math.floor(Math.abs(i)/1e3),r=i>=0?"前":"后";if(o<60)return"刚刚";var s=Math.floor(o/60);if(s<60)return"".concat(s,"分钟").concat(r);var c=Math.floor(s/60);if(c<24)return"".concat(c,"小时").concat(r);var l=Math.floor(c/24);return l<7?"".concat(l,"天").concat(r):n(a,"yyyy-MM-dd")},formatDate:n}},"27bc":function(t,e,a){"use strict";var i=a("8145"),n=a.n(i);n.a},"39fe":function(t,e,a){"use strict";a.r(e);var i=a("b750"),n=a.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);e["default"]=n.a},4713:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[a("v-uni-view",{staticClass:"header"},[a("v-uni-text",{staticClass:"title"},[t._v("图片管理")]),a("v-uni-text",{staticClass:"subtitle"},[t._v("上传和管理小程序图片")])],1),a("v-uni-view",{staticClass:"section"},[a("v-uni-view",{staticClass:"section-title"},[t._v("开屏图管理")]),a("v-uni-view",{staticClass:"upload-area",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chooseSplashImage.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"upload-content"},[a("v-uni-text",{staticClass:"upload-icon"},[t._v("📷")]),a("v-uni-text",{staticClass:"upload-text"},[t._v("点击选择开屏图")]),a("v-uni-text",{staticClass:"upload-hint"},[t._v("建议选择 750x1334 或类似比例的图片")])],1)],1),t.splashPreview?a("v-uni-view",{staticClass:"preview-area"},[a("v-uni-text",{staticClass:"preview-title"},[t._v("预览")]),a("v-uni-image",{staticClass:"preview-image",attrs:{src:t.splashPreview,mode:"aspectFit"}}),a("v-uni-view",{staticClass:"button-group"},[a("v-uni-button",{staticClass:"btn btn-primary",attrs:{loading:t.uploading},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.uploadSplashImage.apply(void 0,arguments)}}},[t._v(t._s(t.uploading?"上传中...":"确认上传"))]),a("v-uni-button",{staticClass:"btn btn-secondary",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clearSplashPreview.apply(void 0,arguments)}}},[t._v("取消")])],1)],1):t._e()],1),t.imageHistory.length>0?a("v-uni-view",{staticClass:"section"},[a("v-uni-view",{staticClass:"section-title"},[t._v("最近上传")]),a("v-uni-view",{staticClass:"history-list"},t._l(t.imageHistory,(function(e,i){return a("v-uni-view",{key:i,staticClass:"history-item"},[a("v-uni-image",{staticClass:"history-thumb",attrs:{src:e.tempUrl,mode:"aspectFill"}}),a("v-uni-view",{staticClass:"history-info"},[a("v-uni-text",{staticClass:"history-name"},[t._v(t._s(e.metadata.name||"未命名"))]),a("v-uni-text",{staticClass:"history-time"},[t._v(t._s(t.formatTime(e.uploadTime)))]),a("v-uni-text",{staticClass:"history-category"},[t._v(t._s(e.category))])],1),a("v-uni-view",{staticClass:"history-actions"},[a("v-uni-button",{staticClass:"btn-small",attrs:{size:"mini","data-url":e.tempUrl},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.copyUrl.apply(void 0,arguments)}}},[t._v("复制链接")])],1)],1)})),1)],1):t._e(),a("v-uni-view",{staticClass:"tips"},[a("v-uni-text",{staticClass:"tips-title"},[t._v("使用说明：")]),a("v-uni-text",{staticClass:"tips-item"},[t._v("1. 开屏图会自动应用到启动页面")]),a("v-uni-text",{staticClass:"tips-item"},[t._v("2. 上传后URL会自动复制到剪贴板")]),a("v-uni-text",{staticClass:"tips-item"},[t._v("3. 云端图片有缓存，修改后可能需要重新编译小程序")])],1)],1)},n=[]},6911:function(t,e,a){"use strict";a.r(e);var i=a("4713"),n=a("39fe");for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);a("27bc");var r=a("828b"),s=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"6c63554f",null,!1,i["a"],void 0);e["default"]=s.exports},"73e1":function(t,e,a){"use strict";var i=a("29d8");t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)},"795c":function(t,e,a){"use strict";var i=a("8bdb"),n=a("db04").start,o=a("73e1");i({target:"String",proto:!0,forced:o},{padStart:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},8145:function(t,e,a){var i=a("e6b9");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("967d").default;n("6b81caf4",i,!0,{sourceMap:!1,shadowMode:!1})},b750:function(t,e,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("4626"),a("7a76"),a("c9b5"),a("5ac7");var n=i(a("2634")),o=i(a("2fdc")),r=a("4073"),s=r.imageManager,c=a("139b"),l=c.formatRelativeTime,u=a("11ca"),d=u.cloudCall,f={data:function(){return{splashPreview:"",uploading:!1,imageHistory:[],isAdmin:!1,currentUserOpenid:""}},onLoad:function(){this.checkAdminPermission()},methods:{callCloudFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(t,e,Object.assign({pageTag:"image-manager",context:this,requireAuth:!0},a))},checkAdminPermission:function(){var t=this;return(0,o.default)((0,n.default)().mark((function e(){var a,i,o,r;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.callCloudFunction("getOpenId",{});case 3:if(a=e.sent,!a.result||!a.result.openid){e.next=17;break}if(i=a.result.openid,o=["ojYBd1_A3uCbQ1LGcHxWxOAeA5SE","ojYBd14JG3-ghYuGCI2WHmkMc9nE"],r=o.includes(i),console.log("图片管理页面 - 当前用户:",i),console.log("图片管理页面 - 是否为管理员:",r),t.setData({currentUserOpenid:i,isAdmin:r}),r){e.next=14;break}return uni.showModal({title:"权限不足",content:"您没有权限访问图片管理功能",showCancel:!1,success:function(){uni.navigateBack()}}),e.abrupt("return");case 14:t.loadImageHistory(),e.next=18;break;case 17:throw new Error("无法获取用户信息");case 18:e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](0),console.error("权限检查失败:",e.t0),uni.showModal({title:"错误",content:"权限检查失败，无法访问此页面",showCancel:!1,success:function(){uni.navigateBack()}});case 24:case"end":return e.stop()}}),e,null,[[0,20]])})))()},loadImageHistory:function(){var t=this;return(0,o.default)((0,n.default)().mark((function e(){var a;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.getImageList({limit:10});case 3:a=e.sent,a.success&&t.setData({imageHistory:a.images}),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("加载图片历史失败:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},chooseSplashImage:function(){var t=this;uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){var a=e.tempFilePaths[0];t.setData({splashPreview:a})},fail:function(t){uni.showToast({title:"选择图片失败",icon:"none"})}})},uploadSplashImage:function(){var t=this;return(0,o.default)((0,n.default)().mark((function e(){var a;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.splashPreview){e.next=3;break}return uni.showToast({title:"请先选择图片",icon:"none"}),e.abrupt("return");case 3:return t.setData({uploading:!0}),e.prev=4,e.next=7,s.uploadSplashImage(t.splashPreview);case 7:if(a=e.sent,!a.success){e.next=15;break}uni.showToast({title:"上传成功",icon:"success",duration:2e3}),uni.setClipboardData({data:a.url,success:function(){uni.showToast({title:"URL已复制",icon:"none"})}}),t.setData({splashPreview:""}),t.loadImageHistory(),e.next=16;break;case 15:throw new Error(a.error);case 16:e.next=22;break;case 18:e.prev=18,e.t0=e["catch"](4),console.error("上传失败:",e.t0),uni.showToast({title:"上传失败: "+e.t0.message,icon:"none",duration:3e3});case 22:return e.prev=22,t.setData({uploading:!1}),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[4,18,22,25]])})))()},clearSplashPreview:function(){this.setData({splashPreview:""})},copyUrl:function(t){var e=t.currentTarget.dataset.url;uni.setClipboardData({data:e,success:function(){uni.showToast({title:"URL已复制",icon:"none"})}})},formatTime:function(t){return l(t)}}};e.default=f},db04:function(t,e,a){"use strict";var i=a("bb80"),n=a("c435"),o=a("9e70"),r=a("f298"),s=a("862c"),c=i(r),l=i("".slice),u=Math.ceil,d=function(t){return function(e,a,i){var r,d,f=o(s(e)),v=n(a),p=f.length,g=void 0===i?" ":o(i);return v<=p||""===g?f:(r=v-p,d=c(g,u(r/g.length)),d.length>r&&(d=l(d,0,r)),t?f+d:d+f)}};t.exports={start:d(!1),end:d(!0)}},e6b9:function(t,e,a){var i=a("c86c");e=i(!1),e.push([t.i,".container[data-v-6c63554f]{padding:%?20?%;background-color:#f8f9fa;min-height:100vh}.header[data-v-6c63554f]{text-align:center;margin-bottom:%?40?%;padding:%?40?% 0}.title[data-v-6c63554f]{display:block;font-size:%?48?%;font-weight:700;color:#333;margin-bottom:%?10?%}.subtitle[data-v-6c63554f]{display:block;font-size:%?28?%;color:#666}.section[data-v-6c63554f]{background:#fff;border-radius:%?16?%;padding:%?30?%;margin-bottom:%?20?%;box-shadow:0 %?2?% %?12?% rgba(0,0,0,.1)}.section-title[data-v-6c63554f]{font-size:%?32?%;font-weight:700;color:#333;margin-bottom:%?20?%;display:block}.upload-area[data-v-6c63554f]{border:%?2?% dashed #ddd;border-radius:%?12?%;padding:%?60?% %?40?%;text-align:center;background-color:#fafafa;transition:all .3s ease}.upload-area[data-v-6c63554f]:active{background-color:#f0f0f0;border-color:#999}.upload-content[data-v-6c63554f]{display:flex;flex-direction:column;align-items:center}.upload-icon[data-v-6c63554f]{font-size:%?64?%;margin-bottom:%?20?%;color:#999}.upload-text[data-v-6c63554f]{font-size:%?32?%;color:#333;margin-bottom:%?10?%;display:block}.upload-hint[data-v-6c63554f]{font-size:%?24?%;color:#999;display:block}.preview-area[data-v-6c63554f]{margin-top:%?30?%;text-align:center}.preview-title[data-v-6c63554f]{font-size:%?28?%;color:#333;margin-bottom:%?20?%;display:block}.preview-image[data-v-6c63554f]{width:100%;height:%?400?%;border-radius:%?12?%;margin-bottom:%?30?%;background-color:#f5f5f5}.button-group[data-v-6c63554f]{display:flex;gap:%?20?%;justify-content:center}.btn[data-v-6c63554f]{padding:%?20?% %?40?%;border-radius:%?8?%;font-size:%?28?%;border:none;min-width:%?160?%}.btn-primary[data-v-6c63554f]{background-color:#9ed7ee;color:#fff}.btn-secondary[data-v-6c63554f]{background-color:#f0f0f0;color:#333}.history-list[data-v-6c63554f]{max-height:%?600?%;overflow-y:auto}.history-item[data-v-6c63554f]{display:flex;align-items:center;padding:%?20?% 0;border-bottom:%?1?% solid #f0f0f0}.history-item[data-v-6c63554f]:last-child{border-bottom:none}.history-thumb[data-v-6c63554f]{width:%?80?%;height:%?80?%;border-radius:%?8?%;margin-right:%?20?%;background-color:#f5f5f5}.history-info[data-v-6c63554f]{flex:1;display:flex;flex-direction:column}.history-name[data-v-6c63554f]{font-size:%?28?%;color:#333;margin-bottom:%?4?%}.history-time[data-v-6c63554f]{font-size:%?24?%;color:#999;margin-bottom:%?4?%}.history-category[data-v-6c63554f]{font-size:%?22?%;color:#666;background-color:#f0f0f0;padding:%?2?% %?8?%;border-radius:%?4?%;align-self:flex-start}.history-actions[data-v-6c63554f]{display:flex;flex-direction:column;gap:%?10?%}.btn-small[data-v-6c63554f]{font-size:%?22?%;padding:%?8?% %?16?%;margin:0}.tips[data-v-6c63554f]{background-color:#e8f5e8;border-radius:%?12?%;padding:%?30?%;margin-top:%?20?%}.tips-title[data-v-6c63554f]{font-size:%?28?%;font-weight:700;color:#333;margin-bottom:%?20?%;display:block}.tips-item[data-v-6c63554f]{font-size:%?26?%;color:#666;margin-bottom:%?10?%;display:block;line-height:1.5}",""]),t.exports=e}}]);