(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-fans-fans"],{"139b":function(t,e,n){n("795c"),n("64aa"),n("5c47"),n("a1c1"),n("c223"),n("f7a5");var a=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(t).padStart(e,"0")},o=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",n=t instanceof Date?t:new Date(t);if(Number.isNaN(n.getTime()))return"";var o={yyyy:String(n.getFullYear()),MM:a(n.getMonth()+1),dd:a(n.getDate()),HH:a(n.getHours()),mm:a(n.getMinutes()),ss:a(n.getSeconds())};return e.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(t){return o[t]}))};t.exports={formatTimeAgo:function(t){var e=new Date,n=new Date(t),a=e.getTime()-n.getTime(),o=Math.floor(a/1e3),i=Math.floor(o/60),r=Math.floor(i/60),s=Math.floor(r/24);if(s>=7){var c=n.getFullYear(),l=("0"+(n.getMonth()+1)).slice(-2),u=("0"+n.getDate()).slice(-2);return"".concat(c,"-").concat(l,"-").concat(u)}return s>=1?"".concat(s,"天前"):r>=1?"".concat(r,"小时前"):i>=1?"".concat(i,"分钟前"):"刚刚"},formatRelativeTime:function(t){var e=Date.now(),n=t instanceof Date?t.getTime():new Date(t).getTime();if(Number.isNaN(n))return"";var a=e-n,i=Math.floor(Math.abs(a)/1e3),r=a>=0?"前":"后";if(i<60)return"刚刚";var s=Math.floor(i/60);if(s<60)return"".concat(s,"分钟").concat(r);var c=Math.floor(s/60);if(c<24)return"".concat(c,"小时").concat(r);var l=Math.floor(c/24);return l<7?"".concat(l,"天").concat(r):o(n,"yyyy-MM-dd")},formatDate:o}},"3b7d":function(t,e,n){"use strict";n.r(e);var a=n("832c"),o=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=o.a},"3dbb":function(t,e,n){"use strict";n.r(e);var a=n("4249"),o=n("3b7d");for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);n("ea19");var r=n("828b"),s=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"c0822888",null,!1,a["a"],void 0);e["default"]=s.exports},4249:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"container"},[t.isLoading&&0===t.fans.length?n("v-uni-view",{staticClass:"loading"},[n("v-uni-text",[t._v("加载中...")])],1):t.fans.length>0?[n("v-uni-view",{staticClass:"list"},t._l(t.fans,(function(e,a){return n("v-uni-view",{key:a,staticClass:"fan-item"},[n("v-uni-view",{staticClass:"user-info",attrs:{"data-openid":e._openid},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openUserProfile.apply(void 0,arguments)}}},[n("v-uni-image",{staticClass:"avatar",attrs:{src:e.avatarUrl||t.defaultAvatar,mode:"aspectFill","data-index":a},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.onAvatarError.apply(void 0,arguments)}}}),n("v-uni-view",{staticClass:"info-text"},[n("v-uni-text",{staticClass:"name"},[t._v(t._s(e.nickName||"微信用户"))]),n("v-uni-text",{staticClass:"bio"},[t._v(t._s(e.bio||"这个人很懒，什么都没留下~"))]),e.followedAtText?n("v-uni-text",{staticClass:"follow-time"},[t._v("关注于 "+t._s(e.followedAtText))]):t._e(),e.isMutual?n("v-uni-view",{staticClass:"mutual-label"},[t._v("互相关注")]):t._e()],1)],1),n("v-uni-button",{staticClass:"follow-btn",attrs:{size:"mini","data-openid":e._openid,"data-index":a,loading:t.pendingOpenid===e._openid,disabled:t.pendingOpenid===e._openid},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.onToggleFollow.apply(void 0,arguments)}}},[t._v(t._s(e.isMutual?"取消关注":"关注"))])],1)})),1)]:n("v-uni-view",{staticClass:"empty"},[n("v-uni-text",[t._v("还没有粉丝，快去多发点内容吧~")])],1),t.fans.length>0?n("v-uni-view",{staticClass:"footer-hint"},[t.isLoading?n("v-uni-view",{staticClass:"loading-more"},[t._v("加载中...")]):t.hasMore?t._e():n("v-uni-view",{staticClass:"loading-more"},[t._v("已经到底啦")])],1):t._e()],2)},o=[]},"57e2e":function(t,e,n){var a=n("803d");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var o=n("967d").default;o("02144746",a,!0,{sourceMap:!1,shadowMode:!1})},"73e1":function(t,e,n){"use strict";var a=n("29d8");t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(a)},"795c":function(t,e,n){"use strict";var a=n("8bdb"),o=n("db04").start,i=n("73e1");a({target:"String",proto:!0,forced:i},{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},"803d":function(t,e,n){var a=n("c86c");e=a(!1),e.push([t.i,".container[data-v-c0822888]{padding:%?32?%;background-color:#f7f8fa;min-height:100vh}.list[data-v-c0822888]{display:flex;flex-direction:column;gap:%?24?%}.fan-item[data-v-c0822888]{display:flex;align-items:center;justify-content:space-between;background-color:#fff;border-radius:%?16?%;padding:%?24?% %?28?%;box-shadow:0 %?6?% %?18?% rgba(0,0,0,.05)}.user-info[data-v-c0822888]{display:flex;align-items:center;flex:1;gap:%?20?%;overflow:hidden}.avatar[data-v-c0822888]{width:%?88?%;height:%?88?%;border-radius:50%;background-color:#f0f0f0}.info-text[data-v-c0822888]{display:flex;flex-direction:column;gap:%?8?%;overflow:hidden}.name[data-v-c0822888]{font-size:%?30?%;color:#333;font-weight:600}.bio[data-v-c0822888]{font-size:%?24?%;color:#888;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:%?420?%}.follow-time[data-v-c0822888]{font-size:%?22?%;color:#b0b0b0}.mutual-label[data-v-c0822888]{display:inline-block;margin-top:%?4?%;padding:%?4?% %?16?%;border-radius:%?999?%;font-size:%?24?%;background-color:#e6f4ff;color:#1f6fd2}.follow-btn[data-v-c0822888]{margin-left:%?24?%;border:none;background-color:#9ed7ee;color:#fff;border-radius:%?999?%;padding:0 %?28?%;height:%?64?%!important;line-height:%?64?%!important}.follow-btn.following[data-v-c0822888]{background-color:#f0f0f0;color:#666}.follow-btn[data-v-c0822888]::after{border:none}.follow-btn[disabled][data-v-c0822888]{opacity:.6}.loading[data-v-c0822888],\r\n.loading-more[data-v-c0822888]{margin-top:%?32?%;text-align:center;color:#999;font-size:%?26?%}.empty[data-v-c0822888]{margin-top:%?120?%;text-align:center;color:#999;font-size:%?28?%}.footer-hint[data-v-c0822888]{margin-top:%?24?%}",""]),t.exports=e},"832c":function(t,e,n){"use strict";n("6a54");var a=n("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(n("39d8")),i=a(n("9b1b"));n("bf0f"),n("fd3c"),n("c223");var r=n("139b"),s=r.formatRelativeTime,c=n("11ca"),l=c.cloudCall,u={data:function(){return{fans:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:20,pendingOpenid:null,defaultAvatar:"/static/images/avatar.png",total:""}},onLoad:function(){this.markFollowNotificationsRead(),this.loadFans(!0)},onPullDownRefresh:function(){this.loadFans(!0)},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadFans()},methods:(0,o.default)({formatTime:void 0,callCloudFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(t,e,Object.assign({pageTag:"fans",context:this,requireAuth:!0},n))},loadFans:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading){e&&(this.setData({page:0,hasMore:!0}),this.markFollowNotificationsRead());var n=e?0:this.page;this.setData({isLoading:!0}),this.callCloudFunction("follow",{action:"getFollowerList",skip:n*this.PAGE_SIZE,limit:this.PAGE_SIZE}).then((function(a){if(a.result&&a.result.success){var o=a.result.list||[],r=o.map((function(e){return(0,i.default)((0,i.default)({},e),{},{followedAtText:e.followedAt?t.formatTime(e.followedAt):""})})),s=e?r:t.fans.concat(r);t.setData({fans:s,page:n+1,hasMore:!!a.result.hasMore,total:a.result.total||s.length})}else uni.showToast({title:a.result&&a.result.message?a.result.message:"加载失败",icon:"none"})})).catch((function(t){console.error("获取粉丝列表失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),e&&uni.stopPullDownRefresh()}))}},markFollowNotificationsRead:function(){this.callCloudFunction("follow",{action:"markFollowNotificationsRead"}).catch((function(t){console.error("标记关注消息已读失败:",t)}))},onToggleFollow:function(t){var e=this,n=t.currentTarget.dataset.openid,a=t.currentTarget.dataset.index;n&&void 0!==a&&!this.pendingOpenid&&(this.setData({pendingOpenid:n}),this.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:n}).then((function(t){if(t.result&&t.result.success){var i=!!t.result.isFollowing;e.setData((0,o.default)({},"fans[".concat(a,"].isMutual"),i)),uni.showToast({title:i?"关注成功":"已取消关注",icon:"success"}),e.refreshFanStatus(n,a)}else uni.showToast({title:t.result&&t.result.message?t.result.message:"操作失败",icon:"none"})})).catch((function(t){console.error("操作粉丝关注状态失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){e.setData({pendingOpenid:null})})))},refreshFanStatus:function(t,e){var n=this;this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:t}).then((function(t){t.result&&t.result.success&&n.setData((0,o.default)({},"fans[".concat(e,"].isMutual"),!!t.result.isMutual))})).catch((function(t){console.error("刷新粉丝状态失败:",t)}))},onAvatarError:function(t){var e=t.currentTarget.dataset.index;void 0!==e&&this.setData((0,o.default)({},"fans[".concat(e,"].avatarUrl"),this.defaultAvatar))},openUserProfile:function(t){var e=t.currentTarget.dataset.openid;e&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(e)})}},"formatTime",(function(t){return s(t)}))};e.default=u},"967d":function(t,e,n){"use strict";function a(t,e){for(var n=[],a={},o=0;o<e.length;o++){var i=e[o],r=i[0],s=i[1],c=i[2],l=i[3],u={id:t+":"+o,css:s,media:c,sourceMap:l};a[r]?a[r].parts.push(u):n.push(a[r]={id:r,parts:[u]})}return n}n.r(e),n.d(e,"default",(function(){return v}));var o="undefined"!==typeof document;if("undefined"!==typeof DEBUG&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},r=o&&(document.head||document.getElementsByTagName("head")[0]),s=null,c=0,l=!1,u=function(){},d=null,f="undefined"!==typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function v(t,e,n,o){l=n,d=o||{};var r=a(t,e);return p(r),function(e){for(var n=[],o=0;o<r.length;o++){var s=r[o],c=i[s.id];c.refs--,n.push(c)}e?(r=a(t,e),p(r)):r=[];for(o=0;o<n.length;o++){c=n[o];if(0===c.refs){for(var l=0;l<c.parts.length;l++)c.parts[l]();delete i[c.id]}}}}function p(t){for(var e=0;e<t.length;e++){var n=t[e],a=i[n.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](n.parts[o]);for(;o<n.parts.length;o++)a.parts.push(h(n.parts[o]));a.parts.length>n.parts.length&&(a.parts.length=n.parts.length)}else{var r=[];for(o=0;o<n.parts.length;o++)r.push(h(n.parts[o]));i[n.id]={id:n.id,refs:1,parts:r}}}}function g(){var t=document.createElement("style");return t.type="text/css",r.appendChild(t),t}function h(t){var e,n,a=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(a){if(l)return u;a.parentNode.removeChild(a)}if(f){var o=c++;a=s||(s=g()),e=w.bind(null,a,o,!1),n=w.bind(null,a,o,!0)}else a=g(),e=b.bind(null,a),n=function(){a.parentNode.removeChild(a)};return e(t),function(a){if(a){if(a.css===t.css&&a.media===t.media&&a.sourceMap===t.sourceMap)return;e(t=a)}else n()}}var m=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}();function w(t,e,n,a){var o=n?"":S(a.css);if(t.styleSheet)t.styleSheet.cssText=m(e,o);else{var i=document.createTextNode(o),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(i,r[e]):t.appendChild(i)}}function b(t,e){var n=S(e.css),a=e.media,o=e.sourceMap;if(a&&t.setAttribute("media",a),d.ssrId&&t.setAttribute("data-vue-ssr-id",e.id),o&&(n+="\n/*# sourceURL="+o.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{while(t.firstChild)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var y=/%\?([+-]?\d+(\.\d+)?)\?%/g,x=/\.\?%PAGE\?%/g,M=/\?%PAGE\?%\[data-v-[a-z0-9]{8}\]/g,C=/uni-page-body\[data-v-[a-z0-9]{8}\]/g,T=/var\(--status-bar-height\)/gi,_=/var\(--window-top\)/gi,A=/var\(--window-bottom\)/gi,D=/var\(--window-left\)/gi,F=/var\(--window-right\)/gi;function S(t){var e=function(){var t="function"===typeof getApp&&getApp();return t&&t.$route&&t.$route.meta&&t.$route.meta.name||""}();if("undefined"!==typeof uni&&!uni.canIUse("css.var")){var n=function(){var t="function"===typeof getApp&&getApp();if(t&&t.$route&&t.$route.meta&&t.$route.meta.name)return{top:t.$route.meta.windowTop,bottom:t.$route.meta.isTabBar?50:0};return{top:0,bottom:0}}();t=t.replace(T,"0px").replace(_,n.top+"px").replace(A,n.bottom+"px").replace(D,"0px").replace(F,"0px")}return t.replace(M,e).replace(x,"").replace(C,"body."+e+" uni-page-body").replace(/\{[\s\S]+?\}|@media.+?\{/g,(function(t){return"undefined"===typeof uni?t:t.replace(y,(function(t,e){return uni.upx2px(e)+"px"}))}))}},c86c:function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",a=t[3];if(!a)return n;if(e&&"function"===typeof btoa){var o=function(t){var e=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e);return"/*# ".concat(n," */")}(a),i=a.sources.map((function(t){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(t," */")}));return[n].concat(i).concat([o]).join("\n")}return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,a){"string"===typeof t&&(t=[[null,t,""]]);var o={};if(a)for(var i=0;i<this.length;i++){var r=this[i][0];null!=r&&(o[r]=!0)}for(var s=0;s<t.length;s++){var c=[].concat(t[s]);a&&o[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}},db04:function(t,e,n){"use strict";var a=n("bb80"),o=n("c435"),i=n("9e70"),r=n("f298"),s=n("862c"),c=a(r),l=a("".slice),u=Math.ceil,d=function(t){return function(e,n,a){var r,d,f=i(s(e)),v=o(n),p=f.length,g=void 0===a?" ":i(a);return v<=p||""===g?f:(r=v-p,d=c(g,u(r/g.length)),d.length>r&&(d=l(d,0,r)),t?f+d:d+f)}};t.exports={start:d(!1),end:d(!0)}},ea19:function(t,e,n){"use strict";var a=n("57e2e"),o=n.n(a);o.a}}]);