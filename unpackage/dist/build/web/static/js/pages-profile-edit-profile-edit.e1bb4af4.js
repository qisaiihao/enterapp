(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-profile-edit-profile-edit"],{"0127":function(n,r,t){"use strict";t.r(r);var e=t("55d6"),a=t.n(e);for(var i in e)["default"].indexOf(i)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(i);r["default"]=a.a},3892:function(n,r,t){"use strict";t.d(r,"b",(function(){return e})),t.d(r,"c",(function(){return a})),t.d(r,"a",(function(){}));var e=function(){var n=this,r=n.$createElement,t=n._self._c||r;return t("v-uni-view",[t("v-uni-view",{staticClass:"container"},[t("v-uni-view",{staticClass:"form-group"},[t("v-uni-view",{staticClass:"label"},[n._v("Â§¥ÂÉè")]),t("v-uni-button",{staticClass:"avatar-wrapper",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onChooseAvatar.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"avatar-preview",attrs:{src:n.avatarUrl||"/static/images/avatar.png"}}),n.avatarUrl?n._e():t("v-uni-view",{staticClass:"avatar-placeholder"},[t("v-uni-text",{staticClass:"avatar-placeholder-text"},[n._v("ÁÇπÂáªÈÄâÊã©Â§¥ÂÉè")])],1)],1)],1),t("v-uni-view",{staticClass:"form-group-column signature-section"},[t("v-uni-label",{staticClass:"label"},[n._v("ÊâãÂÜôÁ≠æÂêç")]),t("v-uni-view",{staticClass:"signature-actions"},[t("v-uni-button",{staticClass:"signature-upload-btn",attrs:{loading:n.isProcessingSignature,disabled:n.isProcessingSignature},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onChooseSignature.apply(void 0,arguments)}}},[n._v("‰∏ä‰º†Á≠æÂêçÂõæÁâá")])],1),t("v-uni-view",{staticClass:"signature-tip"},[n._v("ËØ∑‰∏ä‰º†ÈÄèÊòéÂ∫ïÁöÑPNGÊ†ºÂºèÁ≠æÂêçÂõæÁâáÔºåÂõæÁâáÂ§ÑÁêÜÂäüËÉΩËøòÊ≤°Ë∞ÉËØïÂ•Ω„ÄÇ")]),n.signaturePreview?t("v-uni-image",{staticClass:"signature-preview",attrs:{src:n.signaturePreview,mode:"aspectFit"}}):n._e()],1),t("v-uni-view",{staticClass:"form-group"},[t("v-uni-label",{staticClass:"label",attrs:{for:"nickname"}},[n._v("ÊòµÁß∞")]),t("v-uni-input",{staticClass:"input",attrs:{id:"nickname",type:"nickname",placeholder:"ËØ∑ËæìÂÖ•ÊòµÁß∞",value:n.nickName},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onNicknameInput.apply(void 0,arguments)}}})],1),t("v-uni-view",{staticClass:"form-group"},[t("v-uni-label",{staticClass:"label"},[n._v("ÁîüÊó•")]),t("v-uni-picker",{attrs:{mode:"date",value:n.birthday,start:"1920-01-01",end:n.endDate},on:{change:function(r){arguments[0]=r=n.$handleEvent(r),n.onBirthdayChange.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"picker-display"},[n._v(n._s(n.birthday||"ËØ∑ÈÄâÊã©ÊÇ®ÁöÑÁîüÊó•"))])],1)],1),t("v-uni-view",{staticClass:"form-group"},[t("v-uni-label",{staticClass:"label",attrs:{for:"occupation"}},[n._v("ËÅå‰∏ö")]),t("v-uni-input",{staticClass:"input",attrs:{id:"occupation",type:"text",placeholder:"Â¶ÇÔºö‰∫ßÂìÅÁªèÁêÜ / Â≠¶Áîü",value:n.occupation},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onOccupationInput.apply(void 0,arguments)}}})],1),t("v-uni-view",{staticClass:"form-group"},[t("v-uni-label",{staticClass:"label",attrs:{for:"region"}},[n._v("Âú∞Âå∫")]),t("v-uni-input",{staticClass:"input",attrs:{id:"region",type:"text",placeholder:"Â¶ÇÔºöÂåó‰∫¨ / ‰∏äÊµ∑ / Âπø‰∏úÊ∑±Âú≥",value:n.region},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onRegionInput.apply(void 0,arguments)}}})],1),t("v-uni-view",{staticClass:"form-group"},[t("v-uni-label",{staticClass:"label",attrs:{for:"poemId"}},[n._v("Poem ID")]),t("v-uni-input",{staticClass:"input",attrs:{id:"poemId",type:"text",placeholder:"ËØ∑ËæìÂÖ•ÊÇ®ÁöÑPoem ID",value:n.poemId},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onPoemIdInput.apply(void 0,arguments)}}})],1),t("v-uni-view",{staticClass:"form-group-column"},[t("v-uni-label",{staticClass:"label"},[n._v("‰∏™ÊÄßÁ≠æÂêç")]),t("v-uni-textarea",{staticClass:"textarea",attrs:{placeholder:"‰ªãÁªç‰∏Ä‰∏ãËá™Â∑±Âêß...",value:n.bio,maxlength:"100"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onBioInput.apply(void 0,arguments)}}})],1),t("v-uni-button",{staticClass:"save-button",attrs:{loading:n.isSaving},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onSaveChanges.apply(void 0,arguments)}}},[n._v("‰øùÂ≠ò")])],1),t("v-uni-canvas",{staticStyle:{position:"fixed",top:"-9999px",left:"-9999px",width:"400px",height:"200px"},attrs:{type:"2d",id:"signatureCanvas"}}),t("v-uni-canvas",{staticStyle:{position:"fixed",top:"-9999px",left:"-9999px",width:"400px",height:"200px"},attrs:{"canvas-id":"signatureCanvasFallback"}}),t("v-uni-canvas",{staticStyle:{position:"fixed",top:"-9999px",left:"-9999px",width:"200px",height:"200px"},attrs:{"canvas-id":"avatarCompressCanvas"}})],1)},a=[]},"413b":function(n,r,t){t("bf0f"),t("5c47"),t("0506"),n.exports={compressAvatar:function(n){return new Promise((function(r,t){uni.getSystemInfo({success:function(e){e.pixelRatio;var a=e.system,i=/(ios)/gi.test(a),o={maxWidth:200,maxHeight:200,quality:i?.3:.2,maxSize:51200};console.log("ÂºÄÂßãÂéãÁº©Â§¥ÂÉèÔºåÂéüÂßãË∑ØÂæÑ:",n),console.log("ÂéãÁº©ÈÖçÁΩÆ:",o),uni.getImageInfo({src:n,success:function(e){console.log("ÂéüÂßãÂõæÁâá‰ø°ÊÅØ:",{width:e.width,height:e.height,path:e.path});var a=e.width,i=e.height,s=o.maxWidth,c=o.maxHeight;if(a>s||i>c){var l=Math.min(s/a,c/i);a=Math.floor(a*l),i=Math.floor(i*l)}console.log("ÂéãÁº©ÂêéÂ∞∫ÂØ∏:",{width:a,height:i});var u=uni.createCanvasContext("avatarCompressCanvas");u.drawImage(n,0,0,a,i),u.draw(!1,(function(){uni.canvasToTempFilePath({canvasId:"avatarCompressCanvas",x:0,y:0,width:a,height:i,destWidth:a,destHeight:i,fileType:"jpg",quality:o.quality,success:function(n){console.log("CanvasÂéãÁº©ÂÆåÊàêÔºå‰∏¥Êó∂Êñá‰ª∂:",n.tempFilePath),uni.getFileInfo({filePath:n.tempFilePath,success:function(t){console.log("ÂéãÁº©ÂêéÊñá‰ª∂Â§ßÂ∞è:",(t.size/1024).toFixed(2),"KB"),t.size>o.maxSize?(console.log("Êñá‰ª∂‰ªçÁÑ∂ËøáÂ§ßÔºå‰ΩøÁî®wx.compressImageËøõ‰∏ÄÊ≠•ÂéãÁº©"),uni.compressImage({src:n.tempFilePath,quality:.1,success:function(n){console.log("ÊúÄÁªàÂéãÁº©ÂÆåÊàê:",n.tempFilePath),r(n.tempFilePath)},fail:function(t){console.error("wx.compressImageÂéãÁº©Â§±Ë¥•:",t),r(n.tempFilePath)}})):r(n.tempFilePath)},fail:function(t){console.error("Ëé∑ÂèñÂéãÁº©ÂêéÊñá‰ª∂‰ø°ÊÅØÂ§±Ë¥•:",t),r(n.tempFilePath)}})},fail:function(e){console.error("CanvasÂéãÁº©Â§±Ë¥•:",e),uni.compressImage({src:n,quality:o.quality,success:function(n){console.log("Â§áÈÄâÂéãÁº©ÂÆåÊàê:",n.tempFilePath),r(n.tempFilePath)},fail:function(n){console.error("Â§áÈÄâÂéãÁº©‰πüÂ§±Ë¥•:",n),t(n)}})}})}))},fail:function(e){console.error("Ëé∑ÂèñÂõæÁâá‰ø°ÊÅØÂ§±Ë¥•:",e),uni.compressImage({src:n,quality:o.quality,success:function(n){console.log("Áõ¥Êé•ÂéãÁº©ÂÆåÊàê:",n.tempFilePath),r(n.tempFilePath)},fail:function(n){console.error("Áõ¥Êé•ÂéãÁº©Â§±Ë¥•:",n),t(n)}})}})},fail:function(n){console.error("Ëé∑ÂèñÁ≥ªÁªü‰ø°ÊÅØÂ§±Ë¥•:",n),t(n)}})}))},createAvatarCompressCanvas:function(){}}},"55d6":function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=e(t("fcf3")),i=e(t("5de6")),o=e(t("2634")),s=e(t("2fdc"));t("795c"),t("c9b5"),t("bf0f"),t("ab80"),t("7a76"),t("4626"),t("5ac7"),t("c223"),t("18f7"),t("de6c");getApp();var c=t("413b"),l=c.compressAvatar,u=t("38db"),d=u.cloudCall,f={data:function(){return{avatarUrl:"",nickName:"",birthday:"",bio:"",occupation:"",region:"",poemId:"",endDate:"",isSaving:!1,tempAvatarPath:null,signatureUrl:"",signaturePreview:"",signatureTempPath:null,isProcessingSignature:!1}},onLoad:function(n){this.fetchUserProfile();var r=new Date,t=r.getFullYear()+"-"+(r.getMonth()+1).toString().padStart(2,"0")+"-"+r.getDate().toString().padStart(2,"0");this.setData({endDate:t})},methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(n,r,Object.assign({pageTag:"profile-edit",context:this,requireAuth:!0},t))},uploadFile:function(n,r){var e=this;return(0,s.default)((0,o.default)().mark((function a(){var i,s,c,l,u,d,f,p,h;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=t("f3c3"),s=i.getCloudFunctionMethod,c=s(),"tcb"!==c){a.next=47;break}if(l=getApp(),l&&l.$tcb&&"function"===typeof l.$tcb.uploadFile){a.next=6;break}throw new Error("TCBÂÆû‰æã‰∏çÂèØÁî®");case 6:if(u=r,a.prev=7,"string"!==typeof r||"function"!==typeof fetch||"undefined"===typeof Blob){a.next=17;break}return a.next=11,fetch(r);case 11:return d=a.sent,a.next=14,d.blob();case 14:u=a.sent,a.next=24;break;case 17:if(!r||!r.tempFilePath||"function"!==typeof fetch){a.next=24;break}return a.next=20,fetch(r.tempFilePath);case 20:return f=a.sent,a.next=23,f.blob();case 23:u=a.sent;case 24:a.next=32;break;case 26:return a.prev=26,a.t0=a["catch"](7),console.warn("[ProfileEdit] toBlobÂ§±Ë¥•ÔºåÊîπËµ∞‰∫ëÂáΩÊï∞‰∏ä‰º†",a.t0),a.next=31,e.uploadFileViaCloudFunction(n,r);case 31:return a.abrupt("return",a.sent);case 32:return a.prev=32,a.next=35,l.$tcb.uploadFile({cloudPath:n,file:u});case 35:return p=a.sent,a.abrupt("return",p&&(p.fileID||p.fileId)||p&&p.data&&p.data.fileID||p);case 39:return a.prev=39,a.t1=a["catch"](32),console.warn("[ProfileEdit] TCBÁõ¥‰º†Â§±Ë¥•Ôºåfallback Âà∞‰∫ëÂáΩÊï∞",a.t1),a.next=44,e.uploadFileViaCloudFunction(n,r);case 44:return a.abrupt("return",a.sent);case 45:a.next=52;break;case 47:if("wx-cloud"!==c){a.next=52;break}return a.next=50,wx.cloud.uploadFile({cloudPath:n,filePath:r});case 50:return h=a.sent,a.abrupt("return",h&&h.fileID?h.fileID:h);case 52:throw new Error("‰∏çÊîØÊåÅÁöÑ‰∫ëÂáΩÊï∞Ë∞ÉÁî®ÊñπÂºè: "+c);case 53:case"end":return a.stop()}}),a,null,[[7,26],[32,39]])})))()},uploadFileViaCloudFunction:function(n,r){var t=this,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((function(a,i){if("undefined"!==typeof window&&"undefined"!==typeof FileReader)console.log("üîç [ProfileEdit] H5ÁéØÂ¢É‰ΩøÁî®fetchËØªÂèñÊñá‰ª∂"),fetch(r).then((function(n){if(!n.ok)throw new Error("HTTP "+n.status);return n.blob()})).then((function(o){var s=new FileReader;s.onload=function(){var o=s.result;if(o&&"string"===typeof o){var c=o.split(",")[1];console.log("üîç [ProfileEdit] H5ÁéØÂ¢ÉÊñá‰ª∂ËØªÂèñÂÆåÊàêÔºåbase64ÈïøÂ∫¶: ".concat(c.length)),t.callCloudFunction("upload",{cloudPath:n,fileContent:c}).then((function(n){console.log("H5ÁéØÂ¢É‰∏ä‰º†‰∫ëÂáΩÊï∞ËøîÂõûÁªìÊûú:",n),n&&n.result&&n.result.success?a(n.result.fileID):i(new Error("‰∫ëÂáΩÊï∞ËøîÂõûÂºÇÂ∏∏"))})).catch((function(o){e<2?setTimeout((function(){t.uploadFileViaCloudFunction(n,r,e+1).then(a).catch(i)}),1e3*(e+1)):i(o)}))}else i(new Error("Êñá‰ª∂ËØªÂèñÂ§±Ë¥•"))},s.onerror=function(){return i(new Error("Êñá‰ª∂ËØªÂèñÂ§±Ë¥•"))},s.readAsDataURL(o)})).catch((function(n){return i(n)}));else{console.log("üîç [ProfileEdit] AppÁéØÂ¢É‰ΩøÁî®uni-app APIËØªÂèñÊñá‰ª∂");try{var o=uni.getFileSystemManager();o&&o.readFile?o.readFile({filePath:r,encoding:"base64",success:function(r){var e=r.data;console.log("üîç [ProfileEdit] AppÁéØÂ¢ÉÊñá‰ª∂ËØªÂèñÂÆåÊàêÔºåbase64ÈïøÂ∫¶: ".concat(e.length)),t.callCloudFunction("upload",{cloudPath:n,fileContent:e}).then((function(n){console.log("AppÁéØÂ¢É‰∏ä‰º†‰∫ëÂáΩÊï∞ËøîÂõûÁªìÊûú:",n),n&&n.result&&n.result.success?a(n.result.fileID):i(new Error("‰∏ä‰º†‰∫ëÂáΩÊï∞ËøîÂõûÊ†ºÂºèÈîôËØØ"))})).catch(i)},fail:function(n){console.error("‚ùå [ProfileEdit] AppÁéØÂ¢ÉÊñá‰ª∂ËØªÂèñÂ§±Ë¥•:",n),i(new Error("Êñá‰ª∂ËØªÂèñÂ§±Ë¥•: "+n.errMsg))}}):i(new Error("Êñá‰ª∂Á≥ªÁªüÁÆ°ÁêÜÂô®‰∏çÂèØÁî®"))}catch(s){console.error("‚ùå [ProfileEdit] AppÁéØÂ¢ÉÊñá‰ª∂ËØªÂèñÂºÇÂ∏∏:",s),i(new Error("Êñá‰ª∂ËØªÂèñÂºÇÂ∏∏: "+s.message))}}}))},fetchUserProfile:function(){var n=this;this.callCloudFunction("getMyProfileData",{}).then((function(r){if(console.log("„Äêprofile-edit„Äëüìù Ëé∑ÂèñÁî®Êà∑ËµÑÊñôÂìçÂ∫î:",r),r.result&&r.result.success&&r.result.userInfo){var t=r.result.userInfo;console.log("„Äêprofile-edit„Äëüë§ Áî®Êà∑Êï∞ÊçÆ:",t),console.log("„Äêprofile-edit„Äëüíº ËÅå‰∏ö:",t.occupation),console.log("„Äêprofile-edit„Äëüìç Âú∞Âå∫:",t.region),n.setData({avatarUrl:t.avatarUrl||"",nickName:t.nickName||"",birthday:t.birthday||"",bio:t.bio||"",occupation:t.occupation||"",region:t.region||"",poemId:t.poemId||"",signatureUrl:t.signatureUrl||"",signaturePreview:t.signatureUrl||"",signatureTempPath:null}),console.log("„Äêprofile-edit„Äë‚úÖ ËÆæÁΩÆÂêéÁöÑÊï∞ÊçÆ:",{occupation:n.occupation,region:n.region})}else console.error("„Äêprofile-edit„Äë‚ùå Ëé∑ÂèñÁî®Êà∑ËµÑÊñôÂ§±Ë¥•:",r),uni.showToast({title:"Âä†ËΩΩÂ§±Ë¥•",icon:"none"})})).catch((function(n){console.error("„Äêprofile-edit„Äë‚ùå Ëé∑ÂèñÁî®Êà∑ËµÑÊñôÂºÇÂ∏∏:",n),uni.showToast({title:"Âä†ËΩΩÂ§±Ë¥•",icon:"none"})}))},onChooseAvatar:function(n){var r=this;console.log("üîç [ProfileEdit] ÂºÄÂßãÈÄâÊã©Â§¥ÂÉè...");var e=t("f3c3"),a=e.getCurrentPlatform,i=a();if(console.log("üîç [ProfileEdit] ÂΩìÂâçÂπ≥Âè∞: ".concat(i)),"mp-weixin"===i&&n.detail&&n.detail.avatarUrl){var o=n.detail.avatarUrl;console.log("üîç [ProfileEdit] ÂæÆ‰ø°Â∞èÁ®ãÂ∫èÈÄâÊã©Â§¥ÂÉèÔºåÂéüÂßãË∑ØÂæÑ:",o),this.processAvatar(o)}else console.log("üîç [ProfileEdit] H5/AppÁéØÂ¢ÉÔºå‰ΩøÁî®uni.chooseImageÈÄâÊã©Â§¥ÂÉè"),uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(n){var t=n.tempFilePaths[0];console.log("üîç [ProfileEdit] ÈÄâÊã©Â§¥ÂÉèÊàêÂäüÔºåÂéüÂßãË∑ØÂæÑ:",t),r.processAvatar(t)},fail:function(n){console.error("üîç [ProfileEdit] ÈÄâÊã©Â§¥ÂÉèÂ§±Ë¥•:",n),uni.showToast({title:"ÈÄâÊã©Â§¥ÂÉèÂ§±Ë¥•",icon:"none"})}})},processAvatar:function(n){var r=this;console.log("üîç [ProfileEdit] ÂºÄÂßãÂ§ÑÁêÜÂ§¥ÂÉè:",n),uni.showLoading({title:"ÂéãÁº©Â§¥ÂÉè‰∏≠..."}),l(n).then((function(n){console.log("‚úÖ [ProfileEdit] Â§¥ÂÉèÂéãÁº©ÂÆåÊàêÔºåÂéãÁº©ÂêéË∑ØÂæÑ:",n),r.setData({avatarUrl:n,tempAvatarPath:n}),uni.hideLoading(),uni.showToast({title:"Â§¥ÂÉèÂéãÁº©ÂÆåÊàê",icon:"success",duration:1500})})).catch((function(t){console.error("‚ùå [ProfileEdit] Â§¥ÂÉèÂéãÁº©Â§±Ë¥•:",t),r.setData({avatarUrl:n,tempAvatarPath:n}),uni.hideLoading(),uni.showToast({title:"ÂéãÁº©Â§±Ë¥•Ôºå‰ΩøÁî®ÂéüÂõæ",icon:"none",duration:2e3})}))},onChooseSignature:function(){var n=this;if(!this.isProcessingSignature){var r=function(r){r?n.processSignatureImage(r):uni.showToast({title:"Êú™ÈÄâÊã©ÂõæÁâá",icon:"none"})},t={count:1,mediaType:["image"],sourceType:["album","camera"],success:function(n){var t=n.tempFiles&&n.tempFiles[0];r(t&&(t.tempFilePath||t.filePath))},fail:function(n){n&&n.errMsg&&n.errMsg.includes("cancel")||uni.showToast({title:"ÈÄâÊã©ÂõæÁâáÂ§±Ë¥•",icon:"none"})}};uni.chooseMedia?uni.chooseMedia(t):uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(n){return r(n.tempFilePaths&&n.tempFilePaths[0])},fail:function(n){n&&n.errMsg&&n.errMsg.includes("cancel")||uni.showToast({title:"ÈÄâÊã©ÂõæÁâáÂ§±Ë¥•",icon:"none"})}})}},processSignatureImage:function(n){var r=this;console.log("Á≠æÂêçÂ§ÑÁêÜÔºöÁõ¥Êé•‰ΩøÁî®ÂéüÂõæÔºåË∑≥ËøácanvasÂ§ÑÁêÜ"),uni.showLoading({title:"Â§ÑÁêÜ‰∏≠...",mask:!0}),this.setData({isProcessingSignature:!0}),setTimeout((function(){uni.hideLoading(),uni.showToast({title:"Á≠æÂêçÂ∑≤‰øùÂ≠ò",icon:"success",duration:1500}),r.setData({signaturePreview:n,signatureTempPath:n,signatureUrl:"",isProcessingSignature:!1})}),500)},onNicknameInput:function(n){this.setData({nickName:n.detail.value})},onBirthdayChange:function(n){this.setData({birthday:n.detail.value})},onBioInput:function(n){this.setData({bio:n.detail.value})},onOccupationInput:function(n){this.setData({occupation:n.detail.value})},onRegionInput:function(n){this.setData({region:n.detail.value})},onPoemIdInput:function(n){this.setData({poemId:n.detail.value})},onSaveChanges:function(){var n=this;if(!this.isSaving&&!this.isProcessingSignature){this.setData({isSaving:!0}),uni.showLoading({title:"‰øùÂ≠ò‰∏≠...",mask:!0}),console.log("„Äêprofile-edit„Äëüíæ ÂºÄÂßã‰øùÂ≠òËµÑÊñôÔºåÂΩìÂâçÊï∞ÊçÆ:",{nickName:this.nickName,birthday:this.birthday,bio:this.bio,occupation:this.occupation,region:this.region,poemId:this.poemId});var r=this.tempAvatarPath?this.uploadFile("user_avatars/".concat(Date.now(),"_").concat(Math.floor(1e3*Math.random()),".jpg"),this.tempAvatarPath):Promise.resolve(null),e=this.signatureTempPath?this.uploadFile("user_signatures/".concat(Date.now(),"_").concat(Math.floor(1e3*Math.random()),".png"),this.signatureTempPath):Promise.resolve(null);Promise.all([r,e]).then((function(r){var t=(0,i.default)(r,2),e=t[0],o=t[1],s={avatarUrl:"object"===(0,a.default)(e)&&e?e.fileID||e.fileId||"":e||"",nickName:n.nickName,birthday:n.birthday,bio:n.bio,occupation:n.occupation,region:n.region,poemId:n.poemId,signatureUrl:"object"===(0,a.default)(o)&&o?o.fileID||o.fileId||"":o||""};return console.log("„Äêprofile-edit„Äëüì§ ÂèëÈÄÅÂà∞‰∫ëÂáΩÊï∞ÁöÑÊï∞ÊçÆ:",s),n.callCloudFunction("updateUserProfile",s)})).then((function(n){if(!n.result.success)throw new Error(n.result.message||"‰∫ëÂáΩÊï∞‰øùÂ≠òÂ§±Ë¥•");uni.hideLoading(),uni.showToast({title:"‰øùÂ≠òÊàêÂäü"});try{var r=getApp(),e=r&&r.globalData&&r.globalData.openid,a=t("2729"),i=a.emitAvatarUpdated;i(e)}catch(c){}var o=getCurrentPages();if(o.length>1){var s=o[o.length-2];s&&"function"===typeof s.fetchUserProfile&&s.fetchUserProfile()}setTimeout((function(){return uni.navigateBack()}),1e3)})).catch((function(n){console.error("‰øùÂ≠òËµÑÊñôÂ§±Ë¥•:",n),uni.hideLoading(),uni.showToast({title:n.message||"Êìç‰ΩúÂ§±Ë¥•",icon:"none"})})).finally((function(){n.setData({isSaving:!1})}))}}}};r.default=f},"57c7":function(n,r,t){"use strict";var e=t("e48e"),a=t.n(e);a.a},6066:function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* pages/profile-edit/profile-edit.wxss */.container[data-v-5adde8c9]{padding:%?30?%}.form-group[data-v-5adde8c9],\r\n.form-group-column[data-v-5adde8c9]{display:flex;align-items:center;padding:%?20?% 0;border-bottom:1px solid #f0f0f0}.form-group-column[data-v-5adde8c9]{flex-direction:column;align-items:flex-start}.label[data-v-5adde8c9]{width:%?180?%;font-size:%?32?%;color:#333;flex-shrink:0;margin-bottom:%?10?% /* For column layout */}.avatar-wrapper[data-v-5adde8c9]{padding:0;margin:0;background:none;border:none;line-height:normal;width:%?120?%;height:%?120?%}.avatar-wrapper[data-v-5adde8c9]::after{border:none}.avatar-preview[data-v-5adde8c9]{width:%?120?%;height:%?120?%;border-radius:50%}.avatar-placeholder[data-v-5adde8c9]{position:absolute;top:0;left:0;width:%?120?%;height:%?120?%;border-radius:50%;background-color:#f0f0f0;display:flex;align-items:center;justify-content:center;border:%?2?% dashed #ccc}.avatar-placeholder-text[data-v-5adde8c9]{font-size:%?20?%;color:#999;text-align:center}.input[data-v-5adde8c9],\r\n.picker-display[data-v-5adde8c9],\r\n.textarea[data-v-5adde8c9]{flex-grow:1;font-size:%?32?%;color:#555}.picker-display[data-v-5adde8c9]{text-align:right}.textarea[data-v-5adde8c9]{width:100%;height:%?150?%;padding:%?10?%;background-color:#f7f7f7;border-radius:%?10?%;margin-top:%?10?%}.save-button[data-v-5adde8c9]{margin-top:%?60?%;background-color:#9ed7ee;color:#fff}.signature-section[data-v-5adde8c9]{width:100%}.signature-actions[data-v-5adde8c9]{display:flex;align-items:center;gap:%?20?%;width:100%}.signature-upload-btn[data-v-5adde8c9]{background-color:#1c9bd6;color:#fff;border-radius:%?8?%;padding:0 %?30?%;height:%?72?%;line-height:%?72?%}.signature-upload-btn[data-v-5adde8c9]::after{border:none}.signature-tip[data-v-5adde8c9]{margin-top:%?12?%;font-size:%?24?%;color:#888}.signature-preview[data-v-5adde8c9]{width:100%;max-height:%?260?%;margin-top:%?24?%;background:#f7f7f7;border-radius:%?12?%;padding:%?20?%;box-sizing:border-box}",""]),n.exports=r},"612f":function(n,r,t){"use strict";t.r(r);var e=t("3892"),a=t("0127");for(var i in a)["default"].indexOf(i)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(i);t("57c7");var o=t("828b"),s=Object(o["a"])(a["default"],e["b"],e["c"],!1,null,"5adde8c9",null,!1,e["a"],void 0);r["default"]=s.exports},"73e1":function(n,r,t){"use strict";var e=t("29d8");n.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(e)},"795c":function(n,r,t){"use strict";var e=t("8bdb"),a=t("db04").start,i=t("73e1");e({target:"String",proto:!0,forced:i},{padStart:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},db04:function(n,r,t){"use strict";var e=t("bb80"),a=t("c435"),i=t("9e70"),o=t("f298"),s=t("862c"),c=e(o),l=e("".slice),u=Math.ceil,d=function(n){return function(r,t,e){var o,d,f=i(s(r)),p=a(t),h=f.length,v=void 0===e?" ":i(e);return p<=h||""===v?f:(o=p-h,d=c(v,u(o/v.length)),d.length>o&&(d=l(d,0,o)),n?f+d:d+f)}};n.exports={start:d(!1),end:d(!0)}},e48e:function(n,r,t){var e=t("6066");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("3e69a600",e,!0,{sourceMap:!1,shadowMode:!1})}}]);