(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-fans-fans"],{"0d36":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[t.isLoading&&0===t.fans.length?a("v-uni-view",{staticClass:"loading"},[a("v-uni-text",[t._v("加载中...")])],1):t.fans.length>0?[a("v-uni-view",{staticClass:"list"},t._l(t.fans,(function(e,n){return a("v-uni-view",{key:n,staticClass:"fan-item"},[a("v-uni-view",{staticClass:"user-info",attrs:{"data-openid":e._openid},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openUserProfile.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"avatar",attrs:{src:e.avatarUrl||t.defaultAvatar,mode:"aspectFill","data-index":n},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.onAvatarError.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"info-text"},[a("v-uni-text",{staticClass:"name"},[t._v(t._s(e.nickName||"微信用户"))]),a("v-uni-text",{staticClass:"bio"},[t._v(t._s(e.bio||"这个人很懒，什么都没留下~"))]),e.followedAtText?a("v-uni-text",{staticClass:"follow-time"},[t._v("关注于 "+t._s(e.followedAtText))]):t._e(),e.isMutual?a("v-uni-view",{staticClass:"mutual-label"},[t._v("互相关注")]):t._e()],1)],1),a("v-uni-button",{staticClass:"follow-btn",attrs:{size:"mini","data-openid":e._openid,"data-index":n,loading:t.pendingOpenid===e._openid,disabled:t.pendingOpenid===e._openid},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.onToggleFollow.apply(void 0,arguments)}}},[t._v(t._s(e.isMutual?"取消关注":"关注"))])],1)})),1)]:a("v-uni-view",{staticClass:"empty"},[a("v-uni-text",[t._v("还没有粉丝，快去多发点内容吧~")])],1),t.fans.length>0?a("v-uni-view",{staticClass:"footer-hint"},[t.isLoading?a("v-uni-view",{staticClass:"loading-more"},[t._v("加载中...")]):t.hasMore?t._e():a("v-uni-view",{staticClass:"loading-more"},[t._v("已经到底啦")])],1):t._e()],2)},o=[]},"44f7":function(t,e,a){var n=a("e914");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=a("967d").default;o("f9ae828a",n,!0,{sourceMap:!1,shadowMode:!1})},7161:function(t,e,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(a("39d8")),i=n(a("9b1b"));a("bf0f"),a("fd3c"),a("c223");var r=a("962f"),s=r.formatRelativeTime,l=a("38db"),c=l.cloudCall,u={data:function(){return{fans:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:20,pendingOpenid:null,defaultAvatar:"/images/avatar.png",total:""}},onLoad:function(){this.markFollowNotificationsRead(),this.loadFans(!0)},onPullDownRefresh:function(){this.loadFans(!0)},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadFans()},methods:(0,o.default)({formatTime:void 0,callCloudFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(t,e,Object.assign({pageTag:"fans",context:this,requireAuth:!0},a))},loadFans:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading){e&&(this.setData({page:0,hasMore:!0}),this.markFollowNotificationsRead());var a=e?0:this.page;this.setData({isLoading:!0}),this.callCloudFunction("follow",{action:"getFollowerList",skip:a*this.PAGE_SIZE,limit:this.PAGE_SIZE}).then((function(n){if(n.result&&n.result.success){var o=n.result.list||[],r=o.map((function(e){return(0,i.default)((0,i.default)({},e),{},{followedAtText:e.followedAt?t.formatTime(e.followedAt):""})})),s=e?r:t.fans.concat(r);t.setData({fans:s,page:a+1,hasMore:!!n.result.hasMore,total:n.result.total||s.length})}else uni.showToast({title:n.result&&n.result.message?n.result.message:"加载失败",icon:"none"})})).catch((function(t){console.error("获取粉丝列表失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),e&&uni.stopPullDownRefresh()}))}},markFollowNotificationsRead:function(){this.callCloudFunction("follow",{action:"markFollowNotificationsRead"}).catch((function(t){console.error("标记关注消息已读失败:",t)}))},onToggleFollow:function(t){var e=this,a=t.currentTarget.dataset.openid,n=t.currentTarget.dataset.index;a&&void 0!==n&&!this.pendingOpenid&&(this.setData({pendingOpenid:a}),this.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:a}).then((function(t){if(t.result&&t.result.success){var i=!!t.result.isFollowing;e.setData((0,o.default)({},"fans[".concat(n,"].isMutual"),i)),uni.showToast({title:i?"关注成功":"已取消关注",icon:"success"}),e.refreshFanStatus(a,n)}else uni.showToast({title:t.result&&t.result.message?t.result.message:"操作失败",icon:"none"})})).catch((function(t){console.error("操作粉丝关注状态失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){e.setData({pendingOpenid:null})})))},refreshFanStatus:function(t,e){var a=this;this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:t}).then((function(t){t.result&&t.result.success&&a.setData((0,o.default)({},"fans[".concat(e,"].isMutual"),!!t.result.isMutual))})).catch((function(t){console.error("刷新粉丝状态失败:",t)}))},onAvatarError:function(t){var e=t.currentTarget.dataset.index;void 0!==e&&this.setData((0,o.default)({},"fans[".concat(e,"].avatarUrl"),this.defaultAvatar))},openUserProfile:function(t){var e=t.currentTarget.dataset.openid;e&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(e)})}},"formatTime",(function(t){return s(t)}))};e.default=u},"73e1":function(t,e,a){"use strict";var n=a("29d8");t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(n)},"795c":function(t,e,a){"use strict";var n=a("8bdb"),o=a("db04").start,i=a("73e1");n({target:"String",proto:!0,forced:i},{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},8692:function(t,e,a){"use strict";a.r(e);var n=a("0d36"),o=a("b5a1");for(var i in o)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return o[t]}))}(i);a("d524");var r=a("828b"),s=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,"485a1a13",null,!1,n["a"],void 0);e["default"]=s.exports},"962f":function(t,e,a){a("795c"),a("64aa"),a("5c47"),a("a1c1"),a("c223"),a("f7a5");var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(t).padStart(e,"0")},o=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",a=t instanceof Date?t:new Date(t);if(Number.isNaN(a.getTime()))return"";var o={yyyy:String(a.getFullYear()),MM:n(a.getMonth()+1),dd:n(a.getDate()),HH:n(a.getHours()),mm:n(a.getMinutes()),ss:n(a.getSeconds())};return e.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(t){return o[t]}))};t.exports={formatTimeAgo:function(t){var e=new Date,a=new Date(t),n=e.getTime()-a.getTime(),o=Math.floor(n/1e3),i=Math.floor(o/60),r=Math.floor(i/60),s=Math.floor(r/24);if(s>=7){var l=a.getFullYear(),c=("0"+(a.getMonth()+1)).slice(-2),u=("0"+a.getDate()).slice(-2);return"".concat(l,"-").concat(c,"-").concat(u)}return s>=1?"".concat(s,"天前"):r>=1?"".concat(r,"小时前"):i>=1?"".concat(i,"分钟前"):"刚刚"},formatRelativeTime:function(t){var e=Date.now(),a=t instanceof Date?t.getTime():new Date(t).getTime();if(Number.isNaN(a))return"";var n=e-a,i=Math.floor(Math.abs(n)/1e3),r=n>=0?"前":"后";if(i<60)return"刚刚";var s=Math.floor(i/60);if(s<60)return"".concat(s,"分钟").concat(r);var l=Math.floor(s/60);if(l<24)return"".concat(l,"小时").concat(r);var c=Math.floor(l/24);return c<7?"".concat(c,"天").concat(r):o(a,"yyyy-MM-dd")},formatDate:o}},"967d":function(t,e,a){"use strict";function n(t,e){for(var a=[],n={},o=0;o<e.length;o++){var i=e[o],r=i[0],s=i[1],l=i[2],c=i[3],u={id:t+":"+o,css:s,media:l,sourceMap:c};n[r]?n[r].parts.push(u):a.push(n[r]={id:r,parts:[u]})}return a}a.r(e),a.d(e,"default",(function(){return v}));var o="undefined"!==typeof document;if("undefined"!==typeof DEBUG&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},r=o&&(document.head||document.getElementsByTagName("head")[0]),s=null,l=0,c=!1,u=function(){},d=null,f="undefined"!==typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function v(t,e,a,o){c=a,d=o||{};var r=n(t,e);return p(r),function(e){for(var a=[],o=0;o<r.length;o++){var s=r[o],l=i[s.id];l.refs--,a.push(l)}e?(r=n(t,e),p(r)):r=[];for(o=0;o<a.length;o++){l=a[o];if(0===l.refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete i[l.id]}}}}function p(t){for(var e=0;e<t.length;e++){var a=t[e],n=i[a.id];if(n){n.refs++;for(var o=0;o<n.parts.length;o++)n.parts[o](a.parts[o]);for(;o<a.parts.length;o++)n.parts.push(h(a.parts[o]));n.parts.length>a.parts.length&&(n.parts.length=a.parts.length)}else{var r=[];for(o=0;o<a.parts.length;o++)r.push(h(a.parts[o]));i[a.id]={id:a.id,refs:1,parts:r}}}}function g(){var t=document.createElement("style");return t.type="text/css",r.appendChild(t),t}function h(t){var e,a,n=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(n){if(c)return u;n.parentNode.removeChild(n)}if(f){var o=l++;n=s||(s=g()),e=w.bind(null,n,o,!1),a=w.bind(null,n,o,!0)}else n=g(),e=b.bind(null,n),a=function(){n.parentNode.removeChild(n)};return e(t),function(n){if(n){if(n.css===t.css&&n.media===t.media&&n.sourceMap===t.sourceMap)return;e(t=n)}else a()}}var m=function(){var t=[];return function(e,a){return t[e]=a,t.filter(Boolean).join("\n")}}();function w(t,e,a,n){var o=a?"":S(n.css);if(t.styleSheet)t.styleSheet.cssText=m(e,o);else{var i=document.createTextNode(o),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(i,r[e]):t.appendChild(i)}}function b(t,e){var a=S(e.css),n=e.media,o=e.sourceMap;if(n&&t.setAttribute("media",n),d.ssrId&&t.setAttribute("data-vue-ssr-id",e.id),o&&(a+="\n/*# sourceURL="+o.sources[0]+" */",a+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),t.styleSheet)t.styleSheet.cssText=a;else{while(t.firstChild)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(a))}}var y=/%\?([+-]?\d+(\.\d+)?)\?%/g,x=/\.\?%PAGE\?%/g,M=/\?%PAGE\?%\[data-v-[a-z0-9]{8}\]/g,C=/uni-page-body\[data-v-[a-z0-9]{8}\]/g,T=/var\(--status-bar-height\)/gi,_=/var\(--window-top\)/gi,A=/var\(--window-bottom\)/gi,D=/var\(--window-left\)/gi,F=/var\(--window-right\)/gi;function S(t){var e=function(){var t="function"===typeof getApp&&getApp();return t&&t.$route&&t.$route.meta&&t.$route.meta.name||""}();if("undefined"!==typeof uni&&!uni.canIUse("css.var")){var a=function(){var t="function"===typeof getApp&&getApp();if(t&&t.$route&&t.$route.meta&&t.$route.meta.name)return{top:t.$route.meta.windowTop,bottom:t.$route.meta.isTabBar?50:0};return{top:0,bottom:0}}();t=t.replace(T,"0px").replace(_,a.top+"px").replace(A,a.bottom+"px").replace(D,"0px").replace(F,"0px")}return t.replace(M,e).replace(x,"").replace(C,"body."+e+" uni-page-body").replace(/\{[\s\S]+?\}|@media.+?\{/g,(function(t){return"undefined"===typeof uni?t:t.replace(y,(function(t,e){return uni.upx2px(e)+"px"}))}))}},b5a1:function(t,e,a){"use strict";a.r(e);var n=a("7161"),o=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=o.a},c86c:function(t,e,a){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var a=function(t,e){var a=t[1]||"",n=t[3];if(!n)return a;if(e&&"function"===typeof btoa){var o=function(t){var e=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e);return"/*# ".concat(a," */")}(n),i=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[a].concat(i).concat([o]).join("\n")}return[a].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(a,"}"):a})).join("")},e.i=function(t,a,n){"string"===typeof t&&(t=[[null,t,""]]);var o={};if(n)for(var i=0;i<this.length;i++){var r=this[i][0];null!=r&&(o[r]=!0)}for(var s=0;s<t.length;s++){var l=[].concat(t[s]);n&&o[l[0]]||(a&&(l[2]?l[2]="".concat(a," and ").concat(l[2]):l[2]=a),e.push(l))}},e}},d524:function(t,e,a){"use strict";var n=a("44f7"),o=a.n(n);o.a},db04:function(t,e,a){"use strict";var n=a("bb80"),o=a("c435"),i=a("9e70"),r=a("f298"),s=a("862c"),l=n(r),c=n("".slice),u=Math.ceil,d=function(t){return function(e,a,n){var r,d,f=i(s(e)),v=o(a),p=f.length,g=void 0===n?" ":i(n);return v<=p||""===g?f:(r=v-p,d=l(g,u(r/g.length)),d.length>r&&(d=c(d,0,r)),t?f+d:d+f)}};t.exports={start:d(!1),end:d(!0)}},e914:function(t,e,a){var n=a("c86c");e=n(!1),e.push([t.i,".container[data-v-485a1a13]{padding:%?32?%;background-color:#f7f8fa;min-height:100vh}.list[data-v-485a1a13]{display:flex;flex-direction:column;gap:%?24?%}.fan-item[data-v-485a1a13]{display:flex;align-items:center;justify-content:space-between;background-color:#fff;border-radius:%?16?%;padding:%?24?% %?28?%;box-shadow:0 %?6?% %?18?% rgba(0,0,0,.05)}.user-info[data-v-485a1a13]{display:flex;align-items:center;flex:1;gap:%?20?%;overflow:hidden}.avatar[data-v-485a1a13]{width:%?88?%;height:%?88?%;border-radius:50%;background-color:#f0f0f0}.info-text[data-v-485a1a13]{display:flex;flex-direction:column;gap:%?8?%;overflow:hidden}.name[data-v-485a1a13]{font-size:%?30?%;color:#333;font-weight:600}.bio[data-v-485a1a13]{font-size:%?24?%;color:#888;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:%?420?%}.follow-time[data-v-485a1a13]{font-size:%?22?%;color:#b0b0b0}.mutual-label[data-v-485a1a13]{display:inline-block;margin-top:%?4?%;padding:%?4?% %?16?%;border-radius:%?999?%;font-size:%?24?%;background-color:#e6f4ff;color:#1f6fd2}.follow-btn[data-v-485a1a13]{margin-left:%?24?%;border:none;background-color:#9ed7ee;color:#fff;border-radius:%?999?%;padding:0 %?28?%;height:%?64?%!important;line-height:%?64?%!important}.follow-btn.following[data-v-485a1a13]{background-color:#f0f0f0;color:#666}.follow-btn[data-v-485a1a13]::after{border:none}.follow-btn[disabled][data-v-485a1a13]{opacity:.6}.loading[data-v-485a1a13],\r\n.loading-more[data-v-485a1a13]{margin-top:%?32?%;text-align:center;color:#999;font-size:%?26?%}.empty[data-v-485a1a13]{margin-top:%?120?%;text-align:center;color:#999;font-size:%?28?%}.footer-hint[data-v-485a1a13]{margin-top:%?24?%}",""]),t.exports=e}}]);