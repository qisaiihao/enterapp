(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-index"],{"0451":function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,'\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* index.wxss */.page-indicator[data-v-34cf9479]{position:fixed;top:%?100?%;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);background:rgba(0,0,0,.7);color:#fff;padding:%?20?% %?40?%;border-radius:%?50?%;font-size:%?28?%;z-index:9999;-webkit-animation:pageIndicatorFadeIn-data-v-34cf9479 .3s ease-in-out;animation:pageIndicatorFadeIn-data-v-34cf9479 .3s ease-in-out}.page-indicator-text[data-v-34cf9479]{text-align:center;font-weight:500}@-webkit-keyframes pageIndicatorFadeIn-data-v-34cf9479{0%{opacity:0;-webkit-transform:translateX(-50%) translateY(%?-20?%);transform:translateX(-50%) translateY(%?-20?%)}100%{opacity:1;-webkit-transform:translateX(-50%) translateY(0);transform:translateX(-50%) translateY(0)}}@keyframes pageIndicatorFadeIn-data-v-34cf9479{0%{opacity:0;-webkit-transform:translateX(-50%) translateY(%?-20?%);transform:translateX(-50%) translateY(%?-20?%)}100%{opacity:1;-webkit-transform:translateX(-50%) translateY(0);transform:translateX(-50%) translateY(0)}}.container[data-v-34cf9479]{padding:%?20?%;background-color:#f7f8fa;min-height:100vh;padding-bottom:%?100?%; /* 为底部tabBar留出空间 */position:relative /* 为消息图标定位做准备 */}\r\n/* 消息图标容器 */.message-icon-container[data-v-34cf9479]{position:fixed;right:%?40?%;bottom:%?280?%; /* 移到发布按钮上面 */width:%?80?%;height:%?80?%;background:hsla(0,0%,100%,.9);backdrop-filter:blur(%?20?%);-webkit-backdrop-filter:blur(%?20?%);border-radius:50%;display:flex;justify-content:center;align-items:center;box-shadow:0 %?4?% %?16?% rgba(0,0,0,.1);border:%?1?% solid hsla(0,0%,100%,.3);z-index:1000;transition:all .2s ease}.message-icon-container[data-v-34cf9479]:active{-webkit-transform:scale(.95);transform:scale(.95);background:hsla(0,0%,100%,.8)}.message-icon[data-v-34cf9479]{font-size:%?36?%;color:#333}\r\n/* 未读消息红点 */.unread-dot[data-v-34cf9479]{position:absolute;top:%?8?%;right:%?8?%;width:%?16?%;height:%?16?%;background-color:#ff4757;border-radius:50%;border:%?2?% solid #fff;-webkit-animation:pulse-data-v-34cf9479 2s infinite;animation:pulse-data-v-34cf9479 2s infinite}\r\n/* 红点脉冲动画 */@-webkit-keyframes pulse-data-v-34cf9479{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}50%{-webkit-transform:scale(1.2);transform:scale(1.2);opacity:.8}100%{-webkit-transform:scale(1);transform:scale(1);opacity:1}}@keyframes pulse-data-v-34cf9479{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}50%{-webkit-transform:scale(1.2);transform:scale(1.2);opacity:.8}100%{-webkit-transform:scale(1);transform:scale(1);opacity:1}}\r\n/* 搜索框容器 */.search-box-container[data-v-34cf9479]{margin-bottom:%?20?%}\r\n/* 搜索框样式 */.search-box[data-v-34cf9479]{background-color:#fff;border-radius:%?16?%;padding:%?24?% %?30?%;display:flex;align-items:center;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);border:%?1?% solid rgba(0,0,0,.05);transition:all .2s ease}.search-box[data-v-34cf9479]:active{-webkit-transform:scale(.98);transform:scale(.98);background-color:#f8f9fa}.search-icon[data-v-34cf9479]{font-size:%?32?%;margin-right:%?20?%;color:#999}.search-placeholder[data-v-34cf9479]{font-size:%?28?%;color:#999;flex:1}\r\n/* 读诗模式容器 */.poem-mode-container[data-v-34cf9479]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);z-index:100;overflow:hidden}\r\n/* 滑动指示器 */.swipe-indicator[data-v-34cf9479]{position:absolute;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);color:hsla(0,0%,100%,.8);font-size:%?28?%;padding:%?20?% %?30?%;background:rgba(0,0,0,.3);border-radius:%?50?%;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}.swipe-indicator.left[data-v-34cf9479]{left:%?30?%}.swipe-indicator.right[data-v-34cf9479]{right:%?30?%}\r\n/* 帖子索引指示器 */.post-indicator[data-v-34cf9479]{position:absolute;bottom:%?60?%;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);color:hsla(0,0%,100%,.9);font-size:%?24?%;padding:%?12?% %?24?%;background:rgba(0,0,0,.4);border-radius:%?30?%;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}\r\n/* 列表模式容器 */.list-mode-container[data-v-34cf9479],\r\n.list-content[data-v-34cf9479]{display:block}\r\n/* 广场模式容器 */.square-mode-container[data-v-34cf9479]{display:block}\r\n/* 新增：帖子项包装器样式 */.post-item-wrapper[data-v-34cf9479]{background:#fff;border-radius:%?16?%;margin-bottom:%?20?%;padding:%?30?%;box-shadow:0 %?2?% %?12?% rgba(0,0,0,.06)}\r\n/* 原创帖子特殊样式 */.post-item-wrapper.original-post[data-v-34cf9479]{border:%?3?% solid #ebc88d;box-shadow:0 %?4?% %?20?% rgba(235,200,141,.3),0 %?2?% %?12?% rgba(0,0,0,.06);position:relative}\r\n/* 原创帖子光影效果 */.post-item-wrapper.original-post[data-v-34cf9479]::before{content:"";position:absolute;top:%?-2?%;left:%?-2?%;right:%?-2?%;bottom:%?-2?%;background:linear-gradient(45deg,#ebc88d,#f4d03f,#ebc88d);border-radius:%?18?%;z-index:-1;opacity:.6;-webkit-filter:blur(%?8?%);filter:blur(%?8?%)}\r\n/* 新增：内容导航器样式 */.post-content-navigator[data-v-34cf9479]{display:block;background:transparent}\r\n/* 新增：导航器点击效果 */.navigator-hover[data-v-34cf9479]{background-color:rgba(0,0,0,.02)}\r\n/* 新增：点赞按钮容器样式 */.like-icon-container[data-v-34cf9479]{padding:%?10?%;border-radius:50%;transition:all .2s ease}\r\n/* 新增：点赞按钮点击效果 */.like-icon-container[data-v-34cf9479]:active{-webkit-transform:scale(.9);transform:scale(.9);background-color:hsla(0,100%,71%,.1)}\r\n/* 新增：点赞图标样式 */.like-icon[data-v-34cf9479]{width:%?40?%;height:%?40?%;transition:all .2s ease}.author-info[data-v-34cf9479]{display:flex;align-items:center;margin-bottom:%?15?%}.author-avatar[data-v-34cf9479]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;background-color:#f5f5f5}.author-name[data-v-34cf9479]{font-size:%?28?%;color:#333;font-weight:500}\r\n/* 新增：图片容器占位样式 */.image-container-wrapper[data-v-34cf9479]{position:relative;width:100%;background-color:#f0f0f0; /* 占位时的背景色，很重要 */overflow:hidden;border-radius:8px; /* 可以加个圆角，让占位块更好看 */margin:%?20?% 0 /* 图片和下方内容的间距 */}\r\n/* 新增：让图片或Swiper填充整个占位容器 */.image-container-wrapper .post-image[data-v-34cf9479],\r\n.image-container-wrapper .image-swiper[data-v-34cf9479]{position:absolute;top:0;left:0;width:100%;height:100%}\r\n/* 多图容器 */.multi-image-container[data-v-34cf9479]{width:100%;position:relative}\r\n/* 单图容器 */.single-image-container[data-v-34cf9479]{width:100%;position:relative}\r\n/* 多张图片的swiper样式 */.image-swiper[data-v-34cf9479]{width:100%;background-color:#fff\r\n    /* 高度由 style 绑定动态设置 */}.swiper-item[data-v-34cf9479]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.post-image[data-v-34cf9479]{width:100%;height:100%;display:block;object-fit:contain}.post-image[data-v-34cf9479]:active{-webkit-transform:scale(1.05);transform:scale(1.05)}.post-image.single-image[data-v-34cf9479]{width:100%;height:auto;display:block;background-color:#f5f5f5}\r\n/* 图片数量指示器 */.image-count-indicator[data-v-34cf9479]{position:absolute;top:%?20?%;right:%?20?%;background-color:rgba(0,0,0,.6);color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%;z-index:10;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}\r\n/* 卡片项样式 */.post-item-wrapper[data-v-34cf9479]{margin-bottom:%?20?%}\r\n/* 外部作者信息样式 */.author-info-outside[data-v-34cf9479]{display:flex;align-items:center;padding:%?20?% %?30?% %?10?% %?30?%;background:#fff;border-radius:%?16?% %?16?% 0 0;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.author-info-outside .author-avatar[data-v-34cf9479]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;background-color:#f5f5f5;cursor:pointer}.author-info-outside .author-name[data-v-34cf9479]{font-size:%?28?%;color:#333;font-weight:500}.post-item[data-v-34cf9479]{width:100%;background:#fff;border-radius:0 0 %?16?% %?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);box-sizing:border-box;padding:%?20?% %?30?% %?30?% %?30?%}\r\n/* 定义点击时的样式 - 整个卡片缩小 */.post-card-active[data-v-34cf9479]{-webkit-transform:scale(.98);transform:scale(.98)}.post-title[data-v-34cf9479]{font-size:%?36?%;font-weight:700;color:#333;margin-bottom:%?15?%;line-height:1.4;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}\r\n/* 诗歌作者样式 */.poem-author[data-v-34cf9479]{font-size:%?32?%;color:#000;text-align:center;margin:%?5?% 0 %?15?% 0;letter-spacing:%?2?%}.post-content[data-v-34cf9479]{font-size:%?28?%;color:#666;line-height:1.6;margin-top:%?15?%;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;line-clamp:3;-webkit-box-orient:vertical}.add-button[data-v-34cf9479]{position:fixed;right:%?40?%;bottom:%?160?%;width:%?80?%; /* 从100rpx调整为80rpx */height:%?80?%; /* 从100rpx调整为80rpx */background:rgba(135,206,235,.8); /* 改为淡蓝色 */backdrop-filter:blur(%?20?%);-webkit-backdrop-filter:blur(%?20?%);border-radius:50%;display:flex;justify-content:center;align-items:center;color:#fff;font-size:%?48?%; /* 相应调整字体大小 */box-shadow:0 %?8?% %?32?% rgba(0,0,0,.1);border:%?1?% solid hsla(0,0%,100%,.2);z-index:100;transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease}.add-button[data-v-34cf9479]:active{-webkit-transform:scale(.9);transform:scale(.9)}.vote-section[data-v-34cf9479]{display:flex;justify-content:space-between;align-items:center;margin-top:%?20?%;padding-top:%?20?%;border-top:%?1?% solid #f0f0f0}.vote-count[data-v-34cf9479],\r\n.comment-count[data-v-34cf9479]{display:flex;align-items:center;font-size:%?28?%;color:#999;margin-left:%?10?%;transition:color .2s ease}.vote-count[data-v-34cf9479]{margin-left:%?10?%}.vote-count.voted[data-v-34cf9479]{color:#ff4757}.actions-left[data-v-34cf9479]{display:flex;align-items:center}.action-emoji[data-v-34cf9479]{font-size:%?28?%;margin-right:%?8?%}.action-text[data-v-34cf9479]{font-size:%?28?%;color:inherit}.button-group[data-v-34cf9479]{display:flex;align-items:center}.like-icon-container[data-v-34cf9479]{display:flex;align-items:center;justify-content:center;padding:%?8?%;border-radius:%?8?%;margin-left:%?20?%;transition:all .2s ease}.like-icon-container[data-v-34cf9479]:active{-webkit-transform:scale(.95);transform:scale(.95)}.like-icon[data-v-34cf9479]{width:%?48?%;height:%?48?%}\r\n/* 空状态样式 */.empty-state[data-v-34cf9479]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% %?40?%;text-align:center}.empty-icon[data-v-34cf9479]{font-size:%?120?%;margin-bottom:%?30?%;opacity:.6}.empty-text[data-v-34cf9479]{font-size:%?32?%;color:#666;margin-bottom:%?15?%}.empty-subtext[data-v-34cf9479]{font-size:%?28?%;color:#999}\r\n/* 加载更多样式 */.loading-more[data-v-34cf9479]{display:flex;justify-content:center;align-items:center;padding:%?40?%}.loading-text[data-v-34cf9479]{font-size:%?28?%;color:#999}\r\n/* 底部加载状态样式 */.loading-footer[data-v-34cf9479]{text-align:center;padding:%?20?% 0;color:#999;font-size:14px}\r\n/* 标签样式 */.post-tags[data-v-34cf9479]{margin-top:%?30?%;margin-bottom:%?10?%;line-height:1.5}.post-tag[data-v-34cf9479]{color:#24375f;font-size:%?26?%;margin-right:%?10?%;transition:all .2s ease;cursor:pointer}.post-tag[data-v-34cf9479]:active{color:#1a2a4a;opacity:.8}\r\n/* 发现页推荐相关样式 */.discover-end-tip[data-v-34cf9479]{display:flex;flex-direction:column;align-items:center;padding:%?40?% %?20?%;color:#999}.end-text[data-v-34cf9479]{font-size:%?28?%;margin-bottom:%?20?%}.refresh-tip[data-v-34cf9479]{background:rgba(255,193,7,.1);border:%?2?% solid rgba(255,193,7,.3);border-radius:%?20?%;padding:%?16?% %?24?%}.refresh-text[data-v-34cf9479]{font-size:%?24?%;color:#ffc107;font-weight:500}',""]),n.exports=r},"1d0b":function(n,r,t){var e=t("d189").default,a=t("dd7e").default,o=t("46c5").default,i=t("883d").default,s=t("4db6").default;t("c1a3"),t("bf0f"),t("18f7"),t("de6c"),t("4626"),t("5ac7"),t("f7a5"),t("fd3c"),t("aa9c"),t("08eb");var c=function(){"use strict";function n(){i(this,n),this.cache=new Map,this.isH5="undefined"!==typeof window,this.isMiniProgram="undefined"!==typeof wx&&wx.cloud}return s(n,[{key:"loadImage",value:function(){var n=o(a().mark((function n(r){var t,e,o,i,s,c=arguments;return a().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t=c.length>1&&void 0!==c[1]?c[1]:{},e=t.useCache,o=void 0===e||e,i=t.timeout,void 0===i?1e4:i,s=t.fallbackToOriginal,void 0===s||s,!o||!this.cache.has(r)){n.next=4;break}return n.abrupt("return",{success:!0,url:this.cache.get(r),fromCache:!0});case 4:if(!this.isH5){n.next=8;break}return n.abrupt("return",this.loadImageH5(r,t));case 8:if(!this.isMiniProgram){n.next=12;break}return n.abrupt("return",this.loadImageMiniProgram(r,t));case 12:return n.abrupt("return",this.loadImageNative(r,t));case 13:case"end":return n.stop()}}),n,this)})));return function(r){return n.apply(this,arguments)}}()},{key:"loadImageH5",value:function(){var n=o(a().mark((function n(r,t){var e,o,i;return a().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e=t.fallbackToOriginal,o=void 0===e||e,!this.isCloudStorageUrl(r)){n.next=5;break}return console.log("🔍 [H5] 检测到腾讯云存储URL，直接使用:",r),this.cache.set(r,r),n.abrupt("return",{success:!0,url:r,fromCache:!1,strategy:"direct"});case 5:return n.prev=5,n.next=8,this.downloadFileWithTimeout(r,t.timeout);case 8:if(i=n.sent,!i.success){n.next=12;break}return this.cache.set(r,i.tempFilePath),n.abrupt("return",{success:!0,url:i.tempFilePath,fromCache:!1,strategy:"download"});case 12:n.next=17;break;case 14:n.prev=14,n.t0=n["catch"](5),console.warn("🔍 [H5] downloadFile失败:",n.t0);case 17:if(!o){n.next=21;break}return console.log("🔍 [H5] 使用降级方案，直接使用原URL:",r),this.cache.set(r,r),n.abrupt("return",{success:!0,url:r,fromCache:!1,strategy:"fallback"});case 21:return n.abrupt("return",{success:!1,error:"H5环境下图片加载失败",url:r});case 22:case"end":return n.stop()}}),n,this,[[5,14]])})));return function(r,t){return n.apply(this,arguments)}}()},{key:"loadImageMiniProgram",value:function(){var n=o(a().mark((function n(r,t){var e;return a().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.downloadFileWithTimeout(r,t.timeout);case 3:if(e=n.sent,!e.success){n.next=7;break}return this.cache.set(r,e.tempFilePath),n.abrupt("return",{success:!0,url:e.tempFilePath,fromCache:!1,strategy:"download"});case 7:n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](0),console.error("小程序环境图片加载失败:",n.t0);case 12:return n.abrupt("return",{success:!1,error:"小程序环境下图片加载失败",url:r});case 13:case"end":return n.stop()}}),n,this,[[0,9]])})));return function(r,t){return n.apply(this,arguments)}}()},{key:"loadImageNative",value:function(){var n=o(a().mark((function n(r,t){var e;return a().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.downloadFileWithTimeout(r,t.timeout);case 3:if(e=n.sent,!e.success){n.next=7;break}return this.cache.set(r,e.tempFilePath),n.abrupt("return",{success:!0,url:e.tempFilePath,fromCache:!1,strategy:"download"});case 7:n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](0),console.error("原生环境图片加载失败:",n.t0);case 12:return n.abrupt("return",{success:!1,error:"原生环境下图片加载失败",url:r});case 13:case"end":return n.stop()}}),n,this,[[0,9]])})));return function(r,t){return n.apply(this,arguments)}}()},{key:"downloadFileWithTimeout",value:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return new Promise((function(t){var e=setTimeout((function(){t({success:!1,error:"下载超时"})}),r);uni.downloadFile({url:n,success:function(n){clearTimeout(e),200===n.statusCode?t({success:!0,tempFilePath:n.tempFilePath}):t({success:!1,error:"HTTP ".concat(n.statusCode)})},fail:function(n){clearTimeout(e),t({success:!1,error:n.errMsg||"下载失败"})}})}))}},{key:"isCloudStorageUrl",value:function(n){return n.includes("tcb.qcloud.la")||n.includes("cloudbase")||n.includes("cloud://")}},{key:"loadImages",value:function(){var n=o(a().mark((function n(r){var t,o,i,s,c,l,u,d=this,f=arguments;return a().wrap((function(n){while(1)switch(n.prev=n.next){case 0:t=f.length>1&&void 0!==f[1]?f[1]:{},o=t.maxConcurrent,i=void 0===o?3:o,s=[],c=0;case 4:if(!(c<r.length)){n.next=13;break}return l=r.slice(c,c+i),n.next=8,Promise.all(l.map((function(n){return d.loadImage(n,t)})));case 8:u=n.sent,s.push.apply(s,e(u));case 10:c+=i,n.next=4;break;case 13:return n.abrupt("return",s);case 14:case"end":return n.stop()}}),n)})));return function(r){return n.apply(this,arguments)}}()},{key:"clearCache",value:function(){this.cache.clear()}},{key:"getCacheStats",value:function(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}]),n}(),l=new c;n.exports=l},"2cf2":function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=e(t("b7c7")),o=e(t("39d8")),i=e(t("2634")),s=e(t("9b1b")),c=e(t("2fdc"));t("bf0f"),t("f3f7"),t("18f7"),t("de6c"),t("5c47"),t("fd3c"),t("bd06"),t("f7a5"),t("8f71"),t("c223");var l=e(t("8cb3")),u=t("f117"),d=t("e52a"),f=t("eb63"),g=t("7386"),p=e(t("8cb3")),v=t("f806"),h=t("fe58"),m=t("df61"),b=m.togglePostLike,w=t("a7cb"),k=t("05f6"),y=t("8e86"),x=y.previewImage,C=t("fcd5"),I=C.normalizePostList,P=t("11ca"),T=P.cloudCall,L=t("2b90"),_={components:{skeleton:l.default},mixins:[L],data:function(){return{postList:[],votingInProgress:{},page:0,hasMore:!0,isLoading:!1,openid:"",isLoadingMore:!1,swiperHeights:{},imageClampHeights:{},displayMode:"square",imageCache:{},visiblePosts:new Set,unreadMessageCount:0,currentPage:"home",showPageIndicator:!1,pageIndicatorText:"",discoverPostList:[],discoverPage:0,discoverHasMore:!0,discoverShownPostIds:[],discoverRefreshTime:0,touchStartX:0,touchStartY:0,touchEndX:0,touchEndY:0,selected:0,img:""}},onLoad:function(n){this.setData({displayMode:"square"}),this.pageLoadStartTime=Date.now(),this.initOpenid(),this.waitForLoginThenInit()},onShow:function(){var n=t("d87a"),r=n.updateTabBarStatus;r(this,0);try{var e=uni.getStorageSync("shouldRefreshIndex");e&&(console.log("【index】检测到发布标记，刷新数据"),uni.removeStorageSync("shouldRefreshIndex"),this.refreshIndexData())}catch(a){console.log("CatchClause",a),console.log("CatchClause",a),console.error("检查刷新标记失败:",a)}this.syncLikeStatusFromCache(),this.checkUnreadMessageCount()},onPullDownRefresh:function(){var n=this;console.log("🔍 [首页] 下拉刷新触发，当前页面:",this.currentPage),"home"===this.currentPage?(console.log("🔍 [首页] 执行主页刷新"),this.setData({postList:[],swiperHeights:{},page:0,hasMore:!0},(function(){console.log("🔍 [首页] 状态重置完成，开始获取数据"),n.getPostList((function(){console.log("✅ [首页] 下拉刷新完成"),uni.stopPullDownRefresh()}))}))):"discover"===this.currentPage&&(console.log("🔍 [首页] 执行发现页刷新"),this.refreshDiscoverPosts(),uni.stopPullDownRefresh())},onPageScroll:function(n){var r=this;this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout((function(){if("home"===r.currentPage)if(!r.hasMore||r.isLoading||r.isLoadingMore)console.log("【首页】滚动检测被阻止:",{hasMore:r.hasMore,isLoading:r.isLoading,isLoadingMore:r.isLoadingMore});else{var t=uni.getWindowInfo(),e=t.windowHeight;console.log("【首页】滚动检测 - scrollTop:",n.scrollTop,"windowHeight:",e),uni.createSelectorQuery().in(r).select("#post-list-container").boundingClientRect((function(t){if(t&&t.height>0){var a=t.height,o=n.scrollTop,i=a-o-e,s=1.5*e;console.log("【首页】滚动计算:",{scrollHeight:a,scrollTop:o,windowHeight:e,distanceToBottom:i,preloadThreshold:s}),i<s&&(console.log("【首页】触发预加载"),r.getPostList())}else console.log("【首页】容器高度获取失败")})).exec()}}),100)},methods:{waitForLoginThenInit:function(){var n=this,r=Date.now();(function t(){try{var e=getApp(),a=e&&e.globalData&&e.globalData._loginProcessCompleted,o=e&&e.globalData&&e.globalData.openid;if(a&&o)return console.log("🔐 [首页] 检测到登录完成且已获取 openid，开始拉取数据"),void n.getIndexData()}catch(i){console.log("🔐 [首页] 登录检测异常（忽略继续等待）",i)}if(Date.now()-r>=5e3)return console.log("⏱️ [首页] 登录等待超时，兜底直接拉取数据"),void n.getIndexData();setTimeout(t,100)})()},getIndexData:function(){var n=this;this.setData({isLoading:!0,postList:[],page:0,hasMore:!0}),(0,f.getHomePosts)({page:0,pageSize:5,context:this}).then(function(){var r=(0,c.default)((0,i.default)().mark((function r(t){var e,a,o;return(0,i.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=Array.isArray(t)?t:[],a=I(e).map((function(n){return(0,s.default)((0,s.default)({},n),{},{likeIcon:h.getLikeIcon(n.votes||0,n.isVoted||!1)})})),r.next=4,(0,g.hydrateTempUrls)(a);case 4:a=r.sent,(0,g.warmTempUrlsFromPosts)(a),n.setData({postList:a,page:1,isLoading:!1,hasMore:5===a.length}),o=n,setTimeout((function(){o.preloadUserData&&"function"===typeof o.preloadUserData&&o.preloadUserData(a)}),500);case 9:case"end":return r.stop()}}),r)})));return function(n){return r.apply(this,arguments)}}()).catch((function(r){console.error("【首页】getIndexData（缓存封装）失败:",r),n.setData({isLoading:!1}),uni.showToast({title:"网络错误",icon:"none"})}))},refreshData:function(){var n=this;this.setData({postList:[],swiperHeights:{},imageClampHeights:{},page:0,hasMore:!0},(function(){n.getPostList()}))},handlePreview:function(n){console.log("【图片预览】handlePreview事件触发");var r=n&&n.currentTarget?n.currentTarget.dataset:{};console.log("【图片预览】event.currentTarget.dataset:",r);var t=x(n);return t||console.error("【图片预览】预览条件不满足",r),t},onVote:function(n){var r=this;console.log("【点赞】onVote事件触发",n.currentTarget.dataset);var t=n.currentTarget.dataset.postid,e=n.currentTarget.dataset.index;if(console.log("【点赞】postId:",t,"index:",e),this.votingInProgress[t])console.log("【点赞】正在投票中，跳过");else{this.setData((0,o.default)({},"votingInProgress.".concat(t),!0));var a=this.postList,i=a[e].votes,s=a[e].isVoted;console.log("【点赞】原始状态 - votes:",i,"isVoted:",s),a[e].votes=s?i-1:i+1,a[e].isVoted=!s,a[e].likeIcon=h.getLikeIcon(a[e].votes,a[e].isVoted),console.log("【点赞】更新后状态 - votes:",a[e].votes,"isVoted:",a[e].isVoted),console.log("【点赞】新的likeIcon:",a[e].likeIcon),this.setData({postList:a}),b(t,{pageTag:"index",context:this,currentVotes:i,currentIsLiked:s,requireAuth:!0}).then((function(n){if(console.log("【点赞】服务返回结果:",n),n.success)return a[e].votes=n.votes,a[e].isVoted=n.isLiked,a[e].likeIcon=n.likeIcon,r.setData({postList:a}),void console.log("【点赞】服务调用成功，数据已同步");var t=n.rollback||{votes:i,isLiked:s,likeIcon:h.getLikeIcon(i,s)};console.warn("【点赞】服务返回失败，回滚UI"),a[e].votes=t.votes,a[e].isVoted=t.isLiked,a[e].likeIcon=t.likeIcon,r.setData({postList:a})})).catch((function(n){console.error("【点赞】调用 likeService 失败:",n),a[e].votes=i,a[e].isVoted=s,a[e].likeIcon=h.getLikeIcon(i,s),r.setData({postList:a})})).finally((function(){console.log("【点赞】服务调用完成"),r.setData((0,o.default)({},"votingInProgress.".concat(t),!1))}))}},updatePostCommentCount:function(n,r){var t=this.postList,e=t.findIndex((function(r){return r._id===n}));e>-1&&this.setData((0,o.default)({},"postList[".concat(e,"].commentCount"),r))},onImageError:function(n){console.error("图片加载失败",n.detail)},onAvatarError:function(n){console.error("头像加载失败",n.detail)},onAvatarLoad:function(n){console.log("头像加载成功",n.detail)},onLikeIconError:function(n){console.error("点赞图标加载失败",n.detail,"图标路径:",n.currentTarget.dataset.src)},preloadImages:function(n){var r=n.filter((function(n){return n.imageUrls&&n.imageUrls.length>0})).map((function(n){return n.imageUrls[0]})).slice(0,3);r.length>0&&v.preloadImages(r,(function(n,r){r&&console.log("图片预加载成功:",n)}))},preloadUserData:function(n){if(n&&0!==n.length){var r=this.getCurrentUserId();r&&(w.preloadAvatarsFromPosts(n),k.preloadFollowStatusFromPosts(n,r))}},initOpenid:function(){var n=getApp(),r=n&&n.globalData&&n.globalData.openid;if(r)this.setData({openid:r});else{var t=uni.getStorageSync("openid")||uni.getStorageSync("userOpenId");t&&this.setData({openid:t})}},getCurrentUserId:function(){return this.openid||uni.getStorageSync("openid")||uni.getStorageSync("userOpenId")},navigateToUserProfile:function(n){console.log("【头像点击】事件触发",n),console.log("【头像点击】dataset:",n.currentTarget.dataset);var r=n.currentTarget.dataset.userId;if(console.log("【头像点击】提取的userId:",r),r){var t=this.openid;r===t?(console.log("【头像点击】点击的是自己头像，切换到我的页面"),uni.switchTab({url:"/pages/profile/profile"})):(console.log("【头像点击】点击的是他人头像，跳转到用户主页"),uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(r),success:function(){console.log("【头像点击】跳转成功")},fail:function(n){console.error("【头像点击】跳转失败:",n),uni.showToast({title:"跳转失败",icon:"none"})}}))}else console.error("【头像点击】userId为空，无法跳转"),uni.showToast({title:"用户信息获取失败",icon:"none"})},getPostList:function(n){var r=this;if(console.log("🔍 [首页] getPostList 开始调用"),console.log("🔍 [首页] 当前状态:",{isLoading:this.isLoading,isLoadingMore:this.isLoadingMore,hasMore:this.hasMore,page:this.page,postListLength:this.postList.length}),this.isLoading||this.isLoadingMore||!this.hasMore)return console.log("【首页】getPostList被阻止：正在加载中或没有更多数据"),void("function"===typeof n&&n());var t=5*this.page,e=0===this.page;console.log("🔍 [首页] 请求参数:",{skip:t,page:this.page,isFirstLoad:e,PAGE_SIZE:5}),e?this.setData({isLoading:!0}):this.setData({isLoadingMore:!0});Date.now();(0,f.getHomePosts)({page:this.page,pageSize:5,context:this}).then(function(){var n=(0,c.default)((0,i.default)().mark((function n(t){var a,o,c,l,u,d,f;return(0,i.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=Array.isArray(t)?t:[],console.log("✅ [首页] 获取到帖子数量（缓存封装）:",a.length),o=I(a).map((function(n){return(0,s.default)((0,s.default)({},n),{},{likeIcon:h.getLikeIcon(n.votes||0,n.isVoted||!1)})})),n.next=5,(0,g.hydrateTempUrls)(o);case 5:o=n.sent,(0,g.warmTempUrlsFromPosts)(o),c=r,setTimeout((function(){c.preloadUserData&&"function"===typeof c.preloadUserData&&c.preloadUserData(o)}),500),l=o.length,u=r.postList,d=u.concat(o),f={postList:d,page:r.page+1,hasMore:5===l},console.log("✅ [首页] 更新数据（缓存封装）:",{newPostListLength:d.length,currentPage:r.page,newPage:r.page+1,hasMore:f.hasMore,newPostsCount:l}),r.setData(f),e&&r.preloadImages(o);case 16:case"end":return n.stop()}}),n)})));return function(r){return n.apply(this,arguments)}}()).catch((function(n){console.error("【首页】getPostList（缓存封装）失败:",n),e&&uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){e?r.setData({isLoading:!1}):r.setData({isLoadingMore:!1}),"function"===typeof n&&n()}))},checkUnreadMessageCount:function(){var n=this;(0,u.getUnreadCount)(this).then((function(r){n.setData({unreadMessageCount:r||0})})).catch((function(){}))},syncLikeStatusFromCache:function(){console.log("【首页】同步点赞状态：CacheManager 接管，跳过 dataCache 同步")},navigateToMessages:function(){uni.navigateTo({url:"/pages/messages/messages",success:function(){console.log("跳转到消息页面成功")},fail:function(n){console.error("跳转到消息页面失败:",n),uni.showToast({title:"跳转失败",icon:"none"})}})},onTagClick:function(n){var r=n.currentTarget.dataset.tag;console.log("点击标签:",r),uni.navigateTo({url:"/pages/tag-filter/tag-filter?tag=".concat(encodeURIComponent(r)),success:function(){console.log("跳转到标签筛选页面成功")},fail:function(n){console.error("跳转到标签筛选页面失败:",n),uni.showToast({title:"跳转失败",icon:"none"})}})},onCommentClick:function(n){var r=n.currentTarget.dataset.postid;console.log("点击评论，跳转到详情页:",r),uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(r),success:function(){console.log("跳转到详情页成功")},fail:function(n){console.error("跳转到详情页失败:",n),uni.showToast({title:"跳转失败",icon:"none"})}})},navigateToSearch:function(){console.log("点击搜索框，跳转到搜索页面"),uni.navigateTo({url:"/pages/search/search",success:function(){console.log("跳转到搜索页面成功")},fail:function(n){console.error("跳转到搜索页面失败:",n),uni.showToast({title:"跳转失败",icon:"none"})}})},touchStart:function(n){this.setData({touchStartX:n.touches[0].clientX,touchStartY:n.touches[0].clientY})},touchEnd:function(n){var r=n.changedTouches[0].clientX,t=n.changedTouches[0].clientY,e=this.touchStartX-r,a=this.touchStartY-t,o=Math.sqrt(e*e+a*a),i=Math.abs(180*Math.atan2(Math.abs(a),Math.abs(e))/Math.PI);o>80&&Math.abs(e)>50&&i<45&&(e>0?(console.log("左滑切换回主页"),this.switchToHome()):(console.log("右滑切换到发现页"),this.switchToDiscover()))},switchToDiscover:function(){var n=this;"discover"!==this.currentPage?(console.log("切换到发现页"),this.setData({currentPage:"discover",showPageIndicator:!0,pageIndicatorText:"发现页"}),0===this.discoverPostList.length?(console.log("开始加载发现页数据"),this.loadDiscoverPosts()):console.log("发现页已有数据，直接切换"),setTimeout((function(){n.setData({showPageIndicator:!1})}),3e3)):console.log("已经在发现页，无需切换")},switchToHome:function(){var n=this;"home"!==this.currentPage?(console.log("切换回主页"),this.setData({currentPage:"home",showPageIndicator:!0,pageIndicatorText:"主页"}),setTimeout((function(){n.setData({showPageIndicator:!1})}),3e3)):console.log("已经在主页，无需切换")},loadDiscoverPosts:function(){console.log("开始加载发现页推荐数据"),this.loadRecommendationPosts()},loadRecommendationPosts:function(){var n=(0,c.default)((0,i.default)().mark((function n(){var r,t,e,o;return(0,i.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("使用推荐算法加载发现页数据（带缓存）"),n.prev=1,n.next=4,(0,d.getDiscoverFeed)({excludePostIds:this.discoverShownPostIds,context:this});case 4:return r=n.sent,console.log("获取推荐数据结果（缓存封装）: 条数=",Array.isArray(r)?r.length:0),t=I(r||[]).map((function(n){return(0,s.default)((0,s.default)({},n),{},{likeIcon:h.getLikeIcon(n.votes||0,n.isVoted||!1)})})),n.next=9,(0,g.hydrateTempUrls)(t);case 9:t=n.sent,(0,g.warmTempUrlsFromPosts)(t),e=t.map((function(n){return n._id})),o=[].concat((0,a.default)(this.discoverShownPostIds),(0,a.default)(e)),this.setData({discoverPostList:t,discoverPage:1,discoverHasMore:!1,discoverShownPostIds:o,discoverRefreshTime:Date.now()}),console.log("发现页推荐数据设置完成，帖子数量:",t.length),n.next=21;break;case 17:n.prev=17,n.t0=n["catch"](1),console.error("推荐数据请求失败（缓存封装）:",n.t0),uni.showToast({title:"推荐加载失败",icon:"none"});case 21:case"end":return n.stop()}}),n,this,[[1,17]])})));return function(){return n.apply(this,arguments)}}(),refreshDiscoverPosts:function(){console.log("刷新发现页推荐"),this.setData({discoverPostList:[],discoverPage:0,discoverHasMore:!0,discoverShownPostIds:[],discoverRefreshTime:0}),this.loadRecommendationPosts()},refreshIndexData:function(){console.log("【index】开始刷新广场页数据"),this.setData({postList:[],page:0,hasMore:!0,isLoading:!1}),this.getIndexData()},callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return T(n,r,Object.assign({pageTag:"index",context:this},t))}}};r.default=_,r.default.components=Object.assign({skeleton:p.default},r.default.components||{})},"5b17":function(n,r,t){"use strict";t.d(r,"b",(function(){return a})),t.d(r,"c",(function(){return o})),t.d(r,"a",(function(){return e}));var e={skeleton:t("8cb3").default},a=function(){var n=this,r=n.$createElement,t=n._self._c||r;return t("v-uni-view",[t("v-uni-view",{staticClass:"container",on:{touchstart:function(r){arguments[0]=r=n.$handleEvent(r),n.touchStart.apply(void 0,arguments)},touchend:function(r){arguments[0]=r=n.$handleEvent(r),n.touchEnd.apply(void 0,arguments)}}},[n.showPageIndicator?t("v-uni-view",{staticClass:"page-indicator"},[t("v-uni-view",{staticClass:"page-indicator-text"},[n._v(n._s(n.pageIndicatorText))])],1):n._e(),t("v-uni-view",{staticClass:"message-icon-container",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.navigateToMessages.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"message-icon"},[n._v("✉️")]),n.unreadMessageCount>0?t("v-uni-view",{staticClass:"unread-dot"}):n._e()],1),t("v-uni-view",{staticClass:"search-box-container"},[t("v-uni-view",{staticClass:"search-box",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.navigateToSearch.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"search-icon"},[n._v("🔍")]),t("v-uni-view",{staticClass:"search-placeholder"},[n._v("搜索帖子...")])],1)],1),n.isLoading?t("v-uni-view",[t("skeleton")],1):t("v-uni-view",{staticClass:"square-mode-container"},[0!==n.postList.length||n.isLoading?n._e():t("v-uni-view",{staticClass:"empty-state"},[t("v-uni-view",{staticClass:"empty-icon"},[n._v("📝")]),t("v-uni-view",{staticClass:"empty-text"},[n._v("还没有帖子哦～")]),t("v-uni-view",{staticClass:"empty-subtext"},[n._v("快来发布第一条帖子吧！")])],1),t("v-uni-view",{attrs:{id:"post-list-container"}},["home"===n.currentPage?t("v-uni-view",n._l(n.postList,(function(r,e){return t("v-uni-view",{key:e,class:"post-item-wrapper "+(r.isOriginal?"original-post":"")},[t("v-uni-view",{staticClass:"author-info-outside"},[r.authorAvatar?t("v-uni-image",{staticClass:"author-avatar",attrs:{src:r.authorAvatar,mode:"aspectFill","data-postindex":e,"data-user-id":r._openid},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onAvatarError.apply(void 0,arguments)},load:function(r){arguments[0]=r=n.$handleEvent(r),n.onAvatarLoad.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.navigateToUserProfile.apply(void 0,arguments)}}}):n._e(),t("v-uni-text",{staticClass:"author-name"},[n._v(n._s(r.authorName))])],1),t("v-uni-navigator",{staticClass:"post-content-navigator",attrs:{url:"/pages/post-detail/post-detail?id="+r._id,"hover-class":"navigator-hover"}},[t("v-uni-view",{staticClass:"post-item"},[t("v-uni-view",{staticClass:"post-title"},[n._v(n._s(r.title))]),r.isPoem&&r.author?t("v-uni-view",{staticClass:"poem-author"},[n._v(n._s(r.author))]):n._e(),r.imageUrls&&r.imageUrls.length>0?t("v-uni-view",{staticClass:"image-container-wrapper",style:r.imageStyle,attrs:{"data-src":r.imageUrls[0],"data-original-image-urls":r.originalImageUrls||r.imageUrls},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.handlePreview.apply(void 0,arguments)}}},[1===r.imageUrls.length?[t("v-uni-image",{staticClass:"post-image",attrs:{src:r.imageUrls[0],mode:"aspectFill","lazy-load":!0,"data-src":r.imageUrls[0],"data-original-image-urls":r.originalImageUrls||r.imageUrls},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onImageError.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.handlePreview.apply(void 0,arguments)}}})]:r.imageUrls.length>1?[t("v-uni-swiper",{staticClass:"image-swiper",attrs:{"indicator-dots":!0,circular:!0}},[n._l(r.imageUrls,(function(e,a){return[t("v-uni-swiper-item",[t("v-uni-image",{staticClass:"post-image",attrs:{src:e,mode:"aspectFill","lazy-load":!0,"data-src":e,"data-original-image-urls":r.originalImageUrls||r.imageUrls},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onImageError.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.handlePreview.apply(void 0,arguments)}}})],1)]}))],2)]:n._e()],2):n._e(),r.content?t("v-uni-view",{staticClass:"post-content",staticStyle:{"white-space":"pre-wrap"}},[n._v(n._s(r.content))]):n._e(),r.tags&&r.tags.length>0?t("v-uni-view",{staticClass:"post-tags"},n._l(r.tags,(function(r,e){return t("v-uni-text",{key:e,staticClass:"post-tag",attrs:{"data-tag":r},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onTagClick.apply(void 0,arguments)}}},[n._v("#"+n._s(r))])})),1):n._e()],1)],1),t("v-uni-view",{staticClass:"vote-section"},[t("v-uni-view",{staticClass:"actions-left"}),t("v-uni-view",{staticClass:"button-group"},[t("v-uni-view",{staticClass:"comment-count",attrs:{"data-postid":r._id},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onCommentClick.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"action-emoji"},[n._v("💬")]),t("v-uni-text",{staticClass:"action-text"},[n._v(n._s(r.commentCount||0))])],1),t("v-uni-view",{staticClass:"like-icon-container",attrs:{"data-postid":r._id,"data-index":e},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onVote.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"like-icon",attrs:{src:r.likeIcon||"/static/images/seed.png",mode:"aspectFit"},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onLikeIconError.apply(void 0,arguments)}}})],1),t("v-uni-view",{class:"vote-count "+(r.isVoted?"voted":"")},[t("v-uni-text",{staticClass:"action-text"},[n._v(n._s(r.votes||0))])],1)],1)],1)],1)})),1):"discover"===n.currentPage?t("v-uni-view",[0!==n.discoverPostList.length||n.isLoading?n._e():t("v-uni-view",{staticClass:"empty-state"},[t("v-uni-view",{staticClass:"empty-icon"},[n._v("🔍")]),t("v-uni-view",{staticClass:"empty-text"},[n._v("发现页暂无内容")]),t("v-uni-view",{staticClass:"empty-subtext"},[n._v("推荐算法正在学习中...")])],1),n._l(n.discoverPostList,(function(r,e){return t("v-uni-view",{key:e,class:"post-item-wrapper "+(r.isOriginal?"original-post":"")},[t("v-uni-view",{staticClass:"author-info-outside"},[r.authorAvatar?t("v-uni-image",{staticClass:"author-avatar",attrs:{src:r.authorAvatar,mode:"aspectFill","data-postindex":e,"data-user-id":r._openid},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onAvatarError.apply(void 0,arguments)},load:function(r){arguments[0]=r=n.$handleEvent(r),n.onAvatarLoad.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.navigateToUserProfile.apply(void 0,arguments)}}}):n._e(),t("v-uni-text",{staticClass:"author-name"},[n._v(n._s(r.authorName))])],1),t("v-uni-navigator",{staticClass:"post-content-navigator",attrs:{url:"/pages/post-detail/post-detail?id="+r._id,"hover-class":"navigator-hover"}},[t("v-uni-view",{staticClass:"post-item"},[t("v-uni-view",{staticClass:"post-title"},[n._v(n._s(r.title))]),r.isPoem&&r.author?t("v-uni-view",{staticClass:"poem-author"},[n._v(n._s(r.author))]):n._e(),r.imageUrls&&r.imageUrls.length>0?t("v-uni-view",{staticClass:"image-container-wrapper",style:r.imageStyle,attrs:{"data-src":r.imageUrls[0],"data-original-image-urls":r.originalImageUrls||r.imageUrls},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.handlePreview.apply(void 0,arguments)}}},[1===r.imageUrls.length?[t("v-uni-image",{staticClass:"post-image",attrs:{src:r.imageUrls[0],mode:"aspectFill","lazy-load":!0,"data-src":r.imageUrls[0],"data-original-image-urls":r.originalImageUrls||r.imageUrls},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onImageError.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.handlePreview.apply(void 0,arguments)}}})]:r.imageUrls.length>1?[t("v-uni-swiper",{staticClass:"image-swiper",attrs:{"indicator-dots":!0,circular:!0}},[n._l(r.imageUrls,(function(e,a){return[t("v-uni-swiper-item",[t("v-uni-image",{staticClass:"post-image",attrs:{src:e,mode:"aspectFill","lazy-load":!0,"data-src":e,"data-original-image-urls":r.originalImageUrls||r.imageUrls},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onImageError.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.handlePreview.apply(void 0,arguments)}}})],1)]}))],2)]:n._e()],2):n._e(),r.content?t("v-uni-view",{staticClass:"post-content",staticStyle:{"white-space":"pre-wrap"}},[n._v(n._s(r.content))]):n._e(),r.tags&&r.tags.length>0?t("v-uni-view",{staticClass:"post-tags"},n._l(r.tags,(function(r,e){return t("v-uni-text",{key:e,staticClass:"post-tag",attrs:{"data-tag":r},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onTagClick.apply(void 0,arguments)}}},[n._v("#"+n._s(r))])})),1):n._e()],1)],1),t("v-uni-view",{staticClass:"vote-section"},[t("v-uni-view",{staticClass:"actions-left"}),t("v-uni-view",{staticClass:"button-group"},[t("v-uni-view",{staticClass:"comment-count",attrs:{"data-postid":r._id},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onCommentClick.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"action-emoji"},[n._v("💬")]),t("v-uni-text",{staticClass:"action-text"},[n._v(n._s(r.commentCount||0))])],1),t("v-uni-view",{staticClass:"like-icon-container",attrs:{"data-postid":r._id,"data-index":e},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onVote.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"like-icon",attrs:{src:r.likeIcon||"/static/images/seed.png",mode:"aspectFit"},on:{error:function(r){arguments[0]=r=n.$handleEvent(r),n.onLikeIconError.apply(void 0,arguments)}}})],1),t("v-uni-view",{class:"vote-count "+(r.isVoted?"voted":"")},[t("v-uni-text",{staticClass:"action-text"},[n._v(n._s(r.votes||0))])],1)],1)],1)],1)}))],2):n._e()],1),t("v-uni-view",{staticClass:"loading-footer"},[n.isLoadingMore?[t("v-uni-text",[n._v("正在加载...")])]:"home"===n.currentPage&&!n.hasMore&&n.postList.length>0?[t("v-uni-text",[n._v("--- 我是有底线的 ---")])]:"discover"===n.currentPage&&!n.discoverHasMore&&n.discoverPostList.length>0?[t("v-uni-view",{staticClass:"discover-end-tip"},[t("v-uni-text",{staticClass:"end-text"},[n._v("--- 没有更多了 ---")]),t("v-uni-view",{staticClass:"refresh-tip"},[t("v-uni-text",{staticClass:"refresh-text"},[n._v("下拉刷新获取新的推荐")])],1)],1)]:n._e()],2)],1),t("v-uni-navigator",{staticClass:"add-button",attrs:{url:"/pages/add/add"}},[t("v-uni-view",[n._v("+")])],1)],1)],1)},o=[]},"70a6":function(n,r,t){"use strict";var e=t("b56c"),a=t.n(e);a.a},7386:function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.hydrateTempUrls=function(){return c.apply(this,arguments)},r.warmTempUrlsFromPosts=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=new Set;n.forEach((function(n){return s(n).forEach((function(n){return r.add(n)}))})),r.size>0&&i.default.warm(Array.from(r))};var a=e(t("2634")),o=e(t("2fdc"));t("9db6"),t("aa9c"),t("bf0f"),t("2797"),t("f3f7"),t("18f7"),t("de6c"),t("08eb"),t("fd3c");var i=e(t("c605"));function s(n){var r=[],t=function(n){"string"===typeof n&&n.startsWith("cloud://")&&r.push(n)};return t(n.imageUrl),t(n.originalImageUrl),t(n.authorAvatar),t(n.poemBgImage),Array.isArray(n.imageUrls)&&n.imageUrls.forEach(t),Array.isArray(n.originalImageUrls)&&n.originalImageUrls.forEach(t),r}function c(){return c=(0,o.default)((0,a.default)().mark((function n(){var r,t,e,o,c=arguments;return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=c.length>0&&void 0!==c[0]?c[0]:[],Array.isArray(r)&&0!==r.length){n.next=3;break}return n.abrupt("return",r);case 3:if(t=new Set,r.forEach((function(n){return s(n).forEach((function(n){return t.add(n)}))})),0!==t.size){n.next=7;break}return n.abrupt("return",r);case 7:return n.next=9,i.default.getTempUrls(Array.from(t));case 9:return e=n.sent,o=function(n){return"string"===typeof n&&e[n]?e[n]:n},r.forEach((function(n){n.imageUrl&&(n.imageUrl=o(n.imageUrl)),n.originalImageUrl&&(n.originalImageUrl=o(n.originalImageUrl)),n.authorAvatar&&(n.authorAvatar=o(n.authorAvatar)),n.poemBgImage&&(n.poemBgImage=o(n.poemBgImage)),Array.isArray(n.imageUrls)&&(n.imageUrls=n.imageUrls.map(o)),Array.isArray(n.originalImageUrls)&&(n.originalImageUrls=n.originalImageUrls.map(o))})),n.abrupt("return",r);case 13:case"end":return n.stop()}}),n)}))),c.apply(this,arguments)}},9066:function(n,r,t){"use strict";t.r(r);var e=t("5b17"),a=t("da71");for(var o in a)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(o);t("70a6");var i=t("828b"),s=Object(i["a"])(a["default"],e["b"],e["c"],!1,null,"34cf9479",null,!1,e["a"],void 0);r["default"]=s.exports},b56c:function(n,r,t){var e=t("0451");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("349f36d8",e,!0,{sourceMap:!1,shadowMode:!1})},da71:function(n,r,t){"use strict";t.r(r);var e=t("2cf2"),a=t.n(e);for(var o in e)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(o);r["default"]=a.a},df61:function(n,r,t){var e=t("dd7e").default,a=t("46c5").default;t("64aa"),t("dc8a"),t("8f71"),t("bf0f"),t("9db6"),t("2797"),t("de6c"),t("7a76"),t("c9b5");var o=t("11ca"),i=o.cloudCall,s=t("fe58"),c=t("3ab8").default;function l(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=Number(n);return Number.isFinite(t)?t:r}function u(n,r,t){if("function"===typeof n)try{return n(r,t)}catch(e){console.warn("[likeService] likeIcon resolver 执行失败",e)}return s.getLikeIcon(r,t)}function d(n){var r=n.votes,t=n.isLiked,e=n.icon;return{votes:r,isLiked:t,likeIcon:e}}function f(n,r,t,e){try{if(!n)return;var a=c.getStats?c.getStats():{},o=Object.keys(a),i=o.filter((function(n){return"posts:home"===n||"posts:discover"===n||n.startsWith("posts:tag:")||n.startsWith("me:posts")||n.startsWith("userPosts:")}));i.forEach((function(a){try{var o=c.namespace(a),i=o.keys&&o.keys()||[];i.forEach((function(a){try{o.update(a,(function(a){if(!Array.isArray(a))return a;for(var o=0;o<a.length;o+=1){var i=a[o];!i||i._id!==n&&i.id!==n||(i.votes=r,i.isVoted=t,i.likeIcon=e,!0)}return a}))}catch(i){}}))}catch(s){}}))}catch(s){console.warn("[likeService] updatePostInCaches failed",s)}}function g(n){if("undefined"!==typeof uni&&"function"===typeof uni.showToast)try{uni.showToast({title:n||"操作失败，请稍后重试",icon:"none"})}catch(r){console.warn("[likeService] showToast 调用失败",r)}}function p(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.pageTag,t=void 0===r?"like-service":r,e=n.context,a=void 0===e?null:e,o=n.currentVotes,i=void 0===o?0:o,c=n.currentIsLiked,u=void 0!==c&&c,d=n.likeIconResolver,f=void 0===d?s.getLikeIcon:d,g=n.requireAuth,p=void 0===g||g,v=n.retry,h=void 0===v?0:v,m=n.updateCache,b=void 0===m||m,w=n.showErrorToast,k=void 0===w||w,y=n.cloudOptions,x=void 0===y?{}:y;return{pageTag:t,context:a,currentVotes:l(i,0),currentIsLiked:Boolean(u),likeIconResolver:f,requireAuth:p,retry:h,updateCache:b,showErrorToast:k,cloudOptions:x}}function v(){return v=a(e().mark((function n(r){var t,a,o,s,c,v,h,m,b,w,k,y,x,C,I,P,T,L,_,U,D,M,S,E=arguments;return e().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t=E.length>1&&void 0!==E[1]?E[1]:{},r){n.next=3;break}return n.abrupt("return",Promise.reject(new Error("[likeService] postId 不能为空")));case 3:return a=p(t),o=a.pageTag,s=a.context,c=a.currentVotes,v=a.currentIsLiked,h=a.likeIconResolver,m=a.requireAuth,b=a.retry,w=a.updateCache,k=a.showErrorToast,y=a.cloudOptions,x=l(c,0),C=Boolean(v),I=u(h,x,C),P=d({votes:x,isLiked:C,icon:I}),n.prev=8,n.next=11,i("vote",{postId:r},Object.assign({pageTag:"likeService:".concat(o),context:s,requireAuth:m,retry:b},y));case 11:T=n.sent,n.next=19;break;case 14:return n.prev=14,n.t0=n["catch"](8),console.error("[likeService] 调用云函数失败",n.t0),k&&g(n.t0&&n.t0.message),n.abrupt("return",{success:!1,error:n.t0,rollback:P});case 19:if(L=T&&T.result?T.result:T,_=L&&!0===L.success,_){n.next=26;break}return U=L&&L.message?L.message:"操作失败，请稍后重试",console.warn("[likeService] 云函数返回失败结果",L),k&&g(U),n.abrupt("return",{success:!1,error:L,rollback:P});case 26:return D=l(L.votes,x),M=Boolean(L.isLiked),S=u(h,D,M),w&&f(r,D,M,S),n.abrupt("return",{success:!0,votes:D,isLiked:M,likeIcon:S,response:L});case 31:case"end":return n.stop()}}),n,null,[[8,14]])}))),v.apply(this,arguments)}n.exports={togglePostLike:function(n){return v.apply(this,arguments)}}},f117:function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.getUnreadCount=function(n){return u.apply(this,arguments)},r.invalidateUnread=function(){l.delete("count")};var a=e(t("2634")),o=e(t("2fdc")),i=e(t("3ab8")),s=t("11ca"),c=s.cloudCall,l=i.default.namespace("unread",{persistent:!1,maxItems:64});function u(){return u=(0,o.default)((0,a.default)().mark((function n(r){return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",l.getOrFetch("count",(0,o.default)((0,a.default)().mark((function n(){var t;return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,c("getUnreadMessageCount",{},{pageTag:"unread",context:r,injectOpenId:!0});case 2:if(t=n.sent,!(t&&t.result&&t.result.success)){n.next=5;break}return n.abrupt("return",t.result.count||0);case 5:return n.abrupt("return",0);case 6:case"end":return n.stop()}}),n)}))),{ttlMs:6e4,swrMs:6e4}));case 1:case"end":return n.stop()}}),n)}))),u.apply(this,arguments)}},f806:function(n,r,t){var e=t("dd7e").default,a=t("4cf1").default,o=t("46c5").default,i=t("883d").default,s=t("4db6").default;t("c1a3"),t("bf0f"),t("18f7"),t("de6c"),t("f7a5");var c=t("1d0b"),l=function(){"use strict";function n(){i(this,n),this.cache=new Map,this.preloadQueue=[],this.maxPreloadCount=3,this.isH5="undefined"!==typeof window}return s(n,[{key:"preloadImages",value:function(){var n=o(e().mark((function n(r,t){var o,i,s,l,u;return e().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(Array.isArray(r)&&0!==r.length){n.next=2;break}return n.abrupt("return");case 2:o=r.slice(0,this.maxPreloadCount),i=a(o),n.prev=4,i.s();case 6:if((s=i.n()).done){n.next=24;break}if(l=s.value,!this.cache.has(l)){n.next=11;break}return t&&t(l,!0),n.abrupt("continue",22);case 11:return n.prev=11,n.next=14,c.loadImage(l,{useCache:!0,fallbackToOriginal:!0});case 14:u=n.sent,u.success?(this.cache.set(l,u.url),t&&t(l,!0)):(console.error("图片预加载失败:",l,u.error),t&&t(l,!1)),n.next=22;break;case 18:n.prev=18,n.t0=n["catch"](11),console.error("图片预加载异常:",l,n.t0),t&&t(l,!1);case 22:n.next=6;break;case 24:n.next=29;break;case 26:n.prev=26,n.t1=n["catch"](4),i.e(n.t1);case 29:return n.prev=29,i.f(),n.finish(29);case 32:case"end":return n.stop()}}),n,this,[[4,26,29,32],[11,18]])})));return function(r,t){return n.apply(this,arguments)}}()},{key:"getCachedImage",value:function(n){return this.cache.get(n)||n}},{key:"clearCache",value:function(){this.cache.clear()}},{key:"getCacheSize",value:function(){return this.cache.size}}]),n}(),u=new l;n.exports=u},fcd5:function(n,r,t){var e=t("5014").default,a=t("d189").default,o=t("4cf1").default;t("8f71"),t("bf0f"),t("aa9c"),t("fd3c");var i=t("139b"),s=i.formatRelativeTime,c=["createTime","postCreateTime","publishTime","createdAt","updateTime"],l=function(n){return n?Array.isArray(n)?n.filter(Boolean):[n].filter(Boolean):[]},u=function(n){var r,t=o(c);try{for(t.s();!(r=t.n()).done;){var e=r.value;if(n[e])return{key:e,value:n[e]}}}catch(a){t.e(a)}finally{t.f()}return null},d=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.withTime,o=void 0===t||t,i=l(n.imageUrls);0===i.length&&i.push.apply(i,a(l(n.imageUrl)));var c=l(n.originalImageUrls);0===c.length&&c.push.apply(c,a(l(n.originalImageUrl))),0===c.length&&i.length>0&&c.push.apply(c,a(i));var d=e(e({},n),{},{imageUrls:i,originalImageUrls:c,authorName:n.authorName||"匿名用户",authorAvatar:"string"===typeof n.authorAvatar?n.authorAvatar:""});if(!d.imageStyle&&i.length>0&&(d.imageStyle="height: 0; padding-bottom: 75%;"),o)if(n.formattedCreateTime)d.formattedCreateTime=n.formattedCreateTime;else{var f=u(n);f&&(d.formattedCreateTime=s(f.value))}return d};n.exports={normalizePost:d,normalizePostList:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Array.isArray(n)?n.map((function(n){return d(n,r)})):[]}}},fe58:function(n,r){n.exports={getLikeIcon:function(n,r){var t="";return t=n<=3?r?"seedplus.png":"seed.png":n<=7?r?"leafplus.png":"leaf.png":n<=15?r?"flowerplus .png":"flower.png":r?"peachplus.png":"peach.png","/static/images/"+t},getLikeIconDescription:function(n){return n<=3?"种子":n<=7?"叶子":n<=15?"花":"果实"}}}}]);