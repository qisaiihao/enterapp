(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-feedback-admin-feedback-admin"],{2936:function(n,r,e){"use strict";e.d(r,"b",(function(){return t})),e.d(r,"c",(function(){return a})),e.d(r,"a",(function(){}));var t=function(){var n=this,r=n.$createElement,e=n._self._c||r;return e("v-uni-view",{staticClass:"container",style:"padding-top: "+n.statusBarHeight+"px;"},[e("v-uni-view",{staticClass:"header",style:"top: "+n.statusBarHeight+"px;"},[e("v-uni-view",{staticClass:"header-left",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.goBack.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"back-icon"},[n._v("←")])],1),e("v-uni-text",{staticClass:"header-title"},[n._v("反馈管理")]),e("v-uni-view",{staticClass:"header-right",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.refreshFeedbackList.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"refresh-icon"},[n._v("🔄")])],1)],1),e("v-uni-view",{staticClass:"feedback-list"},[n.feedbackList.length>0?n._l(n.feedbackList,(function(r,t){return e("v-uni-view",{key:t,class:"feedback-item "+(r.isProcessed?"processed":"")},[e("v-uni-view",{staticClass:"feedback-header"},[e("v-uni-view",{staticClass:"user-info"},[e("v-uni-text",{staticClass:"user-name"},[n._v(n._s(r.userName||"匿名用户"))]),e("v-uni-text",{staticClass:"feedback-time"},[n._v(n._s(r.formattedCreateTime))])],1),e("v-uni-view",{class:"status-badge "+(r.isProcessed?"processed":"pending")},[n._v(n._s(r.isProcessed?"已处理":"待处理"))])],1),e("v-uni-view",{staticClass:"feedback-content"},[e("v-uni-text",{staticClass:"content-text"},[n._v(n._s(r.content))])],1),r.imageUrls&&r.imageUrls.length>0?e("v-uni-view",{staticClass:"feedback-images"},[e("v-uni-view",{staticClass:"image-grid"},n._l(r.imageUrls,(function(t,a){return e("v-uni-image",{key:a,staticClass:"feedback-image",attrs:{src:t,mode:"aspectFill","data-src":t,"data-urls":r.imageUrls},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.previewImage.apply(void 0,arguments)}}})})),1)],1):n._e(),e("v-uni-view",{staticClass:"feedback-actions"},[r.isProcessed?n._e():e("v-uni-button",{staticClass:"action-btn process-btn",attrs:{size:"mini","data-id":r._id,"data-index":t},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.markAsProcessed.apply(void 0,arguments)}}},[n._v("标记已处理")]),e("v-uni-button",{staticClass:"action-btn delete-btn",attrs:{size:"mini","data-id":r._id,"data-index":t},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.deleteFeedback.apply(void 0,arguments)}}},[n._v("删除")])],1)],1)})):e("v-uni-view",{staticClass:"empty-state"},[e("v-uni-text",{staticClass:"empty-icon"},[n._v("📝")]),e("v-uni-text",{staticClass:"empty-text"},[n._v("暂无反馈")])],1)],2)],1)},a=[]},3352:function(n,r,e){var t=e("6459");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[n.i,t,""]]),t.locals&&(n.exports=t.locals);var a=e("967d").default;a("54c14eca",t,!0,{sourceMap:!1,shadowMode:!1})},3941:function(n,r,e){"use strict";e.r(r);var t=e("e9e1"),a=e.n(t);for(var i in t)["default"].indexOf(i)<0&&function(n){e.d(r,n,(function(){return t[n]}))}(i);r["default"]=a.a},6459:function(n,r,e){var t=e("c86c");r=t(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* 管理员反馈查看页面样式 */.container[data-v-4810afd4]{min-height:100vh;background-color:#f5f5f5;padding-top:0}\r\n/* 头部 */.header[data-v-4810afd4]{display:flex;align-items:center;justify-content:space-between;padding:%?20?% %?30?%;background-color:#fff;border-bottom:%?1?% solid #eee;position:-webkit-sticky;position:sticky;top:0;z-index:100}.header-left[data-v-4810afd4],\r\n.header-right[data-v-4810afd4]{width:%?60?%;height:%?60?%;display:flex;align-items:center;justify-content:center}.back-icon[data-v-4810afd4],\r\n.refresh-icon[data-v-4810afd4]{font-size:%?36?%;color:#333;font-weight:700}.header-title[data-v-4810afd4]{font-size:%?32?%;font-weight:600;color:#333}\r\n/* 反馈列表 */.feedback-list[data-v-4810afd4]{padding:%?20?%}.feedback-item[data-v-4810afd4]{background-color:#fff;border-radius:%?16?%;padding:%?30?%;margin-bottom:%?20?%;box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1)}.feedback-item.processed[data-v-4810afd4]{opacity:.7;background-color:#f8f8f8}\r\n/* 反馈头部 */.feedback-header[data-v-4810afd4]{display:flex;justify-content:space-between;align-items:center;margin-bottom:%?20?%}.user-info[data-v-4810afd4]{display:flex;flex-direction:column}.user-name[data-v-4810afd4]{font-size:%?28?%;font-weight:600;color:#333;margin-bottom:%?8?%}.feedback-time[data-v-4810afd4]{font-size:%?24?%;color:#999}.status-badge[data-v-4810afd4]{padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?22?%;font-weight:500}.status-badge.pending[data-v-4810afd4]{background-color:#fff2e8;color:#fa8c16}.status-badge.processed[data-v-4810afd4]{background-color:#f6ffed;color:#52c41a}\r\n/* 反馈内容 */.feedback-content[data-v-4810afd4]{margin-bottom:%?20?%}.content-text[data-v-4810afd4]{font-size:%?28?%;color:#333;line-height:1.6;white-space:pre-wrap}\r\n/* 反馈图片 */.feedback-images[data-v-4810afd4]{margin-bottom:%?20?%}.image-grid[data-v-4810afd4]{display:flex;flex-wrap:wrap;gap:%?10?%}.feedback-image[data-v-4810afd4]{width:%?120?%;height:%?120?%;border-radius:%?8?%;background-color:#f0f0f0}\r\n/* 操作按钮 */.feedback-actions[data-v-4810afd4]{display:flex;justify-content:flex-end;gap:%?20?%}.action-btn[data-v-4810afd4]{border-radius:%?20?%;font-size:%?24?%;padding:0 %?20?%;height:%?60?%;line-height:%?60?%}.process-btn[data-v-4810afd4]{background-color:#52c41a;color:#fff;border:none}.delete-btn[data-v-4810afd4]{background-color:#ff4d4f;color:#fff;border:none}.action-btn[data-v-4810afd4]::after{border:none}\r\n/* 空状态 */.empty-state[data-v-4810afd4]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% 0}.empty-icon[data-v-4810afd4]{font-size:%?80?%;margin-bottom:%?20?%}.empty-text[data-v-4810afd4]{font-size:%?28?%;color:#999}\r\n/* 加载状态 */.loading-more[data-v-4810afd4],\r\n.no-more[data-v-4810afd4]{text-align:center;padding:%?40?% 0;font-size:%?24?%;color:#999}",""]),n.exports=r},"73e1":function(n,r,e){"use strict";var t=e("29d8");n.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(t)},"795c":function(n,r,e){"use strict";var t=e("8bdb"),a=e("db04").start,i=e("73e1");t({target:"String",proto:!0,forced:i},{padStart:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},"962f":function(n,r,e){e("795c"),e("64aa"),e("5c47"),e("a1c1"),e("c223"),e("f7a5");var t=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(n).padStart(r,"0")},a=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",e=n instanceof Date?n:new Date(n);if(Number.isNaN(e.getTime()))return"";var a={yyyy:String(e.getFullYear()),MM:t(e.getMonth()+1),dd:t(e.getDate()),HH:t(e.getHours()),mm:t(e.getMinutes()),ss:t(e.getSeconds())};return r.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(n){return a[n]}))};n.exports={formatTimeAgo:function(n){var r=new Date,e=new Date(n),t=r.getTime()-e.getTime(),a=Math.floor(t/1e3),i=Math.floor(a/60),o=Math.floor(i/60),s=Math.floor(o/24);if(s>=7){var c=e.getFullYear(),d=("0"+(e.getMonth()+1)).slice(-2),u=("0"+e.getDate()).slice(-2);return"".concat(c,"-").concat(d,"-").concat(u)}return s>=1?"".concat(s,"天前"):o>=1?"".concat(o,"小时前"):i>=1?"".concat(i,"分钟前"):"刚刚"},formatRelativeTime:function(n){var r=Date.now(),e=n instanceof Date?n.getTime():new Date(n).getTime();if(Number.isNaN(e))return"";var t=r-e,i=Math.floor(Math.abs(t)/1e3),o=t>=0?"前":"后";if(i<60)return"刚刚";var s=Math.floor(i/60);if(s<60)return"".concat(s,"分钟").concat(o);var c=Math.floor(s/60);if(c<24)return"".concat(c,"小时").concat(o);var d=Math.floor(c/24);return d<7?"".concat(d,"天").concat(o):a(e,"yyyy-MM-dd")},formatDate:a}},b2b2:function(n,r,e){"use strict";var t=e("3352"),a=e.n(t);a.a},db04:function(n,r,e){"use strict";var t=e("bb80"),a=e("c435"),i=e("9e70"),o=e("f298"),s=e("862c"),c=t(o),d=t("".slice),u=Math.ceil,l=function(n){return function(r,e,t){var o,l,f=i(s(r)),v=a(e),g=f.length,h=void 0===t?" ":i(t);return v<=g||""===h?f:(o=v-g,l=c(h,u(o/h.length)),l.length>o&&(l=d(l,0,o)),n?f+l:l+f)}};n.exports={start:l(!1),end:l(!0)}},e0d6:function(n,r,e){"use strict";e.r(r);var t=e("2936"),a=e("3941");for(var i in a)["default"].indexOf(i)<0&&function(n){e.d(r,n,(function(){return a[n]}))}(i);e("b2b2");var o=e("828b"),s=Object(o["a"])(a["default"],t["b"],t["c"],!1,null,"4810afd4",null,!1,t["a"],void 0);r["default"]=s.exports},e9e1:function(n,r,e){"use strict";e("6a54");var t=e("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,e("4626"),e("7a76"),e("c9b5"),e("5ac7"),e("bf0f"),e("2797"),e("c223"),e("8f71");var a=t(e("39d8")),i=t(e("2634")),o=t(e("2fdc")),s=e("962f"),c=s.formatRelativeTime,d=e("edf3"),u=d.previewImage,l=e("38db"),f=l.cloudCall,v={data:function(){return{feedbackList:[],loading:!1,hasMore:!0,page:0,pageSize:10,isAdmin:!1,currentUserOpenid:"",statusBarHeight:0,imageUrl:""}},onLoad:function(){var n=uni.getSystemInfoSync();this.setData({statusBarHeight:n.statusBarHeight}),uni.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#ffffff"}),this.checkAdminPermission()},onShow:function(){this.isAdmin&&this.refreshFeedbackList()},onPullDownRefresh:function(){this.refreshFeedbackList(),uni.stopPullDownRefresh()},onReachBottom:function(){this.hasMore&&!this.loading&&this.loadFeedbackList()},methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return f(n,r,Object.assign({pageTag:"feedback-admin",context:this},e))},checkAdminPermission:function(){var n=this;return(0,o.default)((0,i.default)().mark((function r(){var e,t,a,o;return(0,i.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.callCloudFunction("getOpenId",{});case 3:if(e=r.sent,!e.result||!e.result.openid){r.next=17;break}if(t=e.result.openid,a=["ojYBd1_A3uCbQ1LGcHxWxOAeA5SE","ojYBd14JG3-ghYuGCI2WHmkMc9nE"],o=a.includes(t),console.log("反馈管理页面 - 当前用户:",t),console.log("反馈管理页面 - 是否为管理员:",o),n.setData({currentUserOpenid:t,isAdmin:o}),o){r.next=14;break}return uni.showModal({title:"权限不足",content:"您没有权限访问反馈管理功能",showCancel:!1,success:function(){uni.navigateBack()}}),r.abrupt("return");case 14:n.loadFeedbackList(),r.next=18;break;case 17:throw new Error("无法获取用户信息");case 18:r.next=26;break;case 20:r.prev=20,r.t0=r["catch"](0),console.log("CatchClause",r.t0),console.log("CatchClause",r.t0),console.error("权限检查失败:",r.t0),uni.showModal({title:"错误",content:"权限检查失败，无法访问此页面",showCancel:!1,success:function(){uni.navigateBack()}});case 26:case"end":return r.stop()}}),r,null,[[0,20]])})))()},loadFeedbackList:function(){var n=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.loading){var e=this.page,t=this.pageSize,a=r?0:e;this.setData({loading:!0}),this.callCloudFunction("feedbackManager",{action:"getFeedbackList",skip:a*t,limit:t}).then((function(e){if(e.result&&e.result.success){var i=e.result.feedbackList||[];i.forEach((function(r){r.formattedCreateTime=n.formatTime(r.createTime)}));var o=r?i:n.feedbackList.concat(i);n.setData({feedbackList:o,page:a+1,hasMore:i.length===t})}else{var s;uni.showToast({title:(null===(s=e.result)||void 0===s?void 0:s.message)||"加载失败",icon:"none"})}})).catch((function(n){console.error("加载反馈列表失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({loading:!1})}))}},refreshFeedbackList:function(){this.setData({feedbackList:[],page:0,hasMore:!0}),this.loadFeedbackList(!0)},formatTime:function(n){return c(n)},previewImage:function(n){return u(n,{fallbackToast:!1})},deleteFeedback:function(n){var r=n.currentTarget.dataset.id,e=n.currentTarget.dataset.index,t=this;uni.showModal({title:"确认删除",content:"确定要删除这条反馈吗？",confirmColor:"#ff4d4f",success:function(n){n.confirm&&(uni.showLoading({title:"删除中..."}),this.callCloudFunction("feedbackManager",{action:"deleteFeedback",feedbackId:r}).then((function(n){if(uni.hideLoading(),n.result&&n.result.success){uni.showToast({title:"删除成功",icon:"success"});var r=t.feedbackList.filter((function(n,r){return r!==e}));t.setData({feedbackList:r})}else{var a;uni.showToast({title:(null===(a=n.result)||void 0===a?void 0:a.message)||"删除失败",icon:"none"})}})).catch((function(n){uni.hideLoading(),console.error("删除反馈失败:",n),uni.showToast({title:"删除失败",icon:"none"})})))}})},markAsProcessed:function(n){var r=n.currentTarget.dataset.id,e=n.currentTarget.dataset.index,t=this;uni.showLoading({title:"处理中..."}),this.callCloudFunction("feedbackManager",{action:"markAsProcessed",feedbackId:r}).then((function(n){var r,i;(uni.hideLoading(),n.result&&n.result.success)?(uni.showToast({title:"已标记为处理",icon:"success"}),t.setData((r={},(0,a.default)(r,"feedbackList[".concat(e,"].isProcessed"),!0),(0,a.default)(r,"feedbackList[".concat(e,"].processedTime"),new Date),r))):uni.showToast({title:(null===(i=n.result)||void 0===i?void 0:i.message)||"操作失败",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("标记处理失败:",n),uni.showToast({title:"操作失败",icon:"none"})}))},goBack:function(){uni.navigateBack()}}};r.default=v},edf3:function(n,r,e){function t(n){if(!n)return{current:"",urls:[]};if(n.currentTarget&&n.currentTarget.dataset){var r=n.currentTarget.dataset,e=r.src||r.current||r.url||Array.isArray(r.urls)&&r.urls[0]||"",t=r.originalImageUrls||r.urls||r.urlList,a=Array.isArray(t)?t.filter(Boolean):"string"===typeof t&&t?[t]:[];return{current:e,urls:a}}var i=n.current||n.src||Array.isArray(n.urls)&&n.urls[0]||Array.isArray(n.list)&&n.list[0]||"",o=Array.isArray(n.urls)?n.urls.filter(Boolean):Array.isArray(n.list)?n.list.filter(Boolean):[];return{current:i,urls:o}}function a(n){"undefined"!==typeof uni&&uni.showToast&&uni.showToast({title:n,icon:"none"})}e("8f71"),e("bf0f"),n.exports={previewImage:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=r.fallbackToast,i=void 0===e||e,o=t(n);if(!o.current&&0===o.urls.length)return i&&a("图片数据缺失"),!1;var s=o.urls.length?o.urls:[o.current],c=o.current||s[0];return c&&0!==s.length?uni.previewImage({current:c,urls:s}):(i&&a("图片不可预览"),!1)}}}}]);