(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-my-likes-my-likes"],{"0aa6":function(n,t,r){var e=r("4eb6");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=r("967d").default;a("dcb25fc8",e,!0,{sourceMap:!1,shadowMode:!1})},"1e51":function(n,t,r){"use strict";r.r(t);var e=r("5473"),a=r.n(e);for(var i in e)["default"].indexOf(i)<0&&function(n){r.d(t,n,(function(){return e[n]}))}(i);t["default"]=a.a},"4eb6":function(n,t,r){var e=r("c86c");t=e(!1),t.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* pages/my-likes/my-likes.wxss */.container[data-v-2d45613c]{padding:%?20?%;background-color:#f7f8fa;min-height:100vh}.header[data-v-2d45613c]{padding:%?20?% 0;margin-bottom:%?20?%}.header-title[data-v-2d45613c]{font-size:%?36?%;font-weight:700;color:#333}.loading-indicator[data-v-2d45613c]{display:flex;justify-content:center;align-items:center;height:%?400?%;background-color:#fff;border-radius:%?16?%;margin:%?30?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.loading-indicator uni-text[data-v-2d45613c]{font-size:%?28?%;color:#999}.post-list[data-v-2d45613c]{margin-bottom:%?20?%}.post-item[data-v-2d45613c]{width:100%;padding:%?30?%;margin-bottom:%?20?%;background-color:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);box-sizing:border-box;transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease}.post-item[data-v-2d45613c]:active{-webkit-transform:scale(.98);transform:scale(.98)}.author-info[data-v-2d45613c]{display:flex;align-items:center;margin-bottom:%?15?%}.author-avatar[data-v-2d45613c]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;background-color:#f5f5f5}.author-name[data-v-2d45613c]{font-size:%?28?%;color:#333;font-weight:500}.post-title[data-v-2d45613c]{font-size:%?32?%;font-weight:700;color:#333;margin-bottom:%?10?%;line-height:1.4;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}.post-content-preview[data-v-2d45613c]{font-size:%?26?%;color:#666;line-height:1.5;margin-bottom:%?15?%;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}.image-container[data-v-2d45613c]{position:relative;width:100%;margin:%?15?% 0}.post-image[data-v-2d45613c]{width:100%;height:auto;display:block;transition:-webkit-transform .3s ease;transition:transform .3s ease;transition:transform .3s ease,-webkit-transform .3s ease}.post-image[data-v-2d45613c]:active{-webkit-transform:scale(1.05);transform:scale(1.05)}.image-count-indicator[data-v-2d45613c]{position:absolute;top:%?15?%;right:%?15?%;background-color:rgba(0,0,0,.6);color:#fff;padding:%?6?% %?12?%;border-radius:%?16?%;font-size:%?22?%;z-index:10;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}.image-count-text[data-v-2d45613c]{font-size:%?22?%;color:#fff}.post-meta[data-v-2d45613c]{margin-top:%?15?%}.post-time[data-v-2d45613c]{font-size:%?24?%;color:#999;opacity:.8}.empty-tip[data-v-2d45613c]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% %?40?%;text-align:center}.empty-icon[data-v-2d45613c]{font-size:%?120?%;margin-bottom:%?30?%;opacity:.6}.empty-text[data-v-2d45613c]{font-size:%?32?%;color:#666;margin-bottom:%?15?%}.empty-subtext[data-v-2d45613c]{font-size:%?28?%;color:#999}\r\n/* 多图轮播白色背景 */.swiper-bg-white[data-v-2d45613c]{background:#fff!important}",""]),n.exports=t},5473:function(n,t,r){"use strict";r("6a54");var e=r("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r("7a76"),r("c9b5"),r("c223");var a=e(r("2634")),i=e(r("2fdc")),o=(getApp(),r("edf3")),s=o.previewImage,l=r("81f6"),c=l.normalizePostList,d=r("38db"),u=d.cloudCall,f=r("9c8b"),g=r("d6e5"),p={mixins:[g,f],data:function(){return{likedPosts:[],swiperHeights:{},imageClampHeights:{},imgindex:0,img:""}},onLoad:function(n){this.initPagination(this.loadLikedPosts,{pageSize:5})},methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u(n,t,Object.assign({pageTag:"my-likes",context:this,requireAuth:!0},r))},loadLikedPosts:function(n){var t=this;return(0,i.default)((0,a.default)().mark((function r(){var e,i,o,s,l,d,u,f;return(0,a.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e=n.page,i=n.isRefresh,o=5*e,console.log("【my-likes】请求分页参数",{page:e,PAGE_SIZE:5,skip:o,limit:5}),i&&t.setData({swiperHeights:{},imageClampHeights:{}}),r.prev=4,r.next=7,t.callCloudFunction("getMyLikedPosts",{skip:o,limit:5});case 7:if(s=r.sent,s.result&&!0===s.result.success){r.next=14;break}throw l=s.result&&s.result.message||"数据加载失败",uni.showToast({title:l,icon:"none"}),d=new Error(l),d.__toastShown=!0,d;case 14:return u=c(s.result.posts||[]),console.log("【my-likes】本次返回帖子数量:",u.length),f=0===e||i?u:t.likedPosts.concat(u),console.log("【my-likes】更新后 likedPosts 长度:",f.length,"hasMore:",5===u.length,"page:",e+1),t.setData({likedPosts:f}),r.abrupt("return",{list:u,hasMore:5===u.length});case 22:throw r.prev=22,r.t0=r["catch"](4),console.error("Failed to fetch liked posts",r.t0),r.t0&&r.t0.__toastShown||uni.showToast({title:"网络错误",icon:"none"}),r.t0;case 27:case"end":return r.stop()}}),r,null,[[4,22]])})))()},navigateToPost:function(n){var t=n.currentTarget.dataset.id;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},handlePreview:function(n){var t=s(n);!1===t&&console.warn("【my-likes】图片预览失败，缺少必要数据")},onImageError:function(n){console.error("图片加载失败",n);var t=n.detail.src;console.error("失败的图片URL:",t);var r=n.currentTarget.dataset,e=r.postindex,a=r.imgindex;if(void 0!==e&&void 0!==a){var i=this.likedPosts[e];console.error("图片加载失败的上下文:",{postId:i?i._id:"unknown",postTitle:i?i.title:"unknown",imageIndex:a,imageUrl:t})}console.error("图片加载失败详情:",{error:n.detail,src:t,dataset:n.currentTarget.dataset})},onAvatarError:function(n){console.error("头像加载失败",n)}}};t.default=p},"590a":function(n,t,r){"use strict";var e=r("0aa6"),a=r.n(e);a.a},"5ec8":function(n,t,r){"use strict";r.r(t);var e=r("6c23"),a=r("1e51");for(var i in a)["default"].indexOf(i)<0&&function(n){r.d(t,n,(function(){return a[n]}))}(i);r("590a");var o=r("828b"),s=Object(o["a"])(a["default"],e["b"],e["c"],!1,null,"2d45613c",null,!1,e["a"],void 0);t["default"]=s.exports},"6c23":function(n,t,r){"use strict";r.d(t,"b",(function(){return e})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){}));var e=function(){var n=this,t=n.$createElement,r=n._self._c||t;return r("v-uni-view",{staticClass:"container"},[r("v-uni-view",{staticClass:"header"},[r("v-uni-text",{staticClass:"header-title"},[n._v("我的点赞")])],1),n.isLoading&&0===n.likedPosts.length?r("v-uni-view",{staticClass:"loading-indicator"},[r("v-uni-text",[n._v("加载中...")])],1):r("v-uni-view",[n.likedPosts.length>0?r("v-uni-view",{staticClass:"post-list"},[n._l(n.likedPosts,(function(t,e){return r("v-uni-view",{key:e,staticClass:"post-item",attrs:{"data-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateToPost.apply(void 0,arguments)}}},[r("v-uni-view",{staticClass:"author-info"},[r("v-uni-image",{staticClass:"author-avatar",attrs:{src:t.authorAvatar||"/static/images/icons/avatar.png",mode:"aspectFill"},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onAvatarError.apply(void 0,arguments)}}}),r("v-uni-text",{staticClass:"author-name"},[n._v(n._s(t.authorName))])],1),r("v-uni-view",{staticClass:"post-title"},[n._v(n._s(t.title))]),r("v-uni-view",{staticClass:"post-content-preview"},[n._v(n._s(t.content))]),t.imageUrl||t.imageUrls&&t.imageUrls.length>0?r("v-uni-view",{staticClass:"image-container",attrs:{id:"image-container-"+e}},[t.imageUrls&&1===t.imageUrls.length?[r("v-uni-image",{style:"width: 100%; height: "+(n.imageClampHeights[t._id]?n.imageClampHeights[t._id]+"px":"auto")+"; object-fit: "+(n.imageClampHeights[t._id]?"cover":"contain")+"; background-color: #f0f0f0;",attrs:{id:"single-image-"+t._id,src:t.imageUrls[0],mode:n.imageClampHeights[t._id]?"aspectFill":"widthFix","data-postid":t._id,"data-type":"single","data-src":t.imageUrls[0],"data-original-image-urls":t.originalImageUrls||t.imageUrls,"lazy-load":!0},on:{load:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageLoad.apply(void 0,arguments)},error:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageError.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.handlePreview.apply(void 0,arguments)}}})]:t.imageUrls&&t.imageUrls.length>1?[r("v-uni-swiper",{staticClass:"image-swiper",style:"width: 100%; height: "+(n.swiperHeights[e]?n.swiperHeights[e]+"px":"220px")+";",attrs:{id:"swiper-"+t._id,"indicator-dots":!0,circular:!0}},[n._l(t.imageUrls,(function(a,i){return[r("v-uni-swiper-item",[r("v-uni-image",{staticStyle:{width:"100%",height:"100%","object-fit":"cover","background-color":"#f0f0f0"},attrs:{src:a,mode:"aspectFill","data-postid":t._id,"data-postindex":e,"data-imgindex":i,"data-type":"multi","data-src":a,"data-original-image-urls":t.originalImageUrls||t.imageUrls,"lazy-load":!0},on:{load:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageLoad.apply(void 0,arguments)},error:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageError.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.handlePreview.apply(void 0,arguments)}}})],1)]}))],2)]:n._e()],2):n._e(),r("v-uni-view",{staticClass:"post-meta"},[r("v-uni-text",{staticClass:"post-time"},[n._v(n._s(t.formattedCreateTime))])],1)],1)})),n.isLoading&&n.likedPosts.length>0?r("v-uni-view",{staticClass:"loading-indicator"},[r("v-uni-text",[n._v("加载中...")])],1):n._e()],2):r("v-uni-view",{staticClass:"empty-tip"},[r("v-uni-view",{staticClass:"empty-icon"},[n._v("👍")]),r("v-uni-view",{staticClass:"empty-text"},[n._v("你还没有点赞任何帖子哦～")]),r("v-uni-view",{staticClass:"empty-subtext"},[n._v("去首页发现精彩内容吧！")])],1)],1)],1)},a=[]},"81f6":function(n,t,r){var e=r("5014").default,a=r("d189").default,i=r("4cf1").default;r("8f71"),r("bf0f"),r("aa9c"),r("fd3c");var o=r("962f"),s=o.formatRelativeTime,l=["createTime","postCreateTime","publishTime","createdAt","updateTime"],c=function(n){return n?Array.isArray(n)?n.filter(Boolean):[n].filter(Boolean):[]},d=function(n){var t,r=i(l);try{for(r.s();!(t=r.n()).done;){var e=t.value;if(n[e])return{key:e,value:n[e]}}}catch(a){r.e(a)}finally{r.f()}return null},u=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.withTime,i=void 0===r||r,o=c(n.imageUrls);0===o.length&&o.push.apply(o,a(c(n.imageUrl)));var l=c(n.originalImageUrls);0===l.length&&l.push.apply(l,a(c(n.originalImageUrl))),0===l.length&&o.length>0&&l.push.apply(l,a(o));var u=e(e({},n),{},{imageUrls:o,originalImageUrls:l,authorName:n.authorName||"匿名用户",authorAvatar:"string"===typeof n.authorAvatar?n.authorAvatar:""});if(!u.imageStyle&&o.length>0&&(u.imageStyle="height: 0; padding-bottom: 75%;"),i)if(n.formattedCreateTime)u.formattedCreateTime=n.formattedCreateTime;else{var f=d(n);f&&(u.formattedCreateTime=s(f.value))}return u};n.exports={normalizePost:u,normalizePostList:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Array.isArray(n)?n.map((function(n){return u(n,t)})):[]}}},d6e5:function(n,t,r){var e=r("dd7e").default,a=r("46c5").default,i=r("bdbb").default,o=r("5014").default;r("dc8a"),r("bf0f"),r("2797"),r("7a76"),r("c9b5");var s={page:0,hasMore:!0,isLoading:!1,isLoadingMore:!1},l=Object.keys(s);function c(n){return n.__paginationState||(n.__paginationState=o({},s)),"object"!==i(n.pagination)||null===n.pagination?n.pagination=o({},s):n.pagination=o(o({},s),n.pagination),l.forEach((function(t){"undefined"===typeof n[t]&&(n[t]=s[t])})),n.__paginationState}function d(n,t){var r=c(n);Object.assign(r,t),function(n,t){if(t&&"object"===i(t)){var r={};if(l.forEach((function(e){Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=t[e],n.pagination&&"object"===i(n.pagination)&&(n.pagination[e]=t[e]),n[e]=t[e])})),"function"===typeof n.setData){var e={};return Object.keys(r).forEach((function(n){e[n]=r[n],e["pagination.".concat(n)]=r[n]})),void n.setData(e)}Object.assign(n,r)}}(n,t)}function u(n,t,r){var e=r.pageSize,a=r.isRefresh,i=r.fallback;if(t&&"boolean"===typeof t.hasMore)return t.hasMore;var o=n.__paginationConfig||{};if("function"===typeof o.computeHasMore)try{var s=o.computeHasMore.call(n,t,{page:n.__paginationState.page,pageSize:e,isRefresh:a});if("boolean"===typeof s)return s}catch(l){console.warn("[pagination] computeHasMore 执行失败",l)}return t&&Array.isArray(t.list)?"number"===typeof e?t.list.length>=e:t.list.length>0:t&&Array.isArray(t.items)?"number"===typeof e?t.items.length>=e:t.items.length>0:"boolean"!==typeof i||i}function f(n){return g.apply(this,arguments)}function g(){return g=a(e().mark((function n(t){var r,a,i,o,s,l,f,g,p,v,h,m,b,w,y=arguments;return e().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=y.length>1&&void 0!==y[1]?y[1]:{},a=r.isRefresh,i=r.extra,o=void 0===i?{}:i,s=r.fromPullDown,l=void 0!==s&&s,f=t.__paginationConfig,f&&"function"===typeof f.loader){n.next=5;break}return console.warn("[pagination] 尚未通过 initPagination 注册加载函数"),n.abrupt("return",null);case 5:if(c(t),g=t.__paginationState,a||!1!==g.hasMore){n.next=9;break}return n.abrupt("return",null);case 9:if(!g.isLoading&&!g.isLoadingMore){n.next=11;break}return n.abrupt("return",null);case 11:return p=a?0:g.page,v=0===p,d(t,{isLoading:v,isLoadingMore:!v}),h={page:p,pageSize:f.pageSize,isRefresh:a,isFirstPage:v,extra:o},n.prev=15,"function"===typeof f.beforeLoad&&f.beforeLoad.call(t,h),n.next=19,f.loader.call(t,h);case 19:m=n.sent,b=p+1,w=u(t,m,{pageSize:f.pageSize,isRefresh:a,fallback:!!a||g.hasMore}),d(t,{page:b,hasMore:w}),"function"===typeof f.afterLoad&&f.afterLoad.call(t,m,h),n.next=30;break;case 26:throw n.prev=26,n.t0=n["catch"](15),"function"===typeof f.onError?f.onError.call(t,n.t0,h):console.error("[pagination] 加载数据失败",n.t0),n.t0;case 30:if(n.prev=30,d(t,{isLoading:!1,isLoadingMore:!1}),a&&!1!==f.autoStopPullDown&&l&&"undefined"!==typeof uni&&"function"===typeof uni.stopPullDownRefresh)try{uni.stopPullDownRefresh()}catch(e){console.warn("[pagination] stopPullDownRefresh 调用失败",e)}return n.finish(30);case 34:return n.abrupt("return",m);case 35:case"end":return n.stop()}}),n,null,[[15,26,30,34]])}))),g.apply(this,arguments)}n.exports={data:function(){return o({pagination:o({},s)},s)},created:function(){c(this)},onReachBottom:function(){this.__paginationConfig&&this.loadNext().catch((function(){}))},onPullDownRefresh:function(){this.__paginationConfig&&this.refresh({fromPullDown:!0}).catch((function(){}))},methods:{initPagination:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"!==typeof n)throw new TypeError("[pagination] initPagination 需要传入函数类型的 loader");var r=t.pageSize,e=void 0===r?10:r,a=t.immediate,i=void 0===a||a,l=t.autoStopPullDown,c=void 0===l||l,u=t.computeHasMore,f=t.beforeLoad,g=t.afterLoad,p=t.onError;return this.__paginationConfig={loader:n,pageSize:e,immediate:i,autoStopPullDown:c,computeHasMore:u,beforeLoad:f,afterLoad:g,onError:p},d(this,o({},s)),i?this.refresh({fromPullDown:!1}):Promise.resolve()},refresh:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c(this),d(this,{page:0,hasMore:!0}),f(this,o({isRefresh:!0},n))},loadNext:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return f(this,o({isRefresh:!1},n))},getPaginationState:function(){return c(this),o({},this.__paginationState)}}}}}]);