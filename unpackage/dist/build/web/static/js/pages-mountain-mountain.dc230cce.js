(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mountain-mountain"],{"0c27":function(n,r,t){"use strict";t.r(r);var e=t("16c7"),a=t.n(e);for(var o in e)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(o);r["default"]=a.a},"16c7":function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=e(t("39d8"));t("bf0f"),t("2797"),t("c223"),t("4626"),t("5ac7");var o=e(t("8cb3")),i=e(t("84be")),s=e(t("8cb3")),l=e(t("84be")),d=t("2b90"),c={components:{skeleton:o.default,folderSelector:i.default},mixins:[d],data:function(){return{isLoading:!0,postList:[],currentPostIndex:0,touchStartX:0,touchEndX:0,touchStartY:0,touchEndY:0,hasMore:!0,page:0,backgroundImage:"",isTransitioning:!1,preloadedImages:{},hasFirstLoad_var:!1,currentPost:null,bgLayers:[{url:"",visible:!1},{url:"",visible:!1}],activeLayerIndex:0,swiperHeights:{},imageClampHeights:{},selected:0,url:"",visible:!1}},onLoad:function(){console.log("Mountain 页面 onLoad");var n=getApp();n.globalData.preloadedMountainData&&n.globalData.preloadedMountainData.length>0?(console.log("Mountain: 使用预加载数据"),this.setData({postList:n.globalData.preloadedMountainData,isLoading:!1,page:1,hasFirstLoad_var:!0}),this.updatePostDisplay(0),n.globalData.preloadedMountainData=null):(console.log("Mountain: 无预加载数据，开始请求"),this.getMountainData())},onShow:function(){var n=t("d87a"),r=n.updateTabBarStatus;r(this,2);try{var e=uni.getStorageSync("shouldRefreshMountain");if(e)return console.log("【mountain】检测到发布标记，刷新数据"),uni.removeStorageSync("shouldRefreshMountain"),void this.refreshMountainData()}catch(a){console.log("CatchClause",a),console.log("CatchClause",a),console.error("检查刷新标记失败:",a)}this._hasFirstLoad?console.log("【mountain】再次进入，保持之前内容"):(console.log("【mountain】首次进入，刷新数据"),this.refreshMountainData())},methods:{refreshMountainData:function(){console.log("【mountain】开始刷新mountain数据"),this.setData({postList:[],currentPostIndex:0,page:0,hasMore:!0,bgLayers:[{url:"",visible:!1},{url:"",visible:!1}],activeLayerIndex:0}),this.getMountainData()},getMountainData:function(){var n=this;this.$tcb&&this.$tcb.callFunction&&this.$tcb.callFunction({name:"getPostList",data:{isPoem:!0,isOriginal:!1}}).then((function(r){console.log("Mountain数据获取成功:",r);var t=r.result.posts||[];n.setData({postList:t,isLoading:!1,hasFirstLoad_var:!0}),n.postList.length>0&&(n.setData({currentPost:n.postList[0]}),n.updatePostDisplay())})).catch((function(r){console.error("Mountain数据获取失败:",r),n.setData({isLoading:!1})}))},getPostList:function(n){var r=this;if(!this.isLoading){this.setData({isLoading:!0});var t=5*this.page;console.log("开始获取山诗歌列表，skip:",t,"page:",this.page),this.$tcb&&this.$tcb.callFunction&&this.$tcb.callFunction({name:"getPostList",data:{skip:t,limit:5,isPoem:!0,isOriginal:!1}}).then((function(n){if(console.log("获取山诗歌列表结果:",n),n.result&&n.result.success){var t=n.result.posts||[];console.log("获取到山诗歌数量:",t.length),t.forEach((function(n,r){console.log("山诗歌".concat(r+1,":"),{title:n.title,isPoem:n.isPoem,isOriginal:n.isOriginal,content:n.content?n.content.substring(0,50)+"...":"无内容"})})),t.forEach((function(n){n.imageUrls&&0!==n.imageUrls.length||(n.imageUrls=n.imageUrl?[n.imageUrl]:[])}));var e=0===r.page?t:r.postList.concat(t);console.log("山postList:",e),r.setData({postList:e,page:r.page+1,hasMore:5===t.length}),1===r.page&&e.length>0?(console.log("第一个山诗歌帖子数据:",{title:e[0].title,imageUrls:e[0].imageUrls,poemBgImage:e[0].poemBgImage,hasBgImage:!!e[0].poemBgImage}),r.updatePostDisplay(0),e.length>1&&r.loadImageForIndex(1),e.length>2&&r.loadImageForIndex(2)):console.log("未获取到山诗歌帖子数据")}else uni.showToast({title:"加载失败",icon:"none"})})).catch((function(n){console.error("获取山诗歌列表失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){r.setData({isLoading:!1}),"function"===typeof n&&n()}))}},touchStart:function(n){this.setData({touchStartX:n.touches[0].clientX,touchStartY:n.touches[0].clientY})},touchEnd:function(n){var r=n.changedTouches[0].clientX,t=n.changedTouches[0].clientY,e=this.touchStartX-r,a=this.touchStartY-t,o=Math.sqrt(e*e+a*a),i=Math.abs(180*Math.atan2(Math.abs(a),Math.abs(e))/Math.PI);o>80&&Math.abs(e)>50&&i<45&&(e>0?this.nextPost():this.prevPost())},nextPost:function(){var n=this;this.currentPostIndex<this.postList.length-1?(this.setData({isTransitioning:!0}),this.updatePostDisplay(this.currentPostIndex+1),setTimeout((function(){n.setData({isTransitioning:!1})}),500)):this.hasMore&&!this.isLoading&&this.loadMorePosts((function(){n.postList.length>n.currentPostIndex+1&&n.updatePostDisplay(n.currentPostIndex+1)}))},prevPost:function(){var n=this;this.currentPostIndex>0&&(this.setData({isTransitioning:!0}),this.updatePostDisplay(this.currentPostIndex-1),setTimeout((function(){n.setData({isTransitioning:!1})}),500))},onSinglePostTap:function(n){var r=n.currentTarget.dataset.postid;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(r)})},onImageError:function(n){console.error("山图片加载失败",n.detail)},loadMorePosts:function(n){var r=this;if(!this.isLoading){var t=5*this.page;console.log("开始加载更多山诗歌，skip:",t,"page:",this.page),this.$tcb&&this.$tcb.callFunction&&this.$tcb.callFunction({name:"getPostList",data:{skip:t,limit:5,isPoem:!0,isOriginal:!1}}).then((function(n){if(console.log("加载更多山诗歌结果:",n),n.result&&n.result.success){var t=n.result.posts||[];console.log("获取到更多山诗歌数量:",t.length),t.forEach((function(n){n.imageUrls&&0!==n.imageUrls.length||(n.imageUrls=n.imageUrl?[n.imageUrl]:[])}));var e=r.postList.concat(t);r.setData({postList:e,page:r.page+1,hasMore:5===t.length});var a=r.postList.length-t.length;t.forEach((function(n,t){r.loadImageForIndex(a+t)}))}})).catch((function(n){console.error("加载更多山诗歌失败:",n)})).finally((function(){"function"===typeof n&&n()}))}},preloadNextBackgroundImage:function(n){var r=this,t=n+1;t>=this.postList.length?this.hasMore&&!this.isLoading&&this.loadMorePosts((function(){t<r.postList.length&&r.loadImageForIndex(t)})):this.loadImageForIndex(t)},updatePostDisplay:function(n){var r=this;if(!(n<0||n>=this.postList.length)){var t=this.postList[n];if(t){this.setData({currentPost:t,currentPostIndex:n});var e=t.poemBgImage||t.imageUrls&&t.imageUrls[0]||"",o=this.preloadedImages[e];if(!o){var i=getApp();i.globalData.preloadedImages&&i.globalData.preloadedImages[e]?(o=i.globalData.preloadedImages[e],this.setData((0,a.default)({},"preloadedImages.".concat(e),o))):o=e}var s=""===this.bgLayers[0].url&&""===this.bgLayers[1].url;s?(console.log("首次显示背景图，直接设置第一个图层"),this.setData({"bgLayers[0].url":o,"bgLayers[0].visible":!0,"bgLayers[1].visible":!1,activeLayerIndex:0}),console.log("首次显示完成，立即预加载第二张图片"),this.preloadNextBackgroundImage(n)):(setTimeout((function(){r.switchBackgroundImage(o)}),100),this.preloadNextBackgroundImage(n))}}},switchBackgroundImage:function(n){var r;if(n){var t=this.preloadedImages[n],e=t||n;console.log("切换背景图:",{originalUrl:n,preloadedUrl:t,finalUrl:e,hasPreloaded:!!t});var o=this.activeLayerIndex,i=(o+1)%2;this.pendingLayerIndex=i,this.pendingCurrentIndex=o,this.setData((r={},(0,a.default)(r,"bgLayers[".concat(i,"].url"),e),(0,a.default)(r,"bgLayers[".concat(i,"].visible"),!1),r))}},onBackgroundImageLoad:function(n){var r,t=n.currentTarget.dataset.layerIndex;(console.log("图层".concat(t,"图片加载完成")),this.pendingLayerIndex===t)&&(console.log("待切换图层图片加载完成，开始切换透明度"),this.setData((r={},(0,a.default)(r,"bgLayers[".concat(this.pendingCurrentIndex,"].visible"),!1),(0,a.default)(r,"bgLayers[".concat(this.pendingLayerIndex,"].visible"),!0),(0,a.default)(r,"activeLayerIndex",this.pendingLayerIndex),r)),this.pendingLayerIndex=null,this.pendingCurrentIndex=null)},loadImageForIndex:function(n,r){var t=this,e=this.postList[n];if(e){var o=e.poemBgImage||e.imageUrls&&e.imageUrls[0]||"";if(o){var i=getApp();if(i.globalData.preloadedImages&&i.globalData.preloadedImages[o])return console.log("使用全局预加载缓存:",o),this.setData((0,a.default)({},"preloadedImages.".concat(o),i.globalData.preloadedImages[o])),void("function"===typeof r&&r(i.globalData.preloadedImages[o]));if(!this.preloadedImages[o]){console.log("开始预加载山图片:",o);var s="undefined"!==typeof window;if(s&&(o.includes("tcb.qcloud.la")||o.includes("cloudbase")))return console.log("🔍 [H5] 山页面检测到腾讯云存储URL，直接使用:",o),this.setData((0,a.default)({},"preloadedImages.".concat(o),o)),void("function"===typeof r&&r(o));uni.downloadFile({url:o,success:function(n){200===n.statusCode&&(console.log("山图片预加载成功:",o),t.setData((0,a.default)({},"preloadedImages.".concat(o),n.tempFilePath)),"function"===typeof r&&r(n.tempFilePath))},fail:function(n){console.error("山图片预加载失败:",o,n),s&&(console.log("🔍 [H5] 山页面预加载失败，使用原URL:",o),t.setData((0,a.default)({},"preloadedImages.".concat(o),o)),"function"===typeof r&&r(o))}})}}}},testImageUrls:function(){console.log("占位：函数 testImageUrls 未声明")}}};r.default=c,r.default.components=Object.assign({skeleton:s.default,"folder-selector":l.default},r.default.components||{})},27748:function(n,r,t){"use strict";t.d(r,"b",(function(){return a})),t.d(r,"c",(function(){return o})),t.d(r,"a",(function(){return e}));var e={skeleton:t("8cb3").default},a=function(){var n=this,r=n.$createElement,t=n._self._c||r;return t("v-uni-view",[t("v-uni-view",{staticClass:"container"},[t("v-uni-view",{staticClass:"background-wrapper"},n._l(n.bgLayers,(function(r,e){return t("v-uni-image",{key:e,class:"bg-image "+(r.visible?"visible":""),attrs:{src:r.url,mode:"aspectFill","data-layer-index":e},on:{load:function(r){arguments[0]=r=n.$handleEvent(r),n.onBackgroundImageLoad.apply(void 0,arguments)}}})})),1),t("v-uni-view",{staticClass:"blur-background-wrapper"},n._l(n.bgLayers,(function(r,e){return t("v-uni-image",{key:e,class:"bg-image blur-image "+(r.visible?"visible":""),attrs:{src:r.url,mode:"aspectFill","data-layer-index":e},on:{load:function(r){arguments[0]=r=n.$handleEvent(r),n.onBackgroundImageLoad.apply(void 0,arguments)}}})})),1),n.isLoading?t("v-uni-view",[t("skeleton")],1):t("v-uni-view",[n.postList.length>0?t("v-uni-view",{staticClass:"poem-mode-container",on:{touchstart:function(r){arguments[0]=r=n.$handleEvent(r),n.touchStart.apply(void 0,arguments)},touchend:function(r){arguments[0]=r=n.$handleEvent(r),n.touchEnd.apply(void 0,arguments)}}},[t("v-uni-view",{class:"single-post-content "+(n.isTransitioning?"is-transitioning":""),attrs:{"data-postid":n.currentPost._id},on:{click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.onSinglePostTap.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"single-author-info"},[n.currentPost.authorAvatar?t("v-uni-image",{staticClass:"single-author-avatar",attrs:{src:n.currentPost.authorAvatar,mode:"aspectFill"}}):n._e(),t("v-uni-text",{staticClass:"single-author-name"},[n._v(n._s(n.currentPost.authorName))])],1),n.currentPost.title?t("v-uni-view",{staticClass:"single-post-title"},[n._v(n._s(n.currentPost.title))]):n._e(),n.currentPost.isPoem&&n.currentPost.author?t("v-uni-view",{staticClass:"single-poem-author"},[n._v(n._s(n.currentPost.author))]):n._e(),n.currentPost.content?t("v-uni-view",{staticClass:"single-post-content-text",staticStyle:{"white-space":"pre-wrap"}},[n._v(n._s(n.currentPost.content))]):n._e()],1),0!==n.postList.length||n.isLoading?n._e():t("v-uni-view",{staticClass:"empty-state"},[t("v-uni-view",{staticClass:"empty-icon"},[n._v("⛰️")]),t("v-uni-view",{staticClass:"empty-text"},[n._v("还没有山诗哦～")]),t("v-uni-view",{staticClass:"empty-subtext"},[n._v("快去广场发现好诗吧！")])],1)],1):n._e(),n._e()],1)],1)],1)},o=[]},3255:function(n,r,t){var e=t("d242");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("8455b0aa",e,!0,{sourceMap:!1,shadowMode:!1})},"3a6e":function(n,r,t){"use strict";t.r(r);var e=t("27748"),a=t("0c27");for(var o in a)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(o);t("b80a");var i=t("828b"),s=Object(i["a"])(a["default"],e["b"],e["c"],!1,null,"501ba716",null,!1,e["a"],void 0);r["default"]=s.exports},"465f":function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* mountain.wxss */uni-page-body[data-v-501ba716]{background:transparent;padding:0}body.?%PAGE?%[data-v-501ba716]{background:transparent}.container[data-v-501ba716]{\r\n    /* 移除 background-image, background-size 等都删掉 */position:relative;overflow:hidden;min-height:100vh}\r\n/* 山模式容器 */.poem-mode-container[data-v-501ba716]{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1;overflow:hidden}\r\n/* 新增：背景图的容器和样式 */.background-wrapper[data-v-501ba716],\r\n.blur-background-wrapper[data-v-501ba716]{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2 /* 确保在最底层 */}.bg-image[data-v-501ba716]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0; /* 默认隐藏 */transition:opacity .5s ease-in-out /* 关键：平滑的透明度过渡 */}.bg-image.visible[data-v-501ba716]{opacity:1 /* 显示 */}\r\n/* 新增：模糊背景的容器和样式 */.blur-background-wrapper[data-v-501ba716]{z-index:-1;-webkit-filter:blur(30px) brightness(.7);filter:blur(30px) brightness(.7);-webkit-transform:scale(1.1);transform:scale(1.1)}\r\n/* 收藏按钮 */.favorite-btn[data-v-501ba716]{position:absolute;top:%?60?%;right:%?60?%;width:%?80?%;height:%?80?%;background:hsla(0,0%,100%,.9);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.15);z-index:999;transition:all .3s ease}.favorite-btn[data-v-501ba716]:active{-webkit-transform:scale(.95);transform:scale(.95)}.favorite-icon[data-v-501ba716]{font-size:%?36?%}\r\n/* 单帖内容区域 */.single-post-content[data-v-501ba716]{width:calc(100% - %?40?%);height:calc(100% - %?80?%);display:flex;flex-direction:column;padding:%?40?% %?20?%;box-sizing:border-box;background:hsla(0,0%,100%,.8); /* 统一使用白色背景，与路页面一致 */margin:%?40?% %?20?%;border-radius:%?24?%;box-shadow:0 %?8?% %?32?% rgba(0,0,0,.15);position:relative;transition:-webkit-transform .3s ease-in-out;transition:transform .3s ease-in-out;transition:transform .3s ease-in-out,-webkit-transform .3s ease-in-out;-webkit-transform:translateX(0);transform:translateX(0)}\r\n/* 切换动画状态 */.single-post-content.is-transitioning[data-v-501ba716]{\r\n    /* 可以尝试只改变透明度，而不是位移 */opacity:.95;-webkit-transform:scale(.99);transform:scale(.99)}\r\n/* 山诗歌特殊样式 */.mountain-poem[data-v-501ba716]{background:rgba(232,224,208,.95); /* 山主题：大地色系 */border:%?2?% solid #8b7355}\r\n/* 山标识 */.mountain-badge[data-v-501ba716]{position:absolute;top:%?20?%;right:%?20?%;background:#8b7355;color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%;font-weight:700;box-shadow:0 %?2?% %?8?% rgba(139,115,85,.3);z-index:10}\r\n/* 作者信息 */.single-author-info[data-v-501ba716]{display:flex;align-items:center;margin-bottom:%?15?%;padding-bottom:%?10?%;border-bottom:%?1?% solid rgba(139,115,85,.3)}.single-author-avatar[data-v-501ba716]{width:%?80?%;height:%?80?%;border-radius:50%;margin-right:%?20?%;background-color:#f5f5f5;border:%?4?% solid #fff;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.1)}.single-author-name[data-v-501ba716]{font-size:%?32?%;color:#000;font-weight:600;text-shadow:0 %?1?% %?2?% hsla(0,0%,100%,.8)}\r\n/* 标题 */.single-post-title[data-v-501ba716]{font-size:%?36?%;font-weight:700;color:#000;margin-bottom:%?10?%;line-height:1.4;text-align:center;text-shadow:0 %?1?% %?2?% hsla(0,0%,100%,.8)}\r\n/* 诗歌作者样式 */.single-poem-author[data-v-501ba716]{font-size:%?32?%;color:#000;text-align:center;margin:%?5?% 0 %?15?% 0;text-shadow:0 %?1?% %?2?% hsla(0,0%,100%,.8);letter-spacing:%?2?%}\r\n/* 内容文字 */.single-post-content-text[data-v-501ba716]{font-size:%?32?%;color:#000;line-height:1.8;margin-top:%?20?%;padding:%?30?% %?40?%;background:transparent;border-radius:0;max-height:62vh;overflow-y:auto;font-family:-apple-system-font,PingFang SC,Helvetica Neue,Arial,sans-serif;letter-spacing:%?1?%;text-shadow:0 %?1?% %?2?% hsla(0,0%,100%,.8)}\r\n/* 骨架屏容器 */.skeleton-container[data-v-501ba716]{position:absolute;top:0;left:0;width:100%;height:100%;background:hsla(0,0%,100%,.95); /* 统一使用白色背景 */z-index:999}\r\n/* 空状态 */.empty-state[data-v-501ba716]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% %?40?%;text-align:center}.empty-icon[data-v-501ba716]{font-size:%?80?%;margin-bottom:%?20?%;opacity:.7}.empty-text[data-v-501ba716]{font-size:%?32?%;color:#666;margin-bottom:%?10?%}.empty-subtext[data-v-501ba716]{font-size:%?28?%;color:#999}\r\n/* 悬浮发布按钮 */.add-button[data-v-501ba716]{position:fixed;bottom:%?120?%;right:%?30?%;width:%?100?%;height:%?100?%;background-color:#8b7355;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:%?48?%;box-shadow:0 %?4?% %?16?% rgba(139,115,85,.3);z-index:1000}",""]),n.exports=r},"84be":function(n,r,t){"use strict";t.r(r);var e=t("b348"),a=t("daaa");for(var o in a)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(o);t("9820");var i=t("828b"),s=Object(i["a"])(a["default"],e["b"],e["c"],!1,null,"3a05c372",null,!1,e["a"],void 0);r["default"]=s.exports},9820:function(n,r,t){"use strict";var e=t("3255"),a=t.n(e);a.a},"9d3a":function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,t("bf0f"),t("0c26");var a=e(t("39d8")),o=t("11ca"),i=o.cloudCall,s={data:function(){return{folders:[],isLoading:!0,selectedFolderId:"",showCreateModal:!1,newFolderName:"",showClone:!1}},props:{show:{type:Boolean,default:!1},postId:{type:String,default:""}},watch:(0,a.default)({show:function(n){n&&this.loadFolders()}},"show",{handler:function(n,r){this.showClone=n},immediate:!0}),methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(n,r,Object.assign({pageTag:"folder-selector",context:this,requireAuth:!0},t))},loadFolders:function(){var n=this;console.log("开始加载收藏夹列表..."),this.setData({isLoading:!0});var r=this.$requireOpenid&&this.$requireOpenid();r?this.callCloudFunction("getMyProfileData",{action:"getFavoriteFolders",openid:r}).then((function(r){if(console.log("folder-selector获取收藏夹:",r),r.result&&r.result.success){var t=r.result.folders||[];console.log("获取到收藏夹数量:",t.length);var e=n.selectedFolderId;e&&!t.some((function(n){return n._id===e}))&&(console.log("清空失效的选中状态"),n.setData({selectedFolderId:""})),n.setData({folders:t,isLoading:!1})}else{var a;uni.showToast({title:(null===(a=r.result)||void 0===a?void 0:a.message)||"加载失败",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})}})).catch((function(r){console.error("获取收藏夹失败:",r),uni.showToast({title:"网络错误",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})})):this.setData({isLoading:!1,folders:[],selectedFolderId:""})},selectFolder:function(n){var r=n.currentTarget.dataset.folderId;this.setData({selectedFolderId:r})},confirmFavorite:function(){var n=this,r=this.selectedFolderId,e=this.postId;if(console.log("确认收藏，postId:",e,"folderId:",r),r){if(!e)return console.error("postId 为空，无法收藏"),void uni.showToast({title:"参数错误：帖子ID为空",icon:"none"});var a=this.$requireOpenid&&this.$requireOpenid();a&&(uni.showLoading({title:"收藏中..."}),this.callCloudFunction("getMyProfileData",{action:"addToFavorite",postId:e,folderId:r,openid:a}).then((function(r){if(uni.hideLoading(),console.log("确认收藏返回结果:",r),r&&r.result)if(r.result.success){uni.showToast({title:"收藏成功"}),console.log("收藏成功，开始关闭弹窗"),n.setData({selectedFolderId:""}),setTimeout((function(){n.hideModal()}),1500),n.$emit("favoriteSuccess");try{var a=getApp(),o=a&&a.globalData&&a.globalData.openid,i=t("80fa"),s=i.emitFavoriteChanged;s({userId:o,postId:e,favored:!0})}catch(l){}}else console.error("收藏业务失败:",r.result),uni.showToast({title:r.result.message||"收藏失败",icon:"none"});else console.error("收藏返回格式异常:",r),uni.showToast({title:"收藏失败：返回格式错误",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("收藏云函数调用失败:",n),uni.showToast({title:"网络错误："+(n.errMsg||"未知错误"),icon:"none"})})))}else uni.showToast({title:"请选择收藏夹",icon:"none"})},createFolder:function(){this.setData({showCreateModal:!0,newFolderName:""})},hideCreateModal:function(){this.setData({showCreateModal:!1,newFolderName:""})},onFolderNameInput:function(n){var r=n.detail.value;this.setData({newFolderName:r})},createNewFolder:function(){var n=this,r=this.newFolderName.trim();if(r){this.setData({newFolderName:r}),console.log("组件开始创建收藏夹，名称:",r);var t=this.$requireOpenid&&this.$requireOpenid();t&&(uni.showLoading({title:"创建中..."}),this.callCloudFunction("getMyProfileData",{action:"createFavoriteFolder",folderName:r,openid:t}).then((function(r){uni.hideLoading(),console.log("组件创建收藏夹返回结果:",r),r&&r.result?r.result.success?(uni.showToast({title:"创建成功",duration:2e3}),n.setData({showCreateModal:!1}),setTimeout((function(){n.loadFolders()}),300)):(console.error("组件创建收藏夹业务失败:",r.result),uni.showToast({title:r.result.message||"创建失败",icon:"none",duration:3e3})):(console.error("组件创建收藏夹返回格式异常:",r),uni.showToast({title:"创建失败：返回格式错误",icon:"none",duration:3e3}))})).catch((function(n){uni.hideLoading(),console.error("组件创建收藏夹云函数调用失败:",n),uni.showToast({title:"创建失败: "+(n.errMsg||"网络错误"),icon:"none",duration:3e3})})))}else uni.showToast({title:"请输入收藏夹名称",icon:"none"})},hideModal:function(){console.log("=== 点击关闭按钮，开始隐藏弹窗 ==="),console.log("当前状态：",{show:this.show,showCreateModal:this.showCreateModal,selectedFolderId:this.selectedFolderId}),this.setData({selectedFolderId:"",showClone:!1,showCreateModal:!1,newFolderName:""}),console.log("=== 弹窗已隐藏，状态已重置 ==="),this.$emit("hide")},trueFun:function(){console.log("占位：函数 true 未声明")}},created:function(){}};r.default=s},b348:function(n,r,t){"use strict";t.d(r,"b",(function(){return e})),t.d(r,"c",(function(){return a})),t.d(r,"a",(function(){}));var e=function(){var n=this,r=n.$createElement,t=n._self._c||r;return t("v-uni-view",[n.showClone?t("v-uni-view",{staticClass:"modal-overlay"},[t("v-uni-view",{staticClass:"modal-content"},[t("v-uni-view",{staticClass:"modal-header"},[t("v-uni-view",{staticClass:"modal-title"},[n._v("选择收藏夹")]),t("v-uni-view",{staticClass:"close-btn",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.hideModal.apply(void 0,arguments)}}},[n._v("×")])],1),t("v-uni-view",{staticClass:"modal-body"},[n.isLoading?t("v-uni-view",{staticClass:"loading-container"},[t("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1):n.folders.length>0?t("v-uni-view",{staticClass:"folders-list"},n._l(n.folders,(function(r,e){return t("v-uni-view",{key:e,class:"folder-item "+(n.selectedFolderId===r._id?"selected":""),attrs:{"data-folder-id":r._id},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.selectFolder.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"folder-icon"},[n._v("📁")]),t("v-uni-view",{staticClass:"folder-info"},[t("v-uni-view",{staticClass:"folder-name"},[n._v(n._s(r.name))]),t("v-uni-view",{staticClass:"folder-count"},[n._v(n._s(r.itemCount)+" 个收藏")])],1),n.selectedFolderId===r._id?t("v-uni-view",{staticClass:"selected-icon"},[n._v("✓")]):n._e()],1)})),1):t("v-uni-view",{staticClass:"empty-state"},[t("v-uni-view",{staticClass:"empty-icon"},[n._v("📁")]),t("v-uni-view",{staticClass:"empty-text"},[n._v("还没有收藏夹")]),t("v-uni-view",{staticClass:"empty-subtext"},[n._v("先创建一个收藏夹吧")])],1)],1),t("v-uni-view",{staticClass:"modal-footer"},[t("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.createFolder.apply(void 0,arguments)}}},[n._v("创建收藏夹")]),t("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.selectedFolderId},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.confirmFavorite.apply(void 0,arguments)}}},[n._v("确认收藏")])],1)],1)],1):n._e(),n.showCreateModal?t("v-uni-view",{staticClass:"modal-overlay"},[t("v-uni-view",{staticClass:"modal-content create-modal"},[t("v-uni-view",{staticClass:"modal-header"},[t("v-uni-view",{staticClass:"modal-title"},[n._v("创建收藏夹")]),t("v-uni-view",{staticClass:"close-btn",on:{click:[function(r){arguments[0]=r=n.$handleEvent(r),n.hideCreateModal.apply(void 0,arguments)},function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.trueFun.apply(void 0,arguments)}]}},[n._v("×")])],1),t("v-uni-view",{staticClass:"modal-body"},[t("v-uni-input",{staticClass:"folder-name-input",attrs:{placeholder:"请输入收藏夹名称",value:n.newFolderName,focus:!0},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onFolderNameInput.apply(void 0,arguments)},click:function(r){r.stopPropagation(),r.preventDefault(),arguments[0]=r=n.$handleEvent(r),n.trueFun.apply(void 0,arguments)}}})],1),t("v-uni-view",{staticClass:"modal-footer"},[t("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.hideCreateModal.apply(void 0,arguments)}}},[n._v("取消")]),t("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.newFolderName},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.createNewFolder.apply(void 0,arguments)}}},[n._v("创建")])],1)],1)],1):n._e()],1)},a=[]},b80a:function(n,r,t){"use strict";var e=t("eff5"),a=t.n(e);a.a},d242:function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* components/folder-selector/folder-selector.wxss */.modal-overlay[data-v-3a05c372]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[data-v-3a05c372]{background:#fff;border-radius:%?16?%;margin:%?40?%;width:calc(100% - %?80?%);max-width:%?600?%;max-height:80vh;display:flex;flex-direction:column}.modal-header[data-v-3a05c372]{display:flex;align-items:center;justify-content:space-between;padding:%?30?% %?40?%;border-bottom:%?1?% solid #f0f0f0}.modal-title[data-v-3a05c372]{font-size:%?36?%;font-weight:500;color:#333}.close-btn[data-v-3a05c372]{font-size:%?48?%;color:#999;line-height:1;position:relative;z-index:1001}.modal-body[data-v-3a05c372]{flex:1;padding:%?20?% 0;max-height:60vh;overflow-y:auto}.loading-container[data-v-3a05c372]{display:flex;justify-content:center;align-items:center;height:%?200?%}.loading-text[data-v-3a05c372]{color:#999;font-size:%?28?%}.folders-list[data-v-3a05c372]{padding:0 %?40?%}.folder-item[data-v-3a05c372]{display:flex;align-items:center;padding:%?24?% 0;border-bottom:%?1?% solid #f8f8f8}.folder-item[data-v-3a05c372]:last-child{border-bottom:none}.folder-item.selected[data-v-3a05c372]{background:rgba(7,193,96,.1);border-radius:%?8?%;padding:%?24?% %?20?%;margin:0 %?-20?%}.folder-icon[data-v-3a05c372]{font-size:%?40?%;margin-right:%?20?%}.folder-info[data-v-3a05c372]{flex:1}.folder-name[data-v-3a05c372]{font-size:%?30?%;color:#333;font-weight:500;margin-bottom:%?4?%}.folder-count[data-v-3a05c372]{font-size:%?24?%;color:#999}.selected-icon[data-v-3a05c372]{font-size:%?32?%;color:#9ed7ee;font-weight:700}.empty-state[data-v-3a05c372]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:%?200?%;padding:%?40?%}.empty-icon[data-v-3a05c372]{font-size:%?60?%;margin-bottom:%?16?%;opacity:.5}.empty-text[data-v-3a05c372]{font-size:%?28?%;color:#666;margin-bottom:%?8?%}.empty-subtext[data-v-3a05c372]{font-size:%?24?%;color:#999}.modal-footer[data-v-3a05c372]{display:flex;gap:%?20?%;padding:%?30?% %?40?%;border-top:%?1?% solid #f0f0f0}.modal-btn[data-v-3a05c372]{flex:1;height:%?80?%;border-radius:%?8?%;font-size:%?28?%;border:none;display:flex;align-items:center;justify-content:center;position:relative;z-index:1001}.secondary-btn[data-v-3a05c372]{background:#f5f5f5;color:#666}.primary-btn[data-v-3a05c372]{background:#9ed7ee;color:#fff}.primary-btn[data-v-3a05c372]:disabled{background:#ccc;color:#999}\r\n/* 创建收藏夹弹窗样式 */.create-modal .modal-body[data-v-3a05c372]{padding:%?40?%}.folder-name-input[data-v-3a05c372]{width:100%;height:%?80?%;padding:0 %?20?%;border:%?2?% solid #e0e0e0;border-radius:%?8?%;font-size:%?30?%;box-sizing:border-box}.folder-name-input[data-v-3a05c372]:focus{border-color:#9ed7ee}",""]),n.exports=r},daaa:function(n,r,t){"use strict";t.r(r);var e=t("9d3a"),a=t.n(e);for(var o in e)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(o);r["default"]=a.a},eff5:function(n,r,t){var e=t("465f");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("354ccd4e",e,!0,{sourceMap:!1,shadowMode:!1})}}]);