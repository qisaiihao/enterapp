(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-following-following"],{3354:function(t,n,e){"use strict";e("6a54");var i=e("f5bd").default;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=i(e("39d8"));e("bf0f"),e("c223"),e("8f71");var a=e("38db"),l=a.cloudCall,s={data:function(){return{followings:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:20,pendingOpenid:null,defaultAvatar:"/images/avatar.png",total:"",avatarKey:""}},onLoad:function(){this.loadFollowings(!0)},onPullDownRefresh:function(){this.loadFollowings(!0)},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadFollowings()},methods:{callCloudFunction:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(t,n,Object.assign({pageTag:"following",context:this,requireAuth:!0},e))},loadFollowings:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading){n&&this.setData({page:0,hasMore:!0});var e=n?0:this.page;this.setData({isLoading:!0});var i=this.$requireOpenid&&this.$requireOpenid();if(!i)return this.setData({isLoading:!1}),void(n&&uni.stopPullDownRefresh());this.callCloudFunction("follow",{action:"getFollowingList",skip:e*this.PAGE_SIZE,limit:this.PAGE_SIZE,openid:i}).then((function(i){if(i.result&&i.result.success){var o=i.result.list||[],a=n?o:t.followings.concat(o);t.setData({followings:a,page:e+1,hasMore:!!i.result.hasMore,total:i.result.total||a.length})}else uni.showToast({title:i.result&&i.result.message?i.result.message:"加载失败",icon:"none"})})).catch((function(t){console.error("获取关注列表失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),n&&uni.stopPullDownRefresh()}))}},onToggleFollow:function(t){var n=this,e=t.currentTarget.dataset.openid,i=t.currentTarget.dataset.index;if(e&&!this.pendingOpenid){this.setData({pendingOpenid:e});var o=this.$requireOpenid&&this.$requireOpenid();o?this.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:e,openid:o}).then((function(t){if(t.result&&t.result.success){var e=!!t.result.isFollowing;if(e)uni.showToast({title:"已关注",icon:"success"});else{var o=n.followings.filter((function(t,n){return n!==i}));n.setData({followings:o}),uni.showToast({title:"已取消关注",icon:"success"}),n.hasMore&&o.length<n.PAGE_SIZE&&n.loadFollowings(),0!==o.length||n.hasMore||n.setData({page:0})}}else uni.showToast({title:t.result&&t.result.message?t.result.message:"操作失败",icon:"none"})})).catch((function(t){console.error("取消关注失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({pendingOpenid:null})})):this.setData({pendingOpenid:null})}},onAvatarError:function(t){var n=t.currentTarget.dataset.index;if(void 0!==n){var e="followings[".concat(n,"].avatarUrl");this.setData((0,o.default)({},e,this.defaultAvatar))}},openUserProfile:function(t){var n=t.currentTarget.dataset.openid;n&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(n)})}}};n.default=s},4427:function(t,n,e){"use strict";var i=e("4549"),o=e.n(i);o.a},4549:function(t,n,e){var i=e("ce41");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=e("967d").default;o("24428dfc",i,!0,{sourceMap:!1,shadowMode:!1})},"5bb4":function(t,n,e){"use strict";e.r(n);var i=e("c62f"),o=e("f2cd");for(var a in o)["default"].indexOf(a)<0&&function(t){e.d(n,t,(function(){return o[t]}))}(a);e("4427");var l=e("828b"),s=Object(l["a"])(o["default"],i["b"],i["c"],!1,null,"1405bb82",null,!1,i["a"],void 0);n["default"]=s.exports},c62f:function(t,n,e){"use strict";e.d(n,"b",(function(){return i})),e.d(n,"c",(function(){return o})),e.d(n,"a",(function(){}));var i=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-uni-view",{staticClass:"container"},[t.followings.length>0?[e("v-uni-view",{staticClass:"list"},t._l(t.followings,(function(n,i){return e("v-uni-view",{key:i,staticClass:"following-item"},[e("v-uni-view",{staticClass:"user-info",attrs:{"data-openid":n._openid},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.openUserProfile.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"avatar",attrs:{src:n.avatarUrl||t.defaultAvatar,mode:"aspectFill","data-index":i},on:{error:function(n){arguments[0]=n=t.$handleEvent(n),t.onAvatarError.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"info-text"},[e("v-uni-text",{staticClass:"name"},[t._v(t._s(n.nickName||"微信用户"))]),e("v-uni-text",{staticClass:"bio"},[t._v(t._s(n.bio||"这个用户还没有留下简介~"))])],1)],1),e("v-uni-button",{staticClass:"unfollow-btn",attrs:{size:"mini","data-openid":n._openid,"data-index":i,loading:t.pendingOpenid===n._openid,disabled:t.pendingOpenid===n._openid},on:{click:function(n){n.stopPropagation(),n.preventDefault(),arguments[0]=n=t.$handleEvent(n),t.onToggleFollow.apply(void 0,arguments)}}},[t._v("取消关注")])],1)})),1)]:e("v-uni-view",{staticClass:"empty"},[e("v-uni-text",[t._v("还没有关注任何人，去广场看看吧～")])],1),t.followings.length>0?e("v-uni-view",{staticClass:"footer-hint"},[t.hasMore?t._e():e("v-uni-view",{staticClass:"loading-more"},[t._v("已经到底了")])],1):t._e()],2)},o=[]},ce41:function(t,n,e){var i=e("c86c");n=i(!1),n.push([t.i,".container[data-v-1405bb82]{padding:%?32?%;background-color:#f7f8fa;min-height:100vh}.list[data-v-1405bb82]{display:flex;flex-direction:column;gap:%?24?%}.following-item[data-v-1405bb82]{display:flex;align-items:center;justify-content:space-between;background-color:#fff;border-radius:%?16?%;padding:%?24?% %?28?%;box-shadow:0 %?6?% %?18?% rgba(0,0,0,.05)}.user-info[data-v-1405bb82]{display:flex;align-items:center;flex:1;overflow:hidden}.avatar[data-v-1405bb82]{width:%?88?%;height:%?88?%;border-radius:50%;margin-right:%?20?%;background-color:#f0f0f0}.info-text[data-v-1405bb82]{display:flex;flex-direction:column;gap:%?8?%;overflow:hidden}.name[data-v-1405bb82]{font-size:%?30?%;color:#333;font-weight:600}.bio[data-v-1405bb82]{font-size:%?24?%;color:#888;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:%?420?%}.unfollow-btn[data-v-1405bb82]{margin-left:%?24?%;border:%?2?% solid #ff8f8f;color:#ff6b6b;background-color:#fff;border-radius:%?999?%;padding:0 %?28?%;height:%?64?%!important;line-height:%?64?%!important}.unfollow-btn[data-v-1405bb82]::after{border:none}.unfollow-btn[disabled][data-v-1405bb82]{opacity:.6}.loading[data-v-1405bb82],\r\n.loading-more[data-v-1405bb82]{margin-top:%?32?%;text-align:center;color:#999;font-size:%?26?%}.empty[data-v-1405bb82]{margin-top:%?120?%;text-align:center;color:#999;font-size:%?28?%}.footer-hint[data-v-1405bb82]{margin-top:%?24?%}.mutual-label[data-v-1405bb82]{margin-top:%?8?%;display:inline-block;padding:%?4?% %?16?%;background-color:#e6f4ff;color:#1f6fd2;border-radius:%?999?%;font-size:%?24?%}",""]),t.exports=n},f2cd:function(t,n,e){"use strict";e.r(n);var i=e("3354"),o=e.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){e.d(n,t,(function(){return i[t]}))}(a);n["default"]=o.a}}]);