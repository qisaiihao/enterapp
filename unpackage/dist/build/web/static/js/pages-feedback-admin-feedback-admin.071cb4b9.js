(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-feedback-admin-feedback-admin"],{"104e":function(n,e,t){"use strict";t.r(e);var a=t("55cb"),i=t("9399");for(var r in i)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return i[n]}))}(r);t("fcd0");var o=t("828b"),s=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,"fe22c140",null,!1,a["a"],void 0);e["default"]=s.exports},"139b":function(n,e,t){t("795c"),t("64aa"),t("5c47"),t("a1c1"),t("c223"),t("f7a5");var a=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(n).padStart(e,"0")},i=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",t=n instanceof Date?n:new Date(n);if(Number.isNaN(t.getTime()))return"";var i={yyyy:String(t.getFullYear()),MM:a(t.getMonth()+1),dd:a(t.getDate()),HH:a(t.getHours()),mm:a(t.getMinutes()),ss:a(t.getSeconds())};return e.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(n){return i[n]}))};n.exports={formatTimeAgo:function(n){var e=new Date,t=new Date(n),a=e.getTime()-t.getTime(),i=Math.floor(a/1e3),r=Math.floor(i/60),o=Math.floor(r/60),s=Math.floor(o/24);if(s>=7){var c=t.getFullYear(),d=("0"+(t.getMonth()+1)).slice(-2),u=("0"+t.getDate()).slice(-2);return"".concat(c,"-").concat(d,"-").concat(u)}return s>=1?"".concat(s,"天前"):o>=1?"".concat(o,"小时前"):r>=1?"".concat(r,"分钟前"):"刚刚"},formatRelativeTime:function(n){var e=Date.now(),t=n instanceof Date?n.getTime():new Date(n).getTime();if(Number.isNaN(t))return"";var a=e-t,r=Math.floor(Math.abs(a)/1e3),o=a>=0?"前":"后";if(r<60)return"刚刚";var s=Math.floor(r/60);if(s<60)return"".concat(s,"分钟").concat(o);var c=Math.floor(s/60);if(c<24)return"".concat(c,"小时").concat(o);var d=Math.floor(c/24);return d<7?"".concat(d,"天").concat(o):i(t,"yyyy-MM-dd")},formatDate:i}},"55cb":function(n,e,t){"use strict";t.d(e,"b",(function(){return a})),t.d(e,"c",(function(){return i})),t.d(e,"a",(function(){}));var a=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-uni-view",{staticClass:"container",style:"padding-top: "+n.statusBarHeight+"px;"},[t("v-uni-view",{staticClass:"header",style:"top: "+n.statusBarHeight+"px;"},[t("v-uni-view",{staticClass:"header-left",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.goBack.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"back-icon"},[n._v("←")])],1),t("v-uni-text",{staticClass:"header-title"},[n._v("反馈管理")]),t("v-uni-view",{staticClass:"header-right",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.refreshFeedbackList.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"refresh-icon"},[n._v("🔄")])],1)],1),t("v-uni-view",{staticClass:"feedback-list"},[n.feedbackList.length>0?n._l(n.feedbackList,(function(e,a){return t("v-uni-view",{key:a,class:"feedback-item "+(e.isProcessed?"processed":"")},[t("v-uni-view",{staticClass:"feedback-header"},[t("v-uni-view",{staticClass:"user-info"},[t("v-uni-text",{staticClass:"user-name"},[n._v(n._s(e.userName||"匿名用户"))]),t("v-uni-text",{staticClass:"feedback-time"},[n._v(n._s(e.formattedCreateTime))])],1),t("v-uni-view",{class:"status-badge "+(e.isProcessed?"processed":"pending")},[n._v(n._s(e.isProcessed?"已处理":"待处理"))])],1),t("v-uni-view",{staticClass:"feedback-content"},[t("v-uni-text",{staticClass:"content-text"},[n._v(n._s(e.content))])],1),e.imageUrls&&e.imageUrls.length>0?t("v-uni-view",{staticClass:"feedback-images"},[t("v-uni-view",{staticClass:"image-grid"},n._l(e.imageUrls,(function(a,i){return t("v-uni-image",{key:i,staticClass:"feedback-image",attrs:{src:a,mode:"aspectFill","data-src":a,"data-urls":e.imageUrls},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.previewImage.apply(void 0,arguments)}}})})),1)],1):n._e(),t("v-uni-view",{staticClass:"feedback-actions"},[e.isProcessed?n._e():t("v-uni-button",{staticClass:"action-btn process-btn",attrs:{size:"mini","data-id":e._id,"data-index":a},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.markAsProcessed.apply(void 0,arguments)}}},[n._v("标记已处理")]),t("v-uni-button",{staticClass:"action-btn delete-btn",attrs:{size:"mini","data-id":e._id,"data-index":a},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.deleteFeedback.apply(void 0,arguments)}}},[n._v("删除")])],1)],1)})):t("v-uni-view",{staticClass:"empty-state"},[t("v-uni-text",{staticClass:"empty-icon"},[n._v("📝")]),t("v-uni-text",{staticClass:"empty-text"},[n._v("暂无反馈")])],1),n.loading?t("v-uni-view",{staticClass:"loading-more"},[t("v-uni-text",[n._v("加载中...")])],1):!n.hasMore&&n.feedbackList.length>0?t("v-uni-view",{staticClass:"no-more"},[t("v-uni-text",[n._v("--- 没有更多了 ---")])],1):n._e()],2)],1)},i=[]},"59be":function(n,e,t){"use strict";t("6a54");var a=t("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t("4626"),t("7a76"),t("c9b5"),t("5ac7"),t("bf0f"),t("2797"),t("c223"),t("8f71");var i=a(t("39d8")),r=a(t("2634")),o=a(t("2fdc")),s=t("139b"),c=s.formatRelativeTime,d=t("8e86"),u=d.previewImage,l=t("11ca"),f=l.cloudCall,v={data:function(){return{feedbackList:[],loading:!1,hasMore:!0,page:0,pageSize:10,isAdmin:!1,currentUserOpenid:"",statusBarHeight:0,imageUrl:""}},onLoad:function(){var n=uni.getSystemInfoSync();this.setData({statusBarHeight:n.statusBarHeight}),uni.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#ffffff"}),this.checkAdminPermission()},onShow:function(){this.isAdmin&&this.refreshFeedbackList()},onPullDownRefresh:function(){this.refreshFeedbackList(),uni.stopPullDownRefresh()},onReachBottom:function(){this.hasMore&&!this.loading&&this.loadFeedbackList()},methods:{callCloudFunction:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return f(n,e,Object.assign({pageTag:"feedback-admin",context:this},t))},checkAdminPermission:function(){var n=this;return(0,o.default)((0,r.default)().mark((function e(){var t,a,i,o;return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.callCloudFunction("getOpenId",{});case 3:if(t=e.sent,!t.result||!t.result.openid){e.next=17;break}if(a=t.result.openid,i=["ojYBd1_A3uCbQ1LGcHxWxOAeA5SE","ojYBd14JG3-ghYuGCI2WHmkMc9nE"],o=i.includes(a),console.log("反馈管理页面 - 当前用户:",a),console.log("反馈管理页面 - 是否为管理员:",o),n.setData({currentUserOpenid:a,isAdmin:o}),o){e.next=14;break}return uni.showModal({title:"权限不足",content:"您没有权限访问反馈管理功能",showCancel:!1,success:function(){uni.navigateBack()}}),e.abrupt("return");case 14:n.loadFeedbackList(),e.next=18;break;case 17:throw new Error("无法获取用户信息");case 18:e.next=26;break;case 20:e.prev=20,e.t0=e["catch"](0),console.log("CatchClause",e.t0),console.log("CatchClause",e.t0),console.error("权限检查失败:",e.t0),uni.showModal({title:"错误",content:"权限检查失败，无法访问此页面",showCancel:!1,success:function(){uni.navigateBack()}});case 26:case"end":return e.stop()}}),e,null,[[0,20]])})))()},loadFeedbackList:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.loading){var t=this.page,a=this.pageSize,i=e?0:t;this.setData({loading:!0}),this.callCloudFunction("feedbackManager",{action:"getFeedbackList",skip:i*a,limit:a}).then((function(t){if(t.result&&t.result.success){var r=t.result.feedbackList||[];r.forEach((function(e){e.formattedCreateTime=n.formatTime(e.createTime)}));var o=e?r:n.feedbackList.concat(r);n.setData({feedbackList:o,page:i+1,hasMore:r.length===a})}else{var s;uni.showToast({title:(null===(s=t.result)||void 0===s?void 0:s.message)||"加载失败",icon:"none"})}})).catch((function(n){console.error("加载反馈列表失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({loading:!1})}))}},refreshFeedbackList:function(){this.setData({feedbackList:[],page:0,hasMore:!0}),this.loadFeedbackList(!0)},formatTime:function(n){return c(n)},previewImage:function(n){return u(n,{fallbackToast:!1})},deleteFeedback:function(n){var e=n.currentTarget.dataset.id,t=n.currentTarget.dataset.index,a=this;uni.showModal({title:"确认删除",content:"确定要删除这条反馈吗？",confirmColor:"#ff4d4f",success:function(n){n.confirm&&(uni.showLoading({title:"删除中..."}),this.callCloudFunction("feedbackManager",{action:"deleteFeedback",feedbackId:e}).then((function(n){if(uni.hideLoading(),n.result&&n.result.success){uni.showToast({title:"删除成功",icon:"success"});var e=a.feedbackList.filter((function(n,e){return e!==t}));a.setData({feedbackList:e})}else{var i;uni.showToast({title:(null===(i=n.result)||void 0===i?void 0:i.message)||"删除失败",icon:"none"})}})).catch((function(n){uni.hideLoading(),console.error("删除反馈失败:",n),uni.showToast({title:"删除失败",icon:"none"})})))}})},markAsProcessed:function(n){var e=n.currentTarget.dataset.id,t=n.currentTarget.dataset.index,a=this;uni.showLoading({title:"处理中..."}),this.callCloudFunction("feedbackManager",{action:"markAsProcessed",feedbackId:e}).then((function(n){var e,r;(uni.hideLoading(),n.result&&n.result.success)?(uni.showToast({title:"已标记为处理",icon:"success"}),a.setData((e={},(0,i.default)(e,"feedbackList[".concat(t,"].isProcessed"),!0),(0,i.default)(e,"feedbackList[".concat(t,"].processedTime"),new Date),e))):uni.showToast({title:(null===(r=n.result)||void 0===r?void 0:r.message)||"操作失败",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("标记处理失败:",n),uni.showToast({title:"操作失败",icon:"none"})}))},goBack:function(){uni.navigateBack()}}};e.default=v},"73e1":function(n,e,t){"use strict";var a=t("29d8");n.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(a)},"795c":function(n,e,t){"use strict";var a=t("8bdb"),i=t("db04").start,r=t("73e1");a({target:"String",proto:!0,forced:r},{padStart:function(n){return i(this,n,arguments.length>1?arguments[1]:void 0)}})},"8e86":function(n,e,t){function a(n){if(!n)return{current:"",urls:[]};if(n.currentTarget&&n.currentTarget.dataset){var e=n.currentTarget.dataset,t=e.src||e.current||e.url||Array.isArray(e.urls)&&e.urls[0]||"",a=e.originalImageUrls||e.urls||e.urlList,i=Array.isArray(a)?a.filter(Boolean):"string"===typeof a&&a?[a]:[];return{current:t,urls:i}}var r=n.current||n.src||Array.isArray(n.urls)&&n.urls[0]||Array.isArray(n.list)&&n.list[0]||"",o=Array.isArray(n.urls)?n.urls.filter(Boolean):Array.isArray(n.list)?n.list.filter(Boolean):[];return{current:r,urls:o}}function i(n){"undefined"!==typeof uni&&uni.showToast&&uni.showToast({title:n,icon:"none"})}t("8f71"),t("bf0f"),n.exports={previewImage:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.fallbackToast,r=void 0===t||t,o=a(n);if(!o.current&&0===o.urls.length)return r&&i("图片数据缺失"),!1;var s=o.urls.length?o.urls:[o.current],c=o.current||s[0];return c&&0!==s.length?uni.previewImage({current:c,urls:s}):(r&&i("图片不可预览"),!1)}}},9399:function(n,e,t){"use strict";t.r(e);var a=t("59be"),i=t.n(a);for(var r in a)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return a[n]}))}(r);e["default"]=i.a},b71f:function(n,e,t){var a=t("c86c");e=a(!1),e.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* 管理员反馈查看页面样式 */.container[data-v-fe22c140]{min-height:100vh;background-color:#f5f5f5;padding-top:0}\n/* 头部 */.header[data-v-fe22c140]{display:flex;align-items:center;justify-content:space-between;padding:%?20?% %?30?%;background-color:#fff;border-bottom:%?1?% solid #eee;position:-webkit-sticky;position:sticky;top:0;z-index:100}.header-left[data-v-fe22c140],\n.header-right[data-v-fe22c140]{width:%?60?%;height:%?60?%;display:flex;align-items:center;justify-content:center}.back-icon[data-v-fe22c140],\n.refresh-icon[data-v-fe22c140]{font-size:%?36?%;color:#333;font-weight:700}.header-title[data-v-fe22c140]{font-size:%?32?%;font-weight:600;color:#333}\n/* 反馈列表 */.feedback-list[data-v-fe22c140]{padding:%?20?%}.feedback-item[data-v-fe22c140]{background-color:#fff;border-radius:%?16?%;padding:%?30?%;margin-bottom:%?20?%;box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1)}.feedback-item.processed[data-v-fe22c140]{opacity:.7;background-color:#f8f8f8}\n/* 反馈头部 */.feedback-header[data-v-fe22c140]{display:flex;justify-content:space-between;align-items:center;margin-bottom:%?20?%}.user-info[data-v-fe22c140]{display:flex;flex-direction:column}.user-name[data-v-fe22c140]{font-size:%?28?%;font-weight:600;color:#333;margin-bottom:%?8?%}.feedback-time[data-v-fe22c140]{font-size:%?24?%;color:#999}.status-badge[data-v-fe22c140]{padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?22?%;font-weight:500}.status-badge.pending[data-v-fe22c140]{background-color:#fff2e8;color:#fa8c16}.status-badge.processed[data-v-fe22c140]{background-color:#f6ffed;color:#52c41a}\n/* 反馈内容 */.feedback-content[data-v-fe22c140]{margin-bottom:%?20?%}.content-text[data-v-fe22c140]{font-size:%?28?%;color:#333;line-height:1.6;white-space:pre-wrap}\n/* 反馈图片 */.feedback-images[data-v-fe22c140]{margin-bottom:%?20?%}.image-grid[data-v-fe22c140]{display:flex;flex-wrap:wrap;gap:%?10?%}.feedback-image[data-v-fe22c140]{width:%?120?%;height:%?120?%;border-radius:%?8?%;background-color:#f0f0f0}\n/* 操作按钮 */.feedback-actions[data-v-fe22c140]{display:flex;justify-content:flex-end;gap:%?20?%}.action-btn[data-v-fe22c140]{border-radius:%?20?%;font-size:%?24?%;padding:0 %?20?%;height:%?60?%;line-height:%?60?%}.process-btn[data-v-fe22c140]{background-color:#52c41a;color:#fff;border:none}.delete-btn[data-v-fe22c140]{background-color:#ff4d4f;color:#fff;border:none}.action-btn[data-v-fe22c140]::after{border:none}\n/* 空状态 */.empty-state[data-v-fe22c140]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% 0}.empty-icon[data-v-fe22c140]{font-size:%?80?%;margin-bottom:%?20?%}.empty-text[data-v-fe22c140]{font-size:%?28?%;color:#999}\n/* 加载状态 */.loading-more[data-v-fe22c140],\n.no-more[data-v-fe22c140]{text-align:center;padding:%?40?% 0;font-size:%?24?%;color:#999}",""]),n.exports=e},da59:function(n,e,t){var a=t("b71f");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var i=t("967d").default;i("1b13a1f1",a,!0,{sourceMap:!1,shadowMode:!1})},db04:function(n,e,t){"use strict";var a=t("bb80"),i=t("c435"),r=t("9e70"),o=t("f298"),s=t("862c"),c=a(o),d=a("".slice),u=Math.ceil,l=function(n){return function(e,t,a){var o,l,f=r(s(e)),v=i(t),g=f.length,h=void 0===a?" ":r(a);return v<=g||""===h?f:(o=v-g,l=c(h,u(o/h.length)),l.length>o&&(l=d(l,0,o)),n?f+l:l+f)}};n.exports={start:l(!1),end:l(!0)}},fcd0:function(n,e,t){"use strict";var a=t("da59"),i=t.n(a);i.a}}]);