(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-image-manager-image-manager~pages-splash-splash"],{4073:function(e,t,r){var n=r("dd7e").default,a=r("5014").default,o=r("46c5").default,u=r("883d").default,s=r("4db6").default;r("c223"),r("7a76"),r("c9b5"),r("fd3c"),r("bf0f"),r("18f7"),r("de6c");var c=r("11ca"),i=c.cloudCall,l=function(){"use strict";function e(){u(this,e),this.cloudEnv=wx.cloud}return s(e,[{key:"callCloudFunction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(e,t,{pageTag:"imageManager-util",requireAuth:!0})}},{key:"uploadImage",value:function(){var e=o(n().mark((function e(t){var r,o,u,s,c,i,l,p=arguments;return n().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=p.length>1&&void 0!==p[1]?p[1]:{},e.prev=1,o=uni.getFileSystemManager(),u=o.readFileSync(t,"base64"),s=Date.now(),c=t&&"string"===typeof t&&t.split(".").pop()||"png",i=r.name?"".concat(r.name,"_").concat(s,".").concat(c):"image_".concat(s,".").concat(c),console.log("准备调用云函数上传，参数:",{action:"uploadImage",cloudPath:i,category:r.category||"general",fileContentLength:u.length}),e.next=10,this.callCloudFunction("imageManager",{action:"uploadImage",fileContent:u,cloudPath:i,category:r.category||"general",metadata:a({name:r.name||"",originalPath:t},r.metadata)});case 10:if(l=e.sent,console.log("云函数返回结果:",l),!l.result.success){e.next=16;break}return e.abrupt("return",{success:!0,fileID:l.result.fileID,imageId:l.result.imageId,url:l.result.url});case 16:throw new Error(l.result.error||"上传失败");case 17:e.next=25;break;case 19:return e.prev=19,e.t0=e["catch"](1),console.log("CatchClause",e.t0),console.log("CatchClause",e.t0),console.error("图片上传失败:",e.t0),e.abrupt("return",{success:!1,error:e.t0.message});case 25:case"end":return e.stop()}}),e,this,[[1,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getImageUrl",value:function(){var e=o(n().mark((function e(){var t,r,o=arguments;return n().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},e.prev=1,e.next=4,this.callCloudFunction("imageManager",a({action:"getImageUrl"},t));case 4:if(r=e.sent,!r.result.success){e.next=9;break}return e.abrupt("return",{success:!0,url:r.result.url,fileID:r.result.fileID,expireTime:r.result.expireTime});case 9:throw new Error(r.result.error||"获取URL失败");case 10:e.next=18;break;case 12:return e.prev=12,e.t0=e["catch"](1),console.log("CatchClause",e.t0),console.log("CatchClause",e.t0),console.error("获取图片URL失败:",e.t0),e.abrupt("return",{success:!1,error:e.t0.message});case 18:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"getSplashImageUrl",value:function(){var e=o(n().mark((function e(){var t;return n().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getImageUrl({category:"splash",name:"splash"});case 2:if(t=e.sent,!t.success){e.next=7;break}return e.abrupt("return",t.url);case 7:return e.abrupt("return","/static/images/splash.png");case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"uploadSplashImage",value:function(){var e=o(n().mark((function e(t){return n().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.uploadImage(t,{category:"splash",name:"splash",metadata:{description:"开屏图",usage:"splash_screen"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"preloadImages",value:function(){var e=o(n().mark((function e(t){var r;return n().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.map((function(e){return new Promise((function(t){uni.downloadFile({url:e,success:function(r){200===r.statusCode?t({success:!0,tempFilePath:r.tempFilePath,url:e}):t({success:!1,error:"下载失败",url:e})},fail:function(r){t({success:!1,error:r.errMsg,url:e})}})}))})),e.next=3,Promise.all(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteImage",value:function(){var e=o(n().mark((function e(){var t,r,o=arguments;return n().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},e.prev=1,e.next=4,this.callCloudFunction("imageManager",a({action:"deleteImage"},t));case 4:return r=e.sent,e.abrupt("return",r.result);case 8:return e.prev=8,e.t0=e["catch"](1),console.log("CatchClause",e.t0),console.log("CatchClause",e.t0),console.error("删除图片失败:",e.t0),e.abrupt("return",{success:!1,error:e.t0.message});case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"getImageList",value:function(){var e=o(n().mark((function e(){var t,r,o=arguments;return n().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},e.prev=1,e.next=4,this.callCloudFunction("imageManager",a({action:"getImageList"},t));case 4:return r=e.sent,e.abrupt("return",r.result);case 8:return e.prev=8,e.t0=e["catch"](1),console.log("CatchClause",e.t0),console.log("CatchClause",e.t0),console.error("获取图片列表失败:",e.t0),e.abrupt("return",{success:!1,error:e.t0.message});case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),p=new l;e.exports={ImageManager:l,imageManager:p}},4550:function(e,t,r){r("6a54");var n=r("8bcf");e.exports=function(e,t,r){return t=n(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports["default"]=e.exports},"4db6":function(e,t,r){r("6a54");var n=r("8bcf");function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,n(a.key),a)}}e.exports=function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports["default"]=e.exports},5014:function(e,t,r){r("dc8a"),r("01a2"),r("8f71"),r("bf0f"),r("9a2c"),r("aa9c"),r("2797"),r("a644"),r("a03a"),r("6a54");var n=r("4550");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}e.exports=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e},e.exports.__esModule=!0,e.exports["default"]=e.exports},"56c9":function(e,t,r){r("9e15"),r("884b"),r("01a2"),r("e39c"),r("bf0f"),r("7a76"),r("c9b5"),r("64aa");var n=r("bdbb")["default"];e.exports=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!==n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports["default"]=e.exports},"883d":function(e,t,r){r("7a76"),r("c9b5"),e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports["default"]=e.exports},"8bcf":function(e,t,r){var n=r("bdbb")["default"],a=r("56c9");e.exports=function(e){var t=a(e,"string");return"symbol"===n(t)?t:String(t)},e.exports.__esModule=!0,e.exports["default"]=e.exports},"967d":function(e,t,r){"use strict";function n(e,t){for(var r=[],n={},a=0;a<t.length;a++){var o=t[a],u=o[0],s=o[1],c=o[2],i=o[3],l={id:e+":"+a,css:s,media:c,sourceMap:i};n[u]?n[u].parts.push(l):r.push(n[u]={id:u,parts:[l]})}return r}r.r(t),r.d(t,"default",(function(){return d}));var a="undefined"!==typeof document;if("undefined"!==typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},u=a&&(document.head||document.getElementsByTagName("head")[0]),s=null,c=0,i=!1,l=function(){},p=null,f="undefined"!==typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function d(e,t,r,a){i=r,p=a||{};var u=n(e,t);return g(u),function(t){for(var r=[],a=0;a<u.length;a++){var s=u[a],c=o[s.id];c.refs--,r.push(c)}t?(u=n(e,t),g(u)):u=[];for(a=0;a<r.length;a++){c=r[a];if(0===c.refs){for(var i=0;i<c.parts.length;i++)c.parts[i]();delete o[c.id]}}}}function g(e){for(var t=0;t<e.length;t++){var r=e[t],n=o[r.id];if(n){n.refs++;for(var a=0;a<n.parts.length;a++)n.parts[a](r.parts[a]);for(;a<r.parts.length;a++)n.parts.push(v(r.parts[a]));n.parts.length>r.parts.length&&(n.parts.length=r.parts.length)}else{var u=[];for(a=0;a<r.parts.length;a++)u.push(v(r.parts[a]));o[r.id]={id:r.id,refs:1,parts:u}}}}function h(){var e=document.createElement("style");return e.type="text/css",u.appendChild(e),e}function v(e){var t,r,n=document.querySelector('style[data-vue-ssr-id~="'+e.id+'"]');if(n){if(i)return l;n.parentNode.removeChild(n)}if(f){var a=c++;n=s||(s=h()),t=b.bind(null,n,a,!1),r=b.bind(null,n,a,!0)}else n=h(),t=y.bind(null,n),r=function(){n.parentNode.removeChild(n)};return t(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;t(e=n)}else r()}}var m=function(){var e=[];return function(t,r){return e[t]=r,e.filter(Boolean).join("\n")}}();function b(e,t,r,n){var a=r?"":S(n.css);if(e.styleSheet)e.styleSheet.cssText=m(t,a);else{var o=document.createTextNode(a),u=e.childNodes;u[t]&&e.removeChild(u[t]),u.length?e.insertBefore(o,u[t]):e.appendChild(o)}}function y(e,t){var r=S(t.css),n=t.media,a=t.sourceMap;if(n&&e.setAttribute("media",n),p.ssrId&&e.setAttribute("data-vue-ssr-id",t.id),a&&(r+="\n/*# sourceURL="+a.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),e.styleSheet)e.styleSheet.cssText=r;else{while(e.firstChild)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var w=/%\?([+-]?\d+(\.\d+)?)\?%/g,x=/\.\?%PAGE\?%/g,C=/\?%PAGE\?%\[data-v-[a-z0-9]{8}\]/g,k=/uni-page-body\[data-v-[a-z0-9]{8}\]/g,I=/var\(--status-bar-height\)/gi,j=/var\(--window-top\)/gi,O=/var\(--window-bottom\)/gi,P=/var\(--window-left\)/gi,M=/var\(--window-right\)/gi;function S(e){var t=function(){var e="function"===typeof getApp&&getApp();return e&&e.$route&&e.$route.meta&&e.$route.meta.name||""}();if("undefined"!==typeof uni&&!uni.canIUse("css.var")){var r=function(){var e="function"===typeof getApp&&getApp();if(e&&e.$route&&e.$route.meta&&e.$route.meta.name)return{top:e.$route.meta.windowTop,bottom:e.$route.meta.isTabBar?50:0};return{top:0,bottom:0}}();e=e.replace(I,"0px").replace(j,r.top+"px").replace(O,r.bottom+"px").replace(P,"0px").replace(M,"0px")}return e.replace(C,t).replace(x,"").replace(k,"body."+t+" uni-page-body").replace(/\{[\s\S]+?\}|@media.+?\{/g,(function(e){return"undefined"===typeof uni?e:e.replace(w,(function(e,t){return uni.upx2px(t)+"px"}))}))}},c86c:function(e,t,r){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r=e[1]||"",n=e[3];if(!n)return r;if(t&&"function"===typeof btoa){var a=function(e){var t=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(t);return"/*# ".concat(r," */")}(n),o=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[r].concat(o).concat([a]).join("\n")}return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,n){"string"===typeof e&&(e=[[null,e,""]]);var a={};if(n)for(var o=0;o<this.length;o++){var u=this[o][0];null!=u&&(a[u]=!0)}for(var s=0;s<e.length;s++){var c=[].concat(e[s]);n&&a[c[0]]||(r&&(c[2]?c[2]="".concat(r," and ").concat(c[2]):c[2]=r),t.push(c))}},t}}}]);