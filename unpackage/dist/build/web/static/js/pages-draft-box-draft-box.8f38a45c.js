(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-draft-box-draft-box"],{"01ae":function(n,t,r){"use strict";r.r(t);var a=r("284f"),e=r("19a7");for(var i in e)["default"].indexOf(i)<0&&function(n){r.d(t,n,(function(){return e[n]}))}(i);r("eb53");var o=r("828b"),s=Object(o["a"])(e["default"],a["b"],a["c"],!1,null,"ba2c68f0",null,!1,a["a"],void 0);t["default"]=s.exports},"139b":function(n,t,r){r("795c"),r("64aa"),r("5c47"),r("a1c1"),r("c223"),r("f7a5");var a=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(n).padStart(t,"0")},e=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",r=n instanceof Date?n:new Date(n);if(Number.isNaN(r.getTime()))return"";var e={yyyy:String(r.getFullYear()),MM:a(r.getMonth()+1),dd:a(r.getDate()),HH:a(r.getHours()),mm:a(r.getMinutes()),ss:a(r.getSeconds())};return t.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(n){return e[n]}))};n.exports={formatTimeAgo:function(n){var t=new Date,r=new Date(n),a=t.getTime()-r.getTime(),e=Math.floor(a/1e3),i=Math.floor(e/60),o=Math.floor(i/60),s=Math.floor(o/24);if(s>=7){var c=r.getFullYear(),d=("0"+(r.getMonth()+1)).slice(-2),f=("0"+r.getDate()).slice(-2);return"".concat(c,"-").concat(d,"-").concat(f)}return s>=1?"".concat(s,"天前"):o>=1?"".concat(o,"小时前"):i>=1?"".concat(i,"分钟前"):"刚刚"},formatRelativeTime:function(n){var t=Date.now(),r=n instanceof Date?n.getTime():new Date(n).getTime();if(Number.isNaN(r))return"";var a=t-r,i=Math.floor(Math.abs(a)/1e3),o=a>=0?"前":"后";if(i<60)return"刚刚";var s=Math.floor(i/60);if(s<60)return"".concat(s,"分钟").concat(o);var c=Math.floor(s/60);if(c<24)return"".concat(c,"小时").concat(o);var d=Math.floor(c/24);return d<7?"".concat(d,"天").concat(o):e(r,"yyyy-MM-dd")},formatDate:e}},"19a7":function(n,t,r){"use strict";r.r(t);var a=r("30f0"),e=r.n(a);for(var i in a)["default"].indexOf(i)<0&&function(n){r.d(t,n,(function(){return a[n]}))}(i);t["default"]=e.a},2704:function(n,t,r){var a=r("c86c");t=a(!1),t.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* pages/draft-box/draft-box.wxss */.container[data-v-ba2c68f0]{padding:%?20?%;background-color:#f7f8fa;min-height:100vh}.draft-list[data-v-ba2c68f0]{display:flex;flex-direction:column;gap:%?20?%}.draft-item[data-v-ba2c68f0]{background:#fff;border-radius:%?16?%;padding:%?30?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);display:flex;justify-content:space-between;align-items:flex-start;transition:all .2s ease}.draft-item[data-v-ba2c68f0]:active{-webkit-transform:scale(.98);transform:scale(.98);box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1)}.draft-content[data-v-ba2c68f0]{flex:1;margin-right:%?20?%}.draft-title[data-v-ba2c68f0]{font-size:%?32?%;font-weight:600;color:#333;margin-bottom:%?10?%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.draft-preview[data-v-ba2c68f0]{font-size:%?28?%;color:#666;line-height:1.5;margin-bottom:%?15?%;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}.draft-meta[data-v-ba2c68f0]{display:flex;align-items:center;gap:%?20?%;font-size:%?24?%;color:#999}.draft-time[data-v-ba2c68f0]{flex-shrink:0}.draft-mode[data-v-ba2c68f0]{background:#e3f2fd;color:#1976d2;padding:%?4?% %?12?%;border-radius:%?12?%;font-size:%?22?%}.draft-original[data-v-ba2c68f0]{background:#e8f5e8;color:#4caf50;padding:%?4?% %?12?%;border-radius:%?12?%;font-size:%?22?%}.draft-actions[data-v-ba2c68f0]{display:flex;flex-direction:column;gap:%?10?%;flex-shrink:0}.action-btn[data-v-ba2c68f0]{min-width:%?120?%;height:%?60?%;line-height:%?60?%;border-radius:%?8?%;font-size:%?24?%;border:none;transition:all .2s ease}.edit-btn[data-v-ba2c68f0]{background:#9ed7ee;color:#fff}.edit-btn[data-v-ba2c68f0]:active{background:#06ad56}.delete-btn[data-v-ba2c68f0]{background:#ff4d4f;color:#fff}.delete-btn[data-v-ba2c68f0]:active{background:#d9363e}\r\n/* 空状态样式 */.empty-container[data-v-ba2c68f0]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?200?% %?40?%;text-align:center}.empty-icon[data-v-ba2c68f0]{font-size:%?120?%;margin-bottom:%?30?%;opacity:.6}.empty-text[data-v-ba2c68f0]{font-size:%?32?%;color:#666;margin-bottom:%?15?%}.empty-subtext[data-v-ba2c68f0]{font-size:%?28?%;color:#999;margin-bottom:%?40?%}.create-btn[data-v-ba2c68f0]{background:#9ed7ee;color:#fff;border:none;border-radius:%?50?%;padding:%?20?% %?40?%;font-size:%?28?%;transition:all .2s ease}.create-btn[data-v-ba2c68f0]:active{background:#06ad56;-webkit-transform:scale(.95);transform:scale(.95)}",""]),n.exports=t},"284f":function(n,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return e})),r.d(t,"a",(function(){}));var a=function(){var n=this,t=n.$createElement,r=n._self._c||t;return r("v-uni-view",{staticClass:"container"},[n.drafts.length>0?r("v-uni-view",{staticClass:"draft-list"},n._l(n.drafts,(function(t,a){return r("v-uni-view",{key:a,staticClass:"draft-item",attrs:{"data-draft":t},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.editDraft.apply(void 0,arguments)}}},[r("v-uni-view",{staticClass:"draft-content"},[r("v-uni-view",{staticClass:"draft-title"},[n._v(n._s(t.title||"无标题"))]),r("v-uni-view",{staticClass:"draft-preview"},[n._v(n._s(t.content||"无内容"))]),r("v-uni-view",{staticClass:"draft-meta"},[r("v-uni-text",{staticClass:"draft-time"},[n._v(n._s(t.formattedSaveTime))]),r("v-uni-text",{staticClass:"draft-mode"},[n._v(n._s("poem"===t.publishMode?"诗歌":"普通"))]),t.isOriginal?r("v-uni-text",{staticClass:"draft-original"},[n._v("原创")]):n._e()],1)],1),r("v-uni-view",{staticClass:"draft-actions"},[r("v-uni-button",{staticClass:"action-btn edit-btn",attrs:{size:"mini","data-draft":t},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.editDraft.apply(void 0,arguments)}}},[n._v("编辑")]),r("v-uni-button",{staticClass:"action-btn delete-btn",attrs:{size:"mini","data-draft-id":t._id},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.deleteDraft.apply(void 0,arguments)}}},[n._v("删除")])],1)],1)})),1):r("v-uni-view",{staticClass:"empty-container"},[r("v-uni-view",{staticClass:"empty-icon"},[n._v("📝")]),r("v-uni-view",{staticClass:"empty-text"},[n._v("草稿箱是空的")]),r("v-uni-view",{staticClass:"empty-subtext"},[n._v("去发布一些内容吧")]),r("v-uni-button",{staticClass:"create-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.goToPublish.apply(void 0,arguments)}}},[n._v("开始创作")])],1)],1)},e=[]},"30f0":function(n,t,r){"use strict";r("6a54");var a=r("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=a(r("9b1b"));r("fd3c");var i=r("139b"),o=i.formatRelativeTime,s=i.formatDate,c=r("11ca"),d=c.cloudCall,f={data:function(){return{drafts:[],isLoading:!0}},onLoad:function(){this.loadDrafts()},onShow:function(){this.loadDrafts()},methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(n,t,Object.assign({pageTag:"draft-box",context:this,requireAuth:!0},r))},loadDrafts:function(){var n=this;this.setData({isLoading:!0});var t=this.$requireOpenid&&this.$requireOpenid();t?this.callCloudFunction("getMyProfileData",{action:"getDrafts",openid:t}).then((function(t){if(console.log("获取草稿列表结果:",t),t.result&&t.result.success){var r=t.result.drafts||[],a=r.map((function(n){return(0,e.default)((0,e.default)({},n),{},{formattedSaveTime:o(n.saveTime)||s(n.saveTime,"yyyy-MM-dd HH:mm")})}));n.setData({drafts:a,isLoading:!1})}else console.error("获取草稿失败:",t.result),n.setData({isLoading:!1}),uni.showToast({title:"加载草稿失败",icon:"none"})})).catch((function(t){console.error("获取草稿失败:",t),n.setData({isLoading:!1}),uni.showToast({title:"网络错误",icon:"none"})})):this.setData({isLoading:!1})},editDraft:function(n){var t=n.currentTarget.dataset.draft;if(t)try{uni.setStorageSync("editing_draft",t),uni.navigateTo({url:"/pages/add/add?mode=edit"})}catch(r){console.log("CatchClause",r),console.log("CatchClause",r),console.error("存储草稿数据失败:",r),uni.showToast({title:"打开草稿失败",icon:"none"})}},deleteDraft:function(n){var t=this,r=n.currentTarget.dataset.draftId;r&&uni.showModal({title:"删除草稿",content:"确定要删除这个草稿吗？",confirmColor:"#ff4d4f",success:function(n){if(n.confirm){var a=t.$requireOpenid&&t.$requireOpenid();a&&(uni.showLoading({title:"删除中..."}),t.callCloudFunction("getMyProfileData",{action:"deleteDraft",draftId:r,openid:a}).then((function(n){var r;(uni.hideLoading(),n.result&&n.result.success)?(uni.showToast({title:"删除成功",icon:"success"}),t.loadDrafts()):uni.showToast({title:(null===(r=n.result)||void 0===r?void 0:r.message)||"删除失败",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("删除草稿失败:",n),uni.showToast({title:"删除失败",icon:"none"})})))}}})},goToPublish:function(){uni.navigateTo({url:"/pages/add/add"})},formatTime:function(n){return o(n)||s(n,"yyyy-MM-dd HH:mm")}}};t.default=f},"32a8":function(n,t,r){var a=r("2704");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var e=r("967d").default;e("42fc02a0",a,!0,{sourceMap:!1,shadowMode:!1})},"73e1":function(n,t,r){"use strict";var a=r("29d8");n.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(a)},"795c":function(n,t,r){"use strict";var a=r("8bdb"),e=r("db04").start,i=r("73e1");a({target:"String",proto:!0,forced:i},{padStart:function(n){return e(this,n,arguments.length>1?arguments[1]:void 0)}})},db04:function(n,t,r){"use strict";var a=r("bb80"),e=r("c435"),i=r("9e70"),o=r("f298"),s=r("862c"),c=a(o),d=a("".slice),f=Math.ceil,l=function(n){return function(t,r,a){var o,l,u=i(s(t)),v=e(r),b=u.length,g=void 0===a?" ":i(a);return v<=b||""===g?u:(o=v-b,l=c(g,f(o/g.length)),l.length>o&&(l=d(l,0,o)),n?u+l:l+u)}};n.exports={start:l(!1),end:l(!0)}},eb53:function(n,t,r){"use strict";var a=r("32a8"),e=r.n(a);e.a}}]);