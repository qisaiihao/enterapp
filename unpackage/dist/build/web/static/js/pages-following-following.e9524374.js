(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-following-following"],{"31ae":function(t,e,i){"use strict";i.r(e);var n=i("54d5"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e["default"]=a.a},"3a7d":function(t,e,i){var n=i("c86c");e=n(!1),e.push([t.i,".container[data-v-5e64cf12]{padding:%?32?%;background-color:#f7f8fa;min-height:100vh}.list[data-v-5e64cf12]{display:flex;flex-direction:column;gap:%?24?%}.following-item[data-v-5e64cf12]{display:flex;align-items:center;justify-content:space-between;background-color:#fff;border-radius:%?16?%;padding:%?24?% %?28?%;box-shadow:0 %?6?% %?18?% rgba(0,0,0,.05)}.user-info[data-v-5e64cf12]{display:flex;align-items:center;flex:1;overflow:hidden}.avatar[data-v-5e64cf12]{width:%?88?%;height:%?88?%;border-radius:50%;margin-right:%?20?%;background-color:#f0f0f0}.info-text[data-v-5e64cf12]{display:flex;flex-direction:column;gap:%?8?%;overflow:hidden}.name[data-v-5e64cf12]{font-size:%?30?%;color:#333;font-weight:600}.bio[data-v-5e64cf12]{font-size:%?24?%;color:#888;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:%?420?%}.unfollow-btn[data-v-5e64cf12]{margin-left:%?24?%;border:%?2?% solid #ff8f8f;color:#ff6b6b;background-color:#fff;border-radius:%?999?%;padding:0 %?28?%;height:%?64?%!important;line-height:%?64?%!important}.unfollow-btn[data-v-5e64cf12]::after{border:none}.unfollow-btn[disabled][data-v-5e64cf12]{opacity:.6}.loading[data-v-5e64cf12],\r\n.loading-more[data-v-5e64cf12]{margin-top:%?32?%;text-align:center;color:#999;font-size:%?26?%}.empty[data-v-5e64cf12]{margin-top:%?120?%;text-align:center;color:#999;font-size:%?28?%}.footer-hint[data-v-5e64cf12]{margin-top:%?24?%}.mutual-label[data-v-5e64cf12]{margin-top:%?8?%;display:inline-block;padding:%?4?% %?16?%;background-color:#e6f4ff;color:#1f6fd2;border-radius:%?999?%;font-size:%?24?%}",""]),t.exports=e},"3b4d":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"container"},[t.isLoading&&0===t.followings.length?i("v-uni-view",{staticClass:"loading"},[i("v-uni-text",[t._v("加载中...")])],1):t.followings.length>0?[i("v-uni-view",{staticClass:"list"},t._l(t.followings,(function(e,n){return i("v-uni-view",{key:n,staticClass:"following-item"},[i("v-uni-view",{staticClass:"user-info",attrs:{"data-openid":e._openid},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openUserProfile.apply(void 0,arguments)}}},[i("v-uni-image",{staticClass:"avatar",attrs:{src:e.avatarUrl||t.defaultAvatar,mode:"aspectFill","data-index":n},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.onAvatarError.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"info-text"},[i("v-uni-text",{staticClass:"name"},[t._v(t._s(e.nickName||"微信用户"))]),i("v-uni-text",{staticClass:"bio"},[t._v(t._s(e.bio||"这个用户还没有留下简介~"))])],1)],1),i("v-uni-button",{staticClass:"unfollow-btn",attrs:{size:"mini","data-openid":e._openid,"data-index":n,loading:t.pendingOpenid===e._openid,disabled:t.pendingOpenid===e._openid},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.onToggleFollow.apply(void 0,arguments)}}},[t._v("取消关注")])],1)})),1)]:i("v-uni-view",{staticClass:"empty"},[i("v-uni-text",[t._v("还没有关注任何人，去广场看看吧～")])],1),t.followings.length>0?i("v-uni-view",{staticClass:"footer-hint"},[t.isLoading?i("v-uni-view",{staticClass:"loading-more"},[t._v("加载中...")]):t.hasMore?t._e():i("v-uni-view",{staticClass:"loading-more"},[t._v("已经到底了")])],1):t._e()],2)},a=[]},"54d5":function(t,e,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(i("39d8"));i("bf0f"),i("c223"),i("8f71");var o=i("11ca"),l=o.cloudCall,s={data:function(){return{followings:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:20,pendingOpenid:null,defaultAvatar:"/static/images/avatar.png",total:"",avatarKey:""}},onLoad:function(){this.loadFollowings(!0)},onPullDownRefresh:function(){this.loadFollowings(!0)},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadFollowings()},methods:{callCloudFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(t,e,Object.assign({pageTag:"following",context:this,requireAuth:!0},i))},loadFollowings:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading){e&&this.setData({page:0,hasMore:!0});var i=e?0:this.page;this.setData({isLoading:!0});var n=this.$requireOpenid&&this.$requireOpenid();if(!n)return this.setData({isLoading:!1}),void(e&&uni.stopPullDownRefresh());this.callCloudFunction("follow",{action:"getFollowingList",skip:i*this.PAGE_SIZE,limit:this.PAGE_SIZE,openid:n}).then((function(n){if(n.result&&n.result.success){var a=n.result.list||[],o=e?a:t.followings.concat(a);t.setData({followings:o,page:i+1,hasMore:!!n.result.hasMore,total:n.result.total||o.length})}else uni.showToast({title:n.result&&n.result.message?n.result.message:"加载失败",icon:"none"})})).catch((function(t){console.error("获取关注列表失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),e&&uni.stopPullDownRefresh()}))}},onToggleFollow:function(t){var e=this,i=t.currentTarget.dataset.openid,n=t.currentTarget.dataset.index;if(i&&!this.pendingOpenid){this.setData({pendingOpenid:i});var a=this.$requireOpenid&&this.$requireOpenid();a?this.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:i,openid:a}).then((function(t){if(t.result&&t.result.success){var i=!!t.result.isFollowing;if(i)uni.showToast({title:"已关注",icon:"success"});else{var a=e.followings.filter((function(t,e){return e!==n}));e.setData({followings:a}),uni.showToast({title:"已取消关注",icon:"success"}),e.hasMore&&a.length<e.PAGE_SIZE&&e.loadFollowings(),0!==a.length||e.hasMore||e.setData({page:0})}}else uni.showToast({title:t.result&&t.result.message?t.result.message:"操作失败",icon:"none"})})).catch((function(t){console.error("取消关注失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){e.setData({pendingOpenid:null})})):this.setData({pendingOpenid:null})}},onAvatarError:function(t){var e=t.currentTarget.dataset.index;if(void 0!==e){var i="followings[".concat(e,"].avatarUrl");this.setData((0,a.default)({},i,this.defaultAvatar))}},openUserProfile:function(t){var e=t.currentTarget.dataset.openid;e&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(e)})}}};e.default=s},9400:function(t,e,i){var n=i("3a7d");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("967d").default;a("41dede20",n,!0,{sourceMap:!1,shadowMode:!1})},"9b09":function(t,e,i){"use strict";i.r(e);var n=i("3b4d"),a=i("31ae");for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);i("c2b8");var l=i("828b"),s=Object(l["a"])(a["default"],n["b"],n["c"],!1,null,"5e64cf12",null,!1,n["a"],void 0);e["default"]=s.exports},c2b8:function(t,e,i){"use strict";var n=i("9400"),a=i.n(n);a.a}}]);