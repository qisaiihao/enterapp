(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-profile-profile"],{"04c9":function(n,e,r){"use strict";r.r(e);var t=r("d2dd"),a=r.n(t);for(var o in t)["default"].indexOf(o)<0&&function(n){r.d(e,n,(function(){return t[n]}))}(o);e["default"]=a.a},"0da0":function(n,e,r){"use strict";var t=r("ac8d"),a=r.n(t);a.a},"0f46":function(n,e,r){"use strict";var t=r("14fe"),a=r.n(t);a.a},"14fe":function(n,e,r){var t=r("8ed6");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[n.i,t,""]]),t.locals&&(n.exports=t.locals);var a=r("967d").default;a("7a9d0cb7",t,!0,{sourceMap:!1,shadowMode:!1})},"26a8":function(n,e,r){"use strict";r("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.getCurrentTabBarStatus=function(n){try{if("function"===typeof n.getTabBar&&n.getTabBar()){var e,r=n.getTabBar();return(null===(e=r.data)||void 0===e?void 0:e.selected)||null}}catch(o){console.log("无法从原生getTabBar获取状态")}try{var t,a=null===(t=n.$refs)||void 0===t?void 0:t.customTabBar;if(a&&a.data)return a.data.selected||null}catch(o){console.log("无法从自定义组件获取状态")}try{return uni.getStorageSync("currentTabIndex")||null}catch(o){console.log("无法从存储获取状态")}return null},e.isTabBarSupported=function(){try{return!("undefined"===typeof wx||!wx.getTabBar)||!("undefined"===typeof uni||!uni.getTabBar)}catch(n){return!1}},e.updateTabBarStatus=function(n,e){try{if("function"===typeof n.getTabBar&&n.getTabBar())return n.getTabBar().setData({selected:e}),console.log("TabBar状态更新成功 (原生API): selected=".concat(e)),!0}catch(r){console.log("原生getTabBar API不可用:",r.message)}try{return uni.setStorageSync("currentTabIndex",e),console.log("TabBar状态已保存到存储: selected=".concat(e)),!0}catch(r){console.log("存储机制不可用:",r.message)}return console.warn("原生getTabBar API不可用，当前平台可能不支持getTabBar()"),!1}},2774:function(n,e,r){r("01a2"),r("e39c"),r("bf0f"),r("844d"),r("18f7"),r("de6c"),r("08eb"),n.exports=function(n){if("undefined"!==typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)},n.exports.__esModule=!0,n.exports["default"]=n.exports},4550:function(n,e,r){r("6a54");var t=r("8bcf");n.exports=function(n,e,r){return e=t(e),e in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n},n.exports.__esModule=!0,n.exports["default"]=n.exports},"4d07":function(n,e,r){"use strict";r.r(e);var t=r("c03a"),a=r.n(t);for(var o in t)["default"].indexOf(o)<0&&function(n){r.d(e,n,(function(){return t[n]}))}(o);e["default"]=a.a},"4db6":function(n,e,r){r("6a54");var t=r("8bcf");function a(n,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,t(a.key),a)}}n.exports=function(n,e,r){return e&&a(n.prototype,e),r&&a(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n},n.exports.__esModule=!0,n.exports["default"]=n.exports},5014:function(n,e,r){r("dc8a"),r("01a2"),r("8f71"),r("bf0f"),r("9a2c"),r("aa9c"),r("2797"),r("a644"),r("a03a"),r("6a54");var t=r("4550");function a(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.push.apply(r,t)}return r}n.exports=function(n){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){t(n,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))}))}return n},n.exports.__esModule=!0,n.exports["default"]=n.exports},5347:function(n,e,r){"use strict";r.d(e,"b",(function(){return t})),r.d(e,"c",(function(){return a})),r.d(e,"a",(function(){}));var t=function(){var n=this.$createElement,e=this._self._c||n;return e("v-uni-view",{staticClass:"skeleton-wrapper"},[e("v-uni-view",{staticClass:"skeleton-poem-card"},[e("v-uni-view",{staticClass:"skeleton-original-badge skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-author-info"},[e("v-uni-view",{staticClass:"skeleton-avatar skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-name skeleton-animate"})],1),e("v-uni-view",{staticClass:"skeleton-title skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-content-large skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-content-large skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-content-large skeleton-animate",staticStyle:{width:"70%"}})],1),e("v-uni-view",{staticClass:"skeleton-poem-card skeleton-secondary"},[e("v-uni-view",{staticClass:"skeleton-author-info"},[e("v-uni-view",{staticClass:"skeleton-avatar skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-name skeleton-animate"})],1),e("v-uni-view",{staticClass:"skeleton-title skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-content-large skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-content-large skeleton-animate",staticStyle:{width:"80%"}})],1)],1)},a=[]},"56c9":function(n,e,r){r("9e15"),r("884b"),r("01a2"),r("e39c"),r("bf0f"),r("7a76"),r("c9b5"),r("64aa");var t=r("bdbb")["default"];n.exports=function(n,e){if("object"!==t(n)||null===n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var a=r.call(n,e||"default");if("object"!==t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(n)},n.exports.__esModule=!0,n.exports["default"]=n.exports},"5ee5":function(n,e,r){"use strict";r.r(e);var t=r("7eb6"),a=r("04c9");for(var o in a)["default"].indexOf(o)<0&&function(n){r.d(e,n,(function(){return a[n]}))}(o);r("65d3");var i=r("828b"),s=Object(i["a"])(a["default"],t["b"],t["c"],!1,null,"15998e9f",null,!1,t["a"],void 0);e["default"]=s.exports},"65d3":function(n,e,r){"use strict";var t=r("acd1"),a=r.n(t);a.a},"6bf1":function(n,e,r){"use strict";r.r(e);var t=r("7a50"),a=r.n(t);for(var o in t)["default"].indexOf(o)<0&&function(n){r.d(e,n,(function(){return t[n]}))}(o);e["default"]=a.a},"71b6":function(n,e,r){"use strict";r.r(e);var t=r("5347"),a=r("4d07");for(var o in a)["default"].indexOf(o)<0&&function(n){r.d(e,n,(function(){return a[n]}))}(o);r("0f46");var i=r("828b"),s=Object(i["a"])(a["default"],t["b"],t["c"],!1,null,"a51e8920",null,!1,t["a"],void 0);e["default"]=s.exports},"724b":function(n,e,r){"use strict";r.r(e);var t=r("7d9d"),a=r("6bf1");for(var o in a)["default"].indexOf(o)<0&&function(n){r.d(e,n,(function(){return a[n]}))}(o);r("0da0");var i=r("828b"),s=Object(i["a"])(a["default"],t["b"],t["c"],!1,null,"846b9078",null,!1,t["a"],void 0);e["default"]=s.exports},"73e1":function(n,e,r){"use strict";var t=r("29d8");n.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(t)},"795c":function(n,e,r){"use strict";var t=r("8bdb"),a=r("db04").start,o=r("73e1");t({target:"String",proto:!0,forced:o},{padStart:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},"7a3b":function(n,e,r){"use strict";r("6a54");var t=r("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.resetAllCachesOnAccountChange=g;var a=t(r("2634")),o=t(r("2fdc"));r("bf0f"),r("2797"),r("dc8a"),r("de6c"),r("f3f7"),r("18f7"),r("9db6"),r("9327");var i=t(r("7ef8")),s=t(r("9384")),l=r("b577"),c=r("acbf");function d(){try{var n=i.default&&i.default.getStats?i.default.getStats():{};Object.keys(n||{}).forEach((function(n){try{i.default.namespace(n).clear()}catch(e){}}))}catch(e){}}function u(){try{"undefined"!==typeof uni&&uni.removeStorageSync("cachedPostList")}catch(n){}}function f(){try{if("undefined"===typeof uni||"function"!==typeof uni.getStorageInfoSync)return;var n=uni.getStorageInfoSync(),e=n&&n.keys||[],r=new Set;e.forEach((function(n){if("string"===typeof n&&n.startsWith("__cm__:")&&n.endsWith(":__keys__")){var e=n.substring("__cm__:".length,n.length-":__keys__".length);e&&r.add(e)}})),r.forEach((function(n){try{i.default.namespace(n,{persistent:!0}).clear()}catch(e){}}))}catch(t){}}function g(){return v.apply(this,arguments)}function v(){return v=(0,o.default)((0,a.default)().mark((function n(){var e,r,t,o=arguments;return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:e=o.length>0&&void 0!==o[0]?o[0]:{},e.newOpenId,n.prev=1;try{s.default.invalidate()}catch(a){}d(),f(),u();try{c&&c.clearAllFollowCache&&c.clearAllFollowCache()}catch(a){}return n.prev=7,r="function"===typeof getApp?getApp():null,t=r||{$tcb:r&&r.$tcb?r.$tcb:null},n.next=12,(0,l.getMyInfo)(t);case 12:n.next=16;break;case 14:n.prev=14,n.t0=n["catch"](7);case 16:n.next=21;break;case 18:n.prev=18,n.t1=n["catch"](1);try{console.warn("[accountCacheReset] 清理缓存时出错",n.t1)}catch(a){}case 21:case"end":return n.stop()}}),n,null,[[1,18],[7,14]])}))),v.apply(this,arguments)}var p={resetAllCachesOnAccountChange:g};e.default=p},"7a50":function(n,e,r){"use strict";r("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,r("bd06"),r("5ef2"),r("5c47"),r("a1c1"),r("9db6");var t={data:function(){return{selected:0,color:"#999999",selectedColor:"#9ed7ee",lastTapTime:0,lastTapIndex:-1,doubleTapThreshold:300,list:[{pagePath:"pages/index/index",text:"广场",iconPath:"/static/images/market.png",selectedIconPath:"/static/images/marketplus.png"},{pagePath:"pages/poem-square/poem-square",text:"·",iconPath:"/static/images/road.png",selectedIconPath:"/static/images/roadplus.png"},{pagePath:"pages/mountain/mountain",text:"山",iconPath:"/static/images/mountain.png",selectedIconPath:"/static/images/mountainplus.png"},{pagePath:"pages/profile/profile",text:"池",iconPath:"/static/images/pools.png",selectedIconPath:"/static/images/poolsplus.png"}]}},created:function(){this.syncSelected()},methods:{syncSelected:function(){try{var n=getCurrentPages(),e=n&&n.length?n[n.length-1]:null,r=e&&(e.route||e.$page&&e.$page.fullPath||"");if(!r)return;var t=this.list.findIndex((function(n){return r.indexOf(n.pagePath.replace(/^\//,""))>=0}));t>=0&&this.setData({selected:t})}catch(a){}},switchTab:function(n){var e=n.currentTarget.dataset,r=e.path,t=e.index,a=Date.now(),o=a-this.lastTapTime<this.doubleTapThreshold&&this.lastTapIndex===t&&this.selected===t;if(this.setData({lastTapTime:a,lastTapIndex:t}),o)this.refreshCurrentPage();else{var i=r.startsWith("/")?r:"/".concat(r);uni.switchTab({url:i})}},refreshCurrentPage:function(){var n=this.list[this.selected],e=getCurrentPages(),r=e[e.length-1];if(r)switch(n.pagePath){case"pages/index/index":this.refreshIndexPage(r);break;case"pages/poem-square/poem-square":this.refreshPoemPage(r);break;case"pages/mountain/mountain":this.refreshMountainPage(r);break;case"pages/profile/profile":this.refreshProfilePage(r);break;default:this.refreshGenericPage(r)}},refreshIndexPage:function(n){n.refreshData?n.refreshData():n.onPullDownRefresh||uni.startPullDownRefresh()},refreshPoemPage:function(n){n.refreshPoemData?n.refreshPoemData():n.onPullDownRefresh||uni.startPullDownRefresh()},refreshMountainPage:function(n){n.refreshMountainData?n.refreshMountainData():n.onPullDownRefresh||uni.startPullDownRefresh()},refreshProfilePage:function(n){n.onPullDownRefresh||uni.startPullDownRefresh()},refreshGenericPage:function(n){n.onPullDownRefresh||uni.startPullDownRefresh()}}};e.default=t},"7d9d":function(n,e,r){"use strict";r.d(e,"b",(function(){return t})),r.d(e,"c",(function(){return a})),r.d(e,"a",(function(){}));var t=function(){var n=this,e=n.$createElement,r=n._self._c||e;return r("v-uni-view",{staticClass:"tab-bar"},n._l(n.list,(function(e,t){return r("v-uni-view",{key:t,staticClass:"tab-bar-item",attrs:{"data-index":t,"data-path":e.pagePath},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.switchTab.apply(void 0,arguments)}}},[r("v-uni-view",{class:["icon-wrap",n.selected===t?"pressed":""]},[r("v-uni-view",{class:["icon-inner",n.selected===t?"active":""]},[r("v-uni-image",{staticClass:"icon-img",attrs:{src:n.selected===t&&e.selectedIconPath||e.iconPath,mode:"aspectFill"}})],1)],1),r("v-uni-text",{staticClass:"tab-bar-text"},[n._v(n._s(e.text))])],1)})),1)},a=[]},"7eb6":function(n,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return o})),r.d(e,"a",(function(){return t}));var t={skeleton:r("71b6").default},a=function(){var n=this,e=n.$createElement,r=n._self._c||e;return r("v-uni-view",[r("v-uni-view",{staticClass:"container"},[n.isLoading?r("v-uni-view",[r("skeleton")],1):n._e(),r("v-uni-scroll-view",{staticClass:"scroll-container",attrs:{"wx:else":!0,"scroll-y":!0,"lower-threshold":"100",enhanced:!0,"show-scrollbar":!1},on:{scrolltolower:function(e){arguments[0]=e=n.$handleEvent(e),n.onScrollToLower.apply(void 0,arguments)}}},[n.isSidebarOpen?r("v-uni-view",{staticClass:"sidebar-mask",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.toggleSidebar.apply(void 0,arguments)}}}):n._e(),r("v-uni-view",{class:"sidebar "+(n.isSidebarOpen?"open":"")},[r("v-uni-view",{staticClass:"sidebar-header"},[r("v-uni-image",{staticClass:"sidebar-avatar",attrs:{src:n.userInfo.avatarUrl||"/static/images/avatar.png",mode:"aspectFill"},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.onAvatarError.apply(void 0,arguments)}}}),r("v-uni-text",{staticClass:"sidebar-nickname"},[n._v(n._s(n.userInfo.nickName||"微信用户"))])],1),r("v-uni-view",{staticClass:"sidebar-menu"},[r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToEditProfile.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("修改资料")])],1),n.isAdmin?r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToImageManager.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("图片管理")])],1):n._e(),r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToMessages.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("消息通知")]),n.unreadCount>0?r("v-uni-view",{staticClass:"unread-badge"},[n._v(n._s(n.unreadCount))]):n._e()],1),r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToMyLikes.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("我的点赞")])],1),r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToFollowing.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("我关注的")])],1),r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToFans.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("我的粉丝")]),n.newFollowerCount>0?r("v-uni-view",{staticClass:"unread-dot"}):n._e()],1),r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToFavoriteFolders.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("我的收藏夹")])],1),r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToPortfolio.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("作品集")])],1),r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToDraftBox.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("草稿箱")])],1),r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToFeedback.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("意见反馈")])],1),n.isAdmin?r("v-uni-view",{staticClass:"sidebar-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToFeedbackAdmin.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("反馈管理")])],1):n._e(),r("v-uni-view",{staticClass:"sidebar-item logout-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.showLogoutConfirm.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("退出登录")])],1),r("v-uni-view",{staticClass:"follow-stats"},[r("v-uni-view",{staticClass:"stat-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToFollowing.apply(void 0,arguments)}}},[r("v-uni-text",{staticClass:"stat-number"},[n._v(n._s(n.followingCount))]),r("v-uni-text",{staticClass:"stat-label"},[n._v("关注")])],1),r("v-uni-view",{staticClass:"stat-divider"}),r("v-uni-view",{staticClass:"stat-item",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToFans.apply(void 0,arguments)}}},[r("v-uni-text",{staticClass:"stat-number"},[n._v(n._s(n.followerCount))]),r("v-uni-text",{staticClass:"stat-label"},[n._v("被关注")])],1)],1)],1)],1),r("v-uni-view",{staticClass:"main-content"},[r("v-uni-view",{staticClass:"profile-card profile-card-center"},[r("v-uni-view",{staticClass:"profile-avatar-large"},[r("v-uni-image",{attrs:{src:n.userInfo.avatarUrl||"/static/images/avatar.png",mode:"aspectFill"},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.onAvatarError.apply(void 0,arguments)}}})],1),r("v-uni-view",{staticClass:"profile-info-center"},[r("v-uni-text",{staticClass:"profile-name-center"},[n._v(n._s(n.userInfo.nickName||"微信用户"))]),r("v-uni-text",{staticClass:"profile-poemid"},[n._v("poemid："+n._s(n.userInfo._openid||"未知"))]),r("v-uni-text",{staticClass:"profile-bio-center"},[n._v(n._s(n.userInfo.bio||"这个用户很懒,什么都没留下..."))]),r("v-uni-view",{staticClass:"profile-bottom-row"},[r("v-uni-text",{staticClass:"profile-followers"},[n._v("被关注数："+n._s(n.userInfo.followersCount||0))]),r("v-uni-view",{staticClass:"profile-buttons"},[r("v-uni-view",{staticClass:"edit-profile-btn",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateToEditProfile.apply(void 0,arguments)}}},[r("v-uni-text",[n._v("编辑主页")])],1),r("v-uni-image",{staticClass:"menu-btn-small",attrs:{src:"/static/images/icons/menu-icon.svg"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.toggleSidebar.apply(void 0,arguments)}}})],1)],1)],1)],1),n.isViewingSelf?r("v-uni-view",{staticClass:"profile-detail-card"},[r("v-uni-text",{staticClass:"detail-item-inline"},[n._v("生日:"+n._s(n.userInfo.birthday?n.userInfo.birthday:"未设置"))]),r("v-uni-text",{staticClass:"detail-item-inline"},[n._v("年龄:"+n._s(n.userInfo.age?n.userInfo.age+"岁":"未知"))])],1):n._e(),r("v-uni-view",{staticClass:"tab-navigation"},[r("v-uni-view",{class:"tab-item "+("posts"===n.currentTab?"active":""),attrs:{"data-tab":"posts"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.switchTab.apply(void 0,arguments)}}},[r("v-uni-image",{staticClass:"tab-icon",attrs:{src:"/static/images/my_posts.png",mode:"aspectFit"}})],1),r("v-uni-view",{class:"tab-item "+("portfolio"===n.currentTab?"active":""),attrs:{"data-tab":"portfolio"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.switchTab.apply(void 0,arguments)}}},[r("v-uni-image",{staticClass:"tab-icon",attrs:{src:"/static/images/portfolio.png",mode:"aspectFit"}})],1),r("v-uni-view",{class:"tab-item "+("favorites"===n.currentTab?"active":""),attrs:{"data-tab":"favorites"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.switchTab.apply(void 0,arguments)}}},[r("v-uni-image",{staticClass:"tab-icon",attrs:{src:"/static/images/my_favorites.png",mode:"aspectFit"}})],1)],1),"posts"===n.currentTab?r("v-uni-view",{staticClass:"my-posts-section"},[n.myPosts.length>0?[n._l(n.myPosts,(function(e,t){return r("v-uni-view",{key:t,class:"post-item-wrapper "+(e.isOriginal?"original-post":"")},[r("v-uni-view",{staticClass:"author-info-outside"},[e.authorAvatar?r("v-uni-image",{staticClass:"author-avatar",attrs:{src:e.authorAvatar,mode:"aspectFill","data-postindex":t,"data-user-id":e._openid},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.onAvatarError.apply(void 0,arguments)},load:function(e){arguments[0]=e=n.$handleEvent(e),n.onAvatarLoad.apply(void 0,arguments)},click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.navigateToUserProfile.apply(void 0,arguments)}}}):n._e(),r("v-uni-text",{staticClass:"author-name"},[n._v(n._s(e.authorName))])],1),r("v-uni-navigator",{staticClass:"post-content-navigator",attrs:{url:"/pages/post-detail/post-detail?id="+e._id,"hover-class":"navigator-hover"}},[r("v-uni-view",{staticClass:"post-item"},[r("v-uni-view",{staticClass:"post-title"},[n._v(n._s(e.title))]),e.isPoem&&e.author?r("v-uni-view",{staticClass:"poem-author"},[n._v(n._s(e.author))]):n._e(),e.imageUrls&&e.imageUrls.length>0?r("v-uni-view",{staticClass:"image-container-wrapper",style:e.imageStyle,attrs:{"data-src":e.imageUrls[0],"data-original-image-urls":e.originalImageUrls||e.imageUrls},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.handlePreview.apply(void 0,arguments)}}},[1===e.imageUrls.length?[r("v-uni-image",{staticClass:"post-image",attrs:{id:"single-image-"+e._id,src:e.imageUrls[0],mode:"aspectFill","lazy-load":!0,"data-postid":e._id,"data-postindex":t,"data-imgindex":"0","data-type":"single"},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.onImageError.apply(void 0,arguments)},load:function(e){arguments[0]=e=n.$handleEvent(e),n.onImageLoad.apply(void 0,arguments)}}})]:e.imageUrls.length>1?[r("v-uni-swiper",{staticClass:"image-swiper",style:"height: "+(n.swiperHeights[t]?n.swiperHeights[t]+"px":"220px")+";",attrs:{id:"swiper-"+e._id,"indicator-dots":!0,circular:!0}},[n._l(e.imageUrls,(function(a,o){return[r("v-uni-swiper-item",[r("v-uni-image",{staticClass:"post-image",attrs:{src:a,mode:"aspectFill","lazy-load":!0,"data-src":a,"data-original-image-urls":e.originalImageUrls||e.imageUrls,"data-postid":e._id,"data-postindex":t,"data-imgindex":o,"data-type":"multi"},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.onImageError.apply(void 0,arguments)},load:function(e){arguments[0]=e=n.$handleEvent(e),n.onImageLoad.apply(void 0,arguments)},click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.handlePreview.apply(void 0,arguments)}}})],1)]}))],2)]:n._e()],2):n._e(),e.content?r("v-uni-view",{staticClass:"post-content",staticStyle:{"white-space":"pre-wrap"}},[n._v(n._s(e.content))]):n._e(),e.tags&&e.tags.length>0?r("v-uni-view",{staticClass:"post-tags"},n._l(e.tags,(function(e,t){return r("v-uni-text",{key:t,staticClass:"post-tag",attrs:{"data-tag":e},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.onTagClick.apply(void 0,arguments)}}},[n._v("#"+n._s(e))])})),1):n._e()],1)],1),r("v-uni-view",{staticClass:"delete-section"},[r("v-uni-view",{staticClass:"time-left"},[r("v-uni-text",{staticClass:"post-time"},[n._v("发布于"+n._s(e.formattedCreateTime||"未知时间"))])],1),r("v-uni-view",{staticClass:"button-group"},[r("v-uni-view",{staticClass:"delete-btn",attrs:{"data-postid":e._id,"data-index":t},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.onDelete.apply(void 0,arguments)}}},[r("v-uni-image",{staticClass:"delete-icon",attrs:{src:"/static/images/delete.png",mode:"aspectFit"}})],1)],1)],1)],1)})),r("v-uni-view",{staticClass:"loading-footer"},[!n.hasMore&&n.myPosts.length>0?[r("v-uni-text",[n._v("--- 我是有底线的 ---")])]:n._e()],2),r("v-uni-view",{staticStyle:{height:"200rpx"}})]:r("v-uni-view",{staticClass:"empty-tip"},[r("v-uni-text",[n._v("你还没有发布过帖子哦～")])],1)],2):n._e(),"favorites"===n.currentTab?r("v-uni-view",{staticClass:"favorites-section"},[n.favoriteList.length>0?[n._l(n.favoriteList,(function(e,t){return r("v-uni-view",{key:t,class:"post-item-wrapper "+(e.isOriginal?"original-post":"")},[r("v-uni-view",{staticClass:"author-info-outside"},[e.authorAvatar?r("v-uni-image",{staticClass:"author-avatar",attrs:{src:e.authorAvatar,mode:"aspectFill","data-postindex":t,"data-user-id":e._openid},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.onAvatarError.apply(void 0,arguments)},load:function(e){arguments[0]=e=n.$handleEvent(e),n.onAvatarLoad.apply(void 0,arguments)},click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.navigateToUserProfile.apply(void 0,arguments)}}}):n._e(),r("v-uni-text",{staticClass:"author-name"},[n._v(n._s(e.authorName))])],1),r("v-uni-navigator",{staticClass:"post-content-navigator",attrs:{url:"/pages/post-detail/post-detail?id="+e._id,"hover-class":"navigator-hover"}},[r("v-uni-view",{staticClass:"post-item"},[r("v-uni-view",{staticClass:"post-title"},[n._v(n._s(e.title))]),e.isPoem&&e.author?r("v-uni-view",{staticClass:"poem-author"},[n._v(n._s(e.author))]):n._e(),e.imageUrls&&e.imageUrls.length>0?r("v-uni-view",{staticClass:"image-container-wrapper",style:e.imageStyle,attrs:{"data-src":e.imageUrls[0],"data-original-image-urls":e.originalImageUrls||e.imageUrls},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.handlePreview.apply(void 0,arguments)}}},[1===e.imageUrls.length?[r("v-uni-image",{staticClass:"post-image",attrs:{id:"single-image-"+e._id,src:e.imageUrls[0],mode:"aspectFill","lazy-load":!0,"data-postid":e._id,"data-postindex":t,"data-imgindex":"0","data-type":"single"},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.onImageError.apply(void 0,arguments)},load:function(e){arguments[0]=e=n.$handleEvent(e),n.onImageLoad.apply(void 0,arguments)}}})]:e.imageUrls.length>1?[r("v-uni-swiper",{staticClass:"image-swiper",style:"height: "+(n.swiperHeights[t]?n.swiperHeights[t]+"px":"220px")+";",attrs:{id:"swiper-"+e._id,"indicator-dots":!0,circular:!0}},[n._l(e.imageUrls,(function(a,o){return[r("v-uni-swiper-item",[r("v-uni-image",{staticClass:"post-image",attrs:{src:a,mode:"aspectFill","lazy-load":!0,"data-src":a,"data-original-image-urls":e.originalImageUrls||e.imageUrls,"data-postid":e._id,"data-postindex":t,"data-imgindex":o,"data-type":"multi"},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.onImageError.apply(void 0,arguments)},load:function(e){arguments[0]=e=n.$handleEvent(e),n.onImageLoad.apply(void 0,arguments)},click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.handlePreview.apply(void 0,arguments)}}})],1)]}))],2)]:n._e()],2):n._e(),e.content?r("v-uni-view",{staticClass:"post-content",staticStyle:{"white-space":"pre-wrap"}},[n._v(n._s(e.content))]):n._e(),e.tags&&e.tags.length>0?r("v-uni-view",{staticClass:"post-tags"},n._l(e.tags,(function(e,t){return r("v-uni-text",{key:t,staticClass:"post-tag",attrs:{"data-tag":e},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.onTagClick.apply(void 0,arguments)}}},[n._v("#"+n._s(e))])})),1):n._e()],1)],1),r("v-uni-view",{staticClass:"delete-section"},[r("v-uni-view",{staticClass:"time-left"},[r("v-uni-text",{staticClass:"favorite-time"},[n._v("收藏于"+n._s(e.formattedFavoriteTime||"未知时间"))])],1),r("v-uni-view",{staticClass:"button-group"},[r("v-uni-button",{staticClass:"remove-favorite-btn",attrs:{size:"mini","data-favorite-id":e.favoriteId,"data-index":t},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.removeFavorite.apply(void 0,arguments)}}},[n._v("取消收藏")])],1)],1)],1)})),r("v-uni-view",{staticClass:"loading-footer"},[!n.favoriteHasMore&&n.favoriteList.length>0?[r("v-uni-text",[n._v("--- 我是有底线的 ---")])]:n._e()],2),r("v-uni-view",{staticStyle:{height:"200rpx"}})]:r("v-uni-view",{staticClass:"empty-tip"},[r("v-uni-text",[n._v("你还没有收藏过内容哦～")])],1)],2):n._e(),"portfolio"===n.currentTab?r("v-uni-view",{staticClass:"portfolio-section"},[r("v-uni-view",{staticClass:"empty-tip"},[r("v-uni-text",[n._v("作品集页面还没建好，先留空")])],1)],1):n._e()],1)],1)],1),r("app-tab-bar",{ref:"customTabBar"})],1)},o=[]},"883d":function(n,e,r){r("7a76"),r("c9b5"),n.exports=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},n.exports.__esModule=!0,n.exports["default"]=n.exports},"8bcf":function(n,e,r){var t=r("bdbb")["default"],a=r("56c9");n.exports=function(n){var e=a(n,"string");return"symbol"===t(e)?e:String(e)},n.exports.__esModule=!0,n.exports["default"]=n.exports},"8ed6":function(n,e,r){var t=r("c86c");e=t(!1),e.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* components/skeleton/skeleton.wxss */.skeleton-wrapper[data-v-a51e8920]{width:100%;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?20?%;box-sizing:border-box}\n/* 读诗页骨架屏卡片样式 - 匹配读诗页设计 */.skeleton-poem-card[data-v-a51e8920]{width:calc(100% - %?40?%);height:calc(100% - %?80?%);display:flex;flex-direction:column;padding:%?40?% %?20?%;box-sizing:border-box;background:hsla(0,0%,100%,.95);margin:%?40?% %?20?%;border-radius:%?24?%;box-shadow:0 %?8?% %?32?% rgba(0,0,0,.1);position:relative}\n/* 第二个卡片透明度降低 */.skeleton-poem-card.skeleton-secondary[data-v-a51e8920]{opacity:.6;position:absolute;top:%?20?%;left:%?20?%;right:%?20?%;bottom:%?20?%;z-index:-1;-webkit-transform:scale(.95);transform:scale(.95)}\n/* 原创标识骨架 */.skeleton-original-badge[data-v-a51e8920]{position:absolute;top:%?20?%;right:%?20?%;width:%?80?%;height:%?40?%;border-radius:%?20?%}\n/* 作者信息骨架 */.skeleton-author-info[data-v-a51e8920]{display:flex;align-items:center;margin-bottom:%?15?%;padding-bottom:%?10?%}.skeleton-avatar[data-v-a51e8920]{width:%?80?%;height:%?80?%;border-radius:50%;margin-right:%?20?%}.skeleton-name[data-v-a51e8920]{width:%?200?%;height:%?32?%;border-radius:%?16?%}\n/* 居中标题骨架 */.skeleton-title[data-v-a51e8920]{width:60%;height:%?40?%;margin:0 auto %?20?% auto; /* 居中并增加下边距 */border-radius:%?20?%;text-align:center}\n/* 大内容区域骨架 */.skeleton-content-large[data-v-a51e8920]{width:100%;height:%?40?%;margin-bottom:%?20?%;border-radius:%?20?%}.skeleton-animate[data-v-a51e8920]{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;-webkit-animation:skeleton-loading-data-v-a51e8920 1.5s infinite linear;animation:skeleton-loading-data-v-a51e8920 1.5s infinite linear}@-webkit-keyframes skeleton-loading-data-v-a51e8920{0%{background-position:200% 0}100%{background-position:-200% 0}}@keyframes skeleton-loading-data-v-a51e8920{0%{background-position:200% 0}100%{background-position:-200% 0}}",""]),n.exports=e},9376:function(n,e,r){r("7a76"),r("c9b5"),n.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},n.exports.__esModule=!0,n.exports["default"]=n.exports},"962f":function(n,e,r){r("795c"),r("64aa"),r("5c47"),r("a1c1"),r("c223"),r("f7a5");var t=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(n).padStart(e,"0")},a=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",r=n instanceof Date?n:new Date(n);if(Number.isNaN(r.getTime()))return"";var a={yyyy:String(r.getFullYear()),MM:t(r.getMonth()+1),dd:t(r.getDate()),HH:t(r.getHours()),mm:t(r.getMinutes()),ss:t(r.getSeconds())};return e.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(n){return a[n]}))};n.exports={formatTimeAgo:function(n){var e=new Date,r=new Date(n),t=e.getTime()-r.getTime(),a=Math.floor(t/1e3),o=Math.floor(a/60),i=Math.floor(o/60),s=Math.floor(i/24);if(s>=7){var l=r.getFullYear(),c=("0"+(r.getMonth()+1)).slice(-2),d=("0"+r.getDate()).slice(-2);return"".concat(l,"-").concat(c,"-").concat(d)}return s>=1?"".concat(s,"天前"):i>=1?"".concat(i,"小时前"):o>=1?"".concat(o,"分钟前"):"刚刚"},formatRelativeTime:function(n){var e=Date.now(),r=n instanceof Date?n.getTime():new Date(n).getTime();if(Number.isNaN(r))return"";var t=e-r,o=Math.floor(Math.abs(t)/1e3),i=t>=0?"前":"后";if(o<60)return"刚刚";var s=Math.floor(o/60);if(s<60)return"".concat(s,"分钟").concat(i);var l=Math.floor(s/60);if(l<24)return"".concat(l,"小时").concat(i);var c=Math.floor(l/24);return c<7?"".concat(c,"天").concat(i):a(r,"yyyy-MM-dd")},formatDate:a}},"9c8b":function(n,e,r){var t=r("bdbb").default,a=r("4550").default;r("5c47"),r("a1c1"),r("c223"),r("64aa");function o(n){return"undefined"===typeof uni||"function"!==typeof uni.createSelectorQuery?null:uni.createSelectorQuery().in(n)}function i(n,e,r){if("function"!==typeof n.setData){for(var o=e.replace(/\[(.*?)\]/g,".$1").replace(/^\./,""),i=o.split("."),s=n,l=0;l<i.length-1;l+=1){var c=i[l];s[c]&&"object"===t(s[c])||(s[c]={}),s=s[c]}s[i[i.length-1]]=r}else n.setData(a({},e,r))}n.exports={data:function(){return{__galleryImageMeta:{}}},created:function(){"undefined"===typeof this.swiperHeights&&(this.swiperHeights={}),"undefined"===typeof this.imageClampHeights&&(this.imageClampHeights={}),"undefined"===typeof this.imageCache&&(this.imageCache={})},methods:{onImageLoad:function(n){if(n&&n.detail&&n.currentTarget){var e=n.currentTarget.dataset||{},r=n.detail,t=r.width,a=r.height;if(t&&a){var o=function(n){return void 0!==n.galleryKey&&null!==n.galleryKey?n.galleryKey:void 0!==n.postindex&&null!==n.postindex?n.postindex:void 0!==n.postIndex&&null!==n.postIndex?n.postIndex:void 0!==n.index&&null!==n.index?n.index:void 0!==n.postid&&null!==n.postid?n.postid:void 0!==n.postId&&null!==n.postId?n.postId:void 0!==n.imgindex?"gallery-".concat(n.imgindex):"gallery"}(e),i="undefined"!==typeof e.imgindex?e.imgindex:e.imgIndex||0,s=e.type||e.imageType||"single",l="".concat(o,"_").concat(i);this.__galleryImageMeta&&(this.__galleryImageMeta[l]={width:t,height:a}),this.imageCache&&(this.imageCache[l]={width:t,height:a});var c=Number(this.galleryMinImageRatio)||9/16,d=Number(this.galleryMaxImageRatio)||16/9;if("multi"===s&&0===Number(i)){var u=e.swiperSelector||e.gallerySelector||"#swiper-".concat(o);this.__updateSwiperHeight({key:o,selector:u,originalWidth:t,originalHeight:a,minRatio:c,maxRatio:d})}if("single"===s){var f=e.singleSelector||e.imageSelector||"#single-image-".concat(o);this.__updateClampHeight({key:o,selector:f,originalWidth:t,originalHeight:a,minRatio:c})}}}},__updateSwiperHeight:function(n){var e=this,r=n.key,t=n.selector,a=n.originalWidth,s=n.originalHeight,l=n.minRatio,c=n.maxRatio;if(t){var d=o(this);d&&d.select(t).boundingClientRect((function(n){if(n&&n.width){var t=a/s,o=function(n,e,r){return n>r?r:n<e?e:n}(t,l,c),d=n.width/o;i(e,"swiperHeights[".concat(r,"]"),d)}})).exec()}},__updateClampHeight:function(n){var e=this,r=n.key,t=n.selector,a=n.originalWidth,s=n.originalHeight,l=n.minRatio,c=a/s;if(!(c>=l)){var d=t?o(this):null;if(t&&d)d.select(t).boundingClientRect((function(n){if(n&&n.width){var t=n.width/l;i(e,"imageClampHeights.".concat(r),t)}})).exec();else if(this.galleryFallbackWidth){var u=this.galleryFallbackWidth/l;i(this,"imageClampHeights.".concat(r),u)}}}}}},ac8d:function(n,e,r){var t=r("d1b0");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[n.i,t,""]]),t.locals&&(n.exports=t.locals);var a=r("967d").default;a("471ee932",t,!0,{sourceMap:!1,shadowMode:!1})},acbf:function(n,e,r){var t=r("5014").default,a=r("d189").default,o=r("883d").default,i=r("4db6").default;r("bf0f"),r("f3f7"),r("18f7"),r("de6c"),r("c223"),r("2797"),r("aa9c"),r("8f71"),r("fd3c"),r("dc8a"),r("9db6"),r("9327");var s=r("7ef8").default,l=r("38db"),c=l.cloudCall;function d(n){return s.namespace("follow:".concat(n),{persistent:!0,maxItems:4e3})}var u=function(){"use strict";function n(){o(this,n),this.loadingFollows=new Set}return i(n,[{key:"callCloudFunction",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(n,e,{pageTag:"followCache",requireAuth:!0})}},{key:"getFollowStatus",value:function(n,e){if(!n||!e||n===e)return Promise.resolve(null);var r=d(n).get(e);return r?(console.log("【关注缓存】命中缓存: ".concat(n," -> ").concat(e)),Promise.resolve(r)):this.loadingFollows.has("".concat(n,"_").concat(e))?(console.log("【关注缓存】正在加载中，等待: ".concat(n," -> ").concat(e)),this.waitForFollowLoad(n,e)):this.loadFollowStatus(n,e)}},{key:"waitForFollowLoad",value:function(n,e){var r=this;return new Promise((function(t){var a="".concat(n,"_").concat(e),o=setInterval((function(){if(!r.loadingFollows.has(a)){clearInterval(o);var i=d(n).get(e);t(i)}}),100);setTimeout((function(){clearInterval(o),r.loadingFollows.delete(a),t(null)}),3e3)}))}},{key:"loadFollowStatus",value:function(n,e){var r=this,t="".concat(n,"_").concat(e);return this.loadingFollows.add(t),console.log("【关注缓存】开始加载关注状态: ".concat(n," -> ").concat(e)),new Promise((function(a){r.callCloudFunction("follow",{action:"checkFollow",targetOpenid:e}).then((function(r){if(r.result&&r.result.success){var t={isFollowing:!!r.result.isFollowing,isFollowedByAuthor:!!r.result.isFollower,isMutualFollow:!!r.result.isMutual,lastUpdated:Date.now()};d(n).set(e,t,{ttlMs:36e5}),console.log("【关注缓存】加载并缓存成功: ".concat(n," -> ").concat(e),t),a(t)}else console.warn("【关注缓存】获取关注状态失败: ".concat(n," -> ").concat(e),r.result),a(null)})).catch((function(r){console.error("【关注缓存】加载关注状态失败: ".concat(n," -> ").concat(e),r),a(null)})).finally((function(){r.loadingFollows.delete(t)}))}))}},{key:"getBatchFollowStatus",value:function(n,e){var r=this;if(!n||!e||0===e.length)return Promise.resolve({});var t={},a=[];return e.forEach((function(e){if(e!==n){var r=d(n).get(e);r?t[e]=r:a.push(e)}})),a.length>0?(console.log("【关注缓存】批量加载关注状态: ".concat(a.length,"个")),new Promise((function(e){r.callCloudFunction("getBatchFollowStatus",{currentUserId:n,targetUserIds:a}).then((function(r){r.result&&r.result.success&&r.result.followStatuses&&r.result.followStatuses.forEach((function(e){if(e&&e.targetUserId){var r={isFollowing:!!e.isFollowing,isFollowedByAuthor:!!e.isFollowedByAuthor,isMutualFollow:!!e.isMutualFollow,lastUpdated:Date.now()};t[e.targetUserId]=r,d(n).set(e.targetUserId,r,{ttlMs:36e5})}})),e(t)})).catch((function(n){console.error("【关注缓存】批量加载失败:",n),e(t)}))}))):Promise.resolve(t)}},{key:"preloadFollowStatusFromPosts",value:function(n,e){var r=this;if(n&&0!==n.length&&e){var t=a(new Set(n.map((function(n){return n._openid})).filter((function(n){return n&&n!==e}))));0!==t.length&&setTimeout((function(){r.getBatchFollowStatus(e,t).then((function(n){console.log("【关注缓存】预加载完成: ".concat(Object.keys(n).length,"个关注状态"))}))}),100)}}},{key:"updateFollowStatus",value:function(n,e,r){if(!n||!e||!r)return!1;var a=t(t({},r),{},{lastUpdated:Date.now()});try{return d(n).set(e,a,{ttlMs:36e5}),!0}catch(o){return!1}}},{key:"toggleFollowStatus",value:function(n,e){var r=this;return n&&e&&n!==e?new Promise((function(t){r.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:e}).then((function(a){if(a.result&&a.result.success){var o={isFollowing:!!a.result.isFollowing,isFollowedByAuthor:!!a.result.isFollower,isMutualFollow:!!a.result.isMutual,lastUpdated:Date.now()};r.updateFollowStatus(n,e,o),console.log("【关注缓存】切换关注状态成功: ".concat(n," -> ").concat(e),o),t(o)}else console.warn("【关注缓存】切换关注状态失败: ".concat(n," -> ").concat(e),a.result),t(null)})).catch((function(r){console.error("【关注缓存】切换关注状态失败: ".concat(n," -> ").concat(e),r),t(null)}))})):Promise.resolve(null)}},{key:"clearUserFollowCache",value:function(n){if(!n)return!1;try{return d(n).clear(),!0}catch(e){return console.log("CatchClause",e),console.log("CatchClause",e),console.error("清理用户关注缓存失败:",e),!1}}},{key:"clearAllFollowCache",value:function(){try{var n=uni.getStorageInfoSync&&uni.getStorageInfoSync(),e=n&&n.keys||[];return e.forEach((function(n){if("string"===typeof n&&n.startsWith("__cm__:follow:")&&n.endsWith(":__keys__")){var e=n.substring("__cm__:".length,n.length-":__keys__".length);try{s.namespace(e,{persistent:!0}).clear()}catch(r){}}})),!0}catch(r){return console.log("CatchClause",r),console.log("CatchClause",r),console.error("清理所有关注缓存失败:",r),!1}}}]),n}(),f=new u;n.exports=f},acd1:function(n,e,r){var t=r("b6a9");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[n.i,t,""]]),t.locals&&(n.exports=t.locals);var a=r("967d").default;a("260b8276",t,!0,{sourceMap:!1,shadowMode:!1})},b6a9:function(n,e,r){var t=r("c86c");e=t(!1),e.push([n.i,'\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* pages/profile/profile.wxss */.container[data-v-15998e9f]{width:100%;height:100vh;background-color:#fff}.scroll-container[data-v-15998e9f]{width:100%;height:100%}.sidebar-mask[data-v-15998e9f]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:999}.sidebar[data-v-15998e9f]{position:fixed;top:0;left:-70%; /* Start off-screen */width:70%;height:100%;background-color:#fff;box-shadow:2px 0 5px rgba(0,0,0,.1);transition:left .3s ease;z-index:1000;display:flex;flex-direction:column;overflow-y:auto}.sidebar.open[data-v-15998e9f]{left:0 /* Slide in */}.sidebar-header[data-v-15998e9f]{padding:%?40?% %?30?%;border-bottom:%?1?% solid #eee;display:flex;flex-direction:column;align-items:center;margin-top:%?80?%}.sidebar-avatar[data-v-15998e9f]{width:%?120?%;height:%?120?%;border-radius:50%;margin-bottom:%?20?%}.sidebar-nickname[data-v-15998e9f]{font-size:%?32?%;font-weight:700}.sidebar-menu[data-v-15998e9f]{margin-top:%?40?%}.sidebar-item[data-v-15998e9f]{padding:%?30?%;border-bottom:%?1?% solid #f0f0f0;font-size:%?32?%;color:#333;position:relative;display:flex;justify-content:space-between;align-items:center}.sidebar-item[data-v-15998e9f]:active{background-color:#f5f5f5}\r\n/* 未读消息标记 */.unread-badge[data-v-15998e9f]{background-color:#ff6b6b;color:#fff;font-size:%?20?%;padding:%?4?% %?10?%;border-radius:%?20?%;min-width:%?32?%;text-align:center;font-weight:700}\r\n/* 退出登录按钮特殊样式 */.logout-item[data-v-15998e9f]{border-top:%?2?% solid #f0f0f0;margin-top:%?20?%;color:#ff6b6b!important;font-weight:500}.logout-item[data-v-15998e9f]:active{background-color:#fff5f5!important}.main-content[data-v-15998e9f]{width:100%;\r\n    /* height: 100vh; */background-color:#fff;\r\n    /* overflow-y: auto; */padding-bottom:%?100?% /* 为底部TabBar留出空间 */}.header[data-v-15998e9f]{display:flex;align-items:center;padding:%?20?% %?30?%;background-color:#fff;border-bottom:%?1?% solid #eee;padding-top:calc(%?20?% + 0px)}.menu-btn[data-v-15998e9f]{width:%?48?%;height:%?48?%;padding:%?10?%;transition:opacity .2s ease}.menu-btn[data-v-15998e9f]:active{opacity:.7}.header-title[data-v-15998e9f]{flex:1;text-align:center;font-size:%?34?%;font-weight:500;margin-right:%?68?% /* to balance the menu button */}\r\n/* Loading State */.loading-container[data-v-15998e9f]{display:flex;justify-content:center;align-items:center;height:%?400?%;background-color:#fff;border-radius:%?16?%;margin:%?30?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.loading-text[data-v-15998e9f]{font-size:%?28?%;color:#999}\r\n/* User Profile Card */.profile-card[data-v-15998e9f]{margin:%?30?%;padding:%?40?%;background-color:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);display:flex;align-items:flex-start;transition:box-shadow .2s ease}.profile-card[data-v-15998e9f]:active{box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1)}.profile-avatar[data-v-15998e9f]{margin-right:%?30?%}.profile-avatar uni-image[data-v-15998e9f]{width:%?120?%;height:%?120?%;border-radius:50%}.profile-info[data-v-15998e9f]{flex:1;display:flex;flex-direction:column;min-width:0 /* 防止flex子元素溢出 */}.profile-name[data-v-15998e9f]{font-size:%?36?%;font-weight:700;color:#333;margin-bottom:%?10?%;word-break:break-word;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.profile-bio[data-v-15998e9f]{font-size:%?28?%;color:#999;margin-bottom:%?20?%;line-height:1.4;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}.profile-details[data-v-15998e9f]{display:flex;flex-direction:column;gap:%?8?%}.detail-item[data-v-15998e9f]{font-size:%?26?%;color:#666;word-break:break-word;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}\r\n/* Tab Navigation */.tab-navigation[data-v-15998e9f]{margin:0 %?30?% %?20?% %?30?%;display:flex;background:#fff;border:%?1?% solid #fff;border-radius:%?16?%;overflow:hidden}.tab-item[data-v-15998e9f]{flex:1;padding:%?20?% %?10?%;text-align:center;background:#fff;transition:all .3s ease;position:relative;display:flex;align-items:center;justify-content:center}.tab-item.active[data-v-15998e9f]::after{content:"";position:absolute;bottom:%?8?%;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);width:%?200?%;height:%?6?%;background:#333;border-radius:%?3?%}.tab-item[data-v-15998e9f]:active{background:#f5f5f5}.tab-icon[data-v-15998e9f]{width:%?110?%;height:%?110?%;-webkit-filter:grayscale(1) brightness(.5);filter:grayscale(1) brightness(.5);opacity:.7}.tab-item.active .tab-icon[data-v-15998e9f]{-webkit-filter:grayscale(0) brightness(1);filter:grayscale(0) brightness(1);opacity:1}\r\n/* My Posts Section */.my-posts-section[data-v-15998e9f]{margin:0 0 %?30?% 0}\r\n/* Portfolio Section */.portfolio-section[data-v-15998e9f]{margin:0 0 %?30?% 0}\r\n/* Favorites Section */.favorites-section[data-v-15998e9f]{margin:0 0 %?30?% 0}.section-title[data-v-15998e9f]{font-size:%?32?%;font-weight:700;color:#333;margin-bottom:%?20?%;padding:0 %?10?%}\r\n/* 新增：帖子项包装器样式 */.post-item-wrapper[data-v-15998e9f]{background:#fff;margin-bottom:%?20?%;padding:0;box-shadow:none;border-radius:0;border-bottom:%?1?% solid #f0f0f0}\r\n/* 原创帖子特殊样式 */.post-item-wrapper.original-post[data-v-15998e9f]{background:linear-gradient(90deg,rgba(235,200,141,.05),hsla(0,0%,100%,0));border-left:%?3?% solid #ebc88d;position:relative}\r\n/* 新增：内容导航器样式 */.post-content-navigator[data-v-15998e9f]{display:block;background:transparent}\r\n/* 新增：导航器点击效果 */.navigator-hover[data-v-15998e9f]{background-color:rgba(0,0,0,.02)}\r\n/* 新增：点赞按钮容器样式 */.like-btn-container[data-v-15998e9f]{position:absolute;top:%?20?%;right:%?20?%;z-index:10}.like-btn[data-v-15998e9f]{width:%?60?%;height:%?60?%;background:hsla(0,0%,100%,.9);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1);transition:all .2s ease}.like-btn[data-v-15998e9f]:active{-webkit-transform:scale(.9);transform:scale(.9)}.like-icon[data-v-15998e9f]{font-size:%?24?%;color:#666}.like-icon.liked[data-v-15998e9f]{color:#ff4757}\r\n/* 定义点击时的样式 - 整个卡片缩小 */.post-card-active[data-v-15998e9f]{-webkit-transform:scale(.98);transform:scale(.98)}\r\n/* 外部作者信息样式 */.author-info-outside[data-v-15998e9f]{display:flex;align-items:center;padding:%?20?% %?40?% %?10?% %?40?%;background:#fff;border-radius:0;box-shadow:none}.author-info-outside .author-avatar[data-v-15998e9f]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;background-color:#f5f5f5;cursor:pointer}.author-info-outside .author-name[data-v-15998e9f]{font-size:%?28?%;color:#333;font-weight:500}.post-item[data-v-15998e9f]{width:100%;background:#fff;border-radius:0;box-shadow:none;box-sizing:border-box;padding:%?20?% %?40?% %?30?% %?40?%}.post-title[data-v-15998e9f]{font-size:%?36?%;font-weight:700;color:#333;margin-bottom:%?15?%;line-height:1.4;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}\r\n/* 诗歌作者样式 */.poem-author[data-v-15998e9f]{font-size:%?32?%;color:#000;text-align:center;margin:%?5?% 0 %?15?% 0;letter-spacing:%?2?%}\r\n/* 新增：图片容器占位样式 */.image-container-wrapper[data-v-15998e9f]{position:relative;width:100%;background-color:#f0f0f0; /* 占位时的背景色，很重要 */overflow:hidden;border-radius:8px; /* 可以加个圆角，让占位块更好看 */margin:%?20?% 0 /* 图片和下方内容的间距 */}\r\n/* 新增：让图片或swiper填充整个占位容器 */.image-container-wrapper .post-image[data-v-15998e9f],\r\n.image-container-wrapper .image-swiper[data-v-15998e9f]{position:absolute;top:0;left:0;width:100%;height:100%}\r\n/* 多张图片的swiper样式 */.image-swiper[data-v-15998e9f]{width:100%;background-color:#fff\r\n    /* 高度由 style 绑定动态设置 */}.swiper-item[data-v-15998e9f]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.post-image[data-v-15998e9f]{width:100%;height:100%;display:block;object-fit:contain}.post-image[data-v-15998e9f]:active{-webkit-transform:scale(1.05);transform:scale(1.05)}.post-image.single-image[data-v-15998e9f]{width:100%;height:auto;display:block;object-fit:cover}\r\n/* 图片数量指示器 */.image-count-indicator[data-v-15998e9f]{position:absolute;top:%?20?%;right:%?20?%;background:rgba(0,0,0,.6);color:#fff;padding:%?8?% %?12?%;border-radius:%?20?%;font-size:%?24?%;z-index:5}.post-content[data-v-15998e9f]{font-size:%?28?%;color:#666;line-height:1.6;margin-top:%?15?%;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;line-clamp:3;-webkit-box-orient:vertical}\r\n/* 删除按钮区域样式 */.delete-section[data-v-15998e9f]{display:flex;justify-content:space-between;align-items:center;margin-top:%?20?%;padding:0 %?40?% 0 %?40?%}\r\n/* 左侧时间区域，保持原有样式 */.time-left[data-v-15998e9f]{flex:1}.button-group[data-v-15998e9f]{display:flex;align-items:center}.favorite-time[data-v-15998e9f],\r\n.post-time[data-v-15998e9f]{font-size:%?24?%;color:#999}\r\n/* 标签样式 */.post-tags[data-v-15998e9f]{margin-top:%?30?%;margin-bottom:%?10?%;line-height:1.5}.post-tag[data-v-15998e9f]{color:#24375f;font-size:%?26?%;margin-right:%?10?%;transition:all .2s ease;cursor:pointer}.post-tag[data-v-15998e9f]:active{color:#1a2a4a;opacity:.8}.delete-btn[data-v-15998e9f]{display:flex;align-items:center;justify-content:center;transition:all .2s ease;cursor:pointer;padding:%?10?%}.delete-btn[data-v-15998e9f]:active{-webkit-transform:scale(.9);transform:scale(.9)}.delete-icon[data-v-15998e9f]{width:%?100?%;height:%?100?%}.remove-favorite-btn[data-v-15998e9f]{background-color:#f39c12;color:#fff;border:none;border-radius:%?8?%;font-size:%?24?%;padding:%?8?% %?16?%;line-height:1.2;min-width:%?100?%;transition:background-color .2s ease}.remove-favorite-btn[data-v-15998e9f]:active{background-color:#e67e22}.remove-favorite-btn[data-v-15998e9f]::after{border:none}.empty-tip[data-v-15998e9f]{text-align:center;color:#bbb;font-size:%?28?%;margin:%?40?% 0;padding:%?60?% 0;background-color:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.author-info[data-v-15998e9f]{display:flex;align-items:center\r\n    /* margin-bottom: 15rpx;  // 移除多余的间距 */}.author-avatar[data-v-15998e9f]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;background-color:#f5f5f5}.author-name[data-v-15998e9f]{font-size:%?28?%;color:#333;font-weight:500}.profile-card-center[data-v-15998e9f]{position:relative;margin:0;padding:%?40?% %?40?% %?20?% %?40?%;background-color:initial;border-radius:0;box-shadow:none;display:flex;flex-direction:column;align-items:center;overflow:visible}.menu-btn-small[data-v-15998e9f]{width:%?40?%;height:%?40?%;cursor:pointer;transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease;-webkit-filter:grayscale(1) brightness(.5);filter:grayscale(1) brightness(.5);opacity:.7}.menu-btn-small[data-v-15998e9f]:active{-webkit-transform:scale(.9);transform:scale(.9)}.back-btn[data-v-15998e9f]{position:absolute;top:%?24?%;left:%?24?%;width:%?56?%;height:%?56?%;z-index:100;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.1);border-radius:50%;font-size:%?36?%;color:#333;transition:background-color .2s ease}.back-btn[data-v-15998e9f]:active{background:rgba(0,0,0,.2)}.profile-avatar-large[data-v-15998e9f]{display:flex;justify-content:center;align-items:center;margin:%?70?% 0 %?40?% 0}.profile-avatar-large uni-image[data-v-15998e9f]{width:%?175?%;height:%?175?%;border-radius:50%;display:block}.profile-info-center[data-v-15998e9f]{display:flex;flex-direction:column;align-items:flex-start;margin-top:%?20?%;width:100%}.profile-name-center[data-v-15998e9f]{font-family:Inter,sans-serif;font-weight:600;font-size:%?30?%;line-height:%?36?%;color:#000;margin-bottom:%?20?%;text-align:left}.profile-poemid[data-v-15998e9f]{font-family:Inter,sans-serif;font-weight:300;font-size:%?20?%;line-height:%?24?%;color:#989090;margin-bottom:%?20?%}.profile-bio-center[data-v-15998e9f]{font-family:Inter,sans-serif;font-weight:600;font-size:%?24?%;line-height:%?30?%;color:#000;text-align:left;margin-bottom:%?20?%}.profile-bottom-row[data-v-15998e9f]{display:flex;justify-content:space-between;align-items:center;width:100%;margin-bottom:%?10?%}.profile-buttons[data-v-15998e9f]{display:flex;align-items:center;gap:%?20?%}.profile-followers[data-v-15998e9f]{font-family:Inter,sans-serif;font-weight:300;font-size:%?24?%;line-height:%?30?%;color:#989090;margin:0}.edit-profile-btn[data-v-15998e9f]{position:relative;width:%?246?%;height:%?54?%;background:#d9d9d9;border-radius:%?10?%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .2s ease}.edit-profile-btn[data-v-15998e9f]:active{background-color:silver}.edit-profile-btn uni-text[data-v-15998e9f]{font-family:Inter,sans-serif;font-weight:800;font-size:%?28?%;line-height:%?34?%;color:#fff}.profile-meta-center[data-v-15998e9f]{font-size:%?26?%;color:#666;margin-top:%?8?%;text-align:center}.profile-detail-card[data-v-15998e9f]{margin:0 %?30?% %?30?% %?30?%;padding:%?30?% %?40?%;background-color:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);display:flex;flex-direction:row;align-items:center;justify-content:center;gap:%?40?%}.detail-item-inline[data-v-15998e9f]{font-size:%?28?%;color:#666;margin-right:%?20?%;white-space:nowrap}\r\n/* 底部加载状态样式 */.loading-footer[data-v-15998e9f]{text-align:center;padding:%?20?% 0;color:#999;font-size:14px}.unread-dot[data-v-15998e9f]{width:%?16?%;height:%?16?%;background-color:#ff6b6b;border-radius:50%;margin-left:%?12?%}\r\n/* Follow stats under bio */.follow-stats[data-v-15998e9f]{margin-top:%?16?%;display:flex;align-items:center;justify-content:center;gap:%?40?%}.stat-item[data-v-15998e9f]{display:flex;flex-direction:column;align-items:center}.stat-number[data-v-15998e9f]{font-size:%?36?%;font-weight:600;color:#333}.stat-label[data-v-15998e9f]{margin-top:%?4?%;font-size:%?24?%;color:#888}.stat-divider[data-v-15998e9f]{width:%?1?%;height:%?36?%;background-color:#eee}',""]),n.exports=e},c03a:function(n,e,r){"use strict";r("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={data:function(){return{}},props:{},methods:{},created:function(){}}},d189:function(n,e,r){var t=r("e2db"),a=r("2774"),o=r("79b7"),i=r("9376");n.exports=function(n){return t(n)||a(n)||o(n)||i()},n.exports.__esModule=!0,n.exports["default"]=n.exports},d1b0:function(n,e,r){var t=r("c86c");e=t(!1),e.push([n.i,".tab-bar[data-v-846b9078]{position:fixed;bottom:0;left:0;width:100%;height:%?120?%;display:flex;align-items:center;justify-content:space-around;z-index:1000;background:#fff}.tab-bar-item[data-v-846b9078]{display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;height:100%}.icon-wrap[data-v-846b9078]{width:%?88?%;height:%?88?%;border-radius:%?24?%;background:#f8f8f8;overflow:hidden;box-shadow:0 %?18?% %?32?% rgba(0,0,0,.16);transition:box-shadow .22s ease}.icon-wrap.pressed[data-v-846b9078]{box-shadow:0 %?6?% %?12?% rgba(0,0,0,.08)}.icon-inner[data-v-846b9078]{width:100%;height:100%;background:#fff;box-shadow:none;transition:box-shadow .22s ease,-webkit-transform .22s ease;transition:transform .22s ease,box-shadow .22s ease;transition:transform .22s ease,box-shadow .22s ease,-webkit-transform .22s ease}.icon-inner.active[data-v-846b9078]{box-shadow:inset 0 %?10?% %?20?% rgba(0,0,0,.22);-webkit-transform:translateY(%?3?%) scale(.97);transform:translateY(%?3?%) scale(.97)}.icon-img[data-v-846b9078]{width:100%;height:100%;display:block}.tab-bar-text[data-v-846b9078]{font-size:%?22?%;color:transparent;height:0;overflow:hidden}",""]),n.exports=e},d2dd:function(n,e,r){"use strict";r("6a54");var t=r("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=t(r("2634")),o=t(r("2fdc")),i=t(r("5de6")),s=t(r("39d8"));r("bf0f"),r("fd3c"),r("2797"),r("c223"),r("8f71"),r("bd06"),r("9db6"),r("18f7"),r("de6c");var l=t(r("724b")),c=r("b577"),d=r("7a3b"),u=(getApp(),r("962f")),f=u.formatRelativeTime,g=r("edf3"),v=g.previewImage,p=r("38db"),h=p.cloudCall,m=r("9c8b"),b={components:{AppTabBar:l.default},mixins:[m],data:function(){return{isLoading:!0,userInfo:{avatarUrl:"",nickName:"",bio:"",birthday:!1,age:!1},isSidebarOpen:!1,myPosts:[],page:0,hasMore:!0,PAGE_SIZE:5,swiperHeights:{},imageClampHeights:{},hasFirstShow_var:!1,unreadCount:0,currentTab:"posts",favoriteList:[],favoritePage:0,favoriteHasMore:!0,favoriteLoading:!1,currentUserOpenid:"",isAdmin:!1,swiperFixedHeight:"",selected:0,newFollowerCount:"",isLoadingMore:!1,isViewingSelf:!1,imgindex:0,img:"",followingCount:0,followerCount:0}},onLoad:function(n){var e=uni.getSystemInfoSync().windowWidth,r=Math.round(4*e/3);this.setData({swiperFixedHeight:r}),this.getProfileData()},onShow:function(){try{uni.hideTabBar({animation:!1})}catch(t){}try{this.$refs.customTabBar&&this.$refs.customTabBar.syncSelected&&this.$refs.customTabBar.syncSelected()}catch(t){}var n=r("26a8"),e=n.updateTabBarStatus;e(this,3),this._hasFirstShow?(console.log("【profile】onShow触发,开始刷新数据"),this.refreshProfileData()):(console.log("【profile】首次显示,标记已显示"),this.setData({hasFirstShow_var:!0}))},onPullDownRefresh:function(){var n=this;console.log("【profile】⬇️ ⬇️ ⬇️ 下拉刷新触发！"),console.log("【profile】📊 当前标签:",this.currentTab),console.log("【profile】📋 刷新前myPosts长度:",this.myPosts.length),console.log("【profile】📋 刷新前favoriteList长度:",this.favoriteList.length),"posts"===this.currentTab?(console.log("【profile】🔄 重置帖子数据状态"),this.setData({myPosts:[],page:0,hasMore:!0,swiperHeights:{},imageClampHeights:{}}),console.log("【profile】🔄 开始加载帖子数据（强制云端）"),this.loadMyPosts((function(){console.log("【profile】✅ 下拉刷新完成，停止刷新动画"),console.log("【profile】📊 刷新后myPosts长度:",n.myPosts.length),uni.stopPullDownRefresh()}),!0)):"favorites"===this.currentTab&&(console.log("【profile】🔄 重置收藏数据状态"),this.setData({favoriteList:[],favoritePage:0,favoriteHasMore:!0,swiperHeights:{},imageClampHeights:{}}),console.log("【profile】🔄 开始加载收藏数据"),this.loadFavorites((function(){console.log("【profile】✅ 收藏下拉刷新完成，停止刷新动画"),console.log("【profile】📊 刷新后favoriteList长度:",n.favoriteList.length),uni.stopPullDownRefresh()})))},onReachBottom:function(){if(console.log("【profile】触底加载触发, currentTab:",this.currentTab),"posts"===this.currentTab){if(console.log("【profile】触底加载我的帖子, hasMore:",this.hasMore,"isLoading:",this.isLoading,"当前页:",this.page),!this.hasMore||this.isLoading)return;this.loadMyPosts()}else if("favorites"===this.currentTab){if(console.log("【profile】触底加载收藏, favoriteHasMore:",this.favoriteHasMore,"favoriteLoading:",this.favoriteLoading),!this.favoriteHasMore||this.favoriteLoading)return;this.loadFavorites()}},methods:{getProfileData:function(){this.checkLoginAndFetchData()},invalidateProfileCacheAndReload:function(){console.log("【profile】🧹 开始清除个人主页缓存"),console.log("【profile】📊 当前标签页:",this.currentTab),console.log("【profile】📋 当前myPosts长度:",this.myPosts.length);try{console.log("【profile】🗑️ 调用invalidateMyPosts()"),(0,c.invalidateMyPosts)(),console.log("【profile】🗑️ 调用invalidateMyInfo()"),(0,c.invalidateMyInfo)(),"favorites"===this.currentTab&&(console.log("【profile】🗑️ 调用invalidateMyFavorites()"),(0,c.invalidateMyFavorites)()),console.log("【profile】✅ 个人主页缓存清除完成"),console.log("【profile】🔍 缓存清除后myPosts长度:",this.myPosts.length)}catch(n){console.warn("【profile】❌ 清除缓存失败:",n)}},refreshProfileData:function(){console.log("【profile】🔄 开始刷新个人资料数据，当前标签:",this.currentTab);var n=uni.getStorageSync("shouldRefreshIndex"),e=uni.getStorageSync("shouldRefreshProfile"),r=uni.getStorageSync("shouldRefreshPoem"),t=uni.getStorageSync("shouldRefreshMountain");console.log("【profile】🔍 检查刷新标记:",{shouldRefreshIndex:n,shouldRefreshProfile:e,shouldRefreshPoem:r,shouldRefreshMountain:t}),n||e||r||t?(console.log("【profile】✅ 检测到需要刷新标记，开始刷新个人主页数据"),uni.removeStorageSync("shouldRefreshIndex"),uni.removeStorageSync("shouldRefreshProfile"),uni.removeStorageSync("shouldRefreshPoem"),uni.removeStorageSync("shouldRefreshMountain"),console.log("【profile】🗑️ 已清除所有刷新标记"),this.invalidateProfileCacheAndReload()):console.log("【profile】⏭️ 无刷新标记，跳过缓存清理"),this.userInfo&&this.userInfo._openid&&(this.fetchUserProfileFast(),this.fetchFollowCounts()),"posts"===this.currentTab?(this.setData({myPosts:[],page:0,hasMore:!0,swiperHeights:{},imageClampHeights:{}}),this.loadMyPosts((function(){console.log("【profile】🔄 onShow刷新帖子数据完成（强制云端）")}),!0)):"favorites"===this.currentTab&&(this.setData({favoriteList:[],favoritePage:0,favoriteHasMore:!0,swiperHeights:{},imageClampHeights:{}}),this.loadFavorites((function(){console.log("【profile】🔄 onShow刷新收藏数据完成")}))),this.checkUnreadMessages();try{this.fetchFollowCounts&&this.fetchFollowCounts()}catch(a){}},forceRefresh:function(){console.log("强制刷新数据"),this.setData({userInfo:{},myPosts:[],isLoading:!0,swiperHeights:{},imageClampHeights:{}}),this.checkLoginAndFetchData()},checkLoginAndFetchData:function(){var n=this;if(!this._cacheEventsBound){this._cacheEventsBound=!0;try{uni.$on&&uni.$on("avatar-updated",(function(e){var r=getApp(),t=r&&r.globalData&&r.globalData.openid;e&&e.userId===t&&((0,c.invalidateMyInfo)(),(0,c.getMyInfo)(n).then((function(e){return n.setData({userInfo:e||{}})})).catch((function(){})))})),uni.$on&&uni.$on("post-created",(function(e){var r=getApp(),t=r&&r.globalData&&r.globalData.openid;e&&e.userId===t&&((0,c.invalidateMyPosts)(),n.setData({myPosts:[],page:0,hasMore:!0}),n.loadMyPosts())})),uni.$on&&uni.$on("favorite-changed",(function(e){var r=getApp(),t=r&&r.globalData&&r.globalData.openid;e&&e.userId===t&&((0,c.invalidateMyFavorites)(),"favorites"===n.currentTab&&(n.setData({favoriteList:[],favoritePage:0,favoriteHasMore:!0}),n.loadFavorites()))}))}catch(a){}}var e=getApp(),r=e.globalData&&e.globalData.userInfo,t=e.globalData&&e.globalData._loginProcessCompleted;console.log("🔍 [profile] 检查登录状态:",{hasUserInfo:!!r,hasOpenid:!(!r||!r._openid),loginProcessCompleted:t}),r&&r._openid?(this.fetchUserProfileFast(),this.loadMyPosts()):t?(this.setData({isLoading:!1}),console.log("⚠️ [profile] 登录流程已完成但无用户信息，用户未登录")):(console.log("⏳ [profile] 登录流程未完成，等待中..."),this.waitForLoginProcess())},waitForLoginProcess:function(){var n=this,e=setInterval((function(){var r=getApp(),t=r.globalData&&r.globalData._loginProcessCompleted;t&&(clearInterval(e),console.log("✅ [profile] 登录流程已完成，重新检查登录状态"),n.checkLoginAndFetchData())}),100);setTimeout((function(){clearInterval(e),console.log("⚠️ [profile] 等待登录流程超时，继续执行"),n.checkLoginAndFetchData()}),5e3)},fetchUserProfileFast:function(){var n=this;(0,c.getMyInfo)(this).then((function(e){e&&e.birthday?e.age=n.calculateAge(e.birthday):e&&(e.age=""),n.setData({userInfo:e||{},isLoading:!1})})).catch((function(e){console.error("获取用户资料失败（缓存封装）:",e),n.setData({isLoading:!1});var r=uni.getStorageSync("userInfo");r?(r.birthday&&(r.age=n.calculateAge(r.birthday)),n.setData({userInfo:r})):uni.showToast({title:"获取数据失败",icon:"none"})}))},loadMyPosts:function(n){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=this.page,a=this.PAGE_SIZE;console.log("【profile】🔍 开始loadMyPosts, 页面信息:",{page:t,PAGE_SIZE:a,skip:t*a,limit:a,isPullDownRefresh:0===t,forceRefresh:r,currentMyPostsLength:this.myPosts.length}),0===t&&(console.log("【profile】📱 重置数据状态",r?"(强制刷新模式)":"(正常模式)"),this.setData({isLoading:!0}));var o=getApp(),i=o&&o.globalData&&o.globalData.openid;if(console.log("【profile】👤 当前用户openid:",i),0===t||r)return console.log("【profile】🔥 下拉刷新/强制刷新，直接从云端获取最新数据"),this.loadMyPostsDirectly(t,a,i,n);console.log("【profile】🚀 使用缓存API获取帖子（分页加载）");try{return(0,c.getMyPosts)({page:t,pageSize:a,context:this}).then((function(n){console.log("【profile】✅ 缓存API成功返回帖子数量:",n.length),console.log("【profile】📋 缓存API返回的帖子ID列表:",n.map((function(n){return n._id}))),n.forEach((function(n,r){n.createTime&&(n.formattedCreateTime=e.formatTime(n.createTime)),n.imageUrls&&n.imageUrls.length>0&&(n.imageStyle="height: 0; padding-bottom: 75%;"),console.log("【profile】📝 缓存帖子".concat(r+1,":"),{id:n._id,title:n.title,createTime:n.createTime,formattedTime:n.formattedCreateTime})}));var r=0===t?n:e.myPosts.concat(n);return console.log("【profile】📊 缓存API更新myPosts数据:",{beforeLength:e.myPosts.length,afterLength:r.length,page:t+1,hasMore:n.length===a}),e.setData({myPosts:r,page:t+1,hasMore:n.length===a}),console.log("【profile】✅ 缓存API加载完成"),n})).catch((function(r){return console.error("【profile】❌ 缓存API获取帖子失败，回退到云函数:",r),e.loadMyPostsDirectly(t,a,i,n)})).finally((function(){e.setData({isLoading:!1}),"function"===typeof n&&(console.log("【profile】🎯 缓存API loadMyPosts完成，调用回调"),n())}))}catch(s){return console.error("【profile】❌ 缓存API调用异常，回退到云函数:",s),this.loadMyPostsDirectly(t,a,i,n)}},loadMyPostsDirectly:function(n,e,r,t){var a=this;console.log("【profile】🔥 直接调用云函数getMyProfileData"),console.log("【profile】📤 云函数参数:",{name:"getMyProfileData",data:{skip:n*e,limit:e,openid:r}}),this.$tcb.callFunction({name:"getMyProfileData",data:{skip:n*e,limit:e,openid:r}}).then((function(r){if(console.log("【profile】📥 云函数返回完整响应:",r),r.result&&r.result.success){var t=r.result.posts||[];console.log("【profile】✅ 云函数成功返回帖子数量:",t.length),console.log("【profile】📋 云函数返回的帖子ID列表:",t.map((function(n){return n._id}))),t.forEach((function(n,e){n.createTime&&(n.formattedCreateTime=a.formatTime(n.createTime)),n.imageUrls&&n.imageUrls.length>0&&(n.imageStyle="height: 0; padding-bottom: 75%;"),console.log("【profile】📝 云函数帖子".concat(e+1,":"),{id:n._id,title:n.title,createTime:n.createTime,formattedTime:n.formattedCreateTime})}));var o=0===n?t:a.myPosts.concat(t);console.log("【profile】📊 云函数更新myPosts数据:",{beforeLength:a.myPosts.length,afterLength:o.length,page:n+1,hasMore:t.length===e}),a.setData({myPosts:o,page:n+1,hasMore:t.length===e})}else{var i;console.error("【profile】❌ 云函数返回失败:",r.result),uni.showToast({title:(null===(i=r.result)||void 0===i?void 0:i.message)||"获取数据失败",icon:"none"})}})).catch((function(n){console.error("【profile】❌ 云函数调用失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){a.setData({isLoading:!1}),"function"===typeof t&&(console.log("【profile】🎯 云函数loadMyPosts完成，调用回调"),t())}))},calculateAge:function(n){if(!n)return"";try{var e=new Date(n);if(isNaN(e.getTime()))return"";var r=new Date,t=r.getFullYear()-e.getFullYear(),a=r.getMonth()-e.getMonth();return(a<0||0===a&&r.getDate()<e.getDate())&&t--,t>0?t:""}catch(o){return console.log("CatchClause",o),console.log("CatchClause",o),console.error("计算年龄失败:",o),""}},formatTime:function(n){return f(n)},navigateToPostDetail:function(n){var e=n.currentTarget.dataset.id;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(e)})},onDelete:function(n){var e=n.currentTarget.dataset.postid,r=n.currentTarget.dataset.index,t=this;uni.showModal({title:"删除帖子",content:"您确定要删除这条帖子吗？",confirmText:"删除",cancelText:"保存草稿",confirmColor:"#ff4d4f",success:function(n){n.confirm?t.deletePost(e,r):t.saveToDraftBox(e,r)}})},deletePost:function(n,e){var r=this;uni.showLoading({title:"删除中..."}),this.$tcb.callFunction({name:"deletePost",data:{postId:n}}).then((function(e){if(uni.hideLoading(),e.result&&e.result.success){uni.showToast({title:"删除成功"});var t=r.myPosts.filter((function(e){return e._id!==n}));r.setData({myPosts:t});try{uni.setStorageSync("shouldRefreshIndex",!0)}catch(a){console.log("CatchClause",a),console.log("CatchClause",a)}}else uni.showToast({title:"删除失败",icon:"none"})})).catch((function(n){uni.hideLoading(),uni.showToast({title:"调用失败",icon:"none"})}))},saveToDraftBox:function(n,e){var r=this,t=this;uni.showLoading({title:"保存中..."}),this.$tcb.callFunction({name:"getPostDetail",data:{postId:n}}).then((function(n){if(n.result&&n.result.post){var e=n.result.post,t={title:e.title||"",content:e.content||"",imageList:e.imageUrls?e.imageUrls.map((function(n){return{previewUrl:n,compressedPath:n,originalPath:n,needCompression:!1}})):[],publishMode:e.isPoem?"poem":"normal",isOriginal:e.isOriginal||!1,selectedTags:e.tags||[],customTag:"",author:e.author||"",saveTime:new Date},a=getApp(),o=a&&a.globalData&&a.globalData.openid;return r.$tcb.callFunction({name:"getMyProfileData",data:{action:"saveDraft",draftData:t,openid:o}})}return uni.hideLoading(),uni.showToast({title:"获取帖子信息失败",icon:"none"}),Promise.reject("获取帖子信息失败")})).then((function(r){var a;(uni.hideLoading(),r.result&&r.result.success)?(uni.showToast({title:"已保存到草稿箱",icon:"success"}),t.deletePost(n,e)):uni.showToast({title:(null===(a=r.result)||void 0===a?void 0:a.message)||"保存草稿失败",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("保存草稿失败:",n),uni.showToast({title:"保存草稿失败",icon:"none"})}))},updatePostCommentCount:function(n,e){var r=this.myPosts.findIndex((function(e){return e._id===n}));r>-1&&this.setData((0,s.default)({},"myPosts[".concat(r,"].commentCount"),e))},handlePreview:function(n){return v(n)},stopPropagation:function(){},onAvatarError:function(n){console.error("头像加载失败:",n)},onImageError:function(n){console.error("图片加载失败:",n.detail);var e=n.detail.src;console.error("失败的图片URL:",e);var r=n.currentTarget.dataset,t=r.postindex,a=r.imgindex;if(void 0!==t&&void 0!==a){var o=this.myPosts[t];console.error("图片加载失败的上下文:",{postId:o?o._id:"unknown",postTitle:o?o.title:"unknown",imageIndex:a,imageUrl:e})}console.error("图片加载失败详情:",{error:n.detail,src:e,dataset:n.currentTarget.dataset})},testImageUrls:function(){console.log("=== 开始测试图片URL有效性 ==="),this.myPosts.forEach((function(n,e){console.log("帖子".concat(e+1," (").concat(n._id,"):")),console.log("  - 标题:",n.title),console.log("  - 作者头像:",n.authorAvatar),console.log("  - 图片URLs:",n.imageUrls),console.log("  - 原图URLs:",n.originalImageUrls),n.imageUrls&&n.imageUrls.length>0?n.imageUrls.forEach((function(n,e){console.log("  - 图片".concat(e+1,":"),n),n&&n.startsWith("http")?console.log("    ✅ 格式正确 (HTTP URL)"):n&&n.startsWith("cloud://")?console.log("    ⚠️ 格式为cloud:// (需要转换)"):n?console.log("    ? 未知格式: ".concat(n)):console.log("    ❌ URL为空")})):console.log("  - 无图片"),console.log("---")})),console.log("=== 图片URL测试完成 ===")},toggleSidebar:function(){this.setData({isSidebarOpen:!this.isSidebarOpen})},navigateToMyLikes:function(){uni.navigateTo({url:"/pages/my-likes/my-likes"})},navigateToFollowing:function(){uni.navigateTo({url:"/pages/following/following"})},navigateToFans:function(){uni.navigateTo({url:"/pages/fans/fans"})},navigateToEditProfile:function(){uni.navigateTo({url:"/pages/profile-edit/profile-edit"})},navigateToFavoriteFolders:function(){uni.navigateTo({url:"/pages/favorite-folders/favorite-folders"})},navigateToPortfolio:function(){uni.navigateTo({url:"/pages/portfolio/portfolio"})},navigateToDraftBox:function(){uni.navigateTo({url:"/pages/draft-box/draft-box"})},navigateToMessages:function(){uni.navigateTo({url:"/pages/messages/messages"})},checkUnreadMessages:function(){var n=this;this.$tcb.callFunction({name:"getUnreadMessageCount"}).then((function(e){e.result&&e.result.success&&n.setData({unreadCount:e.result.count||0})})).catch((function(n){console.error("获取未读消息失败:",n)})),this.$tcb.callFunction({name:"follow",data:{action:"getNewFollowerCount"}}).then((function(e){e.result&&e.result.success&&n.setData({newFollowerCount:e.result.count||0})})).catch((function(n){console.error("获取新粉丝数量失败:",n)}))},fetchFollowCounts:function(){var n=this;try{var e=this.$tcb.callFunction({name:"follow",data:{action:"getFollowingList",skip:0,limit:1}}),r=this.$tcb.callFunction({name:"follow",data:{action:"getFollowerList",skip:0,limit:1}});Promise.all([e,r]).then((function(e){var r=(0,i.default)(e,2),t=r[0],a=r[1],o=t&&t.result&&t.result.total||0,s=a&&a.result&&a.result.total||0;n.setData({followingCount:o,followerCount:s})})).catch((function(n){console.error("fetch follow stats failed:",n)}))}catch(t){console.error("fetchFollowCounts error:",t)}},switchTab:function(n){var e=n.currentTarget.dataset.tab;console.log("【profile】切换到标签:",e),e!==this.currentTab&&(this.setData({currentTab:e}),"favorites"===e&&0===this.favoriteList.length&&this.loadFavorites())},loadFavorites:function(n){var e=this,r=this.favoritePage,t=this.PAGE_SIZE;console.log("【profile】请求收藏分页参数:",{favoritePage:r,PAGE_SIZE:t,skip:r*t,limit:t}),this.setData({favoriteLoading:!0});try{return(0,c.getMyFavorites)({page:r,pageSize:t,context:this}).then((function(n){(n||[]).forEach((function(n){n.favoriteTime&&(n.formattedFavoriteTime=e.formatTime(n.favoriteTime)),n.imageUrls&&n.imageUrls.length>0&&(n.imageStyle="height: 0; padding-bottom: 75%;")}));var a=0===r?n:e.favoriteList.concat(n||[]);e.setData({favoriteList:a,favoritePage:r+1,favoriteHasMore:(n||[]).length===t})})).catch((function(n){console.error("profile 获取收藏失败:",n),uni.showToast({title:"网络异常",icon:"none"})})).finally((function(){e.setData({favoriteLoading:!1}),"function"===typeof n&&n()}))}catch(i){}var a=getApp(),o=a&&a.globalData&&a.globalData.openid;this.$tcb.callFunction({name:"getMyProfileData",data:{action:"getAllFavorites",skip:r*t,limit:t,openid:o}}).then((function(n){if(console.log("【profile】获取收藏返回:",n),n.result&&n.result.success){var a=n.result.favorites||[];console.log("【profile】本次返回收藏数量:",a.length),a.forEach((function(n){n.favoriteTime&&(n.formattedFavoriteTime=e.formatTime(n.favoriteTime)),n.imageUrls&&n.imageUrls.length>0&&(n.imageStyle="height: 0; padding-bottom: 75%;")}));var o=0===r?a:e.favoriteList.concat(a);console.log("【profile】更新后收藏列表长度:",o.length,"favoriteHasMore:",a.length===t,"favoritePage:",r+1),e.setData({favoriteList:o,favoritePage:r+1,favoriteHasMore:a.length===t})}else{var i;uni.showToast({title:(null===(i=n.result)||void 0===i?void 0:i.message)||"加载收藏失败",icon:"none"})}})).catch((function(n){console.error("【profile】获取收藏失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){e.setData({favoriteLoading:!1}),"function"===typeof n&&n()}))},navigateToFavoriteDetail:function(n){var e=n.currentTarget.dataset.id;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(e)})},removeFavorite:function(n){var e=n.currentTarget.dataset.favoriteId,t=n.currentTarget.dataset.index,a=this;uni.showModal({title:"确认取消收藏",content:"确定要取消收藏这个内容吗？",success:function(o){if(o.confirm){uni.showLoading({title:"取消收藏中..."});var i=getApp(),s=i&&i.globalData&&i.globalData.openid;a.callCloudFunction("getMyProfileData",{action:"removeFromFavorite",favoriteId:e,openid:s}).then((function(e){if(uni.hideLoading(),e.result&&e.result.success){uni.showToast({title:"已取消收藏"});var o=a.favoriteList.filter((function(n,e){return e!==t}));a.setData({favoriteList:o});try{var i=getApp(),s=i&&i.globalData&&i.globalData.openid,l=a.favoriteList[t],c=l&&(l._id||l.postId),d=r("2729"),u=d.emitFavoriteChanged;u({userId:s,postId:c,favored:!1})}catch(n){}}else uni.showToast({title:"取消收藏失败",icon:"none"})})).catch((function(n){uni.hideLoading(),uni.showToast({title:"操作失败",icon:"none"})}))}}})},navigateBack:function(){uni.navigateBack()},navigateToImageManager:function(){uni.navigateTo({url:"/pages/image-manager/image-manager"})},navigateToFeedback:function(){uni.navigateTo({url:"/pages/feedback/feedback"})},navigateToFeedbackAdmin:function(){uni.navigateTo({url:"/pages/feedback-admin/feedback-admin"})},showLogoutConfirm:function(){var n=this;this.isSidebarOpen&&(this.isSidebarOpen=!1),setTimeout((function(){uni.showModal({title:"退出登录",content:"确定要退出登录吗？",confirmText:"退出",cancelText:"取消",confirmColor:"#ff6b6b",success:function(e){e.confirm&&n.performLogout()}})}),100)},performLogout:function(){var n=(0,o.default)((0,a.default)().mark((function n(){var e;return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("🔍 [退出登录] 开始执行退出登录流程"),n.prev=1,n.prev=2,n.next=5,(0,d.resetAllCachesOnAccountChange)({});case 5:n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](2),console.warn("cache reset on logout failed",n.t0);case 10:uni.removeStorageSync("userInfo"),uni.removeStorageSync("userOpenId"),e=getApp(),e&&e.globalData&&(e.globalData.userInfo=null,e.globalData.openid=null,e.globalData._loginProcessCompleted=!1),this.setData({userInfo:null,myPosts:[],favoriteList:[],isLoading:!1,isSidebarOpen:!1}),console.log("✅ [退出登录] 本地数据清除完成"),this.reinitializeAnonymousOpenid(),uni.showToast({title:"已退出登录",icon:"success",duration:1500}),setTimeout((function(){uni.redirectTo({url:"/pages/login/login"})}),1500),n.next=25;break;case 21:n.prev=21,n.t1=n["catch"](1),console.error("❌ [退出登录] 退出登录失败:",n.t1),uni.showToast({title:"退出失败，请重试",icon:"none"});case 25:case"end":return n.stop()}}),n,this,[[1,21],[2,7]])})));return function(){return n.apply(this,arguments)}}(),reinitializeAnonymousOpenid:function(){console.log("🔄 [退出登录] 重新初始化匿名openid"),this.$tcb.callFunction({name:"login"}).then((function(n){console.log("✅ [退出登录] 匿名openid初始化成功:",n);var e=null;if(n.result&&n.result.openid?e=n.result.openid:n.openid?e=n.openid:n.result&&n.result.uid&&(e=n.result.uid),e){var r=getApp();r&&r.globalData&&(r.globalData.openid=e,console.log("✅ [退出登录] 匿名openid已设置:",e)),uni.setStorageSync("userOpenId",e)}else console.error("❌ [退出登录] 无法获取匿名openid")})).catch((function(n){console.error("❌ [退出登录] 匿名openid初始化失败:",n)}))},onScrollToLower:function(){var n=this;console.log("【profile】滚动到底部，当前标签:",this.currentTab),"posts"===this.currentTab?!this.hasMore||this.isLoadingMore||this.isLoading||(console.log("【profile】开始加载更多帖子"),this.setData({isLoadingMore:!0}),this.loadMyPosts((function(){n.setData({isLoadingMore:!1}),console.log("【profile】加载更多帖子完成")}))):"favorites"===this.currentTab&&this.favoriteHasMore&&!this.favoriteLoading&&(console.log("【profile】开始加载更多收藏"),this.loadFavorites((function(){console.log("【profile】加载更多收藏完成")})))},onAvatarLoad:function(){console.log("占位：函数 onAvatarLoad 未声明")},navigateToUserProfile:function(){console.log("占位：函数 navigateToUserProfile 未声明")},onTagClick:function(){console.log("占位：函数 onTagClick 未声明")},callCloudFunction:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h(n,e,Object.assign({pageTag:"profile",context:this,requireAuth:!0},r))}}};e.default=b},db04:function(n,e,r){"use strict";var t=r("bb80"),a=r("c435"),o=r("9e70"),i=r("f298"),s=r("862c"),l=t(i),c=t("".slice),d=Math.ceil,u=function(n){return function(e,r,t){var i,u,f=o(s(e)),g=a(r),v=f.length,p=void 0===t?" ":o(t);return g<=v||""===p?f:(i=g-v,u=l(p,d(i/p.length)),u.length>i&&(u=c(u,0,i)),n?f+u:u+f)}};n.exports={start:u(!1),end:u(!0)}},e2db:function(n,e,r){var t=r("e476");n.exports=function(n){if(Array.isArray(n))return t(n)},n.exports.__esModule=!0,n.exports["default"]=n.exports},edf3:function(n,e,r){function t(n){if(!n)return{current:"",urls:[]};if(n.currentTarget&&n.currentTarget.dataset){var e=n.currentTarget.dataset,r=e.src||e.current||e.url||Array.isArray(e.urls)&&e.urls[0]||"",t=e.originalImageUrls||e.urls||e.urlList,a=Array.isArray(t)?t.filter(Boolean):"string"===typeof t&&t?[t]:[];return{current:r,urls:a}}var o=n.current||n.src||Array.isArray(n.urls)&&n.urls[0]||Array.isArray(n.list)&&n.list[0]||"",i=Array.isArray(n.urls)?n.urls.filter(Boolean):Array.isArray(n.list)?n.list.filter(Boolean):[];return{current:o,urls:i}}function a(n){"undefined"!==typeof uni&&uni.showToast&&uni.showToast({title:n,icon:"none"})}r("8f71"),r("bf0f"),n.exports={previewImage:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.fallbackToast,o=void 0===r||r,i=t(n);if(!i.current&&0===i.urls.length)return o&&a("图片数据缺失"),!1;var s=i.urls.length?i.urls:[i.current],l=i.current||s[0];return l&&0!==s.length?uni.previewImage({current:l,urls:s}):(o&&a("图片不可预览"),!1)}}}}]);