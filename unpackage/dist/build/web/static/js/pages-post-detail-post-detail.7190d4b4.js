(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-post-detail-post-detail"],{"0691":function(n,t,e){"use strict";var o=e("f0b9"),a=e.n(o);a.a},"0f54":function(n,t,e){var o=e("4ea2");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);var a=e("967d").default;a("247b7816",o,!0,{sourceMap:!1,shadowMode:!1})},"0fca":function(n,t,e){"use strict";e.r(t);var o=e("518f"),a=e.n(o);for(var i in o)["default"].indexOf(i)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(i);t["default"]=a.a},"221b":function(n,t,e){var o=e("c86c");t=o(!1),t.push([n.i,".install_tip_back[data-v-a8601b98]{position:fixed;top:0;right:0;bottom:0;left:0;background-color:rgba(0,0,0,.4);z-index:1}.install_tip_close[data-v-a8601b98]{position:absolute;right:%?10?%;top:%?10?%;width:32px;height:32px\n    /* background-color: red; */}.install_tip_detail[data-v-a8601b98]{position:fixed;background-color:#fff;right:0;bottom:0;left:0;border-radius:%?40?% %?40?% 0 0;padding:%?50?% %?50?% %?100?% %?50?%;z-index:9}.install_tip_detail_title[data-v-a8601b98]{font-weight:400;font-size:%?40?%;text-align:center}.install_tip_detail_tip[data-v-a8601b98]{font-size:%?25?%;color:rgba(0,0,0,.4);margin-top:%?20?%;text-align:left}.install_tip_detail_buttons[data-v-a8601b98]{padding-top:%?50?%;display:flex}.install_tip_detail_button[data-v-a8601b98]{color:#07c160;font-weight:500;background-color:rgba(0,0,0,.1);width:40%;text-align:center;\n    /* height: 90rpx; */border-radius:%?10?%;margin:0 auto}.install_tip_detail_button_primary[data-v-a8601b98]{background-color:#07c160;color:#fff}",""]),n.exports=t},"320b":function(n,t,e){"use strict";e.r(t);var o=e("b18e"),a=e("0fca");for(var i in a)["default"].indexOf(i)<0&&function(n){e.d(t,n,(function(){return a[n]}))}(i);e("64ba");var r=e("828b"),s=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,"c749a4a8",null,!1,o["a"],void 0);t["default"]=s.exports},"3b34":function(n,t,e){"use strict";e("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{showTip:!1}},props:{showTipProps:Boolean,title:String,content:String},watch:{showTipProps:function(n){this.setData({showTip:n})}},methods:{onClose:function(){this.setData({showTip:!this.showTip})}},created:function(){}};t.default=o},"3c3d":function(n,t,e){"use strict";e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return a})),e.d(t,"a",(function(){}));var o=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[n.showClone?e("v-uni-view",{staticClass:"modal-overlay"},[e("v-uni-view",{staticClass:"modal-content"},[e("v-uni-view",{staticClass:"modal-header"},[e("v-uni-view",{staticClass:"modal-title"},[n._v("选择收藏夹")]),e("v-uni-view",{staticClass:"close-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.hideModal.apply(void 0,arguments)}}},[n._v("×")])],1),e("v-uni-view",{staticClass:"modal-body"},[n.isLoading?e("v-uni-view",{staticClass:"loading-container"},[e("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1):n.folders.length>0?e("v-uni-view",{staticClass:"folders-list"},n._l(n.folders,(function(t,o){return e("v-uni-view",{key:o,class:"folder-item "+(n.selectedFolderId===t._id?"selected":""),attrs:{"data-folder-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.selectFolder.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"folder-icon"},[n._v("📁")]),e("v-uni-view",{staticClass:"folder-info"},[e("v-uni-view",{staticClass:"folder-name"},[n._v(n._s(t.name))]),e("v-uni-view",{staticClass:"folder-count"},[n._v(n._s(t.itemCount)+" 个收藏")])],1),n.selectedFolderId===t._id?e("v-uni-view",{staticClass:"selected-icon"},[n._v("✓")]):n._e()],1)})),1):e("v-uni-view",{staticClass:"empty-state"},[e("v-uni-view",{staticClass:"empty-icon"},[n._v("📁")]),e("v-uni-view",{staticClass:"empty-text"},[n._v("还没有收藏夹")]),e("v-uni-view",{staticClass:"empty-subtext"},[n._v("先创建一个收藏夹吧")])],1)],1),e("v-uni-view",{staticClass:"modal-footer"},[e("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.createFolder.apply(void 0,arguments)}}},[n._v("创建收藏夹")]),e("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.selectedFolderId},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.confirmFavorite.apply(void 0,arguments)}}},[n._v("确认收藏")])],1)],1)],1):n._e(),n.showCreateModal?e("v-uni-view",{staticClass:"modal-overlay"},[e("v-uni-view",{staticClass:"modal-content create-modal"},[e("v-uni-view",{staticClass:"modal-header"},[e("v-uni-view",{staticClass:"modal-title"},[n._v("创建收藏夹")]),e("v-uni-view",{staticClass:"close-btn",on:{click:[function(t){arguments[0]=t=n.$handleEvent(t),n.hideCreateModal.apply(void 0,arguments)},function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.trueFun.apply(void 0,arguments)}]}},[n._v("×")])],1),e("v-uni-view",{staticClass:"modal-body"},[e("v-uni-input",{staticClass:"folder-name-input",attrs:{placeholder:"请输入收藏夹名称",value:n.newFolderName,focus:!0},on:{input:function(t){arguments[0]=t=n.$handleEvent(t),n.onFolderNameInput.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.trueFun.apply(void 0,arguments)}}})],1),e("v-uni-view",{staticClass:"modal-footer"},[e("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.hideCreateModal.apply(void 0,arguments)}}},[n._v("取消")]),e("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.newFolderName},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.createNewFolder.apply(void 0,arguments)}}},[n._v("创建")])],1)],1)],1):n._e()],1)},a=[]},"3ccb":function(n,t,e){"use strict";e.r(t);var o=e("3b34"),a=e.n(o);for(var i in o)["default"].indexOf(i)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(i);t["default"]=a.a},4238:function(n,t,e){"use strict";var o=e("7292"),a=e.n(o);a.a},"4ea2":function(n,t,e){var o=e("c86c");t=o(!1),t.push([n.i,'\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* pages/post-detail/post-detail.wxss */.container[data-v-c749a4a8]{padding:%?20?%;background-color:#f7f8fa;min-height:100vh;padding-bottom:%?140?%}.loading-container[data-v-c749a4a8]{display:flex;justify-content:center;align-items:center;height:%?400?%;background-color:#fff;border-radius:%?16?%;margin:%?30?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.loading-text[data-v-c749a4a8]{font-size:%?28?%;color:#999}.error-container[data-v-c749a4a8]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% %?40?%;text-align:center}.error-icon[data-v-c749a4a8]{font-size:%?120?%;margin-bottom:%?30?%;opacity:.6}.error-text[data-v-c749a4a8]{font-size:%?32?%;color:#666}.post-detail-card[data-v-c749a4a8]{position:relative;background-color:#fff;border-radius:%?16?%;padding:%?30?%;margin-bottom:%?20?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.post-detail-card.original-post[data-v-c749a4a8]{border:%?3?% solid #ebc88d;box-shadow:0 %?6?% %?24?% rgba(235,200,141,.4),0 %?4?% %?12?% rgba(0,0,0,.05);position:relative}.post-detail-card.original-post[data-v-c749a4a8]::before{content:"";position:absolute;top:%?-2?%;left:%?-2?%;right:%?-2?%;bottom:%?-2?%;background:linear-gradient(45deg,#ebc88d,#f4d03f,#ebc88d);border-radius:%?18?%;z-index:-1;opacity:.6;-webkit-filter:blur(%?10?%);filter:blur(%?10?%)}.author-info[data-v-c749a4a8]{display:flex;align-items:center;justify-content:flex-start;margin-bottom:%?20?%;gap:%?20?%}.author-basic[data-v-c749a4a8]{display:flex;align-items:center;flex:1;min-width:0;gap:%?12?%;flex-wrap:wrap}.follow-btn[data-v-c749a4a8]{padding:0 %?28?%;height:%?60?%;line-height:%?60?%;background-color:#9ed7ee;color:#fff;border:none;border-radius:%?999?%;font-size:%?26?%;flex-shrink:0;margin-left:auto}.follow-btn.following[data-v-c749a4a8]{background-color:#f0f0f0;color:#666}.follow-btn[data-v-c749a4a8]::after{border:none}.follow-btn[disabled][data-v-c749a4a8]{opacity:.7}.author-avatar[data-v-c749a4a8]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;background-color:#f5f5f5}.author-name[data-v-c749a4a8]{font-weight:700;font-size:%?28?%;color:#333}.post-title[data-v-c749a4a8]{font-size:%?36?%;font-weight:700;margin-bottom:%?15?%;line-height:1.4;color:#333;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.poem-author[data-v-c749a4a8]{font-size:%?28?%;color:#333;text-align:left;margin:%?10?% 0 %?15?% 0;font-weight:700;letter-spacing:%?2?%}.post-content[data-v-c749a4a8]{font-size:%?28?%;line-height:1.6;margin-bottom:%?20?%;white-space:pre-wrap;color:#666;word-break:break-word}.image-container[data-v-c749a4a8]{position:relative;width:100%;margin:%?20?% 0;background-color:#f5f5f5}.post-image[data-v-c749a4a8]{width:100%;height:auto;display:block;background-color:#f5f5f5;transition:-webkit-transform .3s ease;transition:transform .3s ease;transition:transform .3s ease,-webkit-transform .3s ease}.post-image[data-v-c749a4a8]:active{-webkit-transform:scale(1.05);transform:scale(1.05)}.post-image.single-image[data-v-c749a4a8]{width:100%!important;height:auto!important;display:block!important;background-color:#f5f5f5}.image-count-indicator[data-v-c749a4a8]{position:absolute;top:%?20?%;right:%?20?%;background-color:rgba(0,0,0,.6);color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%;z-index:10;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}.post-meta[data-v-c749a4a8]{margin-bottom:%?15?%}.post-time[data-v-c749a4a8]{font-size:%?24?%;color:#999;opacity:.8}.vote-section[data-v-c749a4a8]{display:flex;justify-content:flex-start;align-items:center;padding-top:%?20?%;margin-top:%?20?%;border-top:%?1?% solid #f0f0f0}.actions-left[data-v-c749a4a8]{display:flex;align-items:center}.vote-count[data-v-c749a4a8],\n.comment-count[data-v-c749a4a8]{display:flex;align-items:center;font-size:%?28?%;color:#999;margin-left:%?20?%;transition:color .2s ease}.vote-count[data-v-c749a4a8]{margin-left:%?0?%}.action-emoji[data-v-c749a4a8]{font-size:%?28?%;margin-right:%?8?%}.action-text[data-v-c749a4a8]{font-size:%?28?%;color:inherit}.like-icon-container[data-v-c749a4a8]{margin-left:%?20?%;display:flex;align-items:center;justify-content:center;padding:%?8?%;border-radius:%?8?%;transition:all .2s ease}.like-icon-container[data-v-c749a4a8]:active{-webkit-transform:scale(.95);transform:scale(.95)}.vote-count.voted[data-v-c749a4a8]{color:#ff4757}.button-group[data-v-c749a4a8]{display:flex;align-items:center}.favorite-button[data-v-c749a4a8]{background-color:#ffc300;color:#fff;border:none;border-radius:%?8?%;font-size:%?24?%;padding:%?8?% %?16?%;line-height:1.2;transition:all .2s ease}.favorite-button[data-v-c749a4a8]:active{background-color:#e6b000}.favorite-button[data-v-c749a4a8]::after{border:none}.favorite-button.favorited[data-v-c749a4a8]{background-color:#999;color:#fff}.favorite-button.favorited[data-v-c749a4a8]:active{background-color:#777}.like-icon[data-v-c749a4a8]{width:%?48?%;height:%?48?%}.comment-section[data-v-c749a4a8]{background-color:#fff;border-radius:%?16?%;padding:%?30?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.section-title[data-v-c749a4a8]{font-size:%?32?%;font-weight:700;margin-bottom:%?20?%;padding-bottom:%?15?%;border-bottom:%?1?% solid #f0f0f0;color:#333}.comment-list[data-v-c749a4a8]{margin-top:%?20?%}.comment-item[data-v-c749a4a8]{display:flex;margin-bottom:%?30?%;padding-bottom:%?20?%;border-bottom:%?1?% solid #f5f5f5}.comment-item[data-v-c749a4a8]:last-child{border-bottom:none;margin-bottom:0}.comment-avatar[data-v-c749a4a8]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;flex-shrink:0;background-color:#f5f5f5}.comment-main[data-v-c749a4a8]{display:flex;flex-direction:column;flex:1;min-width:0}.comment-author[data-v-c749a4a8]{font-size:%?28?%;color:#333;font-weight:700;margin-bottom:%?8?%}.comment-content[data-v-c749a4a8]{font-size:%?28?%;color:#666;line-height:1.5;word-break:break-word;margin-bottom:%?10?%}.comment-image-grid[data-v-c749a4a8]{display:flex;flex-direction:column;gap:%?12?%;margin-bottom:%?12?%}.comment-image[data-v-c749a4a8]{width:100%;height:%?400?%;border-radius:%?12?%;background-color:#f2f2f2;display:block;object-fit:cover}.reply-image-grid[data-v-c749a4a8]{margin-top:%?10?%}.comment-footer[data-v-c749a4a8]{display:flex;justify-content:flex-start;align-items:center;width:100%}.comment-time[data-v-c749a4a8]{font-size:%?24?%;color:#999;opacity:.8}.comment-actions[data-v-c749a4a8]{display:flex;align-items:center}.like-section[data-v-c749a4a8]{display:flex;align-items:center;padding:%?8?% %?12?%;margin-right:%?15?%;transition:all .2s ease}.like-section[data-v-c749a4a8]:active{-webkit-transform:scale(.95);transform:scale(.95)}.like-section .like-icon[data-v-c749a4a8]{width:%?32?%;height:%?32?%;margin-right:%?8?%}.like-count[data-v-c749a4a8]{font-size:%?26?%;color:#666}.delete-btn[data-v-c749a4a8]{display:flex;align-items:center;padding:%?8?% %?12?%;margin-right:%?15?%;transition:opacity .2s ease}.delete-btn[data-v-c749a4a8]:active{opacity:.7}.delete-text[data-v-c749a4a8]{font-size:%?26?%;color:#ff4d4f}.reply-btn[data-v-c749a4a8]{display:flex;align-items:center;padding:%?8?% %?12?%;transition:opacity .2s ease}.reply-btn[data-v-c749a4a8]:active{opacity:.7}.reply-text[data-v-c749a4a8]{font-size:%?26?%;color:#9ed7ee}.replies-container[data-v-c749a4a8]{margin-top:%?15?%;padding-left:%?20?%;border-left:%?2?% solid #f0f0f0}.reply-item[data-v-c749a4a8]{display:flex;margin-bottom:%?15?%}.reply-avatar[data-v-c749a4a8]{width:%?40?%;height:%?40?%;border-radius:50%;margin-right:%?10?%;flex-shrink:0;background-color:#f5f5f5}.reply-main[data-v-c749a4a8]{display:flex;flex-direction:column;flex:1;min-width:0}.reply-author[data-v-c749a4a8]{font-size:%?24?%;color:#333;font-weight:700;margin-bottom:%?4?%}.reply-content[data-v-c749a4a8]{font-size:%?26?%;color:#666;line-height:1.4;word-break:break-word}.reply-to[data-v-c749a4a8]{color:#9ed7ee;font-weight:700}.reply-footer[data-v-c749a4a8]{display:flex;justify-content:flex-start;align-items:center;margin-top:%?8?%}.reply-time[data-v-c749a4a8]{font-size:%?22?%;color:#999;opacity:.8}.reply-actions[data-v-c749a4a8]{display:flex;align-items:center}.show-more-replies[data-v-c749a4a8]{padding:%?10?% 0;transition:opacity .2s ease}.show-more-replies[data-v-c749a4a8]:active{opacity:.7}.show-more-text[data-v-c749a4a8]{font-size:%?24?%;color:#9ed7ee}.no-comment-tip[data-v-c749a4a8]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?60?% %?40?%;text-align:center}.empty-icon[data-v-c749a4a8]{font-size:%?80?%;margin-bottom:%?20?%;opacity:.6}.empty-text[data-v-c749a4a8]{font-size:%?28?%;color:#999}.input-overlay[data-v-c749a4a8]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.4);z-index:99;opacity:0;pointer-events:none;transition:opacity .3s ease}.input-overlay.show[data-v-c749a4a8]{opacity:1;pointer-events:auto}.comment-input-area[data-v-c749a4a8]{position:fixed;left:0;right:0;bottom:0;background-color:#fff;z-index:100;transition:bottom .2s ease-out;padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom)}.collapsed-bar[data-v-c749a4a8]{padding:%?16?% %?30?%;display:flex;align-items:center;border-top:%?1?% solid #f0f0f0}.collapsed-input-placeholder[data-v-c749a4a8]{flex:1;height:%?68?%;line-height:%?68?%;padding:0 %?24?%;background-color:#f7f8fa;border-radius:%?34?%;font-size:%?28?%;color:#999}.expanded-container[data-v-c749a4a8]{padding:%?20?% %?30?%;display:flex;flex-direction:column;border-top:%?1?% solid #f0f0f0}.expanded-textarea[data-v-c749a4a8]{width:100%;min-height:%?180?%;max-height:%?350?%;padding:%?20?% %?24?%;background-color:#fff;border-radius:0;font-size:%?30?%;line-height:1.6;box-sizing:border-box;border:none;-webkit-appearance:none;-webkit-box-sizing:border-box;-webkit-user-select:text;-webkit-touch-callout:default;outline:none}.expanded-actions[data-v-c749a4a8]{display:flex;justify-content:space-between;align-items:center;margin-top:%?20?%;width:100%}.action-icons[data-v-c749a4a8]{display:flex;gap:%?24?%}.action-icon[data-v-c749a4a8]{width:%?64?%;height:%?64?%;border-radius:50%;background:#f3f5f7;display:flex;align-items:center;justify-content:center;transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease}.action-icon[data-v-c749a4a8]:active{-webkit-transform:scale(.92);transform:scale(.92);background:#e6eef3}.action-icon-text[data-v-c749a4a8]{font-size:%?36?%}.selected-comment-images[data-v-c749a4a8]{display:flex;flex-wrap:wrap;gap:%?12?%;margin-top:%?16?%}.selected-image-item[data-v-c749a4a8]{position:relative;width:%?150?%;height:%?150?%;border-radius:%?12?%;overflow:hidden}.selected-image-thumb[data-v-c749a4a8]{width:100%;height:100%;background-color:#f2f2f2;display:block}.remove-image-btn[data-v-c749a4a8]{position:absolute;top:%?6?%;right:%?6?%;width:%?36?%;height:%?36?%;border-radius:50%;background:rgba(0,0,0,.55);color:#fff;font-size:%?24?%;display:flex;align-items:center;justify-content:center}.emoji-panel[data-v-c749a4a8]{margin-top:%?16?%;padding:%?20?% %?18?%;background:#f6f7f9;border-radius:%?16?%;display:flex;flex-wrap:wrap;gap:%?18?%}.emoji-item[data-v-c749a4a8]{font-size:%?36?%;padding:%?6?% %?10?%}.reply-prompt[data-v-c749a4a8]{display:flex;justify-content:flex-start;align-items:center;margin-bottom:%?15?%;padding:0 %?10?%}.reply-prompt-text[data-v-c749a4a8]{font-size:%?26?%;color:#666}.cancel-reply .cancel-text[data-v-c749a4a8]{font-size:%?26?%;color:#9ed7ee}.submit-button[data-v-c749a4a8]{width:%?120?%!important;height:%?64?%!important;line-height:%?64?%!important;background-color:#9ed7ee;color:#fff;border-radius:%?32?%;font-size:%?28?%;padding:0!important;margin:0!important;border:none!important;box-sizing:border-box!important;flex-shrink:0;transition:background-color .2s ease}.submit-button[disabled][data-v-c749a4a8]{background-color:#b3e6c9;color:#fff}.submit-button[data-v-c749a4a8]::after{border:none}.swiper-wrapper[data-v-c749a4a8]{position:relative;width:100%}.image-swiper[data-v-c749a4a8]{width:100%;background-color:#f0f0f0;border-radius:%?12?%;overflow:hidden}.swiper-item[data-v-c749a4a8]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.post-image[data-v-c749a4a8]{max-width:100%;max-height:100%}.image-count-indicator[data-v-c749a4a8]{position:absolute;bottom:%?20?%;right:%?20?%;background-color:rgba(0,0,0,.6);color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%;z-index:10;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}.post-tags[data-v-c749a4a8]{margin:%?30?% 0 %?10?% 0;line-height:1.5}.post-tag[data-v-c749a4a8]{color:#24375f;font-size:%?26?%;margin-right:%?10?%;transition:all .2s ease;cursor:pointer}.post-tag[data-v-c749a4a8]:active{color:#1a2a4a;opacity:.8}.mutual-tag[data-v-c749a4a8]{font-size:%?24?%;padding:%?4?% %?16?%;border-radius:%?999?%;background-color:#e6f4ff;color:#1f6fd2;flex-shrink:0}.followed-tag[data-v-c749a4a8]{font-size:%?24?%;padding:%?4?% %?16?%;border-radius:%?999?%;background-color:#f4ebff;color:#7c55c7;flex-shrink:0}',""]),n.exports=t},"518f":function(n,t,e){"use strict";e("6a54");var o=e("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(e("2634")),i=o(e("2fdc")),r=o(e("9b1b")),s=o(e("fcf3"));e("bf0f"),e("fd3c"),e("0c26"),e("18f7"),e("de6c"),e("8f71"),e("c223"),e("f7a5"),e("5ef2"),e("dd2b"),e("64aa"),e("bd06"),e("aa77"),e("7a76"),e("c9b5");var l=o(e("f7a1")),c=o(e("84be")),d=o(e("f7a1")),u=o(e("84be")),m=(getApp(),e("fe58")),f=e("df61"),p=f.togglePostLike,v=e("8e86"),g=v.previewImage,h=e("139b"),w=h.formatRelativeTime,b=(e("a7cb"),e("05f6")),y=e("11ca"),C=y.cloudCall,x=e("2b90"),k={components:{cloudTipModal:l.default,folderSelector:c.default},mixins:[x],data:function(){return{post:null,comments:[],newComment:"",commentCount:0,isLoading:!0,isSubmitDisabled:!0,replyToComment:null,replyToAuthor:"",showUploadTip:!1,votingInProgress:!1,imageContainerHeight:null,swiperHeights:{},imageClampHeights:{},showFavoriteModal:!1,isInputExpanded:!1,keyboardHeight:0,isFocus:!1,viewStartTime:0,currentPostId:null,isFavorited:!1,favoriteButtonText:"收藏",favoriteButtonClass:"favorite-button",showFollowButton:!1,isFollowing:!1,followPending:!1,isFollowedByAuthor:!1,isMutualFollow:!1,commentImages:[],maxCommentImages:3,showEmojiPanel:!1,emojiList:["😀","😁","😂","🤣","😊","😍","😎","🤔","😢","🙏","👍","👎"],isSubmittingComment:!1,imgindex:0,img:"",commentIndex:0,commentImage:"",imageIndex:0,replyIndex:0,reply:{authorAvatar:"",_openid:"",authorName:"",content:"",imageUrls:"",formattedCreateTime:"",_id:"",liked:"",likeIcon:"",likes:"",canDelete:""},replyImage:"",replyImageIndex:0}},onLoad:function(n){var t=n.id;t?(this.setData({currentPostId:t}),this.loadPostDetail(t)):(this.setData({isLoading:!1}),uni.showToast({title:"无效的帖子ID",icon:"none"}))},onShow:function(){this.setData({viewStartTime:Date.now()})},onUnload:function(){this.recordViewBehavior()},onHide:function(){this.isInputExpanded&&this.collapseInput(),this.recordViewBehavior()},methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return C(n,t,Object.assign({pageTag:"post-detail",context:this},e))},loadPostDetail:function(n){var t=this;uni.showLoading({title:"加载中..."}),this.callCloudFunction("getPostDetail",{postId:n},{injectOpenId:!1}).then((function(n){if(n.result&&n.result.post){var e=n.result.post;e.formattedCreateTime=t.formatTime(e.createTime),e.likeIcon=m.getLikeIcon(e.votes||0,e.isVoted||!1),console.log("loadPostDetail完整返回数据:",n.result),console.log("loadPostDetail获取到的commentCount:",n.result.commentCount,"类型:",(0,s.default)(n.result.commentCount)),console.log("loadPostDetail获取到的post.commentCount:",e.commentCount,"类型:",(0,s.default)(e.commentCount));var o=n.result.commentCount||e.commentCount||0;console.log("最终使用的commentCount:",o),t.setData({post:e,commentCount:o}),console.log("loadPostDetail设置后的commentCount:",t.commentCount),t.getComments(e&&e._id?e._id:""),t.prepareFollowState(e._openid)}else uni.showToast({title:"帖子加载失败",icon:"none"})})).catch((function(n){console.error("Failed to get post detail",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),uni.hideLoading()}))},getComments:function(n){var t=this;this.callCloudFunction("getComments",{postId:n},{injectOpenId:!1}).then((function(n){if(n.result&&n.result.comments){var e=t.openid||uni.getStorageSync("openid"),o=n.result.comments.map((function(n){var o=(0,r.default)((0,r.default)({},n),{},{formattedCreateTime:t.formatTime(n.createTime),likeIcon:m.getLikeIcon(n.likes||0,n.liked||!1),canDelete:n._openid===e,imageUrls:n.imageUrls||[],originalImageUrls:n.originalImageUrls||[]});return n.replies&&(o.replies=n.replies.map((function(n){return(0,r.default)((0,r.default)({},n),{},{formattedCreateTime:t.formatTime(n.createTime),likeIcon:m.getLikeIcon(n.likes||0,n.liked||!1),canDelete:n._openid===e,imageUrls:n.imageUrls||[],originalImageUrls:n.originalImageUrls||[]})}))),o}));console.log("getComments返回的commentCount:",n.result.commentCount),console.log("comments数组长度:",o.length),console.log("当前页面的commentCount:",t.commentCount);var a=n.result.commentCount||o.length,i=a>t.commentCount;t.setData({comments:o,commentCount:i?a:t.commentCount}),console.log("更新后的commentCount:",t.commentCount)}else uni.showToast({title:"评论加载失败",icon:"none"})})).catch((function(n){console.error("Failed to get comments",n),uni.showToast({title:"网络错误",icon:"none"})}))},onVote:function(n){var t=this,e=n.currentTarget.dataset.postid;if(!this.votingInProgress){this.setData({votingInProgress:!0});var o=this.post,a=o.votes,i=o.isVoted,r=i?a-1:a+1,s=!i,l=m.getLikeIcon(r,s);this.setData({"post.votes":r,"post.isVoted":s,"post.likeIcon":l}),p(e,{pageTag:"post-detail",context:this,currentVotes:a,currentIsLiked:i,requireAuth:!0}).then((function(n){if(n.success)t.setData({"post.votes":n.votes,"post.isVoted":n.isLiked,"post.likeIcon":n.likeIcon});else{var e=n.rollback||{votes:a,isLiked:i,likeIcon:m.getLikeIcon(a,i)};t.setData({"post.votes":e.votes,"post.isVoted":e.isLiked,"post.likeIcon":e.likeIcon})}})).catch((function(n){console.error("【帖子详情点赞】调用 likeService 失败",n),t.setData({"post.votes":a,"post.isVoted":i,"post.likeIcon":m.getLikeIcon(a,i)})})).finally((function(){t.setData({votingInProgress:!1})}))}},onFavorite:function(){this.isFavorited?uni.showToast({title:"已经收藏过了",icon:"none"}):this.setData({showFavoriteModal:!0})},hideFavoriteModal:function(){this.setData({showFavoriteModal:!1})},onFavoriteSuccess:function(){this.hideFavoriteModal(),this.setData({isFavorited:!0,favoriteButtonText:"已收藏",favoriteButtonClass:"favorite-button favorited"}),uni.showToast({title:"收藏成功",icon:"success"})},handlePreview:function(n){var t=g(n,{fallbackToast:!1});return t||uni.showToast({title:"图片加载失败",icon:"none"}),t},onImageError:function(n){console.error("图片加载失败",n)},onAvatarError:function(n){console.error("头像加载失败",n)},updateSubmitState:function(){var n=(this.newComment||"").trim().length>0,t=Array.isArray(this.commentImages)&&this.commentImages.length>0,e=!n&&!t||this.isSubmittingComment;this.isSubmitDisabled!==e&&this.setData({isSubmitDisabled:e})},onCommentInput:function(n){var t=this;this.setData({newComment:n.detail.value},(function(){t.updateSubmitState()}))},toggleEmojiPanel:function(){var n=!this.showEmojiPanel,t={showEmojiPanel:n,isFocus:!n};n&&(t.keyboardHeight=0,uni.hideKeyboard()),this.setData(t)},insertEmoji:function(n){var t=this,e=n.currentTarget.dataset.emoji;if(e){var o=(this.newComment||"")+e;this.setData({newComment:o},(function(){t.updateSubmitState()}))}},closeEmojiPanel:function(){this.showEmojiPanel&&this.setData({showEmojiPanel:!1})},chooseCommentImages:function(){var n=this;this.closeEmojiPanel();var t=this.commentImages?this.commentImages.length:0,e=this.maxCommentImages-t;e<=0?uni.showToast({title:"最多选择3张图片",icon:"none"}):(this.isInputExpanded||this.expandInput(),uni.chooseImage({count:e,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){var e=t.tempFiles||(t.tempFilePaths||[]).map((function(n){return{tempFilePath:n,size:0}})),o=e.map((function(t){return n.prepareCommentImage(t)}));Promise.all(o).then((function(t){var e=t.filter((function(n){return!!n}));if(0!==e.length){var o=(n.commentImages||[]).concat(e);n.setData({commentImages:o.slice(0,n.maxCommentImages)},(function(){n.updateSubmitState(),n.setData({isInputExpanded:!0,isFocus:!1})}))}})).catch((function(n){console.error("评论图片处理失败:",n),uni.showToast({title:"图片处理失败",icon:"none"})}))},fail:function(n){n&&n.errMsg&&-1===n.errMsg.indexOf("cancel")&&(console.error("选择评论图片失败:",n),uni.showToast({title:"无法选择图片",icon:"none"}))}}))},prepareCommentImage:function(n){var t=this;return new Promise((function(e){var o=n.tempFilePath||n.path||(Array.isArray(n.tempFilePaths)?n.tempFilePaths[0]:"");if(o){var a=n.size||0,i=a>204800,r={id:"comment_"+Date.now()+"_"+Math.floor(1e5*Math.random()),originalPath:o,previewUrl:o,compressedPath:o,size:a,needCompression:i};i?t.compressCommentImage(r).then((function(n){e(n)})).catch((function(n){console.warn("评论图片压缩异常:",n),r.compressedPath=r.originalPath,r.previewUrl=r.originalPath,r.needCompression=!1,e(r)})):e(r)}else e(null)}))},compressCommentImage:function(n){return new Promise((function(t){(function e(o){uni.compressImage({src:n.originalPath,quality:o,success:function(a){uni.getFileInfo({filePath:a.tempFilePath,success:function(i){var r=i.size;console.log("压缩质量".concat(o,"%，文件大小: ").concat((r/1024).toFixed(2),"KB")),r>204800&&o>30?(console.log("文件大小".concat((r/1024).toFixed(2),"KB超过200KB，继续压缩...")),e(o-10)):(n.compressedPath=a.tempFilePath,n.previewUrl=a.tempFilePath,n.compressedSize=r,console.log("最终压缩质量".concat(o,"%，文件大小: ").concat((r/1024).toFixed(2),"KB")),t(n))},fail:function(){n.compressedPath=a.tempFilePath,n.previewUrl=a.tempFilePath,t(n)}})},fail:function(a){console.warn("压缩质量".concat(o,"%失败:"),a),o>30?e(o-10):(n.compressedPath=n.originalPath,n.previewUrl=n.originalPath,n.needCompression=!1,t(n))}})})(60)}))},removeCommentImage:function(n){var t=this,e=n.currentTarget.dataset.index;if(void 0!==e){var o=(this.commentImages||[]).slice();o.splice(e,1),this.setData({commentImages:o},(function(){t.updateSubmitState()}))}},previewSelectedCommentImage:function(n){var t=n.currentTarget.dataset.index||0,e=this.commentImages||[];if(e.length){var o=e.map((function(n){return n.previewUrl})).filter(Boolean);if(o.length){var a=o[t]||o[0];return g({current:a,urls:o},{fallbackToast:!1})}}},uploadCommentImages:function(){var n=this,t=this.commentImages||[];if(!t.length)return Promise.resolve([]);var e=this.getCurrentUserId()||"guest",o=Date.now();return Promise.all(t.map((function(t,a){var i=(e||"guest")+"_"+o+"_"+a,r="comment_images/"+i+"_compressed.jpg";return n.uploadFile(r,t.compressedPath||t.previewUrl||t.originalPath).then((function(e){if(t.needCompression){var o="comment_images/"+i+"_original.jpg";return n.uploadFile(o,t.originalPath).then((function(n){return{compressedUrl:e.fileID,originalUrl:n.fileID}}))}return{compressedUrl:e.fileID,originalUrl:e.fileID}}))})))},previewCommentImageFromList:function(n){var t=Number(n.currentTarget.dataset.commentIndex),e=n.currentTarget.dataset.replyIndex,o="undefined"===typeof e?-1:Number(e),a=Number(n.currentTarget.dataset.imageIndex)||0,i=n.currentTarget.dataset.isReply,r=!0===i||"true"===i,s=[];if(!Number.isNaN(t)&&t>=0){var l=this.comments[t];if(l)if(r&&Array.isArray(l.replies)&&o>=0){var c=l.replies[o];c&&(Array.isArray(c.originalImageUrls)&&c.originalImageUrls.length>0?s=c.originalImageUrls:Array.isArray(c.imageUrls)&&(s=c.imageUrls))}else Array.isArray(l.originalImageUrls)&&l.originalImageUrls.length>0?s=l.originalImageUrls:Array.isArray(l.imageUrls)&&(s=l.imageUrls)}if(s&&s.length){var d=s.filter(Boolean);if(d.length){var u=d[a]||d[0];return g({current:u,urls:d},{fallbackToast:!1})}}},onSubmitComment:function(){var n=(0,i.default)((0,a.default)().mark((function n(){var t,e,o,i,r,s,l,c,d,u,m,f,p;return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!this.isSubmitDisabled&&!this.isSubmittingComment){n.next=2;break}return n.abrupt("return");case 2:if(t=(this.newComment||"").trim(),e=t.length>0,o=Array.isArray(this.commentImages)&&this.commentImages.length>0,e||o){n.next=8;break}return uni.showToast({title:"请输入内容或添加图片",icon:"none"}),n.abrupt("return");case 8:if(i=this.post&&this.post._id?this.post._id:"",i){n.next=12;break}return uni.showToast({title:"帖子信息缺失",icon:"none"}),n.abrupt("return");case 12:return r=this.replyToComment,s=this.replyToAuthor,this.setData({isSubmittingComment:!0}),this.updateSubmitState(),uni.showLoading({title:"提交中..."}),n.prev=17,n.next=20,this.uploadCommentImages();case 20:return l=n.sent,c=l.map((function(n){return n.compressedUrl})),d=l.map((function(n){return n.originalUrl})),n.next=25,this.callCloudFunction("addComment",{postId:i,content:t,parentId:r,replyToAuthorName:s,imageUrls:c,originalImageUrls:d},{requireAuth:!0});case 25:u=n.sent,uni.hideLoading(),u.result&&u.result.success?(uni.showToast({title:"评论成功"}),m=this.commentCount+1,this.setData({newComment:"",commentImages:[],showEmojiPanel:!1,commentCount:m}),this.updateSubmitState(),this.collapseInput(),this.getComments(i),f=getCurrentPages(),f.length>1&&(p=f[f.length-2],"pages/index/index"!==p.route&&"pages/profile/profile"!==p.route||"function"!==typeof p.updatePostCommentCount||p.updatePostCommentCount(i,m))):uni.showToast({title:u.result&&u.result.message||"评论失败",icon:"none"}),n.next=37;break;case 30:n.prev=30,n.t0=n["catch"](17),console.log("CatchClause",n.t0),console.log("CatchClause",n.t0),uni.hideLoading(),console.error("Failed to add comment with media:",n.t0),uni.showToast({title:"评论失败",icon:"none"});case 37:return n.prev=37,this.setData({isSubmittingComment:!1}),this.updateSubmitState(),n.finish(37);case 41:case"end":return n.stop()}}),n,this,[[17,30,37,41]])})));return function(){return n.apply(this,arguments)}}(),showReplyInput:function(n){console.log("--- showReplyInput function triggered ---"),console.log("收到的 data- attributes:",n.currentTarget.dataset);var t=n.currentTarget.dataset.commentId,e=n.currentTarget.dataset.authorName;this.setData({replyToComment:t,replyToAuthor:e}),console.log("设置后的回复状态:",{replyToComment:this.replyToComment,replyToAuthor:this.replyToAuthor}),this.expandInput()},cancelReply:function(){this.setData({replyToComment:null,replyToAuthor:""}),console.log("回复状态已被取消")},onDeleteComment:function(n){var t=this,e=n.currentTarget.dataset,o=e.commentId,a=e.parentId;o&&uni.showModal({title:"删除评论",content:"确定要删除这条评论吗？",confirmColor:"#ff4d4f",success:function(n){n.confirm&&(uni.showLoading({title:"正在删除",mask:!0}),t.callCloudFunction("deleteComment",{commentId:o},{requireAuth:!0}).then((function(n){if(n.result&&n.result.success){var e,i=Math.max(1,n.result.deletedCount||1);if(a){e=t.comments.map((function(n){return(0,r.default)((0,r.default)({},n),{},{replies:n.replies?n.replies.slice():[]})}));var s=e.findIndex((function(n){return n._id===a}));-1!==s&&(e[s].replies=e[s].replies.filter((function(n){return n._id!==o})))}else e=t.comments.filter((function(n){return n._id!==o}));var l=Math.max(0,t.commentCount-i);t.setData({comments:e,commentCount:l});var c=getCurrentPages();if(c.length>1){var d=c[c.length-2];"function"===typeof d.updatePostCommentCount&&d.updatePostCommentCount(t.post&&t.post._id?t.post._id:"",l)}uni.showToast({title:"已删除",icon:"success"})}else uni.showToast({title:n.result&&n.result.message||"删除失败",icon:"none"})})).catch((function(n){console.error("Failed to delete comment",n),uni.showToast({title:"删除失败",icon:"none"})})).finally((function(){uni.hideLoading()})))}})},toggleLikeComment:function(n){var t=this,e=n.currentTarget.dataset.commentId,o=this.post&&this.post._id?this.post._id:"",a=this.comments,i=this.findComment(a,e),r=i.comment;i.isReply;if(r){var s=!r.liked,l=r.likes||0;r.liked=s,r.likes=l+(s?1:-1),r.likeIcon=m.getLikeIcon(r.likes,r.liked),this.setData({comments:a}),this.callCloudFunction("likeComment",{commentId:e,postId:o},{requireAuth:!0}).then((function(n){n.result&&n.result.success?r.likes!==n.result.likes&&t.updateCommentLikeStatus(e,s,n.result.likes):(t.updateCommentLikeStatus(e,!s,l),uni.showToast({title:"操作失败",icon:"none"}))})).catch((function(n){t.updateCommentLikeStatus(e,!s,l),console.error("Failed to like comment",n),uni.showToast({title:"网络错误",icon:"none"})}))}},updateCommentLikeStatus:function(n,t,e){var o=this.comments,a=this.findComment(o,n),i=a.comment;a.isReply;i&&(i.liked=t,i.likes=e,i.likeIcon=m.getLikeIcon(i.likes,i.liked),this.setData({comments:o}))},findComment:function(n,t){for(var e=0;e<n.length;e++){if(n[e]._id===t)return{comment:n[e],isReply:!1};if(n[e].replies)for(var o=0;o<n[e].replies.length;o++)if(n[e].replies[o]._id===t)return{comment:n[e].replies[o],isReply:!0}}return{comment:null,isReply:!1}},toggleShowAllReplies:function(n){var t=n.currentTarget.dataset.commentId,e=this.comments,o=e.find((function(n){return n._id===t}));o&&(o.showAllReplies=!o.showAllReplies,this.setData({comments:e}))},formatTime:function(n){return w(n)},prepareFollowState:function(n){var t=this.getCurrentUserId();if(console.log("【关注状态】prepareFollowState调用:",{authorOpenid:n,currentUserId:t,isSameUser:n===t}),!n||!t||n===t)return console.log("【关注状态】不显示关注按钮 - 自己或无效用户"),void this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByAuthor:!1,isMutualFollow:!1});console.log("【关注状态】显示关注按钮"),this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByAuthor:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(n)},fetchFollowStatusWithCache:function(n){var t=this;if(n){var e=this.getCurrentUserId();e&&b.getFollowStatus(e,n).then((function(n){n&&t.setData({isFollowing:n.isFollowing,isFollowedByAuthor:n.isFollowedByAuthor,isMutualFollow:n.isMutualFollow})}))}},fetchFollowStatus:function(n){var t=this;n&&this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:n},{requireAuth:!0}).then((function(n){n.result&&n.result.success?t.setData({isFollowing:!!n.result.isFollowing,isFollowedByAuthor:!!n.result.isFollower,isMutualFollow:!!n.result.isMutual}):console.warn("检查关注状态失败",n.result)})).catch((function(n){console.error("检查关注状态调用失败:",n)}))},onFollowTap:function(){var n=this;if(!this.followPending&&this.post){var t=this.post._openid;if(t){var e=this.getCurrentUserId();e?(this.setData({followPending:!0}),b.toggleFollowStatus(e,t).then((function(t){t?(n.setData({isFollowing:t.isFollowing,isFollowedByAuthor:t.isFollowedByAuthor,isMutualFollow:t.isMutualFollow}),uni.showToast({title:t.isFollowing?"关注成功":"已取消关注",icon:"success"})):uni.showToast({title:"操作失败",icon:"none"})})).catch((function(n){console.error("切换关注状态失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({followPending:!1})}))):uni.showToast({title:"请先登录",icon:"none"})}}},getCurrentUserId:function(){return this.openid||uni.getStorageSync("openid")||uni.getStorageSync("userOpenId")},retryLoad:function(){this.currentPostId&&(this.setData({isLoading:!0,post:null}),this.loadPostDetail(this.currentPostId))},navigateToUserProfile:function(n){var t=n.currentTarget.dataset.userId;if(t){var e=this.openid;t===e?(console.log("【帖子详情】点击的是自己头像，切换到我的页面"),uni.switchTab({url:"/pages/profile/profile"})):(console.log("【帖子详情】点击的是他人头像，跳转到用户主页"),uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(t)}))}},preventBubble:function(){},expandInput:function(){this.setData({isInputExpanded:!0,isFocus:!0,showEmojiPanel:!1})},onInputFocus:function(n){console.log("键盘弹起，高度为:",n.detail.height),this.setData({keyboardHeight:n.detail.height,showEmojiPanel:!1})},onInputBlur:function(){var n=this;setTimeout((function(){n.setData({isFocus:!1,keyboardHeight:0})}),100)},collapseInput:function(){this.setData({isInputExpanded:!1,isFocus:!1,keyboardHeight:0,replyToComment:null,replyToAuthor:"",showEmojiPanel:!1})},recordViewBehavior:function(){if(this.currentPostId&&this.viewStartTime){var n=Math.floor((Date.now()-this.viewStartTime)/1e3);n<3||this.callCloudFunction("recordView",{postId:this.currentPostId,viewDuration:n}).then((function(n){console.log("浏览记录已保存",n)})).catch((function(n){console.error("浏览记录保存失败:",n)}))}},onTagClick:function(n){var t=n.currentTarget.dataset.tag;console.log("点击标签:",t),uni.navigateTo({url:"/pages/tag-filter/tag-filter?tag=".concat(encodeURIComponent(t)),success:function(){console.log("跳转到标签筛选页面成功")},fail:function(n){console.error("跳转到标签筛选页面失败",n),uni.showToast({title:"跳转失败",icon:"none"})}})},uploadFile:function(n,t){var o=this;return console.log("🔍 [帖子详情页] 上传文件: ".concat(n),t),new Promise((function(a,i){var r=e("fd09"),s=r.getCurrentPlatform,l=r.getCloudFunctionMethod,c=s(),d=l();console.log("🔍 [帖子详情页] 运行环境检测 - 平台: ".concat(c,", 方法: ").concat(d)),"tcb"===d?o.$tcb&&o.$tcb.uploadFile?(console.log("🔍 [帖子详情页] TCB环境上传文件: ".concat(n)),o.$tcb.uploadFile({cloudPath:n,filePath:t}).then(a).catch(i)):(console.error("❌ [帖子详情页] TCB实例不可用"),i(new Error("TCB实例不可用"))):"wx-cloud"===d?wx.cloud&&wx.cloud.uploadFile?(console.log("🔍 [帖子详情页] 小程序环境上传文件: ".concat(n)),wx.cloud.uploadFile({cloudPath:n,filePath:t,success:function(t){console.log("✅ [帖子详情页] 文件上传成功: ".concat(n),t),a(t)},fail:function(t){console.error("❌ [帖子详情页] 文件上传失败: ".concat(n),t),i(t)}})):(console.error("❌ [帖子详情页] 微信云开发不可用"),i(new Error("微信云开发不可用"))):(console.error("❌ [帖子详情页] 不支持的文件上传方式: ".concat(d)),i(new Error("不支持的文件上传方式: ".concat(d))))}))}}};t.default=k,t.default.components=Object.assign({"cloud-tip-modal":d.default,"folder-selector":u.default},t.default.components||{})},"64ba":function(n,t,e){"use strict";var o=e("0f54"),a=e.n(o);a.a},7292:function(n,t,e){var o=e("8774");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);var a=e("967d").default;a("8625021a",o,!0,{sourceMap:!1,shadowMode:!1})},"84be":function(n,t,e){"use strict";e.r(t);var o=e("3c3d"),a=e("daaa");for(var i in a)["default"].indexOf(i)<0&&function(n){e.d(t,n,(function(){return a[n]}))}(i);e("4238");var r=e("828b"),s=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,"5e1631f9",null,!1,o["a"],void 0);t["default"]=s.exports},8774:function(n,t,e){var o=e("c86c");t=o(!1),t.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* components/folder-selector/folder-selector.wxss */.modal-overlay[data-v-5e1631f9]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[data-v-5e1631f9]{background:#fff;border-radius:%?16?%;margin:%?40?%;width:calc(100% - %?80?%);max-width:%?600?%;max-height:80vh;display:flex;flex-direction:column}.modal-header[data-v-5e1631f9]{display:flex;align-items:center;justify-content:space-between;padding:%?30?% %?40?%;border-bottom:%?1?% solid #f0f0f0}.modal-title[data-v-5e1631f9]{font-size:%?36?%;font-weight:500;color:#333}.close-btn[data-v-5e1631f9]{font-size:%?48?%;color:#999;line-height:1;position:relative;z-index:1001}.modal-body[data-v-5e1631f9]{flex:1;padding:%?20?% 0;max-height:60vh;overflow-y:auto}.loading-container[data-v-5e1631f9]{display:flex;justify-content:center;align-items:center;height:%?200?%}.loading-text[data-v-5e1631f9]{color:#999;font-size:%?28?%}.folders-list[data-v-5e1631f9]{padding:0 %?40?%}.folder-item[data-v-5e1631f9]{display:flex;align-items:center;padding:%?24?% 0;border-bottom:%?1?% solid #f8f8f8}.folder-item[data-v-5e1631f9]:last-child{border-bottom:none}.folder-item.selected[data-v-5e1631f9]{background:rgba(7,193,96,.1);border-radius:%?8?%;padding:%?24?% %?20?%;margin:0 %?-20?%}.folder-icon[data-v-5e1631f9]{font-size:%?40?%;margin-right:%?20?%}.folder-info[data-v-5e1631f9]{flex:1}.folder-name[data-v-5e1631f9]{font-size:%?30?%;color:#333;font-weight:500;margin-bottom:%?4?%}.folder-count[data-v-5e1631f9]{font-size:%?24?%;color:#999}.selected-icon[data-v-5e1631f9]{font-size:%?32?%;color:#9ed7ee;font-weight:700}.empty-state[data-v-5e1631f9]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:%?200?%;padding:%?40?%}.empty-icon[data-v-5e1631f9]{font-size:%?60?%;margin-bottom:%?16?%;opacity:.5}.empty-text[data-v-5e1631f9]{font-size:%?28?%;color:#666;margin-bottom:%?8?%}.empty-subtext[data-v-5e1631f9]{font-size:%?24?%;color:#999}.modal-footer[data-v-5e1631f9]{display:flex;gap:%?20?%;padding:%?30?% %?40?%;border-top:%?1?% solid #f0f0f0}.modal-btn[data-v-5e1631f9]{flex:1;height:%?80?%;border-radius:%?8?%;font-size:%?28?%;border:none;display:flex;align-items:center;justify-content:center;position:relative;z-index:1001}.secondary-btn[data-v-5e1631f9]{background:#f5f5f5;color:#666}.primary-btn[data-v-5e1631f9]{background:#9ed7ee;color:#fff}.primary-btn[data-v-5e1631f9]:disabled{background:#ccc;color:#999}\r\n/* 创建收藏夹弹窗样式 */.create-modal .modal-body[data-v-5e1631f9]{padding:%?40?%}.folder-name-input[data-v-5e1631f9]{width:100%;height:%?80?%;padding:0 %?20?%;border:%?2?% solid #e0e0e0;border-radius:%?8?%;font-size:%?30?%;box-sizing:border-box}.folder-name-input[data-v-5e1631f9]:focus{border-color:#9ed7ee}",""]),n.exports=t},"9d3a":function(n,t,e){"use strict";e("6a54");var o=e("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e("bf0f"),e("0c26");var a=o(e("39d8")),i=e("11ca"),r=i.cloudCall,s={data:function(){return{folders:[],isLoading:!0,selectedFolderId:"",showCreateModal:!1,newFolderName:"",showClone:!1}},props:{show:{type:Boolean,default:!1},postId:{type:String,default:""}},watch:(0,a.default)({show:function(n){n&&this.loadFolders()}},"show",{handler:function(n,t){this.showClone=n},immediate:!0}),methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(n,t,Object.assign({pageTag:"folder-selector",context:this,requireAuth:!0},e))},loadFolders:function(){var n=this;console.log("开始加载收藏夹列表..."),this.setData({isLoading:!0});var t=this.$requireOpenid&&this.$requireOpenid();t?this.callCloudFunction("getMyProfileData",{action:"getFavoriteFolders",openid:t}).then((function(t){if(console.log("folder-selector获取收藏夹:",t),t.result&&t.result.success){var e=t.result.folders||[];console.log("获取到收藏夹数量:",e.length);var o=n.selectedFolderId;o&&!e.some((function(n){return n._id===o}))&&(console.log("清空失效的选中状态"),n.setData({selectedFolderId:""})),n.setData({folders:e,isLoading:!1})}else{var a;uni.showToast({title:(null===(a=t.result)||void 0===a?void 0:a.message)||"加载失败",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})}})).catch((function(t){console.error("获取收藏夹失败:",t),uni.showToast({title:"网络错误",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})})):this.setData({isLoading:!1,folders:[],selectedFolderId:""})},selectFolder:function(n){var t=n.currentTarget.dataset.folderId;this.setData({selectedFolderId:t})},confirmFavorite:function(){var n=this,t=this.selectedFolderId,e=this.postId;if(console.log("确认收藏，postId:",e,"folderId:",t),t){if(!e)return console.error("postId 为空，无法收藏"),void uni.showToast({title:"参数错误：帖子ID为空",icon:"none"});var o=this.$requireOpenid&&this.$requireOpenid();o&&(uni.showLoading({title:"收藏中..."}),this.callCloudFunction("getMyProfileData",{action:"addToFavorite",postId:e,folderId:t,openid:o}).then((function(t){uni.hideLoading(),console.log("确认收藏返回结果:",t),t&&t.result?t.result.success?(uni.showToast({title:"收藏成功"}),console.log("收藏成功，开始关闭弹窗"),n.setData({selectedFolderId:""}),setTimeout((function(){n.hideModal()}),1500),n.$emit("favoriteSuccess")):(console.error("收藏业务失败:",t.result),uni.showToast({title:t.result.message||"收藏失败",icon:"none"})):(console.error("收藏返回格式异常:",t),uni.showToast({title:"收藏失败：返回格式错误",icon:"none"}))})).catch((function(n){uni.hideLoading(),console.error("收藏云函数调用失败:",n),uni.showToast({title:"网络错误："+(n.errMsg||"未知错误"),icon:"none"})})))}else uni.showToast({title:"请选择收藏夹",icon:"none"})},createFolder:function(){this.setData({showCreateModal:!0,newFolderName:""})},hideCreateModal:function(){this.setData({showCreateModal:!1,newFolderName:""})},onFolderNameInput:function(n){var t=n.detail.value;this.setData({newFolderName:t})},createNewFolder:function(){var n=this,t=this.newFolderName.trim();if(t){this.setData({newFolderName:t}),console.log("组件开始创建收藏夹，名称:",t);var e=this.$requireOpenid&&this.$requireOpenid();e&&(uni.showLoading({title:"创建中..."}),this.callCloudFunction("getMyProfileData",{action:"createFavoriteFolder",folderName:t,openid:e}).then((function(t){uni.hideLoading(),console.log("组件创建收藏夹返回结果:",t),t&&t.result?t.result.success?(uni.showToast({title:"创建成功",duration:2e3}),n.setData({showCreateModal:!1}),setTimeout((function(){n.loadFolders()}),300)):(console.error("组件创建收藏夹业务失败:",t.result),uni.showToast({title:t.result.message||"创建失败",icon:"none",duration:3e3})):(console.error("组件创建收藏夹返回格式异常:",t),uni.showToast({title:"创建失败：返回格式错误",icon:"none",duration:3e3}))})).catch((function(n){uni.hideLoading(),console.error("组件创建收藏夹云函数调用失败:",n),uni.showToast({title:"创建失败: "+(n.errMsg||"网络错误"),icon:"none",duration:3e3})})))}else uni.showToast({title:"请输入收藏夹名称",icon:"none"})},hideModal:function(){console.log("=== 点击关闭按钮，开始隐藏弹窗 ==="),console.log("当前状态：",{show:this.show,showCreateModal:this.showCreateModal,selectedFolderId:this.selectedFolderId}),this.setData({selectedFolderId:"",showClone:!1,showCreateModal:!1,newFolderName:""}),console.log("=== 弹窗已隐藏，状态已重置 ==="),this.$emit("hide")},trueFun:function(){console.log("占位：函数 true 未声明")}},created:function(){}};t.default=s},a6d2:function(n,t,e){"use strict";e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return a})),e.d(t,"a",(function(){}));var o=function(){var n=this,t=n.$createElement,e=n._self._c||t;return n.showTip?e("v-uni-view",{staticClass:"install_tip"},[e("v-uni-view",{staticClass:"install_tip_back"}),e("v-uni-view",{staticClass:"install_tip_detail"},[e("v-uni-image",{staticClass:"install_tip_close",attrs:{src:"/static/images/icons/close.png"},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onClose.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"install_tip_detail_title"},[n._v(n._s(n.title))]),e("v-uni-view",{staticClass:"install_tip_detail_tip"},[n._v(n._s(n.content))])],1)],1):n._e()},a=[]},b18e:function(n,t,e){"use strict";e.d(t,"b",(function(){return a})),e.d(t,"c",(function(){return i})),e.d(t,"a",(function(){return o}));var o={folderSelector:e("84be").default},a=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[e("v-uni-view",{staticClass:"container"},[n.isLoading?[e("v-uni-view",{staticClass:"loading-container"},[e("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1)]:n.post&&n.post._id?[e("v-uni-view",{class:"post-detail-card "+(n.post.isOriginal?"original-post":"")},[e("v-uni-view",{staticClass:"author-info"},[e("v-uni-view",{staticClass:"author-basic"},[n.post.authorAvatar?e("v-uni-image",{staticClass:"author-avatar",attrs:{src:n.post.authorAvatar,mode:"aspectFill","data-user-id":n.post._openid},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onAvatarError.apply(void 0,arguments)},click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateToUserProfile.apply(void 0,arguments)}}}):n._e(),e("v-uni-text",{staticClass:"author-name"},[n._v(n._s(n.post.authorName))]),n.isMutualFollow?e("v-uni-view",{staticClass:"mutual-tag"},[n._v("互相关注")]):n.isFollowedByAuthor?e("v-uni-view",{staticClass:"followed-tag"},[n._v("TA关注了你")]):n._e()],1),n.showFollowButton?e("v-uni-button",{class:"follow-btn "+(n.isFollowing?"following":""),attrs:{loading:n.followPending,disabled:n.followPending},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onFollowTap.apply(void 0,arguments)}}},[n._v(n._s(n.isFollowing?"已关注":"关注"))]):n._e()],1),e("v-uni-view",{staticClass:"post-title"},[n._v(n._s(n.post.title))]),n.post.isPoem&&n.post.author?e("v-uni-view",{staticClass:"poem-author"},[n._v(n._s(n.post.author))]):n._e(),n.post.content?e("v-uni-view",{staticClass:"post-content"},[n._v(n._s(n.post.content))]):n._e(),n.post.tags&&n.post.tags.length>0?e("v-uni-view",{staticClass:"post-tags"},n._l(n.post.tags,(function(t,o){return e("v-uni-text",{key:o,staticClass:"post-tag",attrs:{"data-tag":t},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onTagClick.apply(void 0,arguments)}}},[n._v("#"+n._s(t))])})),1):n._e(),n.post.imageUrl||n.post.imageUrls&&n.post.imageUrls.length>0?e("v-uni-view",{staticClass:"image-container",attrs:{id:"detail-image-container"}},[n.post.imageUrls&&1===n.post.imageUrls.length?[e("v-uni-image",{style:"width: 100%; height: "+(n.post&&n.post._id&&n.imageClampHeights[n.post._id]?n.imageClampHeights[n.post._id]+"px":"auto")+"; object-fit: "+(n.post&&n.post._id&&n.imageClampHeights[n.post._id]?"cover":"contain")+"; background-color: #f0f0f0;",attrs:{id:"single-image-"+(n.post&&n.post._id?n.post._id:""),src:n.post.imageUrls[0],mode:n.post&&n.post._id&&n.imageClampHeights[n.post._id]?"aspectFill":"widthFix","data-postid":n.post&&n.post._id?n.post._id:"","data-type":"single","data-src":n.post.imageUrls[0],"data-original-image-urls":n.post.originalImageUrls||n.post.imageUrls,"lazy-load":!0},on:{load:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageLoad.apply(void 0,arguments)},error:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageError.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.handlePreview.apply(void 0,arguments)}}})]:n.post.imageUrls&&n.post.imageUrls.length>1?[e("v-uni-swiper",{staticClass:"image-swiper",style:"width: 100%; height: "+(n.swiperHeights[0]?n.swiperHeights[0]+"px":"220px")+";",attrs:{id:"swiper-"+(n.post&&n.post._id?n.post._id:""),"indicator-dots":!0,circular:!0}},[n._l(n.post.imageUrls,(function(t,o){return[e("v-uni-swiper-item",[e("v-uni-image",{staticStyle:{width:"100%",height:"100%","object-fit":"cover","background-color":"#f0f0f0"},attrs:{src:t,mode:"aspectFill","data-postid":n.post&&n.post._id?n.post._id:"","data-postindex":"0","data-imgindex":o,"data-type":"multi","data-src":t,"data-original-image-urls":n.post.originalImageUrls||n.post.imageUrls,"lazy-load":!0},on:{load:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageLoad.apply(void 0,arguments)},error:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageError.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.handlePreview.apply(void 0,arguments)}}})],1)]}))],2)]:n._e()],2):n._e(),e("v-uni-view",{staticClass:"post-meta"},[e("v-uni-text",{staticClass:"post-time"},[n._v(n._s(n.post.formattedCreateTime))])],1),e("v-uni-view",{staticClass:"vote-section",on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.preventBubble.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"actions-left"},[e("v-uni-button",{class:n.favoriteButtonClass,attrs:{size:"mini"},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onFavorite.apply(void 0,arguments)}}},[n._v(n._s(n.favoriteButtonText))])],1),e("v-uni-view",{staticClass:"button-group"},[e("v-uni-view",{staticClass:"comment-count"},[e("v-uni-text",{staticClass:"action-emoji"},[n._v("💬")]),e("v-uni-text",{staticClass:"action-text"},[n._v(n._s(n.commentCount))])],1),e("v-uni-view",{staticClass:"like-icon-container",attrs:{"data-postid":n.post&&n.post._id?n.post._id:""},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onVote.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"like-icon",attrs:{src:n.post.likeIcon,mode:"aspectFit"}})],1),e("v-uni-view",{class:"vote-count "+(n.post.isVoted?"voted":"")},[e("v-uni-text",{staticClass:"action-text"},[n._v(n._s(n.post.votes||0))])],1)],1)],1)],1),e("v-uni-view",{staticClass:"comment-section"},[e("v-uni-view",{staticClass:"section-title"},[n._v("共"+n._s(n.commentCount)+" 条评论")]),e("v-uni-view",{staticClass:"comment-list"},[n.comments.length>0?n._l(n.comments,(function(t,o){return e("v-uni-view",{key:o,staticClass:"comment-item"},[e("v-uni-image",{staticClass:"comment-avatar",attrs:{src:t.authorAvatar,mode:"aspectFill","data-user-id":t._openid},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onAvatarError.apply(void 0,arguments)},click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateToUserProfile.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"comment-main"},[e("v-uni-view",{staticClass:"comment-author"},[n._v(n._s(t.authorName))]),e("v-uni-view",{staticClass:"comment-content"},[n._v(n._s(t.content))]),t.imageUrls&&t.imageUrls.length?e("v-uni-view",{staticClass:"comment-image-grid"},n._l(t.imageUrls,(function(t,a){return e("v-uni-image",{key:a,staticClass:"comment-image",attrs:{src:t,mode:"aspectFill","data-comment-index":o,"data-image-index":a,"data-is-reply":!1},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.previewCommentImageFromList.apply(void 0,arguments)}}})})),1):n._e(),e("v-uni-view",{staticClass:"comment-footer"},[e("v-uni-view",{staticClass:"comment-time"},[n._v(n._s(t.formattedCreateTime))]),e("v-uni-view",{staticClass:"comment-actions"},[e("v-uni-view",{staticClass:"like-section",attrs:{"data-comment-id":t._id,"data-liked":t.liked},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.toggleLikeComment.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"like-icon",attrs:{src:t.likeIcon}}),e("v-uni-text",{staticClass:"like-count"},[n._v(n._s(t.likes||0))])],1),t.canDelete?e("v-uni-view",{staticClass:"delete-btn",attrs:{"data-comment-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onDeleteComment.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"delete-text"},[n._v("删除")])],1):n._e(),e("v-uni-view",{staticClass:"reply-btn",attrs:{"data-comment-id":t._id,"data-author-name":t.authorName},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.showReplyInput.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"reply-text"},[n._v("回复")])],1)],1)],1),t.replies&&t.replies.length>0?e("v-uni-view",{staticClass:"replies-container"},[n._l(t.replies,(function(a,i){return i<(t.showAllReplies?t.replies.length:3)?e("v-uni-view",{key:i,staticClass:"reply-item"},[e("v-uni-image",{staticClass:"reply-avatar",attrs:{src:a.authorAvatar,mode:"aspectFill","data-user-id":a._openid},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onAvatarError.apply(void 0,arguments)},click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateToUserProfile.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"reply-main"},[e("v-uni-view",{staticClass:"reply-author"},[n._v(n._s(a.authorName))]),e("v-uni-view",{staticClass:"reply-content"},[e("v-uni-text",{staticClass:"reply-to"},[n._v("回复@"+n._s(t.authorName)+"：")]),e("v-uni-text",[n._v(n._s(a.content))])],1),a.imageUrls&&a.imageUrls.length?e("v-uni-view",{staticClass:"comment-image-grid reply-image-grid"},n._l(a.imageUrls,(function(t,a){return e("v-uni-image",{key:a,staticClass:"comment-image",attrs:{src:t,mode:"aspectFill","data-comment-index":o,"data-reply-index":i,"data-image-index":a,"data-is-reply":!0},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.previewCommentImageFromList.apply(void 0,arguments)}}})})),1):n._e(),e("v-uni-view",{staticClass:"reply-footer"},[e("v-uni-view",{staticClass:"reply-time"},[n._v(n._s(a.formattedCreateTime))]),e("v-uni-view",{staticClass:"reply-actions"},[e("v-uni-view",{staticClass:"like-section",attrs:{"data-comment-id":a._id,"data-liked":a.liked},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.toggleLikeComment.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"like-icon",attrs:{src:a.likeIcon}}),e("v-uni-text",{staticClass:"like-count"},[n._v(n._s(a.likes||0))])],1),a.canDelete?e("v-uni-view",{staticClass:"delete-btn",attrs:{"data-comment-id":a._id,"data-parent-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onDeleteComment.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"delete-text"},[n._v("删除")])],1):n._e(),e("v-uni-view",{staticClass:"reply-btn",attrs:{"data-comment-id":t._id,"data-author-name":a.authorName},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.showReplyInput.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"reply-text"},[n._v("回复")])],1)],1)],1)],1)],1):n._e()})),t.replies.length>3&&!t.showAllReplies?e("v-uni-view",{staticClass:"show-more-replies",attrs:{"data-comment-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.toggleShowAllReplies.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"show-more-text"},[n._v("显示"+n._s(t.replies.length-3)+"条回复")])],1):n._e(),t.replies.length>3&&t.showAllReplies?e("v-uni-view",{staticClass:"show-more-replies",attrs:{"data-comment-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.toggleShowAllReplies.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"show-more-text"},[n._v("收起回复")])],1):n._e()],2):n._e()],1)],1)})):[e("v-uni-view",{staticClass:"no-comment-tip"},[e("v-uni-view",{staticClass:"empty-icon"},[n._v("💬")]),e("v-uni-view",{staticClass:"empty-text"},[n._v("暂无评论，快来抢沙发吧！")])],1)]],2)],1)]:[e("v-uni-view",{staticClass:"error-container"},[e("v-uni-view",{staticClass:"error-icon"},[n._v("❌")]),e("v-uni-view",{staticClass:"error-text"},[n._v("帖子加载失败或不存在")])],1)]],2),e("v-uni-view",{class:"input-overlay "+(n.isInputExpanded?"show":""),on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.collapseInput.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"comment-input-area",style:"bottom: "+n.keyboardHeight+"px;"},[n.isInputExpanded?n._e():e("v-uni-view",{staticClass:"collapsed-bar",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.expandInput.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"collapsed-input-placeholder"},[n._v("留下你的精彩评论...")])],1),n.isInputExpanded?e("v-uni-view",{staticClass:"expanded-container"},[n.replyToComment?e("v-uni-view",{staticClass:"reply-prompt"},[e("v-uni-text",{staticClass:"reply-prompt-text"},[n._v("回复 "+n._s(n.replyToAuthor)+"：")]),e("v-uni-view",{staticClass:"cancel-reply",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.cancelReply.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"cancel-text"},[n._v("取消")])],1)],1):n._e(),e("v-uni-textarea",{staticClass:"expanded-textarea",attrs:{placeholder:"留下你的精彩评论...",value:n.newComment,focus:n.isFocus,"auto-height":!0,maxlength:"500","show-confirm-bar":!1,"adjust-position":!1},on:{input:function(t){arguments[0]=t=n.$handleEvent(t),n.onCommentInput.apply(void 0,arguments)},focus:function(t){arguments[0]=t=n.$handleEvent(t),n.onInputFocus.apply(void 0,arguments)},blur:function(t){arguments[0]=t=n.$handleEvent(t),n.onInputBlur.apply(void 0,arguments)}}}),n.commentImages.length?e("v-uni-view",{staticClass:"selected-comment-images"},n._l(n.commentImages,(function(t,o){return e("v-uni-view",{key:o,staticClass:"selected-image-item",attrs:{"data-index":o}},[e("v-uni-image",{staticClass:"selected-image-thumb",attrs:{src:t.previewUrl,mode:"aspectFill","data-index":o},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.previewSelectedCommentImage.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"remove-image-btn",attrs:{"data-index":o},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.removeCommentImage.apply(void 0,arguments)}}},[n._v("✕")])],1)})),1):n._e(),e("v-uni-view",{staticClass:"expanded-actions"},[e("v-uni-view",{staticClass:"action-icons"},[e("v-uni-view",{staticClass:"action-icon",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.chooseCommentImages.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"action-icon-text"},[n._v("🖼️")])],1),e("v-uni-view",{staticClass:"action-icon",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.toggleEmojiPanel.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"action-icon-text"},[n._v("😊")])],1)],1),e("v-uni-button",{staticClass:"submit-button",attrs:{disabled:n.isSubmitDisabled},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onSubmitComment.apply(void 0,arguments)}}},[n._v("发送")])],1),n.showEmojiPanel?e("v-uni-view",{staticClass:"emoji-panel"},n._l(n.emojiList,(function(t,o){return e("v-uni-text",{key:o,staticClass:"emoji-item",attrs:{"data-emoji":t},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.insertEmoji.apply(void 0,arguments)}}},[n._v(n._s(t))])})),1):n._e()],1):n._e()],1),e("cloud-tip-modal",{attrs:{showUploadTip:n.showUploadTip}}),e("folder-selector",{attrs:{show:n.showFavoriteModal,"post-id":n.post&&n.post._id?n.post._id:""},on:{hide:function(t){arguments[0]=t=n.$handleEvent(t),n.hideFavoriteModal.apply(void 0,arguments)},favoriteSuccess:function(t){arguments[0]=t=n.$handleEvent(t),n.onFavoriteSuccess.apply(void 0,arguments)}}})],1)},i=[]},daaa:function(n,t,e){"use strict";e.r(t);var o=e("9d3a"),a=e.n(o);for(var i in o)["default"].indexOf(i)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(i);t["default"]=a.a},df61:function(n,t,e){var o=e("dd7e").default,a=e("46c5").default;e("64aa"),e("bf0f"),e("7a76"),e("c9b5");var i=e("11ca"),r=i.cloudCall,s=e("fe58"),l=null;try{l=e("b99c")}catch(v){console.warn("[likeService] dataCache 不可用，跳过缓存同步")}function c(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=Number(n);return Number.isFinite(e)?e:t}function d(n,t,e){if("function"===typeof n)try{return n(t,e)}catch(v){console.warn("[likeService] likeIcon resolver 执行失败",v)}return s.getLikeIcon(t,e)}function u(n){var t=n.votes,e=n.isLiked,o=n.icon;return{votes:t,isLiked:e,likeIcon:o}}function m(n){if("undefined"!==typeof uni&&"function"===typeof uni.showToast)try{uni.showToast({title:n||"操作失败，请稍后重试",icon:"none"})}catch(v){console.warn("[likeService] showToast 调用失败",v)}}function f(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.pageTag,e=void 0===t?"like-service":t,o=n.context,a=void 0===o?null:o,i=n.currentVotes,r=void 0===i?0:i,l=n.currentIsLiked,d=void 0!==l&&l,u=n.likeIconResolver,m=void 0===u?s.getLikeIcon:u,f=n.requireAuth,p=void 0===f||f,v=n.retry,g=void 0===v?0:v,h=n.updateCache,w=void 0===h||h,b=n.showErrorToast,y=void 0===b||b,C=n.cloudOptions,x=void 0===C?{}:C;return{pageTag:e,context:a,currentVotes:c(r,0),currentIsLiked:Boolean(d),likeIconResolver:m,requireAuth:p,retry:g,updateCache:w,showErrorToast:y,cloudOptions:x}}function p(){return p=a(o().mark((function n(t){var e,a,i,s,p,v,g,h,w,b,y,C,x,k,_,I,F,T,P,D,E,S,z,U=arguments;return o().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e=U.length>1&&void 0!==U[1]?U[1]:{},t){n.next=3;break}return n.abrupt("return",Promise.reject(new Error("[likeService] postId 不能为空")));case 3:return a=f(e),i=a.pageTag,s=a.context,p=a.currentVotes,v=a.currentIsLiked,g=a.likeIconResolver,h=a.requireAuth,w=a.retry,b=a.updateCache,y=a.showErrorToast,C=a.cloudOptions,x=c(p,0),k=Boolean(v),_=d(g,x,k),I=u({votes:x,isLiked:k,icon:_}),n.prev=8,n.next=11,r("vote",{postId:t},Object.assign({pageTag:"likeService:".concat(i),context:s,requireAuth:h,retry:w},C));case 11:F=n.sent,n.next=19;break;case 14:return n.prev=14,n.t0=n["catch"](8),console.error("[likeService] 调用云函数失败",n.t0),y&&m(n.t0&&n.t0.message),n.abrupt("return",{success:!1,error:n.t0,rollback:I});case 19:if(T=F&&F.result?F.result:F,P=T&&!0===T.success,P){n.next=26;break}return D=T&&T.message?T.message:"操作失败，请稍后重试",console.warn("[likeService] 云函数返回失败结果",T),y&&m(D),n.abrupt("return",{success:!1,error:T,rollback:I});case 26:if(E=c(T.votes,x),S=Boolean(T.isLiked),z=d(g,E,S),b&&l&&"function"===typeof l.updatePostLikeInCache)try{l.updatePostLikeInCache(t,E,S,z)}catch(o){console.warn("[likeService] 同步缓存失败",o)}return n.abrupt("return",{success:!0,votes:E,isLiked:S,likeIcon:z,response:T});case 31:case"end":return n.stop()}}),n,null,[[8,14]])}))),p.apply(this,arguments)}n.exports={togglePostLike:function(n){return p.apply(this,arguments)}}},f0b9:function(n,t,e){var o=e("221b");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);var a=e("967d").default;a("9b847392",o,!0,{sourceMap:!1,shadowMode:!1})},f7a1:function(n,t,e){"use strict";e.r(t);var o=e("a6d2"),a=e("3ccb");for(var i in a)["default"].indexOf(i)<0&&function(n){e.d(t,n,(function(){return a[n]}))}(i);e("0691");var r=e("828b"),s=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,"a8601b98",null,!1,o["a"],void 0);t["default"]=s.exports},fe58:function(n,t){n.exports={getLikeIcon:function(n,t){var e="";return e=n<=3?t?"seedplus.png":"seed.png":n<=7?t?"leafplus.png":"leaf.png":n<=15?t?"flowerplus .png":"flower.png":t?"peachplus.png":"peach.png","/static/images/"+e},getLikeIconDescription:function(n){return n<=3?"种子":n<=7?"叶子":n<=15?"花":"果实"}}}}]);