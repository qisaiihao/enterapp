(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-profile-user-profile"],{"271e":function(n,r,t){"use strict";var e=t("cfa1"),a=t.n(e);a.a},"2ed3":function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=e(t("5de6"));t("bf0f"),t("18f7"),t("de6c"),t("2797"),t("c223");var o=t("a1cb"),i=t("962f"),s=i.formatRelativeTime,l=t("0123"),d=t("acbf"),c=t("edf3"),f=c.previewImage,u=t("38db"),g=u.cloudCall,h=t("9c8b"),w={mixins:[h],data:function(){return{userInfo:{avatarUrl:"",nickName:"",bio:""},isLoading:!1,userPosts:[],page:0,hasMore:!0,PAGE_SIZE:5,swiperHeights:{},imageClampHeights:{},targetUserId:"",showFollowButton:!1,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1,followPending:!1,imgindex:0,imageUrl:""}},onLoad:function(n){var r=this;console.log("【用户主页】页面加载,options:",n);var t=n.userId;if(!t)return uni.showToast({title:"用户信息获取失败",icon:"none"}),void uni.navigateBack();this.setData({targetUserId:t}),this.loadUserProfile();try{uni.$on&&uni.$on("avatar-updated",(function(n){n&&n.userId===r.targetUserId&&((0,o.invalidateUserInfo)(r.targetUserId),r.loadUserProfile())})),uni.$on&&uni.$on("post-created",(function(n){n&&n.userId===r.targetUserId&&((0,o.invalidateUserPosts)(r.targetUserId),r.setData({userPosts:[],page:0,hasMore:!0}),r.loadUserProfile())})),uni.$on&&uni.$on("favorite-changed",(function(n){n&&n.userId===r.targetUserId&&((0,o.invalidateUserPosts)(r.targetUserId),r.setData({userPosts:[],page:0,hasMore:!0}),r.loadUserProfile())}))}catch(e){}},onPullDownRefresh:function(){this.setData({userPosts:[],page:0,hasMore:!0,swiperHeights:{},imageClampHeights:{}}),this.loadUserProfile((function(){uni.stopPullDownRefresh()}))},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadUserPosts()},methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return g(n,r,Object.assign({pageTag:"user-profile",context:this},t))},loadUserProfile:function(n){var r=this;this.setData({isLoading:!0}),Promise.all([(0,o.getUserInfo)(this.targetUserId,this),(0,o.getUserPosts)({userId:this.targetUserId,page:0,pageSize:this.PAGE_SIZE,context:this})]).then((function(n){var t=(0,a.default)(n,2),e=t[0],o=t[1];o.forEach((function(n){n.createTime&&(n.formattedCreateTime=r.formatTime(n.createTime))})),r.setData({userInfo:e,userPosts:o,page:1,hasMore:o.length===r.PAGE_SIZE}),l.updateUserAvatar(r.targetUserId,e),r.prepareFollowStateWithCache(),uni.setNavigationBarTitle({title:e.nickName||"用户主页"})})).catch((function(n){console.error("【用户主页】缓存加载失败",n),uni.showToast({title:"网络异常，请稍后重试",icon:"none"})})).finally((function(){r.setData({isLoading:!1}),"function"===typeof n&&n()}))},loadUserPosts:function(){var n=this;if(!this.isLoading){var r=this.page,t=this.PAGE_SIZE;this.setData({isLoading:!0}),(0,o.getUserPosts)({userId:this.targetUserId,page:r,pageSize:t,context:this}).then((function(e){e.forEach((function(r){r.createTime&&(r.formattedCreateTime=n.formatTime(r.createTime))}));var a=n.userPosts.concat(e);n.setData({userPosts:a,page:r+1,hasMore:e.length===t})})).catch((function(n){console.error("【用户主页】加载更多帖子失败",n)})).finally((function(){n.setData({isLoading:!1})}))}},prepareFollowState:function(){var n=this.targetUserId,r=this.getCurrentUserId();n&&r&&n!==r?(this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(n)):this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1})},prepareFollowStateWithCache:function(){var n=this.targetUserId,r=this.getCurrentUserId();n&&r&&n!==r?(this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(n)):this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1})},fetchFollowStatusWithCache:function(n){var r=this;if(n){var t=this.getCurrentUserId();t&&d.getFollowStatus(t,n).then((function(n){n&&r.setData({isFollowing:n.isFollowing,isFollowedByTarget:n.isFollowedByAuthor,isMutualFollow:n.isMutualFollow})}))}},fetchFollowStatus:function(n){var r=this;n&&this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:n},{requireAuth:!0}).then((function(n){n.result&&n.result.success?r.setData({isFollowing:!!n.result.isFollowing,isFollowedByTarget:!!n.result.isFollower,isMutualFollow:!!n.result.isMutual}):console.warn("检查关注状态失败",n.result)})).catch((function(n){console.error("检查关注状态调用失败:",n)}))},onFollowTap:function(){var n=this;if(!this.followPending){var r=this.targetUserId;if(r){var t=this.getCurrentUserId();t?(this.setData({followPending:!0}),d.toggleFollowStatus(t,r).then((function(r){r?(n.setData({isFollowing:r.isFollowing,isFollowedByTarget:r.isFollowedByAuthor,isMutualFollow:r.isMutualFollow}),uni.showToast({title:r.isFollowing?"关注成功":"已取消关注",icon:"success"})):uni.showToast({title:"操作失败",icon:"none"})})).catch((function(n){console.error("切换关注状态失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({followPending:!1})}))):uni.showToast({title:"请先登录",icon:"none"})}}},getCurrentUserId:function(){return getApp().globalData.openid||uni.getStorageSync("openid")||uni.getStorageSync("userOpenId")},navigateToPostDetail:function(n){var r=n.currentTarget.dataset.id;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(r)})},handlePreview:function(n){return f(n,{fallbackToast:!1})},formatTime:function(n){return s(n)},onImageError:function(n){console.error("图片加载失败:",n.detail)},onAvatarError:function(n){console.error("头像加载失败:",n.detail)}}};r.default=w},"5a32":function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* pages/user-profile/user-profile.wxss */.container[data-v-7768392a]{min-height:100vh;background-color:#f7f8fa}\r\n/* 加载状态 */.loading-container[data-v-7768392a]{display:flex;justify-content:center;align-items:center;height:%?400?%;background-color:#fff;border-radius:%?16?%;margin:%?30?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.loading-text[data-v-7768392a]{font-size:%?28?%;color:#999}\r\n/* 用户信息头部 */.profile-header[data-v-7768392a]{background-color:#fff;padding:0 %?30?% %?40?% %?30?%;position:relative}.header-actions[data-v-7768392a]{display:flex;justify-content:space-between;align-items:center;padding:%?20?% 0;height:%?80?%}.action-btn[data-v-7768392a]{width:%?40?%;height:%?40?%;background-color:#f5f5f5;border-radius:%?20?%}.avatar-section[data-v-7768392a]{display:flex;justify-content:center;margin:%?20?% 0 %?30?% 0}.avatar-wrapper[data-v-7768392a]{position:relative}.user-avatar[data-v-7768392a]{width:%?120?%;height:%?120?%;border-radius:%?60?%;background-color:#f0f0f0}.user-info[data-v-7768392a]{text-align:center}.username[data-v-7768392a]{font-size:%?32?%;font-weight:600;color:#000;margin-bottom:%?12?%}.user-bio[data-v-7768392a]{font-size:%?24?%;color:#666;line-height:1.4;margin-bottom:%?30?%;padding:0 %?40?%}.follow-stats[data-v-7768392a]{display:flex;justify-content:center;gap:%?80?%;margin-bottom:%?30?%}.stat-item[data-v-7768392a]{text-align:center}.stat-number[data-v-7768392a]{font-size:%?28?%;font-weight:600;color:#000;margin-bottom:%?4?%}.stat-label[data-v-7768392a]{font-size:%?22?%;color:#999}.follow-section[data-v-7768392a]{display:flex;justify-content:center;align-items:center;gap:%?20?%}.follow-btn[data-v-7768392a]{padding:0 %?40?%;height:%?56?%;line-height:%?56?%;background-color:#007aff;color:#fff;border:none;border-radius:%?28?%;font-size:%?26?%;font-weight:500}.follow-btn.following[data-v-7768392a]{background-color:#f0f0f0;color:#666}.follow-btn[data-v-7768392a]::after{border:none}.follow-btn[disabled][data-v-7768392a]{opacity:.7}.mutual-indicator[data-v-7768392a],\r\n.followed-indicator[data-v-7768392a]{padding:%?8?% %?20?%;border-radius:%?20?%;font-size:%?22?%;background-color:#f0f8ff;color:#007aff}\r\n/* 帖子部分 */.posts-section[data-v-7768392a]{margin:%?20?% %?30?% %?30?% %?30?%}.section-title[data-v-7768392a]{font-size:%?32?%;font-weight:700;color:#333;margin-bottom:%?20?%;padding:0 %?10?%}.post-card[data-v-7768392a]{background:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);margin-bottom:%?20?%;box-sizing:border-box;padding:%?30?%;transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease}.post-card[data-v-7768392a]:active{-webkit-transform:translateY(%?2?%);transform:translateY(%?2?%);box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1)}.post-header[data-v-7768392a]{margin-bottom:%?15?%}.post-title[data-v-7768392a]{font-size:%?32?%;font-weight:700;color:#333;line-height:1.4;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}\r\n/* 图片容器 */.image-container[data-v-7768392a]{width:100%;margin:%?15?% 0}.image-swiper[data-v-7768392a]{width:100%;background-color:#fff;border-radius:%?12?%;overflow:hidden}.post-image[data-v-7768392a]{width:100%;height:100%;display:block;object-fit:contain;border-radius:%?12?%}.post-content[data-v-7768392a]{font-size:%?28?%;color:#666;line-height:1.5;margin:%?15?% 0;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;line-clamp:3;-webkit-box-orient:vertical}.post-footer[data-v-7768392a]{display:flex;justify-content:space-between;align-items:center;margin-top:%?20?%;padding-top:%?20?%;border-top:%?1?% solid #f0f0f0}.post-stats[data-v-7768392a]{display:flex;align-items:center;gap:%?20?%}.stat-item[data-v-7768392a]{font-size:%?26?%;color:#999}.post-time[data-v-7768392a]{font-size:%?24?%;color:#ccc}.empty-tip[data-v-7768392a]{text-align:center;color:#bbb;font-size:%?28?%;margin:%?40?% 0;padding:%?60?% 0;background-color:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}\r\n/* 资料详情（与我的主页风格一致） */.profile-detail-card[data-v-7768392a]{margin:0 %?30?% %?20?% %?30?%;padding:%?20?% %?24?%;background:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);display:flex;flex-wrap:wrap;gap:%?16?% %?24?%}.detail-item-inline[data-v-7768392a]{color:#666;font-size:%?28?%;margin-right:%?24?%}",""]),n.exports=r},9493:function(n,r,t){"use strict";t.d(r,"b",(function(){return e})),t.d(r,"c",(function(){return a})),t.d(r,"a",(function(){}));var e=function(){var n=this.$createElement,r=this._self._c||n;return r("v-uni-view",{staticClass:"container"})},a=[]},c045:function(n,r,t){"use strict";t.r(r);var e=t("9493"),a=t("f3ec");for(var o in a)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(o);t("271e");var i=t("828b"),s=Object(i["a"])(a["default"],e["b"],e["c"],!1,null,"7768392a",null,!1,e["a"],void 0);r["default"]=s.exports},cfa1:function(n,r,t){var e=t("5a32");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("23577b09",e,!0,{sourceMap:!1,shadowMode:!1})},f3ec:function(n,r,t){"use strict";t.r(r);var e=t("2ed3"),a=t.n(e);for(var o in e)["default"].indexOf(o)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(o);r["default"]=a.a}}]);