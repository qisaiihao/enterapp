(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-following-following"],{"31ae":function(t,e,n){"use strict";n.r(e);var i=n("54d5"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},"54d5":function(t,e,n){"use strict";n("6a54");var i=n("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("39d8"));n("bf0f"),n("c223"),n("8f71");var a=n("11ca"),l=a.cloudCall,s={data:function(){return{followings:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:20,pendingOpenid:null,defaultAvatar:"/images/avatar.png",total:"",avatarKey:""}},onLoad:function(){this.loadFollowings(!0)},onPullDownRefresh:function(){this.loadFollowings(!0)},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadFollowings()},methods:{callCloudFunction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(t,e,Object.assign({pageTag:"following",context:this,requireAuth:!0},n))},loadFollowings:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading){e&&this.setData({page:0,hasMore:!0});var n=e?0:this.page;this.setData({isLoading:!0});var i=this.$requireOpenid&&this.$requireOpenid();if(!i)return this.setData({isLoading:!1}),void(e&&uni.stopPullDownRefresh());this.callCloudFunction("follow",{action:"getFollowingList",skip:n*this.PAGE_SIZE,limit:this.PAGE_SIZE,openid:i}).then((function(i){if(i.result&&i.result.success){var o=i.result.list||[],a=e?o:t.followings.concat(o);t.setData({followings:a,page:n+1,hasMore:!!i.result.hasMore,total:i.result.total||a.length})}else uni.showToast({title:i.result&&i.result.message?i.result.message:"加载失败",icon:"none"})})).catch((function(t){console.error("获取关注列表失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),e&&uni.stopPullDownRefresh()}))}},onToggleFollow:function(t){var e=this,n=t.currentTarget.dataset.openid,i=t.currentTarget.dataset.index;if(n&&!this.pendingOpenid){this.setData({pendingOpenid:n});var o=this.$requireOpenid&&this.$requireOpenid();o?this.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:n,openid:o}).then((function(t){if(t.result&&t.result.success){var n=!!t.result.isFollowing;if(n)uni.showToast({title:"已关注",icon:"success"});else{var o=e.followings.filter((function(t,e){return e!==i}));e.setData({followings:o}),uni.showToast({title:"已取消关注",icon:"success"}),e.hasMore&&o.length<e.PAGE_SIZE&&e.loadFollowings(),0!==o.length||e.hasMore||e.setData({page:0})}}else uni.showToast({title:t.result&&t.result.message?t.result.message:"操作失败",icon:"none"})})).catch((function(t){console.error("取消关注失败:",t),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){e.setData({pendingOpenid:null})})):this.setData({pendingOpenid:null})}},onAvatarError:function(t){var e=t.currentTarget.dataset.index;if(void 0!==e){var n="followings[".concat(e,"].avatarUrl");this.setData((0,o.default)({},n,this.defaultAvatar))}},openUserProfile:function(t){var e=t.currentTarget.dataset.openid;e&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(e)})}}};e.default=s},7118:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"container"},[t.followings.length>0?[n("v-uni-view",{staticClass:"list"},t._l(t.followings,(function(e,i){return n("v-uni-view",{key:i,staticClass:"following-item"},[n("v-uni-view",{staticClass:"user-info",attrs:{"data-openid":e._openid},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openUserProfile.apply(void 0,arguments)}}},[n("v-uni-image",{staticClass:"avatar",attrs:{src:e.avatarUrl||t.defaultAvatar,mode:"aspectFill","data-index":i},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.onAvatarError.apply(void 0,arguments)}}}),n("v-uni-view",{staticClass:"info-text"},[n("v-uni-text",{staticClass:"name"},[t._v(t._s(e.nickName||"微信用户"))]),n("v-uni-text",{staticClass:"bio"},[t._v(t._s(e.bio||"这个用户还没有留下简介~"))])],1)],1),n("v-uni-button",{staticClass:"unfollow-btn",attrs:{size:"mini","data-openid":e._openid,"data-index":i,loading:t.pendingOpenid===e._openid,disabled:t.pendingOpenid===e._openid},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.onToggleFollow.apply(void 0,arguments)}}},[t._v("取消关注")])],1)})),1)]:n("v-uni-view",{staticClass:"empty"},[n("v-uni-text",[t._v("还没有关注任何人，去广场看看吧～")])],1),t.followings.length>0?n("v-uni-view",{staticClass:"footer-hint"},[t.hasMore?t._e():n("v-uni-view",{staticClass:"loading-more"},[t._v("已经到底了")])],1):t._e()],2)},o=[]},"9b09":function(t,e,n){"use strict";n.r(e);var i=n("7118"),o=n("31ae");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("d1fc");var l=n("828b"),s=Object(l["a"])(o["default"],i["b"],i["c"],!1,null,"1405bb82",null,!1,i["a"],void 0);e["default"]=s.exports},a20f:function(t,e,n){var i=n("d5e5");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n("967d").default;o("498775d0",i,!0,{sourceMap:!1,shadowMode:!1})},d1fc:function(t,e,n){"use strict";var i=n("a20f"),o=n.n(i);o.a},d5e5:function(t,e,n){var i=n("c86c");e=i(!1),e.push([t.i,".container[data-v-1405bb82]{padding:%?32?%;background-color:#f7f8fa;min-height:100vh}.list[data-v-1405bb82]{display:flex;flex-direction:column;gap:%?24?%}.following-item[data-v-1405bb82]{display:flex;align-items:center;justify-content:space-between;background-color:#fff;border-radius:%?16?%;padding:%?24?% %?28?%;box-shadow:0 %?6?% %?18?% rgba(0,0,0,.05)}.user-info[data-v-1405bb82]{display:flex;align-items:center;flex:1;overflow:hidden}.avatar[data-v-1405bb82]{width:%?88?%;height:%?88?%;border-radius:50%;margin-right:%?20?%;background-color:#f0f0f0}.info-text[data-v-1405bb82]{display:flex;flex-direction:column;gap:%?8?%;overflow:hidden}.name[data-v-1405bb82]{font-size:%?30?%;color:#333;font-weight:600}.bio[data-v-1405bb82]{font-size:%?24?%;color:#888;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:%?420?%}.unfollow-btn[data-v-1405bb82]{margin-left:%?24?%;border:%?2?% solid #ff8f8f;color:#ff6b6b;background-color:#fff;border-radius:%?999?%;padding:0 %?28?%;height:%?64?%!important;line-height:%?64?%!important}.unfollow-btn[data-v-1405bb82]::after{border:none}.unfollow-btn[disabled][data-v-1405bb82]{opacity:.6}.loading[data-v-1405bb82],\r\n.loading-more[data-v-1405bb82]{margin-top:%?32?%;text-align:center;color:#999;font-size:%?26?%}.empty[data-v-1405bb82]{margin-top:%?120?%;text-align:center;color:#999;font-size:%?28?%}.footer-hint[data-v-1405bb82]{margin-top:%?24?%}.mutual-label[data-v-1405bb82]{margin-top:%?8?%;display:inline-block;padding:%?4?% %?16?%;background-color:#e6f4ff;color:#1f6fd2;border-radius:%?999?%;font-size:%?24?%}",""]),t.exports=e}}]);