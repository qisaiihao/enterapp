(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-login-login"],{"0330":function(n,r,e){"use strict";e.d(r,"b",(function(){return t})),e.d(r,"c",(function(){return o})),e.d(r,"a",(function(){}));var t=function(){var n=this,r=n.$createElement,e=n._self._c||r;return e("v-uni-view",[e("v-uni-view",{staticClass:"container"},[e("v-uni-view",{staticClass:"title"},[n._v("欢迎回到回车键")]),e("v-uni-view",{staticClass:"subtitle"},[n._v("请输入你的账号信息登录")]),e("v-uni-view",{staticClass:"form-wrapper"},[e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("Poem ID")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"text",placeholder:"请输入你的Poem ID"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onPoemIdInput.apply(void 0,arguments)}},model:{value:n.poemId,callback:function(r){n.poemId=r},expression:"poemId"}})],1),e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("密码")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"password",placeholder:"请输入密码"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onPasswordInput.apply(void 0,arguments)}},model:{value:n.password,callback:function(r){n.password=r},expression:"password"}})],1),e("v-uni-button",{staticClass:"login-button",class:{loading:n.isLogging},attrs:{disabled:!n.canLogin||n.isLogging},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onLogin.apply(void 0,arguments)}}},[n._v(n._s(n.isLogging?"登录中...":"登录"))]),e("v-uni-view",{staticClass:"register-link-wrapper"},[e("v-uni-text",{staticClass:"register-text"},[n._v("还没有账号？")]),e("v-uni-text",{staticClass:"register-link",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.goToRegister.apply(void 0,arguments)}}},[n._v("立即注册")])],1)],1)],1)],1)},o=[]},"0544":function(n,r,e){"use strict";e("6a54");var t=e("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=t(e("2634")),a=t(e("2fdc"));e("0c26");getApp();var i=e("11ca"),s=i.cloudCall,c={data:function(){return{poemId:"",password:"",isLogging:!1}},computed:{canLogin:function(){return this.poemId.trim()&&this.password.trim()}},onLoad:function(){console.log("🔍 [登录页面] 页面加载"),this.checkAndInitializeOpenid(),this.tryAutoRedirect()},methods:{tryAutoRedirect:function(){try{var n=uni.getStorageSync("userInfo"),r=uni.getStorageSync("userOpenId");if(n&&(n._openid||r)){var e=getApp();e.globalData=e.globalData||{},e.globalData.userInfo=n,e.globalData.openid=n._openid||r,e.globalData._loginProcessCompleted=!0,console.log("✅ [登录页面] 检测到已登录用户，自动跳转"),uni.switchTab({url:"/pages/poem/poem"})}}catch(t){console.log("⚠️ [登录页面] 自动跳转检查失败(忽略)：",t)}},checkAndInitializeOpenid:function(){console.log("🔍 [登录页面] 检查openid状态");var n=getApp(),r=n&&n.globalData&&n.globalData.openid;r?console.log("✅ [登录页面] openid已存在:",n.globalData.openid):(console.log("⚠️ [登录页面] 未检测到openid，尝试重新初始化"),this.initializeAnonymousOpenid())},initializeAnonymousOpenid:function(){console.log("🔄 [登录页面] 初始化匿名openid"),this.$tcb&&this.$tcb.callFunction?this.$tcb.callFunction({name:"login"}).then((function(n){console.log("✅ [登录页面] 匿名openid初始化成功:",n);var r=null;if(n.result&&n.result.openid?r=n.result.openid:n.openid?r=n.openid:n.result&&n.result.uid&&(r=n.result.uid),r){var e=getApp();e&&e.globalData&&(e.globalData.openid=r,console.log("✅ [登录页面] 匿名openid已设置:",r)),uni.setStorageSync("userOpenId",r)}else console.error("❌ [登录页面] 无法获取匿名openid")})).catch((function(n){console.error("❌ [登录页面] 匿名openid初始化失败:",n)})):console.error("❌ [登录页面] TCB实例不可用，无法初始化openid")},callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(n,r,Object.assign({pageTag:"login",context:this},e))},onPoemIdInput:function(n){this.poemId=n.detail.value},onPasswordInput:function(n){this.password=n.detail.value},onLogin:function(){var n=this;return(0,a.default)((0,o.default)().mark((function r(){var e,t,a,i,s,c,u;return(0,o.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.canLogin&&!n.isLogging){r.next=2;break}return r.abrupt("return");case 2:return n.isLogging=!0,uni.showLoading({title:"登录中...",mask:!0}),r.prev=4,r.next=7,n.callCloudFunction("loginWithCredentials",{poemId:n.poemId.trim(),password:n.password.trim()});case 7:e=r.sent,console.log("🔍 [登录] 云函数返回结果:",e),e.result&&e.result.success?(t=e.result.userInfo,a=e.result.openid,console.log("✅ [登录] 登录成功:",t),i=getApp(),s=Object.assign({},t||{},{_openid:a}),i.globalData.userInfo=s,i.globalData.openid=a,i.globalData._loginProcessCompleted=!0,uni.setStorageSync("userInfo",s),uni.setStorageSync("userOpenId",a),uni.showToast({title:"登录成功",icon:"success"}),setTimeout((function(){uni.switchTab({url:"/pages/poem/poem"})}),1e3)):(u=(null===(c=e.result)||void 0===c?void 0:c.message)||"登录失败，请检查账号密码",uni.showToast({title:u,icon:"none",duration:3e3})),r.next=16;break;case 12:r.prev=12,r.t0=r["catch"](4),console.error("❌ [登录] 登录失败:",r.t0),uni.showToast({title:"登录失败，请重试",icon:"none",duration:3e3});case 16:return r.prev=16,uni.hideLoading(),n.isLogging=!1,r.finish(16);case 20:case"end":return r.stop()}}),r,null,[[4,12,16,20]])})))()},goToRegister:function(){uni.navigateTo({url:"/pages/register/register"})}}};r.default=c},"088d":function(n,r,e){var t=e("3582");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[n.i,t,""]]),t.locals&&(n.exports=t.locals);var o=e("967d").default;o("4997cceb",t,!0,{sourceMap:!1,shadowMode:!1})},3582:function(n,r,e){var t=e("c86c");r=t(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* 新的登录页面样式 */.container[data-v-0c79ba94]{display:flex;flex-direction:column;align-items:center;padding:%?120?% %?60?% %?60?%;height:100vh;background:linear-gradient(135deg,#f5f7fa,#c3cfe2)}.title[data-v-0c79ba94]{font-size:%?56?%;font-weight:700;margin-bottom:%?20?%;color:#333;text-align:center}.subtitle[data-v-0c79ba94]{font-size:%?28?%;color:#666;margin-bottom:%?100?%;text-align:center}.form-wrapper[data-v-0c79ba94]{width:100%;max-width:%?600?%}.input-wrapper[data-v-0c79ba94]{margin-bottom:%?40?%;background:#fff;border-radius:%?16?%;padding:%?30?%;box-shadow:0 %?4?% %?20?% rgba(0,0,0,.1)}.input-label[data-v-0c79ba94]{display:block;font-size:%?28?%;color:#333;margin-bottom:%?20?%;font-weight:500}.input-field[data-v-0c79ba94]{width:100%;font-size:%?32?%;color:#333;border:none;outline:none;background:transparent}.input-field[data-v-0c79ba94]::-webkit-input-placeholder{color:#999}.input-field[data-v-0c79ba94]::placeholder{color:#999}.login-button[data-v-0c79ba94]{width:100%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:%?32?%;font-weight:500;border-radius:%?16?%;padding:%?30?%;margin:%?60?% 0 %?40?%;border:none;box-shadow:0 %?8?% %?25?% rgba(102,126,234,.3);transition:all .3s ease}.login-button[data-v-0c79ba94]:active{-webkit-transform:translateY(%?2?%);transform:translateY(%?2?%);box-shadow:0 %?4?% %?15?% rgba(102,126,234,.3)}.login-button[data-v-0c79ba94]:disabled{background:#ccc;box-shadow:none;-webkit-transform:none;transform:none}.login-button.loading[data-v-0c79ba94]{background:#ccc;box-shadow:none}.register-link-wrapper[data-v-0c79ba94]{display:flex;justify-content:center;align-items:center;margin-top:%?40?%}.register-text[data-v-0c79ba94]{font-size:%?28?%;color:#666;margin-right:%?10?%}.register-link[data-v-0c79ba94]{font-size:%?28?%;color:#667eea;font-weight:500;text-decoration:underline}",""]),n.exports=r},"8f35":function(n,r,e){"use strict";var t=e("088d"),o=e.n(t);o.a},"967d":function(n,r,e){"use strict";function t(n,r){for(var e=[],t={},o=0;o<r.length;o++){var a=r[o],i=a[0],s=a[1],c=a[2],u=a[3],l={id:n+":"+o,css:s,media:c,sourceMap:u};t[i]?t[i].parts.push(l):e.push(t[i]={id:i,parts:[l]})}return e}e.r(r),e.d(r,"default",(function(){return f}));var o="undefined"!==typeof document;if("undefined"!==typeof DEBUG&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var a={},i=o&&(document.head||document.getElementsByTagName("head")[0]),s=null,c=0,u=!1,l=function(){},d=null,p="undefined"!==typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(n,r,e,o){u=e,d=o||{};var i=t(n,r);return g(i),function(r){for(var e=[],o=0;o<i.length;o++){var s=i[o],c=a[s.id];c.refs--,e.push(c)}r?(i=t(n,r),g(i)):i=[];for(o=0;o<e.length;o++){c=e[o];if(0===c.refs){for(var u=0;u<c.parts.length;u++)c.parts[u]();delete a[c.id]}}}}function g(n){for(var r=0;r<n.length;r++){var e=n[r],t=a[e.id];if(t){t.refs++;for(var o=0;o<t.parts.length;o++)t.parts[o](e.parts[o]);for(;o<e.parts.length;o++)t.parts.push(b(e.parts[o]));t.parts.length>e.parts.length&&(t.parts.length=e.parts.length)}else{var i=[];for(o=0;o<e.parts.length;o++)i.push(b(e.parts[o]));a[e.id]={id:e.id,refs:1,parts:i}}}}function v(){var n=document.createElement("style");return n.type="text/css",i.appendChild(n),n}function b(n){var r,e,t=document.querySelector('style[data-vue-ssr-id~="'+n.id+'"]');if(t){if(u)return l;t.parentNode.removeChild(t)}if(p){var o=c++;t=s||(s=v()),r=m.bind(null,t,o,!1),e=m.bind(null,t,o,!0)}else t=v(),r=w.bind(null,t),e=function(){t.parentNode.removeChild(t)};return r(n),function(t){if(t){if(t.css===n.css&&t.media===n.media&&t.sourceMap===n.sourceMap)return;r(n=t)}else e()}}var h=function(){var n=[];return function(r,e){return n[r]=e,n.filter(Boolean).join("\n")}}();function m(n,r,e,t){var o=e?"":T(t.css);if(n.styleSheet)n.styleSheet.cssText=h(r,o);else{var a=document.createTextNode(o),i=n.childNodes;i[r]&&n.removeChild(i[r]),i.length?n.insertBefore(a,i[r]):n.appendChild(a)}}function w(n,r){var e=T(r.css),t=r.media,o=r.sourceMap;if(t&&n.setAttribute("media",t),d.ssrId&&n.setAttribute("data-vue-ssr-id",r.id),o&&(e+="\n/*# sourceURL="+o.sources[0]+" */",e+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),n.styleSheet)n.styleSheet.cssText=e;else{while(n.firstChild)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}var y=/%\?([+-]?\d+(\.\d+)?)\?%/g,x=/\.\?%PAGE\?%/g,C=/\?%PAGE\?%\[data-v-[a-z0-9]{8}\]/g,I=/uni-page-body\[data-v-[a-z0-9]{8}\]/g,k=/var\(--status-bar-height\)/gi,A=/var\(--window-top\)/gi,L=/var\(--window-bottom\)/gi,S=/var\(--window-left\)/gi,_=/var\(--window-right\)/gi;function T(n){var r=function(){var n="function"===typeof getApp&&getApp();return n&&n.$route&&n.$route.meta&&n.$route.meta.name||""}();if("undefined"!==typeof uni&&!uni.canIUse("css.var")){var e=function(){var n="function"===typeof getApp&&getApp();if(n&&n.$route&&n.$route.meta&&n.$route.meta.name)return{top:n.$route.meta.windowTop,bottom:n.$route.meta.isTabBar?50:0};return{top:0,bottom:0}}();n=n.replace(k,"0px").replace(A,e.top+"px").replace(L,e.bottom+"px").replace(S,"0px").replace(_,"0px")}return n.replace(C,r).replace(x,"").replace(I,"body."+r+" uni-page-body").replace(/\{[\s\S]+?\}|@media.+?\{/g,(function(n){return"undefined"===typeof uni?n:n.replace(y,(function(n,r){return uni.upx2px(r)+"px"}))}))}},b29a:function(n,r,e){"use strict";e.r(r);var t=e("0544"),o=e.n(t);for(var a in t)["default"].indexOf(a)<0&&function(n){e.d(r,n,(function(){return t[n]}))}(a);r["default"]=o.a},c86c:function(n,r,e){"use strict";n.exports=function(n){var r=[];return r.toString=function(){return this.map((function(r){var e=function(n,r){var e=n[1]||"",t=n[3];if(!t)return e;if(r&&"function"===typeof btoa){var o=function(n){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),e="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r);return"/*# ".concat(e," */")}(t),a=t.sources.map((function(n){return"/*# sourceURL=".concat(t.sourceRoot||"").concat(n," */")}));return[e].concat(a).concat([o]).join("\n")}return[e].join("\n")}(r,n);return r[2]?"@media ".concat(r[2]," {").concat(e,"}"):e})).join("")},r.i=function(n,e,t){"string"===typeof n&&(n=[[null,n,""]]);var o={};if(t)for(var a=0;a<this.length;a++){var i=this[a][0];null!=i&&(o[i]=!0)}for(var s=0;s<n.length;s++){var c=[].concat(n[s]);t&&o[c[0]]||(e&&(c[2]?c[2]="".concat(e," and ").concat(c[2]):c[2]=e),r.push(c))}},r}},fb04:function(n,r,e){"use strict";e.r(r);var t=e("0330"),o=e("b29a");for(var a in o)["default"].indexOf(a)<0&&function(n){e.d(r,n,(function(){return o[n]}))}(a);e("8f35");var i=e("828b"),s=Object(i["a"])(o["default"],t["b"],t["c"],!1,null,"0c79ba94",null,!1,t["a"],void 0);r["default"]=s.exports}}]);