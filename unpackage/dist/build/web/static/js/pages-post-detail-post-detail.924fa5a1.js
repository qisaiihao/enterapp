(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-post-detail-post-detail"],{"05ef":function(n,t,e){"use strict";e("6a54");var o=e("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.hydrateTempUrls=function(){return l.apply(this,arguments)},t.warmTempUrlsFromPosts=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new Set;n.forEach((function(n){return s(n).forEach((function(n){return t.add(n)}))})),t.size>0&&r.default.warm(Array.from(t))};var i=o(e("2634")),a=o(e("2fdc"));e("9db6"),e("aa9c"),e("bf0f"),e("2797"),e("f3f7"),e("18f7"),e("de6c"),e("08eb"),e("fd3c");var r=o(e("9384"));function s(n){var t=[],e=function(n){"string"===typeof n&&n.startsWith("cloud://")&&t.push(n)};return e(n.imageUrl),e(n.originalImageUrl),e(n.authorAvatar),e(n.poemBgImage),Array.isArray(n.imageUrls)&&n.imageUrls.forEach(e),Array.isArray(n.originalImageUrls)&&n.originalImageUrls.forEach(e),t}function l(){return l=(0,a.default)((0,i.default)().mark((function n(){var t,e,o,a,l=arguments;return(0,i.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:[],Array.isArray(t)&&0!==t.length){n.next=3;break}return n.abrupt("return",t);case 3:if(e=new Set,t.forEach((function(n){return s(n).forEach((function(n){return e.add(n)}))})),0!==e.size){n.next=7;break}return n.abrupt("return",t);case 7:return n.next=9,r.default.getTempUrls(Array.from(e));case 9:return o=n.sent,a=function(n){return"string"===typeof n&&o[n]?o[n]:n},t.forEach((function(n){n.imageUrl&&(n.imageUrl=a(n.imageUrl)),n.originalImageUrl&&(n.originalImageUrl=a(n.originalImageUrl)),n.authorAvatar&&(n.authorAvatar=a(n.authorAvatar)),n.poemBgImage&&(n.poemBgImage=a(n.poemBgImage)),Array.isArray(n.imageUrls)&&(n.imageUrls=n.imageUrls.map(a)),Array.isArray(n.originalImageUrls)&&(n.originalImageUrls=n.originalImageUrls.map(a))})),n.abrupt("return",t);case 13:case"end":return n.stop()}}),n)}))),l.apply(this,arguments)}},"148e":function(n,t,e){var o=e("c86c");t=o(!1),t.push([n.i,'\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* pages/post-detail/post-detail.wxss */\n\n/* 自定义返回按钮 */.custom-back-btn[data-v-1915049e]{position:absolute;top:calc(%?90?% + env(safe-area-inset-top, var(--safe-area-inset-top, 44px))); /* 添加安全区域偏移 */left:%?40?%;width:%?100?%;height:%?100?%;background:transparent;border:none;display:block;z-index:100;transition:all .2s ease;box-sizing:border-box}.custom-back-btn[data-v-1915049e]:active{-webkit-transform:scale(.95);transform:scale(.95)}.custom-back-btn .back-icon[data-v-1915049e]{width:%?100?%;height:%?100?%;display:block;object-fit:contain}.container[data-v-1915049e]{background-color:#fff;min-height:100vh;padding-bottom:%?140?%;padding-top:calc(%?160?% + env(safe-area-inset-top, var(--safe-area-inset-top, 44px))); /* 添加安全区域上边距 */position:relative /* 为返回按钮提供定位上下文 */}.post-detail-skeleton[data-v-1915049e]{padding:0}.skeleton-wrapper[data-v-1915049e]{background:#fff;padding:%?40?% %?40?% %?20?% %?40?%;border-bottom:%?1?% solid #f0f0f0;margin-bottom:0}.comment-skeleton-item[data-v-1915049e]{display:flex;align-items:flex-start;background-color:#fff;padding:%?20?% %?40?%;border-bottom:%?1?% solid #f5f5f5}.skeleton-header[data-v-1915049e]{display:flex;align-items:center;margin-bottom:%?24?%}.skeleton-avatar[data-v-1915049e]{width:%?88?%;height:%?88?%;border-radius:50%;background-color:#e9edf3}.skeleton-header-text[data-v-1915049e]{flex:1;margin-left:%?24?%}.skeleton-line[data-v-1915049e]{height:%?24?%;background-color:#e9edf3;border-radius:%?999?%;margin-bottom:%?16?%}.skeleton-line[data-v-1915049e]:last-child{margin-bottom:0}.skeleton-line.long[data-v-1915049e]{width:100%}.skeleton-line.medium[data-v-1915049e]{width:70%}.skeleton-line.short[data-v-1915049e]{width:45%}.skeleton-line.xshort[data-v-1915049e]{width:30%}.skeleton-image[data-v-1915049e]{width:100%;height:%?340?%;border-radius:%?20?%;background-color:#e9edf3;margin:%?30?% 0}.skeleton-section-title[data-v-1915049e]{width:50%;height:%?28?%;border-radius:%?999?%;background-color:#e9edf3;margin:%?10?% 0 %?30?%}.comment-skeleton-list[data-v-1915049e]{display:flex;flex-direction:column;gap:%?24?%}.comment-skeleton-item[data-v-1915049e]{display:flex;align-items:flex-start;background-color:#fff;border-radius:%?16?%;padding:%?24?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.comment-skeleton-body[data-v-1915049e]{flex:1;margin-left:%?24?%}.comment-skeleton-body .skeleton-line[data-v-1915049e]{height:%?20?%}.skeleton-animate[data-v-1915049e]{position:relative;overflow:hidden}.skeleton-animate[data-v-1915049e]::after{content:"";position:absolute;top:0;left:-150%;width:150%;height:100%;background:linear-gradient(90deg,rgba(233,237,243,0),hsla(0,0%,100%,.9) 50%,rgba(233,237,243,0));-webkit-animation:skeletonPulse-data-v-1915049e 1.2s ease-in-out infinite;animation:skeletonPulse-data-v-1915049e 1.2s ease-in-out infinite}@-webkit-keyframes skeletonPulse-data-v-1915049e{0%{left:-150%}100%{left:100%}}@keyframes skeletonPulse-data-v-1915049e{0%{left:-150%}100%{left:100%}}.error-container[data-v-1915049e]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% %?40?%;text-align:center}.error-icon[data-v-1915049e]{font-size:%?120?%;margin-bottom:%?30?%;opacity:.6}.error-text[data-v-1915049e]{font-size:%?32?%;color:#666}.post-detail-wrapper[data-v-1915049e]{background:#fff;padding:%?40?% %?40?% %?20?% %?40?%;border-bottom:%?1?% solid #f0f0f0;margin-bottom:0}.post-detail-wrapper.original-post[data-v-1915049e]{background:linear-gradient(90deg,rgba(235,200,141,.05),hsla(0,0%,100%,0));border-left:%?3?% solid #ebc88d;position:relative}.author-info[data-v-1915049e]{display:flex;align-items:center;justify-content:flex-start;margin-bottom:%?20?%;gap:%?20?%}.author-basic[data-v-1915049e]{display:flex;align-items:center;flex:1;min-width:0;gap:%?12?%;flex-wrap:wrap}.follow-btn[data-v-1915049e]{padding:0 %?28?%;height:%?60?%;line-height:%?60?%;background-color:#9ed7ee;color:#fff;border:none;border-radius:%?999?%;font-size:%?26?%;flex-shrink:0;margin-left:auto}.follow-btn.following[data-v-1915049e]{background-color:#f0f0f0;color:#666}.follow-btn[data-v-1915049e]::after{border:none}.follow-btn[disabled][data-v-1915049e]{opacity:.7}.author-avatar[data-v-1915049e]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;background-color:#f5f5f5}.author-name[data-v-1915049e]{font-weight:700;font-size:%?28?%;color:#333}.post-title[data-v-1915049e]{font-size:%?36?%;font-weight:700;margin-bottom:%?15?%;line-height:1.4;color:#333;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.poem-author[data-v-1915049e]{font-size:%?28?%;color:#333;text-align:left;margin:%?10?% 0 %?15?% 0;font-weight:700;letter-spacing:%?2?%}.post-content[data-v-1915049e]{font-size:%?28?%;line-height:1.6;margin-bottom:%?20?%;white-space:pre-wrap;color:#666;word-break:break-word}.image-container[data-v-1915049e]{position:relative;width:100%;margin:%?20?% 0;background-color:#f5f5f5}.post-image[data-v-1915049e]{width:100%;height:auto;display:block;background-color:#f5f5f5;transition:-webkit-transform .3s ease;transition:transform .3s ease;transition:transform .3s ease,-webkit-transform .3s ease}.post-image[data-v-1915049e]:active{-webkit-transform:scale(1.05);transform:scale(1.05)}.post-image.single-image[data-v-1915049e]{width:100%!important;height:auto!important;display:block!important;background-color:#f5f5f5}.image-count-indicator[data-v-1915049e]{position:absolute;top:%?20?%;right:%?20?%;background-color:rgba(0,0,0,.6);color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%;z-index:10;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}.post-meta[data-v-1915049e]{margin-bottom:%?15?%}.post-time[data-v-1915049e]{font-size:%?24?%;color:#999;opacity:.8}.vote-section[data-v-1915049e]{display:flex;justify-content:flex-end;align-items:center;margin-top:%?10?%;padding:%?10?% %?40?% 0 %?40?%}.actions-left[data-v-1915049e]{display:flex;align-items:center}.vote-count[data-v-1915049e],\n.comment-count[data-v-1915049e]{display:flex;align-items:center;font-size:%?28?%;color:#999;margin-left:%?10?%;transition:color .2s ease}.action-emoji[data-v-1915049e]{font-size:%?28?%;margin-right:%?8?%}.action-text[data-v-1915049e]{font-size:%?28?%;color:inherit}.like-icon-container[data-v-1915049e]{display:flex;align-items:center;justify-content:center;padding:%?12?%;border-radius:%?12?%;transition:all .2s ease;width:%?60?%;height:%?60?%;margin-right:%?12?%}.like-icon-container[data-v-1915049e]:active{-webkit-transform:scale(.95);transform:scale(.95)}.vote-count.voted[data-v-1915049e]{color:#ff4757}.button-group[data-v-1915049e]{display:flex;align-items:center}.favorite-icon-container[data-v-1915049e]{margin-right:%?12?%;display:flex;align-items:center;justify-content:center;padding:%?12?%;border-radius:%?12?%;transition:all .2s ease;width:%?60?%;height:%?60?%}.favorite-icon-container[data-v-1915049e]:active{-webkit-transform:scale(.95);transform:scale(.95)}.favorite-icon[data-v-1915049e]{width:%?56?%;height:%?56?%;opacity:1}.favorite-icon-container.favorited .favorite-icon[data-v-1915049e]{opacity:.6}.portfolio-icon-container[data-v-1915049e]{margin-right:%?12?%;display:flex;align-items:center;justify-content:center;padding:%?12?%;border-radius:%?12?%;transition:all .2s ease;width:%?60?%;height:%?60?%}.portfolio-icon-container[data-v-1915049e]:active{-webkit-transform:scale(.95);transform:scale(.95)}.portfolio-icon[data-v-1915049e]{width:%?56?%;height:%?56?%}.discussion-icon-container[data-v-1915049e]{margin-right:%?12?%;display:flex;align-items:center;justify-content:center;padding:%?12?%;border-radius:%?12?%;transition:all .2s ease;width:%?60?%;height:%?60?%}.discussion-icon-container[data-v-1915049e]:active{-webkit-transform:scale(.95);transform:scale(.95)}.discussion-icon[data-v-1915049e]{width:%?56?%;height:%?56?%}.comment-icon-container[data-v-1915049e]{margin-right:0;display:flex;align-items:center;justify-content:center;padding:%?12?%;border-radius:%?12?%;transition:all .2s ease;width:%?60?%;height:%?60?%}.comment-icon-container[data-v-1915049e]:active{-webkit-transform:scale(.95);transform:scale(.95)}.comment-icon[data-v-1915049e]{width:%?56?%;height:%?56?%}.like-icon[data-v-1915049e]{width:%?56?%;height:%?56?%}.comment-section[data-v-1915049e]{background:#fff;padding:%?30?% %?40?%;border-bottom:%?1?% solid #f0f0f0}.section-title[data-v-1915049e]{font-size:%?26?%;font-weight:400;margin-bottom:%?20?%;padding-bottom:%?15?%;border-bottom:%?1?% solid #f0f0f0;color:#999;margin-left:0;text-align:left}.comment-list[data-v-1915049e]{margin-top:%?20?%}.comment-item[data-v-1915049e]{display:flex;margin-bottom:0;padding:%?20?% 0;border-bottom:%?1?% solid #f0f0f0}.comment-item[data-v-1915049e]:last-child{border-bottom:none;margin-bottom:0}.comment-avatar[data-v-1915049e]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%;flex-shrink:0;background-color:#f5f5f5;margin-left:0}.comment-main[data-v-1915049e]{display:flex;flex-direction:column;flex:1;min-width:0}.comment-author[data-v-1915049e]{font-size:%?28?%;color:#333;font-weight:700;margin-bottom:%?8?%}.comment-content[data-v-1915049e]{font-size:%?28?%;color:#666;line-height:1.5;word-break:break-word;margin-bottom:%?10?%}.comment-image-grid[data-v-1915049e]{display:flex;flex-direction:column;gap:%?12?%;margin-bottom:%?12?%}.comment-image[data-v-1915049e]{width:100%;height:%?400?%;border-radius:%?12?%;background-color:#f2f2f2;display:block;object-fit:cover}.reply-image-grid[data-v-1915049e]{margin-top:%?10?%}.comment-footer[data-v-1915049e]{display:flex;justify-content:space-between;align-items:center;width:100%;margin-right:%?40?%}.comment-time[data-v-1915049e]{font-size:%?24?%;color:#999;opacity:.8}.comment-actions[data-v-1915049e]{display:flex;align-items:center}.like-section[data-v-1915049e]{display:flex;align-items:center;padding:%?8?% %?12?%;margin-right:%?15?%;transition:all .2s ease}.like-section[data-v-1915049e]:active{-webkit-transform:scale(.95);transform:scale(.95)}.like-section .like-icon[data-v-1915049e]{width:%?32?%;height:%?32?%;margin-right:%?8?%}.like-count[data-v-1915049e]{font-size:%?26?%;color:#666}.delete-btn[data-v-1915049e]{display:flex;align-items:center;padding:%?8?% %?12?%;margin-right:%?15?%;transition:opacity .2s ease}.delete-btn[data-v-1915049e]:active{opacity:.7}.delete-text[data-v-1915049e]{font-size:%?26?%;color:#ff4d4f}.reply-btn[data-v-1915049e]{display:flex;align-items:center;padding:%?8?% %?12?%;transition:opacity .2s ease}.reply-btn[data-v-1915049e]:active{opacity:.7}.reply-text[data-v-1915049e]{font-size:%?26?%;color:#9ed7ee}.replies-container[data-v-1915049e]{margin-top:%?15?%;margin-left:%?10?%;padding-left:%?10?%;border-left:%?2?% solid #f0f0f0}.reply-item[data-v-1915049e]{display:flex;margin-bottom:%?15?%}.reply-avatar[data-v-1915049e]{width:%?40?%;height:%?40?%;border-radius:50%;margin-right:%?10?%;flex-shrink:0;background-color:#f5f5f5}.reply-main[data-v-1915049e]{display:flex;flex-direction:column;flex:1;min-width:0}.reply-author[data-v-1915049e]{font-size:%?24?%;color:#333;font-weight:700;margin-bottom:%?4?%}.reply-content[data-v-1915049e]{font-size:%?26?%;color:#666;line-height:1.4;word-break:break-word}.reply-to[data-v-1915049e]{color:#9ed7ee;font-weight:700}.reply-footer[data-v-1915049e]{display:flex;justify-content:space-between;align-items:center;margin-top:%?8?%}.reply-time[data-v-1915049e]{font-size:%?22?%;color:#999;opacity:.8}.reply-actions[data-v-1915049e]{display:flex;align-items:center}.show-more-replies[data-v-1915049e]{padding:%?10?% 0;transition:opacity .2s ease}.show-more-replies[data-v-1915049e]:active{opacity:.7}.show-more-text[data-v-1915049e]{font-size:%?24?%;color:#9ed7ee}.no-comment-tip[data-v-1915049e]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?60?% %?40?%;text-align:center}.empty-icon[data-v-1915049e]{font-size:%?80?%;margin-bottom:%?20?%;opacity:.6}.empty-text[data-v-1915049e]{font-size:%?28?%;color:#999}.input-overlay[data-v-1915049e]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.4);z-index:99;opacity:0;pointer-events:none;transition:opacity .3s ease}.input-overlay.show[data-v-1915049e]{opacity:1;pointer-events:auto}.comment-input-area[data-v-1915049e]{position:fixed;left:0;right:0;bottom:0;background-color:#fff;z-index:100;transition:bottom .2s ease-out;padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom)}.collapsed-bar[data-v-1915049e]{padding:%?16?% %?40?%;display:flex;align-items:center;border-top:%?1?% solid #f0f0f0}.collapsed-input-placeholder[data-v-1915049e]{flex:1;height:%?68?%;line-height:%?68?%;padding:0 %?24?%;background-color:#f7f8fa;border-radius:%?34?%;font-size:%?28?%;color:#999}.expanded-container[data-v-1915049e]{padding:%?20?% %?40?%;display:flex;flex-direction:column;border-top:%?1?% solid #f0f0f0}.expanded-textarea[data-v-1915049e]{width:100%;min-height:%?180?%;max-height:%?350?%;padding:%?20?% %?24?%;background-color:#fff;border-radius:0;font-size:%?30?%;line-height:1.6;box-sizing:border-box;border:none;-webkit-appearance:none;-webkit-box-sizing:border-box;-webkit-user-select:text;-webkit-touch-callout:default;outline:none}.expanded-actions[data-v-1915049e]{display:flex;justify-content:space-between;align-items:center;margin-top:%?20?%;width:100%}.action-icons[data-v-1915049e]{display:flex;gap:%?24?%}.action-icon[data-v-1915049e]{width:%?100?%;height:%?100?%;border-radius:0;background:transparent;display:flex;align-items:center;justify-content:center;transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease}.action-icon[data-v-1915049e]:active{-webkit-transform:scale(.92);transform:scale(.92);background:transparent}.action-icon-text[data-v-1915049e]{font-size:%?36?%}.action-icon-image[data-v-1915049e]{width:%?80?%;height:%?80?%}.selected-comment-images[data-v-1915049e]{display:flex;flex-wrap:wrap;gap:%?12?%;margin-top:%?16?%}.selected-image-item[data-v-1915049e]{position:relative;width:%?150?%;height:%?150?%;border-radius:%?12?%;overflow:hidden}.selected-image-thumb[data-v-1915049e]{width:100%;height:100%;background-color:#f2f2f2;display:block}.remove-image-btn[data-v-1915049e]{position:absolute;top:%?6?%;right:%?6?%;width:%?36?%;height:%?36?%;border-radius:50%;background:rgba(0,0,0,.55);color:#fff;font-size:%?24?%;display:flex;align-items:center;justify-content:center}.emoji-panel[data-v-1915049e]{margin-top:%?16?%;padding:%?20?% %?18?%;background:#f6f7f9;border-radius:%?16?%;display:flex;flex-wrap:wrap;gap:%?18?%}.emoji-item[data-v-1915049e]{font-size:%?36?%;padding:%?6?% %?10?%}.reply-prompt[data-v-1915049e]{display:flex;justify-content:flex-start;align-items:center;margin-bottom:%?15?%;padding:0 %?10?%}.reply-prompt-text[data-v-1915049e]{font-size:%?26?%;color:#666}.cancel-reply .cancel-text[data-v-1915049e]{font-size:%?26?%;color:#9ed7ee}.submit-button[data-v-1915049e]{width:%?120?%!important;height:%?64?%!important;line-height:%?64?%!important;background-color:#9ed7ee;color:#fff;border-radius:%?32?%;font-size:%?28?%;padding:0!important;margin:0!important;border:none!important;box-sizing:border-box!important;flex-shrink:0;transition:background-color .2s ease}.submit-button[disabled][data-v-1915049e]{background-color:#b3e6c9;color:#fff}.submit-button[data-v-1915049e]::after{border:none}.swiper-wrapper[data-v-1915049e]{position:relative;width:100%}.image-swiper[data-v-1915049e]{width:100%;background-color:#f0f0f0;border-radius:%?12?%;overflow:hidden}.swiper-item[data-v-1915049e]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.post-image[data-v-1915049e]{max-width:100%;max-height:100%}.image-count-indicator[data-v-1915049e]{position:absolute;bottom:%?20?%;right:%?20?%;background-color:rgba(0,0,0,.6);color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%;z-index:10;-webkit-backdrop-filter:blur(%?10?%);backdrop-filter:blur(%?10?%)}.post-tags[data-v-1915049e]{margin:%?30?% 0 %?10?% 0;line-height:1.5}.post-tag[data-v-1915049e]{color:#24375f;font-size:%?26?%;margin-right:%?10?%;transition:all .2s ease;cursor:pointer}.post-tag[data-v-1915049e]:active{color:#1a2a4a;opacity:.8}.mutual-tag[data-v-1915049e]{font-size:%?24?%;padding:%?4?% %?16?%;border-radius:%?999?%;background-color:#e6f4ff;color:#1f6fd2;flex-shrink:0}.followed-tag[data-v-1915049e]{font-size:%?24?%;padding:%?4?% %?16?%;border-radius:%?999?%;background-color:#f4ebff;color:#7c55c7;flex-shrink:0}\n\n/* 模式切换样式 */.mode-switcher[data-v-1915049e]{display:flex;background:#f7f8fa;border-radius:%?25?%;padding:%?6?%;margin-bottom:%?20?%;border:%?2?% solid #e9ecef}.mode-item[data-v-1915049e]{flex:1;text-align:center;padding:%?16?% %?24?%;border-radius:%?20?%;transition:all .3s ease;position:relative}.mode-item.active[data-v-1915049e]{background:#9ed7ee;box-shadow:0 %?2?% %?8?% rgba(158,215,238,.3)}.mode-text[data-v-1915049e]{font-size:%?28?%;font-weight:500;color:#666;transition:color .3s ease}.mode-item.active .mode-text[data-v-1915049e]{color:#fff;font-weight:600}\n\n/* 讨论标题输入样式 */.discussion-title-wrapper[data-v-1915049e]{margin-bottom:%?15?%;border-bottom:%?1?% solid #f0f0f0;padding-bottom:%?15?%}.discussion-title-input[data-v-1915049e]{width:100%;height:%?80?%;line-height:%?80?%;padding:0 %?24?%;background-color:#fff;border:%?1?% solid #e9ecef;border-radius:%?12?%;font-size:%?30?%;color:#333;box-sizing:border-box}.discussion-title-input[data-v-1915049e]::-webkit-input-placeholder{color:#999}.discussion-title-input[data-v-1915049e]::placeholder{color:#999}\n\n/* 讨论类型帖子样式 */.discussion-content[data-v-1915049e]{margin:%?20?% 0}.discussion-sentence-group[data-v-1915049e]{margin-bottom:%?30?%}.discussion-sentence-card[data-v-1915049e]{background:#f5f5f5; /* 添加灰色背景 */border-radius:%?12?%; /* 添加圆角 */padding:%?30?%;margin-bottom:%?20?%;width:100%;min-height:%?120?%;position:relative;box-sizing:border-box;max-width:100%}.discussion-sentence-content[data-v-1915049e]{position:relative;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;box-sizing:border-box;max-width:100%}.discussion-sentence-line[data-v-1915049e]{font-family:Inter,sans-serif;font-style:italic;font-weight:600;font-size:%?40?%;line-height:%?48?%;color:#989090;display:block;margin-bottom:%?8?%;word-wrap:break-word;word-break:break-all;width:100%;max-width:100%;box-sizing:border-box;overflow-wrap:break-word}.discussion-sentence-line[data-v-1915049e]:last-child{margin-bottom:0}.discussion-comment[data-v-1915049e]{font-family:Inter,sans-serif;font-weight:600;font-size:%?32?%;line-height:%?38?%;color:#000;margin-top:%?20?%;padding:%?20?% 0; /* 移除左右padding，只保留上下padding */background:transparent; /* 移除灰色背景 */border-radius:0; /* 移除圆角 */word-wrap:break-word;word-break:break-all;width:100%;max-width:100%;box-sizing:border-box;overflow-wrap:break-word}',""]),n.exports=t},"178c":function(n,t,e){"use strict";var o=e("2219"),i=e.n(o);i.a},"1aa6":function(n,t,e){"use strict";e("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{showTip:!1}},props:{showTipProps:Boolean,title:String,content:String},watch:{showTipProps:function(n){this.setData({showTip:n})}},methods:{onClose:function(){this.setData({showTip:!this.showTip})}},created:function(){}};t.default=o},2219:function(n,t,e){var o=e("148e");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);var i=e("967d").default;i("df25202e",o,!0,{sourceMap:!1,shadowMode:!1})},2748:function(n,t,e){var o=e("a0f2");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);var i=e("967d").default;i("33bda249",o,!0,{sourceMap:!1,shadowMode:!1})},"32b5":function(n,t,e){"use strict";e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return i})),e.d(t,"a",(function(){}));var o=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[n.showClone?e("v-uni-view",{staticClass:"modal-overlay"},[e("v-uni-view",{staticClass:"modal-content"},[e("v-uni-view",{staticClass:"modal-header"},[e("v-uni-view",{staticClass:"modal-title"},[n._v("选择作品集")]),e("v-uni-view",{staticClass:"header-actions"},[e("v-uni-view",{staticClass:"refresh-btn",class:{refreshing:n.isLoading},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.loadPortfolios.apply(void 0,arguments)}}},[n._v("⟳")]),e("v-uni-view",{staticClass:"close-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.hideModal.apply(void 0,arguments)}}},[n._v("×")])],1)],1),e("v-uni-view",{staticClass:"modal-body"},[n.isLoading?e("v-uni-view",{staticClass:"loading-container"},[e("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1):n.portfolios.length>0?e("v-uni-view",{staticClass:"portfolios-list"},n._l(n.portfolios,(function(t,o){return e("v-uni-view",{key:o,class:"portfolio-item "+(n.selectedPortfolioId===t._id?"selected":""),attrs:{"data-portfolio-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.selectPortfolio.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"portfolio-icon"},[n._v("📚")]),e("v-uni-view",{staticClass:"portfolio-info"},[e("v-uni-view",{staticClass:"portfolio-name"},[n._v(n._s(t.name))]),e("v-uni-view",{staticClass:"portfolio-count"},[n._v(n._s(t.itemCount)+" 个作品")])],1),n.selectedPortfolioId===t._id?e("v-uni-view",{staticClass:"selected-icon"},[n._v("✓")]):n._e()],1)})),1):e("v-uni-view",{staticClass:"empty-state"},[e("v-uni-view",{staticClass:"empty-icon"},[n._v("📚")]),e("v-uni-view",{staticClass:"empty-text"},[n._v("还没有作品集")]),e("v-uni-view",{staticClass:"empty-subtext"},[n._v("点击下方按钮创建一个作品集")])],1)],1),e("v-uni-view",{staticClass:"modal-footer"},[e("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.createPortfolio.apply(void 0,arguments)}}},[n._v("创建作品集")]),e("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.selectedPortfolioId},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.confirmAddToPortfolio.apply(void 0,arguments)}}},[n._v("确认添加")])],1)],1)],1):n._e(),n.showCreateModal?e("v-uni-view",{staticClass:"modal-overlay"},[e("v-uni-view",{staticClass:"modal-content create-modal"},[e("v-uni-view",{staticClass:"modal-header"},[e("v-uni-view",{staticClass:"modal-title"},[n._v("创建作品集")]),e("v-uni-view",{staticClass:"close-btn",on:{click:[function(t){arguments[0]=t=n.$handleEvent(t),n.hideCreateModal.apply(void 0,arguments)},function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.trueFun.apply(void 0,arguments)}]}},[n._v("×")])],1),e("v-uni-view",{staticClass:"modal-body"},[e("v-uni-input",{staticClass:"portfolio-name-input",attrs:{placeholder:"请输入作品集名称",value:n.newPortfolioName,focus:!0},on:{input:function(t){arguments[0]=t=n.$handleEvent(t),n.onPortfolioNameInput.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.trueFun.apply(void 0,arguments)}}})],1),e("v-uni-view",{staticClass:"modal-footer"},[e("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.hideCreateModal.apply(void 0,arguments)}}},[n._v("取消")]),e("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.newPortfolioName},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.createNewPortfolio.apply(void 0,arguments)}}},[n._v("创建")])],1)],1)],1):n._e()],1)},i=[]},"3ef6":function(n,t,e){"use strict";e("6a54");var o=e("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(e("9b1b")),a=o(e("2634")),r=o(e("fcf3")),s=o(e("2fdc"));e("bf0f"),e("fd3c"),e("f3f7"),e("18f7"),e("de6c"),e("2797"),e("9db6"),e("08eb"),e("0c26"),e("8f71"),e("c223"),e("f7a5"),e("5ef2"),e("dd2b"),e("64aa"),e("bd06"),e("aa77"),e("7a76"),e("c9b5");var l=o(e("c1d0")),c=o(e("c107")),d=o(e("5155")),u=e("05ef"),f=o(e("9384")),m=o(e("c1d0")),p=o(e("c107")),v=(getApp(),e("9167")),g=e("7cd7"),h=g.togglePostLike,w=e("edf3"),b=w.previewImage,y=e("962f"),k=y.formatRelativeTime,C=(e("0123"),e("acbf")),x=e("38db"),_=x.cloudCall,I=e("9c8b"),F={components:{cloudTipModal:l.default,folderSelector:c.default,portfolioSelector:d.default},mixins:[I],data:function(){return{post:null,comments:[],newComment:"",commentCount:0,isLoading:!0,isCommentLoading:!0,commentSkeletonCount:3,isSubmitDisabled:!0,replyToComment:null,replyToAuthor:"",showUploadTip:!1,votingInProgress:!1,imageContainerHeight:null,swiperHeights:{},imageClampHeights:{},showFavoriteModal:!1,showPortfolioModal:!1,isInputExpanded:!1,keyboardHeight:0,isFocus:!1,viewStartTime:0,currentPostId:null,isFavorited:!1,favoriteButtonText:"收藏",favoriteButtonClass:"favorite-button",showFollowButton:!1,isFollowing:!1,followPending:!1,isFollowedByAuthor:!1,isMutualFollow:!1,isOwnPost:!1,commentImages:[],maxCommentImages:3,isSubmittingComment:!1,imgindex:0,img:"",commentIndex:0,commentImage:"",imageIndex:0,replyIndex:0,reply:{authorAvatar:"",_openid:"",authorName:"",content:"",imageUrls:"",formattedCreateTime:"",_id:"",liked:"",likeIcon:"",likes:"",canDelete:""},replyImage:"",replyImageIndex:0}},onLoad:function(n){var t=n.id;t?(this.setData({currentPostId:t}),this.loadPostDetail(t)):(this.setData({isLoading:!1,isCommentLoading:!1}),uni.showToast({title:"无效的帖子ID",icon:"none"}))},onShow:function(){this.setData({viewStartTime:Date.now()})},onUnload:function(){this.recordViewBehavior()},onHide:function(){this.isInputExpanded&&this.collapseInput(),this.recordViewBehavior()},methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _(n,t,Object.assign({pageTag:"post-detail",context:this},e))},loadPostDetail:function(n){var t=this;this.setData({isCommentLoading:!0}),this.callCloudFunction("getPostDetail",{postId:n},{injectOpenId:!1}).then(function(){var n=(0,s.default)((0,a.default)().mark((function n(e){var o,i;return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e.result||!e.result.post){n.next=18;break}return o=e.result.post,o.formattedCreateTime=t.formatTime(o.createTime),o.likeIcon=v.getLikeIcon(o.votes||0,o.isVoted||!1),n.next=6,(0,u.hydrateTempUrls)([o]);case 6:(0,u.warmTempUrlsFromPosts)([o]),console.log("loadPostDetail完整返回数据:",e.result),console.log("loadPostDetail获取到的commentCount:",e.result.commentCount,"类型:",(0,r.default)(e.result.commentCount)),console.log("loadPostDetail获取到的post.commentCount:",o.commentCount,"类型:",(0,r.default)(o.commentCount)),i=e.result.commentCount||o.commentCount||0,console.log("最终使用的commentCount:",i),t.setData({post:o,commentCount:i}),console.log("loadPostDetail设置后的commentCount:",t.commentCount),t.getComments(o&&o._id?o._id:""),t.prepareFollowState(o._openid),n.next=20;break;case 18:t.setData({isCommentLoading:!1}),uni.showToast({title:"帖子加载失败",icon:"none"});case 20:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()).catch((function(n){console.error("Failed to get post detail",n),t.setData({isCommentLoading:!1}),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1})}))},getComments:function(n){var t=this;this.setData({isCommentLoading:!0}),this.callCloudFunction("getComments",{postId:n},{injectOpenId:!1}).then(function(){var n=(0,s.default)((0,a.default)().mark((function n(e){var o,r,s,l,c,d;return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e.result||!e.result.comments){n.next=24;break}if(o=t.openid||uni.getStorageSync("openid"),r=e.result.comments.map((function(n){var e=(0,i.default)((0,i.default)({},n),{},{formattedCreateTime:t.formatTime(n.createTime),likeIcon:v.getLikeIcon(n.likes||0,n.liked||!1),canDelete:n._openid===o,imageUrls:n.imageUrls||[],originalImageUrls:n.originalImageUrls||[]});return n.replies&&(e.replies=n.replies.map((function(n){return(0,i.default)((0,i.default)({},n),{},{formattedCreateTime:t.formatTime(n.createTime),likeIcon:v.getLikeIcon(n.likes||0,n.liked||!1),canDelete:n._openid===o,imageUrls:n.imageUrls||[],originalImageUrls:n.originalImageUrls||[]})}))),e})),n.prev=3,s=new Set,r.forEach((function(n){(Array.isArray(n.imageUrls)?n.imageUrls:[]).forEach((function(n){"string"===typeof n&&n.startsWith("cloud://")&&s.add(n)})),(Array.isArray(n.replies)?n.replies:[]).forEach((function(n){return(Array.isArray(n.imageUrls)?n.imageUrls:[]).forEach((function(n){"string"===typeof n&&n.startsWith("cloud://")&&s.add(n)}))}))})),!(s.size>0)){n.next=11;break}return n.next=9,f.default.getTempUrls(Array.from(s));case 9:l=n.sent,r.forEach((function(n){Array.isArray(n.imageUrls)&&(n.imageUrls=n.imageUrls.map((function(n){return l[n]||n}))),Array.isArray(n.replies)&&(n.replies=n.replies.map((function(n){return(0,i.default)((0,i.default)({},n),{},{imageUrls:Array.isArray(n.imageUrls)?n.imageUrls.map((function(n){return l[n]||n})):n.imageUrls})})))}));case 11:n.next=15;break;case 13:n.prev=13,n.t0=n["catch"](3);case 15:console.log("getComments返回的commentCount:",e.result.commentCount),console.log("comments数组长度:",r.length),console.log("当前页面的commentCount:",t.commentCount),c=e.result.commentCount||r.length,d=c>t.commentCount,t.setData({comments:r,commentCount:d?c:t.commentCount}),console.log("更新后的commentCount:",t.commentCount),n.next=25;break;case 24:uni.showToast({title:"评论加载失败",icon:"none"});case 25:case"end":return n.stop()}}),n,null,[[3,13]])})));return function(t){return n.apply(this,arguments)}}()).catch((function(n){console.error("Failed to get comments",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isCommentLoading:!1})}))},onVote:function(n){var t=this,e=n.currentTarget.dataset.postid;if(!this.votingInProgress){this.setData({votingInProgress:!0});var o=this.post,i=o.votes,a=o.isVoted,r=a?i-1:i+1,s=!a,l=v.getLikeIcon(r,s);this.setData({"post.votes":r,"post.isVoted":s,"post.likeIcon":l}),h(e,{pageTag:"post-detail",context:this,currentVotes:i,currentIsLiked:a,requireAuth:!0}).then((function(n){if(n.success)t.setData({"post.votes":n.votes,"post.isVoted":n.isLiked,"post.likeIcon":n.likeIcon});else{var e=n.rollback||{votes:i,isLiked:a,likeIcon:v.getLikeIcon(i,a)};t.setData({"post.votes":e.votes,"post.isVoted":e.isLiked,"post.likeIcon":e.likeIcon})}})).catch((function(n){console.error("【帖子详情点赞】调用 likeService 失败",n),t.setData({"post.votes":i,"post.isVoted":a,"post.likeIcon":v.getLikeIcon(i,a)})})).finally((function(){t.setData({votingInProgress:!1})}))}},onFavorite:function(){this.isFavorited?uni.showToast({title:"已经收藏过了",icon:"none"}):this.setData({showFavoriteModal:!0})},onAddToPortfolio:function(){var n=this;console.log("【post-detail】点击作品集按钮"),this.post&&this.post._id?(console.log("【post-detail】显示作品集选择器，postId:",this.post._id),this.setData({showPortfolioModal:!0}),setTimeout((function(){console.log("【post-detail】延迟检查showPortfolioModal:",n.showPortfolioModal)}),100)):uni.showToast({title:"帖子信息无效",icon:"none"})},hideFavoriteModal:function(){this.setData({showFavoriteModal:!1})},onFavoriteSuccess:function(){this.hideFavoriteModal(),this.setData({isFavorited:!0,favoriteButtonText:"已收藏",favoriteButtonClass:"favorite-button favorited"}),uni.showToast({title:"收藏成功",icon:"success"});try{var n=getApp(),t=n&&n.globalData&&n.globalData.openid,e=this.post&&this.post._id;t&&e&&uni.$emit&&uni.$emit("favorite-changed",{userId:t,postId:e,favored:!0})}catch(o){}},hidePortfolioModal:function(){this.setData({showPortfolioModal:!1})},onPortfolioSuccess:function(){this.hidePortfolioModal(),uni.showToast({title:"添加成功",icon:"success"})},onCreateDiscussion:function(){this.post&&this.post._id?(console.log("【post-detail】跳转到创建讨论页面，postId:",this.post._id),uni.navigateTo({url:"/pages/create-discussion/create-discussion?postId=".concat(this.post._id),success:function(){console.log("【post-detail】跳转到创建讨论页面成功")},fail:function(n){console.error("【post-detail】跳转到创建讨论页面失败:",n),uni.showToast({title:"跳转失败",icon:"none"})}})):uni.showToast({title:"帖子信息无效",icon:"none"})},handlePreview:function(n){var t=b(n,{fallbackToast:!1});return t||uni.showToast({title:"图片加载失败",icon:"none"}),t},onImageError:function(n){console.error("图片加载失败",n)},onAvatarError:function(n){console.error("头像加载失败",n)},updateSubmitState:function(){var n=(this.newComment||"").trim().length>0,t=Array.isArray(this.commentImages)&&this.commentImages.length>0,e=!n&&!t||this.isSubmittingComment;this.isSubmitDisabled!==e&&this.setData({isSubmitDisabled:e})},onCommentInput:function(n){var t=this;this.setData({newComment:n.detail.value},(function(){t.updateSubmitState()}))},chooseImages:function(){var n=this,t=this.commentImages?this.commentImages.length:0,e=this.maxCommentImages,o=e-t;o<=0?uni.showToast({title:"最多选择3张图片",icon:"none"}):(this.isInputExpanded||this.expandInput(),uni.chooseImage({count:o,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){var e=t.tempFiles||(t.tempFilePaths||[]).map((function(n){return{tempFilePath:n,size:0}})),o=e.map((function(t){return n.prepareCommentImage(t)}));Promise.all(o).then((function(t){var e=t.filter((function(n){return!!n}));if(0!==e.length){var o=(n.commentImages||[]).concat(e);n.setData({commentImages:o.slice(0,n.maxCommentImages)},(function(){n.updateSubmitState(),n.setData({isInputExpanded:!0,isFocus:!1})}))}})).catch((function(n){console.error("评论图片处理失败:",n),uni.showToast({title:"图片处理失败",icon:"none"})}))},fail:function(n){n&&n.errMsg&&-1===n.errMsg.indexOf("cancel")&&(console.error("选择图片失败:",n),uni.showToast({title:"无法选择图片",icon:"none"}))}}))},chooseCommentImages:function(){this.chooseImages()},prepareCommentImage:function(n){var t=this;return new Promise((function(e){var o=n.tempFilePath||n.path||(Array.isArray(n.tempFilePaths)?n.tempFilePaths[0]:"");if(o){var i=n.size||0,a=i>204800,r={id:"comment_"+Date.now()+"_"+Math.floor(1e5*Math.random()),originalPath:o,previewUrl:o,compressedPath:o,size:i,needCompression:a};a?t.compressCommentImage(r).then((function(n){e(n)})).catch((function(n){console.warn("评论图片压缩异常:",n),r.compressedPath=r.originalPath,r.previewUrl=r.originalPath,r.needCompression=!1,e(r)})):e(r)}else e(null)}))},compressCommentImage:function(n){return new Promise((function(t){(function e(o){uni.compressImage({src:n.originalPath,quality:o,success:function(i){uni.getFileInfo({filePath:i.tempFilePath,success:function(a){var r=a.size;console.log("压缩质量".concat(o,"%，文件大小: ").concat((r/1024).toFixed(2),"KB")),r>204800&&o>30?(console.log("文件大小".concat((r/1024).toFixed(2),"KB超过200KB，继续压缩...")),e(o-10)):(n.compressedPath=i.tempFilePath,n.previewUrl=i.tempFilePath,n.compressedSize=r,console.log("最终压缩质量".concat(o,"%，文件大小: ").concat((r/1024).toFixed(2),"KB")),t(n))},fail:function(){n.compressedPath=i.tempFilePath,n.previewUrl=i.tempFilePath,t(n)}})},fail:function(i){console.warn("压缩质量".concat(o,"%失败:"),i),o>30?e(o-10):(n.compressedPath=n.originalPath,n.previewUrl=n.originalPath,n.needCompression=!1,t(n))}})})(60)}))},removeCommentImage:function(n){var t=this,e=n.currentTarget.dataset.index;if(void 0!==e){var o=(this.commentImages||[]).slice();o.splice(e,1),this.setData({commentImages:o},(function(){t.updateSubmitState()}))}},previewSelectedCommentImage:function(n){var t=n.currentTarget.dataset.index||0,e=this.commentImages||[];if(e.length){var o=e.map((function(n){return n.previewUrl})).filter(Boolean);if(o.length){var i=o[t]||o[0];return b({current:i,urls:o},{fallbackToast:!1})}}},uploadCommentImages:function(){var n=this,t=this.commentImages||[];if(!t.length)return Promise.resolve([]);var e=this.getCurrentUserId()||"guest",o=Date.now();return Promise.all(t.map((function(t,i){var a=(e||"guest")+"_"+o+"_"+i,r="comment_images/"+a+"_compressed.jpg";return n.uploadFile(r,t.compressedPath||t.previewUrl||t.originalPath).then((function(e){if(t.needCompression){var o="comment_images/"+a+"_original.jpg";return n.uploadFile(o,t.originalPath).then((function(n){return{compressedUrl:e.fileID,originalUrl:n.fileID}}))}return{compressedUrl:e.fileID,originalUrl:e.fileID}}))})))},previewCommentImageFromList:function(n){var t=Number(n.currentTarget.dataset.commentIndex),e=n.currentTarget.dataset.replyIndex,o="undefined"===typeof e?-1:Number(e),i=Number(n.currentTarget.dataset.imageIndex)||0,a=n.currentTarget.dataset.isReply,r=!0===a||"true"===a,s=[];if(!Number.isNaN(t)&&t>=0){var l=this.comments[t];if(l)if(r&&Array.isArray(l.replies)&&o>=0){var c=l.replies[o];c&&(Array.isArray(c.originalImageUrls)&&c.originalImageUrls.length>0?s=c.originalImageUrls:Array.isArray(c.imageUrls)&&(s=c.imageUrls))}else Array.isArray(l.originalImageUrls)&&l.originalImageUrls.length>0?s=l.originalImageUrls:Array.isArray(l.imageUrls)&&(s=l.imageUrls)}if(s&&s.length){var d=s.filter(Boolean);if(d.length){var u=d[i]||d[0];return b({current:u,urls:d},{fallbackToast:!1})}}},onSubmitComment:function(){var n=(0,s.default)((0,a.default)().mark((function n(){var t,e,o,i,r,s,l,c,d,u,f,m,p;return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!this.isSubmitDisabled&&!this.isSubmittingComment){n.next=2;break}return n.abrupt("return");case 2:if(t=(this.newComment||"").trim(),e=t.length>0,o=Array.isArray(this.commentImages)&&this.commentImages.length>0,e||o){n.next=8;break}return uni.showToast({title:"请输入内容或添加图片",icon:"none"}),n.abrupt("return");case 8:if(i=this.post&&this.post._id?this.post._id:"",i){n.next=12;break}return uni.showToast({title:"帖子信息缺失",icon:"none"}),n.abrupt("return");case 12:return r=this.replyToComment,s=this.replyToAuthor,this.setData({isSubmittingComment:!0}),this.updateSubmitState(),uni.showLoading({title:"提交中..."}),n.prev=17,n.next=20,this.uploadCommentImages();case 20:return l=n.sent,c=l.map((function(n){return n.compressedUrl})),d=l.map((function(n){return n.originalUrl})),n.next=25,this.callCloudFunction("addComment",{postId:i,content:t,parentId:r,replyToAuthorName:s,imageUrls:c,originalImageUrls:d},{requireAuth:!0});case 25:u=n.sent,uni.hideLoading(),u.result&&u.result.success?(uni.showToast({title:"评论成功"}),f=this.commentCount+1,this.setData({newComment:"",commentImages:[],commentCount:f}),this.updateSubmitState(),this.collapseInput(),this.getComments(i),m=getCurrentPages(),m.length>1&&(p=m[m.length-2],"pages/index/index"!==p.route&&"pages/profile/profile"!==p.route||"function"!==typeof p.updatePostCommentCount||p.updatePostCommentCount(i,f))):uni.showToast({title:u.result&&u.result.message||"评论失败",icon:"none"}),n.next=37;break;case 30:n.prev=30,n.t0=n["catch"](17),console.log("CatchClause",n.t0),console.log("CatchClause",n.t0),uni.hideLoading(),console.error("Failed to add comment with media:",n.t0),uni.showToast({title:"评论失败",icon:"none"});case 37:return n.prev=37,this.setData({isSubmittingComment:!1}),this.updateSubmitState(),n.finish(37);case 41:case"end":return n.stop()}}),n,this,[[17,30,37,41]])})));return function(){return n.apply(this,arguments)}}(),showReplyInput:function(n){console.log("--- showReplyInput function triggered ---"),console.log("收到的 data- attributes:",n.currentTarget.dataset);var t=n.currentTarget.dataset.commentId,e=n.currentTarget.dataset.authorName;this.setData({replyToComment:t,replyToAuthor:e}),console.log("设置后的回复状态:",{replyToComment:this.replyToComment,replyToAuthor:this.replyToAuthor}),this.expandInput()},cancelReply:function(){this.setData({replyToComment:null,replyToAuthor:""}),console.log("回复状态已被取消")},onDeleteComment:function(n){var t=this,e=n.currentTarget.dataset,o=e.commentId,a=e.parentId;o&&uni.showModal({title:"删除评论",content:"确定要删除这条评论吗？",confirmColor:"#ff4d4f",success:function(n){n.confirm&&(uni.showLoading({title:"正在删除",mask:!0}),t.callCloudFunction("deleteComment",{commentId:o},{requireAuth:!0}).then((function(n){if(n.result&&n.result.success){var e,r=Math.max(1,n.result.deletedCount||1);if(a){e=t.comments.map((function(n){return(0,i.default)((0,i.default)({},n),{},{replies:n.replies?n.replies.slice():[]})}));var s=e.findIndex((function(n){return n._id===a}));-1!==s&&(e[s].replies=e[s].replies.filter((function(n){return n._id!==o})))}else e=t.comments.filter((function(n){return n._id!==o}));var l=Math.max(0,t.commentCount-r);t.setData({comments:e,commentCount:l});var c=getCurrentPages();if(c.length>1){var d=c[c.length-2];"function"===typeof d.updatePostCommentCount&&d.updatePostCommentCount(t.post&&t.post._id?t.post._id:"",l)}uni.showToast({title:"已删除",icon:"success"})}else uni.showToast({title:n.result&&n.result.message||"删除失败",icon:"none"})})).catch((function(n){console.error("Failed to delete comment",n),uni.showToast({title:"删除失败",icon:"none"})})).finally((function(){uni.hideLoading()})))}})},toggleLikeComment:function(n){var t=this,e=n.currentTarget.dataset.commentId,o=this.post&&this.post._id?this.post._id:"",i=this.comments,a=this.findComment(i,e),r=a.comment;a.isReply;if(r){var s=!r.liked,l=r.likes||0;r.liked=s,r.likes=l+(s?1:-1),r.likeIcon=v.getLikeIcon(r.likes,r.liked),this.setData({comments:i}),this.callCloudFunction("likeComment",{commentId:e,postId:o},{requireAuth:!0}).then((function(n){n.result&&n.result.success?r.likes!==n.result.likes&&t.updateCommentLikeStatus(e,s,n.result.likes):(t.updateCommentLikeStatus(e,!s,l),uni.showToast({title:"操作失败",icon:"none"}))})).catch((function(n){t.updateCommentLikeStatus(e,!s,l),console.error("Failed to like comment",n),uni.showToast({title:"网络错误",icon:"none"})}))}},updateCommentLikeStatus:function(n,t,e){var o=this.comments,i=this.findComment(o,n),a=i.comment;i.isReply;a&&(a.liked=t,a.likes=e,a.likeIcon=v.getLikeIcon(a.likes,a.liked),this.setData({comments:o}))},findComment:function(n,t){for(var e=0;e<n.length;e++){if(n[e]._id===t)return{comment:n[e],isReply:!1};if(n[e].replies)for(var o=0;o<n[e].replies.length;o++)if(n[e].replies[o]._id===t)return{comment:n[e].replies[o],isReply:!0}}return{comment:null,isReply:!1}},toggleShowAllReplies:function(n){var t=n.currentTarget.dataset.commentId,e=this.comments,o=e.find((function(n){return n._id===t}));o&&(o.showAllReplies=!o.showAllReplies,this.setData({comments:e}))},formatTime:function(n){return k(n)},prepareFollowState:function(n){var t=this.getCurrentUserId(),e=n===t;if(console.log("【关注状态】prepareFollowState调用:",{authorOpenid:n,currentUserId:t,isSameUser:e}),this.setData({isOwnPost:e}),!n||!t||e)return console.log("【关注状态】不显示关注按钮 - 自己或无效用户"),void this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByAuthor:!1,isMutualFollow:!1});console.log("【关注状态】显示关注按钮"),this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByAuthor:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(n)},fetchFollowStatusWithCache:function(n){var t=this;if(n){var e=this.getCurrentUserId();e&&C.getFollowStatus(e,n).then((function(n){n&&t.setData({isFollowing:n.isFollowing,isFollowedByAuthor:n.isFollowedByAuthor,isMutualFollow:n.isMutualFollow})}))}},fetchFollowStatus:function(n){var t=this;n&&this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:n},{requireAuth:!0}).then((function(n){n.result&&n.result.success?t.setData({isFollowing:!!n.result.isFollowing,isFollowedByAuthor:!!n.result.isFollower,isMutualFollow:!!n.result.isMutual}):console.warn("检查关注状态失败",n.result)})).catch((function(n){console.error("检查关注状态调用失败:",n)}))},onFollowTap:function(){var n=this;if(!this.followPending&&this.post){var t=this.post._openid;if(t){var e=this.getCurrentUserId();e?(this.setData({followPending:!0}),C.toggleFollowStatus(e,t).then((function(t){t?(n.setData({isFollowing:t.isFollowing,isFollowedByAuthor:t.isFollowedByAuthor,isMutualFollow:t.isMutualFollow}),uni.showToast({title:t.isFollowing?"关注成功":"已取消关注",icon:"success"})):uni.showToast({title:"操作失败",icon:"none"})})).catch((function(n){console.error("切换关注状态失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({followPending:!1})}))):uni.showToast({title:"请先登录",icon:"none"})}}},getCurrentUserId:function(){return this.openid||uni.getStorageSync("openid")||uni.getStorageSync("userOpenId")},retryLoad:function(){this.currentPostId&&(this.setData({isLoading:!0,post:null}),this.loadPostDetail(this.currentPostId))},navigateToUserProfile:function(n){var t=n.currentTarget.dataset.userId;if(t){var e=this.openid;t===e?(console.log("【帖子详情】点击的是自己头像，切换到我的页面"),uni.switchTab({url:"/pages/profile/profile"})):(console.log("【帖子详情】点击的是他人头像，跳转到用户主页"),uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(t)}))}},preventBubble:function(){},expandInput:function(){this.setData({isInputExpanded:!0,isFocus:!0})},onInputFocus:function(n){console.log("键盘弹起，高度为:",n.detail.height),this.setData({keyboardHeight:n.detail.height})},onInputBlur:function(){var n=this;setTimeout((function(){n.setData({isFocus:!1,keyboardHeight:0})}),100)},collapseInput:function(){this.setData({isInputExpanded:!1,isFocus:!1,keyboardHeight:0,replyToComment:null,replyToAuthor:""})},recordViewBehavior:function(){if(this.currentPostId&&this.viewStartTime){var n=Math.floor((Date.now()-this.viewStartTime)/1e3);n<3||this.callCloudFunction("recordView",{postId:this.currentPostId,viewDuration:n}).then((function(n){console.log("浏览记录已保存",n)})).catch((function(n){console.error("浏览记录保存失败:",n)}))}},onTagClick:function(n){var t=n.currentTarget.dataset.tag;console.log("点击标签:",t),uni.navigateTo({url:"/pages/tag-filter/tag-filter?tag=".concat(encodeURIComponent(t)),success:function(){console.log("跳转到标签筛选页面成功")},fail:function(n){console.error("跳转到标签筛选页面失败",n),uni.showToast({title:"跳转失败",icon:"none"})}})},goBack:function(){var n=getCurrentPages();console.log("当前页面栈长度:",n.length),n.length>1?uni.navigateBack({delta:1,fail:function(){console.log("navigateBack失败，尝试switchTab"),uni.switchTab({url:"/pages/index/index"})}}):(console.log("没有上一页，跳转到首页"),uni.switchTab({url:"/pages/index/index"}))},uploadFile:function(n,t){var o=this;return console.log("🔍 [帖子详情页] 上传文件: ".concat(n),t),new Promise((function(i,a){var r=e("f3c3"),s=r.getCurrentPlatform,l=r.getCloudFunctionMethod,c=s(),d=l();console.log("🔍 [帖子详情页] 运行环境检测 - 平台: ".concat(c,", 方法: ").concat(d)),"tcb"===d?o.$tcb&&o.$tcb.uploadFile?(console.log("🔍 [帖子详情页] TCB环境上传文件: ".concat(n)),o.$tcb.uploadFile({cloudPath:n,filePath:t}).then(i).catch(a)):(console.error("❌ [帖子详情页] TCB实例不可用"),a(new Error("TCB实例不可用"))):"wx-cloud"===d?wx.cloud&&wx.cloud.uploadFile?(console.log("🔍 [帖子详情页] 小程序环境上传文件: ".concat(n)),wx.cloud.uploadFile({cloudPath:n,filePath:t,success:function(t){console.log("✅ [帖子详情页] 文件上传成功: ".concat(n),t),i(t)},fail:function(t){console.error("❌ [帖子详情页] 文件上传失败: ".concat(n),t),a(t)}})):(console.error("❌ [帖子详情页] 微信云开发不可用"),a(new Error("微信云开发不可用"))):(console.error("❌ [帖子详情页] 不支持的文件上传方式: ".concat(d)),a(new Error("不支持的文件上传方式: ".concat(d))))}))}}};t.default=F,t.default.components=Object.assign({"cloud-tip-modal":m.default,"folder-selector":p.default},t.default.components||{})},"44f3":function(n,t,e){"use strict";e.r(t);var o=e("8066"),i=e.n(o);for(var a in o)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(a);t["default"]=i.a},5155:function(n,t,e){"use strict";e.r(t);var o=e("32b5"),i=e("6a14");for(var a in i)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return i[n]}))}(a);e("e207");var r=e("828b"),s=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"747a115c",null,!1,o["a"],void 0);t["default"]=s.exports},"62d9":function(n,t,e){"use strict";e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return i})),e.d(t,"a",(function(){}));var o=function(){var n=this,t=n.$createElement,e=n._self._c||t;return n.showTip?e("v-uni-view",{staticClass:"install_tip"},[e("v-uni-view",{staticClass:"install_tip_back"}),e("v-uni-view",{staticClass:"install_tip_detail"},[e("v-uni-image",{staticClass:"install_tip_close",attrs:{src:"/static/images/icons/close.png"},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onClose.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"install_tip_detail_title"},[n._v(n._s(n.title))]),e("v-uni-view",{staticClass:"install_tip_detail_tip"},[n._v(n._s(n.content))])],1)],1):n._e()},i=[]},"67e5":function(n,t,e){var o=e("9878");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);var i=e("967d").default;i("76184c80",o,!0,{sourceMap:!1,shadowMode:!1})},"6a14":function(n,t,e){"use strict";e.r(t);var o=e("767e"),i=e.n(o);for(var a in o)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(a);t["default"]=i.a},"767e":function(n,t,e){"use strict";e("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e("bf0f"),e("0c26");var o=e("38db"),i=o.cloudCall,a={data:function(){return{portfolios:[],isLoading:!0,selectedPortfolioId:"",showCreateModal:!1,newPortfolioName:"",showClone:!1}},props:{show:{type:Boolean,default:!1},postId:{type:String,default:""}},watch:{show:{handler:function(n,t){var e=this;console.log("【portfolio-selector】show变化:",{newVal:n,oldVal:t}),this.showClone=n,n&&!t&&(console.log("【portfolio-selector】弹窗显示，开始加载作品集"),setTimeout((function(){e.showClone&&e.loadPortfolios()}),100))},immediate:!0}},methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(n,t,Object.assign({pageTag:"portfolio-selector",context:this,requireAuth:!0},e))},loadPortfolios:function(){var n=this;console.log("开始加载作品集列表..."),this.setData({isLoading:!0}),this.callCloudFunction("getPortfolioFolders").then((function(t){if(console.log("portfolio-selector获取作品集:",t),t.result&&t.result.success){var e=t.result.folders||[];console.log("获取到作品集数量:",e.length);var o=n.selectedPortfolioId;o&&!e.some((function(n){return n._id===o}))&&(console.log("清空失效的选中状态"),n.setData({selectedPortfolioId:""})),n.setData({portfolios:e,isLoading:!1})}else{var i;console.error("获取作品集失败，返回结果:",t),uni.showToast({title:(null===(i=t.result)||void 0===i?void 0:i.message)||"加载失败",icon:"none"}),n.setData({isLoading:!1,portfolios:[],selectedPortfolioId:""})}})).catch((function(t){console.error("获取作品集失败:",t),console.error("错误详情:",t.errMsg||t.message),setTimeout((function(){n.showClone&&(console.log("重新尝试加载作品集..."),n.loadPortfolios())}),1e3),n.setData({isLoading:!1,portfolios:[],selectedPortfolioId:""})}))},selectPortfolio:function(n){var t=n.currentTarget.dataset.portfolioId;this.setData({selectedPortfolioId:t})},confirmAddToPortfolio:function(){var n=this,t=this.selectedPortfolioId,e=this.postId;if(console.log("确认添加到作品集，postId:",e,"folderId:",t),t){if(!e)return console.error("postId 为空，无法添加到作品集"),void uni.showToast({title:"参数错误：帖子ID为空",icon:"none"});uni.showLoading({title:"添加中..."}),this.callCloudFunction("addToPortfolio",{postId:e,folderId:t}).then((function(t){uni.hideLoading(),console.log("确认添加到作品集返回结果:",t),t&&t.result?t.result.success?(uni.showToast({title:"添加成功"}),console.log("添加成功，开始关闭弹窗"),n.setData({selectedPortfolioId:""}),setTimeout((function(){n.hideModal()}),1500),n.$emit("portfolioSuccess")):(console.error("添加到作品集业务失败:",t.result),uni.showToast({title:t.result.message||"添加失败",icon:"none"})):(console.error("添加到作品集返回格式异常:",t),uni.showToast({title:"添加失败：返回格式错误",icon:"none"}))})).catch((function(n){uni.hideLoading(),console.error("添加到作品集云函数调用失败:",n),uni.showToast({title:"网络错误："+(n.errMsg||"未知错误"),icon:"none"})}))}else uni.showToast({title:"请选择作品集",icon:"none"})},createPortfolio:function(){this.setData({showCreateModal:!0,newPortfolioName:""})},hideCreateModal:function(){this.setData({showCreateModal:!1,newPortfolioName:""})},onPortfolioNameInput:function(n){var t=n.detail.value;this.setData({newPortfolioName:t})},createNewPortfolio:function(){var n=this,t=this.newPortfolioName.trim();t?(this.setData({newPortfolioName:t}),console.log("组件开始创建作品集，名称:",t),uni.showLoading({title:"创建中..."}),this.callCloudFunction("createPortfolioFolder",{folderName:t}).then((function(t){uni.hideLoading(),console.log("组件创建作品集返回结果:",t),t&&t.result?t.result.success?(uni.showToast({title:"创建成功",duration:2e3}),n.setData({showCreateModal:!1}),setTimeout((function(){n.loadPortfolios()}),300)):(console.error("组件创建作品集业务失败:",t.result),uni.showToast({title:t.result.message||"创建失败",icon:"none",duration:3e3})):(console.error("组件创建作品集返回格式异常:",t),uni.showToast({title:"创建失败：返回格式错误",icon:"none",duration:3e3}))})).catch((function(n){uni.hideLoading(),console.error("组件创建作品集云函数调用失败:",n),uni.showToast({title:"创建失败: "+(n.errMsg||"网络错误"),icon:"none",duration:3e3})}))):uni.showToast({title:"请输入作品集名称",icon:"none"})},hideModal:function(){console.log("=== 点击关闭按钮，开始隐藏弹窗 ==="),console.log("当前状态：",{show:this.show,showCreateModal:this.showCreateModal,selectedPortfolioId:this.selectedPortfolioId}),this.setData({selectedPortfolioId:"",showClone:!1,showCreateModal:!1,newPortfolioName:""}),console.log("=== 弹窗已隐藏，状态已重置 ==="),this.$emit("hide")},trueFun:function(){console.log("占位：函数 true 未声明")}},created:function(){},mounted:function(){console.log("【portfolio-selector】组件mounted"),this.show&&(console.log("【portfolio-selector】mounted时show为true，开始加载作品集"),this.loadPortfolios())}};t.default=a},"7a2f":function(n,t,e){var o=e("c86c");t=o(!1),t.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* components/folder-selector/folder-selector.wxss */.modal-overlay[data-v-3a05c372]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[data-v-3a05c372]{background:#fff;border-radius:%?16?%;margin:%?40?%;width:calc(100% - %?80?%);max-width:%?600?%;max-height:80vh;display:flex;flex-direction:column}.modal-header[data-v-3a05c372]{display:flex;align-items:center;justify-content:space-between;padding:%?30?% %?40?%;border-bottom:%?1?% solid #f0f0f0}.modal-title[data-v-3a05c372]{font-size:%?36?%;font-weight:500;color:#333}.close-btn[data-v-3a05c372]{font-size:%?48?%;color:#999;line-height:1;position:relative;z-index:1001}.modal-body[data-v-3a05c372]{flex:1;padding:%?20?% 0;max-height:60vh;overflow-y:auto}.loading-container[data-v-3a05c372]{display:flex;justify-content:center;align-items:center;height:%?200?%}.loading-text[data-v-3a05c372]{color:#999;font-size:%?28?%}.folders-list[data-v-3a05c372]{padding:0 %?40?%}.folder-item[data-v-3a05c372]{display:flex;align-items:center;padding:%?24?% 0;border-bottom:%?1?% solid #f8f8f8}.folder-item[data-v-3a05c372]:last-child{border-bottom:none}.folder-item.selected[data-v-3a05c372]{background:rgba(7,193,96,.1);border-radius:%?8?%;padding:%?24?% %?20?%;margin:0 %?-20?%}.folder-icon[data-v-3a05c372]{font-size:%?40?%;margin-right:%?20?%}.folder-info[data-v-3a05c372]{flex:1}.folder-name[data-v-3a05c372]{font-size:%?30?%;color:#333;font-weight:500;margin-bottom:%?4?%}.folder-count[data-v-3a05c372]{font-size:%?24?%;color:#999}.selected-icon[data-v-3a05c372]{font-size:%?32?%;color:#9ed7ee;font-weight:700}.empty-state[data-v-3a05c372]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:%?200?%;padding:%?40?%}.empty-icon[data-v-3a05c372]{font-size:%?60?%;margin-bottom:%?16?%;opacity:.5}.empty-text[data-v-3a05c372]{font-size:%?28?%;color:#666;margin-bottom:%?8?%}.empty-subtext[data-v-3a05c372]{font-size:%?24?%;color:#999}.modal-footer[data-v-3a05c372]{display:flex;gap:%?20?%;padding:%?30?% %?40?%;border-top:%?1?% solid #f0f0f0}.modal-btn[data-v-3a05c372]{flex:1;height:%?80?%;border-radius:%?8?%;font-size:%?28?%;border:none;display:flex;align-items:center;justify-content:center;position:relative;z-index:1001}.secondary-btn[data-v-3a05c372]{background:#f5f5f5;color:#666}.primary-btn[data-v-3a05c372]{background:#9ed7ee;color:#fff}.primary-btn[data-v-3a05c372]:disabled{background:#ccc;color:#999}\r\n/* 创建收藏夹弹窗样式 */.create-modal .modal-body[data-v-3a05c372]{padding:%?40?%}.folder-name-input[data-v-3a05c372]{width:100%;height:%?80?%;padding:0 %?20?%;border:%?2?% solid #e0e0e0;border-radius:%?8?%;font-size:%?30?%;box-sizing:border-box}.folder-name-input[data-v-3a05c372]:focus{border-color:#9ed7ee}",""]),n.exports=t},"7cd7":function(n,t,e){var o=e("dd7e").default,i=e("46c5").default;e("64aa"),e("dc8a"),e("8f71"),e("bf0f"),e("9db6"),e("2797"),e("de6c"),e("7a76"),e("c9b5");var a=e("38db"),r=a.cloudCall,s=e("9167"),l=e("7ef8").default;function c(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=Number(n);return Number.isFinite(e)?e:t}function d(n,t,e){if("function"===typeof n)try{return n(t,e)}catch(o){console.warn("[likeService] likeIcon resolver 执行失败",o)}return s.getLikeIcon(t,e)}function u(n){var t=n.votes,e=n.isLiked,o=n.icon;return{votes:t,isLiked:e,likeIcon:o}}function f(n,t,e,o){try{if(!n)return;var i=l.getStats?l.getStats():{},a=Object.keys(i),r=a.filter((function(n){return"posts:home"===n||"posts:discover"===n||n.startsWith("posts:tag:")||n.startsWith("me:posts")||n.startsWith("userPosts:")}));r.forEach((function(i){try{var a=l.namespace(i),r=a.keys&&a.keys()||[];r.forEach((function(i){try{a.update(i,(function(i){if(!Array.isArray(i))return i;for(var a=0;a<i.length;a+=1){var r=i[a];!r||r._id!==n&&r.id!==n||(r.votes=t,r.isVoted=e,r.likeIcon=o,!0)}return i}))}catch(r){}}))}catch(s){}}))}catch(s){console.warn("[likeService] updatePostInCaches failed",s)}}function m(n){if("undefined"!==typeof uni&&"function"===typeof uni.showToast)try{uni.showToast({title:n||"操作失败，请稍后重试",icon:"none"})}catch(t){console.warn("[likeService] showToast 调用失败",t)}}function p(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.pageTag,e=void 0===t?"like-service":t,o=n.context,i=void 0===o?null:o,a=n.currentVotes,r=void 0===a?0:a,l=n.currentIsLiked,d=void 0!==l&&l,u=n.likeIconResolver,f=void 0===u?s.getLikeIcon:u,m=n.requireAuth,p=void 0===m||m,v=n.retry,g=void 0===v?0:v,h=n.updateCache,w=void 0===h||h,b=n.showErrorToast,y=void 0===b||b,k=n.cloudOptions,C=void 0===k?{}:k;return{pageTag:e,context:i,currentVotes:c(r,0),currentIsLiked:Boolean(d),likeIconResolver:f,requireAuth:p,retry:g,updateCache:w,showErrorToast:y,cloudOptions:C}}function v(){return v=i(o().mark((function n(t){var e,i,a,s,l,v,g,h,w,b,y,k,C,x,_,I,F,T,P,D,E,U,z,A=arguments;return o().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e=A.length>1&&void 0!==A[1]?A[1]:{},t){n.next=3;break}return n.abrupt("return",Promise.reject(new Error("[likeService] postId 不能为空")));case 3:return i=p(e),a=i.pageTag,s=i.context,l=i.currentVotes,v=i.currentIsLiked,g=i.likeIconResolver,h=i.requireAuth,w=i.retry,b=i.updateCache,y=i.showErrorToast,k=i.cloudOptions,C=c(l,0),x=Boolean(v),_=d(g,C,x),I=u({votes:C,isLiked:x,icon:_}),n.prev=8,n.next=11,r("vote",{postId:t},Object.assign({pageTag:"likeService:".concat(a),context:s,requireAuth:h,retry:w},k));case 11:F=n.sent,n.next=19;break;case 14:return n.prev=14,n.t0=n["catch"](8),console.error("[likeService] 调用云函数失败",n.t0),y&&m(n.t0&&n.t0.message),n.abrupt("return",{success:!1,error:n.t0,rollback:I});case 19:if(T=F&&F.result?F.result:F,P=T&&!0===T.success,P){n.next=26;break}return D=T&&T.message?T.message:"操作失败，请稍后重试",console.warn("[likeService] 云函数返回失败结果",T),y&&m(D),n.abrupt("return",{success:!1,error:T,rollback:I});case 26:return E=c(T.votes,C),U=Boolean(T.isLiked),z=d(g,E,U),b&&f(t,E,U,z),n.abrupt("return",{success:!0,votes:E,isLiked:U,likeIcon:z,response:T});case 31:case"end":return n.stop()}}),n,null,[[8,14]])}))),v.apply(this,arguments)}n.exports={togglePostLike:function(n){return v.apply(this,arguments)}}},8066:function(n,t,e){"use strict";e("6a54");var o=e("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e("bf0f"),e("0c26");var i=o(e("39d8")),a=e("38db"),r=a.cloudCall,s={data:function(){return{folders:[],isLoading:!0,selectedFolderId:"",showCreateModal:!1,newFolderName:"",showClone:!1}},props:{show:{type:Boolean,default:!1},postId:{type:String,default:""}},watch:(0,i.default)({show:function(n){n&&this.loadFolders()}},"show",{handler:function(n,t){this.showClone=n},immediate:!0}),methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(n,t,Object.assign({pageTag:"folder-selector",context:this,requireAuth:!0},e))},loadFolders:function(){var n=this;console.log("开始加载收藏夹列表..."),this.setData({isLoading:!0});var t=this.$requireOpenid&&this.$requireOpenid();t?this.callCloudFunction("getMyProfileData",{action:"getFavoriteFolders",openid:t}).then((function(t){if(console.log("folder-selector获取收藏夹:",t),t.result&&t.result.success){var e=t.result.folders||[];console.log("获取到收藏夹数量:",e.length);var o=n.selectedFolderId;o&&!e.some((function(n){return n._id===o}))&&(console.log("清空失效的选中状态"),n.setData({selectedFolderId:""})),n.setData({folders:e,isLoading:!1})}else{var i;uni.showToast({title:(null===(i=t.result)||void 0===i?void 0:i.message)||"加载失败",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})}})).catch((function(t){console.error("获取收藏夹失败:",t),uni.showToast({title:"网络错误",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})})):this.setData({isLoading:!1,folders:[],selectedFolderId:""})},selectFolder:function(n){var t=n.currentTarget.dataset.folderId;this.setData({selectedFolderId:t})},confirmFavorite:function(){var n=this,t=this.selectedFolderId,o=this.postId;if(console.log("确认收藏，postId:",o,"folderId:",t),t){if(!o)return console.error("postId 为空，无法收藏"),void uni.showToast({title:"参数错误：帖子ID为空",icon:"none"});var i=this.$requireOpenid&&this.$requireOpenid();i&&(uni.showLoading({title:"收藏中..."}),this.callCloudFunction("getMyProfileData",{action:"addToFavorite",postId:o,folderId:t,openid:i}).then((function(t){if(uni.hideLoading(),console.log("确认收藏返回结果:",t),t&&t.result)if(t.result.success){uni.showToast({title:"收藏成功"}),console.log("收藏成功，开始关闭弹窗"),n.setData({selectedFolderId:""}),setTimeout((function(){n.hideModal()}),1500),n.$emit("favoriteSuccess");try{var i=getApp(),a=i&&i.globalData&&i.globalData.openid,r=e("2729"),s=r.emitFavoriteChanged;s({userId:a,postId:o,favored:!0})}catch(l){}}else console.error("收藏业务失败:",t.result),uni.showToast({title:t.result.message||"收藏失败",icon:"none"});else console.error("收藏返回格式异常:",t),uni.showToast({title:"收藏失败：返回格式错误",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("收藏云函数调用失败:",n),uni.showToast({title:"网络错误："+(n.errMsg||"未知错误"),icon:"none"})})))}else uni.showToast({title:"请选择收藏夹",icon:"none"})},createFolder:function(){this.setData({showCreateModal:!0,newFolderName:""})},hideCreateModal:function(){this.setData({showCreateModal:!1,newFolderName:""})},onFolderNameInput:function(n){var t=n.detail.value;this.setData({newFolderName:t})},createNewFolder:function(){var n=this,t=this.newFolderName.trim();if(t){this.setData({newFolderName:t}),console.log("组件开始创建收藏夹，名称:",t);var e=this.$requireOpenid&&this.$requireOpenid();e&&(uni.showLoading({title:"创建中..."}),this.callCloudFunction("getMyProfileData",{action:"createFavoriteFolder",folderName:t,openid:e}).then((function(t){uni.hideLoading(),console.log("组件创建收藏夹返回结果:",t),t&&t.result?t.result.success?(uni.showToast({title:"创建成功",duration:2e3}),n.setData({showCreateModal:!1}),setTimeout((function(){n.loadFolders()}),300)):(console.error("组件创建收藏夹业务失败:",t.result),uni.showToast({title:t.result.message||"创建失败",icon:"none",duration:3e3})):(console.error("组件创建收藏夹返回格式异常:",t),uni.showToast({title:"创建失败：返回格式错误",icon:"none",duration:3e3}))})).catch((function(n){uni.hideLoading(),console.error("组件创建收藏夹云函数调用失败:",n),uni.showToast({title:"创建失败: "+(n.errMsg||"网络错误"),icon:"none",duration:3e3})})))}else uni.showToast({title:"请输入收藏夹名称",icon:"none"})},hideModal:function(){console.log("=== 点击关闭按钮，开始隐藏弹窗 ==="),console.log("当前状态：",{show:this.show,showCreateModal:this.showCreateModal,selectedFolderId:this.selectedFolderId}),this.setData({selectedFolderId:"",showClone:!1,showCreateModal:!1,newFolderName:""}),console.log("=== 弹窗已隐藏，状态已重置 ==="),this.$emit("hide")},trueFun:function(){console.log("占位：函数 true 未声明")}},created:function(){}};t.default=s},9167:function(n,t){n.exports={getLikeIcon:function(n,t){var e="";return e=n<=3?t?"seedplus.png":"seed.png":n<=7?t?"leafplus.png":"leaf.png":n<=15?t?"flowerplus .png":"flower.png":t?"peachplus.png":"peach.png","/static/images/"+e},getLikeIconDescription:function(n){return n<=3?"种子":n<=7?"叶子":n<=15?"花":"果实"}}},"93b1":function(n,t,e){"use strict";e.r(t);var o=e("cfd9"),i=e("e4aa");for(var a in i)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return i[n]}))}(a);e("178c");var r=e("828b"),s=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"1915049e",null,!1,o["a"],void 0);t["default"]=s.exports},"982d":function(n,t,e){var o=e("7a2f");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);var i=e("967d").default;i("3928eb3b",o,!0,{sourceMap:!1,shadowMode:!1})},9878:function(n,t,e){var o=e("c86c");t=o(!1),t.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* components/portfolio-selector/portfolio-selector.wxss */.modal-overlay[data-v-747a115c]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[data-v-747a115c]{background:#fff;border-radius:%?16?%;margin:%?40?%;width:calc(100% - %?80?%);max-width:%?600?%;max-height:80vh;display:flex;flex-direction:column}.modal-header[data-v-747a115c]{display:flex;align-items:center;justify-content:space-between;padding:%?30?% %?40?%;border-bottom:%?1?% solid #f0f0f0}.modal-title[data-v-747a115c]{font-size:%?36?%;font-weight:500;color:#333}.header-actions[data-v-747a115c]{display:flex;align-items:center;gap:%?20?%}.refresh-btn[data-v-747a115c]{font-size:%?36?%;color:#9ed7ee;padding:%?8?%;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease}.refresh-btn[data-v-747a115c]:active{-webkit-transform:scale(.9);transform:scale(.9);opacity:.7}.refresh-btn.refreshing[data-v-747a115c]{-webkit-animation:rotate-data-v-747a115c 1s linear infinite;animation:rotate-data-v-747a115c 1s linear infinite}@-webkit-keyframes rotate-data-v-747a115c{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotate-data-v-747a115c{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.close-btn[data-v-747a115c]{font-size:%?48?%;color:#999;line-height:1;position:relative;z-index:1001}.modal-body[data-v-747a115c]{flex:1;padding:%?20?% 0;max-height:60vh;overflow-y:auto}.loading-container[data-v-747a115c]{display:flex;justify-content:center;align-items:center;height:%?200?%}.loading-text[data-v-747a115c]{color:#999;font-size:%?28?%}.portfolios-list[data-v-747a115c]{padding:0 %?40?%}.portfolio-item[data-v-747a115c]{display:flex;align-items:center;padding:%?24?% 0;border-bottom:%?1?% solid #f8f8f8}.portfolio-item[data-v-747a115c]:last-child{border-bottom:none}.portfolio-item.selected[data-v-747a115c]{background:rgba(158,215,238,.1);border-radius:%?8?%;padding:%?24?% %?20?%;margin:0 %?-20?%}.portfolio-icon[data-v-747a115c]{font-size:%?40?%;margin-right:%?20?%}.portfolio-info[data-v-747a115c]{flex:1}.portfolio-name[data-v-747a115c]{font-size:%?30?%;color:#333;font-weight:500;margin-bottom:%?4?%}.portfolio-count[data-v-747a115c]{font-size:%?24?%;color:#999}.selected-icon[data-v-747a115c]{font-size:%?32?%;color:#9ed7ee;font-weight:700}.empty-state[data-v-747a115c]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:%?200?%;padding:%?40?%}.empty-icon[data-v-747a115c]{font-size:%?60?%;margin-bottom:%?16?%;opacity:.5}.empty-text[data-v-747a115c]{font-size:%?28?%;color:#666;margin-bottom:%?8?%}.empty-subtext[data-v-747a115c]{font-size:%?24?%;color:#999}.modal-footer[data-v-747a115c]{display:flex;gap:%?20?%;padding:%?30?% %?40?%;border-top:%?1?% solid #f0f0f0}.modal-btn[data-v-747a115c]{flex:1;height:%?80?%;border-radius:%?8?%;font-size:%?28?%;border:none;display:flex;align-items:center;justify-content:center;position:relative;z-index:1001}.secondary-btn[data-v-747a115c]{background:#f5f5f5;color:#666}.primary-btn[data-v-747a115c]{background:#9ed7ee;color:#fff}.primary-btn[data-v-747a115c]:disabled{background:#ccc;color:#999}\r\n/* 创建作品集弹窗样式 */.create-modal .modal-body[data-v-747a115c]{padding:%?40?%}.portfolio-name-input[data-v-747a115c]{width:100%;height:%?80?%;padding:0 %?20?%;border:%?2?% solid #e0e0e0;border-radius:%?8?%;font-size:%?30?%;box-sizing:border-box}.portfolio-name-input[data-v-747a115c]:focus{border-color:#9ed7ee}",""]),n.exports=t},a0f2:function(n,t,e){var o=e("c86c");t=o(!1),t.push([n.i,".install_tip_back[data-v-a8601b98]{position:fixed;top:0;right:0;bottom:0;left:0;background-color:rgba(0,0,0,.4);z-index:1}.install_tip_close[data-v-a8601b98]{position:absolute;right:%?10?%;top:%?10?%;width:32px;height:32px\n    /* background-color: red; */}.install_tip_detail[data-v-a8601b98]{position:fixed;background-color:#fff;right:0;bottom:0;left:0;border-radius:%?40?% %?40?% 0 0;padding:%?50?% %?50?% %?100?% %?50?%;z-index:9}.install_tip_detail_title[data-v-a8601b98]{font-weight:400;font-size:%?40?%;text-align:center}.install_tip_detail_tip[data-v-a8601b98]{font-size:%?25?%;color:rgba(0,0,0,.4);margin-top:%?20?%;text-align:left}.install_tip_detail_buttons[data-v-a8601b98]{padding-top:%?50?%;display:flex}.install_tip_detail_button[data-v-a8601b98]{color:#07c160;font-weight:500;background-color:rgba(0,0,0,.1);width:40%;text-align:center;\n    /* height: 90rpx; */border-radius:%?10?%;margin:0 auto}.install_tip_detail_button_primary[data-v-a8601b98]{background-color:#07c160;color:#fff}",""]),n.exports=t},b89d:function(n,t,e){"use strict";e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return i})),e.d(t,"a",(function(){}));var o=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[n.showClone?e("v-uni-view",{staticClass:"modal-overlay"},[e("v-uni-view",{staticClass:"modal-content"},[e("v-uni-view",{staticClass:"modal-header"},[e("v-uni-view",{staticClass:"modal-title"},[n._v("选择收藏夹")]),e("v-uni-view",{staticClass:"close-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.hideModal.apply(void 0,arguments)}}},[n._v("×")])],1),e("v-uni-view",{staticClass:"modal-body"},[n.isLoading?e("v-uni-view",{staticClass:"loading-container"},[e("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1):n.folders.length>0?e("v-uni-view",{staticClass:"folders-list"},n._l(n.folders,(function(t,o){return e("v-uni-view",{key:o,class:"folder-item "+(n.selectedFolderId===t._id?"selected":""),attrs:{"data-folder-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.selectFolder.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"folder-icon"},[n._v("📁")]),e("v-uni-view",{staticClass:"folder-info"},[e("v-uni-view",{staticClass:"folder-name"},[n._v(n._s(t.name))]),e("v-uni-view",{staticClass:"folder-count"},[n._v(n._s(t.itemCount)+" 个收藏")])],1),n.selectedFolderId===t._id?e("v-uni-view",{staticClass:"selected-icon"},[n._v("✓")]):n._e()],1)})),1):e("v-uni-view",{staticClass:"empty-state"},[e("v-uni-view",{staticClass:"empty-icon"},[n._v("📁")]),e("v-uni-view",{staticClass:"empty-text"},[n._v("还没有收藏夹")]),e("v-uni-view",{staticClass:"empty-subtext"},[n._v("先创建一个收藏夹吧")])],1)],1),e("v-uni-view",{staticClass:"modal-footer"},[e("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.createFolder.apply(void 0,arguments)}}},[n._v("创建收藏夹")]),e("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.selectedFolderId},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.confirmFavorite.apply(void 0,arguments)}}},[n._v("确认收藏")])],1)],1)],1):n._e(),n.showCreateModal?e("v-uni-view",{staticClass:"modal-overlay"},[e("v-uni-view",{staticClass:"modal-content create-modal"},[e("v-uni-view",{staticClass:"modal-header"},[e("v-uni-view",{staticClass:"modal-title"},[n._v("创建收藏夹")]),e("v-uni-view",{staticClass:"close-btn",on:{click:[function(t){arguments[0]=t=n.$handleEvent(t),n.hideCreateModal.apply(void 0,arguments)},function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.trueFun.apply(void 0,arguments)}]}},[n._v("×")])],1),e("v-uni-view",{staticClass:"modal-body"},[e("v-uni-input",{staticClass:"folder-name-input",attrs:{placeholder:"请输入收藏夹名称",value:n.newFolderName,focus:!0},on:{input:function(t){arguments[0]=t=n.$handleEvent(t),n.onFolderNameInput.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.trueFun.apply(void 0,arguments)}}})],1),e("v-uni-view",{staticClass:"modal-footer"},[e("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.hideCreateModal.apply(void 0,arguments)}}},[n._v("取消")]),e("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.newFolderName},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.createNewFolder.apply(void 0,arguments)}}},[n._v("创建")])],1)],1)],1):n._e()],1)},i=[]},c107:function(n,t,e){"use strict";e.r(t);var o=e("b89d"),i=e("44f3");for(var a in i)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return i[n]}))}(a);e("e9a0");var r=e("828b"),s=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"3a05c372",null,!1,o["a"],void 0);t["default"]=s.exports},c1d0:function(n,t,e){"use strict";e.r(t);var o=e("62d9"),i=e("db30");for(var a in i)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return i[n]}))}(a);e("e7ed");var r=e("828b"),s=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"a8601b98",null,!1,o["a"],void 0);t["default"]=s.exports},cfd9:function(n,t,e){"use strict";e.d(t,"b",(function(){return i})),e.d(t,"c",(function(){return a})),e.d(t,"a",(function(){return o}));var o={folderSelector:e("c107").default,portfolioSelector:e("5155").default},i=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[e("v-uni-view",{staticClass:"custom-back-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.goBack.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"back-icon",attrs:{src:"/static/images/back_to_edit.png",mode:"aspectFit"}})],1),e("v-uni-view",{staticClass:"container"},[n.isLoading?[e("v-uni-view",{staticClass:"post-detail-skeleton"},[e("v-uni-view",{staticClass:"skeleton-wrapper"},[e("v-uni-view",{staticClass:"skeleton-header"},[e("v-uni-view",{staticClass:"skeleton-avatar skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-header-text"},[e("v-uni-view",{staticClass:"skeleton-line medium skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-line short skeleton-animate"})],1)],1),e("v-uni-view",{staticClass:"skeleton-line long skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-line medium skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-line short skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-image skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-line long skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-line medium skeleton-animate"})],1),e("v-uni-view",{staticClass:"skeleton-section-title skeleton-animate"}),e("v-uni-view",{staticClass:"comment-skeleton-list"},n._l(n.commentSkeletonCount,(function(n){return e("v-uni-view",{key:"post-skeleton-comment-"+n,staticClass:"comment-skeleton-item"},[e("v-uni-view",{staticClass:"skeleton-avatar skeleton-animate"}),e("v-uni-view",{staticClass:"comment-skeleton-body"},[e("v-uni-view",{staticClass:"skeleton-line medium skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-line short skeleton-animate"})],1)],1)})),1)],1)]:n.post&&n.post._id?[e("v-uni-view",{class:"post-detail-wrapper "+(n.post.isOriginal?"original-post":"")},[e("v-uni-view",{staticClass:"author-info"},[e("v-uni-view",{staticClass:"author-basic"},[n.post.authorAvatar?e("v-uni-image",{staticClass:"author-avatar",attrs:{src:n.post.authorAvatar,mode:"aspectFill","data-user-id":n.post._openid},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onAvatarError.apply(void 0,arguments)},click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateToUserProfile.apply(void 0,arguments)}}}):n._e(),e("v-uni-text",{staticClass:"author-name"},[n._v(n._s(n.post.authorName))]),n.isMutualFollow?e("v-uni-view",{staticClass:"mutual-tag"},[n._v("互相关注")]):n.isFollowedByAuthor?e("v-uni-view",{staticClass:"followed-tag"},[n._v("TA关注了你")]):n._e()],1),n.showFollowButton?e("v-uni-button",{class:"follow-btn "+(n.isFollowing?"following":""),attrs:{loading:n.followPending,disabled:n.followPending},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onFollowTap.apply(void 0,arguments)}}},[n._v(n._s(n.isFollowing?"已关注":"关注"))]):n._e()],1),e("v-uni-view",{staticClass:"post-title"},[n._v(n._s(n.post.title))]),n.post.isPoem&&n.post.author?e("v-uni-view",{staticClass:"poem-author"},[n._v(n._s(n.post.author))]):n._e(),n.post.isDiscussion&&n.post.sentenceGroups?e("v-uni-view",{staticClass:"discussion-content"},n._l(n.post.sentenceGroups,(function(t,o){return e("v-uni-view",{key:"discussion-group-"+o,staticClass:"discussion-sentence-group"},[e("v-uni-view",{staticClass:"discussion-sentence-card"},[e("v-uni-view",{staticClass:"discussion-sentence-content"},n._l(t.sentences,(function(t,o){return e("v-uni-text",{key:"discussion-sentence-"+o,staticClass:"discussion-sentence-line"},[n._v(n._s(t))])})),1)],1),t.comment?e("v-uni-view",{staticClass:"discussion-comment"},[n._v(n._s(t.comment))]):n._e()],1)})),1):n.post.content?e("v-uni-view",{staticClass:"post-content"},[n._v(n._s(n.post.content))]):n._e(),n.post.tags&&n.post.tags.length>0?e("v-uni-view",{staticClass:"post-tags"},n._l(n.post.tags,(function(t,o){return e("v-uni-text",{key:o,staticClass:"post-tag",attrs:{"data-tag":t},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onTagClick.apply(void 0,arguments)}}},[n._v("#"+n._s(t))])})),1):n._e(),n.post.imageUrl||n.post.imageUrls&&n.post.imageUrls.length>0?e("v-uni-view",{staticClass:"image-container",attrs:{id:"detail-image-container"}},[n.post.imageUrls&&1===n.post.imageUrls.length?[e("v-uni-image",{style:"width: 100%; height: "+(n.post&&n.post._id&&n.imageClampHeights[n.post._id]?n.imageClampHeights[n.post._id]+"px":"auto")+"; object-fit: "+(n.post&&n.post._id&&n.imageClampHeights[n.post._id]?"cover":"contain")+"; background-color: #f0f0f0;",attrs:{id:"single-image-"+(n.post&&n.post._id?n.post._id:""),src:n.post.imageUrls[0],mode:n.post&&n.post._id&&n.imageClampHeights[n.post._id]?"aspectFill":"widthFix","data-postid":n.post&&n.post._id?n.post._id:"","data-type":"single","data-src":n.post.imageUrls[0],"data-original-image-urls":n.post.originalImageUrls||n.post.imageUrls,"lazy-load":!0},on:{load:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageLoad.apply(void 0,arguments)},error:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageError.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.handlePreview.apply(void 0,arguments)}}})]:n.post.imageUrls&&n.post.imageUrls.length>1?[e("v-uni-swiper",{staticClass:"image-swiper",style:"width: 100%; height: "+(n.swiperHeights[0]?n.swiperHeights[0]+"px":"220px")+";",attrs:{id:"swiper-"+(n.post&&n.post._id?n.post._id:""),"indicator-dots":!0,circular:!0}},[n._l(n.post.imageUrls,(function(t,o){return[e("v-uni-swiper-item",[e("v-uni-image",{staticStyle:{width:"100%",height:"100%","object-fit":"cover","background-color":"#f0f0f0"},attrs:{src:t,mode:"aspectFill","data-postid":n.post&&n.post._id?n.post._id:"","data-postindex":"0","data-imgindex":o,"data-type":"multi","data-src":t,"data-original-image-urls":n.post.originalImageUrls||n.post.imageUrls,"lazy-load":!0},on:{load:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageLoad.apply(void 0,arguments)},error:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageError.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.handlePreview.apply(void 0,arguments)}}})],1)]}))],2)]:n._e()],2):n._e(),e("v-uni-view",{staticClass:"post-meta"},[e("v-uni-text",{staticClass:"post-time"},[n._v(n._s(n.post.formattedCreateTime))])],1),e("v-uni-view",{staticClass:"vote-section",on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.preventBubble.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"actions-left"}),e("v-uni-view",{staticClass:"button-group"},[e("v-uni-view",{staticClass:"like-icon-container",attrs:{"data-postid":n.post&&n.post._id?n.post._id:""},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onVote.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"like-icon",attrs:{src:n.post.likeIcon,mode:"aspectFit"}})],1),n.isOwnPost?e("v-uni-view",{staticClass:"portfolio-icon-container",on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onAddToPortfolio.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"portfolio-icon",attrs:{src:"/static/images/portfolio.png",mode:"aspectFit"}})],1):e("v-uni-view",{class:"favorite-icon-container "+(n.isFavorited?"favorited":""),on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onFavorite.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"favorite-icon",attrs:{src:"/static/images/my_favorites.png",mode:"aspectFit"}})],1),n.post.isPoem?e("v-uni-view",{staticClass:"discussion-icon-container",on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onCreateDiscussion.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"discussion-icon",attrs:{src:"/static/images/write_poetry.png",mode:"aspectFit"}})],1):n._e(),e("v-uni-view",{staticClass:"comment-icon-container",on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.expandInput.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"comment-icon",attrs:{src:"/static/images/write_comment.png",mode:"aspectFit"}})],1)],1)],1)],1),e("v-uni-view",{staticClass:"comment-section"},[e("v-uni-view",{staticClass:"section-title"},[n._v("共"+n._s(n.isCommentLoading?"--":n.commentCount)+" 条评论")]),n.isCommentLoading?e("v-uni-view",{staticClass:"comment-skeleton-list"},n._l(n.commentSkeletonCount,(function(n){return e("v-uni-view",{key:"detail-comment-skeleton-"+n,staticClass:"comment-skeleton-item"},[e("v-uni-view",{staticClass:"skeleton-avatar skeleton-animate"}),e("v-uni-view",{staticClass:"comment-skeleton-body"},[e("v-uni-view",{staticClass:"skeleton-line medium skeleton-animate"}),e("v-uni-view",{staticClass:"skeleton-line short skeleton-animate"})],1)],1)})),1):e("v-uni-view",{staticClass:"comment-list"},[n.comments.length>0?n._l(n.comments,(function(t,o){return e("v-uni-view",{key:o,staticClass:"comment-item"},[e("v-uni-image",{staticClass:"comment-avatar",attrs:{src:t.authorAvatar,mode:"aspectFill","data-user-id":t._openid},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onAvatarError.apply(void 0,arguments)},click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateToUserProfile.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"comment-main"},[e("v-uni-view",{staticClass:"comment-author"},[n._v(n._s(t.authorName))]),e("v-uni-view",{staticClass:"comment-content"},[n._v(n._s(t.content))]),t.imageUrls&&t.imageUrls.length?e("v-uni-view",{staticClass:"comment-image-grid"},n._l(t.imageUrls,(function(t,i){return e("v-uni-image",{key:i,staticClass:"comment-image",attrs:{src:t,mode:"aspectFill","data-comment-index":o,"data-image-index":i,"data-is-reply":!1},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.previewCommentImageFromList.apply(void 0,arguments)}}})})),1):n._e(),e("v-uni-view",{staticClass:"comment-footer"},[e("v-uni-view",{staticClass:"comment-time"},[n._v(n._s(t.formattedCreateTime))]),e("v-uni-view",{staticClass:"comment-actions"},[e("v-uni-view",{staticClass:"like-section",attrs:{"data-comment-id":t._id,"data-liked":t.liked},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.toggleLikeComment.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"like-icon",attrs:{src:t.likeIcon}}),e("v-uni-text",{staticClass:"like-count"},[n._v(n._s(t.likes||0))])],1),t.canDelete?e("v-uni-view",{staticClass:"delete-btn",attrs:{"data-comment-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onDeleteComment.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"delete-text"},[n._v("删除")])],1):n._e(),e("v-uni-view",{staticClass:"reply-btn",attrs:{"data-comment-id":t._id,"data-author-name":t.authorName},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.showReplyInput.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"reply-text"},[n._v("回复")])],1)],1)],1),t.replies&&t.replies.length>0?e("v-uni-view",{staticClass:"replies-container"},[n._l(t.replies,(function(i,a){return a<(t.showAllReplies?t.replies.length:3)?e("v-uni-view",{key:a,staticClass:"reply-item"},[e("v-uni-image",{staticClass:"reply-avatar",attrs:{src:i.authorAvatar,mode:"aspectFill","data-user-id":i._openid},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onAvatarError.apply(void 0,arguments)},click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateToUserProfile.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"reply-main"},[e("v-uni-view",{staticClass:"reply-author"},[n._v(n._s(i.authorName))]),e("v-uni-view",{staticClass:"reply-content"},[e("v-uni-text",{staticClass:"reply-to"},[n._v("回复@"+n._s(t.authorName)+"：")]),e("v-uni-text",[n._v(n._s(i.content))])],1),i.imageUrls&&i.imageUrls.length?e("v-uni-view",{staticClass:"comment-image-grid reply-image-grid"},n._l(i.imageUrls,(function(t,i){return e("v-uni-image",{key:i,staticClass:"comment-image",attrs:{src:t,mode:"aspectFill","data-comment-index":o,"data-reply-index":a,"data-image-index":i,"data-is-reply":!0},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.previewCommentImageFromList.apply(void 0,arguments)}}})})),1):n._e(),e("v-uni-view",{staticClass:"reply-footer"},[e("v-uni-view",{staticClass:"reply-time"},[n._v(n._s(i.formattedCreateTime))]),e("v-uni-view",{staticClass:"reply-actions"},[e("v-uni-view",{staticClass:"like-section",attrs:{"data-comment-id":i._id,"data-liked":i.liked},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.toggleLikeComment.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"like-icon",attrs:{src:i.likeIcon}}),e("v-uni-text",{staticClass:"like-count"},[n._v(n._s(i.likes||0))])],1),i.canDelete?e("v-uni-view",{staticClass:"delete-btn",attrs:{"data-comment-id":i._id,"data-parent-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onDeleteComment.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"delete-text"},[n._v("删除")])],1):n._e(),e("v-uni-view",{staticClass:"reply-btn",attrs:{"data-comment-id":t._id,"data-author-name":i.authorName},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.showReplyInput.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"reply-text"},[n._v("回复")])],1)],1)],1)],1)],1):n._e()})),t.replies.length>3&&!t.showAllReplies?e("v-uni-view",{staticClass:"show-more-replies",attrs:{"data-comment-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.toggleShowAllReplies.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"show-more-text"},[n._v("显示"+n._s(t.replies.length-3)+"条回复")])],1):n._e(),t.replies.length>3&&t.showAllReplies?e("v-uni-view",{staticClass:"show-more-replies",attrs:{"data-comment-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.toggleShowAllReplies.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"show-more-text"},[n._v("收起回复")])],1):n._e()],2):n._e()],1)],1)})):[e("v-uni-view",{staticClass:"no-comment-tip"},[e("v-uni-view",{staticClass:"empty-icon"},[n._v("💬")]),e("v-uni-view",{staticClass:"empty-text"},[n._v("暂无评论，快来抢沙发吧！")])],1)]],2)],1)]:[e("v-uni-view",{staticClass:"error-container"},[e("v-uni-view",{staticClass:"error-icon"},[n._v("❌")]),e("v-uni-view",{staticClass:"error-text"},[n._v("帖子加载失败或不存在")])],1)]],2),e("v-uni-view",{class:"input-overlay "+(n.isInputExpanded?"show":""),on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.collapseInput.apply(void 0,arguments)}}}),n.isInputExpanded?e("v-uni-view",{staticClass:"comment-input-area",style:"bottom: "+n.keyboardHeight+"px;"},[n.isInputExpanded?e("v-uni-view",{staticClass:"expanded-container"},[n.replyToComment?e("v-uni-view",{staticClass:"reply-prompt"},[e("v-uni-text",{staticClass:"reply-prompt-text"},[n._v("回复 "+n._s(n.replyToAuthor)+"：")]),e("v-uni-view",{staticClass:"cancel-reply",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.cancelReply.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"cancel-text"},[n._v("取消")])],1)],1):n._e(),e("v-uni-textarea",{staticClass:"expanded-textarea",attrs:{placeholder:"留下你的精彩评论...",value:n.newComment,focus:n.isFocus,"auto-height":!0,maxlength:"500","show-confirm-bar":!1,"adjust-position":!1},on:{input:function(t){arguments[0]=t=n.$handleEvent(t),n.onCommentInput.apply(void 0,arguments)},focus:function(t){arguments[0]=t=n.$handleEvent(t),n.onInputFocus.apply(void 0,arguments)},blur:function(t){arguments[0]=t=n.$handleEvent(t),n.onInputBlur.apply(void 0,arguments)}}}),n.commentImages.length?e("v-uni-view",{staticClass:"selected-comment-images"},n._l(n.commentImages,(function(t,o){return e("v-uni-view",{key:o,staticClass:"selected-image-item",attrs:{"data-index":o}},[e("v-uni-image",{staticClass:"selected-image-thumb",attrs:{src:t.previewUrl,mode:"aspectFill","data-index":o},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.previewSelectedCommentImage.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"remove-image-btn",attrs:{"data-index":o},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.removeCommentImage.apply(void 0,arguments)}}},[n._v("✕")])],1)})),1):n._e(),e("v-uni-view",{staticClass:"expanded-actions"},[e("v-uni-view",{staticClass:"action-icons"},[e("v-uni-view",{staticClass:"action-icon",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.chooseImages.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"action-icon-image",attrs:{src:"/static/images/add_image.png",mode:"aspectFit"}})],1)],1),e("v-uni-button",{staticClass:"submit-button",attrs:{disabled:n.isSubmitDisabled},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onSubmitComment.apply(void 0,arguments)}}},[n._v("发送")])],1)],1):n._e()],1):n._e(),e("cloud-tip-modal",{attrs:{showUploadTip:n.showUploadTip}}),e("folder-selector",{attrs:{show:n.showFavoriteModal,"post-id":n.post&&n.post._id?n.post._id:""},on:{hide:function(t){arguments[0]=t=n.$handleEvent(t),n.hideFavoriteModal.apply(void 0,arguments)},favoriteSuccess:function(t){arguments[0]=t=n.$handleEvent(t),n.onFavoriteSuccess.apply(void 0,arguments)}}}),e("portfolio-selector",{attrs:{show:n.showPortfolioModal,"post-id":n.post&&n.post._id?n.post._id:""},on:{hide:function(t){arguments[0]=t=n.$handleEvent(t),n.hidePortfolioModal.apply(void 0,arguments)},portfolioSuccess:function(t){arguments[0]=t=n.$handleEvent(t),n.onPortfolioSuccess.apply(void 0,arguments)}}})],1)},a=[]},db30:function(n,t,e){"use strict";e.r(t);var o=e("1aa6"),i=e.n(o);for(var a in o)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(a);t["default"]=i.a},e207:function(n,t,e){"use strict";var o=e("67e5"),i=e.n(o);i.a},e4aa:function(n,t,e){"use strict";e.r(t);var o=e("3ef6"),i=e.n(o);for(var a in o)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(a);t["default"]=i.a},e7ed:function(n,t,e){"use strict";var o=e("2748"),i=e.n(o);i.a},e9a0:function(n,t,e){"use strict";var o=e("982d"),i=e.n(o);i.a}}]);