(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-add-add"],{1762:function(n,e,t){"use strict";t.d(e,"b",(function(){return o})),t.d(e,"c",(function(){return a})),t.d(e,"a",(function(){}));var o=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-uni-view",{staticClass:"container",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.onPageTap.apply(void 0,arguments)}}},[n.imageList.length>0?t("v-uni-view",{staticClass:"image-section"},[t("v-uni-scroll-view",{staticClass:"image-preview-scroll",attrs:{"scroll-x":!0,"show-scrollbar":!1}},[t("v-uni-view",{staticClass:"image-preview-container"},[n._l(n.imageList,(function(e,o){return t("v-uni-view",{key:o,staticClass:"image-preview-item"},[t("v-uni-image",{staticClass:"preview-image",attrs:{src:e.previewUrl,mode:"aspectFill"},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.onImageError.apply(void 0,arguments)}}}),t("v-uni-view",{staticClass:"image-remove-btn",attrs:{"data-index":o},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.removeImage.apply(void 0,arguments)}}},[n._v("×")])],1)})),n.imageList.length<n.maxImageCount?t("v-uni-view",{staticClass:"add-image-btn",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.handleChooseImage.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"add-icon"},[n._v("+")])],1):n._e()],2)],1)],1):n._e(),n.showColorPicker?t("v-uni-view",{staticClass:"color-picker-mask",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.showColorPicker=!1}}},[t("v-uni-view",{staticClass:"color-picker",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.noop.apply(void 0,arguments)}}},["palette"===n.colorPickerStep?t("v-uni-view",{staticClass:"color-palette-step"},[t("v-uni-view",{staticClass:"color-picker-title"},[n._v("选择色卡")]),t("v-uni-scroll-view",{staticClass:"palette-scroll",attrs:{"scroll-y":!0}},[t("v-uni-view",{staticClass:"palette-grid"},n._l(n.colorPalettes,(function(e,o){return t("v-uni-view",{key:o,staticClass:"palette-card",style:{backgroundColor:e.colors[0].backgroundColor},attrs:{"data-index":o},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.selectPalette.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"palette-name",style:{color:e.colors[0].textColor}},[n._v(n._s(e.name))]),t("v-uni-view",{staticClass:"palette-preview"},n._l(e.colors.slice(0,3),(function(n,e){return t("v-uni-view",{key:e,staticClass:"mini-color",style:{backgroundColor:n.backgroundColor}})})),1)],1)})),1)],1)],1):n._e(),"colors"===n.colorPickerStep?t("v-uni-view",{staticClass:"color-detail-step"},[t("v-uni-view",{staticClass:"color-picker-header"},[t("v-uni-view",{staticClass:"color-picker-title"},[n._v(n._s(n.selectedPalette.name))]),t("v-uni-view",{staticClass:"color-picker-back-btn",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.goBackToPalette.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"color-picker-back-icon",attrs:{src:"/static/images/back_to_edit.png",mode:"aspectFit"}})],1)],1),t("v-uni-scroll-view",{staticClass:"colors-scroll",attrs:{"scroll-y":!0}},[t("v-uni-view",{staticClass:"colors-grid"},n._l(n.selectedPalette.colors,(function(e,o){return t("v-uni-view",{key:o,staticClass:"color-option",style:{backgroundColor:e.backgroundColor,color:e.textColor},attrs:{"data-color":e},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.chooseColor.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"color-text"},[n._v(n._s(n.getPoemLine(o)))]),n.isColorSelected(e)?t("v-uni-text",{staticClass:"color-check"},[n._v("✓")]):n._e()],1)})),1)],1)],1):n._e()],1)],1):n._e(),t("v-uni-view",{staticClass:"content-section"},[t("v-uni-view",{staticClass:"main-input-area",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.noop.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"content-input-wrapper",attrs:{"data-highlight-mode":n.highlightModeEnabled}},[t("v-uni-textarea",{staticClass:"content-textarea",attrs:{placeholder:"此刻你想要分享...",maxlength:"1500",value:n.content,"show-confirm-bar":!1,"adjust-position":!1},on:{input:function(e){arguments[0]=e=n.$handleEvent(e),n.onContentInput.apply(void 0,arguments)},focus:function(e){arguments[0]=e=n.$handleEvent(e),n.onTextareaFocus.apply(void 0,arguments)},blur:function(e){arguments[0]=e=n.$handleEvent(e),n.onTextareaBlur.apply(void 0,arguments)},scroll:function(e){arguments[0]=e=n.$handleEvent(e),n.onTextareaScroll.apply(void 0,arguments)},click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.onTextareaTap.apply(void 0,arguments)}}}),n.content.length>1400?t("v-uni-view",{staticClass:"char-count"},[n._v(n._s(n.content.length)+"/1500")]):n._e(),n.content.trim()&&n.highlightModeEnabled?t("v-uni-view",{staticClass:"highlight-select-overlay",attrs:{catchtouchmove:"true"},on:{touchstart:function(e){arguments[0]=e=n.$handleEvent(e),n.onOverlayTouchStart.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=n.$handleEvent(e),n.onOverlayTouchEnd.apply(void 0,arguments)},touchmove:function(e){arguments[0]=e=n.$handleEvent(e),n.onOverlayTouchMove.apply(void 0,arguments)}}},[t("v-uni-scroll-view",{staticClass:"overlay-scroll",attrs:{"scroll-y":!0,"scroll-top":n.overlayScrollTop}},[t("v-uni-view",{staticClass:"overlay-content"},n._l(n.splitContentLines,(function(e,o){return t("v-uni-view",{key:"overlay-line-"+o,class:"overlay-line "+(n.highlightSelectedLineIndices.includes(o)?"highlighted":""),style:"top: "+48*o+"rpx;",attrs:{"data-index":o},on:{touchstart:function(e){arguments[0]=e=n.$handleEvent(e),n.onLineTouchStart.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=n.$handleEvent(e),n.onLineTouchEnd.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"overlay-line-content"},[n._v(n._s(e||" "))])],1)})),1)],1)],1):n._e(),n.showHighlightHint?t("v-uni-view",{staticClass:"highlight-hint"},[t("v-uni-text",{staticClass:"hint-text"},[n._v("点击文字即可选择高光行")])],1):n._e(),n.highlightSelecting?t("v-uni-view",{staticClass:"highlight-overlay",attrs:{catchtouchmove:"true"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.noop.apply(void 0,arguments)}}},[t("v-uni-scroll-view",{staticClass:"highlight-scroll",attrs:{"scroll-y":!0}},n._l(n.splitContentLines,(function(e,o){return t("v-uni-view",{key:o,class:"hl-line "+(n.highlightSelectedLineIndices.includes(o)?"selected":""),attrs:{"data-index":o},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.toggleHighlightLine.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"hl-text"},[n._v(n._s(e.length?e:" "))])],1)})),1),t("v-uni-view",{staticClass:"hl-actions"},[t("v-uni-button",{staticClass:"hl-done",attrs:{size:"mini"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.finishHighlight.apply(void 0,arguments)}}},[n._v("完成")]),t("v-uni-button",{staticClass:"hl-clear",attrs:{size:"mini"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=n.$handleEvent(e),n.clearHighlight.apply(void 0,arguments)}}},[n._v("清除")])],1)],1):n._e()],1),t("v-uni-view",{staticClass:"side-toolbar"},[t("v-uni-view",{staticClass:"side-tool-btn",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.toggleTagSelector.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"side-tool-icon",attrs:{src:"/static/images/add_tag.png",mode:"aspectFit"}})],1),t("v-uni-view",{staticClass:"side-tool-btn",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.handleChooseImage.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"side-tool-icon",attrs:{src:"/static/images/add_image.png",mode:"aspectFit"}})],1),t("v-uni-view",{staticClass:"side-tool-btn",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.switchMode.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"side-tool-icon",attrs:{src:"/static/images/switch_publish_mode.png",mode:"aspectFit"}})],1),t("v-uni-view",{staticClass:"side-tool-btn",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.toggleHighlightMode.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"side-tool-icon",attrs:{src:"/static/images/select_highlight.png",mode:"aspectFit"}})],1),t("v-uni-view",{staticClass:"side-tool-btn",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.onSelectColor.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"side-tool-icon",attrs:{src:"/static/images/select_color.png",mode:"aspectFit"}})],1)],1)],1),t("v-uni-view",{staticClass:"bottom-actions"},[t("v-uni-button",{staticClass:"back-btn-inline",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.goBack.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"back-icon-inline",attrs:{src:"/static/images/back_to_edit.png",mode:"aspectFit"}}),t("v-uni-text",{staticClass:"back-text"},[n._v("返回")])],1),t("v-uni-button",{staticClass:"publish-btn",attrs:{disabled:!n.canPublish},on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.goToPreview.apply(void 0,arguments)}}},[t("v-uni-image",{staticClass:"publish-icon",attrs:{src:"/static/images/enter_key.png",mode:"aspectFit"}}),t("v-uni-text",{staticClass:"publish-text"},[n._v("发布")])],1)],1)],1),n.showModeSelector?t("v-uni-view",{staticClass:"mode-selector-mask",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.showModeSelector=!1}}},[t("v-uni-view",{staticClass:"mode-selector",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.noop.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"mode-title"},[n._v("选择发布模式")]),t("v-uni-view",{staticClass:"mode-list"},[t("v-uni-view",{staticClass:"mode-option",attrs:{"data-mode":"poem","data-original":!0},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.selectPublishMode.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"mode-text"},[n._v("原创诗歌")]),"poem"===n.publishMode&&n.isOriginal?t("v-uni-view",{staticClass:"mode-check"},[n._v("✓")]):n._e()],1),t("v-uni-view",{staticClass:"mode-option",attrs:{"data-mode":"poem","data-original":!1},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.selectPublishMode.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"mode-text"},[n._v("非原创诗歌")]),"poem"!==n.publishMode||n.isOriginal?n._e():t("v-uni-view",{staticClass:"mode-check"},[n._v("✓")])],1),t("v-uni-view",{staticClass:"mode-option",attrs:{"data-mode":"normal","data-original":null},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.selectPublishMode.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"mode-text"},[n._v("普通帖子")]),"normal"===n.publishMode?t("v-uni-view",{staticClass:"mode-check"},[n._v("✓")]):n._e()],1),t("v-uni-view",{staticClass:"mode-option",attrs:{"data-mode":"discussion","data-original":null},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.selectPublishMode.apply(void 0,arguments)}}},[t("v-uni-view",{staticClass:"mode-text"},[n._v("讨论帖子")]),"discussion"===n.publishMode?t("v-uni-view",{staticClass:"mode-check"},[n._v("✓")]):n._e()],1)],1)],1)],1):n._e(),n.showTagSelector?t("v-uni-view",{staticClass:"tag-section",style:"bottom: 120rpx;"},[t("v-uni-view",{staticClass:"tag-header"},[t("v-uni-text",{staticClass:"tag-title"},[n._v("添加标签")]),t("v-uni-text",{staticClass:"tag-count"},[n._v(n._s(n.selectedTags.length)+"/5")]),t("v-uni-text",{staticClass:"tag-toggle",on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.toggleTagSelector.apply(void 0,arguments)}}},[n._v("收起")])],1),n.selectedTags.length>0?t("v-uni-view",{staticClass:"selected-tags"},n._l(n.selectedTags,(function(e,o){return t("v-uni-view",{key:o,staticClass:"selected-tag"},[t("v-uni-text",[n._v(n._s(e))]),t("v-uni-text",{staticClass:"remove-tag",attrs:{"data-tag":e},on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.removeTag.apply(void 0,arguments)}}},[n._v("×")])],1)})),1):n._e(),n.showTagSelector?t("v-uni-view",{staticClass:"tag-selector"},[t("v-uni-view",{staticClass:"category-selector"},[t("v-uni-scroll-view",{staticClass:"category-scroll",attrs:{"scroll-x":!0,"show-scrollbar":!1}},[t("v-uni-view",{staticClass:"category-list"},n._l(n.tagCategories,(function(e,o){return t("v-uni-view",{key:o,class:"category-item "+(n.currentCategoryIndex===o?"active":""),attrs:{"data-index":o},on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.switchCategory.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"category-icon"},[n._v(n._s(e.icon))]),t("v-uni-text",{staticClass:"category-name"},[n._v(n._s(e.name))])],1)})),1)],1)],1),t("v-uni-view",{staticClass:"current-category-tags"},n._l(n.tagCategories[n.currentCategoryIndex].tags,(function(e,o){return t("v-uni-view",{key:o,class:"preset-tag "+(n.selectedTags.includes(e)?"selected":""),attrs:{"data-tag":e},on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.selectTag.apply(void 0,arguments)}}},[n._v(n._s(e))])})),1),t("v-uni-view",{staticClass:"custom-tag-input"},[t("v-uni-input",{attrs:{placeholder:"输入自定义标签",value:n.customTag,maxlength:"10"},on:{input:function(e){arguments[0]=e=n.$handleEvent(e),n.onCustomTagInput.apply(void 0,arguments)},click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.noop.apply(void 0,arguments)}}}),t("v-uni-button",{attrs:{size:"mini"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.addCustomTag.apply(void 0,arguments)}}},[n._v("添加")])],1),n.showMatchedTags&&n.matchedTags.length>0?t("v-uni-view",{staticClass:"matched-tags"},[t("v-uni-view",{staticClass:"matched-tags-title"},[n._v("推荐标签：")]),t("v-uni-view",{staticClass:"matched-tags-list"},n._l(n.matchedTags,(function(e,o){return t("v-uni-view",{key:o,staticClass:"matched-tag",attrs:{"data-tag":e},on:{click:function(e){e.stopPropagation(),arguments[0]=e=n.$handleEvent(e),n.selectMatchedTag.apply(void 0,arguments)}}},[n._v(n._s(e))])})),1)],1):n._e()],1):n._e()],1):n._e()],1)},a=[]},"23cc":function(n,e,t){var o=t("c86c");e=o(!1),e.push([n.i,'\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* pages/add/add.wxss */uni-page-body[data-v-0ee17a84]{height:100vh;overflow:hidden /* 页面级别禁止滚动 */}.container[data-v-0ee17a84]{background:#fff;height:100vh; /* 改为固定高度，确保在iOS下正确计算 */display:flex;flex-direction:column;padding:%?100?% 0 0 0; /* 与preview页面保持一致的顶部边距 */padding-right:0; /* 移除右边距，让工具栏紧贴右边缘 */box-sizing:border-box; /* 确保padding计算在内 */overflow:hidden; /* 防止整个页面滚动 */position:relative /* 确保定位上下文 */}\n/* 图片预览区域 */.image-section[data-v-0ee17a84]{padding:%?30?%;background:#f8f9fa}.image-preview-scroll[data-v-0ee17a84]{width:100%;white-space:nowrap}.image-preview-container[data-v-0ee17a84]{display:flex;gap:%?20?%;padding:0 %?10?%}.image-preview-item[data-v-0ee17a84]{position:relative;width:%?200?%;height:%?200?%;border-radius:%?12?%;overflow:hidden;flex-shrink:0}.preview-image[data-v-0ee17a84]{width:100%;height:100%;border-radius:%?12?%}.image-remove-btn[data-v-0ee17a84]{position:absolute;top:%?-8?%;right:%?-8?%;width:%?40?%;height:%?40?%;background:#f44;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:%?24?%;font-weight:700;box-shadow:0 %?2?% %?8?% rgba(0,0,0,.2)}.add-image-btn[data-v-0ee17a84]{width:%?200?%;height:%?200?%;border:%?2?% dashed #ddd;border-radius:%?12?%;display:flex;align-items:center;justify-content:center;background:#fff;transition:all .3s ease;flex-shrink:0}.add-image-btn[data-v-0ee17a84]:active{background:#f5f5f5;border-color:#9ed7ee}.add-icon[data-v-0ee17a84]{font-size:%?60?%;color:#999}\n/* 内容输入区域 */.content-section[data-v-0ee17a84]{padding:%?30?%;padding-bottom:%?30?%;background:#fff;flex:1;display:flex;flex-direction:column;min-height:0;overflow:visible; /* 改为visible，允许浮动按钮显示 */position:relative}\n/* 主输入区域 - 响应式布局 */.main-input-area[data-v-0ee17a84]{flex:1;display:flex;position:relative;min-height:0;overflow:visible; /* 改为visible，允许浮动按钮显示 */padding:0 %?30?% 0 %?30?% /* 只保留左边距，右边距为0 */}.content-input-wrapper[data-v-0ee17a84]{position:relative;flex:1;display:flex;flex-direction:column;margin-right:%?70?%; /* 移除右边距 */min-height:0;overflow:hidden\n    /* 移除固定宽度，让输入框自适应 */}.content-textarea[data-v-0ee17a84]{flex:1;width:100%;height:100%;border:none;font-size:%?32?%; /* 对应16px */line-height:1.5; /* 对应19px行高 */padding:%?60?%; /* 对应30px内边距 */background:#e8e8e8;resize:none;overflow-y:auto;overflow-x:hidden;-webkit-appearance:none;appearance:none;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-user-select:text;user-select:text;-webkit-touch-callout:default;border-radius:%?20?%; /* 对应10px圆角 */outline:none;-webkit-overflow-scrolling:touch;position:relative;color:#989090; /* 使用CSS中定义的文字颜色 */font-family:Inter,-apple-system,BlinkMacSystemFont,sans-serif;font-weight:300;\n    /* 精确尺寸：314px宽，383px高 */min-height:%?766?%; /* 对应383px */max-height:%?766?%}\n/* 当高光模式启用时，隐藏textarea的文字内容 */.content-input-wrapper[data-highlight-mode="true"] .content-textarea[data-v-0ee17a84]{color:transparent}.char-count[data-v-0ee17a84]{position:absolute;bottom:%?10?%; /* 移到textarea外面，给文字留出空间 */right:%?110?%; /* leave space for side toolbar */font-size:%?24?%;color:#666;background:#fdfdfd;padding:%?8?% %?12?%;border-radius:%?6?%;box-shadow:none;pointer-events:none /* 防止遮挡textarea的点击 */}\n/* 模式选择器 */\n/* 模式选择器遮罩 */.mode-selector-mask[data-v-0ee17a84]{position:fixed;left:0;right:0;top:0;bottom:0;background:rgba(0,0,0,.35);z-index:130;display:flex;align-items:flex-end}.mode-selector[data-v-0ee17a84]{width:100%;background:#fff;border-top-left-radius:%?24?%;border-top-right-radius:%?24?%;padding:%?24?% %?28?% calc(%?24?% + env(safe-area-inset-bottom))}.mode-title[data-v-0ee17a84]{font-size:%?30?%;color:#333;text-align:center;margin-bottom:%?24?%;font-weight:500}.mode-list[data-v-0ee17a84]{display:flex;flex-direction:column;gap:0}.mode-option[data-v-0ee17a84]{display:flex;align-items:center;justify-content:space-between;padding:%?24?% 0;border-bottom:%?1?% solid #f0f0f0;transition:all .2s ease}.mode-option[data-v-0ee17a84]:last-child{border-bottom:none}.mode-option[data-v-0ee17a84]:active{background:#f8f9fa}.mode-text[data-v-0ee17a84]{font-size:%?28?%;color:#333;flex:1}.mode-check[data-v-0ee17a84]{color:#1c9bd6;font-size:%?28?%;font-weight:700}\n/* 标签选择区域样式 */.tag-section[data-v-0ee17a84]{position:fixed; /* 确保标签选择器是基于窗口定位的 */bottom:%?120?%; /* 初始位置在工具栏上方 */left:0;right:%?100?%; /* 为右侧工具栏预留空间 */background:#f8f9fa;border-radius:%?12?%;padding:%?20?%;z-index:90; /* z-index 比工具栏低，但比内容高 */transition:bottom .3s ease-out /* 为位置变化添加过渡 */}.tag-header[data-v-0ee17a84]{display:flex;justify-content:space-between;align-items:center;padding:%?10?% 0;border-bottom:1px solid #eee;margin-bottom:%?20?%}.tag-title[data-v-0ee17a84]{font-size:%?30?%;font-weight:700;color:#333}.tag-count[data-v-0ee17a84]{font-size:%?24?%;color:#999}.tag-toggle[data-v-0ee17a84]{font-size:%?26?%;color:#9ed7ee}.selected-tags[data-v-0ee17a84]{display:flex;flex-wrap:wrap;gap:%?10?%;margin-bottom:%?20?%}.selected-tag[data-v-0ee17a84]{display:flex;align-items:center;background:#9ed7ee;color:#fff;padding:%?8?% %?16?%;border-radius:%?20?%;font-size:%?24?%}.remove-tag[data-v-0ee17a84]{margin-left:%?8?%;font-size:%?20?%;font-weight:700;cursor:pointer}.tag-selector[data-v-0ee17a84]{-webkit-animation:slideDown-data-v-0ee17a84 .3s ease;animation:slideDown-data-v-0ee17a84 .3s ease}\n/* 分类选择器样式 */.category-selector[data-v-0ee17a84]{margin-bottom:%?20?%;border-bottom:1px solid #eee;padding-bottom:%?15?%}.category-scroll[data-v-0ee17a84]{width:100%;white-space:nowrap}.category-list[data-v-0ee17a84]{display:flex;gap:%?15?%;padding:0 %?10?%}.category-item[data-v-0ee17a84]{display:flex;flex-direction:column;align-items:center;padding:%?10?% %?15?%;border-radius:%?12?%;background:#f5f5f5;transition:all .3s ease;min-width:%?80?%;flex-shrink:0}.category-item.active[data-v-0ee17a84]{background:#9ed7ee;color:#fff}.category-icon[data-v-0ee17a84]{font-size:%?24?%;margin-bottom:%?5?%}.category-name[data-v-0ee17a84]{font-size:%?20?%;text-align:center;line-height:1.2}\n/* 当前分类标签样式 */.current-category-tags[data-v-0ee17a84]{display:flex;flex-wrap:wrap;gap:%?10?%;margin-bottom:%?20?%}.preset-tag[data-v-0ee17a84]{padding:%?8?% %?16?%;background:#fff;border:1px solid #ddd;border-radius:%?20?%;font-size:%?24?%;color:#666;transition:all .3s ease}.preset-tag.selected[data-v-0ee17a84]{background:#9ed7ee;color:#fff;border-color:#9ed7ee}.custom-tag-input[data-v-0ee17a84]{display:flex;align-items:center;gap:%?10?%}.custom-tag-input uni-input[data-v-0ee17a84]{flex:1;height:%?60?%;border:1px solid #ddd;border-radius:%?8?%;padding:0 %?15?%;font-size:%?26?%}.custom-tag-input uni-button[data-v-0ee17a84]{background:#9ed7ee;color:#fff;border:none;border-radius:%?8?%;padding:0 %?20?%;height:%?60?%;font-size:%?24?%}\n/* 匹配标签推荐样式 */.matched-tags[data-v-0ee17a84]{margin-top:%?15?%;padding:%?15?%;background:#f8f9fa;border-radius:%?8?%;border:1px solid #e9ecef}.matched-tags-title[data-v-0ee17a84]{font-size:%?24?%;color:#666;margin-bottom:%?10?%}.matched-tags-list[data-v-0ee17a84]{display:flex;flex-wrap:wrap;gap:%?8?%}.matched-tag[data-v-0ee17a84]{background:#e3f2fd;color:#1976d2;padding:%?6?% %?12?%;border-radius:%?12?%;font-size:%?22?%;border:1px solid #bbdefb;transition:all .2s ease}.matched-tag[data-v-0ee17a84]:active{background:#bbdefb;-webkit-transform:scale(.95);transform:scale(.95)}@-webkit-keyframes slideDown-data-v-0ee17a84{from{opacity:0;-webkit-transform:translateY(%?-10?%);transform:translateY(%?-10?%)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes slideDown-data-v-0ee17a84{from{opacity:0;-webkit-transform:translateY(%?-10?%);transform:translateY(%?-10?%)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}\n/* ====== 右侧工具栏样式 ====== */.side-toolbar[data-v-0ee17a84]{position:absolute;top:0;right:0;bottom:0;width:%?90?%; /* 调整工具栏宽度与按钮宽度一致 */display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:0; /* 移除间距，让图标紧密排列 */z-index:10;padding:%?20?% 0;background:transparent}.side-tool-btn[data-v-0ee17a84]{width:%?90?%; /* 调整按钮尺寸 */height:%?90?%;border:none; /* 移除边框 */background:transparent; /* 移除背景 */display:flex;align-items:center;justify-content:center;box-shadow:none; /* 移除阴影 */transition:all .2s ease;flex-shrink:0;margin-bottom:%?20?%; /* 调整间距 */margin-right:%?0?% /* 向右移动 */}.side-tool-btn[data-v-0ee17a84]:active{-webkit-transform:scale(.95);transform:scale(.95)}.side-tool-icon[data-v-0ee17a84]{width:%?75?%; /* 调整图标尺寸到75rpx */height:%?75?%;display:flex;align-items:center;justify-content:center;font-size:%?30?%;color:#333}\n/* 底部操作按钮区域 */.bottom-actions[data-v-0ee17a84]{display:flex;justify-content:space-between;align-items:center;padding:%?20?% %?30?%;background:#fff;border-top:%?1?% solid #f0f0f0;position:relative;z-index:5}\n/* 内联返回按钮 */.back-btn-inline[data-v-0ee17a84]{display:flex;align-items:center;gap:%?10?%;padding:%?15?% %?25?%;background:#f5f5f5;border:%?1?% solid #ddd;border-radius:%?25?%;font-size:%?28?%;color:#666;transition:all .2s ease}.back-btn-inline[data-v-0ee17a84]:active{background:#e8e8e8;-webkit-transform:scale(.98);transform:scale(.98)}.back-icon-inline[data-v-0ee17a84]{width:%?32?%;height:%?32?%}.back-text[data-v-0ee17a84]{font-size:%?28?%;color:#666}\n/* 内联发布按钮 */.publish-btn[data-v-0ee17a84]{display:flex;align-items:center;gap:%?10?%;padding:%?15?% %?30?%;background:#007aff;border:none;border-radius:%?25?%;font-size:%?28?%;color:#fff;transition:all .2s ease;min-width:%?120?%;justify-content:center}.publish-btn[data-v-0ee17a84]:disabled{background:#ccc;color:#999}.publish-btn[data-v-0ee17a84]:not(:disabled):active{background:#0056cc;-webkit-transform:scale(.98);transform:scale(.98)}.publish-icon[data-v-0ee17a84]{width:%?32?%;height:%?32?%}.publish-text[data-v-0ee17a84]{font-size:%?28?%;color:#fff;font-weight:500}\n/* 响应式设计 - 小屏幕适配 */@media screen and (max-width:%?750?%){.bottom-actions[data-v-0ee17a84]{padding:%?15?% %?20?%}.back-btn-inline[data-v-0ee17a84],\n    .publish-btn[data-v-0ee17a84]{padding:%?12?% %?20?%;font-size:%?26?%}.back-icon-inline[data-v-0ee17a84],\n    .publish-icon[data-v-0ee17a84]{width:%?28?%;height:%?28?%}}\n/* 让正文为右侧工具栏预留空间及计数避让 */.content-input-wrapper[data-v-0ee17a84]{padding-right:%?0?% /* 减少右边距，让输入框更宽 */}.char-count[data-v-0ee17a84]{right:%?130?% /* 调整字符计数位置 */}\n/* 颜色选择弹层 */.color-picker-mask[data-v-0ee17a84]{position:fixed;left:0;right:0;top:0;bottom:0;background:rgba(0,0,0,.35);z-index:130;display:flex;align-items:flex-end}.color-picker[data-v-0ee17a84]{width:100%;background:#fff;border-top-left-radius:%?24?%;border-top-right-radius:%?24?%;padding:%?24?% %?28?% calc(%?24?% + env(safe-area-inset-bottom));min-height:50vh; /* 最小高度设为半屏 */max-height:70vh; /* 限制最大高度为70%屏幕高度 */display:flex;flex-direction:column}.color-picker-title[data-v-0ee17a84]{font-size:%?32?%;font-weight:600;color:#333;flex:1;text-align:center}.color-picker-header[data-v-0ee17a84]{display:flex;align-items:center;justify-content:center;margin-bottom:%?24?%;position:relative}.color-picker-back-btn[data-v-0ee17a84]{position:absolute;top:0;right:0;width:%?80?%;height:%?80?%;display:flex;align-items:center;justify-content:center;background:transparent;border-radius:50%;z-index:10}.color-picker-back-icon[data-v-0ee17a84]{width:%?60?%;height:%?60?%}\n/* 色卡选择界面 */.color-palette-step[data-v-0ee17a84]{display:flex;flex-direction:column;height:100%}.color-palette-step .color-picker-title[data-v-0ee17a84]{margin-bottom:%?32?% /* 增加标题下方的间距 */}.palette-scroll[data-v-0ee17a84]{flex:1;min-height:%?800?%;max-height:%?1000?%}.palette-grid[data-v-0ee17a84]{display:grid;grid-template-columns:repeat(2,1fr);grid-gap:%?20?%;padding:0 %?10?%}.palette-card[data-v-0ee17a84]{height:%?120?%;border-radius:%?16?%;padding:%?16?%;position:relative;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.1);transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease}.palette-card[data-v-0ee17a84]:active{-webkit-transform:scale(.98);transform:scale(.98)}.palette-name[data-v-0ee17a84]{font-size:%?24?%;font-weight:600;margin-bottom:%?8?%;text-shadow:0 %?1?% %?2?% rgba(0,0,0,.3)}.palette-preview[data-v-0ee17a84]{display:flex;gap:%?8?%}.mini-color[data-v-0ee17a84]{width:%?20?%;height:%?20?%;border-radius:50%;border:%?2?% solid hsla(0,0%,100%,.5)}\n/* 具体颜色选择界面 */.colors-scroll[data-v-0ee17a84]{flex:1;min-height:%?800?%;max-height:%?1000?%}.colors-grid[data-v-0ee17a84]{display:grid;grid-template-columns:repeat(1,1fr);grid-gap:%?16?%;padding:0 %?10?%}.color-option[data-v-0ee17a84]{height:%?100?%;border-radius:%?16?%;padding:%?20?%;position:relative;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.1);transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease;display:flex;align-items:center;justify-content:space-between}.color-option[data-v-0ee17a84]:active{-webkit-transform:scale(.98);transform:scale(.98)}.color-text[data-v-0ee17a84]{font-size:%?28?%;font-weight:500}.color-check[data-v-0ee17a84]{position:absolute;right:%?20?%;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);font-size:%?32?%;font-weight:700;text-shadow:0 %?1?% %?2?% rgba(0,0,0,.3)}\n/* 高光选择 - 全屏覆盖样式 */.highlight-overlay[data-v-0ee17a84]{position:fixed;left:0;right:0;top:0;bottom:0;background:rgba(0,0,0,.6);z-index:1000;display:flex;align-items:stretch;justify-content:stretch}.hl-panel[data-v-0ee17a84]{background:#fff;width:100%;height:100%;display:flex;flex-direction:column}.hl-header[data-v-0ee17a84]{display:flex;align-items:center;justify-content:space-between;padding:%?20?% %?28?%;border-bottom:%?1?% solid #eee;position:-webkit-sticky;position:sticky;top:0;background:#fff;z-index:1}.hl-title[data-v-0ee17a84]{font-size:%?30?%;color:#333}.highlight-scroll[data-v-0ee17a84]{flex:1;padding:%?16?% %?24?% %?40?%}.hl-line[data-v-0ee17a84]{padding:%?14?% %?18?%;border-radius:%?10?%;margin:%?8?% 0;background:#f6f7f9}.hl-line.selected[data-v-0ee17a84]{font-weight:700;background:#e8f2ff}.hl-text[data-v-0ee17a84]{white-space:pre-wrap;word-break:break-word;font-size:%?30?%;color:#333}.hl-done[data-v-0ee17a84]{background:#1c9bd6;color:#fff;padding:0 %?20?%}.hl-clear[data-v-0ee17a84]{background:#eee;color:#333;padding:0 %?20?%}\n/* 高光选择覆盖层样式 */.highlight-overlay[data-v-0ee17a84]{border:none}.hl-done[data-v-0ee17a84]{background:#9ed7ee;color:#fff}.hl-clear[data-v-0ee17a84]{background:#666;color:#fff}\n/* 新的覆盖层样式 */.highlight-select-overlay[data-v-0ee17a84]{position:absolute;top:0;left:0;right:0;bottom:0;z-index:1;pointer-events:auto;overflow:hidden}.overlay-scroll[data-v-0ee17a84]{height:100%;width:100%;overflow-y:auto\n    /* 匹配textarea的滚动行为 */}.overlay-content[data-v-0ee17a84]{height:100%;width:100%;\n    /* 移除所有可能导致额外空间的样式 */font-size:0; /* 隐藏字体，不占用空间 */line-height:0;color:transparent;box-sizing:border-box;border-radius:%?20?%}.overlay-line[data-v-0ee17a84]{margin:0;position:absolute; /* 绝对定位，通过style属性设置top */left:0;right:0;height:%?48?%; /* 固定行高：32rpx字体 + 1.5行高 */transition:background-color .2s ease;padding:%?60?%;line-height:1.5;font-size:%?32?%; /* 与输入框保持相同的字体大小 */font-family:Inter,-apple-system,BlinkMacSystemFont,sans-serif;font-weight:300;box-sizing:border-box;pointer-events:none /* 防止干扰滚动 */}.overlay-line.highlighted[data-v-0ee17a84]{background-color:rgba(158,215,238,.2);border-radius:%?8?%}.overlay-line-content[data-v-0ee17a84]{color:#666; /* 半透明颜色，让用户能看到下面的文字 */white-space:pre-wrap;word-break:break-word;font-family:Inter,-apple-system,BlinkMacSystemFont,sans-serif;font-weight:300;font-size:%?32?%; /* 与输入框保持相同的字体大小 */line-height:1.5;margin:0;padding:0;display:block}\n/* 高光选择提示 */.highlight-hint[data-v-0ee17a84]{position:fixed;bottom:%?100?%;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);background:hsla(0,0%,50.2%,.6);color:#fff;padding:%?12?% %?24?%;border-radius:%?20?%;z-index:1000;text-align:center;white-space:nowrap}.hint-text[data-v-0ee17a84]{font-size:%?24?%;line-height:1.2}\n/* 调整textarea的z-index，确保在覆盖层下方 */.content-textarea[data-v-0ee17a84]{z-index:0}\n/* 当高光模式启用时，textarea的样式调整 */.content-input-wrapper[data-v-0ee17a84]{position:relative}\n/* 响应式设计 - 小屏幕适配 */@media screen and (max-width:%?750?%){.content-textarea[data-v-0ee17a84]{font-size:%?28?%;padding:%?20?%;min-height:%?180?%}.side-toolbar[data-v-0ee17a84]{width:%?70?%;gap:%?15?%}.side-tool-btn[data-v-0ee17a84]{width:%?50?%;height:%?50?%}.side-tool-icon[data-v-0ee17a84]{font-size:%?18?%}.floating-action-btn[data-v-0ee17a84]{width:%?70?%;height:%?70?%;bottom:%?20?%;right:%?20?%}.fab-icon[data-v-0ee17a84]{font-size:%?20?%}}\n/* 响应式设计 - 大屏幕适配 */@media screen and (min-width:%?1200?%){.content-textarea[data-v-0ee17a84]{font-size:%?32?%;padding:%?30?%;min-height:%?250?%}.side-toolbar[data-v-0ee17a84]{width:%?90?%;gap:%?25?%}.side-tool-btn[data-v-0ee17a84]{width:%?70?%;height:%?70?%}.side-tool-icon[data-v-0ee17a84]{font-size:%?22?%}.floating-action-btn[data-v-0ee17a84]{width:%?90?%;height:%?90?%}.fab-icon[data-v-0ee17a84]{font-size:%?26?%}}\n/* 响应式设计 - 超小屏幕适配 */@media screen and (max-width:%?600?%){.main-input-area[data-v-0ee17a84]{flex-direction:column}.side-toolbar[data-v-0ee17a84]{position:relative;width:100%;height:auto;flex-direction:row;justify-content:space-around;padding:%?20?% 0;gap:%?10?%}.content-input-wrapper[data-v-0ee17a84]{margin-right:0;margin-bottom:%?20?%}.floating-action-btn[data-v-0ee17a84]{position:fixed;bottom:%?20?%;right:%?20?%;width:%?60?%;height:%?60?%}}',""]),n.exports=e},"5d25":function(n,e,t){var o=t("23cc");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);var a=t("967d").default;a("4ff75d57",o,!0,{sourceMap:!1,shadowMode:!1})},"5f09":function(n,e,t){"use strict";var o=t("5d25"),a=t.n(o);a.a},"94ef":function(n,e,t){"use strict";t.r(e);var o=t("b1e6"),a=t.n(o);for(var i in o)["default"].indexOf(i)<0&&function(n){t.d(e,n,(function(){return o[n]}))}(i);e["default"]=a.a},b1e6:function(n,e,t){"use strict";t("6a54");var o=t("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,i=o(t("39d8")),s=o(t("fcf3"));t("5c47"),t("dfcf"),t("0c26"),t("bf0f"),t("7a76"),t("c9b5"),t("4626"),t("5ac7"),t("fd3c"),t("18f7"),t("de6c"),t("dc89"),t("2425"),t("c223"),t("dd2b"),t("8f71"),t("64aa"),t("f7a5"),t("5ef2"),t("aa9c"),t("4100");var l=t("38db"),r=l.cloudCall,c={data:function(){return{content:"",selectedBackgroundColor:"#a4c4bd",selectedTextColor:"#333333",selectedColorCombination:null,showColorPicker:!1,colorPickerStep:"palette",selectedPalette:null,poemLines:["红藕香残玉簟秋","轻解罗裳","独上兰舟","云中谁寄锦书来","雁字回时","月满西楼","花自飘零水自流","一种相思","两处闲愁","此情无计可消除","才下眉头","却上心头"],colorPalettes:[{name:"Darlington",colors:[{backgroundColor:"#ACCAB2",textColor:"#D44720"},{backgroundColor:"#E9A752",textColor:"#78614D"},{backgroundColor:"#D44720",textColor:"#F0E6D5"},{backgroundColor:"#78614D",textColor:"#E9A752"}]},{name:"True Navy",colors:[{backgroundColor:"#28374D",textColor:"#DDE6ED"},{backgroundColor:"#536D82",textColor:"#DDE6ED"},{backgroundColor:"#9DB2BF",textColor:"#28374D"},{backgroundColor:"#DDE6ED",textColor:"#28374D"}]},{name:"Inkwell",colors:[{backgroundColor:"#2C3639",textColor:"#DCD7C9"},{backgroundColor:"#3F4E4F",textColor:"#DCD7C9"},{backgroundColor:"#A27B5B",textColor:"#2C3639"},{backgroundColor:"#DCD7C9",textColor:"#2C3639"}]},{name:"Olive",colors:[{backgroundColor:"#706134",textColor:"#FAE7C9"},{backgroundColor:"#B0926A",textColor:"#706134"},{backgroundColor:"#E1C78F",textColor:"#706134"},{backgroundColor:"#FAE7C9",textColor:"#706134"}]},{name:"Red Chai",colors:[{backgroundColor:"#632626",textColor:"#DBCB96"},{backgroundColor:"#9D5353",textColor:"#DBCB96"},{backgroundColor:"#BF8B67",textColor:"#632626"},{backgroundColor:"#DBCB96",textColor:"#632626"}]},{name:"Cotton",colors:[{backgroundColor:"#EDEBBD",textColor:"#1B1717"},{backgroundColor:"#810100",textColor:"#EDEBBD"},{backgroundColor:"#630000",textColor:"#EDEBBD"},{backgroundColor:"#1B1717",textColor:"#EDEBBD"}]},{name:"宣纸白鸢尾蓝",colors:[{backgroundColor:"#F9F2E0",textColor:"#1660AB"},{backgroundColor:"#1660AB",textColor:"#F9F2E0"}]},{name:"Emerald Green",colors:[{backgroundColor:"#28413B",textColor:"#F8D794"},{backgroundColor:"#809076",textColor:"#111A1B"},{backgroundColor:"#F8D794",textColor:"#111A1B"},{backgroundColor:"#B8682C",textColor:"#111A1B"},{backgroundColor:"#111A1B",textColor:"#F8D794"}]},{name:"Space Cadet",colors:[{backgroundColor:"#25344F",textColor:"#D5B893"},{backgroundColor:"#617891",textColor:"#D5B893"},{backgroundColor:"#D5B893",textColor:"#25344F"},{backgroundColor:"#6F4D38",textColor:"#D5B893"},{backgroundColor:"#632024",textColor:"#D5B893"}]},{name:"Jasper Orange",colors:[{backgroundColor:"#E48F50",textColor:"#2D293B"},{backgroundColor:"#753130",textColor:"#729BAE"},{backgroundColor:"#2D293B",textColor:"#E48F50"},{backgroundColor:"#60859E",textColor:"#2D293B"},{backgroundColor:"#729BAE",textColor:"#2D293B"}]},{name:"Maastricht Blue",colors:[{backgroundColor:"#041A38",textColor:"#D8E7EE"},{backgroundColor:"#4A9ACB",textColor:"#041A38"},{backgroundColor:"#97D4F1",textColor:"#041A38"},{backgroundColor:"#394C5C",textColor:"#D8E7EE"},{backgroundColor:"#D8E7EE",textColor:"#041A38"}]},{name:"Dark Sienna",colors:[{backgroundColor:"#481718",textColor:"#93A292"},{backgroundColor:"#CA5655",textColor:"#F3EBE0"},{backgroundColor:"#93A292",textColor:"#481718"},{backgroundColor:"#39703D",textColor:"#F3EBE0"},{backgroundColor:"#75B974",textColor:"#481718"}]},{name:"Medium Carmine",colors:[{backgroundColor:"#AF3D41",textColor:"#EAC891"},{backgroundColor:"#70A3AC",textColor:"#131A1F"},{backgroundColor:"#5393A3",textColor:"#131A1F"},{backgroundColor:"#17566F",textColor:"#EAC891"},{backgroundColor:"#131A1F",textColor:"#AF3D41"}]},{name:"Hot Paprika",colors:[{backgroundColor:"#B53324",textColor:"#F5E2CE"},{backgroundColor:"#E5A657",textColor:"#B53324"},{backgroundColor:"#DFBC94",textColor:"#B53324"},{backgroundColor:"#F5E2CE",textColor:"#B53324"}]},{name:"Terracota",colors:[{backgroundColor:"#D08224",textColor:"#EAC891"},{backgroundColor:"#AE431E",textColor:"#EAC891"},{backgroundColor:"#8A8635",textColor:"#EAC891"},{backgroundColor:"#EAC891",textColor:"#AE431E"}]},{name:"Shell Beige",colors:[{backgroundColor:"#F4C9AC",textColor:"#756C4F"},{backgroundColor:"#EF9E70",textColor:"#756C4F"},{backgroundColor:"#AE6455",textColor:"#F4C9AC"},{backgroundColor:"#756C4F",textColor:"#F4C9AC"}]},{name:"Lady Diana",colors:[{backgroundColor:"#EAD7E4",textColor:"#818B70"},{backgroundColor:"#FCC5DB",textColor:"#818B70"},{backgroundColor:"#FF8486",textColor:"#FFFFFF"},{backgroundColor:"#818B70",textColor:"#EAD7E4"}]},{name:"Ocean Deep",colors:[{backgroundColor:"#4E635E",textColor:"#E2E0CB"},{backgroundColor:"#E2E0CB",textColor:"#4E635E"},{backgroundColor:"#A8B49E",textColor:"#4E635E"},{backgroundColor:"#818C78",textColor:"#E2E0CB"}]},{name:"Almond",colors:[{backgroundColor:"#D6BD98",textColor:"#1A3636"},{backgroundColor:"#677D6A",textColor:"#D6BD98"},{backgroundColor:"#40534C",textColor:"#D6BD98"},{backgroundColor:"#1A3636",textColor:"#D6BD98"}]}],highlightSelecting:!1,highlightSelectedLineIndices:[],highlightLines:[],highlightSentence:"",overlayScrollTop:0,textareaScrollTop:0,showHighlightHint:!1,highlightModeEnabled:!1,longPressTimer:null,touchStartLine:null,imageList:[],maxImageCount:9,publishMode:"normal",isOriginal:!1,showModeSelector:!1,isDiscussion:!1,parentPostId:"",parentPostInfo:null,canPublish:!1,selectedTags:[],customTag:"",showTagSelector:!1,currentCategoryIndex:0,allExistingTags:[],matchedTags:[],showMatchedTags:!1,isPublished:!1,isTemporaryHide:!1,isNavigating:!1,author:"",keyboardHeight:0,tagCategories:[{name:"内容主题",icon:"📝",tags:["爱情","亲情","友情","乡愁","思念","孤独","咏物","山水","田园","季节","春天","夏日","秋风","冬雪","人生","理想","哲理","时间","青春","成长","生死","怀古","咏史","边塞","战争","爱国","城市","乡村","生活","旅行","饮食","劳动"]},{name:"情感基调",icon:"💭",tags:["治愈","温暖","浪漫","唯美","悲伤","伤感","惆怅","寂寞","豪放","豁达","激昂","热血","婉约","细腻","清新","宁静","励志","鼓舞","坚定","充满希望","讽刺","批判","深沉","引人深思"]},{name:"形式体裁",icon:"📖",tags:["古体诗","近体诗","五言","七言","绝句","律诗","词","曲","乐府","骚体","现代诗","自由诗","散文诗","十四行诗","叙事诗","俳句","短歌","史诗","长诗","短诗","微型诗","三行诗"]},{name:"意象元素",icon:"🌙",tags:["月亮","星星","太阳","宇宙","银河","风","雨","雪","云","雾","河流","大海","山峰","森林","花","草","树","麦田","落叶","梅","兰","竹","菊","鸟","马","蝉","鱼","蝴蝶","酒","剑","琴","灯","船","镜子","红色","白色","蓝色","金色"]},{name:"风格流派",icon:"🎭",tags:["唐诗","宋词","元曲","先秦","两汉","魏晋","建安风骨","朦胧诗","新月派","浪漫主义","现实主义","象征主义","现代主义","意象派","垮掉的一代","中文诗","英文诗","日文诗","法文诗","翻译诗","中国","英国","美国","日本","俄罗斯"]},{name:"场景用途",icon:"🎯",tags:["晚安诗","早安问候","节日祝福","春节","中秋","情人节","毕业季","婚礼致辞","旅行途中","雨天读诗","写给孩子","致敬母亲","送给朋友","适合摘抄","可以用作签名"]}],tags:[]}},computed:{splitContentLines:function(){var n=this.content||"";return n.split(/\r?\n/)}},onLoad:function(n){this.setData({selectedBackgroundColor:this.selectedBackgroundColor||"#a4c4bd",selectedTextColor:this.selectedTextColor||"#333333",selectedColorCombination:this.selectedColorCombination||{backgroundColor:"#a4c4bd",textColor:"#333333"},showColorPicker:!1,colorPickerStep:"palette",selectedPalette:null,highlightSentence:this.highlightSentence||""}),this.loadAllExistingTags(),"edit"===n.mode?this.loadEditingDraft():this.loadDraft(),this.setDefaultPublishMode(),this.preventPageScroll()},onShow:function(){this.preventPageScroll()},onUnload:function(){if(!this.isPublished&&this.hasContent())try{this.clearDraft&&this.clearDraft()}catch(n){console.error("清除草稿失败:",n)}},onHide:function(){this.setData({isTemporaryHide:!1})},onBackPress:function(){return!this.isNavigating&&(!(this.isPublished||!this.hasContent())&&(this.exitWithOptionalSave(),!0))},methods:(a={onPageTap:function(){uni.hideKeyboard()},noop:function(){},hasContent:function(){var n=this.imageList&&this.imageList.length>0,e=this.content&&this.content.trim();return n||e},setDefaultPublishMode:function(){var n=getCurrentPages();if(n.length>1){var e=n[n.length-2],t=e.route;console.log("来源页面路由:",t),"pages/poem-square/poem-square"===t?(this.setData({publishMode:"poem",isOriginal:!0,maxImageCount:1,imageList:this.imageList.length>1?[this.imageList[0]]:this.imageList}),console.log("设置为原创诗歌模式")):"pages/mountain/mountain"===t&&(this.setData({publishMode:"poem",isOriginal:!1,maxImageCount:1,imageList:this.imageList.length>1?[this.imageList[0]]:this.imageList}),console.log("设置为非原创诗歌模式"))}},callCloudFunction:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(n,e,Object.assign({pageTag:"add",context:this,requireAuth:!0},t))},loadAllExistingTags:function(){var n=this;this.callCloudFunction("getAllTags").then((function(e){e.result&&e.result.success&&(n.allExistingTags=e.result.tags)})).catch((function(n){console.error("Failed to load all existing tags:",n)}))},exitWithOptionalSave:function(){var n=this;if(this.hasContent())uni.showModal({title:"保存草稿",content:"检测到你有未完成的内容，是否保存为草稿？",confirmText:"保存",cancelText:"不保存",success:function(e){if(n.setData({isNavigating:!0}),e.confirm)try{var t=n.saveDraft&&n.saveDraft();t&&"function"===typeof t.finally?t.finally((function(){try{uni.navigateBack()}catch(n){}})):setTimeout((function(){try{uni.navigateBack()}catch(n){}}),500)}catch(o){try{uni.navigateBack()}catch(a){}}else{try{n.clearDraft&&n.clearDraft()}catch(o){}try{uni.navigateBack()}catch(a){}}}});else{this.setData({isNavigating:!0});try{uni.navigateBack()}catch(e){}}},uploadFile:function(n,e){var o=this;return new Promise((function(a,i){var s=t("f3c3"),l=s.getCurrentPlatform,r=s.getCloudFunctionMethod,c=(l(),r());"tcb"===c?o.uploadFileViaCloudFunction(n,e).then(a).catch(i):"wx-cloud"===c?wx.cloud&&wx.cloud.uploadFile?wx.cloud.uploadFile({cloudPath:n,filePath:e,success:function(n){a(n)},fail:function(n){i(n)}}):i(new Error("微信云开发不可用")):i(new Error("不支持的云函数调用方式: ".concat(c)))}))},uploadFileViaCloudFunction:function(n,e){var t=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((function(a,i){if("undefined"!==typeof window&&"undefined"!==typeof FileReader)fetch(e).then((function(n){if(!n.ok)throw new Error("HTTP error! status: ".concat(n.status));return n.blob()})).then((function(s){var l=new FileReader;l.onload=function(){var s=l.result;if(!s||"string"!==typeof s)return console.error("❌ [Add页面] FileReader结果无效:",s),void i(new Error("文件读取失败"));var r=s.split(",")[1];console.log("🔍 [Add页面] 文件转换为base64完成，长度: ".concat(r.length)),r.length>6291456&&console.warn("⚠️ [Add页面] base64文件过大，尝试进一步压缩"),t.callCloudFunction("upload",{cloudPath:n,fileContent:r}).then((function(n){console.log("上传云函数返回结果:",n),n&&n.result&&n.result.success?a({fileID:n.result.fileID,cloudPath:n.result.cloudPath}):i(new Error("上传云函数返回格式错误"))})).catch((function(s){var l;o<2&&("request:fail"===s.errMsg||null!==(l=s.message)&&void 0!==l&&l.includes("fail"))?(console.log("🔄 [Add页面] 上传失败，准备重试 (".concat(o+1,"/2)")),setTimeout((function(){t.uploadFileViaCloudFunction(n,e,o+1).then(a).catch(i)}),1e3*(o+1))):i(s)}))},l.onerror=function(){console.error("❌ [Add页面] FileReader读取失败"),i(new Error("文件读取失败"))},l.readAsDataURL(s)})).catch((function(n){console.error("❌ [Add页面] 获取文件blob失败:",n),i(new Error("获取文件失败: "+n.message))}));else{console.log("🔍 [Add页面] App环境使用uni-app API读取文件");try{var s=uni.getFileSystemManager();s&&s.readFile?s.readFile({filePath:e,encoding:"base64",success:function(e){var o=e.data;console.log("🔍 [Add页面] 文件读取完成，base64长度: ".concat(o.length)),t.callCloudFunction("upload",{cloudPath:n,fileContent:o}).then((function(n){console.log("App环境上传云函数返回结果:",n),n&&n.result&&n.result.success?a({fileID:n.result.fileID,cloudPath:n.result.cloudPath}):i(new Error("上传云函数返回格式错误"))})).catch(i)},fail:function(n){console.error("❌ [Add页面] 文件读取失败：",n),i(new Error("文件读取失败: ".concat(n.errMsg||"未知错误")))}}):(console.error("❌ [Add页面] getFileSystemManager不可用"),i(new Error("文件系统API不可用")))}catch(l){console.error("❌ [Add页面] 文件系统API调用失败:",l),i(new Error("文件系统API不可用"))}}}))},preventPageScroll:function(){try{uni.pageScrollTo({scrollTop:0,duration:0})}catch(n){console.log("CatchClause",n),console.log("CatchClause",n),console.log("preventPageScroll error:",n)}},initH5ViewportHandler:function(){var n=this;if("undefined"!==typeof window){var e=window.innerHeight,t=!1,o=function(){var o=window.innerHeight,a=e-o;a>150&&!t?(t=!0,n.fixButtonPositions(!0)):a<=150&&t&&(t=!1,n.fixButtonPositions(!1))};window.addEventListener("resize",o),window.addEventListener("orientationchange",(function(){setTimeout((function(){e=window.innerHeight,o()}),100)})),this.cleanupViewportHandler=function(){window.removeEventListener("resize",o),window.removeEventListener("orientationchange",o)}}},fixButtonPositions:function(n){if("undefined"!==typeof document){var e=document.querySelector(".back-btn"),t=document.querySelector(".floating-action-btn");e&&(n?(e.style.position="fixed",e.style.bottom="120rpx",e.style.left="100rpx",e.style.transform="translateZ(0)"):(e.style.position="fixed",e.style.bottom="120rpx",e.style.left="100rpx")),t&&(n?(t.style.position="fixed",t.style.bottom="20px",t.style.right="20px",t.style.transform="translateZ(0)"):(t.style.position="fixed",t.style.bottom="20px",t.style.right="20px"))}},onContentInput:function(n){var e=n.detail,t=e.value;e.cursor;this.setData({content:t}),this.checkCanPublish()},onContainerTap:function(n){console.log("容器被点击，准备隐藏键盘"),setTimeout((function(){uni.hideKeyboard()}),100)},onTextareaTap:function(n){console.log("textarea被点击，应该获取焦点")},onTextareaFocus:function(n){console.log("textarea获得焦点，键盘高度:",n.detail.height);var e=n.detail.height;if(!e||0===e){var t=uni.getSystemInfoSync();console.log("系统信息:",t),e=Math.min(.4*t.windowHeight,300),console.log("使用默认键盘高度:",e)}this.setData({keyboardHeight:e})},onTextareaBlur:function(){console.log("textarea失去焦点"),this.setData({keyboardHeight:0})},checkCanPublish:function(){var n=this.imageList.length>0,e=this.content&&this.content.trim(),t=n||e;if("poem"===this.publishMode&&!this.isOriginal){var o=this.author&&this.author.trim();t=t&&o}this.setData({canPublish:t})},switchMode:function(){this.setData({showModeSelector:!this.showModeSelector,showTagSelector:!1})},selectPublishMode:function(n){var e=n.currentTarget.dataset.mode,t=n.currentTarget.dataset.original,o="discussion"===e;this.setData({publishMode:e,isOriginal:null!==t&&t,isDiscussion:o,showModeSelector:!1}),"poem"===e?this.setData({maxImageCount:1,imageList:this.imageList.length>1?[this.imageList[0]]:this.imageList}):this.setData({maxImageCount:9}),console.log("【Add】选择发布模式:",{mode:e,isOriginal:t,isDiscussion:o}),this.checkCanPublish()},handleChooseImage:function(){var n=this,e=this,t=this.maxImageCount-this.imageList.length;t<=0?uni.showToast({title:"最多只能上传9张图片",icon:"none"}):(this.setData({isTemporaryHide:!0}),uni.chooseImage({count:t,sizeType:["original"],sourceType:["album","camera"],success:function(n){uni.showLoading({title:"处理中..."}),console.log("wx.chooseImage 返回的详细文件信息:",n.tempFiles);var t=n.tempFiles.map((function(n){var t=n.path,o=n.size;if(console.log("获取到图片 ".concat(t," 的原始大小:"),(o/1024).toFixed(2),"KB"),o>5242880)throw new Error("图片文件过大 (".concat((o/1024/1024).toFixed(2),"MB)，请选择小于5MB的图片"));var a=o>2e5,i={originalPath:t,imageSize:o,needCompression:a,previewUrl:t,compressedPath:t,originalUrl:"",compressedUrl:""};return a?e.compressImage(i):Promise.resolve(i)}));Promise.all(t).then((function(n){uni.hideLoading(),e.updateImageList(n),e.checkCanPublish()})).catch((function(n){uni.hideLoading(),console.error("图片处理失败:",n);var e="图片处理失败";n.message&&n.message.includes("图片文件过大")?e=n.message:n.message&&(e="图片处理失败: ".concat(n.message)),uni.showModal({title:"错误",content:e,showCancel:!1,confirmText:"确定"})}))},fail:function(e){console.log("选择图片取消或失败:",e),n.setData({isTemporaryHide:!1})}}))},compressImage:function(n){var e=this;return new Promise((function(o){var a=t("f3c3"),i=a.getCurrentPlatform,s=i();"h5"===s?(console.log("🔍 [Add页面] H5环境使用Canvas压缩图片"),e.compressImageWithCanvas(n).then(o).catch((function(){console.log("Canvas压缩失败，使用原图"),n.compressedPath=n.originalPath,n.previewUrl=n.originalPath,o(n)}))):(console.log("🔍 [Add页面] 小程序/App环境使用uni.compressImage"),uni.compressImage({src:n.originalPath,quality:80,success:function(e){n.compressedPath=e.tempFilePath,n.previewUrl=e.tempFilePath,o(n)},fail:function(e){console.log("压缩失败，使用原图:",e),n.compressedPath=n.originalPath,n.previewUrl=n.originalPath,o(n)}}))}))},compressImageWithCanvas:function(n){return new Promise((function(e,t){var o=new Image;o.crossOrigin="anonymous",o.onload=function(){try{var a=document.createElement("canvas"),i=a.getContext("2d"),s=o.width,l=o.height;s>l?s>1200&&(l=1200*l/s,s=1200):l>1200&&(s=1200*s/l,l=1200),a.width=s,a.height=l,i.drawImage(o,0,0,s,l),a.toBlob((function(o){if(o){var a=URL.createObjectURL(o);n.compressedPath=a,n.previewUrl=a,console.log("✅ [Add页面] Canvas压缩成功，新尺寸:",s,"x",l),e(n)}else t(new Error("Canvas压缩失败"))}),"image/jpeg",.6)}catch(r){console.error("Canvas压缩过程出错:",r),t(r)}},o.onerror=function(){t(new Error("图片加载失败"))},o.src=n.originalPath}))},updateImageList:function(n){var e=this.imageList,t=e.concat(n);this.setData({imageList:t})},removeImage:function(n){var e=n.currentTarget.dataset.index,t=this.imageList;t.splice(e,1),this.setData({imageList:t}),this.checkCanPublish()},submitPost:function(){this.goToPreview()},checkDuplicatePoem:function(){var n=this;uni.showLoading({title:"检查中..."}),this.callCloudFunction("checkDuplicatePoem",{title:this.title.trim(),author:this.author.trim(),isOriginal:this.isOriginal}).then((function(e){uni.hideLoading(),console.log("重复检查结果:",e.result),e.result.success?e.result.isDuplicate?n.showDuplicateConfirmDialog(e.result.duplicateCount):n.proceedWithPublish():uni.showToast({title:"检查失败，请重试",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("检查重复失败:",n),uni.showToast({title:"网络错误，请重试",icon:"none"})}))},showDuplicateConfirmDialog:function(n){var e=this;uni.showModal({title:"发现重复诗歌",content:"已有 ".concat(n," 篇相同的诗歌发布，是否继续发布？"),confirmText:"继续发布",cancelText:"取消发布",success:function(n){n.confirm?e.proceedWithPublish():console.log("用户取消发布重复诗歌")}})},proceedWithPublish:function(){uni.showLoading({title:"发布中..."}),this.imageList.length>0?this.uploadImagesAndSubmit():this.submitTextOnly()},uploadImagesAndSubmit:function(){var n=this,e=(new Date).getTime(),t=this.imageList;console.log("开始上传图片:",t.length+"张");var o=t.map((function(t,o){return new Promise((function(a,i){var l=e+o,r="post_images/".concat(l,"_compressed.jpg");n.uploadFile(r,t.compressedPath).then((function(e){console.log("压缩图上传成功:",e),console.log("压缩图fileID:",e.fileID),console.log("压缩图fileID类型:",(0,s.default)(e.fileID));var o=e.fileID;if(t.needCompression){var i="post_images/".concat(l,"_original.jpg");return n.uploadFile(i,t.originalPath).then((function(n){console.log("原图上传成功:",n),console.log("原图fileID:",n.fileID),console.log("原图fileID类型:",(0,s.default)(n.fileID)),a({compressedUrl:o,originalUrl:n.fileID})}))}a({compressedUrl:o,originalUrl:o})})).catch(i)}))}));Promise.all(o).then((function(e){return console.log("所有图片上传完成:",e),n.submitWithContentCheck(e)})).catch((function(e){console.error("上传失败:",e),n.publishFail(e)}))},submitToDatabase:function(n){var e=this;console.log("提交到数据库:",{uploadResults:n,title:this.title,content:this.content,publishMode:this.publishMode,isOriginal:this.isOriginal}),console.log("uploadResults详细信息:",n),console.log("uploadResults长度:",n.length);var t=n.map((function(n){return n.compressedUrl})),o=n.map((function(n){return n.originalUrl}));console.log("处理后的图片URLs:",{imageUrls:t,originalImageUrls:o,imageUrlsType:t.map((function(n){return(0,s.default)(n)})),originalImageUrlsType:o.map((function(n){return(0,s.default)(n)})),imageUrlsValues:t.map((function(n){return n?n.substring(0,50)+"...":"null/undefined"}))});var a="";if("poem"===this.publishMode)if(this.isOriginal){var i=uni.getStorageSync("userInfo"),l=i?i.nickName:"匿名用户";a=this.author&&this.author.trim()?this.author.trim():l}else a=this.author&&this.author.trim()?this.author.trim():"";var r={title:this.title,content:this.content,createTime:new Date,votes:0,isPoem:"poem"===this.publishMode,isOriginal:this.isOriginal,author:a,tags:this.selectedTags||[],backgroundColor:this.selectedBackgroundColor||"",highlightSentence:this.highlightSentence||""};t.length>0&&(r.imageUrl=t[0],r.imageUrls=t,r.originalImageUrl=o[0],r.originalImageUrls=o,"poem"===this.publishMode&&t.length>0&&(r.poemBgImage=t[0]));var c=t.filter((function(n){return n})),d=o.filter((function(n){return n}));console.log("传递给云函数的参数:",{fileIDs:c,originalFileIDs:d,fileIDsLength:c.length,originalFileIDsLength:d.length});var u={title:this.title,content:this.content,fileIDs:c,originalFileIDs:d,publishMode:this.publishMode,isOriginal:this.isOriginal,author:this.author,tags:this.selectedTags||[],isDiscussion:this.isDiscussion||!1,parentPostId:this.parentPostId||"",backgroundColor:this.selectedBackgroundColor||"",textColor:this.selectedTextColor||"#000000"};return this.callCloudFunction("contentCheck",u).then((function(n){var t;(console.log("数据库提交成功:",n),n&&n.result&&0===n.result.code)?e.publishSuccess({_id:n.result.postId}):(console.error("云函数返回失败:",n),e.publishFail(new Error((null===(t=n.result)||void 0===t?void 0:t.msg)||"云函数返回失败")))})).catch((function(n){console.error("数据库提交失败:",n),e.publishFail(n)}))},submitTextOnly:function(){this.submitWithContentCheck([])},submitWithContentCheck:function(n){return console.log("开始内容审核和提交:",{uploadResults:n,title:this.title,content:this.content,publishMode:this.publishMode,isOriginal:this.isOriginal,author:this.author,tags:this.selectedTags}),console.log("⚠️ 内容审核已暂时关闭，直接发布内容"),this.submitToDatabase(n)},publishSuccess:function(n){uni.hideLoading(),uni.showToast({title:"发布成功！"});try{uni.setStorageSync("shouldRefreshIndex",!0),uni.setStorageSync("shouldRefreshProfile",!0),uni.setStorageSync("shouldRefreshPoem",!0),uni.setStorageSync("shouldRefreshMountain",!0);var e=getApp(),o=e&&e.globalData&&e.globalData.openid;try{var a=t("2729"),i=a.emitPostCreated;i(o)}catch(s){o&&uni.$emit&&uni.$emit("post-created",{userId:o})}}catch(s){console.log("CatchClause",s),console.log("CatchClause",s)}this.setData({isPublished:!0}),this.clearDraft(),uni.navigateBack({delta:1})},publishFail:function(n){uni.hideLoading(),console.error("[发布流程] 失败：",n);var e="发布失败";n&&n.message?e="发布失败: ".concat(n.message):n&&n.errMsg&&(e="发布失败: ".concat(n.errMsg)),uni.showModal({title:"发布失败",content:e,showCancel:!1,confirmText:"确定"})},onImageError:function(n){uni.showToast({title:"图片加载失败",icon:"none"}),console.error("图片加载失败",n)},toggleTagSelector:function(){this.setData({showTagSelector:!this.showTagSelector})},goBack:function(){this.setData({isNavigating:!0});var n=getCurrentPages();console.log("当前页面栈长度:",n.length),n.length>1?uni.navigateBack({delta:1,fail:function(){console.log("navigateBack失败，尝试switchTab"),uni.switchTab({url:"/pages/index/index"})}}):(console.log("没有上一页，跳转到首页"),uni.switchTab({url:"/pages/index/index"}))},goToPreview:function(){var n={_id:"preview-temp-id",content:this.content||"",title:"",textColor:this.selectedTextColor||"#000000",backgroundColor:this.selectedBackgroundColor||"#ffffff",isExpanded:!0,likeIcon:"/static/images/seed.png",imageUrls:(this.imageList||[]).map((function(n){return n.previewUrl})),highlightLines:this.highlightLines||[],editData:{selectedBackgroundColor:this.selectedBackgroundColor,selectedTextColor:this.selectedTextColor,selectedColorCombination:this.selectedColorCombination,imageList:this.imageList,publishMode:this.publishMode,isOriginal:this.isOriginal,selectedTags:this.selectedTags,author:this.author,highlightLines:this.highlightLines,highlightSelectedLineIndices:this.highlightSelectedLineIndices}};console.log("【Add】准备跳转到预览，数据:",n),console.log("【Add】publishMode:",this.publishMode),console.log("【Add】editData.publishMode:",n.editData.publishMode);try{uni.setStorageSync("preview_post",n)}catch(e){}uni.navigateTo({url:"/pages/preview/preview",success:function(t){try{t.eventChannel.emit("preview-data",{post:n})}catch(e){}}})},onSelectColor:function(){this.setData({showColorPicker:!this.showColorPicker,colorPickerStep:"palette"})},selectPalette:function(n){var e=n.currentTarget.dataset.index,t=this.colorPalettes[e];this.setData({selectedPalette:t,colorPickerStep:"colors"})},goBackToPalette:function(){this.setData({colorPickerStep:"palette",selectedPalette:null})},getPoemLine:function(n){return this.poemLines[n]||"示例文字"},isColorSelected:function(n){return this.selectedColorCombination&&this.selectedColorCombination.backgroundColor===n.backgroundColor&&this.selectedColorCombination.textColor===n.textColor},onToggleHighlight:function(){this.setData({highlightSelecting:!this.highlightSelecting}),this.highlightSelecting&&uni.showToast({title:"点击要高亮的行",icon:"none"})},toggleHighlightMode:function(){var n=this;this.setData({highlightModeEnabled:!this.highlightModeEnabled,showHighlightHint:!this.highlightModeEnabled}),this.highlightModeEnabled&&setTimeout((function(){n.setData({showHighlightHint:!1})}),3e3)},hideHighlightHint:function(){this.setData({showHighlightHint:!1})},onTextareaScroll:function(n){this.setData({textareaScrollTop:n.detail.scrollTop,overlayScrollTop:n.detail.scrollTop})},onOverlayTouchStart:function(n){n.preventDefault()},onOverlayTouchEnd:function(n){n.preventDefault()},onOverlayTouchMove:function(n){n.preventDefault()},onLineTouchStart:function(n){n.preventDefault(),n.stopPropagation();var e=Number(n.currentTarget.dataset.index);this.touchStartLine=e},onLineTouchEnd:function(n){n.preventDefault(),n.stopPropagation();var e=Number(n.currentTarget.dataset.index);if(this.touchStartLine===e){this.toggleLineHighlight(e);try{uni.vibrateShort()}catch(n){}}this.touchStartLine=null},toggleLineHighlight:function(n){var e=this.highlightSelectedLineIndices.slice(),t=e.indexOf(n);if(t>=0)e.splice(t,1);else{if(e.length>=3)return void uni.showToast({title:"最多只能选择三行高光",icon:"none"});e.push(n)}e.sort((function(n,e){return n-e})),this.setData({highlightSelectedLineIndices:e}),this.updateHighlightLines()},updateHighlightLines:function(){var n=(this.content||"").split(/\r?\n/),e=this.highlightSelectedLineIndices.map((function(e){return n[e]||""})).filter(Boolean);this.setData({highlightLines:e,highlightSentence:e[0]||""})},toggleHighlightLine:function(n){var e=Number(n.currentTarget.dataset.index),t=this.highlightSelectedLineIndices.slice(),o=t.indexOf(e);if(o>=0)t.splice(o,1);else{if(t.length>=3)return void uni.showToast({title:"最多只能选择三行高光",icon:"none"});t.push(e)}t.sort((function(n,e){return n-e})),this.setData({highlightSelectedLineIndices:t})},finishHighlight:function(){var n=(this.content||"").split(/\r?\n/),e=this.highlightSelectedLineIndices.map((function(e){return n[e]||""})).filter(Boolean);this.setData({highlightLines:e,highlightSentence:e[0]||"",highlightSelecting:!1}),uni.showToast({title:"已设置高光",icon:"success"})},clearHighlight:function(){this.setData({highlightSelectedLineIndices:[],highlightLines:[],highlightSentence:""})},chooseColor:function(n){var e=n.currentTarget.dataset.color;this.setData({selectedBackgroundColor:e.backgroundColor,selectedTextColor:e.textColor,selectedColorCombination:e,showColorPicker:!1,colorPickerStep:"palette"}),uni.showToast({title:"已设置颜色搭配",icon:"success"})}},(0,i.default)(a,"noop",(function(){})),(0,i.default)(a,"selectTag",(function(n){var e=n.currentTarget.dataset.tag,t=this.selectedTags;if(t.includes(e)){var o=t.indexOf(e);t.splice(o,1)}else{if(!(t.length<5))return void uni.showToast({title:"最多选择5个标签",icon:"none"});t.push(e)}this.setData({selectedTags:t})})),(0,i.default)(a,"onCustomTagInput",(function(n){var e=n.detail.value;console.log("【标签输入】用户输入:",e),this.setData({customTag:e}),this.searchMatchingTags(e)})),(0,i.default)(a,"addCustomTag",(function(){var n=this.customTag&&this.customTag.trim();n?this.selectedTags.includes(n)?uni.showToast({title:"标签已存在",icon:"none"}):this.selectedTags.length>=5?uni.showToast({title:"最多选择5个标签",icon:"none"}):(this.selectedTags.push(n),this.setData({selectedTags:this.selectedTags,customTag:"",showMatchedTags:!1,matchedTags:[]})):uni.showToast({title:"请输入标签内容",icon:"none"})})),(0,i.default)(a,"saveDraft",(function(){var n=this;return new Promise((function(e){var t={title:n.title,content:n.content,imageList:n.imageList,publishMode:n.publishMode,isOriginal:n.isOriginal,selectedTags:n.selectedTags,customTag:n.customTag,author:n.author,selectedBackgroundColor:n.selectedBackgroundColor,selectedTextColor:n.selectedTextColor,selectedColorCombination:n.selectedColorCombination,saveTime:new Date};uni.showLoading({title:"保存中..."}),n.callCloudFunction("getMyProfileData",{action:"saveDraft",draftData:t}).then((function(t){uni.hideLoading(),t.result&&t.result.success?(uni.showToast({title:"草稿已保存",icon:"success"}),n.clearDraft(),e(!0)):(console.error("保存草稿失败:",t.result),uni.showToast({title:t.result&&t.result.message?t.result.message:"保存草稿失败",icon:"none"}),e(!1))})).catch((function(n){uni.hideLoading(),console.error("保存草稿失败:",n),uni.showToast({title:"网络错误，保存失败",icon:"none"}),e(!1)}))}))})),(0,i.default)(a,"removeTag",(function(n){var e=n.currentTarget.dataset.tag,t=this.selectedTags.filter((function(n){return n!==e}));this.setData({selectedTags:t})})),(0,i.default)(a,"loadDraft",(function(){var n=this;try{var e=uni.getStorageSync("publish_draft");if(e&&e.saveTime){var t=(new Date).getTime(),o=t-e.saveTime;o<6048e5?uni.showModal({title:"恢复草稿",content:"检测到您有未完成的草稿，是否恢复？",confirmText:"恢复",cancelText:"重新开始",success:function(t){t.confirm?(n.setData({title:e.title||"",content:e.content||"",imageList:e.imageList||[],publishMode:e.publishMode||"normal",isOriginal:e.isOriginal||!1,selectedTags:e.selectedTags||[],customTag:e.customTag||"",author:e.author||"",selectedBackgroundColor:e.selectedBackgroundColor||"#a4c4bd",selectedTextColor:e.selectedTextColor||"#333333",selectedColorCombination:e.selectedColorCombination||{backgroundColor:"#a4c4bd",textColor:"#333333"},maxImageCount:"poem"===e.publishMode?1:9}),n.checkCanPublish(),uni.showToast({title:"草稿已恢复",icon:"success"})):n.clearDraft()}}):this.clearDraft()}}catch(a){console.log("CatchClause",a),console.log("CatchClause",a),console.error("加载草稿失败:",a)}})),(0,i.default)(a,"loadEditingDraft",(function(){try{var n=uni.getStorageSync("editing_draft");n&&(this.setData({title:n.title||"",content:n.content||"",imageList:n.imageList||[],publishMode:n.publishMode||"normal",isOriginal:n.isOriginal||!1,selectedTags:n.selectedTags||[],customTag:n.customTag||"",author:n.author||"",selectedBackgroundColor:n.selectedBackgroundColor||"#a4c4bd",selectedTextColor:n.selectedTextColor||"#333333",selectedColorCombination:n.selectedColorCombination||{backgroundColor:"#a4c4bd",textColor:"#333333"},maxImageCount:"poem"===n.publishMode?1:9}),this.checkCanPublish(),uni.showToast({title:"草稿已加载",icon:"success"}),uni.removeStorageSync("editing_draft"))}catch(e){console.log("CatchClause",e),console.log("CatchClause",e),console.error("加载编辑草稿失败:",e),uni.showToast({title:"加载草稿失败",icon:"none"})}})),(0,i.default)(a,"clearDraft",(function(){try{uni.removeStorageSync("publish_draft")}catch(n){console.log("CatchClause",n),console.log("CatchClause",n),console.error("清除草稿失败:",n)}})),a)};e.default=c},c85f:function(n,e,t){"use strict";t.r(e);var o=t("1762"),a=t("94ef");for(var i in a)["default"].indexOf(i)<0&&function(n){t.d(e,n,(function(){return a[n]}))}(i);t("5f09");var s=t("828b"),l=Object(s["a"])(a["default"],o["b"],o["c"],!1,null,"0ee17a84",null,!1,o["a"],void 0);e["default"]=l.exports}}]);