(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-feedback-feedback"],{"05ff":function(n,r,t){"use strict";t.d(r,"b",(function(){return e})),t.d(r,"c",(function(){return a})),t.d(r,"a",(function(){}));var e=function(){var n=this,r=n.$createElement,t=n._self._c||r;return t("v-uni-view",{staticClass:"container",style:"padding-top: "+n.statusBarHeight+"px;"},[t("v-uni-view",{staticClass:"header",style:"top: "+n.statusBarHeight+"px;"},[t("v-uni-view",{staticClass:"header-left",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.goBack.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"back-icon"},[n._v("←")])],1),t("v-uni-text",{staticClass:"header-title"},[n._v("意见反馈")]),t("v-uni-view",{staticClass:"header-right"})],1),t("v-uni-view",{staticClass:"content-section"},[t("v-uni-view",{staticClass:"section-title"},[n._v("反馈内容")]),t("v-uni-textarea",{staticClass:"content-input",attrs:{placeholder:"请详细描述您遇到的问题或建议...",value:n.content,maxlength:"500","show-confirm-bar":!1},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onContentInput.apply(void 0,arguments)}}}),t("v-uni-view",{staticClass:"char-count"},[n._v(n._s(n.content.length)+"/500")])],1),t("v-uni-view",{staticClass:"image-section"},[t("v-uni-view",{staticClass:"section-title"},[n._v("相关图片（可选）")]),t("v-uni-view",{staticClass:"image-upload-area"},[t("v-uni-view",{staticClass:"image-list"},[n._l(n.images,(function(r,e){return t("v-uni-view",{key:e,staticClass:"image-item"},[t("v-uni-image",{staticClass:"preview-image",attrs:{src:r.path,mode:"aspectFill","data-index":e},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.previewImage.apply(void 0,arguments)}}}),t("v-uni-view",{staticClass:"delete-btn",attrs:{"data-index":e},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.removeImage.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"delete-icon"},[n._v("×")])],1)],1)})),n.images.length<n.maxImages?t("v-uni-view",{staticClass:"add-image-btn",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.chooseImages.apply(void 0,arguments)}}},[t("v-uni-text",{staticClass:"add-icon"},[n._v("+")]),t("v-uni-text",{staticClass:"add-text"},[n._v("添加图片")])],1):n._e()],2)],1),t("v-uni-view",{staticClass:"image-tip"},[n._v("最多可上传"+n._s(n.maxImages)+"张图片")])],1),t("v-uni-view",{staticClass:"submit-section"},[t("v-uni-button",{class:"submit-btn "+(n.submitting?"submitting":""),attrs:{disabled:n.submitting},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.submitFeedback.apply(void 0,arguments)}}},[n._v(n._s(n.submitting?"提交中...":"提交反馈"))])],1),t("v-uni-view",{staticClass:"footer-tip"},[t("v-uni-text",{staticClass:"tip-text"},[n._v("我们会认真对待每一条反馈，感谢您的支持！")])],1)],1)},a=[]},"1f2c":function(n,r,t){var e=t("3c54");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=t("967d").default;a("488abcf2",e,!0,{sourceMap:!1,shadowMode:!1})},3744:function(n,r,t){"use strict";var e=t("1f2c"),a=t.n(e);a.a},"3c54":function(n,r,t){var e=t("c86c");r=e(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* 用户反馈页面样式 */.container[data-v-9afdf50a]{min-height:100vh;background-color:#f5f5f5;padding-bottom:%?40?%}\r\n/* 头部 */.header[data-v-9afdf50a]{display:flex;align-items:center;justify-content:space-between;padding:%?20?% %?30?%;background-color:#fff;border-bottom:%?1?% solid #eee;position:-webkit-sticky;position:sticky;z-index:100}.header-left[data-v-9afdf50a]{width:%?60?%;height:%?60?%;display:flex;align-items:center;justify-content:center}.back-icon[data-v-9afdf50a]{font-size:%?36?%;color:#333;font-weight:700}.header-title[data-v-9afdf50a]{font-size:%?32?%;font-weight:600;color:#333}.header-right[data-v-9afdf50a]{width:%?60?%}\r\n/* 内容区域 */.content-section[data-v-9afdf50a]{background-color:#fff;margin:%?20?% %?30?%;border-radius:%?16?%;padding:%?30?%}.section-title[data-v-9afdf50a]{font-size:%?28?%;font-weight:600;color:#333;margin-bottom:%?20?%}.content-input[data-v-9afdf50a]{width:100%;min-height:%?200?%;font-size:%?28?%;color:#333;line-height:1.6;background-color:#f8f8f8;border-radius:%?12?%;padding:%?20?%;box-sizing:border-box}.char-count[data-v-9afdf50a]{text-align:right;font-size:%?24?%;color:#999;margin-top:%?10?%}\r\n/* 图片上传区域 */.image-section[data-v-9afdf50a]{background-color:#fff;margin:%?20?% %?30?%;border-radius:%?16?%;padding:%?30?%}.image-upload-area[data-v-9afdf50a]{margin-bottom:%?10?%}.image-list[data-v-9afdf50a]{display:flex;flex-wrap:wrap;gap:%?20?%}.image-item[data-v-9afdf50a]{position:relative;width:%?160?%;height:%?160?%;border-radius:%?12?%;overflow:hidden}.preview-image[data-v-9afdf50a]{width:100%;height:100%}.delete-btn[data-v-9afdf50a]{position:absolute;top:%?-10?%;right:%?-10?%;width:%?40?%;height:%?40?%;background-color:#ff4d4f;border-radius:50%;display:flex;align-items:center;justify-content:center}.delete-icon[data-v-9afdf50a]{color:#fff;font-size:%?24?%;font-weight:700}.add-image-btn[data-v-9afdf50a]{width:%?160?%;height:%?160?%;border:%?2?% dashed #ddd;border-radius:%?12?%;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#fafafa}.add-icon[data-v-9afdf50a]{font-size:%?48?%;color:#999;margin-bottom:%?10?%}.add-text[data-v-9afdf50a]{font-size:%?24?%;color:#999}.image-tip[data-v-9afdf50a]{font-size:%?24?%;color:#999;text-align:center}\r\n/* 提交按钮 */.submit-section[data-v-9afdf50a]{margin:%?40?% %?30?%}.submit-btn[data-v-9afdf50a]{width:100%;height:%?88?%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:%?32?%;font-weight:600;border-radius:%?44?%;border:none;display:flex;align-items:center;justify-content:center}.submit-btn.submitting[data-v-9afdf50a]{background:#ccc}.submit-btn[data-v-9afdf50a]::after{border:none}\r\n/* 底部提示 */.footer-tip[data-v-9afdf50a]{text-align:center;padding:0 %?30?%}.tip-text[data-v-9afdf50a]{font-size:%?24?%;color:#999;line-height:1.5}",""]),n.exports=r},"3dbf":function(n,r,t){"use strict";t.r(r);var e=t("05ff"),a=t("a354");for(var i in a)["default"].indexOf(i)<0&&function(n){t.d(r,n,(function(){return a[n]}))}(i);t("3744");var o=t("828b"),s=Object(o["a"])(a["default"],e["b"],e["c"],!1,null,"9afdf50a",null,!1,e["a"],void 0);r["default"]=s.exports},5736:function(n,r,t){"use strict";t("6a54");var e=t("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=e(t("b7c7"));t("fd3c"),t("c223"),t("dd2b"),t("8f71"),t("bf0f"),t("0c26"),t("18f7"),t("de6c"),t("7a76"),t("c9b5");var i=t("8e86"),o=i.previewImage,s=t("11ca"),c=s.cloudCall,u={data:function(){return{content:"",images:[],submitting:!1,maxImages:3,statusBarHeight:0}},onLoad:function(){var n=uni.getSystemInfoSync();this.setData({statusBarHeight:n.statusBarHeight})},methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(n,r,Object.assign({pageTag:"feedback",context:this},t))},onContentInput:function(n){this.setData({content:n.detail.value})},chooseImages:function(){var n=this,r=this.images,t=this.maxImages,e=t-r.length;e<=0?uni.showToast({title:"最多只能上传".concat(t,"张图片"),icon:"none"}):uni.chooseMedia({count:e,mediaType:["image"],sourceType:["album","camera"],success:function(t){var e=t.tempFiles.map((function(n){return{path:n.tempFilePath,size:n.size}}));n.setData({images:[].concat((0,a.default)(r),(0,a.default)(e))})},fail:function(n){console.error("选择图片失败:",n),uni.showToast({title:"选择图片失败",icon:"none"})}})},removeImage:function(n){var r=n.currentTarget.dataset.index,t=this.images;t.splice(r,1),this.setData({images:t})},previewImage:function(n){var r=n.currentTarget.dataset.index,t=Array.isArray(this.images)?this.images:[];if(t.length){var e=t.map((function(n){return n.path})).filter(Boolean);if(e.length){var a=e[r]||e[0];return o({current:a,urls:e},{fallbackToast:!1})}}},submitFeedback:function(){var n=this,r=this.content,t=this.images,e=this.submitting;if(!e)if(r.trim()){this.setData({submitting:!0});var a=this.$requireOpenid&&this.$requireOpenid();a?this.uploadImages(t).then((function(t){return n.submitFeedbackData(r,t,a)})).then((function(){uni.showToast({title:"反馈提交成功",icon:"success"}),n.setData({content:"",images:[]}),setTimeout((function(){uni.navigateBack()}),1500)})).catch((function(n){console.error("提交反馈失败:",n),uni.showToast({title:"提交失败，请重试",icon:"none"})})).finally((function(){n.setData({submitting:!1})})):this.setData({submitting:!1})}else uni.showToast({title:"请输入反馈内容",icon:"none"})},uploadImages:function(n){var r=this;if(0===n.length)return Promise.resolve([]);var t=n.map((function(n,t){var e="feedback/".concat(Date.now(),"_").concat(t,".jpg");return r.uploadFile(e,n.path).then((function(n){return n.fileID})).catch((function(n){throw console.error("图片上传失败:",n),n}))}));return Promise.all(t)},submitFeedbackData:function(n,r,t){var e=this;return new Promise((function(a,i){var o=t||e.$requireOpenid&&e.$requireOpenid();if(!o)return i(new Error("用户未登录"));e.callCloudFunction("feedbackManager",{action:"submitFeedback",content:n,imageUrls:r,openid:o}).then((function(n){var r;n.result&&n.result.success?a(n.result):i(new Error((null===(r=n.result)||void 0===r?void 0:r.message)||"提交失败"))})).catch((function(n){console.error("调用云函数失败:",n),i(n)}))}))},goBack:function(){uni.navigateBack()},uploadFile:function(n,r){var e=this;return console.log("🔍 [反馈页] 上传文件: ".concat(n),r),new Promise((function(a,i){var o=t("fd09"),s=o.getCurrentPlatform,c=o.getCloudFunctionMethod,u=s(),l=c();console.log("🔍 [反馈页] 运行环境检测 - 平台: ".concat(u,", 方法: ").concat(l)),"tcb"===l?e.$tcb&&e.$tcb.uploadFile?(console.log("🔍 [反馈页] TCB环境上传文件: ".concat(n)),e.$tcb.uploadFile({cloudPath:n,filePath:r}).then(a).catch(i)):(console.error("❌ [反馈页] TCB实例不可用"),i(new Error("TCB实例不可用"))):"wx-cloud"===l?wx.cloud&&wx.cloud.uploadFile?(console.log("🔍 [反馈页] 小程序环境上传文件: ".concat(n)),wx.cloud.uploadFile({cloudPath:n,filePath:r,success:function(r){console.log("✅ [反馈页] 文件上传成功: ".concat(n),r),a(r)},fail:function(r){console.error("❌ [反馈页] 文件上传失败: ".concat(n),r),i(r)}})):(console.error("❌ [反馈页] 微信云开发不可用"),i(new Error("微信云开发不可用"))):(console.error("❌ [反馈页] 不支持的文件上传方式: ".concat(l)),i(new Error("不支持的文件上传方式: ".concat(l))))}))}}};r.default=u},"8e86":function(n,r,t){function e(n){if(!n)return{current:"",urls:[]};if(n.currentTarget&&n.currentTarget.dataset){var r=n.currentTarget.dataset,t=r.src||r.current||r.url||Array.isArray(r.urls)&&r.urls[0]||"",e=r.originalImageUrls||r.urls||r.urlList,a=Array.isArray(e)?e.filter(Boolean):"string"===typeof e&&e?[e]:[];return{current:t,urls:a}}var i=n.current||n.src||Array.isArray(n.urls)&&n.urls[0]||Array.isArray(n.list)&&n.list[0]||"",o=Array.isArray(n.urls)?n.urls.filter(Boolean):Array.isArray(n.list)?n.list.filter(Boolean):[];return{current:i,urls:o}}function a(n){"undefined"!==typeof uni&&uni.showToast&&uni.showToast({title:n,icon:"none"})}t("8f71"),t("bf0f"),n.exports={previewImage:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.fallbackToast,i=void 0===t||t,o=e(n);if(!o.current&&0===o.urls.length)return i&&a("图片数据缺失"),!1;var s=o.urls.length?o.urls:[o.current],c=o.current||s[0];return c&&0!==s.length?uni.previewImage({current:c,urls:s}):(i&&a("图片不可预览"),!1)}}},a354:function(n,r,t){"use strict";t.r(r);var e=t("5736"),a=t.n(e);for(var i in e)["default"].indexOf(i)<0&&function(n){t.d(r,n,(function(){return e[n]}))}(i);r["default"]=a.a}}]);