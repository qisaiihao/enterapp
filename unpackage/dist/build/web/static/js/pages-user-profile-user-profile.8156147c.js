(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-profile-user-profile"],{1203:function(n,t,e){"use strict";e.r(t);var i=e("5102"),o=e.n(i);for(var a in i)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return i[n]}))}(a);t["default"]=o.a},"1a1e":function(n,t,e){var i=e("c86c");t=i(!1),t.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* pages/user-profile/user-profile.wxss */.container[data-v-09d2080e]{min-height:100vh;background-color:#f7f8fa;padding-bottom:%?100?%}\n/* 加载状态 */.loading-container[data-v-09d2080e]{display:flex;justify-content:center;align-items:center;height:%?400?%;background-color:#fff;border-radius:%?16?%;margin:%?30?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.loading-text[data-v-09d2080e]{font-size:%?28?%;color:#999}\n/* 用户信息卡片 */.profile-card[data-v-09d2080e]{margin:%?30?%;padding:%?40?%;background-color:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);display:flex;flex-direction:column;align-items:center;text-align:center}.profile-avatar[data-v-09d2080e]{margin-bottom:%?20?%}.profile-avatar uni-image[data-v-09d2080e]{width:%?150?%;height:%?150?%;border-radius:50%}.profile-info[data-v-09d2080e]{display:flex;flex-direction:column;align-items:center}.profile-name[data-v-09d2080e]{font-size:%?36?%;font-weight:700;color:#333;margin-bottom:%?10?%}.profile-bio[data-v-09d2080e]{font-size:%?28?%;color:#999;line-height:1.4;text-align:center}\n/* 帖子部分 */.posts-section[data-v-09d2080e]{margin:0 %?30?% %?30?% %?30?%}.section-title[data-v-09d2080e]{font-size:%?32?%;font-weight:700;color:#333;margin-bottom:%?20?%;padding:0 %?10?%}.post-card[data-v-09d2080e]{background:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05);margin-bottom:%?20?%;box-sizing:border-box;padding:%?30?%;transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease}.post-card[data-v-09d2080e]:active{-webkit-transform:translateY(%?2?%);transform:translateY(%?2?%);box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1)}.post-header[data-v-09d2080e]{margin-bottom:%?15?%}.post-title[data-v-09d2080e]{font-size:%?32?%;font-weight:700;color:#333;line-height:1.4;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}\n/* 图片容器 */.image-container[data-v-09d2080e]{width:100%;margin:%?15?% 0}.image-swiper[data-v-09d2080e]{width:100%;background-color:#fff;border-radius:%?12?%;overflow:hidden}.post-image[data-v-09d2080e]{width:100%;height:100%;display:block;object-fit:contain;border-radius:%?12?%}.post-content[data-v-09d2080e]{font-size:%?28?%;color:#666;line-height:1.5;margin:%?15?% 0;word-break:break-word;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;line-clamp:3;-webkit-box-orient:vertical}.post-footer[data-v-09d2080e]{display:flex;justify-content:space-between;align-items:center;margin-top:%?20?%;padding-top:%?20?%;border-top:%?1?% solid #f0f0f0}.post-stats[data-v-09d2080e]{display:flex;align-items:center;gap:%?20?%}.stat-item[data-v-09d2080e]{font-size:%?26?%;color:#999}.post-time[data-v-09d2080e]{font-size:%?24?%;color:#ccc}.empty-tip[data-v-09d2080e]{text-align:center;color:#bbb;font-size:%?28?%;margin:%?40?% 0;padding:%?60?% 0;background-color:#fff;border-radius:%?16?%;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.05)}.profile-follow-btn[data-v-09d2080e]{margin-top:%?24?%;padding:0 %?48?%;height:%?64?%;line-height:%?64?%;background-color:#9ed7ee;color:#fff;border:none;border-radius:%?999?%;font-size:%?28?%}.profile-follow-btn.following[data-v-09d2080e]{background-color:#f0f0f0;color:#666}.profile-follow-btn[data-v-09d2080e]::after{border:none}.profile-follow-btn[disabled][data-v-09d2080e]{opacity:.7}.mutual-pill[data-v-09d2080e],\n.followed-pill[data-v-09d2080e]{margin-top:%?16?%;padding:%?6?% %?24?%;border-radius:%?999?%;font-size:%?26?%;display:inline-block}.mutual-pill[data-v-09d2080e]{background-color:#e6f4ff;color:#1f6fd2}.followed-pill[data-v-09d2080e]{background-color:#f4ebff;color:#7c55c7}",""]),n.exports=t},5102:function(n,t,e){"use strict";e("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e("bf0f"),e("2797"),e("c223");var i=e("139b"),o=i.formatRelativeTime,a=e("a7cb"),s=e("05f6"),l=e("8e86"),r=l.previewImage,d=e("11ca"),c=d.cloudCall,u=e("2b90"),f={mixins:[u],data:function(){return{userInfo:{avatarUrl:"",nickName:"",bio:""},isLoading:!1,userPosts:[],page:0,hasMore:!0,PAGE_SIZE:5,swiperHeights:{},imageClampHeights:{},targetUserId:"",showFollowButton:!1,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1,followPending:!1,imgindex:0,imageUrl:""}},onLoad:function(n){console.log("【用户主页】页面加载,options:",n);var t=n.userId;if(!t)return uni.showToast({title:"用户信息获取失败",icon:"none"}),void uni.navigateBack();this.setData({targetUserId:t}),this.loadUserProfile()},onPullDownRefresh:function(){this.setData({userPosts:[],page:0,hasMore:!0,swiperHeights:{},imageClampHeights:{}}),this.loadUserProfile((function(){uni.stopPullDownRefresh()}))},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadUserPosts()},methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(n,t,Object.assign({pageTag:"user-profile",context:this},e))},loadUserProfile:function(n){var t=this;this.setData({isLoading:!0}),this.callCloudFunction("getUserProfile",{userId:this.targetUserId,skip:0,limit:this.PAGE_SIZE}).then((function(n){if(console.log("【用户主页】getUserProfile 返回:",n),n.result&&n.result.success){var e=n.result.userInfo,i=n.result.posts||[];i.forEach((function(n){n.createTime&&(n.formattedCreateTime=t.formatTime(n.createTime))})),t.setData({userInfo:e,userPosts:i,page:1,hasMore:i.length===t.PAGE_SIZE}),a.updateUserAvatar(t.targetUserId,e),t.prepareFollowStateWithCache(),uni.setNavigationBarTitle({title:e.nickName||"用户主页"})}else{var o;uni.showToast({title:(null===(o=n.result)||void 0===o?void 0:o.message)||"获取用户信息失败",icon:"none"})}})).catch((function(n){console.error("【用户主页】getUserProfile 云函数失败",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),"function"===typeof n&&n()}))},loadUserPosts:function(){var n=this;if(!this.isLoading){var t=this.page,e=this.PAGE_SIZE;this.setData({isLoading:!0}),this.callCloudFunction("getUserProfile",{userId:this.targetUserId,skip:t*e,limit:e}).then((function(i){if(i.result&&i.result.success){var o=i.result.posts||[];o.forEach((function(t){t.createTime&&(t.formattedCreateTime=n.formatTime(t.createTime))}));var a=n.userPosts.concat(o);n.setData({userPosts:a,page:t+1,hasMore:o.length===e})}})).catch((function(n){console.error("加载更多帖子失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({isLoading:!1})}))}},prepareFollowState:function(){var n=this.targetUserId,t=this.getCurrentUserId();n&&t&&n!==t?(this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(n)):this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1})},prepareFollowStateWithCache:function(){var n=this.targetUserId,t=this.getCurrentUserId();n&&t&&n!==t?(this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(n)):this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1})},fetchFollowStatusWithCache:function(n){var t=this;if(n){var e=this.getCurrentUserId();e&&s.getFollowStatus(e,n).then((function(n){n&&t.setData({isFollowing:n.isFollowing,isFollowedByTarget:n.isFollowedByAuthor,isMutualFollow:n.isMutualFollow})}))}},fetchFollowStatus:function(n){var t=this;n&&this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:n},{requireAuth:!0}).then((function(n){n.result&&n.result.success?t.setData({isFollowing:!!n.result.isFollowing,isFollowedByTarget:!!n.result.isFollower,isMutualFollow:!!n.result.isMutual}):console.warn("检查关注状态失败",n.result)})).catch((function(n){console.error("检查关注状态调用失败:",n)}))},onFollowTap:function(){var n=this;if(!this.followPending){var t=this.targetUserId;if(t){var e=this.getCurrentUserId();e?(this.setData({followPending:!0}),s.toggleFollowStatus(e,t).then((function(t){t?(n.setData({isFollowing:t.isFollowing,isFollowedByTarget:t.isFollowedByAuthor,isMutualFollow:t.isMutualFollow}),uni.showToast({title:t.isFollowing?"关注成功":"已取消关注",icon:"success"})):uni.showToast({title:"操作失败",icon:"none"})})).catch((function(n){console.error("切换关注状态失败:",n),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){n.setData({followPending:!1})}))):uni.showToast({title:"请先登录",icon:"none"})}}},getCurrentUserId:function(){return getApp().globalData.openid||uni.getStorageSync("openid")||uni.getStorageSync("userOpenId")},navigateToPostDetail:function(n){var t=n.currentTarget.dataset.id;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},handlePreview:function(n){return r(n,{fallbackToast:!1})},formatTime:function(n){return o(n)},onImageError:function(n){console.error("图片加载失败:",n.detail)},onAvatarError:function(n){console.error("头像加载失败:",n.detail)}}};t.default=f},"62e3":function(n,t,e){"use strict";var i=e("c196"),o=e.n(i);o.a},"7bfe":function(n,t,e){"use strict";e.r(t);var i=e("b807"),o=e("1203");for(var a in o)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(a);e("62e3");var s=e("828b"),l=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"09d2080e",null,!1,i["a"],void 0);t["default"]=l.exports},b807:function(n,t,e){"use strict";e.d(t,"b",(function(){return i})),e.d(t,"c",(function(){return o})),e.d(t,"a",(function(){}));var i=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",{staticClass:"container"},[n.isLoading&&0===n.userPosts.length?e("v-uni-view",{staticClass:"loading-container"},[e("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1):e("v-uni-view",[e("v-uni-view",{staticClass:"profile-card"},[e("v-uni-view",{staticClass:"profile-avatar"},[e("v-uni-image",{attrs:{src:n.userInfo.avatarUrl||"/static/images/avatar.png",mode:"aspectFill"},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onAvatarError.apply(void 0,arguments)}}})],1),e("v-uni-view",{staticClass:"profile-info"},[e("v-uni-text",{staticClass:"profile-name"},[n._v(n._s(n.userInfo.nickName||"微信用户"))]),e("v-uni-text",{staticClass:"profile-bio"},[n._v(n._s(n.userInfo.bio||"这个用户很懒，什么都没留下..."))])],1),n.showFollowButton?e("v-uni-button",{class:"profile-follow-btn "+(n.isFollowing?"following":""),attrs:{loading:n.followPending,disabled:n.followPending},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onFollowTap.apply(void 0,arguments)}}},[n._v(n._s(n.isFollowing?"已关注":"关注"))]):n._e(),n.isMutualFollow?e("v-uni-view",{staticClass:"mutual-pill"},[n._v("互相关注")]):n.isFollowedByTarget?e("v-uni-view",{staticClass:"followed-pill"},[n._v("TA关注了你")]):n._e()],1),e("v-uni-view",{staticClass:"posts-section"},[e("v-uni-view",{staticClass:"section-title"},[n._v("TA的帖子")]),n.userPosts.length>0?[n._l(n.userPosts,(function(t,i){return e("v-uni-view",{key:i,staticClass:"post-card",attrs:{"data-id":t._id,"hover-class":"post-item-active"},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateToPostDetail.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"post-header"},[e("v-uni-text",{staticClass:"post-title"},[n._v(n._s(t.title))])],1),t.imageUrls&&t.imageUrls.length>0?e("v-uni-view",{staticClass:"image-container"},[t.imageUrls.length>1?[e("v-uni-swiper",{staticClass:"image-swiper",style:"width: 100%; height: "+(n.swiperHeights[i]?n.swiperHeights[i]+"px":"220px")+";",attrs:{id:"swiper-"+i,"indicator-dots":!0,circular:!1,autoplay:!1}},[n._l(t.imageUrls,(function(o,a){return[e("v-uni-swiper-item",[e("v-uni-image",{staticClass:"post-image",staticStyle:{width:"100%",height:"100%","object-fit":"cover","background-color":"#f0f0f0"},attrs:{id:"user-swiper-img-"+i+"-"+a,src:o,mode:"aspectFill","data-src":o,"data-original-image-urls":t.originalImageUrls||t.imageUrls,"data-postindex":i,"data-imgindex":a,"data-type":"multi","lazy-load":!0},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageError.apply(void 0,arguments)},load:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageLoad.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.handlePreview.apply(void 0,arguments)}}})],1)]}))],2)]:1===t.imageUrls.length?[e("v-uni-image",{staticClass:"post-image",style:"width: 100%; height: "+(n.imageClampHeights[i]?n.imageClampHeights[i]+"px":"auto")+"; object-fit: "+(n.imageClampHeights[i]?"cover":"contain")+"; background-color: #f0f0f0;",attrs:{id:"single-image-"+i,src:t.imageUrls[0],mode:n.imageClampHeights[i]?"aspectFill":"widthFix","data-src":t.imageUrls[0],"data-original-image-urls":t.originalImageUrls||t.imageUrls,"data-postindex":i,"data-imgindex":"0","data-type":"single","lazy-load":!0},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageError.apply(void 0,arguments)},load:function(t){arguments[0]=t=n.$handleEvent(t),n.onImageLoad.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.handlePreview.apply(void 0,arguments)}}})]:n._e()],2):n._e(),t.content?e("v-uni-view",{staticClass:"post-content"},[n._v(n._s(t.content))]):n._e(),e("v-uni-view",{staticClass:"post-footer"},[e("v-uni-view",{staticClass:"post-stats"},[e("v-uni-text",{staticClass:"stat-item"},[n._v("❤️ "+n._s(t.votes||0))]),e("v-uni-text",{staticClass:"stat-item"},[n._v("💬 "+n._s(t.commentCount||0))])],1),e("v-uni-view",{staticClass:"post-time"},[n._v(n._s(t.formattedCreateTime))])],1)],1)})),n.isLoading&&n.userPosts.length>0?e("v-uni-view",{staticClass:"loading-container"},[e("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1):n._e(),e("v-uni-view",{staticStyle:{height:"200rpx"}})]:e("v-uni-view",{staticClass:"empty-tip"},[e("v-uni-text",[n._v("TA还没有发布过帖子")])],1)],2)],1)],1)},o=[]},c196:function(n,t,e){var i=e("1a1e");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[n.i,i,""]]),i.locals&&(n.exports=i.locals);var o=e("967d").default;o("68762074",i,!0,{sourceMap:!1,shadowMode:!1})}}]);