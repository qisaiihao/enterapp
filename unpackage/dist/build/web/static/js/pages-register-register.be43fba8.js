(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-register-register"],{2912:function(n,r,e){var t=e("dec2");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[n.i,t,""]]),t.locals&&(n.exports=t.locals);var a=e("967d").default;a("66077094",t,!0,{sourceMap:!1,shadowMode:!1})},"4e4a":function(n,r,e){"use strict";e.r(r);var t=e("a9dc"),a=e("f48e");for(var i in a)["default"].indexOf(i)<0&&function(n){e.d(r,n,(function(){return a[n]}))}(i);e("8618");var o=e("828b"),s=Object(o["a"])(a["default"],t["b"],t["c"],!1,null,"e38194ec",null,!1,t["a"],void 0);r["default"]=s.exports},8618:function(n,r,e){"use strict";var t=e("2912"),a=e.n(t);a.a},"967d":function(n,r,e){"use strict";function t(n,r){for(var e=[],t={},a=0;a<r.length;a++){var i=r[a],o=i[0],s=i[1],c=i[2],u=i[3],l={id:n+":"+a,css:s,media:c,sourceMap:u};t[o]?t[o].parts.push(l):e.push(t[o]={id:o,parts:[l]})}return e}e.r(r),e.d(r,"default",(function(){return f}));var a="undefined"!==typeof document;if("undefined"!==typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},o=a&&(document.head||document.getElementsByTagName("head")[0]),s=null,c=0,u=!1,l=function(){},d=null,p="undefined"!==typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(n,r,e,a){u=e,d=a||{};var o=t(n,r);return v(o),function(r){for(var e=[],a=0;a<o.length;a++){var s=o[a],c=i[s.id];c.refs--,e.push(c)}r?(o=t(n,r),v(o)):o=[];for(a=0;a<e.length;a++){c=e[a];if(0===c.refs){for(var u=0;u<c.parts.length;u++)c.parts[u]();delete i[c.id]}}}}function v(n){for(var r=0;r<n.length;r++){var e=n[r],t=i[e.id];if(t){t.refs++;for(var a=0;a<t.parts.length;a++)t.parts[a](e.parts[a]);for(;a<e.parts.length;a++)t.parts.push(m(e.parts[a]));t.parts.length>e.parts.length&&(t.parts.length=e.parts.length)}else{var o=[];for(a=0;a<e.parts.length;a++)o.push(m(e.parts[a]));i[e.id]={id:e.id,refs:1,parts:o}}}}function g(){var n=document.createElement("style");return n.type="text/css",o.appendChild(n),n}function m(n){var r,e,t=document.querySelector('style[data-vue-ssr-id~="'+n.id+'"]');if(t){if(u)return l;t.parentNode.removeChild(t)}if(p){var a=c++;t=s||(s=g()),r=w.bind(null,t,a,!1),e=w.bind(null,t,a,!0)}else t=g(),r=b.bind(null,t),e=function(){t.parentNode.removeChild(t)};return r(n),function(t){if(t){if(t.css===n.css&&t.media===n.media&&t.sourceMap===n.sourceMap)return;r(n=t)}else e()}}var h=function(){var n=[];return function(r,e){return n[r]=e,n.filter(Boolean).join("\n")}}();function w(n,r,e,t){var a=e?"":E(t.css);if(n.styleSheet)n.styleSheet.cssText=h(r,a);else{var i=document.createTextNode(a),o=n.childNodes;o[r]&&n.removeChild(o[r]),o.length?n.insertBefore(i,o[r]):n.appendChild(i)}}function b(n,r){var e=E(r.css),t=r.media,a=r.sourceMap;if(t&&n.setAttribute("media",t),d.ssrId&&n.setAttribute("data-vue-ssr-id",r.id),a&&(e+="\n/*# sourceURL="+a.sources[0]+" */",e+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),n.styleSheet)n.styleSheet.cssText=e;else{while(n.firstChild)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}var x=/%\?([+-]?\d+(\.\d+)?)\?%/g,y=/\.\?%PAGE\?%/g,k=/\?%PAGE\?%\[data-v-[a-z0-9]{8}\]/g,C=/uni-page-body\[data-v-[a-z0-9]{8}\]/g,I=/var\(--status-bar-height\)/gi,P=/var\(--window-top\)/gi,N=/var\(--window-bottom\)/gi,R=/var\(--window-left\)/gi,$=/var\(--window-right\)/gi;function E(n){var r=function(){var n="function"===typeof getApp&&getApp();return n&&n.$route&&n.$route.meta&&n.$route.meta.name||""}();if("undefined"!==typeof uni&&!uni.canIUse("css.var")){var e=function(){var n="function"===typeof getApp&&getApp();if(n&&n.$route&&n.$route.meta&&n.$route.meta.name)return{top:n.$route.meta.windowTop,bottom:n.$route.meta.isTabBar?50:0};return{top:0,bottom:0}}();n=n.replace(I,"0px").replace(P,e.top+"px").replace(N,e.bottom+"px").replace(R,"0px").replace($,"0px")}return n.replace(k,r).replace(y,"").replace(C,"body."+r+" uni-page-body").replace(/\{[\s\S]+?\}|@media.+?\{/g,(function(n){return"undefined"===typeof uni?n:n.replace(x,(function(n,r){return uni.upx2px(r)+"px"}))}))}},9787:function(n,r,e){"use strict";e("6a54");var t=e("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=t(e("2634")),i=t(e("2fdc"));e("0c26"),e("bf0f"),e("7a76"),e("c9b5");getApp();var o=e("11ca"),s=o.cloudCall,c={data:function(){return{poemId:"",password:"",confirmPassword:"",nickName:"",isRegistering:!1}},computed:{canRegister:function(){return this.poemId.trim()&&this.password.trim()&&this.confirmPassword.trim()&&this.nickName.trim()&&this.password===this.confirmPassword}},onLoad:function(){},methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(n,r,Object.assign({pageTag:"register",context:this},e))},performAuth:function(){var n=this;return(0,i.default)((0,a.default)().mark((function r(){return(0,a.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log("🔐 [Register] 开始认证流程"),r.abrupt("return",new Promise((function(r,t){var a=e("fd09"),i=a.getCurrentPlatform,o=i();if("h5"===o||"app"===o)if(n.$tcb&&n.$tcb.auth){var s=n.$tcb.auth().currentUser;s?(console.log("✅ [注册] 用户已登录，跳过匿名登录"),r(s)):(console.log("🔐 [注册] 尝试匿名登录..."),n.$tcb.auth().signInAnonymously().then((function(n){console.log("✅ [注册] 匿名登录成功:",n),r(n)})).catch(t))}else t(new Error("TCB认证不可用"));else if("miniprogram"===o)if(wx.cloud&&wx.cloud.auth){var c=wx.cloud.auth().currentUser;c?(console.log("✅ [注册] 用户已登录，跳过匿名登录"),r(c)):(console.log("🔐 [注册] 尝试匿名登录..."),wx.cloud.auth().signInAnonymously().then((function(n){console.log("✅ [注册] 匿名登录成功:",n),r(n)})).catch(t))}else t(new Error("微信云开发认证不可用"));else t(new Error("不支持的平台: ".concat(o)))})));case 2:case"end":return r.stop()}}),r)})))()},onPoemIdInput:function(n){this.poemId=n.detail.value},onPasswordInput:function(n){this.password=n.detail.value},onConfirmPasswordInput:function(n){this.confirmPassword=n.detail.value},onNickNameInput:function(n){this.nickName=n.detail.value},onRegister:function(){var n=this;return(0,i.default)((0,a.default)().mark((function r(){var e,t,i,o,s,c;return(0,a.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.canRegister&&!n.isRegistering){r.next=2;break}return r.abrupt("return");case 2:if(n.password===n.confirmPassword){r.next=5;break}return uni.showToast({title:"两次输入的密码不一致",icon:"none",duration:3e3}),r.abrupt("return");case 5:return n.isRegistering=!0,uni.showLoading({title:"注册中...",mask:!0}),r.prev=7,r.next=10,n.performAuth();case 10:return r.next=12,n.callCloudFunction("registerUser",{poemId:n.poemId.trim(),password:n.password.trim(),nickName:n.nickName.trim()});case 12:e=r.sent,console.log("🔍 [注册] 云函数返回结果:",e),e.result&&e.result.success?(t=e.result.userInfo,i=e.result.openid,console.log("✅ [注册] 注册成功:",t),o=getApp(),o.globalData.userInfo=t,o.globalData.openid=i,uni.setStorageSync("userInfo",t),uni.setStorageSync("userOpenId",i),uni.showToast({title:"注册成功",icon:"success"}),setTimeout((function(){uni.switchTab({url:"/pages/poem/poem"})}),1e3)):(c=(null===(s=e.result)||void 0===s?void 0:s.message)||"注册失败，请重试",uni.showToast({title:c,icon:"none",duration:3e3})),r.next=21;break;case 17:r.prev=17,r.t0=r["catch"](7),console.error("❌ [注册] 注册失败:",r.t0),uni.showToast({title:"注册失败，请重试",icon:"none",duration:3e3});case 21:return r.prev=21,uni.hideLoading(),n.isRegistering=!1,r.finish(21);case 25:case"end":return r.stop()}}),r,null,[[7,17,21,25]])})))()},goToLogin:function(){uni.navigateBack()}}};r.default=c},a9dc:function(n,r,e){"use strict";e.d(r,"b",(function(){return t})),e.d(r,"c",(function(){return a})),e.d(r,"a",(function(){}));var t=function(){var n=this,r=n.$createElement,e=n._self._c||r;return e("v-uni-view",[e("v-uni-view",{staticClass:"container"},[e("v-uni-view",{staticClass:"title"},[n._v("创建新账号")]),e("v-uni-view",{staticClass:"subtitle"},[n._v("设置你的账号信息")]),e("v-uni-view",{staticClass:"form-wrapper"},[e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("Poem ID")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"text",placeholder:"请输入Poem ID"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onPoemIdInput.apply(void 0,arguments)}},model:{value:n.poemId,callback:function(r){n.poemId=r},expression:"poemId"}})],1),e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("密码")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"password",placeholder:"请输入密码"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onPasswordInput.apply(void 0,arguments)}},model:{value:n.password,callback:function(r){n.password=r},expression:"password"}})],1),e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("确认密码")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"password",placeholder:"请再次输入密码"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onConfirmPasswordInput.apply(void 0,arguments)}},model:{value:n.confirmPassword,callback:function(r){n.confirmPassword=r},expression:"confirmPassword"}})],1),e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("昵称")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"text",placeholder:"请输入昵称"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onNickNameInput.apply(void 0,arguments)}},model:{value:n.nickName,callback:function(r){n.nickName=r},expression:"nickName"}})],1),e("v-uni-button",{staticClass:"register-button",class:{loading:n.isRegistering},attrs:{disabled:!n.canRegister||n.isRegistering},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onRegister.apply(void 0,arguments)}}},[n._v(n._s(n.isRegistering?"注册中...":"注册"))]),e("v-uni-view",{staticClass:"login-link-wrapper"},[e("v-uni-text",{staticClass:"login-text"},[n._v("已有账号？")]),e("v-uni-text",{staticClass:"login-link",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.goToLogin.apply(void 0,arguments)}}},[n._v("立即登录")])],1)],1)],1)],1)},a=[]},c86c:function(n,r,e){"use strict";n.exports=function(n){var r=[];return r.toString=function(){return this.map((function(r){var e=function(n,r){var e=n[1]||"",t=n[3];if(!t)return e;if(r&&"function"===typeof btoa){var a=function(n){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),e="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r);return"/*# ".concat(e," */")}(t),i=t.sources.map((function(n){return"/*# sourceURL=".concat(t.sourceRoot||"").concat(n," */")}));return[e].concat(i).concat([a]).join("\n")}return[e].join("\n")}(r,n);return r[2]?"@media ".concat(r[2]," {").concat(e,"}"):e})).join("")},r.i=function(n,e,t){"string"===typeof n&&(n=[[null,n,""]]);var a={};if(t)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(a[o]=!0)}for(var s=0;s<n.length;s++){var c=[].concat(n[s]);t&&a[c[0]]||(e&&(c[2]?c[2]="".concat(e," and ").concat(c[2]):c[2]=e),r.push(c))}},r}},dec2:function(n,r,e){var t=e("c86c");r=t(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* 注册页面样式 */.container[data-v-e38194ec]{display:flex;flex-direction:column;align-items:center;padding:%?120?% %?60?% %?60?%;height:100vh;background:linear-gradient(135deg,#f5f7fa,#c3cfe2)}.title[data-v-e38194ec]{font-size:%?56?%;font-weight:700;margin-bottom:%?20?%;color:#333;text-align:center}.subtitle[data-v-e38194ec]{font-size:%?28?%;color:#666;margin-bottom:%?80?%;text-align:center}.form-wrapper[data-v-e38194ec]{width:100%;max-width:%?600?%}.input-wrapper[data-v-e38194ec]{margin-bottom:%?30?%;background:#fff;border-radius:%?16?%;padding:%?30?%;box-shadow:0 %?4?% %?20?% rgba(0,0,0,.1)}.input-label[data-v-e38194ec]{display:block;font-size:%?28?%;color:#333;margin-bottom:%?20?%;font-weight:500}.input-field[data-v-e38194ec]{width:100%;font-size:%?32?%;color:#333;border:none;outline:none;background:transparent}.input-field[data-v-e38194ec]::-webkit-input-placeholder{color:#999}.input-field[data-v-e38194ec]::placeholder{color:#999}.register-button[data-v-e38194ec]{width:100%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:%?32?%;font-weight:500;border-radius:%?16?%;padding:%?30?%;margin:%?60?% 0 %?40?%;border:none;box-shadow:0 %?8?% %?25?% rgba(102,126,234,.3);transition:all .3s ease}.register-button[data-v-e38194ec]:active{-webkit-transform:translateY(%?2?%);transform:translateY(%?2?%);box-shadow:0 %?4?% %?15?% rgba(102,126,234,.3)}.register-button[data-v-e38194ec]:disabled{background:#ccc;box-shadow:none;-webkit-transform:none;transform:none}.register-button.loading[data-v-e38194ec]{background:#ccc;box-shadow:none}.login-link-wrapper[data-v-e38194ec]{display:flex;justify-content:center;align-items:center;margin-top:%?40?%}.login-text[data-v-e38194ec]{font-size:%?28?%;color:#666;margin-right:%?10?%}.login-link[data-v-e38194ec]{font-size:%?28?%;color:#667eea;font-weight:500;text-decoration:underline}",""]),n.exports=r},f48e:function(n,r,e){"use strict";e.r(r);var t=e("9787"),a=e.n(t);for(var i in t)["default"].indexOf(i)<0&&function(n){e.d(r,n,(function(){return t[n]}))}(i);r["default"]=a.a}}]);