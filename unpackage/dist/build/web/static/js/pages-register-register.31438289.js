(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-register-register"],{2912:function(n,r,e){var t=e("dec2");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[n.i,t,""]]),t.locals&&(n.exports=t.locals);var i=e("967d").default;i("66077094",t,!0,{sourceMap:!1,shadowMode:!1})},"4e4a":function(n,r,e){"use strict";e.r(r);var t=e("a9dc"),i=e("f48e");for(var a in i)["default"].indexOf(a)<0&&function(n){e.d(r,n,(function(){return i[n]}))}(a);e("8618");var o=e("828b"),s=Object(o["a"])(i["default"],t["b"],t["c"],!1,null,"e38194ec",null,!1,t["a"],void 0);r["default"]=s.exports},8618:function(n,r,e){"use strict";var t=e("2912"),i=e.n(t);i.a},9787:function(n,r,e){"use strict";e("6a54");var t=e("f5bd").default;Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=t(e("2634")),a=t(e("2fdc"));e("0c26"),e("bf0f"),e("7a76"),e("c9b5");getApp();var o=e("11ca"),s=o.cloudCall,c={data:function(){return{poemId:"",password:"",confirmPassword:"",nickName:"",isRegistering:!1}},computed:{canRegister:function(){return this.poemId.trim()&&this.password.trim()&&this.confirmPassword.trim()&&this.nickName.trim()&&this.password===this.confirmPassword}},onLoad:function(){},methods:{callCloudFunction:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(n,r,Object.assign({pageTag:"register",context:this},e))},performAuth:function(){var n=this;return(0,a.default)((0,i.default)().mark((function r(){return(0,i.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log("🔐 [Register] 开始认证流程"),r.abrupt("return",new Promise((function(r,t){var i=e("fd09"),a=i.getCurrentPlatform,o=a();if("h5"===o||"app"===o)if(n.$tcb&&n.$tcb.auth){var s=n.$tcb.auth().currentUser;s?(console.log("✅ [注册] 用户已登录，跳过匿名登录"),r(s)):(console.log("🔐 [注册] 尝试匿名登录..."),n.$tcb.auth().signInAnonymously().then((function(n){console.log("✅ [注册] 匿名登录成功:",n),r(n)})).catch(t))}else t(new Error("TCB认证不可用"));else if("miniprogram"===o)if(wx.cloud&&wx.cloud.auth){var c=wx.cloud.auth().currentUser;c?(console.log("✅ [注册] 用户已登录，跳过匿名登录"),r(c)):(console.log("🔐 [注册] 尝试匿名登录..."),wx.cloud.auth().signInAnonymously().then((function(n){console.log("✅ [注册] 匿名登录成功:",n),r(n)})).catch(t))}else t(new Error("微信云开发认证不可用"));else t(new Error("不支持的平台: ".concat(o)))})));case 2:case"end":return r.stop()}}),r)})))()},onPoemIdInput:function(n){this.poemId=n.detail.value},onPasswordInput:function(n){this.password=n.detail.value},onConfirmPasswordInput:function(n){this.confirmPassword=n.detail.value},onNickNameInput:function(n){this.nickName=n.detail.value},onRegister:function(){var n=this;return(0,a.default)((0,i.default)().mark((function r(){var e,t,a,o,s,c;return(0,i.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.canRegister&&!n.isRegistering){r.next=2;break}return r.abrupt("return");case 2:if(n.password===n.confirmPassword){r.next=5;break}return uni.showToast({title:"两次输入的密码不一致",icon:"none",duration:3e3}),r.abrupt("return");case 5:return n.isRegistering=!0,uni.showLoading({title:"注册中...",mask:!0}),r.prev=7,r.next=10,n.performAuth();case 10:return r.next=12,n.callCloudFunction("registerUser",{poemId:n.poemId.trim(),password:n.password.trim(),nickName:n.nickName.trim()});case 12:e=r.sent,console.log("🔍 [注册] 云函数返回结果:",e),e.result&&e.result.success?(t=e.result.userInfo,a=e.result.openid,console.log("✅ [注册] 注册成功:",t),o=getApp(),o.globalData.userInfo=t,o.globalData.openid=a,uni.setStorageSync("userInfo",t),uni.setStorageSync("userOpenId",a),uni.showToast({title:"注册成功",icon:"success"}),setTimeout((function(){uni.switchTab({url:"/pages/poem/poem"})}),1e3)):(c=(null===(s=e.result)||void 0===s?void 0:s.message)||"注册失败，请重试",uni.showToast({title:c,icon:"none",duration:3e3})),r.next=21;break;case 17:r.prev=17,r.t0=r["catch"](7),console.error("❌ [注册] 注册失败:",r.t0),uni.showToast({title:"注册失败，请重试",icon:"none",duration:3e3});case 21:return r.prev=21,uni.hideLoading(),n.isRegistering=!1,r.finish(21);case 25:case"end":return r.stop()}}),r,null,[[7,17,21,25]])})))()},goToLogin:function(){uni.navigateBack()}}};r.default=c},a9dc:function(n,r,e){"use strict";e.d(r,"b",(function(){return t})),e.d(r,"c",(function(){return i})),e.d(r,"a",(function(){}));var t=function(){var n=this,r=n.$createElement,e=n._self._c||r;return e("v-uni-view",[e("v-uni-view",{staticClass:"container"},[e("v-uni-view",{staticClass:"title"},[n._v("创建新账号")]),e("v-uni-view",{staticClass:"subtitle"},[n._v("设置你的账号信息")]),e("v-uni-view",{staticClass:"form-wrapper"},[e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("Poem ID")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"text",placeholder:"请输入Poem ID"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onPoemIdInput.apply(void 0,arguments)}},model:{value:n.poemId,callback:function(r){n.poemId=r},expression:"poemId"}})],1),e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("密码")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"password",placeholder:"请输入密码"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onPasswordInput.apply(void 0,arguments)}},model:{value:n.password,callback:function(r){n.password=r},expression:"password"}})],1),e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("确认密码")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"password",placeholder:"请再次输入密码"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onConfirmPasswordInput.apply(void 0,arguments)}},model:{value:n.confirmPassword,callback:function(r){n.confirmPassword=r},expression:"confirmPassword"}})],1),e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("昵称")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"text",placeholder:"请输入昵称"},on:{input:function(r){arguments[0]=r=n.$handleEvent(r),n.onNickNameInput.apply(void 0,arguments)}},model:{value:n.nickName,callback:function(r){n.nickName=r},expression:"nickName"}})],1),e("v-uni-button",{staticClass:"register-button",class:{loading:n.isRegistering},attrs:{disabled:!n.canRegister||n.isRegistering},on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.onRegister.apply(void 0,arguments)}}},[n._v(n._s(n.isRegistering?"注册中...":"注册"))]),e("v-uni-view",{staticClass:"login-link-wrapper"},[e("v-uni-text",{staticClass:"login-text"},[n._v("已有账号？")]),e("v-uni-text",{staticClass:"login-link",on:{click:function(r){arguments[0]=r=n.$handleEvent(r),n.goToLogin.apply(void 0,arguments)}}},[n._v("立即登录")])],1)],1)],1)],1)},i=[]},dec2:function(n,r,e){var t=e("c86c");r=t(!1),r.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* 注册页面样式 */.container[data-v-e38194ec]{display:flex;flex-direction:column;align-items:center;padding:%?120?% %?60?% %?60?%;height:100vh;background:linear-gradient(135deg,#f5f7fa,#c3cfe2)}.title[data-v-e38194ec]{font-size:%?56?%;font-weight:700;margin-bottom:%?20?%;color:#333;text-align:center}.subtitle[data-v-e38194ec]{font-size:%?28?%;color:#666;margin-bottom:%?80?%;text-align:center}.form-wrapper[data-v-e38194ec]{width:100%;max-width:%?600?%}.input-wrapper[data-v-e38194ec]{margin-bottom:%?30?%;background:#fff;border-radius:%?16?%;padding:%?30?%;box-shadow:0 %?4?% %?20?% rgba(0,0,0,.1)}.input-label[data-v-e38194ec]{display:block;font-size:%?28?%;color:#333;margin-bottom:%?20?%;font-weight:500}.input-field[data-v-e38194ec]{width:100%;font-size:%?32?%;color:#333;border:none;outline:none;background:transparent}.input-field[data-v-e38194ec]::-webkit-input-placeholder{color:#999}.input-field[data-v-e38194ec]::placeholder{color:#999}.register-button[data-v-e38194ec]{width:100%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:%?32?%;font-weight:500;border-radius:%?16?%;padding:%?30?%;margin:%?60?% 0 %?40?%;border:none;box-shadow:0 %?8?% %?25?% rgba(102,126,234,.3);transition:all .3s ease}.register-button[data-v-e38194ec]:active{-webkit-transform:translateY(%?2?%);transform:translateY(%?2?%);box-shadow:0 %?4?% %?15?% rgba(102,126,234,.3)}.register-button[data-v-e38194ec]:disabled{background:#ccc;box-shadow:none;-webkit-transform:none;transform:none}.register-button.loading[data-v-e38194ec]{background:#ccc;box-shadow:none}.login-link-wrapper[data-v-e38194ec]{display:flex;justify-content:center;align-items:center;margin-top:%?40?%}.login-text[data-v-e38194ec]{font-size:%?28?%;color:#666;margin-right:%?10?%}.login-link[data-v-e38194ec]{font-size:%?28?%;color:#667eea;font-weight:500;text-decoration:underline}",""]),n.exports=r},f48e:function(n,r,e){"use strict";e.r(r);var t=e("9787"),i=e.n(t);for(var a in t)["default"].indexOf(a)<0&&function(n){e.d(r,n,(function(){return t[n]}))}(a);r["default"]=i.a}}]);