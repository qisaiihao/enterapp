(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mountain-mountain"],{"2d42":function(n,t,e){var r=e("9755");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[n.i,r,""]]),r.locals&&(n.exports=r.locals);var a=e("967d").default;a("a93cda0c",r,!0,{sourceMap:!1,shadowMode:!1})},"2f3a":function(n,t,e){"use strict";e.d(t,"b",(function(){return a})),e.d(t,"c",(function(){return o})),e.d(t,"a",(function(){return r}));var r={topBar:e("c4b7").default,skeleton:e("71b6").default},a=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",{staticClass:"mountain white-bg",on:{touchstart:function(t){arguments[0]=t=n.$handleEvent(t),n.touchStart.apply(void 0,arguments)},touchend:function(t){arguments[0]=t=n.$handleEvent(t),n.touchEnd.apply(void 0,arguments)}}},[e("top-bar"),n.isLoading?e("v-uni-view",[e("skeleton")],1):e("v-uni-view",{staticClass:"square-mode-container"},[0===n.postList.length?e("v-uni-view",{staticClass:"empty-state"},[e("v-uni-view",{staticClass:"empty-icon"},[n._v("⛰️")]),e("v-uni-view",{staticClass:"empty-text"},[n._v("这里还没有山诗")]),e("v-uni-view",{staticClass:"empty-subtext"},[n._v("去广场发现好诗吧～")])],1):n._e(),e("v-uni-view",{attrs:{id:"post-list-container"}},n._l(n.postList,(function(t,r){return e("v-uni-view",{key:t._id||r,staticClass:"post-item-wrapper",style:{backgroundColor:t.backgroundColor}},[e("v-uni-view",{staticClass:"post-content-navigator",attrs:{"data-index":r},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.togglePostExpansion.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"post-item"},[t.content?e("v-uni-view",{class:"post-content "+(t.isExpanded?"expanded":"collapsed"),style:{color:t.textColor,whiteSpace:"pre-wrap"}},[t.isExpanded?[n._v(n._s(t.content))]:[t.highlightLines&&t.highlightLines.length>0?n._l(t.highlightLines,(function(t,r){return e("v-uni-text",{key:"line-"+r,staticStyle:{"font-weight":"700",display:"block"}},[n._v(n._s(t))])})):[n._v(n._s(t.content))]]],2):n._e(),t.isExpanded&&t.authorSignature?e("v-uni-view",{staticClass:"user-signature"},[e("v-uni-image",{staticClass:"signature-image",attrs:{src:t.authorSignature,mode:"aspectFit"},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onSignatureError.apply(void 0,arguments)},load:function(t){arguments[0]=t=n.$handleEvent(t),n.onSignatureLoad.apply(void 0,arguments)}}})],1):n._e(),!t.isExpanded&&t.authorSignature?e("v-uni-view",{staticClass:"user-signature-small"},[e("v-uni-image",{staticClass:"signature-image-small",attrs:{src:t.authorSignature,mode:"aspectFit"},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onSignatureError.apply(void 0,arguments)},load:function(t){arguments[0]=t=n.$handleEvent(t),n.onSignatureLoad.apply(void 0,arguments)}}})],1):n._e()],1)],1),t.isExpanded?e("v-uni-view",{staticClass:"vote-section",style:{backgroundColor:t.backgroundColor}},[e("v-uni-view",{staticClass:"actions-left"},[e("v-uni-view",{staticClass:"like-icon-container",attrs:{"data-postid":t._id,"data-index":r},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onVote.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"like-icon",attrs:{src:t.likeIcon||"/static/images/seed.png",mode:"aspectFit"},on:{error:function(t){arguments[0]=t=n.$handleEvent(t),n.onLikeIconError.apply(void 0,arguments)}}})],1),e("v-uni-view",{staticClass:"comment-count",attrs:{"data-postid":t._id},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.onCommentClick.apply(void 0,arguments)}}},[e("v-uni-text",{staticClass:"comment-emoji"},[n._v("💬")])],1)],1),e("v-uni-view",{staticClass:"button-group"})],1):n._e()],1)})),1),e("v-uni-view",{staticClass:"loading-footer"},[n.isLoadingMore?[e("v-uni-text",[n._v("加载中...")])]:!n.hasMore&&n.postList.length>0?[e("v-uni-text",[n._v("—— 到底啦 ——")])]:n._e()],2)],1),n.showPageIndicator?e("v-uni-view",{staticClass:"page-indicator"},[e("v-uni-view",{staticClass:"page-indicator-text"},[n._v("加载更多...")])],1):n._e(),e("app-tab-bar",{ref:"customTabBar"})],1)},o=[]},3675:function(n,t,e){"use strict";e.r(t);var r=e("2f3a"),a=e("6ccc");for(var o in a)["default"].indexOf(o)<0&&function(n){e.d(t,n,(function(){return a[n]}))}(o);e("e036");var i=e("828b"),s=Object(i["a"])(a["default"],r["b"],r["c"],!1,null,"57a69c4a",null,!1,r["a"],void 0);t["default"]=s.exports},"44f3":function(n,t,e){"use strict";e.r(t);var r=e("8066"),a=e.n(r);for(var o in r)["default"].indexOf(o)<0&&function(n){e.d(t,n,(function(){return r[n]}))}(o);t["default"]=a.a},"6ccc":function(n,t,e){"use strict";e.r(t);var r=e("84aa"),a=e.n(r);for(var o in r)["default"].indexOf(o)<0&&function(n){e.d(t,n,(function(){return r[n]}))}(o);t["default"]=a.a},"7a2f":function(n,t,e){var r=e("c86c");t=r(!1),t.push([n.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* components/folder-selector/folder-selector.wxss */.modal-overlay[data-v-3a05c372]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[data-v-3a05c372]{background:#fff;border-radius:%?16?%;margin:%?40?%;width:calc(100% - %?80?%);max-width:%?600?%;max-height:80vh;display:flex;flex-direction:column}.modal-header[data-v-3a05c372]{display:flex;align-items:center;justify-content:space-between;padding:%?30?% %?40?%;border-bottom:%?1?% solid #f0f0f0}.modal-title[data-v-3a05c372]{font-size:%?36?%;font-weight:500;color:#333}.close-btn[data-v-3a05c372]{font-size:%?48?%;color:#999;line-height:1;position:relative;z-index:1001}.modal-body[data-v-3a05c372]{flex:1;padding:%?20?% 0;max-height:60vh;overflow-y:auto}.loading-container[data-v-3a05c372]{display:flex;justify-content:center;align-items:center;height:%?200?%}.loading-text[data-v-3a05c372]{color:#999;font-size:%?28?%}.folders-list[data-v-3a05c372]{padding:0 %?40?%}.folder-item[data-v-3a05c372]{display:flex;align-items:center;padding:%?24?% 0;border-bottom:%?1?% solid #f8f8f8}.folder-item[data-v-3a05c372]:last-child{border-bottom:none}.folder-item.selected[data-v-3a05c372]{background:rgba(7,193,96,.1);border-radius:%?8?%;padding:%?24?% %?20?%;margin:0 %?-20?%}.folder-icon[data-v-3a05c372]{font-size:%?40?%;margin-right:%?20?%}.folder-info[data-v-3a05c372]{flex:1}.folder-name[data-v-3a05c372]{font-size:%?30?%;color:#333;font-weight:500;margin-bottom:%?4?%}.folder-count[data-v-3a05c372]{font-size:%?24?%;color:#999}.selected-icon[data-v-3a05c372]{font-size:%?32?%;color:#9ed7ee;font-weight:700}.empty-state[data-v-3a05c372]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:%?200?%;padding:%?40?%}.empty-icon[data-v-3a05c372]{font-size:%?60?%;margin-bottom:%?16?%;opacity:.5}.empty-text[data-v-3a05c372]{font-size:%?28?%;color:#666;margin-bottom:%?8?%}.empty-subtext[data-v-3a05c372]{font-size:%?24?%;color:#999}.modal-footer[data-v-3a05c372]{display:flex;gap:%?20?%;padding:%?30?% %?40?%;border-top:%?1?% solid #f0f0f0}.modal-btn[data-v-3a05c372]{flex:1;height:%?80?%;border-radius:%?8?%;font-size:%?28?%;border:none;display:flex;align-items:center;justify-content:center;position:relative;z-index:1001}.secondary-btn[data-v-3a05c372]{background:#f5f5f5;color:#666}.primary-btn[data-v-3a05c372]{background:#9ed7ee;color:#fff}.primary-btn[data-v-3a05c372]:disabled{background:#ccc;color:#999}\r\n/* 创建收藏夹弹窗样式 */.create-modal .modal-body[data-v-3a05c372]{padding:%?40?%}.folder-name-input[data-v-3a05c372]{width:100%;height:%?80?%;padding:0 %?20?%;border:%?2?% solid #e0e0e0;border-radius:%?8?%;font-size:%?30?%;box-sizing:border-box}.folder-name-input[data-v-3a05c372]:focus{border-color:#9ed7ee}",""]),n.exports=t},8066:function(n,t,e){"use strict";e("6a54");var r=e("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e("bf0f"),e("0c26");var a=r(e("39d8")),o=e("38db"),i=o.cloudCall,s={data:function(){return{folders:[],isLoading:!0,selectedFolderId:"",showCreateModal:!1,newFolderName:"",showClone:!1}},props:{show:{type:Boolean,default:!1},postId:{type:String,default:""}},watch:(0,a.default)({show:function(n){n&&this.loadFolders()}},"show",{handler:function(n,t){this.showClone=n},immediate:!0}),methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(n,t,Object.assign({pageTag:"folder-selector",context:this,requireAuth:!0},e))},loadFolders:function(){var n=this;console.log("开始加载收藏夹列表..."),this.setData({isLoading:!0});var t=this.$requireOpenid&&this.$requireOpenid();t?this.callCloudFunction("getMyProfileData",{action:"getFavoriteFolders",openid:t}).then((function(t){if(console.log("folder-selector获取收藏夹:",t),t.result&&t.result.success){var e=t.result.folders||[];console.log("获取到收藏夹数量:",e.length);var r=n.selectedFolderId;r&&!e.some((function(n){return n._id===r}))&&(console.log("清空失效的选中状态"),n.setData({selectedFolderId:""})),n.setData({folders:e,isLoading:!1})}else{var a;uni.showToast({title:(null===(a=t.result)||void 0===a?void 0:a.message)||"加载失败",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})}})).catch((function(t){console.error("获取收藏夹失败:",t),uni.showToast({title:"网络错误",icon:"none"}),n.setData({isLoading:!1,folders:[],selectedFolderId:""})})):this.setData({isLoading:!1,folders:[],selectedFolderId:""})},selectFolder:function(n){var t=n.currentTarget.dataset.folderId;this.setData({selectedFolderId:t})},confirmFavorite:function(){var n=this,t=this.selectedFolderId,r=this.postId;if(console.log("确认收藏，postId:",r,"folderId:",t),t){if(!r)return console.error("postId 为空，无法收藏"),void uni.showToast({title:"参数错误：帖子ID为空",icon:"none"});var a=this.$requireOpenid&&this.$requireOpenid();a&&(uni.showLoading({title:"收藏中..."}),this.callCloudFunction("getMyProfileData",{action:"addToFavorite",postId:r,folderId:t,openid:a}).then((function(t){if(uni.hideLoading(),console.log("确认收藏返回结果:",t),t&&t.result)if(t.result.success){uni.showToast({title:"收藏成功"}),console.log("收藏成功，开始关闭弹窗"),n.setData({selectedFolderId:""}),setTimeout((function(){n.hideModal()}),1500),n.$emit("favoriteSuccess");try{var a=getApp(),o=a&&a.globalData&&a.globalData.openid,i=e("2729"),s=i.emitFavoriteChanged;s({userId:o,postId:r,favored:!0})}catch(l){}}else console.error("收藏业务失败:",t.result),uni.showToast({title:t.result.message||"收藏失败",icon:"none"});else console.error("收藏返回格式异常:",t),uni.showToast({title:"收藏失败：返回格式错误",icon:"none"})})).catch((function(n){uni.hideLoading(),console.error("收藏云函数调用失败:",n),uni.showToast({title:"网络错误："+(n.errMsg||"未知错误"),icon:"none"})})))}else uni.showToast({title:"请选择收藏夹",icon:"none"})},createFolder:function(){this.setData({showCreateModal:!0,newFolderName:""})},hideCreateModal:function(){this.setData({showCreateModal:!1,newFolderName:""})},onFolderNameInput:function(n){var t=n.detail.value;this.setData({newFolderName:t})},createNewFolder:function(){var n=this,t=this.newFolderName.trim();if(t){this.setData({newFolderName:t}),console.log("组件开始创建收藏夹，名称:",t);var e=this.$requireOpenid&&this.$requireOpenid();e&&(uni.showLoading({title:"创建中..."}),this.callCloudFunction("getMyProfileData",{action:"createFavoriteFolder",folderName:t,openid:e}).then((function(t){uni.hideLoading(),console.log("组件创建收藏夹返回结果:",t),t&&t.result?t.result.success?(uni.showToast({title:"创建成功",duration:2e3}),n.setData({showCreateModal:!1}),setTimeout((function(){n.loadFolders()}),300)):(console.error("组件创建收藏夹业务失败:",t.result),uni.showToast({title:t.result.message||"创建失败",icon:"none",duration:3e3})):(console.error("组件创建收藏夹返回格式异常:",t),uni.showToast({title:"创建失败：返回格式错误",icon:"none",duration:3e3}))})).catch((function(n){uni.hideLoading(),console.error("组件创建收藏夹云函数调用失败:",n),uni.showToast({title:"创建失败: "+(n.errMsg||"网络错误"),icon:"none",duration:3e3})})))}else uni.showToast({title:"请输入收藏夹名称",icon:"none"})},hideModal:function(){console.log("=== 点击关闭按钮，开始隐藏弹窗 ==="),console.log("当前状态：",{show:this.show,showCreateModal:this.showCreateModal,selectedFolderId:this.selectedFolderId}),this.setData({selectedFolderId:"",showClone:!1,showCreateModal:!1,newFolderName:""}),console.log("=== 弹窗已隐藏，状态已重置 ==="),this.$emit("hide")},trueFun:function(){console.log("占位：函数 true 未声明")}},created:function(){}};t.default=s},"84aa":function(n,t,e){"use strict";e("6a54");var r=e("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(e("39d8")),o=r(e("2634")),i=r(e("2fdc"));e("5c47"),e("8f71"),e("bf0f"),e("5ef2"),e("2797"),e("c223"),e("7a76"),e("c9b5");var s=r(e("724b")),l=r(e("71b6")),d=r(e("c4b7")),c=r(e("71b6")),u=r(e("c107")),f=e("38db"),v=f.cloudCall,p=e("9167"),h={onShow:function(){try{uni.hideTabBar({animation:!1})}catch(a){}try{this.$refs.customTabBar&&this.$refs.customTabBar.syncSelected&&this.$refs.customTabBar.syncSelected()}catch(a){}var n=uni.getStorageSync("shouldRefreshIndex"),t=uni.getStorageSync("shouldRefreshProfile"),e=uni.getStorageSync("shouldRefreshPoem"),r=uni.getStorageSync("shouldRefreshMountain");(n||t||e||r)&&(console.log("【mountain】检测到需要刷新标记，开始刷新山页面数据:",{shouldRefreshIndex:n,shouldRefreshProfile:t,shouldRefreshPoem:e,shouldRefreshMountain:r}),uni.removeStorageSync("shouldRefreshIndex"),uni.removeStorageSync("shouldRefreshProfile"),uni.removeStorageSync("shouldRefreshPoem"),uni.removeStorageSync("shouldRefreshMountain"),this.getIndexData())},components:{skeleton:l.default,topBar:d.default,AppTabBar:s.default},data:function(){return{postList:[],page:0,hasMore:!0,isLoading:!0,isLoadingMore:!1,lastUsedColorIndex:-1,backgroundColors:["#a4c4bd","#c9cfcf","#906161","#909388"],showPageIndicator:!1,votingInProgress:{},fetchingSignatures:{}}},onLoad:function(){this.getIndexData()},onPullDownRefresh:function(){console.log("【mountain】📱 下拉刷新，重新获取数据"),this.getIndexData((function(){uni.stopPullDownRefresh()}))},onPageScroll:function(n){var t=this;this._scrollTimer&&clearTimeout(this._scrollTimer),this._scrollTimer=setTimeout((function(){if(t.hasMore&&!t.isLoadingMore&&!t.isLoading)try{var e=uni.getSystemInfoSync(),r=e.windowHeight;uni.createSelectorQuery().in(t).select("#post-list-container").boundingClientRect((function(e){if(e&&e.height){var a=e.height-n.scrollTop-r,o=1.5*r;a<o&&(t.showPageIndicator=!0,t.getPostList((function(){t.showPageIndicator=!1})))}})).exec()}catch(a){}}),100)},methods:{callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return v(n,t,Object.assign({pageTag:"mountain",context:this,requireAuth:!1},e))},getIndexData:function(){var n=this;this.isLoading=!0,this.page=0,this.postList=[],this.getPostList((function(){n.isLoading=!1}))},generateRandomBackgroundColor:function(){var n=this.backgroundColors,t=this.lastUsedColorIndex;if(-1===t){var e=Math.floor(Math.random()*n.length);return this.lastUsedColorIndex=e,n[e]}var r=n.filter((function(n,e){return e!==t})),a=r[Math.floor(Math.random()*r.length)];return this.lastUsedColorIndex=n.indexOf(a),a},getPostList:function(n){var t=this;return(0,i.default)((0,o.default)().mark((function e(){var r,a;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.isLoadingMore){e.next=2;break}return e.abrupt("return");case 2:return t.isLoadingMore=!0,e.prev=3,e.next=6,t.callCloudFunction("getPostList",{skip:10*t.page,limit:10,isPoem:!0,isOriginal:!1});case 6:r=e.sent,a=r&&r.result&&r.result.posts?r.result.posts:[],a.forEach((function(n){n.backgroundColor=t.generateRandomBackgroundColor(),n.textColor="#222",n.isExpanded=!1,n.authorSignature="",n.likeIcon=p&&p.getLikeIcon?p.getLikeIcon(n.votes||0,!!n.isVoted):""})),t.postList=0===t.page?a:t.postList.concat(a),t.page+=1,t.hasMore=10===a.length,t.postList.forEach((function(n,e){n._openid&&!n.authorSignature&&t.fetchAuthorSignature(n._openid,e)})),e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](3),uni.showToast({title:"加载失败",icon:"none"});case 18:return e.prev=18,t.isLoadingMore=!1,"function"===typeof n&&n(),e.finish(18);case 22:case"end":return e.stop()}}),e,null,[[3,15,18,22]])})))()},togglePostExpansion:function(n){var t=n.currentTarget.dataset.index,e=this.postList[t],r=!e.isExpanded;this.setData((0,a.default)({},"postList[".concat(t,"].isExpanded"),r)),e._openid&&!e.authorSignature&&this.fetchAuthorSignature(e._openid,t)},onCommentClick:function(n){var t=n.currentTarget.dataset.postid;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},onLikeIconError:function(){},fetchAuthorSignature:function(n,t){var e=this;return(0,i.default)((0,o.default)().mark((function r(){var i,s;return(0,o.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n&&!e.fetchingSignatures[n]){r.next=2;break}return r.abrupt("return");case 2:return e.fetchingSignatures[n]=!0,r.prev=3,r.next=6,e.callCloudFunction("getUserProfile",{userId:n});case 6:i=r.sent,i.result&&i.result.success&&i.result.userInfo&&i.result.userInfo.signatureUrl?(s=i.result.userInfo.signatureUrl,console.log("【mountain】获取到作者签名:",s),e.setData((0,a.default)({},"postList[".concat(t,"].authorSignature"),s))):(console.log("【mountain】作者未设置签名"),e.setData((0,a.default)({},"postList[".concat(t,"].authorSignature"),""))),r.next=14;break;case 10:r.prev=10,r.t0=r["catch"](3),console.error("【mountain】获取作者签名失败:",r.t0),e.setData((0,a.default)({},"postList[".concat(t,"].authorSignature"),""));case 14:return r.prev=14,delete e.fetchingSignatures[n],r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},onSignatureLoad:function(n){console.log("【mountain】签名图片加载成功:",n)},onSignatureError:function(n){console.error("【mountain】签名图片加载失败:",n)},onVote:function(n){var t=this;return(0,i.default)((0,o.default)().mark((function e(){var r,i,s,l,d,c;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=n.currentTarget.dataset.postid,i=n.currentTarget.dataset.index,!t.votingInProgress[r]){e.next=4;break}return e.abrupt("return");case 4:return t.setData((0,a.default)({},"votingInProgress.".concat(r),!0)),s=t.postList,l=s[i].votes||0,d=!!s[i].isVoted,s[i].votes=d?l-1:l+1,s[i].isVoted=!d,s[i].likeIcon=p.getLikeIcon(s[i].votes,s[i].isVoted),t.setData({postList:s}),e.prev=12,e.next=15,t.callCloudFunction("vote",{postId:r});case 15:if(c=e.sent,c&&c.result&&c.result.success){e.next=18;break}throw new Error("vote failed");case 18:"number"===typeof c.result.votes&&c.result.votes!==s[i].votes&&t.setData((0,a.default)({},"postList[".concat(i,"].votes"),c.result.votes)),e.next=28;break;case 21:e.prev=21,e.t0=e["catch"](12),s[i].votes=l,s[i].isVoted=d,s[i].likeIcon=p.getLikeIcon(l,d),t.setData({postList:s}),uni.showToast({title:"操作失败",icon:"none"});case 28:return e.prev=28,t.setData((0,a.default)({},"votingInProgress.".concat(r),!1)),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[12,21,28,31]])})))()},touchStart:function(){},touchEnd:function(){}}};t.default=h,t.default.components=Object.assign({skeleton:c.default,"folder-selector":u.default},t.default.components||{})},9755:function(n,t,e){var r=e("c86c");t=r(!1),t.push([n.i,".white-bg[data-v-57a69c4a]{background:#fff;min-height:100vh}.square-mode-container[data-v-57a69c4a]{padding:%?40?%;margin-bottom:%?200?%;padding-top:%?80?% /* 减少上边距 */}.empty-state[data-v-57a69c4a]{text-align:center;padding:%?100?% 0;color:#999}.empty-icon[data-v-57a69c4a]{font-size:%?80?%;margin-bottom:%?20?%}.empty-text[data-v-57a69c4a]{font-size:%?32?%;margin-bottom:%?10?%;color:#666}.empty-subtext[data-v-57a69c4a]{font-size:%?24?%;color:#999}.post-item-wrapper[data-v-57a69c4a]{border-radius:%?40?%;margin-bottom:%?60?%;overflow:hidden;border:%?1?% solid #e9ecef;box-shadow:0 %?12?% %?15?% rgba(0,0,0,.2);transition:-webkit-transform .3s ease;transition:transform .3s ease;transition:transform .3s ease,-webkit-transform .3s ease}.post-item-wrapper[data-v-57a69c4a]:active{-webkit-transform:scale(.98);transform:scale(.98)}.post-content-navigator[data-v-57a69c4a]{display:block}.post-item[data-v-57a69c4a]{padding:%?40?% %?50?%;position:relative}.post-content[data-v-57a69c4a]{font-size:%?32?%;line-height:1.6;margin:%?30?% 0;width:100%}\r\n/* 折叠态：多端兼容的三行裁切（参考原始小程序实现） */.post-content.collapsed[data-v-57a69c4a]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden;text-overflow:ellipsis}.post-content.expanded[data-v-57a69c4a]{display:block;overflow:visible}.comment-emoji[data-v-57a69c4a]{font-size:%?40?%}.vote-section[data-v-57a69c4a]{display:flex;justify-content:space-between;align-items:center;padding:%?25?% %?50?%}.actions-left[data-v-57a69c4a]{flex:1;display:flex;align-items:center;gap:%?20?%}.button-group[data-v-57a69c4a]{display:flex;align-items:center;gap:%?30?%}.comment-count[data-v-57a69c4a]{display:flex;align-items:center;gap:%?8?%;padding:%?10?% %?15?%}.vote-count[data-v-57a69c4a]{display:flex;align-items:center;gap:%?8?%;padding:%?10?% %?15?%;border-radius:%?20?%;background:hsla(0,0%,100%,.9);box-shadow:0 %?2?% %?8?% rgba(0,0,0,.1)}.comment-icon[data-v-57a69c4a]{width:%?80?%;height:%?80?%}.like-icon[data-v-57a69c4a]{width:%?60?%;height:%?60?%;margin-top:5px}\r\n/* 用户签名样式 */.user-signature[data-v-57a69c4a]{position:absolute;bottom:%?-25?%; /* 从15rpx往下移动40rpx */right:%?60?%;z-index:10;pointer-events:none /* 防止签名影响点击事件 */}.signature-image[data-v-57a69c4a]{width:%?180?%;height:%?90?%;opacity:.8; /* 稍微透明，不抢夺主要内容的注意力 */-webkit-filter:drop-shadow(0 %?2?% %?4?% rgba(0,0,0,.1));filter:drop-shadow(0 %?2?% %?4?% rgba(0,0,0,.1)); /* 添加轻微阴影 */display:block; /* 确保图片正确显示 */background:transparent /* 确保背景透明 */}\r\n/* 小签名样式 - 折叠状态下显示 */.user-signature-small[data-v-57a69c4a]{position:absolute;bottom:%?30?%;right:%?60?%;z-index:10;pointer-events:none /* 防止签名影响点击事件 */}.signature-image-small[data-v-57a69c4a]{width:%?100?%;height:%?50?%;opacity:.6; /* 更透明，不抢夺主要内容的注意力 */-webkit-filter:drop-shadow(0 %?1?% %?2?% rgba(0,0,0,.1));filter:drop-shadow(0 %?1?% %?2?% rgba(0,0,0,.1)); /* 添加轻微阴影 */display:block; /* 确保图片正确显示 */background:transparent /* 确保背景透明 */}.loading-footer[data-v-57a69c4a]{text-align:center;color:#666;padding:%?30?% 0 %?120?%}.page-indicator[data-v-57a69c4a]{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background:rgba(0,0,0,.7);color:#fff;padding:%?20?% %?40?%;border-radius:%?40?%;z-index:1000;font-size:%?28?%}.page-indicator-text[data-v-57a69c4a]{text-align:center}",""]),n.exports=t},"982d":function(n,t,e){var r=e("7a2f");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[n.i,r,""]]),r.locals&&(n.exports=r.locals);var a=e("967d").default;a("3928eb3b",r,!0,{sourceMap:!1,shadowMode:!1})},b89d:function(n,t,e){"use strict";e.d(t,"b",(function(){return r})),e.d(t,"c",(function(){return a})),e.d(t,"a",(function(){}));var r=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[n.showClone?e("v-uni-view",{staticClass:"modal-overlay"},[e("v-uni-view",{staticClass:"modal-content"},[e("v-uni-view",{staticClass:"modal-header"},[e("v-uni-view",{staticClass:"modal-title"},[n._v("选择收藏夹")]),e("v-uni-view",{staticClass:"close-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.hideModal.apply(void 0,arguments)}}},[n._v("×")])],1),e("v-uni-view",{staticClass:"modal-body"},[n.isLoading?e("v-uni-view",{staticClass:"loading-container"},[e("v-uni-view",{staticClass:"loading-text"},[n._v("加载中...")])],1):n.folders.length>0?e("v-uni-view",{staticClass:"folders-list"},n._l(n.folders,(function(t,r){return e("v-uni-view",{key:r,class:"folder-item "+(n.selectedFolderId===t._id?"selected":""),attrs:{"data-folder-id":t._id},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.selectFolder.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"folder-icon"},[n._v("📁")]),e("v-uni-view",{staticClass:"folder-info"},[e("v-uni-view",{staticClass:"folder-name"},[n._v(n._s(t.name))]),e("v-uni-view",{staticClass:"folder-count"},[n._v(n._s(t.itemCount)+" 个收藏")])],1),n.selectedFolderId===t._id?e("v-uni-view",{staticClass:"selected-icon"},[n._v("✓")]):n._e()],1)})),1):e("v-uni-view",{staticClass:"empty-state"},[e("v-uni-view",{staticClass:"empty-icon"},[n._v("📁")]),e("v-uni-view",{staticClass:"empty-text"},[n._v("还没有收藏夹")]),e("v-uni-view",{staticClass:"empty-subtext"},[n._v("先创建一个收藏夹吧")])],1)],1),e("v-uni-view",{staticClass:"modal-footer"},[e("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.createFolder.apply(void 0,arguments)}}},[n._v("创建收藏夹")]),e("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.selectedFolderId},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.confirmFavorite.apply(void 0,arguments)}}},[n._v("确认收藏")])],1)],1)],1):n._e(),n.showCreateModal?e("v-uni-view",{staticClass:"modal-overlay"},[e("v-uni-view",{staticClass:"modal-content create-modal"},[e("v-uni-view",{staticClass:"modal-header"},[e("v-uni-view",{staticClass:"modal-title"},[n._v("创建收藏夹")]),e("v-uni-view",{staticClass:"close-btn",on:{click:[function(t){arguments[0]=t=n.$handleEvent(t),n.hideCreateModal.apply(void 0,arguments)},function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.trueFun.apply(void 0,arguments)}]}},[n._v("×")])],1),e("v-uni-view",{staticClass:"modal-body"},[e("v-uni-input",{staticClass:"folder-name-input",attrs:{placeholder:"请输入收藏夹名称",value:n.newFolderName,focus:!0},on:{input:function(t){arguments[0]=t=n.$handleEvent(t),n.onFolderNameInput.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=n.$handleEvent(t),n.trueFun.apply(void 0,arguments)}}})],1),e("v-uni-view",{staticClass:"modal-footer"},[e("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.hideCreateModal.apply(void 0,arguments)}}},[n._v("取消")]),e("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!n.newFolderName},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.createNewFolder.apply(void 0,arguments)}}},[n._v("创建")])],1)],1)],1):n._e()],1)},a=[]},c107:function(n,t,e){"use strict";e.r(t);var r=e("b89d"),a=e("44f3");for(var o in a)["default"].indexOf(o)<0&&function(n){e.d(t,n,(function(){return a[n]}))}(o);e("e9a0");var i=e("828b"),s=Object(i["a"])(a["default"],r["b"],r["c"],!1,null,"3a05c372",null,!1,r["a"],void 0);t["default"]=s.exports},e036:function(n,t,e){"use strict";var r=e("2d42"),a=e.n(r);a.a},e9a0:function(n,t,e){"use strict";var r=e("982d"),a=e.n(r);a.a}}]);