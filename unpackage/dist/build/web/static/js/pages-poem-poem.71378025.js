(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-poem-poem"],{3255:function(e,t,n){var o=n("d242");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=n("967d").default;a("8455b0aa",o,!0,{sourceMap:!1,shadowMode:!1})},4620:function(e,t,n){"use strict";var o=n("f0ff"),a=n.n(o);a.a},"51ad":function(e,t,n){"use strict";n.r(t);var o=n("9a0c"),a=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=a.a},"84be":function(e,t,n){"use strict";n.r(t);var o=n("b348"),a=n("daaa");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("9820");var i=n("828b"),s=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,"3a05c372",null,!1,o["a"],void 0);t["default"]=s.exports},"8f08":function(e,t,n){"use strict";n.r(t);var o=n("d31a"),a=n("51ad");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("4620");var i=n("828b"),s=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,"60133a98",null,!1,o["a"],void 0);t["default"]=s.exports},9820:function(e,t,n){"use strict";var o=n("3255"),a=n.n(o);a.a},"9a0c":function(e,t,n){"use strict";n("6a54");var o=n("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("39d8"));n("bf0f"),n("2797"),n("c223"),n("4626"),n("5ac7");var r=o(n("8cb3")),i=o(n("84be")),s=o(n("8cb3")),l=o(n("84be")),c=n("11ca"),d=c.cloudCall,u=n("2b90"),g={components:{skeleton:r.default,folderSelector:i.default},mixins:[u],data:function(){return{isLoading:!0,postList:[],currentPostIndex:0,touchStartX:0,touchEndX:0,touchStartY:0,touchEndY:0,hasMore:!0,page:0,backgroundImage:"",isTransitioning:!1,preloadedImages:{},hasFirstLoad_var:!1,currentPost:null,bgLayers:[{url:"",visible:!1},{url:"",visible:!1}],activeLayerIndex:0,swiperHeights:{},imageClampHeights:{},currentAuthorSignature:"",currentAuthorOpenid:"",isFetchingSignature:!1,selected:0,url:"",visible:!1}},onLoad:function(){console.log("Poem 页面 onLoad");var e=getApp();e.globalData.preloadedPoemData&&e.globalData.preloadedPoemData.length>0?(console.log("Poem: 使用预加载数据"),this.setData({postList:e.globalData.preloadedPoemData,isLoading:!1,page:1,hasFirstLoad_var:!0}),this.updatePostDisplay(0),e.globalData.preloadedPoemData=null,this._hasFirstLoad=!0):(console.log("Poem: 无预加载数据，开始请求"),this.getPostList())},onShow:function(){var e=n("d87a"),t=e.updateTabBarStatus;t(this,1);try{var o=uni.getStorageSync("shouldRefreshPoem");if(o)return console.log("【poem】检测到发布标记，刷新数据"),uni.removeStorageSync("shouldRefreshPoem"),void this.refreshPoemData()}catch(a){console.log("CatchClause",a),console.log("CatchClause",a),console.error("检查刷新标记失败:",a)}this._hasFirstLoad?console.log("【poem】再次进入，保持之前内容"):(console.log("【poem】首次进入，刷新数据"),this._hasFirstLoad=!0,0===this.postList.length&&this.refreshPoemData())},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(e,t,Object.assign({pageTag:"poem",context:this},n))},refreshPoemData:function(){console.log("【poem】开始刷新诗歌数据"),this.setData({postList:[],currentPostIndex:0,page:0,hasMore:!0,isLoading:!1,bgLayers:[{url:"",visible:!1},{url:"",visible:!1}],activeLayerIndex:0}),this.getPostList()},fetchAuthorSignature:function(e){var t=this;if(!e)return console.log("【poem】作者openid为空，不获取签名"),void this.setData({currentAuthorSignature:""});if(this.currentAuthorOpenid===e&&this.isFetchingSignature)console.log("【poem】正在获取该作者签名，跳过重复调用");else if(this.currentAuthorOpenid===e&&this.currentAuthorSignature)console.log("【poem】该作者签名已存在，跳过重复获取");else{var n;if(console.log("【poem】获取作者签名信息，openid:",e),this.setData({isFetchingSignature:!0,currentAuthorOpenid:e}),this.$tcb&&this.$tcb.database)n=this.$tcb.database(),console.log("【poem】使用TCB数据库实例");else{if("undefined"===typeof wx||!wx.cloud||!wx.cloud.database)return console.error("【poem】无法获取数据库实例，$tcb和wx.cloud都不可用"),void this.setData({currentAuthorSignature:"",isFetchingSignature:!1});n=wx.cloud.database(),console.log("【poem】使用微信云数据库实例")}n.collection("users").where({_openid:e}).get().then((function(e){if(console.log("【poem】直接查询数据库结果:",e),e.data&&e.data.length>0){var n=e.data[0];console.log("【poem】数据库中的用户信息:",n),n.signatureUrl?(console.log("【poem】数据库中找到签名:",n.signatureUrl),t.setData({currentAuthorSignature:n.signatureUrl,isFetchingSignature:!1})):(console.log("【poem】数据库中用户没有设置签名"),t.setData({currentAuthorSignature:"",isFetchingSignature:!1}))}else console.log("【poem】数据库中未找到用户"),t.setData({currentAuthorSignature:"",isFetchingSignature:!1})})).catch((function(e){console.error("【poem】直接查询数据库失败:",e),t.setData({currentAuthorSignature:"",isFetchingSignature:!1})})),this.callCloudFunction("getUserProfile",{userId:e}).then((function(e){if(console.log("【poem】getUserProfile返回结果:",e),e.result&&e.result.success&&e.result.userInfo){var n=e.result.userInfo;console.log("【poem】作者信息:",n),n.signatureUrl?(console.log("【poem】获取到作者签名:",n.signatureUrl),t.setData({currentAuthorSignature:n.signatureUrl,isFetchingSignature:!1}),console.log("【poem】作者签名已设置到data中")):(console.log("【poem】作者未设置签名，signatureUrl为空"),t.setData({currentAuthorSignature:"",isFetchingSignature:!1}))}else console.log("【poem】获取作者信息失败或数据格式错误"),t.setData({currentAuthorSignature:"",isFetchingSignature:!1})})).catch((function(e){console.error("【poem】获取作者签名失败:",e),t.setData({currentAuthorSignature:"",isFetchingSignature:!1})}))}},onSignatureLoad:function(e){console.log("【poem】签名图片加载成功:",e)},onSignatureError:function(e){console.error("【poem】签名图片加载失败:",e)},getPostList:function(e){var t=this;if(console.log("🔍 [Poem] getPostList 开始调用"),console.log("🔍 [Poem] 当前状态 - isLoading:",this.isLoading,"page:",this.page),this.isLoading)console.log("🔍 [Poem] 正在加载中，跳过重复调用");else{this.setData({isLoading:!0});var n=5*this.page;console.log("🔍 [Poem] 请求参数 - skip:",n,"page:",this.page,"PAGE_SIZE:",5),console.log("🔍 [Poem] 开始调用云函数 getPostList"),console.log("🔍 [Poem] 云函数参数:",{skip:n,limit:5,isPoem:!0,isOriginal:!0}),this.callCloudFunction("getPostList",{skip:n,limit:5,isPoem:!0,isOriginal:!0}).then((function(e){if(console.log("✅ [Poem] 云函数调用成功，原始响应:",e),e.result&&e.result.success){var n=e.result.posts||[];console.log("✅ [Poem] 获取到路诗歌数量:",n.length),console.log("✅ [Poem] 完整响应数据:",e.result),n.length>0?(console.log("🔍 [Poem] 诗歌数据详情:"),n.forEach((function(e,t){console.log("📝 [Poem] 诗歌".concat(t+1,":"),{_id:e._id,title:e.title,isPoem:e.isPoem,isOriginal:e.isOriginal,content:e.content?e.content.substring(0,50)+"...":"无内容",authorName:e.authorName,createTime:e.createTime})}))):console.log("⚠️ [Poem] 没有获取到任何诗歌数据"),n.forEach((function(e){e.imageUrls&&0!==e.imageUrls.length||(e.imageUrls=e.imageUrl?[e.imageUrl]:[])}));var o=0===t.page?n:t.postList.concat(n);console.log("✅ [Poem] 更新后的postList长度:",o.length),t.setData({postList:o,page:t.page+1,hasMore:5===n.length}),1===t.page&&o.length>0?(console.log("🎯 [Poem] 首次加载，显示第一个诗歌"),console.log("🎯 [Poem] 第一个诗歌详情:",{title:o[0].title,imageUrls:o[0].imageUrls,poemBgImage:o[0].poemBgImage,hasBgImage:!!o[0].poemBgImage}),t.updatePostDisplay(0),o.length>1&&(console.log("🔍 [Poem] 预加载第2张图片"),t.loadImageForIndex(1)),o.length>2&&(console.log("🔍 [Poem] 预加载第3张图片"),t.loadImageForIndex(2))):console.log("⚠️ [Poem] 未获取到诗歌帖子数据或非首次加载")}else console.error("❌ [Poem] 云函数返回失败:",e.result),uni.showToast({title:"加载失败",icon:"none"})})).catch((function(e){console.error("❌ [Poem] 云函数调用失败:",e),console.error("❌ [Poem] 错误详情:",{message:e.message,stack:e.stack,code:e.code}),uni.showToast({title:"网络错误",icon:"none"})})).finally((function(){console.log("🔍 [Poem] 云函数调用完成，设置loading为false"),t.setData({isLoading:!1,hasFirstLoad_var:!0}),"function"===typeof e&&e()}))}},touchStart:function(e){this.setData({touchStartX:e.touches[0].clientX,touchStartY:e.touches[0].clientY})},touchEnd:function(e){var t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,o=this.touchStartX-t,a=this.touchStartY-n,r=Math.sqrt(o*o+a*a),i=Math.abs(180*Math.atan2(Math.abs(a),Math.abs(o))/Math.PI);r>80&&Math.abs(o)>50&&i<45&&(o>0?this.nextPost():this.prevPost())},nextPost:function(){var e=this;this.currentPostIndex<this.postList.length-1?(this.setData({isTransitioning:!0}),this.updatePostDisplay(this.currentPostIndex+1),setTimeout((function(){e.setData({isTransitioning:!1})}),500)):this.hasMore&&!this.isLoading&&this.loadMorePosts((function(){e.postList.length>e.currentPostIndex+1&&e.updatePostDisplay(e.currentPostIndex+1)}))},prevPost:function(){var e=this;this.currentPostIndex>0&&(this.setData({isTransitioning:!0}),this.updatePostDisplay(this.currentPostIndex-1),setTimeout((function(){e.setData({isTransitioning:!1})}),500))},onSinglePostTap:function(e){var t=e.currentTarget.dataset.postid;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},onImageError:function(e){console.error("图片加载失败",e.detail)},loadMorePosts:function(e){var t=this;if(!this.isLoading){var n=5*this.page;console.log("开始加载更多路诗歌，skip:",n,"page:",this.page),this.callCloudFunction("getPostList",{skip:n,limit:5,isPoem:!0,isOriginal:!0}).then((function(e){if(console.log("加载更多路诗歌结果:",e),e.result&&e.result.success){var n=e.result.posts||[];console.log("获取到更多路诗歌数量:",n.length),n.forEach((function(e){e.imageUrls&&0!==e.imageUrls.length||(e.imageUrls=e.imageUrl?[e.imageUrl]:[])}));var o=t.postList.concat(n);t.setData({postList:o,page:t.page+1,hasMore:5===n.length});var a=t.postList.length-n.length;n.forEach((function(e,n){t.loadImageForIndex(a+n)}))}})).catch((function(e){console.error("加载更多路诗歌失败:",e)})).finally((function(){"function"===typeof e&&e()}))}},preloadNextBackgroundImage:function(e){var t=this,n=e+1;n>=this.postList.length?this.hasMore&&!this.isLoading&&this.loadMorePosts((function(){n<t.postList.length&&t.loadImageForIndex(n)})):(console.log("开始预加载第".concat(n+1,"张图片")),this.loadImageForIndex(n))},resetBackgroundLayers:function(){this.setData({"bgLayers[0].url":"","bgLayers[0].visible":!1,"bgLayers[1].url":"","bgLayers[1].visible":!1,activeLayerIndex:0})},updatePostDisplay:function(e){var t=this;if(!(e<0||e>=this.postList.length)){var n=this.postList[e];if(n){this.setData({currentPost:n,currentPostIndex:e}),this.fetchAuthorSignature(n._openid);var o=n.poemBgImage||n.imageUrls&&n.imageUrls[0]||"";if(!o)return this.resetBackgroundLayers(),void this.preloadNextBackgroundImage(e);var r=this.preloadedImages[o];if(!r){var i=getApp();i.globalData.preloadedImages&&i.globalData.preloadedImages[o]?(r=i.globalData.preloadedImages[o],this.setData((0,a.default)({},"preloadedImages.".concat(o),r))):r=o}var s=""===this.bgLayers[0].url&&""===this.bgLayers[1].url;s?(console.log("首次显示背景图，直接设置第一个图层"),this.setData({"bgLayers[0].url":r,"bgLayers[0].visible":!0,"bgLayers[1].visible":!1,activeLayerIndex:0}),console.log("首次显示完成，立即预加载第二张图片"),this.preloadNextBackgroundImage(e)):(setTimeout((function(){t.switchBackgroundImage(r)}),100),this.preloadNextBackgroundImage(e))}}},switchBackgroundImage:function(e){var t=this;if(e){var n=this.preloadedImages[e],o=n||e;console.log("切换背景图:",{originalUrl:e,preloadedUrl:n,finalUrl:o,hasPreloaded:!!n});var r=this.activeLayerIndex,i=(r+1)%2;this.setData((0,a.default)({},"bgLayers[".concat(i,"].url"),o)),setTimeout((function(){var e;t.setData((e={},(0,a.default)(e,"bgLayers[".concat(r,"].visible"),!1),(0,a.default)(e,"bgLayers[".concat(i,"].visible"),!0),(0,a.default)(e,"activeLayerIndex",i),e))}),n?50:150)}else this.resetBackgroundLayers()},onBackgroundImageLoad:function(e){var t=e.currentTarget.dataset.layerIndex;console.log("图层".concat(t,"图片加载完成"))},loadImageForIndex:function(e,t){var n=this,o=this.postList[e];if(o){var r=o.poemBgImage||o.imageUrls&&o.imageUrls[0]||"";if(r){var i=getApp();if(i.globalData.preloadedImages&&i.globalData.preloadedImages[r])return console.log("第".concat(e+1,"张图片：使用全局预加载缓存")),this.setData((0,a.default)({},"preloadedImages.".concat(r),i.globalData.preloadedImages[r])),void("function"===typeof t&&t(i.globalData.preloadedImages[r]));if(this.preloadedImages[r])console.log("第".concat(e+1,"张图片：已存在本地缓存"));else{console.log("第".concat(e+1,"张图片：开始下载预加载"));var s="undefined"!==typeof window;if(s&&(r.includes("tcb.qcloud.la")||r.includes("cloudbase")))return console.log("🔍 [H5] 第".concat(e+1,"张图片检测到腾讯云存储URL，直接使用:"),r),this.setData((0,a.default)({},"preloadedImages.".concat(r),r)),void("function"===typeof t&&t(r));uni.downloadFile({url:r,success:function(o){200===o.statusCode?(console.log("第".concat(e+1,"张图片：预加载成功")),n.setData((0,a.default)({},"preloadedImages.".concat(r),o.tempFilePath)),"function"===typeof t&&t(o.tempFilePath)):console.error("第".concat(e+1,"张图片：下载失败，状态码:"),o.statusCode)},fail:function(o){console.error("第".concat(e+1,"张图片：预加载失败:"),o);var i="undefined"!==typeof window;i&&(console.log("🔍 [H5] 第".concat(e+1,"张图片预加载失败，使用原URL:"),r),n.setData((0,a.default)({},"preloadedImages.".concat(r),r)),"function"===typeof t&&t(r))}})}}else console.log("第".concat(e+1,"张图片：没有图片URL"))}else console.log("第".concat(e+1,"张图片：帖子数据不存在"))}}};t.default=g,t.default.components=Object.assign({skeleton:s.default,"folder-selector":l.default},t.default.components||{})},"9d3a":function(e,t,n){"use strict";n("6a54");var o=n("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("bf0f"),n("0c26");var a=o(n("39d8")),r=n("11ca"),i=r.cloudCall,s={data:function(){return{folders:[],isLoading:!0,selectedFolderId:"",showCreateModal:!1,newFolderName:"",showClone:!1}},props:{show:{type:Boolean,default:!1},postId:{type:String,default:""}},watch:(0,a.default)({show:function(e){e&&this.loadFolders()}},"show",{handler:function(e,t){this.showClone=e},immediate:!0}),methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(e,t,Object.assign({pageTag:"folder-selector",context:this,requireAuth:!0},n))},loadFolders:function(){var e=this;console.log("开始加载收藏夹列表..."),this.setData({isLoading:!0});var t=this.$requireOpenid&&this.$requireOpenid();t?this.callCloudFunction("getMyProfileData",{action:"getFavoriteFolders",openid:t}).then((function(t){if(console.log("folder-selector获取收藏夹:",t),t.result&&t.result.success){var n=t.result.folders||[];console.log("获取到收藏夹数量:",n.length);var o=e.selectedFolderId;o&&!n.some((function(e){return e._id===o}))&&(console.log("清空失效的选中状态"),e.setData({selectedFolderId:""})),e.setData({folders:n,isLoading:!1})}else{var a;uni.showToast({title:(null===(a=t.result)||void 0===a?void 0:a.message)||"加载失败",icon:"none"}),e.setData({isLoading:!1,folders:[],selectedFolderId:""})}})).catch((function(t){console.error("获取收藏夹失败:",t),uni.showToast({title:"网络错误",icon:"none"}),e.setData({isLoading:!1,folders:[],selectedFolderId:""})})):this.setData({isLoading:!1,folders:[],selectedFolderId:""})},selectFolder:function(e){var t=e.currentTarget.dataset.folderId;this.setData({selectedFolderId:t})},confirmFavorite:function(){var e=this,t=this.selectedFolderId,o=this.postId;if(console.log("确认收藏，postId:",o,"folderId:",t),t){if(!o)return console.error("postId 为空，无法收藏"),void uni.showToast({title:"参数错误：帖子ID为空",icon:"none"});var a=this.$requireOpenid&&this.$requireOpenid();a&&(uni.showLoading({title:"收藏中..."}),this.callCloudFunction("getMyProfileData",{action:"addToFavorite",postId:o,folderId:t,openid:a}).then((function(t){if(uni.hideLoading(),console.log("确认收藏返回结果:",t),t&&t.result)if(t.result.success){uni.showToast({title:"收藏成功"}),console.log("收藏成功，开始关闭弹窗"),e.setData({selectedFolderId:""}),setTimeout((function(){e.hideModal()}),1500),e.$emit("favoriteSuccess");try{var a=getApp(),r=a&&a.globalData&&a.globalData.openid,i=n("80fa"),s=i.emitFavoriteChanged;s({userId:r,postId:o,favored:!0})}catch(l){}}else console.error("收藏业务失败:",t.result),uni.showToast({title:t.result.message||"收藏失败",icon:"none"});else console.error("收藏返回格式异常:",t),uni.showToast({title:"收藏失败：返回格式错误",icon:"none"})})).catch((function(e){uni.hideLoading(),console.error("收藏云函数调用失败:",e),uni.showToast({title:"网络错误："+(e.errMsg||"未知错误"),icon:"none"})})))}else uni.showToast({title:"请选择收藏夹",icon:"none"})},createFolder:function(){this.setData({showCreateModal:!0,newFolderName:""})},hideCreateModal:function(){this.setData({showCreateModal:!1,newFolderName:""})},onFolderNameInput:function(e){var t=e.detail.value;this.setData({newFolderName:t})},createNewFolder:function(){var e=this,t=this.newFolderName.trim();if(t){this.setData({newFolderName:t}),console.log("组件开始创建收藏夹，名称:",t);var n=this.$requireOpenid&&this.$requireOpenid();n&&(uni.showLoading({title:"创建中..."}),this.callCloudFunction("getMyProfileData",{action:"createFavoriteFolder",folderName:t,openid:n}).then((function(t){uni.hideLoading(),console.log("组件创建收藏夹返回结果:",t),t&&t.result?t.result.success?(uni.showToast({title:"创建成功",duration:2e3}),e.setData({showCreateModal:!1}),setTimeout((function(){e.loadFolders()}),300)):(console.error("组件创建收藏夹业务失败:",t.result),uni.showToast({title:t.result.message||"创建失败",icon:"none",duration:3e3})):(console.error("组件创建收藏夹返回格式异常:",t),uni.showToast({title:"创建失败：返回格式错误",icon:"none",duration:3e3}))})).catch((function(e){uni.hideLoading(),console.error("组件创建收藏夹云函数调用失败:",e),uni.showToast({title:"创建失败: "+(e.errMsg||"网络错误"),icon:"none",duration:3e3})})))}else uni.showToast({title:"请输入收藏夹名称",icon:"none"})},hideModal:function(){console.log("=== 点击关闭按钮，开始隐藏弹窗 ==="),console.log("当前状态：",{show:this.show,showCreateModal:this.showCreateModal,selectedFolderId:this.selectedFolderId}),this.setData({selectedFolderId:"",showClone:!1,showCreateModal:!1,newFolderName:""}),console.log("=== 弹窗已隐藏，状态已重置 ==="),this.$emit("hide")},trueFun:function(){console.log("占位：函数 true 未声明")}},created:function(){}};t.default=s},b348:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[e.showClone?n("v-uni-view",{staticClass:"modal-overlay"},[n("v-uni-view",{staticClass:"modal-content"},[n("v-uni-view",{staticClass:"modal-header"},[n("v-uni-view",{staticClass:"modal-title"},[e._v("选择收藏夹")]),n("v-uni-view",{staticClass:"close-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.hideModal.apply(void 0,arguments)}}},[e._v("×")])],1),n("v-uni-view",{staticClass:"modal-body"},[e.isLoading?n("v-uni-view",{staticClass:"loading-container"},[n("v-uni-view",{staticClass:"loading-text"},[e._v("加载中...")])],1):e.folders.length>0?n("v-uni-view",{staticClass:"folders-list"},e._l(e.folders,(function(t,o){return n("v-uni-view",{key:o,class:"folder-item "+(e.selectedFolderId===t._id?"selected":""),attrs:{"data-folder-id":t._id},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.selectFolder.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"folder-icon"},[e._v("📁")]),n("v-uni-view",{staticClass:"folder-info"},[n("v-uni-view",{staticClass:"folder-name"},[e._v(e._s(t.name))]),n("v-uni-view",{staticClass:"folder-count"},[e._v(e._s(t.itemCount)+" 个收藏")])],1),e.selectedFolderId===t._id?n("v-uni-view",{staticClass:"selected-icon"},[e._v("✓")]):e._e()],1)})),1):n("v-uni-view",{staticClass:"empty-state"},[n("v-uni-view",{staticClass:"empty-icon"},[e._v("📁")]),n("v-uni-view",{staticClass:"empty-text"},[e._v("还没有收藏夹")]),n("v-uni-view",{staticClass:"empty-subtext"},[e._v("先创建一个收藏夹吧")])],1)],1),n("v-uni-view",{staticClass:"modal-footer"},[n("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.createFolder.apply(void 0,arguments)}}},[e._v("创建收藏夹")]),n("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!e.selectedFolderId},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.confirmFavorite.apply(void 0,arguments)}}},[e._v("确认收藏")])],1)],1)],1):e._e(),e.showCreateModal?n("v-uni-view",{staticClass:"modal-overlay"},[n("v-uni-view",{staticClass:"modal-content create-modal"},[n("v-uni-view",{staticClass:"modal-header"},[n("v-uni-view",{staticClass:"modal-title"},[e._v("创建收藏夹")]),n("v-uni-view",{staticClass:"close-btn",on:{click:[function(t){arguments[0]=t=e.$handleEvent(t),e.hideCreateModal.apply(void 0,arguments)},function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=e.$handleEvent(t),e.trueFun.apply(void 0,arguments)}]}},[e._v("×")])],1),n("v-uni-view",{staticClass:"modal-body"},[n("v-uni-input",{staticClass:"folder-name-input",attrs:{placeholder:"请输入收藏夹名称",value:e.newFolderName,focus:!0},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.onFolderNameInput.apply(void 0,arguments)},click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=e.$handleEvent(t),e.trueFun.apply(void 0,arguments)}}})],1),n("v-uni-view",{staticClass:"modal-footer"},[n("v-uni-button",{staticClass:"modal-btn secondary-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.hideCreateModal.apply(void 0,arguments)}}},[e._v("取消")]),n("v-uni-button",{staticClass:"modal-btn primary-btn",attrs:{disabled:!e.newFolderName},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.createNewFolder.apply(void 0,arguments)}}},[e._v("创建")])],1)],1)],1):e._e()],1)},a=[]},d242:function(e,t,n){var o=n("c86c");t=o(!1),t.push([e.i,"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* components/folder-selector/folder-selector.wxss */.modal-overlay[data-v-3a05c372]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[data-v-3a05c372]{background:#fff;border-radius:%?16?%;margin:%?40?%;width:calc(100% - %?80?%);max-width:%?600?%;max-height:80vh;display:flex;flex-direction:column}.modal-header[data-v-3a05c372]{display:flex;align-items:center;justify-content:space-between;padding:%?30?% %?40?%;border-bottom:%?1?% solid #f0f0f0}.modal-title[data-v-3a05c372]{font-size:%?36?%;font-weight:500;color:#333}.close-btn[data-v-3a05c372]{font-size:%?48?%;color:#999;line-height:1;position:relative;z-index:1001}.modal-body[data-v-3a05c372]{flex:1;padding:%?20?% 0;max-height:60vh;overflow-y:auto}.loading-container[data-v-3a05c372]{display:flex;justify-content:center;align-items:center;height:%?200?%}.loading-text[data-v-3a05c372]{color:#999;font-size:%?28?%}.folders-list[data-v-3a05c372]{padding:0 %?40?%}.folder-item[data-v-3a05c372]{display:flex;align-items:center;padding:%?24?% 0;border-bottom:%?1?% solid #f8f8f8}.folder-item[data-v-3a05c372]:last-child{border-bottom:none}.folder-item.selected[data-v-3a05c372]{background:rgba(7,193,96,.1);border-radius:%?8?%;padding:%?24?% %?20?%;margin:0 %?-20?%}.folder-icon[data-v-3a05c372]{font-size:%?40?%;margin-right:%?20?%}.folder-info[data-v-3a05c372]{flex:1}.folder-name[data-v-3a05c372]{font-size:%?30?%;color:#333;font-weight:500;margin-bottom:%?4?%}.folder-count[data-v-3a05c372]{font-size:%?24?%;color:#999}.selected-icon[data-v-3a05c372]{font-size:%?32?%;color:#9ed7ee;font-weight:700}.empty-state[data-v-3a05c372]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:%?200?%;padding:%?40?%}.empty-icon[data-v-3a05c372]{font-size:%?60?%;margin-bottom:%?16?%;opacity:.5}.empty-text[data-v-3a05c372]{font-size:%?28?%;color:#666;margin-bottom:%?8?%}.empty-subtext[data-v-3a05c372]{font-size:%?24?%;color:#999}.modal-footer[data-v-3a05c372]{display:flex;gap:%?20?%;padding:%?30?% %?40?%;border-top:%?1?% solid #f0f0f0}.modal-btn[data-v-3a05c372]{flex:1;height:%?80?%;border-radius:%?8?%;font-size:%?28?%;border:none;display:flex;align-items:center;justify-content:center;position:relative;z-index:1001}.secondary-btn[data-v-3a05c372]{background:#f5f5f5;color:#666}.primary-btn[data-v-3a05c372]{background:#9ed7ee;color:#fff}.primary-btn[data-v-3a05c372]:disabled{background:#ccc;color:#999}\r\n/* 创建收藏夹弹窗样式 */.create-modal .modal-body[data-v-3a05c372]{padding:%?40?%}.folder-name-input[data-v-3a05c372]{width:100%;height:%?80?%;padding:0 %?20?%;border:%?2?% solid #e0e0e0;border-radius:%?8?%;font-size:%?30?%;box-sizing:border-box}.folder-name-input[data-v-3a05c372]:focus{border-color:#9ed7ee}",""]),e.exports=t},d31a:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var o={skeleton:n("8cb3").default},a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"container"},[n("v-uni-view",{staticClass:"background-wrapper"},e._l(e.bgLayers,(function(t,o){return n("v-uni-image",{key:o,class:"bg-image "+(t.visible?"visible":""),attrs:{src:t.url,mode:"aspectFill","data-layer-index":o},on:{load:function(t){arguments[0]=t=e.$handleEvent(t),e.onBackgroundImageLoad.apply(void 0,arguments)}}})})),1),n("v-uni-view",{staticClass:"blur-background-wrapper"},e._l(e.bgLayers,(function(t,o){return n("v-uni-image",{key:o,class:"bg-image blur-image "+(t.visible?"visible":""),attrs:{src:t.url,mode:"aspectFill","data-layer-index":o},on:{load:function(t){arguments[0]=t=e.$handleEvent(t),e.onBackgroundImageLoad.apply(void 0,arguments)}}})})),1),e.isLoading&&0===e.postList.length?n("v-uni-view",{staticClass:"skeleton-container"},[n("skeleton"),n("v-uni-view",{staticClass:"loading-text"},[e._v("正在加载诗歌...")])],1):e._e(),e.postList.length>0?n("v-uni-view",{staticClass:"poem-mode-container",on:{touchstart:function(t){arguments[0]=t=e.$handleEvent(t),e.touchStart.apply(void 0,arguments)},touchend:function(t){arguments[0]=t=e.$handleEvent(t),e.touchEnd.apply(void 0,arguments)}}},[n("v-uni-view",{class:"single-post-content "+(e.isTransitioning?"is-transitioning":""),attrs:{"data-postid":e.currentPost._id},on:{click:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=e.$handleEvent(t),e.onSinglePostTap.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"single-author-info"},[e.currentPost.authorAvatar?n("v-uni-image",{staticClass:"single-author-avatar",attrs:{src:e.currentPost.authorAvatar,mode:"aspectFill"}}):e._e(),n("v-uni-text",{staticClass:"single-author-name"},[e._v(e._s(e.currentPost.authorName))])],1),e.currentPost.title?n("v-uni-view",{staticClass:"single-post-title"},[e._v(e._s(e.currentPost.title))]):e._e(),e.currentPost.isPoem?n("v-uni-view",{staticClass:"single-poem-author"},[e._v(e._s(e.currentPost.author||e.currentPost.authorName))]):e._e(),e.currentPost.content?n("v-uni-view",{staticClass:"single-post-content-text",staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(e.currentPost.content))]):e._e(),e.currentAuthorSignature?n("v-uni-view",{staticClass:"user-signature"},[n("v-uni-image",{staticClass:"signature-image",attrs:{src:e.currentAuthorSignature,mode:"aspectFit"},on:{error:function(t){arguments[0]=t=e.$handleEvent(t),e.onSignatureError.apply(void 0,arguments)},load:function(t){arguments[0]=t=e.$handleEvent(t),e.onSignatureLoad.apply(void 0,arguments)}}})],1):e._e()],1),0!==e.postList.length||e.isLoading?e._e():n("v-uni-view",{staticClass:"empty-state"},[n("v-uni-view",{staticClass:"empty-icon"},[e._v("🛤️")]),n("v-uni-view",{staticClass:"empty-text"},[e._v("还没有路诗哦～")]),n("v-uni-view",{staticClass:"empty-subtext"},[e._v("快去广场发现原创好诗吧！")])],1)],1):e._e()],1)],1)},r=[]},daaa:function(e,t,n){"use strict";n.r(t);var o=n("9d3a"),a=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=a.a},df7b7:function(e,t,n){var o=n("c86c");t=o(!1),t.push([e.i,"uni-page-body[data-v-60133a98]{background:transparent;padding:0;opacity:0;-webkit-animation:fadeIn-data-v-60133a98 .8s ease-in-out forwards;animation:fadeIn-data-v-60133a98 .8s ease-in-out forwards}body.?%PAGE?%[data-v-60133a98]{background:transparent}@-webkit-keyframes fadeIn-data-v-60133a98{from{opacity:0}to{opacity:1}}@keyframes fadeIn-data-v-60133a98{from{opacity:0}to{opacity:1}}\r\n\r\n/* poem.wxss - 原创诗歌页面（路） */.container[data-v-60133a98]{\r\n    /* 移除 background-image, background-size 等都删掉 */position:relative;overflow:hidden;min-height:100vh}\r\n\r\n/* 读诗模式容器 */.poem-mode-container[data-v-60133a98]{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1; /* 确保在模糊层之上 */overflow:visible /* 允许签名显示在容器外部 */}\r\n\r\n/* 新增：背景图的容器和样式 */.background-wrapper[data-v-60133a98],\r\n.blur-background-wrapper[data-v-60133a98]{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2 /* 确保在最底层 */}.bg-image[data-v-60133a98]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0; /* 默认隐藏 */transition:opacity .5s ease-in-out /* 关键：平滑的透明度过渡 */}.bg-image.visible[data-v-60133a98]{opacity:1 /* 显示 */}\r\n\r\n/* 新增：模糊背景的容器和样式 */.blur-background-wrapper[data-v-60133a98]{z-index:-1;-webkit-filter:blur(30px) brightness(.7);filter:blur(30px) brightness(.7);-webkit-transform:scale(1.1);transform:scale(1.1)}\r\n\r\n/* 收藏按钮 */.favorite-btn[data-v-60133a98]{position:absolute;top:%?60?%;right:%?60?%;width:%?80?%;height:%?80?%;background:hsla(0,0%,100%,.9);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.15);z-index:999;transition:all .3s ease}.favorite-btn[data-v-60133a98]:active{-webkit-transform:scale(.95);transform:scale(.95)}.favorite-icon[data-v-60133a98]{font-size:%?36?%}\r\n\r\n/* 单帖内容区域 */.single-post-content[data-v-60133a98]{width:calc(100% - %?40?%);height:calc(100% - %?60?%); /* 减少上下边距，增加内容区域高度 */display:flex;flex-direction:column;padding:%?60?% %?20?% %?80?% %?20?%; /* 增加底部内边距，让最后一行不显示 */box-sizing:border-box;background:hsla(0,0%,100%,.8); /* 增加透明度，让背景图更明显 */margin:%?30?% %?20?%; /* 减少外边距，增加内容区域 */border-radius:%?24?%;box-shadow:0 %?8?% %?32?% rgba(0,0,0,.1);position:relative; /* 为原创标识定位 */transition:-webkit-transform .3s ease-in-out;transition:transform .3s ease-in-out;transition:transform .3s ease-in-out,-webkit-transform .3s ease-in-out; /* 卡片切换动画 */-webkit-transform:translateX(0);transform:translateX(0) /* 默认位置 */}\r\n\r\n/* 切换动画状态 */.single-post-content.is-transitioning[data-v-60133a98]{\r\n    /* 可以尝试只改变透明度，而不是位移 */opacity:.95;-webkit-transform:scale(.99);transform:scale(.99)}\r\n\r\n/* 作者信息 */.single-author-info[data-v-60133a98]{display:flex;align-items:center;margin-bottom:%?15?%; /* 减小作者信息与标题的间距 */padding-bottom:%?10?%; /* 减小底部内边距 */border-bottom:%?1?% solid hsla(0,0%,94.1%,.5) /* 半透明白色分割线 */}.single-author-avatar[data-v-60133a98]{width:%?80?%;height:%?80?%;border-radius:50%;margin-right:%?20?%;background-color:#f5f5f5;border:%?4?% solid #fff;box-shadow:0 %?4?% %?12?% rgba(0,0,0,.1)}.single-author-name[data-v-60133a98]{font-size:%?32?%;color:#000;font-weight:600;text-shadow:0 %?1?% %?2?% hsla(0,0%,100%,.8) /* 添加文字阴影 */}\r\n\r\n/* 标题 */.single-post-title[data-v-60133a98]{font-size:%?36?%;font-weight:700;color:#000;margin-bottom:%?10?%; /* 减小标题与内容的间距 */line-height:1.4;text-align:center; /* 标题居中显示 */text-shadow:0 %?1?% %?2?% hsla(0,0%,100%,.8) /* 添加文字阴影 */}\r\n\r\n/* 诗歌作者样式 */.single-poem-author[data-v-60133a98]{font-size:%?32?%;color:#000;text-align:center;margin:%?5?% 0 %?15?% 0;text-shadow:0 %?1?% %?2?% hsla(0,0%,100%,.8);letter-spacing:%?2?%}\r\n\r\n/* 图片容器 */.single-image-container[data-v-60133a98]{flex:1;display:flex;align-items:center;justify-content:center;margin:%?20?% 0;border-radius:%?16?%;overflow:hidden;background:#f8f9fa;width:100%;height:100%;max-height:50vh}.single-post-image[data-v-60133a98]{width:100%;height:100%;object-fit:contain;border-radius:%?16?%}\r\n\r\n/* 多张图片轮播 */.single-image-swiper[data-v-60133a98]{width:100%;height:50vh;border-radius:%?16?%}\r\n\r\n/* 内容文字 */.single-post-content-text[data-v-60133a98]{font-size:%?32?%;color:#000;line-height:1.8;margin-top:%?20?%;padding:%?20?% %?30?% %?120?% %?30?%; /* 增加底部内边距，为签名留出空间 */background:transparent; /* 完全透明背景 */border-radius:0; /* 移除圆角 */max-height:62vh; /* 稍微减少高度，配合底部内边距 */overflow-y:auto;overflow-x:visible; /* 确保水平方向不被裁剪 */font-family:-apple-system-font,PingFang SC,Helvetica Neue,Arial,sans-serif;letter-spacing:%?1?%;text-shadow:0 %?1?% %?2?% hsla(0,0%,100%,.8); /* 添加文字阴影增强可读性 */flex:1; /* 让文字区域占据剩余空间 */position:relative /* 确保定位上下文正确 */}\r\n\r\n/* 用户签名样式 */.user-signature[data-v-60133a98]{position:absolute;bottom:%?140?%; /* 从30rpx调整到120rpx，避免被底部导航栏遮挡 */right:%?50?%;z-index:1001; /* 提高层级，确保不被其他元素覆盖 */pointer-events:none /* 防止签名影响点击事件 */}.signature-image[data-v-60133a98]{width:%?120?%;height:%?60?%;opacity:.8; /* 稍微透明，不抢夺主要内容的注意力 */-webkit-filter:drop-shadow(0 %?2?% %?4?% rgba(0,0,0,.1));filter:drop-shadow(0 %?2?% %?4?% rgba(0,0,0,.1)); /* 添加轻微阴影 */display:block; /* 确保图片正确显示 */background:transparent /* 确保背景透明 */}\r\n\r\n/* 骨架屏容器 */.skeleton-container[data-v-60133a98]{position:absolute;top:0;left:0;width:100%;height:100%;background:hsla(0,0%,100%,.95);z-index:999;display:flex;flex-direction:column;align-items:center;justify-content:center}.loading-text[data-v-60133a98]{margin-top:%?40?%;font-size:%?28?%;color:#666;text-align:center}\r\n\r\n/* 空状态 */.empty-state[data-v-60133a98]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:%?100?% %?40?%;text-align:center}.empty-icon[data-v-60133a98]{font-size:%?80?%;margin-bottom:%?20?%;opacity:.5}.empty-text[data-v-60133a98]{font-size:%?32?%;color:#666;margin-bottom:%?10?%}.empty-subtext[data-v-60133a98]{font-size:%?28?%;color:#999}\r\n\r\n/* 悬浮发布按钮 */.add-button[data-v-60133a98]{position:fixed;bottom:%?120?%;right:%?30?%;width:%?100?%;height:%?100?%;background-color:#9ed7ee;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:%?48?%;box-shadow:0 %?4?% %?16?% rgba(7,193,96,.3);z-index:1000}",""]),e.exports=t},f0ff:function(e,t,n){var o=n("df7b7");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=n("967d").default;a("a3832a1e",o,!0,{sourceMap:!1,shadowMode:!1})}}]);