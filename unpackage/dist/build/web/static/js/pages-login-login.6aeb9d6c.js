(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-login-login"],{"0330":function(n,t,e){"use strict";e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return i})),e.d(t,"a",(function(){}));var o=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[e("v-uni-view",{staticClass:"container"},[e("v-uni-view",{staticClass:"title"},[n._v("欢迎回到回车键")]),e("v-uni-view",{staticClass:"subtitle"},[n._v("请输入你的账号信息登录")]),e("v-uni-view",{staticClass:"form-wrapper"},[e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("Poem ID")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"text",placeholder:"请输入你的Poem ID"},on:{input:function(t){arguments[0]=t=n.$handleEvent(t),n.onPoemIdInput.apply(void 0,arguments)}},model:{value:n.poemId,callback:function(t){n.poemId=t},expression:"poemId"}})],1),e("v-uni-view",{staticClass:"input-wrapper"},[e("v-uni-text",{staticClass:"input-label"},[n._v("密码")]),e("v-uni-input",{staticClass:"input-field",attrs:{type:"password",placeholder:"请输入密码"},on:{input:function(t){arguments[0]=t=n.$handleEvent(t),n.onPasswordInput.apply(void 0,arguments)}},model:{value:n.password,callback:function(t){n.password=t},expression:"password"}})],1),e("v-uni-button",{staticClass:"login-button",class:{loading:n.isLogging},attrs:{disabled:!n.canLogin||n.isLogging},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.onLogin.apply(void 0,arguments)}}},[n._v(n._s(n.isLogging?"登录中...":"登录"))]),e("v-uni-view",{staticClass:"register-link-wrapper"},[e("v-uni-text",{staticClass:"register-text"},[n._v("还没有账号？")]),e("v-uni-text",{staticClass:"register-link",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.goToRegister.apply(void 0,arguments)}}},[n._v("立即注册")])],1)],1)],1)],1)},i=[]},"0544":function(n,t,e){"use strict";e("6a54");var o=e("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(e("2634")),a=o(e("2fdc"));e("0c26");getApp();var r=e("11ca"),s=r.cloudCall,l={data:function(){return{poemId:"",password:"",isLogging:!1}},computed:{canLogin:function(){return this.poemId.trim()&&this.password.trim()}},onLoad:function(){console.log("🔍 [登录页面] 页面加载"),this.checkAndInitializeOpenid(),this.tryAutoRedirect()},methods:{tryAutoRedirect:function(){try{var n=uni.getStorageSync("userInfo"),t=uni.getStorageSync("userOpenId");if(n&&(n._openid||t)){var e=getApp();e.globalData=e.globalData||{},e.globalData.userInfo=n,e.globalData.openid=n._openid||t,e.globalData._loginProcessCompleted=!0,console.log("✅ [登录页面] 检测到已登录用户，自动跳转"),uni.switchTab({url:"/pages/poem/poem"})}}catch(o){console.log("⚠️ [登录页面] 自动跳转检查失败(忽略)：",o)}},checkAndInitializeOpenid:function(){console.log("🔍 [登录页面] 检查openid状态");var n=getApp(),t=n&&n.globalData&&n.globalData.openid;t?console.log("✅ [登录页面] openid已存在:",n.globalData.openid):(console.log("⚠️ [登录页面] 未检测到openid，尝试重新初始化"),this.initializeAnonymousOpenid())},initializeAnonymousOpenid:function(){console.log("🔄 [登录页面] 初始化匿名openid"),this.$tcb&&this.$tcb.callFunction?this.$tcb.callFunction({name:"login"}).then((function(n){console.log("✅ [登录页面] 匿名openid初始化成功:",n);var t=null;if(n.result&&n.result.openid?t=n.result.openid:n.openid?t=n.openid:n.result&&n.result.uid&&(t=n.result.uid),t){var e=getApp();e&&e.globalData&&(e.globalData.openid=t,console.log("✅ [登录页面] 匿名openid已设置:",t)),uni.setStorageSync("userOpenId",t)}else console.error("❌ [登录页面] 无法获取匿名openid")})).catch((function(n){console.error("❌ [登录页面] 匿名openid初始化失败:",n)})):console.error("❌ [登录页面] TCB实例不可用，无法初始化openid")},callCloudFunction:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(n,t,Object.assign({pageTag:"login",context:this},e))},onPoemIdInput:function(n){this.poemId=n.detail.value},onPasswordInput:function(n){this.password=n.detail.value},onLogin:function(){var n=this;return(0,a.default)((0,i.default)().mark((function t(){var e,o,a,r,s,l,c;return(0,i.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.canLogin&&!n.isLogging){t.next=2;break}return t.abrupt("return");case 2:return n.isLogging=!0,uni.showLoading({title:"登录中...",mask:!0}),t.prev=4,t.next=7,n.callCloudFunction("loginWithCredentials",{poemId:n.poemId.trim(),password:n.password.trim()});case 7:e=t.sent,console.log("🔍 [登录] 云函数返回结果:",e),e.result&&e.result.success?(o=e.result.userInfo,a=e.result.openid,console.log("✅ [登录] 登录成功:",o),r=getApp(),s=Object.assign({},o||{},{_openid:a}),r.globalData.userInfo=s,r.globalData.openid=a,r.globalData._loginProcessCompleted=!0,uni.setStorageSync("userInfo",s),uni.setStorageSync("userOpenId",a),uni.showToast({title:"登录成功",icon:"success"}),setTimeout((function(){uni.switchTab({url:"/pages/poem/poem"})}),1e3)):(c=(null===(l=e.result)||void 0===l?void 0:l.message)||"登录失败，请检查账号密码",uni.showToast({title:c,icon:"none",duration:3e3})),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](4),console.error("❌ [登录] 登录失败:",t.t0),uni.showToast({title:"登录失败，请重试",icon:"none",duration:3e3});case 16:return t.prev=16,uni.hideLoading(),n.isLogging=!1,t.finish(16);case 20:case"end":return t.stop()}}),t,null,[[4,12,16,20]])})))()},goToRegister:function(){uni.navigateTo({url:"/pages/register/register"})}}};t.default=l},"088d":function(n,t,e){var o=e("3582");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);var i=e("967d").default;i("4997cceb",o,!0,{sourceMap:!1,shadowMode:!1})},3582:function(n,t,e){var o=e("c86c");t=o(!1),t.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* 新的登录页面样式 */.container[data-v-0c79ba94]{display:flex;flex-direction:column;align-items:center;padding:%?120?% %?60?% %?60?%;height:100vh;background:linear-gradient(135deg,#f5f7fa,#c3cfe2)}.title[data-v-0c79ba94]{font-size:%?56?%;font-weight:700;margin-bottom:%?20?%;color:#333;text-align:center}.subtitle[data-v-0c79ba94]{font-size:%?28?%;color:#666;margin-bottom:%?100?%;text-align:center}.form-wrapper[data-v-0c79ba94]{width:100%;max-width:%?600?%}.input-wrapper[data-v-0c79ba94]{margin-bottom:%?40?%;background:#fff;border-radius:%?16?%;padding:%?30?%;box-shadow:0 %?4?% %?20?% rgba(0,0,0,.1)}.input-label[data-v-0c79ba94]{display:block;font-size:%?28?%;color:#333;margin-bottom:%?20?%;font-weight:500}.input-field[data-v-0c79ba94]{width:100%;font-size:%?32?%;color:#333;border:none;outline:none;background:transparent}.input-field[data-v-0c79ba94]::-webkit-input-placeholder{color:#999}.input-field[data-v-0c79ba94]::placeholder{color:#999}.login-button[data-v-0c79ba94]{width:100%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:%?32?%;font-weight:500;border-radius:%?16?%;padding:%?30?%;margin:%?60?% 0 %?40?%;border:none;box-shadow:0 %?8?% %?25?% rgba(102,126,234,.3);transition:all .3s ease}.login-button[data-v-0c79ba94]:active{-webkit-transform:translateY(%?2?%);transform:translateY(%?2?%);box-shadow:0 %?4?% %?15?% rgba(102,126,234,.3)}.login-button[data-v-0c79ba94]:disabled{background:#ccc;box-shadow:none;-webkit-transform:none;transform:none}.login-button.loading[data-v-0c79ba94]{background:#ccc;box-shadow:none}.register-link-wrapper[data-v-0c79ba94]{display:flex;justify-content:center;align-items:center;margin-top:%?40?%}.register-text[data-v-0c79ba94]{font-size:%?28?%;color:#666;margin-right:%?10?%}.register-link[data-v-0c79ba94]{font-size:%?28?%;color:#667eea;font-weight:500;text-decoration:underline}",""]),n.exports=t},"8f35":function(n,t,e){"use strict";var o=e("088d"),i=e.n(o);i.a},b29a:function(n,t,e){"use strict";e.r(t);var o=e("0544"),i=e.n(o);for(var a in o)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(a);t["default"]=i.a},fb04:function(n,t,e){"use strict";e.r(t);var o=e("0330"),i=e("b29a");for(var a in i)["default"].indexOf(a)<0&&function(n){e.d(t,n,(function(){return i[n]}))}(a);e("8f35");var r=e("828b"),s=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"0c79ba94",null,!1,o["a"],void 0);t["default"]=s.exports}}]);