(this["webpackJsonp"]=this["webpackJsonp"]||[]).push([["app-service"],{"0101":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e._$s(0,"i",e.showTip)?n("view",{staticClass:e._$s(0,"sc","install_tip"),attrs:{_i:0}},[n("view",{staticClass:e._$s(1,"sc","install_tip_back"),attrs:{_i:1}}),n("view",{staticClass:e._$s(2,"sc","install_tip_detail"),attrs:{_i:2}},[n("image",{staticClass:e._$s(3,"sc","install_tip_close"),attrs:{_i:3},on:{click:e.onClose}}),n("view",{staticClass:e._$s(4,"sc","install_tip_detail_title"),attrs:{_i:4}},[e._v(e._$s(4,"t0-0",e._s(e.title)))]),n("view",{staticClass:e._$s(5,"sc","install_tip_detail_tip"),attrs:{_i:5}},[e._v(e._$s(5,"t0-0",e._s(e.content)))])])]):e._e()},i=[]},"011a":function(e,t){function n(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(e.exports=n=function(){return!!t},e.exports.__esModule=!0,e.exports["default"]=e.exports)()}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"013c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWSCloseError=t.CloseEventCode=t.CLOSE_EVENT_CODE_INFO=void 0;var r,i=n("274f"),o={1e3:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3e3:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3050:{code:3050,name:"Server Close",description:"The client is terminating the connection because no heartbeat response is received from the server"}};t.CLOSE_EVENT_CODE_INFO=o,t.CloseEventCode=r,function(e){e[e["NormalClosure"]=1e3]="NormalClosure",e[e["GoingAway"]=1001]="GoingAway",e[e["ProtocolError"]=1002]="ProtocolError",e[e["UnsupportedData"]=1003]="UnsupportedData",e[e["NoStatusReceived"]=1005]="NoStatusReceived",e[e["AbnormalClosure"]=1006]="AbnormalClosure",e[e["InvalidFramePayloadData"]=1007]="InvalidFramePayloadData",e[e["PolicyViolation"]=1008]="PolicyViolation",e[e["MessageTooBig"]=1009]="MessageTooBig",e[e["MissingExtension"]=1010]="MissingExtension",e[e["InternalError"]=1011]="InternalError",e[e["ServiceRestart"]=1012]="ServiceRestart",e[e["TryAgainLater"]=1013]="TryAgainLater",e[e["BadGateway"]=1014]="BadGateway",e[e["TLSHandshake"]=1015]="TLSHandshake",e[e["ReconnectWebSocket"]=3e3]="ReconnectWebSocket",e[e["NoRealtimeListeners"]=3001]="NoRealtimeListeners",e[e["HeartbeatPingError"]=3002]="HeartbeatPingError",e[e["HeartbeatPongTimeoutError"]=3003]="HeartbeatPongTimeoutError",e[e["NoAuthentication"]=3050]="NoAuthentication"}(r||(t.CloseEventCode=r={}));t.getWSCloseError=function(e,t){var n=o[e],r=n?"".concat(n.name,", code ").concat(e,", reason ").concat(t||n.description):"code ".concat(e);return new i.CloudSDKError({errCode:i.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:r})}},"022f":function(e,t){var n=Function.prototype,r=n.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(t){}try{return e+""}catch(t){}}return""}},"031a":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.registerDatabase=function(t){try{t.registerComponent(o)}catch(n){e("warn",n," at node_modules/@cloudbase/js-sdk/database/dist/index.esm.js:43")}};var r=n("b8e2"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)};var o={name:"database",entity:{database:function(e){var t=this.platform,n=t.adapter,o=t.runtime;return r.Db.reqClass=this.request.constructor,r.Db.getAccessToken=this.authInstance?this.authInstance.getAccessToken.bind(this.authInstance):function(){return""},r.Db.runtime=o,this.wsClientClass&&(r.Db.wsClass=n.wsClass,r.Db.wsClientClass=this.wsClientClass),r.Db.ws||(r.Db.ws=null),new r.Db(i(i(i({},this.config),{_fromApp:this}),e))}}};try{cloudbase.registerComponent(o)}catch(a){}}).call(this,n("f3b9")["default"])},"03d9":function(e,t,n){var r=n("a535");e.exports=function(e){var t=r(this,e)["delete"](e);return this.size-=t?1:0,t}},"05f4":function(e,t,n){"use strict";(function(e){var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.removeEventListener=t.activateEvent=t.addEventListener=t.CloudbaseEventEmitter=t.IErrorEvent=t.CloudbaseEvent=void 0;var o=n("37e5");var a=function(){return function(e,t){this.data=t||null,this.name=e}}();t.CloudbaseEvent=a;var s=function(e){function t(t,n){var r=e.call(this,"error",{error:t,data:n})||this;return r.error=t,r}return r(t,e),t}(a);t.IErrorEvent=s;var u=function(){function t(){this.listeners={}}return t.prototype.on=function(e,t){return function(e,t,n){n[e]=n[e]||[],n[e].push(t)}(e,t,this.listeners),this},t.prototype.off=function(e,t){return function(e,t,n){if(null===n||void 0===n?void 0:n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}(e,t,this.listeners),this},t.prototype.fire=function(t,n){if((0,o.isInstanceOf)(t,s))return e("error",t.error," at node_modules/@cloudbase/utilities/dist/cjs/libs/events.js:73"),this;var r=(0,o.isString)(t)?new a(t,n||{}):t,u=r.name;if(this.listens(u)){r.target=this;for(var c=this.listeners[u]?i([],this.listeners[u],!0):[],l=0,d=c;l<d.length;l++){var f=d[l];f.call(this,r)}}return this},t.prototype.listens=function(e){return this.listeners[e]&&this.listeners[e].length>0},t}();t.CloudbaseEventEmitter=u;var c=new u;t.addEventListener=function(e,t){c.on(e,t)},t.activateEvent=function(e,t){void 0===t&&(t={}),c.fire(e,t)},t.removeEventListener=function(e,t){c.off(e,t)}}).call(this,n("f3b9")["default"])},"05f6":function(e,t,n){(function(t){var r=n("7ca3"),i=n("af34"),o=n("67ad"),a=n("0bdb");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=n("b99c"),l=n("11ca"),d=l.cloudCall,f=function(){"use strict";function e(){o(this,e),this.loadingFollows=new Set}return a(e,[{key:"callCloudFunction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(e,t,{pageTag:"followCache",requireAuth:!0})}},{key:"getFollowStatus",value:function(e,n){if(!e||!n||e===n)return Promise.resolve(null);var r=c.getFollowStatusCache(e,n);return r?(t("log","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u547d\u4e2d\u7f13\u5b58: ".concat(e," -> ").concat(n)," at utils/followCache.js:23"),Promise.resolve(r)):this.loadingFollows.has("".concat(e,"_").concat(n))?(t("log","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u6b63\u5728\u52a0\u8f7d\u4e2d\uff0c\u7b49\u5f85: ".concat(e," -> ").concat(n)," at utils/followCache.js:29"),this.waitForFollowLoad(e,n)):this.loadFollowStatus(e,n)}},{key:"waitForFollowLoad",value:function(e,t){var n=this;return new Promise((function(r){var i="".concat(e,"_").concat(t),o=setInterval((function(){if(!n.loadingFollows.has(i)){clearInterval(o);var a=c.getFollowStatusCache(e,t);r(a)}}),100);setTimeout((function(){clearInterval(o),n.loadingFollows.delete(i),r(null)}),3e3)}))}},{key:"loadFollowStatus",value:function(e,n){var r=this,i="".concat(e,"_").concat(n);return this.loadingFollows.add(i),t("log","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u5f00\u59cb\u52a0\u8f7d\u5173\u6ce8\u72b6\u6001: ".concat(e," -> ").concat(n)," at utils/followCache.js:62"),new Promise((function(o){r.callCloudFunction("follow",{action:"checkFollow",targetOpenid:n}).then((function(r){if(r.result&&r.result.success){var i={isFollowing:!!r.result.isFollowing,isFollowedByAuthor:!!r.result.isFollower,isMutualFollow:!!r.result.isMutual,lastUpdated:Date.now()};c.setFollowStatusCache(e,n,i),t("log","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u52a0\u8f7d\u5e76\u7f13\u5b58\u6210\u529f: ".concat(e," -> ").concat(n),i," at utils/followCache.js:79"),o(i)}else t("warn","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u83b7\u53d6\u5173\u6ce8\u72b6\u6001\u5931\u8d25: ".concat(e," -> ").concat(n),r.result," at utils/followCache.js:82"),o(null)})).catch((function(r){t("error","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u52a0\u8f7d\u5173\u6ce8\u72b6\u6001\u5931\u8d25: ".concat(e," -> ").concat(n),r," at utils/followCache.js:86"),o(null)})).finally((function(){r.loadingFollows.delete(i)}))}))}},{key:"getBatchFollowStatus",value:function(e,n){var r=this;if(!e||!n||0===n.length)return Promise.resolve({});var i={},o=[];return n.forEach((function(t){if(t!==e){var n=c.getFollowStatusCache(e,t);n?i[t]=n:o.push(t)}})),o.length>0?(t("log","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u6279\u91cf\u52a0\u8f7d\u5173\u6ce8\u72b6\u6001: ".concat(o.length,"\u4e2a")," at utils/followCache.js:116"),new Promise((function(n){r.callCloudFunction("getBatchFollowStatus",{currentUserId:e,targetUserIds:o}).then((function(t){t.result&&t.result.success&&t.result.followStatuses&&t.result.followStatuses.forEach((function(t){if(t&&t.targetUserId){var n={isFollowing:!!t.isFollowing,isFollowedByAuthor:!!t.isFollowedByAuthor,isMutualFollow:!!t.isMutualFollow,lastUpdated:Date.now()};i[t.targetUserId]=n,c.setFollowStatusCache(e,t.targetUserId,n)}})),n(i)})).catch((function(e){t("error","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u6279\u91cf\u52a0\u8f7d\u5931\u8d25:",e," at utils/followCache.js:138"),n(i)}))}))):Promise.resolve(i)}},{key:"preloadFollowStatusFromPosts",value:function(e,n){var r=this;if(e&&0!==e.length&&n){var o=i(new Set(e.map((function(e){return e._openid})).filter((function(e){return e&&e!==n}))));0!==o.length&&setTimeout((function(){r.getBatchFollowStatus(n,o).then((function(e){t("log","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u9884\u52a0\u8f7d\u5b8c\u6210: ".concat(Object.keys(e).length,"\u4e2a\u5173\u6ce8\u72b6\u6001")," at utils/followCache.js:159")}))}),100)}}},{key:"updateFollowStatus",value:function(e,t,n){if(!e||!t||!n)return!1;var r=u(u({},n),{},{lastUpdated:Date.now()});return c.setFollowStatusCache(e,t,r)}},{key:"toggleFollowStatus",value:function(e,n){var r=this;return e&&n&&e!==n?new Promise((function(i){r.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:n}).then((function(o){if(o.result&&o.result.success){var a={isFollowing:!!o.result.isFollowing,isFollowedByAuthor:!!o.result.isFollower,isMutualFollow:!!o.result.isMutual,lastUpdated:Date.now()};r.updateFollowStatus(e,n,a),t("log","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u5207\u6362\u5173\u6ce8\u72b6\u6001\u6210\u529f: ".concat(e," -> ").concat(n),a," at utils/followCache.js:197"),i(a)}else t("warn","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u5207\u6362\u5173\u6ce8\u72b6\u6001\u5931\u8d25: ".concat(e," -> ").concat(n),o.result," at utils/followCache.js:200"),i(null)})).catch((function(r){t("error","\u3010\u5173\u6ce8\u7f13\u5b58\u3011\u5207\u6362\u5173\u6ce8\u72b6\u6001\u5931\u8d25: ".concat(e," -> ").concat(n),r," at utils/followCache.js:204"),i(null)}))})):Promise.resolve(null)}},{key:"clearUserFollowCache",value:function(e){if(!e)return!1;try{var n=uni.getStorageInfoSync().keys;return n.forEach((function(t){t.startsWith("follow_")&&t.includes("_".concat(e))&&c.remove(t)})),!0}catch(r){return t("log","CatchClause",r," at utils/followCache.js:224"),t("log","CatchClause",r," at utils/followCache.js:225"),t("error","\u6e05\u7406\u7528\u6237\u5173\u6ce8\u7f13\u5b58\u5931\u8d25:",r," at utils/followCache.js:226"),!1}}},{key:"clearAllFollowCache",value:function(){try{var e=uni.getStorageInfoSync().keys;return e.forEach((function(e){e.startsWith("follow_")&&c.remove(e)})),!0}catch(n){return t("log","CatchClause",n," at utils/followCache.js:242"),t("log","CatchClause",n," at utils/followCache.js:243"),t("error","\u6e05\u7406\u6240\u6709\u5173\u6ce8\u7f13\u5b58\u5931\u8d25:",n," at utils/followCache.js:244"),!1}}}]),e}(),p=new f;e.exports=p}).call(this,n("f3b9")["default"])},"0834":function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n("d749"),t)},"08b0":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.InternalSymbol=void 0;var r=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=[],o={},a=function(){return function(e){Object.defineProperties(this,{target:{enumerable:!1,writable:!1,configurable:!1,value:e}})}}(),s=function(e){function t(t,n){var r;if(n!==o)throw new TypeError("InternalSymbol cannot be constructed with new operator");return r=e.call(this,t)||this,r}return r(t,e),t.for=function(e){for(var n=0,r=i.length;n<r;n++)if(i[n].target===e)return i[n].instance;var a=new t(e,o);return i.push({target:e,instance:a}),a},t}(a);t.InternalSymbol=s;var u=s;t.default=u},"08c8":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.Captcha=void 0;var i=r(n("127e")),o=r(n("ee10")),a=r(n("67ad")),s=r(n("0bdb")),u=n("2ce5"),c=n("223b"),l=n("1d3b"),d=r(n("140c")),f=function(){function e(t){(0,a.default)(this,e),t.openURIWithCallback||(t.openURIWithCallback=this.getDefaultOpenURIWithCallback()),t.storage||(t.storage=c.defaultStorage),this.config=t,this.tokenSectionName="captcha_".concat(t.clientId)}return(0,s.default)(e,[{key:"isMatch",value:function(){var e,t,n;return(null===(e=this.config)||void 0===e||null===(t=e.adapter)||void 0===t||null===(n=t.isMatch)||void 0===n?void 0:n.call(t))||(0,l.isMp)()}},{key:"request",value:function(){var e=(0,o.default)(i.default.mark((function e(t,n){var r,o,a;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n||(n={}),n.method||(n.method="GET"),r="".concat(n.method,":").concat(t),o=t,!n.withCaptcha){e.next=8;break}return e.next=7,this.appendCaptchaTokenToURL(t,r,!1);case 7:o=e.sent;case 8:return e.prev=8,e.next=11,this.config.request(o,n);case 11:a=e.sent,e.next=22;break;case 14:if(e.prev=14,e.t0=e["catch"](8),e.t0.error!==u.ErrorType.CAPTCHA_REQUIRED&&e.t0.error!==u.ErrorType.CAPTCHA_INVALID){e.next=21;break}return e.next=19,this.appendCaptchaTokenToURL(t,r,e.t0.error===u.ErrorType.CAPTCHA_INVALID);case 19:return t=e.sent,e.abrupt("return",this.config.request(t,n));case 21:return e.abrupt("return",Promise.reject(e.t0));case 22:return e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,this,[[8,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultOpenURIWithCallback",value:function(){if(!this.isMatch()&&!(0,l.isInMpWebView)()&&(window.location.search.indexOf("__captcha")>0&&(document.body.style.display="none"),null===document.getElementById("captcha_panel_wrap"))){var e=document.createElement("div");e.style.cssText="background-color: rgba(0, 0, 0, 0.7);position: fixed;left: 0px;right: 0px;top: 0px;bottom: 0px;padding: 9vw 0 0 0;display: none;z-index:100;",e.setAttribute("id","captcha_panel_wrap"),setTimeout((function(){document.body.appendChild(e)}),0)}return this.defaultOpenURIWithCallback}},{key:"defaultOpenURIWithCallback",value:function(){var e=(0,o.default)(i.default.mark((function e(t,n){var r,o,a,s,c,l,f,p;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=n||{},o=r.width,a=void 0===o?"355px":o,s=r.height,c=void 0===s?"355px":s,l=t.match(/^(data:.*)$/),!l){e.next=4;break}return e.abrupt("return",Promise.reject({error:u.ErrorType.UNIMPLEMENTED,error_description:"need to impl captcha data"}));case 4:return f=document.getElementById("captcha_panel_wrap"),p=document.createElement("iframe"),f.innerHTML="",p.setAttribute("src",t),p.setAttribute("id","review-panel-iframe"),p.style.cssText="min-width:".concat(a,";display:block;height:").concat(c,";margin:0 auto;background-color: rgb(255, 255, 255);border: none;"),f.appendChild(p),f.style.display="block",e.abrupt("return",new Promise((function(e,t){p.onload=function(){try{var n=window.location,r=p.contentWindow.location;if(r.host+r.pathname===n.host+n.pathname){f.style.display="none";var i=new d.default(r.search),o=i.get("captcha_token");return o?e({captcha_token:o,expires_in:Number(i.get("expires_in"))}):t({error:i.get("error"),error_description:i.get("error_description")})}f.style.display="block"}catch(a){f.style.display="block"}}})));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCaptchaToken",value:function(){var e=(0,o.default)(i.default.mark((function e(t,n){var r,o,a,s,c,d;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=6;break}return e.next=3,this.findCaptchaToken();case 3:if(r=e.sent,!r){e.next=6;break}return e.abrupt("return",r);case 6:if(this.isMatch()||(0,l.isInMpWebView)()){e.next=17;break}return a="".concat(window.location.origin+window.location.pathname,"?__captcha=on"),e.next=10,this.config.request(u.ApiUrls.GET_CAPTCHA_URL,{method:"POST",body:{client_id:this.config.clientId,redirect_uri:a,state:n},withCredentials:!1});case 10:if(o=e.sent,!o.captcha_token){e.next=15;break}return s={captcha_token:o.captcha_token,expires_in:o.expires_in},this.saveCaptchaToken(s),e.abrupt("return",o.captcha_token);case 15:e.next=21;break;case 17:return e.next=19,this.config.request(u.ApiUrls.CAPTCHA_DATA_URL,{method:"POST",body:{state:n,redirect_uri:""},withCredentials:!1});case 19:c=e.sent,o={url:"".concat(c.data,"?state=").concat(encodeURIComponent(n),"&token=").concat(encodeURIComponent(c.token))};case 21:return e.next=23,this.config.openURIWithCallback(o.url);case 23:return d=e.sent,this.saveCaptchaToken(d),e.abrupt("return",d.captcha_token);case 26:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"appendCaptchaTokenToURL",value:function(){var e=(0,o.default)(i.default.mark((function e(t,n,r){var o;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getCaptchaToken(r,n);case 2:return o=e.sent,t.indexOf("?")>0?t+="&captcha_token=".concat(o):t+="?captcha_token=".concat(o),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"saveCaptchaToken",value:function(){var e=(0,o.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.expires_at=new Date(Date.now()+1e3*(t.expires_in-10)),n=JSON.stringify(t),e.next=4,this.config.storage.setItem(this.tokenSectionName,n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findCaptchaToken",value:function(){var e=(0,o.default)(i.default.mark((function e(){var t,n,r;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.config.storage.getItem(this.tokenSectionName);case 2:if(t=e.sent,void 0===t||null===t){e.next=18;break}if(e.prev=4,n=JSON.parse(t),null!==n&&void 0!==n&&n.expires_at&&(n.expires_at=new Date(n.expires_at)),r=n.expires_at<new Date,!r){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",n.captcha_token);case 13:return e.prev=13,e.t0=e["catch"](4),e.next=17,this.config.storage.removeItem(this.tokenSectionName);case 17:return e.abrupt("return",null);case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,this,[[4,13]])})));return function(){return e.apply(this,arguments)}}()}]),e}();t.Captcha=f},"095a":function(e,t,n){var r=n("562d");e.exports=function(e,t){return null==e||r(e,t)}},"096e":function(e,t,n){var r=n("4ff6"),i=n("76e0"),o=n("3ce6");e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},"099c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=null,i=function(e,t,n){null!==r&&clearTimeout(r),r=setTimeout((function(){e[t]()}),n)};t.default=i},"09ea":function(e,t,n){"use strict";n.r(t);var r=n("eed6"),i=n("fb85");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"09fe":function(e,t,n){var r=n("b828"),i=n("3357");e.exports=function(e,t){return t.length<2?e:r(e,i(t,0,-1))}},"0a32":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.IErrorEvent=t.CloudbaseEventEmitter=t.CloudbaseEvent=void 0,t.activateEvent=function(e,t){void 0===t&&(t={});c.fire(e,t)},t.addEventListener=function(e,t){c.on(e,t)},t.removeEventListener=function(e,t){c.off(e,t)};var r=n("6e68"),i=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};var a=function(){return function(e,t){this.data=t||null,this.name=e}}();t.CloudbaseEvent=a;var s=function(e){function t(t,n){var r=e.call(this,"error",{error:t,data:n})||this;return r.error=t,r}return i(t,e),t}(a);t.IErrorEvent=s;var u=function(){function t(){this.listeners={}}return t.prototype.on=function(e,t){return function(e,t,n){n[e]=n[e]||[],n[e].push(t)}(e,t,this.listeners),this},t.prototype.off=function(e,t){return function(e,t,n){if(null===n||void 0===n?void 0:n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}(e,t,this.listeners),this},t.prototype.fire=function(t,n){if((0,r.isInstanceOf)(t,s))return e("error",t.error," at node_modules/@cloudbase/utilities/dist/esm/libs/events.js:70"),this;var i=(0,r.isString)(t)?new a(t,n||{}):t,u=i.name;if(this.listens(u)){i.target=this;for(var c=this.listeners[u]?o([],this.listeners[u],!0):[],l=0,d=c;l<d.length;l++){var f=d[l];f.call(this,i)}}return this},t.prototype.listens=function(e){return this.listeners[e]&&this.listeners[e].length>0},t}();t.CloudbaseEventEmitter=u;var c=new u}).call(this,n("f3b9")["default"])},"0b48":function(e,t){e.exports=function(){return[]}},"0b64":function(e,t,n){"use strict";n.r(t);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,62,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,63,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];t["default"]={getRandomValues(e){if(!(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8ClampedArray))throw new Error("Expected an integer array");if(e.byteLength>65536)throw new Error("Can only request a maximum of 65536 bytes");var t=uni.requireNativePlugin("DCloud-Crypto");return function(e,t){for(var n,i=e.length,o="="===e[i-2]?2:"="===e[i-1]?1:0,a=0,s=i-o&4294967292,u=0;u<s;u+=4)n=r[e.charCodeAt(u)]<<18|r[e.charCodeAt(u+1)]<<12|r[e.charCodeAt(u+2)]<<6|r[e.charCodeAt(u+3)],t[a++]=n>>16&255,t[a++]=n>>8&255,t[a++]=255&n;1===o&&(n=r[e.charCodeAt(u)]<<10|r[e.charCodeAt(u+1)]<<4|r[e.charCodeAt(u+2)]>>2,t[a++]=n>>8&255,t[a++]=255&n),2===o&&(n=r[e.charCodeAt(u)]<<2|r[e.charCodeAt(u+1)]>>4,t[a++]=255&n)}(t.getRandomValues(e.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e}}},"0bdb":function(e,t,n){var r=n("d551");function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports["default"]=e.exports},"0d14":function(e,t,n){"use strict";n.r(t);var r=n("3517"),i=n("ae4d");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"0d22":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.MultiPoint=void 0;var i=r(n("3b2d")),o=n("a4d5"),a=n("382e"),s=n("8539"),u=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=function(){function e(e){if(!(0,s.isArray)(e))throw new TypeError('"points" must be of type Point[]. Received type '+(0,i.default)(e));if(0===e.length)throw new Error('"points" must contain 1 point at least');e.forEach((function(e){if(!(e instanceof a.Point))throw new TypeError('"points" must be of type Point[]. Received type '+(0,i.default)(e)+"[]")})),this.points=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"MultiPoint",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))},t},e.prototype.toJSON=function(){return{type:"MultiPoint",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))}},e.validate=function(e){var t,n;if("MultiPoint"!==e.type||!(0,s.isArray)(e.coordinates))return!1;try{for(var r=u(e.coordinates),i=r.next();!i.done;i=r.next()){var o=i.value;if(!(0,s.isNumber)(o[0])||!(0,s.isNumber)(o[1]))return!1}}catch(a){t={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return o.SYMBOL_GEO_MULTI_POINT},enumerable:!0,configurable:!0}),e}();t.MultiPoint=c},"0d49":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n("b8e2"),i=n("b9ff"),o=n("a601"),a=n("e775"),s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},c=function(){function e(e,t){this._stages=[],e&&t&&(this._db=e,this._request=new r.Db.reqClass(this._db.config),this._collectionName=t)}return e.prototype.end=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:if(!this._collectionName||!this._db)throw new Error("Aggregation pipeline cannot send request");return[4,this._request.send("database.aggregate",{collectionName:this._collectionName,stages:this._stages})];case 1:return e=t.sent(),e&&e.data&&e.data.list?[2,{requestId:e.requestId,data:JSON.parse(e.data.list).map(i.EJSON.parse)}]:[2,e]}}))}))},e.prototype.unwrap=function(){return this._stages},e.prototype.done=function(){return this._stages.map((function(e){var t,n=e.stageKey,r=e.stageValue;return t={},t[n]=JSON.parse(r),t}))},e.prototype._pipe=function(e,t){return this._stages.push({stageKey:"$"+e,stageValue:JSON.stringify(t)}),this},e.prototype.addFields=function(e){return this._pipe("addFields",e)},e.prototype.bucket=function(e){return this._pipe("bucket",e)},e.prototype.bucketAuto=function(e){return this._pipe("bucketAuto",e)},e.prototype.count=function(e){return this._pipe("count",e)},e.prototype.geoNear=function(e){return e.query&&(e.query=o.QuerySerializer.encode(e.query)),e.distanceMultiplier&&"number"===typeof e.distanceMultiplier&&(e.distanceMultiplier=e.distanceMultiplier),e.near&&(e.near=new a.Point(e.near.longitude,e.near.latitude).toJSON()),this._pipe("geoNear",e)},e.prototype.group=function(e){return this._pipe("group",e)},e.prototype.limit=function(e){return this._pipe("limit",e)},e.prototype.match=function(e){return this._pipe("match",o.QuerySerializer.encode(e))},e.prototype.project=function(e){return this._pipe("project",e)},e.prototype.lookup=function(e){return this._pipe("lookup",e)},e.prototype.replaceRoot=function(e){return this._pipe("replaceRoot",e)},e.prototype.sample=function(e){return this._pipe("sample",e)},e.prototype.skip=function(e){return this._pipe("skip",e)},e.prototype.sort=function(e){return this._pipe("sort",e)},e.prototype.sortByCount=function(e){return this._pipe("sortByCount",e)},e.prototype.unwind=function(e){return this._pipe("unwind",e)},e}(),l=c;t.default=l},"0dcd":function(e,t,n){(function(e){var r=n("6e56"),i=t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===i,s=a&&r.process,u=function(){try{var e=o&&o.require&&o.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(t){}}();e.exports=u}).call(this,n("dc84")(e))},"0ee4":function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},"0efd":function(e,t,n){var r=n("a535");e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},"0efe":function(e,t,n){(function(t){var r=n("127e"),i=n("ee10"),o=n("3b2d"),a=n("7ca3");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c={page:0,hasMore:!0,isLoading:!1,isLoadingMore:!1},l=Object.keys(c);function d(e){return e.__paginationState||(e.__paginationState=u({},c)),"object"!==o(e.pagination)||null===e.pagination?e.pagination=u({},c):e.pagination=u(u({},c),e.pagination),l.forEach((function(t){"undefined"===typeof e[t]&&(e[t]=c[t])})),e.__paginationState}function f(e,t){var n=d(e);Object.assign(n,t),function(e,t){if(t&&"object"===o(t)){var n={};if(l.forEach((function(r){Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r],e.pagination&&"object"===o(e.pagination)&&(e.pagination[r]=t[r]),e[r]=t[r])})),"function"===typeof e.setData){var r={};return Object.keys(n).forEach((function(e){r[e]=n[e],r["pagination.".concat(e)]=n[e]})),void e.setData(r)}Object.assign(e,n)}}(e,t)}function p(e,n,r){var i=r.pageSize,o=r.isRefresh,a=r.fallback;if(n&&"boolean"===typeof n.hasMore)return n.hasMore;var s=e.__paginationConfig||{};if("function"===typeof s.computeHasMore)try{var u=s.computeHasMore.call(e,n,{page:e.__paginationState.page,pageSize:i,isRefresh:o});if("boolean"===typeof u)return u}catch(c){t("warn","[pagination] computeHasMore \u6267\u884c\u5931\u8d25",c," at mixins/pagination.js:78")}return n&&Array.isArray(n.list)?"number"===typeof i?n.list.length>=i:n.list.length>0:n&&Array.isArray(n.items)?"number"===typeof i?n.items.length>=i:n.items.length>0:"boolean"!==typeof a||a}function h(e){return g.apply(this,arguments)}function g(){return g=i(r.mark((function e(n){var i,o,a,s,u,c,l,h,g,v,m,y,_,b,w=arguments;return r.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=w.length>1&&void 0!==w[1]?w[1]:{},o=i.isRefresh,a=i.extra,s=void 0===a?{}:a,u=i.fromPullDown,c=void 0!==u&&u,l=n.__paginationConfig,l&&"function"===typeof l.loader){e.next=5;break}return t("warn","[pagination] \u5c1a\u672a\u901a\u8fc7 initPagination \u6ce8\u518c\u52a0\u8f7d\u51fd\u6570"," at mixins/pagination.js:99"),e.abrupt("return",null);case 5:if(d(n),h=n.__paginationState,o||!1!==h.hasMore){e.next=9;break}return e.abrupt("return",null);case 9:if(!h.isLoading&&!h.isLoadingMore){e.next=11;break}return e.abrupt("return",null);case 11:return g=o?0:h.page,v=0===g,f(n,{isLoading:v,isLoadingMore:!v}),m={page:g,pageSize:l.pageSize,isRefresh:o,isFirstPage:v,extra:s},e.prev=15,"function"===typeof l.beforeLoad&&l.beforeLoad.call(n,m),e.next=19,l.loader.call(n,m);case 19:y=e.sent,_=g+1,b=p(n,y,{pageSize:l.pageSize,isRefresh:o,fallback:!!o||h.hasMore}),f(n,{page:_,hasMore:b}),"function"===typeof l.afterLoad&&l.afterLoad.call(n,y,m),e.next=30;break;case 26:throw e.prev=26,e.t0=e["catch"](15),"function"===typeof l.onError?l.onError.call(n,e.t0,m):t("error","[pagination] \u52a0\u8f7d\u6570\u636e\u5931\u8d25",e.t0," at mixins/pagination.js:154"),e.t0;case 30:if(e.prev=30,f(n,{isLoading:!1,isLoadingMore:!1}),o&&!1!==l.autoStopPullDown&&c&&"undefined"!==typeof uni&&"function"===typeof uni.stopPullDownRefresh)try{uni.stopPullDownRefresh()}catch(r){t("warn","[pagination] stopPullDownRefresh \u8c03\u7528\u5931\u8d25",r," at mixins/pagination.js:166")}return e.finish(30);case 34:return e.abrupt("return",y);case 35:case"end":return e.stop()}}),e,null,[[15,26,30,34]])}))),g.apply(this,arguments)}e.exports={data:function(){return u({pagination:u({},c)},c)},created:function(){d(this)},onReachBottom:function(){this.__paginationConfig&&this.loadNext().catch((function(){}))},onPullDownRefresh:function(){this.__paginationConfig&&this.refresh({fromPullDown:!0}).catch((function(){}))},methods:{initPagination:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"!==typeof e)throw new TypeError("[pagination] initPagination \u9700\u8981\u4f20\u5165\u51fd\u6570\u7c7b\u578b\u7684 loader");var n=t.pageSize,r=void 0===n?10:n,i=t.immediate,o=void 0===i||i,a=t.autoStopPullDown,s=void 0===a||a,l=t.computeHasMore,d=t.beforeLoad,p=t.afterLoad,h=t.onError;return this.__paginationConfig={loader:e,pageSize:r,immediate:o,autoStopPullDown:s,computeHasMore:l,beforeLoad:d,afterLoad:p,onError:h},f(this,u({},c)),o?this.refresh({fromPullDown:!1}):Promise.resolve()},refresh:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return d(this),f(this,{page:0,hasMore:!0}),h(this,u({isRefresh:!0},e))},loadNext:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return h(this,u({isRefresh:!1},e))},getPaginationState:function(){return d(this),u({},this.__paginationState)}}}}).call(this,n("f3b9")["default"])},"0f6e":function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("7ca3")),a=i(n("8cb3")),s=i(n("84be")),u=i(n("8cb3")),c=i(n("84be")),l=n("11ca"),d=l.cloudCall,f=n("2b90"),p={components:{skeleton:a.default,folderSelector:s.default},mixins:[f],data:function(){return{isLoading:!0,postList:[],currentPostIndex:0,touchStartX:0,touchEndX:0,touchStartY:0,touchEndY:0,hasMore:!0,page:0,backgroundImage:"",isTransitioning:!1,preloadedImages:{},hasFirstLoad_var:!1,currentPost:null,bgLayers:[{url:"",visible:!1},{url:"",visible:!1}],activeLayerIndex:0,swiperHeights:{},imageClampHeights:{},currentAuthorSignature:"",currentAuthorOpenid:"",isFetchingSignature:!1,selected:0,url:"",visible:!1}},onLoad:function(){e("log","Poem \u9875\u9762 onLoad"," at pages/poem/poem.vue:154");var t=getApp();t.globalData.preloadedPoemData&&t.globalData.preloadedPoemData.length>0?(e("log","Poem: \u4f7f\u7528\u9884\u52a0\u8f7d\u6570\u636e"," at pages/poem/poem.vue:159"),this.setData({postList:t.globalData.preloadedPoemData,isLoading:!1,page:1,hasFirstLoad_var:!0}),this.updatePostDisplay(0),t.globalData.preloadedPoemData=null,this._hasFirstLoad=!0):(e("log","Poem: \u65e0\u9884\u52a0\u8f7d\u6570\u636e\uff0c\u5f00\u59cb\u8bf7\u6c42"," at pages/poem/poem.vue:173"),this.getPostList())},onShow:function(){var t=n("d87a"),r=t.updateTabBarStatus;r(this,1);try{var i=uni.getStorageSync("shouldRefreshPoem");if(i)return e("log","\u3010poem\u3011\u68c0\u6d4b\u5230\u53d1\u5e03\u6807\u8bb0\uff0c\u5237\u65b0\u6570\u636e"," at pages/poem/poem.vue:186"),uni.removeStorageSync("shouldRefreshPoem"),void this.refreshPoemData()}catch(o){e("log","CatchClause",o," at pages/poem/poem.vue:192"),e("log","CatchClause",o," at pages/poem/poem.vue:193"),e("error","\u68c0\u67e5\u5237\u65b0\u6807\u8bb0\u5931\u8d25:",o," at pages/poem/poem.vue:194")}this._hasFirstLoad?e("log","\u3010poem\u3011\u518d\u6b21\u8fdb\u5165\uff0c\u4fdd\u6301\u4e4b\u524d\u5185\u5bb9"," at pages/poem/poem.vue:206"):(e("log","\u3010poem\u3011\u9996\u6b21\u8fdb\u5165\uff0c\u5237\u65b0\u6570\u636e"," at pages/poem/poem.vue:199"),this._hasFirstLoad=!0,0===this.postList.length&&this.refreshPoemData())},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(e,t,Object.assign({pageTag:"poem",context:this},n))},refreshPoemData:function(){e("log","\u3010poem\u3011\u5f00\u59cb\u5237\u65b0\u8bd7\u6b4c\u6570\u636e"," at pages/poem/poem.vue:217"),this.setData({postList:[],currentPostIndex:0,page:0,hasMore:!0,isLoading:!1,bgLayers:[{url:"",visible:!1},{url:"",visible:!1}],activeLayerIndex:0}),this.getPostList()},fetchAuthorSignature:function(t){var n=this;if(!t)return e("log","\u3010poem\u3011\u4f5c\u8005openid\u4e3a\u7a7a\uff0c\u4e0d\u83b7\u53d6\u7b7e\u540d"," at pages/poem/poem.vue:242"),void this.setData({currentAuthorSignature:""});if(this.currentAuthorOpenid===t&&this.isFetchingSignature)e("log","\u3010poem\u3011\u6b63\u5728\u83b7\u53d6\u8be5\u4f5c\u8005\u7b7e\u540d\uff0c\u8df3\u8fc7\u91cd\u590d\u8c03\u7528"," at pages/poem/poem.vue:251");else if(this.currentAuthorOpenid===t&&this.currentAuthorSignature)e("log","\u3010poem\u3011\u8be5\u4f5c\u8005\u7b7e\u540d\u5df2\u5b58\u5728\uff0c\u8df3\u8fc7\u91cd\u590d\u83b7\u53d6"," at pages/poem/poem.vue:257");else{var i;if(e("log","\u3010poem\u3011\u83b7\u53d6\u4f5c\u8005\u7b7e\u540d\u4fe1\u606f\uff0copenid:",t," at pages/poem/poem.vue:260"),this.setData({isFetchingSignature:!0,currentAuthorOpenid:t}),this.$tcb&&this.$tcb.database)i=this.$tcb.database(),e("log","\u3010poem\u3011\u4f7f\u7528TCB\u6570\u636e\u5e93\u5b9e\u4f8b"," at pages/poem/poem.vue:273");else{if("undefined"===typeof r||!r.cloud||!r.cloud.database)return e("error","\u3010poem\u3011\u65e0\u6cd5\u83b7\u53d6\u6570\u636e\u5e93\u5b9e\u4f8b\uff0c$tcb\u548cwx.cloud\u90fd\u4e0d\u53ef\u7528"," at pages/poem/poem.vue:278"),void this.setData({currentAuthorSignature:"",isFetchingSignature:!1});i=r.cloud.database(),e("log","\u3010poem\u3011\u4f7f\u7528\u5fae\u4fe1\u4e91\u6570\u636e\u5e93\u5b9e\u4f8b"," at pages/poem/poem.vue:276")}i.collection("users").where({_openid:t}).get().then((function(t){if(e("log","\u3010poem\u3011\u76f4\u63a5\u67e5\u8be2\u6570\u636e\u5e93\u7ed3\u679c:",t," at pages/poem/poem.vue:291"),t.data&&t.data.length>0){var r=t.data[0];e("log","\u3010poem\u3011\u6570\u636e\u5e93\u4e2d\u7684\u7528\u6237\u4fe1\u606f:",r," at pages/poem/poem.vue:294"),r.signatureUrl?(e("log","\u3010poem\u3011\u6570\u636e\u5e93\u4e2d\u627e\u5230\u7b7e\u540d:",r.signatureUrl," at pages/poem/poem.vue:296"),n.setData({currentAuthorSignature:r.signatureUrl,isFetchingSignature:!1})):(e("log","\u3010poem\u3011\u6570\u636e\u5e93\u4e2d\u7528\u6237\u6ca1\u6709\u8bbe\u7f6e\u7b7e\u540d"," at pages/poem/poem.vue:302"),n.setData({currentAuthorSignature:"",isFetchingSignature:!1}))}else e("log","\u3010poem\u3011\u6570\u636e\u5e93\u4e2d\u672a\u627e\u5230\u7528\u6237"," at pages/poem/poem.vue:309"),n.setData({currentAuthorSignature:"",isFetchingSignature:!1})})).catch((function(t){e("error","\u3010poem\u3011\u76f4\u63a5\u67e5\u8be2\u6570\u636e\u5e93\u5931\u8d25:",t," at pages/poem/poem.vue:317"),n.setData({currentAuthorSignature:"",isFetchingSignature:!1})})),this.callCloudFunction("getUserProfile",{userId:t}).then((function(t){if(e("log","\u3010poem\u3011getUserProfile\u8fd4\u56de\u7ed3\u679c:",t," at pages/poem/poem.vue:328"),t.result&&t.result.success&&t.result.userInfo){var r=t.result.userInfo;e("log","\u3010poem\u3011\u4f5c\u8005\u4fe1\u606f:",r," at pages/poem/poem.vue:331"),r.signatureUrl?(e("log","\u3010poem\u3011\u83b7\u53d6\u5230\u4f5c\u8005\u7b7e\u540d:",r.signatureUrl," at pages/poem/poem.vue:333"),n.setData({currentAuthorSignature:r.signatureUrl,isFetchingSignature:!1}),e("log","\u3010poem\u3011\u4f5c\u8005\u7b7e\u540d\u5df2\u8bbe\u7f6e\u5230data\u4e2d"," at pages/poem/poem.vue:338")):(e("log","\u3010poem\u3011\u4f5c\u8005\u672a\u8bbe\u7f6e\u7b7e\u540d\uff0csignatureUrl\u4e3a\u7a7a"," at pages/poem/poem.vue:340"),n.setData({currentAuthorSignature:"",isFetchingSignature:!1}))}else e("log","\u3010poem\u3011\u83b7\u53d6\u4f5c\u8005\u4fe1\u606f\u5931\u8d25\u6216\u6570\u636e\u683c\u5f0f\u9519\u8bef"," at pages/poem/poem.vue:347"),n.setData({currentAuthorSignature:"",isFetchingSignature:!1})})).catch((function(t){e("error","\u3010poem\u3011\u83b7\u53d6\u4f5c\u8005\u7b7e\u540d\u5931\u8d25:",t," at pages/poem/poem.vue:354"),n.setData({currentAuthorSignature:"",isFetchingSignature:!1})}))}},onSignatureLoad:function(t){e("log","\u3010poem\u3011\u7b7e\u540d\u56fe\u7247\u52a0\u8f7d\u6210\u529f:",t," at pages/poem/poem.vue:365")},onSignatureError:function(t){e("error","\u3010poem\u3011\u7b7e\u540d\u56fe\u7247\u52a0\u8f7d\u5931\u8d25:",t," at pages/poem/poem.vue:370")},getPostList:function(t){var n=this;if(e("log","\ud83d\udd0d [Poem] getPostList \u5f00\u59cb\u8c03\u7528"," at pages/poem/poem.vue:374"),e("log","\ud83d\udd0d [Poem] \u5f53\u524d\u72b6\u6001 - isLoading:",this.isLoading,"page:",this.page," at pages/poem/poem.vue:375"),this.isLoading)e("log","\ud83d\udd0d [Poem] \u6b63\u5728\u52a0\u8f7d\u4e2d\uff0c\u8df3\u8fc7\u91cd\u590d\u8c03\u7528"," at pages/poem/poem.vue:378");else{this.setData({isLoading:!0});var r=5*this.page;e("log","\ud83d\udd0d [Poem] \u8bf7\u6c42\u53c2\u6570 - skip:",r,"page:",this.page,"PAGE_SIZE:",5," at pages/poem/poem.vue:387"),e("log","\ud83d\udd0d [Poem] \u5f00\u59cb\u8c03\u7528\u4e91\u51fd\u6570 getPostList"," at pages/poem/poem.vue:389"),e("log","\ud83d\udd0d [Poem] \u4e91\u51fd\u6570\u53c2\u6570:",{skip:r,limit:5,isPoem:!0,isOriginal:!0}," at pages/poem/poem.vue:390"),this.callCloudFunction("getPostList",{skip:r,limit:5,isPoem:!0,isOriginal:!0}).then((function(t){if(e("log","\u2705 [Poem] \u4e91\u51fd\u6570\u8c03\u7528\u6210\u529f\uff0c\u539f\u59cb\u54cd\u5e94:",t," at pages/poem/poem.vue:404"),t.result&&t.result.success){var r=t.result.posts||[];e("log","\u2705 [Poem] \u83b7\u53d6\u5230\u8def\u8bd7\u6b4c\u6570\u91cf:",r.length," at pages/poem/poem.vue:408"),e("log","\u2705 [Poem] \u5b8c\u6574\u54cd\u5e94\u6570\u636e:",t.result," at pages/poem/poem.vue:409"),r.length>0?(e("log","\ud83d\udd0d [Poem] \u8bd7\u6b4c\u6570\u636e\u8be6\u60c5:"," at pages/poem/poem.vue:413"),r.forEach((function(t,n){e("log","\ud83d\udcdd [Poem] \u8bd7\u6b4c".concat(n+1,":"),{_id:t._id,title:t.title,isPoem:t.isPoem,isOriginal:t.isOriginal,content:t.content?t.content.substring(0,50)+"...":"\u65e0\u5185\u5bb9",authorName:t.authorName,createTime:t.createTime}," at pages/poem/poem.vue:415")}))):e("log","\u26a0\ufe0f [Poem] \u6ca1\u6709\u83b7\u53d6\u5230\u4efb\u4f55\u8bd7\u6b4c\u6570\u636e"," at pages/poem/poem.vue:426"),r.forEach((function(e){e.imageUrls&&0!==e.imageUrls.length||(e.imageUrls=e.imageUrl?[e.imageUrl]:[])}));var i=0===n.page?r:n.postList.concat(r);e("log","\u2705 [Poem] \u66f4\u65b0\u540e\u7684postList\u957f\u5ea6:",i.length," at pages/poem/poem.vue:436"),n.setData({postList:i,page:n.page+1,hasMore:5===r.length}),1===n.page&&i.length>0?(e("log","\ud83c\udfaf [Poem] \u9996\u6b21\u52a0\u8f7d\uff0c\u663e\u793a\u7b2c\u4e00\u4e2a\u8bd7\u6b4c"," at pages/poem/poem.vue:446"),e("log","\ud83c\udfaf [Poem] \u7b2c\u4e00\u4e2a\u8bd7\u6b4c\u8be6\u60c5:",{title:i[0].title,imageUrls:i[0].imageUrls,poemBgImage:i[0].poemBgImage,hasBgImage:!!i[0].poemBgImage}," at pages/poem/poem.vue:447"),n.updatePostDisplay(0),i.length>1&&(e("log","\ud83d\udd0d [Poem] \u9884\u52a0\u8f7d\u7b2c2\u5f20\u56fe\u7247"," at pages/poem/poem.vue:457"),n.loadImageForIndex(1)),i.length>2&&(e("log","\ud83d\udd0d [Poem] \u9884\u52a0\u8f7d\u7b2c3\u5f20\u56fe\u7247"," at pages/poem/poem.vue:461"),n.loadImageForIndex(2))):e("log","\u26a0\ufe0f [Poem] \u672a\u83b7\u53d6\u5230\u8bd7\u6b4c\u5e16\u5b50\u6570\u636e\u6216\u975e\u9996\u6b21\u52a0\u8f7d"," at pages/poem/poem.vue:465")}else e("error","\u274c [Poem] \u4e91\u51fd\u6570\u8fd4\u56de\u5931\u8d25:",t.result," at pages/poem/poem.vue:468"),uni.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u274c [Poem] \u4e91\u51fd\u6570\u8c03\u7528\u5931\u8d25:",t," at pages/poem/poem.vue:475"),e("error","\u274c [Poem] \u9519\u8bef\u8be6\u60c5:",{message:t.message,stack:t.stack,code:t.code}," at pages/poem/poem.vue:476"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){e("log","\ud83d\udd0d [Poem] \u4e91\u51fd\u6570\u8c03\u7528\u5b8c\u6210\uff0c\u8bbe\u7f6eloading\u4e3afalse"," at pages/poem/poem.vue:486"),n.setData({isLoading:!1,hasFirstLoad_var:!0}),"function"===typeof t&&t()}))}},touchStart:function(e){this.setData({touchStartX:e.touches[0].clientX,touchStartY:e.touches[0].clientY})},touchEnd:function(e){var t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,r=this.touchStartX-t,i=this.touchStartY-n,o=Math.sqrt(r*r+i*i),a=Math.abs(180*Math.atan2(Math.abs(i),Math.abs(r))/Math.PI);o>80&&Math.abs(r)>50&&a<45&&(r>0?this.nextPost():this.prevPost())},nextPost:function(){var e=this;this.currentPostIndex<this.postList.length-1?(this.setData({isTransitioning:!0}),this.updatePostDisplay(this.currentPostIndex+1),setTimeout((function(){e.setData({isTransitioning:!1})}),500)):this.hasMore&&!this.isLoading&&this.loadMorePosts((function(){e.postList.length>e.currentPostIndex+1&&e.updatePostDisplay(e.currentPostIndex+1)}))},prevPost:function(){var e=this;this.currentPostIndex>0&&(this.setData({isTransitioning:!0}),this.updatePostDisplay(this.currentPostIndex-1),setTimeout((function(){e.setData({isTransitioning:!1})}),500))},onSinglePostTap:function(e){var t=e.currentTarget.dataset.postid;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},onImageError:function(t){e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",t.detail," at pages/poem/poem.vue:572")},loadMorePosts:function(t){var n=this;if(!this.isLoading){var r=5*this.page;e("log","\u5f00\u59cb\u52a0\u8f7d\u66f4\u591a\u8def\u8bd7\u6b4c\uff0cskip:",r,"page:",this.page," at pages/poem/poem.vue:583"),this.callCloudFunction("getPostList",{skip:r,limit:5,isPoem:!0,isOriginal:!0}).then((function(t){if(e("log","\u52a0\u8f7d\u66f4\u591a\u8def\u8bd7\u6b4c\u7ed3\u679c:",t," at pages/poem/poem.vue:591"),t.result&&t.result.success){var r=t.result.posts||[];e("log","\u83b7\u53d6\u5230\u66f4\u591a\u8def\u8bd7\u6b4c\u6570\u91cf:",r.length," at pages/poem/poem.vue:594"),r.forEach((function(e){e.imageUrls&&0!==e.imageUrls.length||(e.imageUrls=e.imageUrl?[e.imageUrl]:[])}));var i=n.postList.concat(r);n.setData({postList:i,page:n.page+1,hasMore:5===r.length});var o=n.postList.length-r.length;r.forEach((function(e,t){n.loadImageForIndex(o+t)}))}})).catch((function(t){e("error","\u52a0\u8f7d\u66f4\u591a\u8def\u8bd7\u6b4c\u5931\u8d25:",t," at pages/poem/poem.vue:614")})).finally((function(){"function"===typeof t&&t()}))}},preloadNextBackgroundImage:function(t){var n=this,r=t+1;r>=this.postList.length?this.hasMore&&!this.isLoading&&this.loadMorePosts((function(){r<n.postList.length&&n.loadImageForIndex(r)})):(e("log","\u5f00\u59cb\u9884\u52a0\u8f7d\u7b2c".concat(r+1,"\u5f20\u56fe\u7247")," at pages/poem/poem.vue:638"),this.loadImageForIndex(r))},resetBackgroundLayers:function(){this.setData({"bgLayers[0].url":"","bgLayers[0].visible":!1,"bgLayers[1].url":"","bgLayers[1].visible":!1,activeLayerIndex:0})},updatePostDisplay:function(t){var n=this;if(!(t<0||t>=this.postList.length)){var r=this.postList[t];if(r){this.setData({currentPost:r,currentPostIndex:t}),this.fetchAuthorSignature(r._openid);var i=r.poemBgImage||r.imageUrls&&r.imageUrls[0]||"";if(!i)return this.resetBackgroundLayers(),void this.preloadNextBackgroundImage(t);var a=this.preloadedImages[i];if(!a){var s=getApp();s.globalData.preloadedImages&&s.globalData.preloadedImages[i]?(a=s.globalData.preloadedImages[i],this.setData((0,o.default)({},"preloadedImages.".concat(i),a))):a=i}var u=""===this.bgLayers[0].url&&""===this.bgLayers[1].url;u?(e("log","\u9996\u6b21\u663e\u793a\u80cc\u666f\u56fe\uff0c\u76f4\u63a5\u8bbe\u7f6e\u7b2c\u4e00\u4e2a\u56fe\u5c42"," at pages/poem/poem.vue:701"),this.setData({"bgLayers[0].url":a,"bgLayers[0].visible":!0,"bgLayers[1].visible":!1,activeLayerIndex:0}),e("log","\u9996\u6b21\u663e\u793a\u5b8c\u6210\uff0c\u7acb\u5373\u9884\u52a0\u8f7d\u7b2c\u4e8c\u5f20\u56fe\u7247"," at pages/poem/poem.vue:710"),this.preloadNextBackgroundImage(t)):(setTimeout((function(){n.switchBackgroundImage(a)}),100),this.preloadNextBackgroundImage(t))}}},switchBackgroundImage:function(t){var n=this;if(t){var r=this.preloadedImages[t],i=r||t;e("log","\u5207\u6362\u80cc\u666f\u56fe:",{originalUrl:t,preloadedUrl:r,finalUrl:i,hasPreloaded:!!r}," at pages/poem/poem.vue:733");var a=this.activeLayerIndex,s=(a+1)%2;this.setData((0,o.default)({},"bgLayers[".concat(s,"].url"),i)),setTimeout((function(){var e;n.setData((e={},(0,o.default)(e,"bgLayers[".concat(a,"].visible"),!1),(0,o.default)(e,"bgLayers[".concat(s,"].visible"),!0),(0,o.default)(e,"activeLayerIndex",s),e))}),r?50:150)}else this.resetBackgroundLayers()},onBackgroundImageLoad:function(t){var n=t.currentTarget.dataset.layerIndex;e("log","\u56fe\u5c42".concat(n,"\u56fe\u7247\u52a0\u8f7d\u5b8c\u6210")," at pages/poem/poem.vue:765")},loadImageForIndex:function(t,n){var r=this,i=this.postList[t];if(i){var a=i.poemBgImage||i.imageUrls&&i.imageUrls[0]||"";if(a){var s=getApp();if(s.globalData.preloadedImages&&s.globalData.preloadedImages[a])return e("log","\u7b2c".concat(t+1,"\u5f20\u56fe\u7247\uff1a\u4f7f\u7528\u5168\u5c40\u9884\u52a0\u8f7d\u7f13\u5b58")," at pages/poem/poem.vue:784"),this.setData((0,o.default)({},"preloadedImages.".concat(a),s.globalData.preloadedImages[a])),void("function"===typeof n&&n(s.globalData.preloadedImages[a]));if(this.preloadedImages[a])e("log","\u7b2c".concat(t+1,"\u5f20\u56fe\u7247\uff1a\u5df2\u5b58\u5728\u672c\u5730\u7f13\u5b58")," at pages/poem/poem.vue:796");else{e("log","\u7b2c".concat(t+1,"\u5f20\u56fe\u7247\uff1a\u5f00\u59cb\u4e0b\u8f7d\u9884\u52a0\u8f7d")," at pages/poem/poem.vue:799");var u="undefined"!==typeof window;if(u&&(a.includes("tcb.qcloud.la")||a.includes("cloudbase")))return e("log","\ud83d\udd0d [H5] \u7b2c".concat(t+1,"\u5f20\u56fe\u7247\u68c0\u6d4b\u5230\u817e\u8baf\u4e91\u5b58\u50a8URL\uff0c\u76f4\u63a5\u4f7f\u7528:"),a," at pages/poem/poem.vue:804"),this.setData((0,o.default)({},"preloadedImages.".concat(a),a)),void("function"===typeof n&&n(a));uni.downloadFile({url:a,success:function(i){200===i.statusCode?(e("log","\u7b2c".concat(t+1,"\u5f20\u56fe\u7247\uff1a\u9884\u52a0\u8f7d\u6210\u529f")," at pages/poem/poem.vue:820"),r.setData((0,o.default)({},"preloadedImages.".concat(a),i.tempFilePath)),"function"===typeof n&&n(i.tempFilePath)):e("error","\u7b2c".concat(t+1,"\u5f20\u56fe\u7247\uff1a\u4e0b\u8f7d\u5931\u8d25\uff0c\u72b6\u6001\u7801:"),i.statusCode," at pages/poem/poem.vue:829")},fail:function(i){e("error","\u7b2c".concat(t+1,"\u5f20\u56fe\u7247\uff1a\u9884\u52a0\u8f7d\u5931\u8d25:"),i," at pages/poem/poem.vue:833");var s="undefined"!==typeof window;s&&(e("log","\ud83d\udd0d [H5] \u7b2c".concat(t+1,"\u5f20\u56fe\u7247\u9884\u52a0\u8f7d\u5931\u8d25\uff0c\u4f7f\u7528\u539fURL:"),a," at pages/poem/poem.vue:837"),r.setData((0,o.default)({},"preloadedImages.".concat(a),a)),"function"===typeof n&&n(a))}})}}else e("log","\u7b2c".concat(t+1,"\u5f20\u56fe\u7247\uff1a\u6ca1\u6709\u56fe\u7247URL")," at pages/poem/poem.vue:777")}else e("log","\u7b2c".concat(t+1,"\u5f20\u56fe\u7247\uff1a\u5e16\u5b50\u6570\u636e\u4e0d\u5b58\u5728")," at pages/poem/poem.vue:772")}}};t.default=p,t.default.components=Object.assign({skeleton:u.default,"folder-selector":c.default},t.default.components||{})}).call(this,n("f3b9")["default"],n("ed83")["default"])},"0f7e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoonshotSimpleModel=void 0;var r=n("7a9b"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};function s(e){var t=e.messages,n=e.model,r=e.temperature,o=e.tools,a=e.top_p;return i(i({},e),{messages:t,model:n,tools:o,top_p:a,temperature:r})}var u=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="moonshot/v1/chat/completions",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,this.req({url:this.url,data:i(i({},s(e)),{stream:!1}),stream:!1,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,i(i({},n),{rawResponse:n})]}}))}))},e.prototype.doStream=function(e,t){return o(this,void 0,void 0,(function(){var n,o,u,c,l;return a(this,(function(a){switch(a.label){case 0:return n=null,[4,this.req({url:this.url,data:i(i({},s(e)),{stream:!0}),stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return o=a.sent(),u=(0,r.toPolyfillReadable)(o),c=(0,r.intoStandardStream)(u),l=c.pipeThrough(new r.TransformStream({transform:function(e,t){var o=e.choices.map((function(e){var t=e.delta;return null==n&&(n=(0,r.isToolCallAssistantMessage)(t)),n?i(i({},e),{finish_reason:"tool_calls",delta:t}):e})),a=i(i({},e),{choices:o});t.enqueue(i(i({},a),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(l)]}}))}))},e}();t.MoonshotSimpleModel=u},"102a":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.SinglePromise=void 0;var i=r(n("127e")),o=r(n("ee10")),a=r(n("67ad")),s=r(n("0bdb")),u=new Map,c=function(){function e(t){(0,a.default)(this,e),this.clientId=(null===t||void 0===t?void 0:t.clientId)||"",u=u||new Map}return(0,s.default)(e,[{key:"run",value:function(){var e=(0,o.default)(i.default.mark((function e(t,n){var r,a=this;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t="".concat(this.clientId,"_").concat(t),r=u.get(t),r||(r=new Promise((function(e,r){(0,o.default)(i.default.mark((function o(){var s;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,a.runIdlePromise();case 3:return s=n(),i.t0=e,i.next=7,s;case 7:i.t1=i.sent,(0,i.t0)(i.t1),i.next=14;break;case 11:i.prev=11,i.t2=i["catch"](0),r(i.t2);case 14:return i.prev=14,u.delete(t),i.finish(14);case 17:case"end":return i.stop()}}),o,null,[[0,11,14,17]])})))()})),u.set(t,r)),e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"runIdlePromise",value:function(){return Promise.resolve()}}]),e}();t.SinglePromise=c},"11ca":function(e,t,n){(function(t,r,i){var o=n("127e"),a=n("ee10"),s=n("3b2d"),u=n("fd09"),c=n("285e");function l(e){return e&&"object"===s(e)?Array.isArray(e)?e.slice():Object.assign({},e):{}}function d(e,t,n){var r=n instanceof Error?n:new Error(t||e);return r.code=e,n&&n!==r&&(r.originalError=n),r}function f(e){if(e&&e.$tcb&&"function"===typeof e.$tcb.callFunction)return e.$tcb;if("function"===typeof getApp){var t=getApp();if(t&&t.$tcb&&"function"===typeof t.$tcb.callFunction)return t.$tcb}return"undefined"!==typeof uni&&uni.$tcb&&"function"===typeof uni.$tcb.callFunction?uni.$tcb:null}function p(e,t){return h.apply(this,arguments)}function h(){return h=a(o.mark((function e(n,i){var a;return o.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("tcb"!==n){e.next=5;break}if(a=f(i.context),a){e.next=4;break}throw d("TCB_NOT_AVAILABLE","TCB \u5b9e\u4f8b\u4e0d\u53ef\u7528");case 4:return e.abrupt("return",a.callFunction(i.options));case 5:if("wx-cloud"!==n||"undefined"===typeof t||!t.cloud||"function"!==typeof t.cloud.callFunction){e.next=7;break}return e.abrupt("return",t.cloud.callFunction(i.options));case 7:if("undefined"===typeof r||"function"!==typeof r.callFunction){e.next=9;break}return e.abrupt("return",r.callFunction(i.options));case 9:throw d("NO_CLOUD_METHOD","\u5f53\u524d\u73af\u5883\u4e0d\u652f\u6301\u4e91\u51fd\u6570\u8c03\u7528");case 10:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function g(){return g=a(o.mark((function e(t){var n,r,a,s,f,h,g,v,m,y,_,b,w,S,I,C,T,O,E,x,P,k,A,R=arguments;return o.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=R.length>1&&void 0!==R[1]?R[1]:{},r=R.length>2&&void 0!==R[2]?R[2]:{},t&&"string"===typeof t){e.next=4;break}return e.abrupt("return",Promise.reject(d("INVALID_NAME","\u4e91\u51fd\u6570\u540d\u79f0\u65e0\u6548")));case 4:if(a=r.pageTag,s=void 0===a?"global":a,f=r.retry,h=void 0===f?0:f,g=r.retryDelay,v=void 0===g?300:g,m=r.context,y=r.injectOpenId,_=r.requireAuth,b=void 0!==_&&_,w="boolean"===typeof y?y:!["login","getOpenId"].includes(t),S=l(n),I=null,!w){e.next=29;break}return e.prev=9,e.next=12,c.getOpenId();case 12:I=e.sent,e.next=19;break;case 15:throw e.prev=15,e.t0=e["catch"](9),i("error","[cloudCall][".concat(s,"] \u83b7\u53d6 openid \u5931\u8d25"),e.t0," at utils/cloudCall.js:83"),d("NO_OPENID","\u83b7\u53d6 openid \u5931\u8d25",e.t0);case 19:if(I){e.next=28;break}if(!b){e.next=25;break}throw C=d("NO_OPENID","\u7528\u6237\u672a\u767b\u5f55\u6216 openid \u7f3a\u5931"),"undefined"!==typeof uni&&uni.showToast&&uni.showToast({title:"\u8bf7\u5148\u767b\u5f55",icon:"none"}),i("warn","[cloudCall][".concat(s,'] openid \u7f3a\u5931\uff0c\u8c03\u7528 "').concat(t,'" \u5931\u8d25')," at utils/cloudCall.js:96"),C;case 25:i("warn","[cloudCall][".concat(s,'] openid \u7f3a\u5931\uff0c\u8c03\u7528 "').concat(t,'" \u5c06\u4e0d\u6ce8\u5165 openid')," at utils/cloudCall.js:99"),e.next=29;break;case 28:S.openid||(S.openid=I);case 29:T=u.getCloudFunctionMethod(),O=Math.max(0,parseInt(h,10))+1,E=1;case 32:if(!(E<=O)){e.next=59;break}return e.prev=33,i("log","[cloudCall][".concat(s,'] \u8c03\u7528\u4e91\u51fd\u6570 "').concat(t,'"\uff08\u5c1d\u8bd5 ').concat(E,"/").concat(O,"\uff09"),S," at utils/cloudCall.js:110"),e.next=37,p(T,{context:m,options:{name:t,data:S}});case 37:return x=e.sent,i("log","[cloudCall][".concat(s,'] \u4e91\u51fd\u6570 "').concat(t,'" \u8c03\u7528\u6210\u529f'),x," at utils/cloudCall.js:118"),e.abrupt("return",x);case 42:if(e.prev=42,e.t1=e["catch"](33),P=E===O,k=e.t1&&e.t1.code?e.t1.code:null===e.t1||void 0===e.t1?void 0:e.t1.errCode,i("error","[cloudCall][".concat(s,'] \u4e91\u51fd\u6570 "').concat(t,'" \u8c03\u7528\u5931\u8d25\uff08\u5c1d\u8bd5 ').concat(E,"/").concat(O,"\uff09"),e.t1," at utils/cloudCall.js:124"),"NO_OPENID"!==k){e.next=49;break}throw d("NO_OPENID","\u7528\u6237\u672a\u767b\u5f55\u6216 openid \u7f3a\u5931",e.t1);case 49:if(!P){e.next=53;break}throw A=d(k||"CLOUD_CALL_FAILED","\u4e91\u51fd\u6570\u8c03\u7528\u5931\u8d25",e.t1),"undefined"!==typeof uni&&uni.showToast&&uni.showToast({title:"\u7f51\u7edc\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",icon:"none"}),A;case 53:if(!(v>0)){e.next=56;break}return e.next=56,new Promise((function(e){return setTimeout(e,v)}));case 56:E+=1,e.next=32;break;case 59:throw d("CLOUD_CALL_FAILED","\u4e91\u51fd\u6570\u8c03\u7528\u5931\u8d25");case 60:case"end":return e.stop()}}),e,null,[[9,15],[33,42]])}))),g.apply(this,arguments)}e.exports={cloudCall:function(e){return g.apply(this,arguments)}}}).call(this,n("ed83")["default"],n("861b")["uniCloud"],n("f3b9")["default"])},"127e":function(e,t,n){var r=n("3b2d"),i=n("9fc1")();e.exports=i;try{regeneratorRuntime=i}catch(o){"object"===("undefined"===typeof globalThis?"undefined":r(globalThis))?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},"133d":function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("127e")),a=i(n("ee10")),s=(getApp(),n("11ca")),u=s.cloudCall,c={data:function(){return{poemId:"",password:"",confirmPassword:"",nickName:"",isRegistering:!1}},computed:{canRegister:function(){return this.poemId.trim()&&this.password.trim()&&this.confirmPassword.trim()&&this.nickName.trim()&&this.password===this.confirmPassword}},onLoad:function(){},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u(e,t,Object.assign({pageTag:"register",context:this},n))},performAuth:function(){var t=this;return(0,a.default)(o.default.mark((function i(){return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return e("log","\ud83d\udd10 [Register] \u5f00\u59cb\u8ba4\u8bc1\u6d41\u7a0b"," at pages/register/register.vue:108"),i.abrupt("return",new Promise((function(i,o){var a=n("fd09"),s=a.getCurrentPlatform,u=s();if("h5"===u||"app"===u)if(t.$tcb&&t.$tcb.auth){var c=t.$tcb.auth().currentUser;c?(e("log","\u2705 [\u6ce8\u518c] \u7528\u6237\u5df2\u767b\u5f55\uff0c\u8df3\u8fc7\u533f\u540d\u767b\u5f55"," at pages/register/register.vue:125"),i(c)):(e("log","\ud83d\udd10 [\u6ce8\u518c] \u5c1d\u8bd5\u533f\u540d\u767b\u5f55..."," at pages/register/register.vue:119"),t.$tcb.auth().signInAnonymously().then((function(t){e("log","\u2705 [\u6ce8\u518c] \u533f\u540d\u767b\u5f55\u6210\u529f:",t," at pages/register/register.vue:121"),i(t)})).catch(o))}else o(new Error("TCB\u8ba4\u8bc1\u4e0d\u53ef\u7528"));else if("miniprogram"===u)if(r.cloud&&r.cloud.auth){var l=r.cloud.auth().currentUser;l?(e("log","\u2705 [\u6ce8\u518c] \u7528\u6237\u5df2\u767b\u5f55\uff0c\u8df3\u8fc7\u533f\u540d\u767b\u5f55"," at pages/register/register.vue:142"),i(l)):(e("log","\ud83d\udd10 [\u6ce8\u518c] \u5c1d\u8bd5\u533f\u540d\u767b\u5f55..."," at pages/register/register.vue:136"),r.cloud.auth().signInAnonymously().then((function(t){e("log","\u2705 [\u6ce8\u518c] \u533f\u540d\u767b\u5f55\u6210\u529f:",t," at pages/register/register.vue:138"),i(t)})).catch(o))}else o(new Error("\u5fae\u4fe1\u4e91\u5f00\u53d1\u8ba4\u8bc1\u4e0d\u53ef\u7528"));else o(new Error("\u4e0d\u652f\u6301\u7684\u5e73\u53f0: ".concat(u)))})));case 2:case"end":return i.stop()}}),i)})))()},onPoemIdInput:function(e){this.poemId=e.detail.value},onPasswordInput:function(e){this.password=e.detail.value},onConfirmPasswordInput:function(e){this.confirmPassword=e.detail.value},onNickNameInput:function(e){this.nickName=e.detail.value},onRegister:function(){var t=this;return(0,a.default)(o.default.mark((function n(){var r,i,a,s,u,c;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.canRegister&&!t.isRegistering){n.next=2;break}return n.abrupt("return");case 2:if(t.password===t.confirmPassword){n.next=5;break}return uni.showToast({title:"\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4",icon:"none",duration:3e3}),n.abrupt("return");case 5:return t.isRegistering=!0,uni.showLoading({title:"\u6ce8\u518c\u4e2d...",mask:!0}),n.prev=7,n.next=10,t.performAuth();case 10:return n.next=12,t.callCloudFunction("registerUser",{poemId:t.poemId.trim(),password:t.password.trim(),nickName:t.nickName.trim()});case 12:r=n.sent,e("log","\ud83d\udd0d [\u6ce8\u518c] \u4e91\u51fd\u6570\u8fd4\u56de\u7ed3\u679c:",r," at pages/register/register.vue:202"),r.result&&r.result.success?(i=r.result.userInfo,a=r.result.openid,e("log","\u2705 [\u6ce8\u518c] \u6ce8\u518c\u6210\u529f:",i," at pages/register/register.vue:209"),s=getApp(),s.globalData.userInfo=i,s.globalData.openid=a,uni.setStorageSync("userInfo",i),uni.setStorageSync("userOpenId",a),uni.showToast({title:"\u6ce8\u518c\u6210\u529f",icon:"success"}),setTimeout((function(){uni.switchTab({url:"/pages/poem/poem"})}),1e3)):(c=(null===(u=r.result)||void 0===u?void 0:u.message)||"\u6ce8\u518c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",uni.showToast({title:c,icon:"none",duration:3e3})),n.next=21;break;case 17:n.prev=17,n.t0=n["catch"](7),e("error","\u274c [\u6ce8\u518c] \u6ce8\u518c\u5931\u8d25:",n.t0," at pages/register/register.vue:243"),uni.showToast({title:"\u6ce8\u518c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none",duration:3e3});case 21:return n.prev=21,uni.hideLoading(),t.isRegistering=!1,n.finish(21);case 25:case"end":return n.stop()}}),n,null,[[7,17,21,25]])})))()},goToLogin:function(){uni.navigateBack()}}};t.default=c}).call(this,n("f3b9")["default"],n("ed83")["default"])},1381:function(e,t){e.exports=function(e){return this.__data__.get(e)}},"139b":function(e,t){var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(e).padStart(t,"0")},r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss",r=e instanceof Date?e:new Date(e);if(Number.isNaN(r.getTime()))return"";var i={yyyy:String(r.getFullYear()),MM:n(r.getMonth()+1),dd:n(r.getDate()),HH:n(r.getHours()),mm:n(r.getMinutes()),ss:n(r.getSeconds())};return t.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(e){return i[e]}))};e.exports={formatTimeAgo:function(e){var t=new Date,n=new Date(e),r=t.getTime()-n.getTime(),i=Math.floor(r/1e3),o=Math.floor(i/60),a=Math.floor(o/60),s=Math.floor(a/24);if(s>=7){var u=n.getFullYear(),c=("0"+(n.getMonth()+1)).slice(-2),l=("0"+n.getDate()).slice(-2);return"".concat(u,"-").concat(c,"-").concat(l)}return s>=1?"".concat(s,"\u5929\u524d"):a>=1?"".concat(a,"\u5c0f\u65f6\u524d"):o>=1?"".concat(o,"\u5206\u949f\u524d"):"\u521a\u521a"},formatRelativeTime:function(e){var t=Date.now(),n=e instanceof Date?e.getTime():new Date(e).getTime();if(Number.isNaN(n))return"";var i=t-n,o=Math.floor(Math.abs(i)/1e3),a=i>=0?"\u524d":"\u540e";if(o<60)return"\u521a\u521a";var s=Math.floor(o/60);if(s<60)return"".concat(s,"\u5206\u949f").concat(a);var u=Math.floor(s/60);if(u<24)return"".concat(u,"\u5c0f\u65f6").concat(a);var c=Math.floor(u/24);return c<7?"".concat(c,"\u5929").concat(a):r(n,"yyyy-MM-dd")},formatDate:r}},"13cf":function(e,t,n){"use strict";(function(e){var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudbaseCache=void 0;var a=n("59ad"),s=n("37e5"),u=n("9e9d"),c=function(e){function t(t){var n=e.call(this)||this;return n.root=t,t.tcbCacheObject||(t.tcbCacheObject={}),n}return r(t,e),t.prototype.setItem=function(e,t){this.root.tcbCacheObject[e]=t},t.prototype.getItem=function(e){return this.root.tcbCacheObject[e]},t.prototype.removeItem=function(e){delete this.root.tcbCacheObject[e]},t.prototype.clear=function(){delete this.root.tcbCacheObject},t}(a.AbstractStorage);var l=function(){function t(e){this.keys={};var t=e.persistence,n=e.platformInfo,r=void 0===n?{}:n,i=e.keys,o=void 0===i?{}:i;this.platformInfo=r,this.storage||(this.persistenceTag=this.platformInfo.adapter.primaryStorage||t,this.storage=function(e,t){switch(e){case"local":return t.localStorage?t.localStorage:((0,s.printWarn)(u.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new c(t.root));case"none":return new c(t.root);default:return t.localStorage?t.localStorage:((0,s.printWarn)(u.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new c(t.root))}}(this.persistenceTag,this.platformInfo.adapter),this.keys=o)}return Object.defineProperty(t.prototype,"mode",{get:function(){return this.storage.mode||"sync"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"persistence",{get:function(){return this.persistenceTag},enumerable:!1,configurable:!0}),t.prototype.setStore=function(e,t,n){if("async"!==this.mode){if(this.storage)try{var r={version:n||"localCachev1",content:t};this.storage.setItem(e,JSON.stringify(r))}catch(i){throw new Error(JSON.stringify({code:u.ERRORS.OPERATION_FAIL,msg:"[".concat((0,u.getSdkName)(),"][").concat(u.ERRORS.OPERATION_FAIL,"]setStore failed"),info:i}))}}else(0,s.printWarn)(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use setStoreAsync insteed")},t.prototype.setStoreAsync=function(e,t,n){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:if(!this.storage)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),r={version:n||"localCachev1",content:t},[4,this.storage.setItem(e,JSON.stringify(r))];case 2:return i.sent(),[3,4];case 3:return i.sent(),[2];case 4:return[2]}}))}))},t.prototype.getStore=function(t,n){var r;if("async"!==this.mode){try{if("undefined"!==typeof e&&(null===(r=Object({VUE_APP_DARK_MODE:"false",VUE_APP_NAME:"poementer",VUE_APP_PLATFORM:"app-plus",NODE_ENV:"production",BASE_URL:"/"}))||void 0===r?void 0:r.tcb_token))return Object({VUE_APP_DARK_MODE:"false",VUE_APP_NAME:"poementer",VUE_APP_PLATFORM:"app-plus",NODE_ENV:"production",BASE_URL:"/"}).tcb_token;if(!this.storage)return""}catch(a){return""}n=n||"localCachev1";var i=this.storage.getItem(t);if(!i)return"";if(i.indexOf(n)>=0){var o=JSON.parse(i);return o.content}return""}(0,s.printWarn)(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getStoreAsync insteed")},t.prototype.getStoreAsync=function(t,n){var r;return i(this,void 0,void 0,(function(){var i,a;return o(this,(function(o){switch(o.label){case 0:try{if("undefined"!==typeof e&&(null===(r=Object({VUE_APP_DARK_MODE:"false",VUE_APP_NAME:"poementer",VUE_APP_PLATFORM:"app-plus",NODE_ENV:"production",BASE_URL:"/"}))||void 0===r?void 0:r.tcb_token))return[2,Object({VUE_APP_DARK_MODE:"false",VUE_APP_NAME:"poementer",VUE_APP_PLATFORM:"app-plus",NODE_ENV:"production",BASE_URL:"/"}).tcb_token];if(!this.storage)return[2,""]}catch(s){return[2,""]}return n=n||"localCachev1",[4,this.storage.getItem(t)];case 1:return i=o.sent(),i&&i.indexOf(n)>=0?(a=JSON.parse(i),[2,a.content]):[2,""]}}))}))},t.prototype.removeStore=function(e){"async"!==this.mode?this.storage.removeItem(e):(0,s.printWarn)(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use removeStoreAsync insteed")},t.prototype.removeStoreAsync=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.storage.removeItem(e)];case 1:return t.sent(),[2]}}))}))},t}();t.CloudbaseCache=l}).call(this,n("28d0"))},"140c":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("34cf")),o=r(n("3b2d")),a=r(n("67ad")),s=r(n("0bdb")),u=function(){function e(t){if((0,a.default)(this,e),this.params={},"string"===typeof t)this.parse(t);else if(t&&"object"===(0,o.default)(t))for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&this.append(n,t[n])}return(0,s.default)(e,[{key:"parse",value:function(e){var t=this,n=e.split("&");n.forEach((function(e){var n=e.split("=").map(decodeURIComponent),r=(0,i.default)(n,2),o=r[0],a=r[1];t.append(o,a)}))}},{key:"append",value:function(e,t){this.params[e]?this.params[e]=this.params[e].concat([t]):this.params[e]=[t]}},{key:"get",value:function(e){return this.params[e]?this.params[e][0]:null}},{key:"getAll",value:function(e){return this.params[e]||[]}},{key:"delete",value:function(e){delete this.params[e]}},{key:"has",value:function(e){return Object.prototype.hasOwnProperty.call(this.params,e)}},{key:"set",value:function(e,t){this.params[e]=[t]}},{key:"toString",value:function(){var e=this,t=[],n=function(n){Object.prototype.hasOwnProperty.call(e.params,n)&&e.params[n].forEach((function(e){t.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e)))}))};for(var r in this.params)n(r);return t.join("&")}}]),e}(),c=u;t.default=c},"142b":function(e,t,n){var r=n("b88a"),i=n("3461");e.exports=function(e,t,n){var o=t(e);return i(e)?o:r(o,n(e))}},1484:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuidv4=function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)}))}},"153e":function(e,t,n){"use strict";n.r(t);var r=n("b8a7"),i=n("5c7c");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"15ee":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.createReadableStreamWrapper=function(e){s(function(e){if(!l(e))return!1;if(!d(new e))return!1;return!0}(e));var t=function(e){try{return new e({type:"bytes"}),!0}catch(t){return!1}}(e);return function(n,r){var i=void 0===r?{}:r,o=i.type;if(o=v(o),"bytes"!==o||t||(o=void 0),n.constructor===e&&("bytes"!==o||h(n)))return n;if("bytes"===o){var a=g(n,{type:o});return new e(a)}a=g(n);return new e(a)}},t.createTransformStreamWrapper=function(e){return s(function(e){if(!l(e))return!1;if(!p(new e))return!1;return!0}(e)),function(t){if(t.constructor===e)return t;var n=I(t);return new e(n)}},t.createWrappingReadableSource=g,t.createWrappingTransformer=I,t.createWrappingWritableSink=w,t.createWritableStreamWrapper=function(e){return s(function(e){if(!l(e))return!1;if(!f(new e))return!1;return!0}(e)),function(t){if(t.constructor===e)return t;var n=w(t);return new e(n)}};var i=r(n("3b2d")),o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e){if(!e)throw new TypeError("Assertion failed")}function u(){}function c(e){return"object"===(0,i.default)(e)&&null!==e||"function"===typeof e}function l(e){if("function"!==typeof e)return!1;var t=!1;try{new e({start:function(){t=!0}})}catch(n){}return t}function d(e){return!!c(e)&&"function"===typeof e.getReader}function f(e){return!!c(e)&&"function"===typeof e.getWriter}function p(e){return!!c(e)&&(!!d(e.readable)&&!!f(e.writable))}function h(e){try{var t=e.getReader({mode:"byob"});return t.releaseLock(),!0}catch(n){return!1}}function g(e,t){var n,r=void 0===t?{}:t,i=r.type;return s(d(e)),s(!1===e.locked),i=v(i),n="bytes"===i?new b(e):new y(e),n}function v(e){var t=String(e);if("bytes"===t)return t;if(void 0===e)return e;throw new RangeError("Invalid type is specified")}var m=function(){function e(e){this._underlyingReader=void 0,this._readerMode=void 0,this._readableStreamController=void 0,this._pendingRead=void 0,this._underlyingStream=e,this._attachDefaultReader()}return e.prototype.start=function(e){this._readableStreamController=e},e.prototype.cancel=function(e){return s(void 0!==this._underlyingReader),this._underlyingReader.cancel(e)},e.prototype._attachDefaultReader=function(){if("default"!==this._readerMode){this._detachReader();var e=this._underlyingStream.getReader();this._readerMode="default",this._attachReader(e)}},e.prototype._attachReader=function(e){var t=this;s(void 0===this._underlyingReader),this._underlyingReader=e;var n=this._underlyingReader.closed;n&&n.then((function(){return t._finishPendingRead()})).then((function(){e===t._underlyingReader&&t._readableStreamController.close()}),(function(n){e===t._underlyingReader&&t._readableStreamController.error(n)})).catch(u)},e.prototype._detachReader=function(){void 0!==this._underlyingReader&&(this._underlyingReader.releaseLock(),this._underlyingReader=void 0,this._readerMode=void 0)},e.prototype._pullWithDefaultReader=function(){var e=this;this._attachDefaultReader();var t=this._underlyingReader.read().then((function(t){var n=e._readableStreamController;t.done?e._tryClose():n.enqueue(t.value)}));return this._setPendingRead(t),t},e.prototype._tryClose=function(){try{this._readableStreamController.close()}catch(e){}},e.prototype._setPendingRead=function(e){var t,n=this,r=function(){n._pendingRead===t&&(n._pendingRead=void 0)};this._pendingRead=t=e.then(r,r)},e.prototype._finishPendingRead=function(){var e=this;if(this._pendingRead){var t=function(){return e._finishPendingRead()};return this._pendingRead.then(t,t)}},e}(),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.pull=function(){return this._pullWithDefaultReader()},t}(m);function _(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var b=function(e){function t(t){var n=this,r=h(t);return n=e.call(this,t)||this,n._supportsByob=r,n}return a(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return"bytes"},enumerable:!1,configurable:!0}),t.prototype._attachByobReader=function(){if("byob"!==this._readerMode){s(this._supportsByob),this._detachReader();var e=this._underlyingStream.getReader({mode:"byob"});this._readerMode="byob",this._attachReader(e)}},t.prototype.pull=function(){if(this._supportsByob){var e=this._readableStreamController.byobRequest;if(e)return this._pullWithByobRequest(e)}return this._pullWithDefaultReader()},t.prototype._pullWithByobRequest=function(e){var t=this;this._attachByobReader();var n=new Uint8Array(e.view.byteLength),r=this._underlyingReader.read(n).then((function(n){t._readableStreamController,n.done?(t._tryClose(),e.respond(0)):(function(e,t){var n=_(e),r=_(t);r.set(n,0)}(n.value,e.view),e.respond(n.value.byteLength))}));return this._setPendingRead(r),r},t}(m);function w(e){s(f(e)),s(!1===e.locked);var t=e.getWriter();return new S(t)}var S=function(){function e(e){var t=this;this._writableStreamController=void 0,this._pendingWrite=void 0,this._state="writable",this._storedError=void 0,this._underlyingWriter=e,this._errorPromise=new Promise((function(e,n){t._errorPromiseReject=n})),this._errorPromise.catch(u)}return e.prototype.start=function(e){var t=this;this._writableStreamController=e,this._underlyingWriter.closed.then((function(){t._state="closed"})).catch((function(e){return t._finishErroring(e)}))},e.prototype.write=function(e){var t=this,n=this._underlyingWriter;if(null===n.desiredSize)return n.ready;var r=n.write(e);r.catch((function(e){return t._finishErroring(e)})),n.ready.catch((function(e){return t._startErroring(e)}));var i=Promise.race([r,this._errorPromise]);return this._setPendingWrite(i),i},e.prototype.close=function(){var e=this;return void 0===this._pendingWrite?this._underlyingWriter.close():this._finishPendingWrite().then((function(){return e.close()}))},e.prototype.abort=function(e){if("errored"!==this._state){var t=this._underlyingWriter;return t.abort(e)}},e.prototype._setPendingWrite=function(e){var t,n=this,r=function(){n._pendingWrite===t&&(n._pendingWrite=void 0)};this._pendingWrite=t=e.then(r,r)},e.prototype._finishPendingWrite=function(){var e=this;if(void 0===this._pendingWrite)return Promise.resolve();var t=function(){return e._finishPendingWrite()};return this._pendingWrite.then(t,t)},e.prototype._startErroring=function(e){var t=this;if("writable"===this._state){this._state="erroring",this._storedError=e;var n=function(){return t._finishErroring(e)};void 0===this._pendingWrite?n():this._finishPendingWrite().then(n,n),this._writableStreamController.error(e)}},e.prototype._finishErroring=function(e){"writable"===this._state&&this._startErroring(e),"erroring"===this._state&&(this._state="errored",this._errorPromiseReject(this._storedError))},e}();function I(e){s(p(e));var t=e.readable,n=e.writable;s(!1===t.locked),s(!1===n.locked);var r,i=t.getReader();try{r=n.getWriter()}catch(o){throw i.releaseLock(),o}return new C(i,r)}var C=function(){function e(e,t){var n=this;this._transformStreamController=void 0,this._onRead=function(e){if(!e.done)return n._transformStreamController.enqueue(e.value),n._reader.read().then(n._onRead)},this._onError=function(e){n._flushReject(e),n._transformStreamController.error(e),n._reader.cancel(e).catch(u),n._writer.abort(e).catch(u)},this._onTerminate=function(){n._flushResolve(),n._transformStreamController.terminate();var e=new TypeError("TransformStream terminated");n._writer.abort(e).catch(u)},this._reader=e,this._writer=t,this._flushPromise=new Promise((function(e,t){n._flushResolve=e,n._flushReject=t}))}return e.prototype.start=function(e){this._transformStreamController=e,this._reader.read().then(this._onRead).then(this._onTerminate,this._onError);var t=this._reader.closed;t&&t.then(this._onTerminate,this._onError)},e.prototype.transform=function(e){return this._writer.write(e)},e.prototype.flush=function(){var e=this;return this._writer.close().then((function(){return e._flushPromise}))},e}()},"164b":function(e,t,n){var r=n("6c95"),i=n("3ea6"),o=n("8b83"),a=n("8c3e"),s=n("a72f"),u=n("98a0"),c=n("86b3"),l=n("3649"),d=n("d500"),f=n("3283"),p=n("c689"),h=n("8073"),g=n("51f4"),v=n("e7f4"),m=n("5901"),y=n("3461"),_=n("8203"),b=n("770b"),w=n("c823"),S=n("4865"),I=n("92d6"),C=n("b7ca"),T={};T["[object Arguments]"]=T["[object Array]"]=T["[object ArrayBuffer]"]=T["[object DataView]"]=T["[object Boolean]"]=T["[object Date]"]=T["[object Float32Array]"]=T["[object Float64Array]"]=T["[object Int8Array]"]=T["[object Int16Array]"]=T["[object Int32Array]"]=T["[object Map]"]=T["[object Number]"]=T["[object Object]"]=T["[object RegExp]"]=T["[object Set]"]=T["[object String]"]=T["[object Symbol]"]=T["[object Uint8Array]"]=T["[object Uint8ClampedArray]"]=T["[object Uint16Array]"]=T["[object Uint32Array]"]=!0,T["[object Error]"]=T["[object Function]"]=T["[object WeakMap]"]=!1,e.exports=function e(t,n,O,E,x,P){var k,A=1&n,R=2&n,D=4&n;if(O&&(k=x?O(t,E,x,P):O(t)),void 0!==k)return k;if(!w(t))return t;var L=y(t);if(L){if(k=g(t),!A)return c(t,k)}else{var N=h(t),M="[object Function]"==N||"[object GeneratorFunction]"==N;if(_(t))return u(t,A);if("[object Object]"==N||"[object Arguments]"==N||M&&!x){if(k=R||M?{}:m(t),!A)return R?d(t,s(k,t)):l(t,a(k,t))}else{if(!T[N])return x?t:{};k=v(t,N,A)}}P||(P=new r);var $=P.get(t);if($)return $;P.set(t,k),S(t)?t.forEach((function(r){k.add(e(r,n,O,r,t,P))})):b(t)&&t.forEach((function(r,i){k.set(i,e(r,n,O,i,t,P))}));var j=D?R?p:f:R?C:I,U=L?void 0:j(t);return i(U||t,(function(r,i){U&&(i=r,r=t[i]),o(k,i,e(r,n,O,i,t,P))})),k}},1673:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),style:e._$s(0,"s","padding-top: "+e.statusBarHeight+"px;"),attrs:{_i:0}},[n("view",{staticClass:e._$s(1,"sc","header"),style:e._$s(1,"s","top: "+e.statusBarHeight+"px;"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","header-left"),attrs:{_i:2},on:{click:e.goBack}},[n("text",{staticClass:e._$s(3,"sc","back-icon"),attrs:{_i:3}})]),n("text",{staticClass:e._$s(4,"sc","header-title"),attrs:{_i:4}}),n("view",{staticClass:e._$s(5,"sc","header-right"),attrs:{_i:5},on:{click:e.refreshFeedbackList}},[n("text",{staticClass:e._$s(6,"sc","refresh-icon"),attrs:{_i:6}})])]),n("view",{staticClass:e._$s(7,"sc","feedback-list"),attrs:{_i:7}},[e._$s(8,"i",e.feedbackList.length>0)?e._l(e._$s(9,"f",{forItems:e.feedbackList}),(function(t,r,i,o){return n("view",{key:e._$s(9,"f",{forIndex:i,key:r}),class:e._$s("9-"+o,"c","feedback-item "+(t.isProcessed?"processed":"")),attrs:{_i:"9-"+o}},[n("view",{staticClass:e._$s("10-"+o,"sc","feedback-header"),attrs:{_i:"10-"+o}},[n("view",{staticClass:e._$s("11-"+o,"sc","user-info"),attrs:{_i:"11-"+o}},[n("text",{staticClass:e._$s("12-"+o,"sc","user-name"),attrs:{_i:"12-"+o}},[e._v(e._$s("12-"+o,"t0-0",e._s(t.userName||"\u533f\u540d\u7528\u6237")))]),n("text",{staticClass:e._$s("13-"+o,"sc","feedback-time"),attrs:{_i:"13-"+o}},[e._v(e._$s("13-"+o,"t0-0",e._s(t.formattedCreateTime)))])]),n("view",{class:e._$s("14-"+o,"c","status-badge "+(t.isProcessed?"processed":"pending")),attrs:{_i:"14-"+o}},[e._v(e._$s("14-"+o,"t0-0",e._s(t.isProcessed?"\u5df2\u5904\u7406":"\u5f85\u5904\u7406")))])]),n("view",{staticClass:e._$s("15-"+o,"sc","feedback-content"),attrs:{_i:"15-"+o}},[n("text",{staticClass:e._$s("16-"+o,"sc","content-text"),attrs:{_i:"16-"+o}},[e._v(e._$s("16-"+o,"t0-0",e._s(t.content)))])]),e._$s("17-"+o,"i",t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("17-"+o,"sc","feedback-images"),attrs:{_i:"17-"+o}},[n("view",{staticClass:e._$s("18-"+o,"sc","image-grid"),attrs:{_i:"18-"+o}},e._l(e._$s("19-"+o,"f",{forItems:t.imageUrls}),(function(r,i,a,s){return n("image",{key:e._$s("19-"+o,"f",{forIndex:a,key:i}),staticClass:e._$s("19-"+o+"-"+s,"sc","feedback-image"),attrs:{src:e._$s("19-"+o+"-"+s,"a-src",r),"data-src":e._$s("19-"+o+"-"+s,"a-data-src",r),"data-urls":e._$s("19-"+o+"-"+s,"a-data-urls",t.imageUrls),_i:"19-"+o+"-"+s},on:{click:e.previewImage}})})),0)]):e._e(),n("view",{staticClass:e._$s("20-"+o,"sc","feedback-actions"),attrs:{_i:"20-"+o}},[e._$s("21-"+o,"i",!t.isProcessed)?n("button",{staticClass:e._$s("21-"+o,"sc","action-btn process-btn"),attrs:{"data-id":e._$s("21-"+o,"a-data-id",t._id),"data-index":e._$s("21-"+o,"a-data-index",r),_i:"21-"+o},on:{click:e.markAsProcessed}}):e._e(),n("button",{staticClass:e._$s("22-"+o,"sc","action-btn delete-btn"),attrs:{"data-id":e._$s("22-"+o,"a-data-id",t._id),"data-index":e._$s("22-"+o,"a-data-index",r),_i:"22-"+o},on:{click:e.deleteFeedback}})])])})):n("view",{staticClass:e._$s(23,"sc","empty-state"),attrs:{_i:23}},[n("text",{staticClass:e._$s(24,"sc","empty-icon"),attrs:{_i:24}}),n("text",{staticClass:e._$s(25,"sc","empty-text"),attrs:{_i:25}})]),e._$s(26,"i",e.loading)?n("view",{staticClass:e._$s(26,"sc","loading-more"),attrs:{_i:26}},[n("text")]):e._$s(28,"e",!e.hasMore&&e.feedbackList.length>0)?n("view",{staticClass:e._$s(28,"sc","no-more"),attrs:{_i:28}},[n("text")]):e._e()],2)])},i=[]},"1a29":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:e._$s(1,"sc","page-header"),attrs:{_i:1}},[n("text",{staticClass:e._$s(2,"sc","page-title"),attrs:{_i:2}}),n("view",{staticClass:e._$s(3,"sc","header-actions"),attrs:{_i:3}},[e._$s(4,"i",e.unreadCount>0)?n("text",{staticClass:e._$s(4,"sc","unread-count"),attrs:{_i:4}},[e._v(e._$s(4,"t0-0",e._s(e.unreadCount)))]):e._e(),n("text",{staticClass:e._$s(5,"sc","clear-btn"),attrs:{_i:5},on:{click:e.clearAllMessages}})])]),n("view",{staticClass:e._$s(6,"sc","tab-container"),attrs:{_i:6}},[n("view",{class:e._$s(7,"c","tab-item "+("all"===e.activeTab?"active":"")),attrs:{_i:7},on:{click:e.switchTab}},[n("text"),e._$s(9,"i","all"===e.activeTab)?n("view",{staticClass:e._$s(9,"sc","tab-indicator"),attrs:{_i:9}}):e._e()]),n("view",{class:e._$s(10,"c","tab-item "+("like"===e.activeTab?"active":"")),attrs:{_i:10},on:{click:e.switchTab}},[n("text"),e._$s(12,"i","like"===e.activeTab)?n("view",{staticClass:e._$s(12,"sc","tab-indicator"),attrs:{_i:12}}):e._e()]),n("view",{class:e._$s(13,"c","tab-item "+("comment"===e.activeTab?"active":"")),attrs:{_i:13},on:{click:e.switchTab}},[n("text"),e._$s(15,"i","comment"===e.activeTab)?n("view",{staticClass:e._$s(15,"sc","tab-indicator"),attrs:{_i:15}}):e._e()]),n("view",{class:e._$s(16,"c","tab-item "+("favorite"===e.activeTab?"active":"")),attrs:{_i:16},on:{click:e.switchTab}},[n("text"),e._$s(18,"i","favorite"===e.activeTab)?n("view",{staticClass:e._$s(18,"sc","tab-indicator"),attrs:{_i:18}}):e._e()]),n("view",{class:e._$s(19,"c","tab-item "+("feedback"===e.activeTab?"active":"")),attrs:{_i:19},on:{click:e.switchTab}},[n("text"),e._$s(21,"i","feedback"===e.activeTab)?n("view",{staticClass:e._$s(21,"sc","tab-indicator"),attrs:{_i:21}}):e._e()])]),n("scroll-view",{staticClass:e._$s(22,"sc","message-list"),attrs:{_i:22},on:{scrolltolower:e.onReachBottom,scrolltoupper:e.onScrollToUpper}},[e._$s(23,"i",0===e.messages.length&&!e.isLoading)?n("view",{staticClass:e._$s(23,"sc","empty-container"),attrs:{_i:23}},[n("image",{staticClass:e._$s(24,"sc","empty-icon"),attrs:{_i:24}}),n("text",{staticClass:e._$s(25,"sc","empty-text"),attrs:{_i:25}})]):e._e(),e._l(e._$s(26,"f",{forItems:e.messages}),(function(t,r,i,o){return n("view",{key:e._$s(26,"f",{forIndex:i,key:r}),class:e._$s("26-"+o,"c","message-item "+(t.isRead?"":"unread")),attrs:{_i:"26-"+o}},[n("view",{staticClass:e._$s("27-"+o,"sc","message-content"),attrs:{"data-postid":e._$s("27-"+o,"a-data-postid",t.postId),_i:"27-"+o},on:{click:e.navigateToPost}},[n("image",{staticClass:e._$s("28-"+o,"sc","user-avatar"),attrs:{src:e._$s("28-"+o,"a-src",t.fromUserAvatar||"/static/images/avatar.png"),_i:"28-"+o}}),n("view",{staticClass:e._$s("29-"+o,"sc","message-body"),attrs:{_i:"29-"+o}},[n("view",{staticClass:e._$s("30-"+o,"sc","message-header"),attrs:{_i:"30-"+o}},[n("view",{staticClass:e._$s("31-"+o,"sc","message-type"),attrs:{_i:"31-"+o}},[n("text",{staticClass:e._$s("32-"+o,"sc","type-icon"),attrs:{_i:"32-"+o}},[e._v(e._$s("32-"+o,"t0-0",e._s("like"===t.type?"\ud83d\udc4d":"comment"===t.type?"\ud83d\udcac":"favorite"===t.type?"\u2b50":"feedback"===t.type?"\ud83d\udcdd":"feedback_processed"===t.type?"\u2705":"\ud83d\udce2")))]),n("text",{staticClass:e._$s("33-"+o,"sc","type-text"),attrs:{_i:"33-"+o}},[e._v(e._$s("33-"+o,"t0-0",e._s("like"===t.type?"\u70b9\u8d5e":"comment"===t.type?"\u8bc4\u8bba":"favorite"===t.type?"\u6536\u85cf":"feedback"===t.type?"\u53cd\u9988":"feedback_processed"===t.type?"\u53cd\u9988\u5904\u7406":"\u901a\u77e5")))])])]),n("text",{staticClass:e._$s("34-"+o,"sc","message-text"),attrs:{_i:"34-"+o}},[e._v(e._$s("34-"+o,"t0-0",e._s(t.content)))]),e._$s("35-"+o,"i",t.postTitle)?n("view",{staticClass:e._$s("35-"+o,"sc","post-preview"),attrs:{_i:"35-"+o}},[n("text",{staticClass:e._$s("36-"+o,"sc","post-title"),attrs:{_i:"36-"+o}},[e._v(e._$s("36-"+o,"t0-0",e._s(t.postTitle)))])]):e._e()])]),n("view",{staticClass:e._$s("37-"+o,"sc","delete-btn"),attrs:{"data-messageid":e._$s("37-"+o,"a-data-messageid",t._id),"data-index":e._$s("37-"+o,"a-data-index",r),_i:"37-"+o},on:{click:e.deleteMessage}},[n("text")]),e._$s("39-"+o,"i",!t.isRead)?n("view",{staticClass:e._$s("39-"+o,"sc","unread-dot"),attrs:{_i:"39-"+o}}):e._e()])})),e._$s(40,"i",e.isLoading&&e.messages.length>0)?n("view",{staticClass:e._$s(40,"sc","loading-more"),attrs:{_i:40}},[n("text")]):e._e(),e._$s(42,"i",!e.hasMore&&e.messages.length>0)?n("view",{staticClass:e._$s(42,"sc","no-more"),attrs:{_i:42}},[n("text")]):e._e()],2)])},i=[]},"1a5f":function(e,t,n){"use strict";n.r(t);var r=n("dd05"),i=n("b3c1");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"1ac7":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("7ca3")),o=n("11ca"),a=o.cloudCall,s={data:function(){return{followings:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:20,pendingOpenid:null,defaultAvatar:"/static/images/avatar.png",total:"",avatarKey:""}},onLoad:function(){this.loadFollowings(!0)},onPullDownRefresh:function(){this.loadFollowings(!0)},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadFollowings()},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,t,Object.assign({pageTag:"following",context:this,requireAuth:!0},n))},loadFollowings:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading){n&&this.setData({page:0,hasMore:!0});var r=n?0:this.page;this.setData({isLoading:!0});var i=this.$requireOpenid&&this.$requireOpenid();if(!i)return this.setData({isLoading:!1}),void(n&&uni.stopPullDownRefresh());this.callCloudFunction("follow",{action:"getFollowingList",skip:r*this.PAGE_SIZE,limit:this.PAGE_SIZE,openid:i}).then((function(e){if(e.result&&e.result.success){var i=e.result.list||[],o=n?i:t.followings.concat(i);t.setData({followings:o,page:r+1,hasMore:!!e.result.hasMore,total:e.result.total||o.length})}else uni.showToast({title:e.result&&e.result.message?e.result.message:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u83b7\u53d6\u5173\u6ce8\u5217\u8868\u5931\u8d25:",t," at pages/following/following.vue:124"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),n&&uni.stopPullDownRefresh()}))}},onToggleFollow:function(t){var n=this,r=t.currentTarget.dataset.openid,i=t.currentTarget.dataset.index;if(r&&!this.pendingOpenid){this.setData({pendingOpenid:r});var o=this.$requireOpenid&&this.$requireOpenid();o?this.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:r,openid:o}).then((function(e){if(e.result&&e.result.success){var t=!!e.result.isFollowing;if(t)uni.showToast({title:"\u5df2\u5173\u6ce8",icon:"success"});else{var r=n.followings.filter((function(e,t){return t!==i}));n.setData({followings:r}),uni.showToast({title:"\u5df2\u53d6\u6d88\u5173\u6ce8",icon:"success"}),n.hasMore&&r.length<n.PAGE_SIZE&&n.loadFollowings(),0!==r.length||n.hasMore||n.setData({page:0})}}else uni.showToast({title:e.result&&e.result.message?e.result.message:"\u64cd\u4f5c\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u53d6\u6d88\u5173\u6ce8\u5931\u8d25:",t," at pages/following/following.vue:192"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){n.setData({pendingOpenid:null})})):this.setData({pendingOpenid:null})}},onAvatarError:function(e){var t=e.currentTarget.dataset.index;if(void 0!==t){var n="followings[".concat(t,"].avatarUrl");this.setData((0,i.default)({},n,this.defaultAvatar))}},openUserProfile:function(e){var t=e.currentTarget.dataset.openid;t&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(t)})}}};t.default=s}).call(this,n("f3b9")["default"])},"1b45":function(e,t,n){var r=n("c823"),i=n("1d3e"),o=n("f202"),a=Object.prototype,s=a.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=i(e),n=[];for(var a in e)("constructor"!=a||!t&&s.call(e,a))&&n.push(a);return n}},"1b59":function(e,t,n){"use strict";n.r(t);var r=n("513b"),i=n("dceb");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"1b6c":function(e,t){e.exports=function(e){return this.__data__.has(e)}},"1bb2":function(e,t,n){"use strict";n.r(t);var r=n("907e");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n("828b"),a=Object(o["a"])(r["default"],void 0,void 0,!1,null,null,null,!1,void 0,void 0);t["default"]=a.exports},"1c01":function(e,t,n){var r=n("8b83"),i=n("6c88"),o=n("6468"),a=n("c823"),s=n("51b8");e.exports=function(e,t,n,u){if(!a(e))return e;t=i(t,e);var c=-1,l=t.length,d=l-1,f=e;while(null!=f&&++c<l){var p=s(t[c]),h=n;if("__proto__"===p||"constructor"===p||"prototype"===p)return e;if(c!=d){var g=f[p];h=u?u(g,p,f):void 0,void 0===h&&(h=a(g)?g:o(t[c+1])?[]:{})}r(f,p,h),f=f[p]}return e}},"1ce3":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.t=t.langMap=t.i18nProxy=t.LANG_HEADER_KEY=t.LANGS=void 0;var r,i,o=n("5c02");t.LANGS=i,function(e){e["ZH"]="zh-CN",e["EN"]="en-US"}(i||(t.LANGS=i={}));t.LANG_HEADER_KEY="Accept-Language";var a=(r={},r[i.EN]={"\u8bf7\u68c0\u67e5\u8c03\u7528\u65b9\u5f0f\uff0c\u6216\u524d\u5f80\u4e91\u5f00\u53d1 AI+ \u9996\u9875\u67e5\u770b\u6587\u6863":"Please check the calling method or visit the AI+ homepage to view the documentation","AI+ \u8bf7\u6c42\u51fa\u9519\uff0c\u9519\u8bef\u7801":"AI+ request error, error code","\u9519\u8bef\u4fe1\u606f":"error message","\u672a\u5b9e\u73b0":"not implemented","\u5c0f\u7a0b\u5e8f\u4e0d\u652f\u6301 wasm \u52a0\u8f7d":"wasm loading is not supported in mini programs","\u5c0f\u7a0b\u5e8f\u4e0d\u652f\u6301\u52a8\u6001 js \u52a0\u8f7d":"dynamic js loading is not supported in mini programs","\u8bf7\u6c42\u8d85\u65f6":"request timeout","\u7f3a\u5c11 privatelink sdk \u5730\u5740":"missing privatelink sdk address"},r);t.langMap=a;var s=function(e,t){var n;return(null===(n=a[t])||void 0===n?void 0:n[e])||e};t.t=s;t.i18nProxy=function(e,t){var n,r,a=function(e){return"lang_".concat(e.clientId||e.env)}(t),u=(e.adapter||{}).localStorage,c=t.lang||(null===(n=null===u||void 0===u?void 0:u.getItem)||void 0===n?void 0:n.call(u,a))||i.ZH;return null===(r=null===u||void 0===u?void 0:u.setItem)||void 0===r||r.call(u,a,c),new Proxy({t:function(e){return s(e,c)},LANG_HEADER_KEY:"Accept-Language",lang:c},{get:function(e,t){var n;return"lang"===t&&(null===(n=null===u||void 0===u?void 0:u.getItem)||void 0===n?void 0:n.call(u,a))||e[t]},set:function(e,t,n){var r;return"lang"===t&&n!==e[t]&&(e[t]=n,e.t=function(e){return s(e,n)},null===(r=null===u||void 0===u?void 0:u.setItem)||void 0===r||r.call(u,a,n),o.langEvent.bus.fire(o.langEvent.LANG_CHANGE_EVENT,{i18n:e})),e[t]=n,!0}})}},"1d0b":function(e,t,n){(function(t,r){var i=n("af34"),o=n("127e"),a=n("ee10"),s=n("67ad"),u=n("0bdb"),c=function(){"use strict";function e(){s(this,e),this.cache=new Map,this.isH5="undefined"!==typeof window,this.isMiniProgram="undefined"!==typeof t&&t.cloud}return u(e,[{key:"loadImage",value:function(){var e=a(o.mark((function e(t){var n,r,i,a,s,u=arguments;return o.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:{},r=n.useCache,i=void 0===r||r,a=n.timeout,void 0===a?1e4:a,s=n.fallbackToOriginal,void 0===s||s,!i||!this.cache.has(t)){e.next=4;break}return e.abrupt("return",{success:!0,url:this.cache.get(t),fromCache:!0});case 4:if(!this.isH5){e.next=8;break}return e.abrupt("return",this.loadImageH5(t,n));case 8:if(!this.isMiniProgram){e.next=12;break}return e.abrupt("return",this.loadImageMiniProgram(t,n));case 12:return e.abrupt("return",this.loadImageNative(t,n));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadImageH5",value:function(){var e=a(o.mark((function e(t,n){var i,a,s;return o.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=n.fallbackToOriginal,a=void 0===i||i,!this.isCloudStorageUrl(t)){e.next=5;break}return r("log","\ud83d\udd0d [H5] \u68c0\u6d4b\u5230\u817e\u8baf\u4e91\u5b58\u50a8URL\uff0c\u76f4\u63a5\u4f7f\u7528:",t," at utils/imageLoader.js:49"),this.cache.set(t,t),e.abrupt("return",{success:!0,url:t,fromCache:!1,strategy:"direct"});case 5:return e.prev=5,e.next=8,this.downloadFileWithTimeout(t,n.timeout);case 8:if(s=e.sent,!s.success){e.next=12;break}return this.cache.set(t,s.tempFilePath),e.abrupt("return",{success:!0,url:s.tempFilePath,fromCache:!1,strategy:"download"});case 12:e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](5),r("warn","\ud83d\udd0d [H5] downloadFile\u5931\u8d25:",e.t0," at utils/imageLoader.js:72");case 17:if(!a){e.next=21;break}return r("log","\ud83d\udd0d [H5] \u4f7f\u7528\u964d\u7ea7\u65b9\u6848\uff0c\u76f4\u63a5\u4f7f\u7528\u539fURL:",t," at utils/imageLoader.js:77"),this.cache.set(t,t),e.abrupt("return",{success:!0,url:t,fromCache:!1,strategy:"fallback"});case 21:return e.abrupt("return",{success:!1,error:"H5\u73af\u5883\u4e0b\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",url:t});case 22:case"end":return e.stop()}}),e,this,[[5,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadImageMiniProgram",value:function(){var e=a(o.mark((function e(t,n){var i;return o.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.downloadFileWithTimeout(t,n.timeout);case 3:if(i=e.sent,!i.success){e.next=7;break}return this.cache.set(t,i.tempFilePath),e.abrupt("return",{success:!0,url:i.tempFilePath,fromCache:!1,strategy:"download"});case 7:e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),r("error","\u5c0f\u7a0b\u5e8f\u73af\u5883\u56fe\u7247\u52a0\u8f7d\u5931\u8d25:",e.t0," at utils/imageLoader.js:110");case 12:return e.abrupt("return",{success:!1,error:"\u5c0f\u7a0b\u5e8f\u73af\u5883\u4e0b\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",url:t});case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadImageNative",value:function(){var e=a(o.mark((function e(t,n){var i;return o.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.downloadFileWithTimeout(t,n.timeout);case 3:if(i=e.sent,!i.success){e.next=7;break}return this.cache.set(t,i.tempFilePath),e.abrupt("return",{success:!0,url:i.tempFilePath,fromCache:!1,strategy:"download"});case 7:e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),r("error","\u539f\u751f\u73af\u5883\u56fe\u7247\u52a0\u8f7d\u5931\u8d25:",e.t0," at utils/imageLoader.js:136");case 12:return e.abrupt("return",{success:!1,error:"\u539f\u751f\u73af\u5883\u4e0b\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",url:t});case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadFileWithTimeout",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return new Promise((function(n){var r=setTimeout((function(){n({success:!1,error:"\u4e0b\u8f7d\u8d85\u65f6"})}),t);uni.downloadFile({url:e,success:function(e){clearTimeout(r),200===e.statusCode?n({success:!0,tempFilePath:e.tempFilePath}):n({success:!1,error:"HTTP ".concat(e.statusCode)})},fail:function(e){clearTimeout(r),n({success:!1,error:e.errMsg||"\u4e0b\u8f7d\u5931\u8d25"})}})}))}},{key:"isCloudStorageUrl",value:function(e){return e.includes("tcb.qcloud.la")||e.includes("cloudbase")||e.includes("cloud://")}},{key:"loadImages",value:function(){var e=a(o.mark((function e(t){var n,r,a,s,u,c,l,d=this,f=arguments;return o.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=f.length>1&&void 0!==f[1]?f[1]:{},r=n.maxConcurrent,a=void 0===r?3:r,s=[],u=0;case 4:if(!(u<t.length)){e.next=13;break}return c=t.slice(u,u+a),e.next=8,Promise.all(c.map((function(e){return d.loadImage(e,n)})));case 8:l=e.sent,s.push.apply(s,i(l));case 10:u+=a,e.next=4;break;case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearCache",value:function(){this.cache.clear()}},{key:"getCacheStats",value:function(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}]),e}(),l=new c;e.exports=l}).call(this,n("ed83")["default"],n("f3b9")["default"])},"1d3b":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.isInMpWebView=function(){return a},t.isMp=o;var i=r(n("3b2d"));function o(){if("undefined"===typeof globalThis)return!1;var e=globalThis.wx;if("undefined"===typeof e)return!1;if(void 0===globalThis.Page)return!1;if(!e.getSystemInfoSync)return!1;if(!e.getStorageSync)return!1;if(!e.setStorageSync)return!1;if(!e.connectSocket)return!1;if(!e.request)return!1;try{if(!e.getSystemInfoSync())return!1;if("qq"===e.getSystemInfoSync().AppPlatform)return!1}catch(t){return!1}return!0}var a=!1;function s(){a=a||void 0!==("undefined"===typeof window?"undefined":(0,i.default)(window))&&"miniprogram"===window.__wxjs_environment}try{o()||(a=a||!!navigator.userAgent.match(/miniprogram/i)||"miniprogram"===window.__wxjs_environment,window&&window.WeixinJSBridge&&window.WeixinJSBridge.invoke?s():"undefined"!==typeof document&&document.addEventListener("WeixinJSBridgeReady",s,!1))}catch(u){}},"1d3e":function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||n;return e===r}},"1f0b":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:e._$s(1,"sc","header"),attrs:{_i:1}},[n("text",{staticClass:e._$s(2,"sc","header-title"),attrs:{_i:2}})]),e._$s(3,"i",e.isLoading&&0===e.likedPosts.length)?n("view",{staticClass:e._$s(3,"sc","loading-indicator"),attrs:{_i:3}},[n("text")]):n("view",{attrs:{_i:5}},[e._$s(6,"i",e.likedPosts.length>0)?n("view",{staticClass:e._$s(6,"sc","post-list"),attrs:{_i:6}},[e._l(e._$s(7,"f",{forItems:e.likedPosts}),(function(t,r,i,o){return n("view",{key:e._$s(7,"f",{forIndex:i,key:r}),staticClass:e._$s("7-"+o,"sc","post-item"),attrs:{"data-id":e._$s("7-"+o,"a-data-id",t._id),_i:"7-"+o},on:{click:e.navigateToPost}},[n("view",{staticClass:e._$s("8-"+o,"sc","author-info"),attrs:{_i:"8-"+o}},[n("image",{staticClass:e._$s("9-"+o,"sc","author-avatar"),attrs:{src:e._$s("9-"+o,"a-src",t.authorAvatar||"/static/images/icons/avatar.png"),_i:"9-"+o},on:{error:e.onAvatarError}}),n("text",{staticClass:e._$s("10-"+o,"sc","author-name"),attrs:{_i:"10-"+o}},[e._v(e._$s("10-"+o,"t0-0",e._s(t.authorName)))])]),n("view",{staticClass:e._$s("11-"+o,"sc","post-title"),attrs:{_i:"11-"+o}},[e._v(e._$s("11-"+o,"t0-0",e._s(t.title)))]),n("view",{staticClass:e._$s("12-"+o,"sc","post-content-preview"),attrs:{_i:"12-"+o}},[e._v(e._$s("12-"+o,"t0-0",e._s(t.content)))]),e._$s("13-"+o,"i",t.imageUrl||t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("13-"+o,"sc","image-container"),attrs:{id:e._$s("13-"+o,"a-id","image-container-"+r),_i:"13-"+o}},[e._$s("14-"+o,"i",t.imageUrls&&1===t.imageUrls.length)?[n("image",{style:e._$s("15-"+o,"s","width: 100%; height: "+(e.imageClampHeights[t._id]?e.imageClampHeights[t._id]+"px":"auto")+"; object-fit: "+(e.imageClampHeights[t._id]?"cover":"contain")+"; background-color: #f0f0f0;"),attrs:{id:e._$s("15-"+o,"a-id","single-image-"+t._id),src:e._$s("15-"+o,"a-src",t.imageUrls[0]),mode:e._$s("15-"+o,"a-mode",e.imageClampHeights[t._id]?"aspectFill":"widthFix"),"data-postid":e._$s("15-"+o,"a-data-postid",t._id),"data-src":e._$s("15-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("15-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"15-"+o},on:{load:e.onImageLoad,error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})]:e._$s("16-"+o,"e",t.imageUrls&&t.imageUrls.length>1)?[n("swiper",{staticClass:e._$s("17-"+o,"sc","image-swiper"),style:e._$s("17-"+o,"s","width: 100%; height: "+(e.swiperHeights[r]?e.swiperHeights[r]+"px":"220px")+";"),attrs:{id:e._$s("17-"+o,"a-id","swiper-"+t._id),_i:"17-"+o}},[e._l(e._$s("18-"+o,"f",{forItems:t.imageUrls}),(function(i,a,s,u){return[n("swiper-item",{key:e._$s("18-"+o,"f",{forIndex:s,keyIndex:0,key:a+"_0"})},[n("image",{attrs:{src:e._$s("20-"+o+"-"+u,"a-src",i),"data-postid":e._$s("20-"+o+"-"+u,"a-data-postid",t._id),"data-postindex":e._$s("20-"+o+"-"+u,"a-data-postindex",r),"data-imgindex":e._$s("20-"+o+"-"+u,"a-data-imgindex",a),"data-src":e._$s("20-"+o+"-"+u,"a-data-src",i),"data-original-image-urls":e._$s("20-"+o+"-"+u,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"20-"+o+"-"+u},on:{load:e.onImageLoad,error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._e()],2):e._e(),n("view",{staticClass:e._$s("21-"+o,"sc","post-meta"),attrs:{_i:"21-"+o}},[n("text",{staticClass:e._$s("22-"+o,"sc","post-time"),attrs:{_i:"22-"+o}},[e._v(e._$s("22-"+o,"t0-0",e._s(t.formattedCreateTime)))])])])})),e._$s(23,"i",e.isLoading&&e.likedPosts.length>0)?n("view",{staticClass:e._$s(23,"sc","loading-indicator"),attrs:{_i:23}},[n("text")]):e._e()],2):n("view",{staticClass:e._$s(25,"sc","empty-tip"),attrs:{_i:25}},[n("view",{staticClass:e._$s(26,"sc","empty-icon"),attrs:{_i:26}}),n("view",{staticClass:e._$s(27,"sc","empty-text"),attrs:{_i:27}}),n("view",{staticClass:e._$s(28,"sc","empty-subtext"),attrs:{_i:28}})])])])},i=[]},"1f0f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createParser=function(e){var t,n,o,a,s,u,c;return l(),{feed:function(e){n=n?n+e:e,t&&i(n)&&(n=n.slice(r.length));t=!1;var s=n.length,u=0,c=!1;while(u<s){c&&("\n"===n[u]&&(u+=1),c=!1);for(var l=-1,f=a,p=void 0,h=o;l<0&&h<s;h++)p=n[h],":"===p&&f<0?f=h-u:"\r"===p?(c=!0,l=h-u):"\n"===p&&(l=h-u);if(l<0){o=s-u,a=f;break}o=0,a=-1,d(n,u,f,l),u+=l+1}u===s?n="":u>0&&(n=n.slice(u))},reset:l};function l(){t=!0,n="",o=0,a=-1,s=void 0,u=void 0,c=""}function d(t,n,r,i){if(0===i)return c.length>0&&(e({type:"event",id:s,event:u||void 0,data:c.slice(0,-1)}),c="",s=void 0),void(u=void 0);var o=r<0,a=t.slice(n,n+(o?i:r)),l=0;l=o?i:" "===t[n+r+1]?r+2:r+1;var d=n+l,f=i-l,p=t.slice(d,d+f).toString();if("data"===a)c+=p?"".concat(p,"\n"):"\n";else if("event"===a)u=p;else if("id"!==a||p.includes("\0")){if("retry"===a){var h=parseInt(p,10);Number.isNaN(h)||e({type:"reconnect-interval",value:h})}}else s=p}};var r=[239,187,191];function i(e){return r.every((function(t,n){return e.charCodeAt(n)===t}))}},"1f17":function(e,t){e.exports=function(e,t){var n=-1,r=null==e?0:e.length,i=Array(r);while(++n<r)i[n]=t(e[n],n,e);return i}},2024:function(e,t,n){var r=n("213c"),i=n("9930");e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},"206c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.catchErrorsDecorator=function(e){var t=e.mode,n=void 0===t?"async":t,s=e.customInfo,d=void 0===s?{}:s,f=e.title,p=e.messages,h=void 0===p?[]:p;return function(e,t,s){if(i.IS_DEBUG_MODE){var p=d.className||e.constructor.name,g=d.methodName||t,v=s.value,m=function(e){var t="",n=e.stack.split("\n"),r=n.findIndex((function(e){return u.test(e)}));if(-1!==r){var i=c.exec(n[r+1]||"");t=i?i[0]:""}return t}(new Error);s.value="sync"===n?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=l({err:new Error,className:p,methodName:g,sourceLink:m});try{return v.apply(this,e)}catch(d){var i=d,o=d.message,a=d.error,s=d.error_description,u={title:f||"".concat(p,".").concat(g," failed"),content:[{type:"error",body:d}]};if(o&&/^\{.*\}$/.test(o)){var c=JSON.parse(o);u.subtitle=o,c.code&&(n?(n.code=c.code,n.msg=c.msg):(d.code=c.code,d.message=c.msg),i=n||d,u.content=h.map((function(e){return{type:"info",body:e}})))}throw a&&s&&(u.subtitle=s,n?(n.code=a,n.msg=s):(d.code=a,d.message=s),i=n||d,u.content=h.map((function(e){return{type:"info",body:e}}))),(0,r.printGroupLog)(u),i}}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o(this,void 0,void 0,(function(){var t,n,i,o,s,u,c,d;return a(this,(function(a){switch(a.label){case 0:t=l({err:new Error,className:p,methodName:g,sourceLink:m}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,v.apply(this,e)];case 2:return[2,a.sent()];case 3:throw n=a.sent(),i=n,o=n.message,s=n.error,u=n.error_description,c={title:f||"".concat(p,".").concat(g," failed"),content:[{type:"error",body:n}]},o&&/^\{.*\}$/.test(o)&&(d=JSON.parse(o),c.subtitle=d,d.code&&(t?(t.code=d.code,t.message=d.msg):(n.code=d.code,n.message=d.msg),i=t||n,c.content=h.map((function(e){return{type:"info",body:e}})))),s&&u&&(c.subtitle=u,t?(t.code=s,t.msg=u):(n.code=s,n.message=u),i=t||n,c.content=h.map((function(e){return{type:"info",body:e}}))),(0,r.printGroupLog)(c),i;case 4:return[2]}}))}))}}}};var r=n("6e68"),i=n("c7a0"),o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=!1;"undefined"!==typeof navigator&&navigator.userAgent&&(s=-1!==navigator.userAgent.indexOf("Firefox"));var u=s?/(\.js\/)?__decorate(\$\d+)?<@.*\d$/:/(\/\w+\.js\.)?__decorate(\$\d+)?\s*\(.*\)$/,c=/https?:\/\/.+:\d*\/.*\.js:\d+:\d+/;function l(e){var t=e.err,n=e.className,r=e.methodName,i=e.sourceLink;if(!i)return null;var o,a=t.stack.split("\n"),u=s?/^catchErrorsDecorator\/<\/descriptor.value@.*\d$/:new RegExp("".concat(n,"\\.descriptor.value\\s*\\[as\\s").concat(r,"\\]\\s*\\(.*\\)$")),l=s?/^catchErrorsDecorator\/<\/descriptor.value/:new RegExp("".concat(n,"\\.descriptor.value\\s*\\[as\\s").concat(r,"\\]")),d=a.findIndex((function(e){return u.test(e)}));if(-1!==d){var f=a.filter((function(e,t){return t>d}));f.unshift(a[d].replace(l,"".concat(n,".").concat(r)).replace(c,i)),o=new Error,o.stack="".concat(s?"@debugger":"Error","\n").concat(f.join("\n"))}return o}},"213c":function(e,t,n){var r=n("806a"),i=n("785a"),o=n("c823"),a=n("022f"),s=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,l=u.toString,d=c.hasOwnProperty,f=RegExp("^"+l.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){if(!o(e)||i(e))return!1;var t=r(e)?f:s;return t.test(a(e))}},2152:function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.LineString=void 0;var i=r(n("3b2d")),o=n("a4d5"),a=n("382e"),s=n("8539"),u=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=function(){function e(e){if(!(0,s.isArray)(e))throw new TypeError('"points" must be of type Point[]. Received type '+(0,i.default)(e));if(e.length<2)throw new Error('"points" must contain 2 points at least');e.forEach((function(e){if(!(e instanceof a.Point))throw new TypeError('"points" must be of type Point[]. Received type '+(0,i.default)(e)+"[]")})),this.points=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"LineString",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))},t},e.prototype.toJSON=function(){return{type:"LineString",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))}},e.validate=function(e){var t,n;if("LineString"!==e.type||!(0,s.isArray)(e.coordinates))return!1;try{for(var r=u(e.coordinates),i=r.next();!i.done;i=r.next()){var o=i.value;if(!(0,s.isNumber)(o[0])||!(0,s.isNumber)(o[1]))return!1}}catch(a){t={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},e.isClosed=function(e){var t=e.points[0],n=e.points[e.points.length-1];if(t.latitude===n.latitude&&t.longitude===n.longitude)return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return o.SYMBOL_GEO_LINE_STRING},enumerable:!0,configurable:!0}),e}();t.LineString=c},"223b":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.defaultStorage=t.defaultRequest=t.OAuth2Client=void 0,t.generateRequestId=b,t.toResponseError=void 0;var i=r(n("127e")),o=r(n("7ca3")),a=r(n("67ad")),s=r(n("0bdb")),u=r(n("ee10")),c=n("64ef"),l=n("2ce5"),d=n("1484"),f=n("a9a5"),p=n("102a"),h=n("49a1"),g=n("1d3b"),v=n("5c02");function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=function(){var e=(0,u.default)(i.default.mark((function e(t,n){var r,o,a,s,u;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=null,o=null,e.prev=2,a=Object.assign({},n),a.method||(a.method="GET"),a.body&&"string"!==typeof a.body&&(a.body=JSON.stringify(a.body)),e.next=8,fetch(t,a);case 8:return s=e.sent,e.next=11,s.json();case 11:u=e.sent,null!==u&&void 0!==u&&u.error?(o=u,o.error_uri=new URL(t).pathname):r=u,e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](2),o={error:c.ErrorType.UNREACHABLE,error_description:e.t0.message,error_uri:new URL(t).pathname};case 18:if(!o){e.next=22;break}throw o;case 22:return e.abrupt("return",r);case 23:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t,n){return e.apply(this,arguments)}}();t.defaultRequest=_;function b(){return(0,d.uuidv4)()}t.toResponseError=function(e,t){var n,r=t||{};if(e instanceof Error)n={error:r.error||c.ErrorType.LOCAL,error_description:r.error_description||e.message,error_uri:r.error_uri,details:r.details||e.stack};else{var i=e||{};n={error:r.error||i.error||c.ErrorType.LOCAL,error_description:r.error_description||i.error_description,error_uri:r.error_uri||i.error_uri,details:r.details||i.details}}return n};var w=function(){function e(t){(0,a.default)(this,e),this._env=(null===t||void 0===t?void 0:t.env)||""}return(0,s.default)(e,[{key:"getItem",value:function(){var e=(0,u.default)(i.default.mark((function e(t){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",window.localStorage.getItem("".concat(t).concat(this._env)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeItem",value:function(){var e=(0,u.default)(i.default.mark((function e(t){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:window.localStorage.removeItem("".concat(t).concat(this._env));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setItem",value:function(){var e=(0,u.default)(i.default.mark((function e(t,n){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:window.localStorage.setItem("".concat(t).concat(this._env),n);case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getItemSync",value:function(e){return window.localStorage.getItem("".concat(e).concat(this._env))}},{key:"removeItemSync",value:function(e){window.localStorage.removeItem("".concat(e).concat(this._env))}},{key:"setItemSync",value:function(e,t){window.localStorage.setItem("".concat(e).concat(this._env),t)}}]),e}(),S=new w;function I(e){var t=!0;return null!==e&&void 0!==e&&e.expires_at&&null!==e&&void 0!==e&&e.access_token&&(t=e.expires_at<new Date),t}t.defaultStorage=S;var C=function(){function e(t){(0,a.default)(this,e),this.credentials=null,this.accessKeyCredentials=null,this.singlePromise=null,this.tokenSectionName=t.tokenSectionName,this.storage=t.storage,this.clientId=t.clientId,this.singlePromise=new p.SinglePromise({clientId:this.clientId}),this.credentials=t.credentials||null}return(0,s.default)(e,[{key:"getStorageCredentialsSync",value:function(){var e=null,t=this.storage.getItemSync(this.tokenSectionName);if(void 0!==t&&null!==t)try{var n;e=JSON.parse(t),null!==(n=e)&&void 0!==n&&n.expires_at&&(e.expires_at=new Date(e.expires_at))}catch(r){this.storage.removeItem(this.tokenSectionName),e=null}return e}},{key:"setCredentials",value:function(){var e=(0,u.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null===t||void 0===t||!t.expires_in){e.next=9;break}if(null!==t&&void 0!==t&&t.expires_at||(t.expires_at=new Date(Date.now()+1e3*(t.expires_in-30))),!this.storage){e.next=6;break}return n=JSON.stringify(t),e.next=6,this.storage.setItem(this.tokenSectionName,n);case 6:this.credentials=t,e.next=13;break;case 9:if(!this.storage){e.next=12;break}return e.next=12,this.storage.removeItem(this.tokenSectionName);case 12:this.credentials=null;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setAccessKeyCredentials",value:function(e){this.accessKeyCredentials=e}},{key:"getCredentials",value:function(){var e=(0,u.default)(i.default.mark((function e(){var t=this;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.singlePromise.run("getCredentials",(0,u.default)(i.default.mark((function e(){var n,r,o;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!I(t.credentials)){e.next=9;break}return e.next=3,t.getStorageCredentials();case 3:if(n=e.sent,r=n.credentials,o=n.isAccessKeyCredentials,!o){e.next=8;break}return e.abrupt("return",r);case 8:t.credentials=r;case 9:return e.abrupt("return",t.credentials);case 10:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getStorageCredentials",value:function(){var e=(0,u.default)(i.default.mark((function e(){var t=this;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.singlePromise.run("_getStorageCredentials",(0,u.default)(i.default.mark((function e(){var n,r,o,a;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=null,r=!1,e.next=4,t.storage.getItem(t.tokenSectionName);case 4:if(o=e.sent,!o){e.next=18;break}e.prev=6,n=JSON.parse(o),null!==(a=n)&&void 0!==a&&a.expires_at&&(n.expires_at=new Date(n.expires_at)),e.next=16;break;case 11:return e.prev=11,e.t0=e["catch"](6),e.next=15,t.storage.removeItem(t.tokenSectionName);case 15:n=null;case 16:e.next=20;break;case 18:n=t.accessKeyCredentials||null,r=!0;case 20:return e.abrupt("return",{credentials:n,isAccessKeyCredentials:r});case 21:case"end":return e.stop()}}),e,null,[[6,11]])})))));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),T=function(){function t(n){var r=this;(0,a.default)(this,t),this.singlePromise=null,n.clientSecret||(n.clientSecret=""),!n.clientId&&n.env&&(n.clientId=n.env),this.apiOrigin=n.apiOrigin,this.apiPath=n.apiPath||l.AUTH_API_PREFIX,this.clientId=n.clientId,this.i18n=n.i18n,this.singlePromise=new p.SinglePromise({clientId:this.clientId}),this.retry=this.formatRetry(n.retry,t.defaultRetry),n.baseRequest?this.baseRequest=n.baseRequest:this.baseRequest=_,this.tokenInURL=n.tokenInURL,this.headers=n.headers,this.storage=n.storage||S,this.localCredentials=new C({tokenSectionName:"credentials_".concat(n.clientId),storage:this.storage,clientId:n.clientId}),this.clientSecret=n.clientSecret,n.clientId&&(this.basicAuth="Basic ".concat((0,h.weBtoa)("".concat(n.clientId,":").concat(this.clientSecret)))),this.wxCloud=n.wxCloud;try{(0,g.isMp)()&&(this.useWxCloud=n.useWxCloud,void 0===this.wxCloud&&n.env&&(e.cloud.init({env:n.env}),this.wxCloud=e.cloud))}catch(i){}this.refreshTokenFunc=n.refreshTokenFunc||this.defaultRefreshTokenFunc,this.anonymousSignInFunc=n.anonymousSignInFunc,this.onCredentialsError=n.onCredentialsError,v.langEvent.bus.on(v.langEvent.LANG_CHANGE_EVENT,(function(e){var t;r.i18n=(null===(t=e.data)||void 0===t?void 0:t.i18n)||r.i18n}))}return(0,s.default)(t,[{key:"setCredentials",value:function(e){return this.localCredentials.setCredentials(e)}},{key:"setAccessKeyCredentials",value:function(e){return this.localCredentials.setAccessKeyCredentials(e)}},{key:"getAccessToken",value:function(){var e=(0,u.default)(i.default.mark((function e(){var t,n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getCredentials();case 2:if(t=e.sent,null===t||void 0===t||!t.access_token){e.next=5;break}return e.abrupt("return",Promise.resolve(t.access_token));case 5:return n={error:c.ErrorType.UNAUTHENTICATED},e.abrupt("return",Promise.reject(n));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,u.default)(i.default.mark((function e(n,r){var a,s,u,l,d,f,p,h,g,v;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r||(r={}),d=this.formatRetry(r.retry,this.retry),r.headers=y(y({},r.headers),{},(0,o.default)({},null===(a=this.i18n)||void 0===a?void 0:a.LANG_HEADER_KEY,null===(s=this.i18n)||void 0===s?void 0:s.lang)),this.headers&&(r.headers=y(y({},this.headers),r.headers)),r.headers["x-request-id"]||(r.headers["x-request-id"]=b()),r.headers["x-device-id"]){e.next=10;break}return e.next=8,this.getDeviceId();case 8:f=e.sent,r.headers["x-device-id"]=f;case 10:if(null!==(u=r)&&void 0!==u&&u.withBasicAuth&&this.basicAuth&&(r.headers.Authorization=this.basicAuth),null===(l=r)||void 0===l||!l.withCredentials){e.next=18;break}return e.next=14,this.getCredentials();case 14:p=e.sent,p&&(this.tokenInURL?(n.indexOf("?")<0&&(n+="?"),n+="access_token=".concat(p.access_token)):r.headers.Authorization="".concat(p.token_type," ").concat(p.access_token)),e.next=19;break;case 18:this.clientId&&n.indexOf("client_id")<0&&(n+=n.indexOf("?")<0?"?":"&",n+="client_id=".concat(this.clientId));case 19:n.startsWith("/")&&(n="".concat(this.apiOrigin).concat(this.apiPath).concat(n)),h=null,g=d+1,v=0;case 23:if(!(v<g)){e.next=50;break}if(e.prev=24,!r.useWxCloud&&!this.useWxCloud){e.next=31;break}return e.next=28,this.wxCloudCallFunction(n,r);case 28:h=e.sent,e.next=34;break;case 31:return e.next=33,this.baseRequest(n,r);case 33:h=e.sent;case 34:return e.abrupt("break",50);case 37:if(e.prev=37,e.t0=e["catch"](24),!r.withCredentials||!e.t0||e.t0.error!==c.ErrorType.UNAUTHENTICATED){e.next=43;break}return e.next=42,this.setCredentials(null);case 42:return e.abrupt("return",Promise.reject(e.t0));case 43:if(v!==d&&e.t0&&"unreachable"===e.t0.error){e.next=45;break}return e.abrupt("return",Promise.reject(e.t0));case 45:return e.next=47,this.sleep(t.retryInterval);case 47:v++,e.next=23;break;case 50:return e.abrupt("return",h);case 51:case"end":return e.stop()}}),e,this,[[24,37]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"wxCloudCallFunction",value:function(){var t=(0,u.default)(i.default.mark((function t(n,r){var o,a,s,u,l,d;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=null,a=null,t.prev=2,u="",t.prev=4,t.next=7,e.getRendererUserAgent();case 7:u=t.sent,t.next=12;break;case 10:t.prev=10,t.t0=t["catch"](4);case 12:return t.next=14,this.wxCloud.callFunction({name:"httpOverCallFunction",data:{url:n,method:r.method,headers:y({origin:"https://servicewechat.com","User-Agent":u},r.headers),body:r.body}});case 14:l=t.sent,d=l.result,null!==d&&void 0!==d&&null!==(s=d.body)&&void 0!==s&&s.error_code?(a=null===d||void 0===d?void 0:d.body,a.error_uri=(0,f.getPathName)(n)):o=null===d||void 0===d?void 0:d.body,t.next=22;break;case 19:t.prev=19,t.t1=t["catch"](2),a={error:c.ErrorType.UNREACHABLE,error_description:t.t1.message,error_uri:(0,f.getPathName)(n)};case 22:if(!a){t.next=26;break}throw a;case 26:return t.abrupt("return",o);case 27:case"end":return t.stop()}}),t,this,[[2,19],[4,10]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getCredentials",value:function(){var e=(0,u.default)(i.default.mark((function e(){var t,n,r,o,a,s;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.localCredentials.getCredentials();case 2:if(t=e.sent,t){e.next=7;break}return r="credentials not found",null===(n=this.onCredentialsError)||void 0===n||n.call(this,{msg:r}),e.abrupt("return",this.unAuthenticatedError(r));case 7:if(!I(t)){e.next=36;break}if(!t.refresh_token){e.next=27;break}return e.prev=9,e.next=12,this.refreshToken(t);case 12:t=e.sent,e.next=25;break;case 15:if(e.prev=15,e.t0=e["catch"](9),"anonymous"!==t.scope){e.next=23;break}return e.next=20,this.anonymousLogin(t);case 20:t=e.sent,e.next=25;break;case 23:return null===(o=this.onCredentialsError)||void 0===o||o.call(this,{msg:e.t0.error_description}),e.abrupt("return",Promise.reject(e.t0));case 25:e.next=36;break;case 27:if("anonymous"!==t.scope){e.next=33;break}return e.next=30,this.anonymousLogin(t);case 30:t=e.sent,e.next=36;break;case 33:return s="no refresh token found in credentials",null===(a=this.onCredentialsError)||void 0===a||a.call(this,{msg:s}),e.abrupt("return",this.unAuthenticatedError(s));case 36:return e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[9,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"getCredentialsSync",value:function(){var e=this.localCredentials.getStorageCredentialsSync();return e}},{key:"getCredentialsAsync",value:function(){return this.getCredentials()}},{key:"getScope",value:function(){var e=(0,u.default)(i.default.mark((function e(){var t,n,r;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.localCredentials.getCredentials();case 2:if(t=e.sent,t){e.next=7;break}return r="credentials not found",null===(n=this.onCredentialsError)||void 0===n||n.call(this,{msg:r}),e.abrupt("return",this.unAuthenticatedError(r));case 7:return e.abrupt("return",t.scope);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGroups",value:function(){var e=(0,u.default)(i.default.mark((function e(){var t,n,r;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.localCredentials.getCredentials();case 2:if(t=e.sent,t){e.next=7;break}return r="credentials not found",null===(n=this.onCredentialsError)||void 0===n||n.call(this,{msg:r}),e.abrupt("return",this.unAuthenticatedError(r));case 7:return e.abrupt("return",t.groups);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshToken",value:function(){var e=(0,u.default)(i.default.mark((function e(t){var n=this;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.singlePromise.run("_refreshToken",(0,u.default)(i.default.mark((function e(){var r,o,a,s,u,l;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&t.refresh_token){e.next=4;break}return o="no refresh token found in credentials",null===(r=n.onCredentialsError)||void 0===r||r.call(n,{msg:o}),e.abrupt("return",n.unAuthenticatedError(o));case 4:return e.prev=4,e.next=7,n.refreshTokenFunc(t.refresh_token,t);case 7:return a=e.sent,e.next=10,n.localCredentials.setCredentials(a);case 10:return e.abrupt("return",a);case 13:if(e.prev=13,e.t0=e["catch"](4),e.t0.error!==c.ErrorType.INVALID_GRANT){e.next=21;break}return e.next=18,n.localCredentials.setCredentials(null);case 18:return l=e.t0.error_description,null===(u=n.onCredentialsError)||void 0===u||u.call(n,{msg:l}),e.abrupt("return",n.unAuthenticatedError(l));case 21:return null===(s=n.onCredentialsError)||void 0===s||s.call(n,{msg:e.t0.error_description}),e.abrupt("return",Promise.reject(e.t0));case 23:case"end":return e.stop()}}),e,null,[[4,13]])})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"anonymousLogin",value:function(){var e=(0,u.default)(i.default.mark((function e(t){var n=this;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.singlePromise.run("_anonymousLogin",(0,u.default)(i.default.mark((function e(){var r;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n.anonymousSignInFunc){e.next=12;break}return e.next=3,n.anonymousSignInFunc(t);case 3:if(r=e.sent,e.t0=r,e.t0){e.next=9;break}return e.next=8,n.localCredentials.getCredentials();case 8:e.t0=e.sent;case 9:t=e.t0,e.next=15;break;case 12:return e.next=14,n.anonymousSignIn(t);case 14:t=e.sent;case 15:return e.abrupt("return",t);case 16:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkRetry",value:function(e){var n=null;if(("number"!==typeof e||e<t.minRetry||e>t.maxRetry)&&(n={error:c.ErrorType.UNREACHABLE,error_description:"wrong options param: retry"}),n)throw n;return e}},{key:"formatRetry",value:function(e,t){return"undefined"===typeof e?t:this.checkRetry(e)}},{key:"sleep",value:function(){var e=(0,u.default)(i.default.mark((function e(t){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"anonymousSignIn",value:function(){var e=(0,u.default)(i.default.mark((function e(t){var n=this;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.singlePromise.run("_anonymous",(0,u.default)(i.default.mark((function e(){var r;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&"anonymous"===t.scope){e.next=2;break}return e.abrupt("return",n.unAuthenticatedError("no anonymous in credentials"));case 2:return e.prev=2,e.next=5,n.request(l.ApiUrls.AUTH_SIGN_IN_ANONYMOUSLY_URL,{method:"POST",withBasicAuth:!0,body:{}});case 5:return r=e.sent,e.next=8,n.localCredentials.setCredentials(r);case 8:return e.abrupt("return",r);case 11:if(e.prev=11,e.t0=e["catch"](2),e.t0.error!==c.ErrorType.INVALID_GRANT){e.next=17;break}return e.next=16,n.localCredentials.setCredentials(null);case 16:return e.abrupt("return",n.unAuthenticatedError(e.t0.error_description));case 17:return e.abrupt("return",Promise.reject(e.t0));case 18:case"end":return e.stop()}}),e,null,[[2,11]])})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"defaultRefreshTokenFunc",value:function(){var e=(0,u.default)(i.default.mark((function e(t,n){var r,o,a,s;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(void 0!==t&&""!==t){e.next=4;break}return o="refresh token not found",null===(r=this.onCredentialsError)||void 0===r||r.call(this,{msg:o}),e.abrupt("return",this.unAuthenticatedError(o));case 4:return a=l.ApiUrls.AUTH_TOKEN_URL,"v2"===(null===n||void 0===n?void 0:n.version)&&(a=l.ApiUrlsV2.AUTH_TOKEN_URL),e.next=8,this.request(a,{method:"POST",body:{client_id:this.clientId,client_secret:this.clientSecret,grant_type:"refresh_token",refresh_token:t}});case 8:return s=e.sent,e.abrupt("return",y(y({},s),{},{version:(null===n||void 0===n?void 0:n.version)||"v1"}));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDeviceId",value:function(){var e=(0,u.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.deviceID){e.next=2;break}return e.abrupt("return",this.deviceID);case 2:return e.next=4,this.storage.getItem("device_id");case 4:if(t=e.sent,"string"===typeof t&&t.length>=16&&t.length<=48){e.next=9;break}return t=(0,d.uuidv4)(),e.next=9,this.storage.setItem("device_id",t);case 9:return this.deviceID=t,e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unAuthenticatedError",value:function(e){var t={error:c.ErrorType.UNAUTHENTICATED,error_description:e};return Promise.reject(t)}}]),t}();t.OAuth2Client=T,T.defaultRetry=2,T.minRetry=0,T.maxRetry=5,T.retryInterval=1e3}).call(this,n("ed83")["default"])},2256:function(e,t,n){var r=n("2b37");e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},"22c0":function(e,t,n){"use strict";n.r(t);var r=n("133d"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"241b":function(e,t,n){var r=n("8a60");e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},"264a":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"COMMUNITY_SITE_URL",{enumerable:!0,get:function(){return o.COMMUNITY_SITE_URL}}),Object.defineProperty(t,"CloudbaseCache",{enumerable:!0,get:function(){return u.CloudbaseCache}}),Object.defineProperty(t,"CloudbaseEventEmitter",{enumerable:!0,get:function(){return s.CloudbaseEventEmitter}}),Object.defineProperty(t,"ERRORS",{enumerable:!0,get:function(){return o.ERRORS}}),Object.defineProperty(t,"adapterForWxMp",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"catchErrorsDecorator",{enumerable:!0,get:function(){return a.catchErrorsDecorator}}),Object.defineProperty(t,"printWarn",{enumerable:!0,get:function(){return i.printWarn}}),Object.defineProperty(t,"throwError",{enumerable:!0,get:function(){return i.throwError}}),Object.defineProperty(t,"useDefaultAdapter",{enumerable:!0,get:function(){return l.useDefaultAdapter}});var i=n("37e5"),o=n("9e9d"),a=n("0834"),s=n("05f4"),u=n("13cf"),c=r(n("9eea")),l=n("3490")},"274f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTimeoutError=t.isRealtimeErrorMessageError=t.isCancelledError=t.TimeoutError=t.RealtimeErrorMessageError=t.ERR_CODE=t.CloudSDKError=t.CancelledError=void 0;var r=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t){var n=e.call(this,"Watch Error ".concat(JSON.stringify(t.msgData)," (requestid: ").concat(t.requestId,")"))||this;return n.isRealtimeErrorMessageError=!0,n.payload=t,n}return r(t,e),t}(Error);t.RealtimeErrorMessageError=i;t.isRealtimeErrorMessageError=function(e){return null===e||void 0===e?void 0:e.isRealtimeErrorMessageError};var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="timeout",t.payload=null,t.generic=!0,t}return r(t,e),t}(Error);t.TimeoutError=o;t.isTimeoutError=function(e){return"timeout"===e.type};var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="cancelled",t.payload=null,t.generic=!0,t}return r(t,e),t}(Error);t.CancelledError=a;t.isCancelledError=function(e){return"cancelled"===e.type};var s=function(e){function t(t){var n=e.call(this,t.errMsg)||this;return n.errCode="UNKNOWN_ERROR",Object.defineProperties(n,{message:{get:function(){return"errCode: ".concat(this.errCode," ").concat(u[this.errCode]||""," | errMsg: ").concat(this.errMsg)},set:function(e){this.errMsg=e}}}),n.errCode=t.errCode||"UNKNOWN_ERROR",n.errMsg=t.errMsg,n}return r(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return"errCode: ".concat(this.errCode," | errMsg: ").concat(this.errMsg)},set:function(e){this.errMsg=e},enumerable:!1,configurable:!0}),t}(Error);t.CloudSDKError=s;var u={UNKNOWN_ERROR:"UNKNOWN_ERROR",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:"SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:"SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:"SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR"};t.ERR_CODE=u},"285e":function(e,t,n){(function(t){var r=n("127e"),i=n("ee10");function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=["userOpenId","openid"];function u(){if("function"===typeof getApp)try{return getApp()}catch(e){t("warn","[auth] \u83b7\u53d6 App \u5b9e\u4f8b\u5931\u8d25",e," at utils/auth.js:8")}return null}function c(){if("undefined"===typeof uni||"function"!==typeof uni.getStorageSync)return null;var e,n=o(s);try{for(n.s();!(e=n.n()).done;){var r=e.value;try{var i=uni.getStorageSync(r);if(i)return i}catch(a){t("warn","[auth] \u8bfb\u53d6\u672c\u5730 openid(".concat(r,") \u5931\u8d25"),a," at utils/auth.js:25")}}}catch(u){n.e(u)}finally{n.f()}return null}function l(e){if(e){var n=u();if(n&&(n.globalData=n.globalData||{},n.globalData.openid=e),"undefined"!==typeof uni&&"function"===typeof uni.setStorageSync)try{uni.setStorageSync("userOpenId",e)}catch(r){t("warn","[auth] \u7f13\u5b58 openid \u5931\u8d25",r," at utils/auth.js:44")}}}function d(){return d=i(r.mark((function e(){var t,n,i;return r.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=u(),n=t&&t.globalData&&t.globalData.openid,!n){e.next=4;break}return e.abrupt("return",n);case 4:if(i=c(),!i){e.next=8;break}return l(i),e.abrupt("return",i);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}e.exports={getOpenId:function(){return d.apply(this,arguments)},setLoginState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=u();n&&(n.globalData=n.globalData||{},t&&(n.globalData.openid=t,l(t)),e&&(n.globalData.userInfo=Object.assign({},n.globalData.userInfo||{},e)),n.globalData._loginProcessCompleted=!0)}}}).call(this,n("f3b9")["default"])},"28d0":function(e,t,n){t.nextTick=function(e){var t=Array.prototype.slice.call(arguments);t.shift(),setTimeout((function(){e.apply(null,t)}),0)},t.platform=t.arch=t.execPath=t.title="browser",t.pid=1,t.browser=!0,t.env={},t.argv=[],t.binding=function(e){throw new Error("No such module. (Possibly not yet loaded)")},function(){var e,r="/";t.cwd=function(){return r},t.chdir=function(t){e||(e=n("a3fc")),r=e.resolve(t,r)}}(),t.exit=t.kill=t.umask=t.dlopen=t.uptime=t.memoryUsage=t.uvCounters=function(){},t.features={}},"2a0b":function(e,t,n){"use strict";var r=n("3b2d");Object.defineProperty(t,"__esModule",{value:!0}),t.RUNTIME=void 0,t.useAdapters=function(e,t){for(var n=(0,o.isArray)(e)?e:[e],r=0,i=n;r<i.length;r++){var a=i[r],s=a.isMatch,c=a.genAdapter,l=a.runtime;if(s())return{adapter:u({isMatch:s},c(t)),runtime:l}}},t.useDefaultAdapter=function(){return{adapter:i.genAdapter(),runtime:s.WEB}};var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var u=o?Object.getOwnPropertyDescriptor(e,s):null;u&&(u.get||u.set)?Object.defineProperty(i,s,u):i[s]=e[s]}i.default=e,n&&n.set(e,i);return i}(n("511c")),o=n("6e68");function a(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}var s,u=function(){return u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},u.apply(this,arguments)};t.RUNTIME=s,function(e){e["WEB"]="web",e["WX_MP"]="wx_mp"}(s||(t.RUNTIME=s={}))},"2a43":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.selectAllComponents=function(e){return d.call(this,e)},t.selectComponent=function(e){return l.call(this,e)};var i=r(n("af34")),o=r(n("67ad")),a=r(n("0bdb"));r(n("3b2d"));var s=function(e,t){var n,r,i,o=e._vnode;if(o=null!==(n=null===(r=o)||void 0===r||null===(i=r.context)||void 0===i?void 0:i.$vnode)&&void 0!==n?n:"",!o||!o.data)return!1;var a=o.data.attrs||{},s=o.data.staticClass||"",u=a.id||"";return"#"===t[0]?t.substr(1)===u:(s=s.trim().split(" "),t=t.substr(1).split("."),t.reduce((function(e,t){return e&&s.includes(t)}),!0))},u=function(e){return e&&"string"===typeof e?(e=e.replace(/>>>/g,">"),e=e.split(">").map((function(e){return e.trim().split(" ").join("').descendant('")})).join("').child('"),function(t,n,r){return new t(n,r).descendant(e)}):function(){return[]}},c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,o.default)(this,e),this.nodes=[t],this.all=n}return(0,a.default)(e,[{key:"child",value:function(e){var t=[];if(this.all)this.nodes.forEach((function(n){var r;(r=t).push.apply(r,(0,i.default)(n.$children.filter((function(t){return s(t,e)}))))}));else if(this.nodes.length>0){var n=this.nodes[0].$children.find((function(t){return s(t,e)}));t=n?[n]:[]}return this.nodes=t,this}},{key:"descendant",value:function(e){var t=this,n=[];return this.nodes.forEach((function(r){(function(){var e=!1;return function t(n,r){if(!e&&"function"===typeof r)for(var i=n.$children,o=0;!e&&o<i.length;o++){var a=i[o];e=!0===r(a),t(a,r)}}})()(r,(function(r){if(s(r,e))return n.push(r),!t.all}))})),this.nodes=n,this}}]),e}();function l(e){var t=e.split(",").map((function(e){return e.trim()}));if(!t[0])return null;var n=u(t[0]);return n(c,this,!1,e).nodes[0]}function d(e){var t=this,n=e.split(",").map((function(e){return e.trim()})),r=[];return n.forEach((function(e){var n=u(e);r=r.concat(n(c,t,!0,e).nodes)})),r}}).call(this,n("f3b9")["default"])},"2a65":function(e,t,n){var r=n("76e0");e.exports=function(){this.__data__=new r,this.size=0}},"2a89":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),style:e._$s(0,"s","padding-top: "+e.statusBarHeight+"px;"),attrs:{_i:0}},[n("view",{staticClass:e._$s(1,"sc","header"),style:e._$s(1,"s","top: "+e.statusBarHeight+"px;"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","header-left"),attrs:{_i:2},on:{click:e.goBack}},[n("text",{staticClass:e._$s(3,"sc","back-icon"),attrs:{_i:3}})]),n("text",{staticClass:e._$s(4,"sc","header-title"),attrs:{_i:4}}),n("view",{staticClass:e._$s(5,"sc","header-right"),attrs:{_i:5}})]),n("view",{staticClass:e._$s(6,"sc","content-section"),attrs:{_i:6}},[n("view",{staticClass:e._$s(7,"sc","section-title"),attrs:{_i:7}}),n("textarea",{staticClass:e._$s(8,"sc","content-input"),attrs:{value:e._$s(8,"a-value",e.content),_i:8},on:{input:e.onContentInput}}),n("view",{staticClass:e._$s(9,"sc","char-count"),attrs:{_i:9}},[e._v(e._$s(9,"t0-0",e._s(e.content.length)))])]),n("view",{staticClass:e._$s(10,"sc","image-section"),attrs:{_i:10}},[n("view",{staticClass:e._$s(11,"sc","section-title"),attrs:{_i:11}}),n("view",{staticClass:e._$s(12,"sc","image-upload-area"),attrs:{_i:12}},[n("view",{staticClass:e._$s(13,"sc","image-list"),attrs:{_i:13}},[e._l(e._$s(14,"f",{forItems:e.images}),(function(t,r,i,o){return n("view",{key:e._$s(14,"f",{forIndex:i,key:r}),staticClass:e._$s("14-"+o,"sc","image-item"),attrs:{_i:"14-"+o}},[n("image",{staticClass:e._$s("15-"+o,"sc","preview-image"),attrs:{src:e._$s("15-"+o,"a-src",t.path),"data-index":e._$s("15-"+o,"a-data-index",r),_i:"15-"+o},on:{click:e.previewImage}}),n("view",{staticClass:e._$s("16-"+o,"sc","delete-btn"),attrs:{"data-index":e._$s("16-"+o,"a-data-index",r),_i:"16-"+o},on:{click:e.removeImage}},[n("text",{staticClass:e._$s("17-"+o,"sc","delete-icon"),attrs:{_i:"17-"+o}})])])})),e._$s(18,"i",e.images.length<e.maxImages)?n("view",{staticClass:e._$s(18,"sc","add-image-btn"),attrs:{_i:18},on:{click:e.chooseImages}},[n("text",{staticClass:e._$s(19,"sc","add-icon"),attrs:{_i:19}}),n("text",{staticClass:e._$s(20,"sc","add-text"),attrs:{_i:20}})]):e._e()],2)]),n("view",{staticClass:e._$s(21,"sc","image-tip"),attrs:{_i:21}},[e._v(e._$s(21,"t0-0",e._s(e.maxImages)))])]),n("view",{staticClass:e._$s(22,"sc","submit-section"),attrs:{_i:22}},[n("button",{class:e._$s(23,"c","submit-btn "+(e.submitting?"submitting":"")),attrs:{disabled:e._$s(23,"a-disabled",e.submitting),_i:23},on:{click:e.submitFeedback}},[e._v(e._$s(23,"t0-0",e._s(e.submitting?"\u63d0\u4ea4\u4e2d...":"\u63d0\u4ea4\u53cd\u9988")))])]),n("view",{staticClass:e._$s(24,"sc","footer-tip"),attrs:{_i:24}},[n("text",{staticClass:e._$s(25,"sc","tip-text"),attrs:{_i:25}})])])},i=[]},"2b37":function(e,t,n){var r=n("ab04");e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},"2b90":function(e,t,n){var r=n("3b2d"),i=n("7ca3");function o(e){return"undefined"===typeof uni||"function"!==typeof uni.createSelectorQuery?null:uni.createSelectorQuery().in(e)}function a(e,t,n){if("function"!==typeof e.setData){for(var o=t.replace(/\[(.*?)\]/g,".$1").replace(/^\./,""),a=o.split("."),s=e,u=0;u<a.length-1;u+=1){var c=a[u];s[c]&&"object"===r(s[c])||(s[c]={}),s=s[c]}s[a[a.length-1]]=n}else e.setData(i({},t,n))}e.exports={data:function(){return{__galleryImageMeta:{}}},created:function(){"undefined"===typeof this.swiperHeights&&(this.swiperHeights={}),"undefined"===typeof this.imageClampHeights&&(this.imageClampHeights={}),"undefined"===typeof this.imageCache&&(this.imageCache={})},methods:{onImageLoad:function(e){if(e&&e.detail&&e.currentTarget){var t=e.currentTarget.dataset||{},n=e.detail,r=n.width,i=n.height;if(r&&i){var o=function(e){return void 0!==e.galleryKey&&null!==e.galleryKey?e.galleryKey:void 0!==e.postindex&&null!==e.postindex?e.postindex:void 0!==e.postIndex&&null!==e.postIndex?e.postIndex:void 0!==e.index&&null!==e.index?e.index:void 0!==e.postid&&null!==e.postid?e.postid:void 0!==e.postId&&null!==e.postId?e.postId:void 0!==e.imgindex?"gallery-".concat(e.imgindex):"gallery"}(t),a="undefined"!==typeof t.imgindex?t.imgindex:t.imgIndex||0,s=t.type||t.imageType||"single",u="".concat(o,"_").concat(a);this.__galleryImageMeta&&(this.__galleryImageMeta[u]={width:r,height:i}),this.imageCache&&(this.imageCache[u]={width:r,height:i});var c=Number(this.galleryMinImageRatio)||9/16,l=Number(this.galleryMaxImageRatio)||16/9;if("multi"===s&&0===Number(a)){var d=t.swiperSelector||t.gallerySelector||"#swiper-".concat(o);this.__updateSwiperHeight({key:o,selector:d,originalWidth:r,originalHeight:i,minRatio:c,maxRatio:l})}if("single"===s){var f=t.singleSelector||t.imageSelector||"#single-image-".concat(o);this.__updateClampHeight({key:o,selector:f,originalWidth:r,originalHeight:i,minRatio:c})}}}},__updateSwiperHeight:function(e){var t=this,n=e.key,r=e.selector,i=e.originalWidth,s=e.originalHeight,u=e.minRatio,c=e.maxRatio;if(r){var l=o(this);l&&l.select(r).boundingClientRect((function(e){if(e&&e.width){var r=i/s,o=function(e,t,n){return e>n?n:e<t?t:e}(r,u,c),l=e.width/o;a(t,"swiperHeights[".concat(n,"]"),l)}})).exec()}},__updateClampHeight:function(e){var t=this,n=e.key,r=e.selector,i=e.originalWidth,s=e.originalHeight,u=e.minRatio,c=i/s;if(!(c>=u)){var l=r?o(this):null;if(r&&l)l.select(r).boundingClientRect((function(e){if(e&&e.width){var r=e.width/u;a(t,"imageClampHeights.".concat(n),r)}})).exec();else if(this.galleryFallbackWidth){var d=this.galleryFallbackWidth/u;a(this,"imageClampHeights.".concat(n),d)}}}}}},"2bfd":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.getEncryptInfo=void 0;var i=r(n("3b2d")),o=r(n("612d")),a=n("a9a5");t.getEncryptInfo=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.publicKey,r=void 0===n?"":n,s=t.payload,u=void 0===s?{}:s;if(!r)return"";try{var c=(0,a.deepClone)(u),l=new o.default;l.setPublicKey(r);var d=l.encryptLong("object"===(0,i.default)(c)?JSON.stringify(c):c);return d}catch(f){e("error","encrypt error:",f," at node_modules/@cloudbase/oauth/dist/esm/utils/encrypt.js:14")}return""}}).call(this,n("f3b9")["default"])},"2c09":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;getApp();var r=n("139b"),i=r.formatTimeAgo,o={data:function(){return{messages:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:10,activeTab:"all",unreadCount:0}},onLoad:function(e){this.loadMessages()},onShow:function(){0===this.messages.length?this.loadMessages():this.checkUnreadCount()},onPullDownRefresh:function(){this.setData({messages:[],page:0,hasMore:!0}),this.loadMessages((function(){uni.stopPullDownRefresh()}))},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadMessages()},onScrollToUpper:function(){e("log","\u6eda\u52a8\u5230\u9876\u90e8"," at pages/messages/messages.vue:169")},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return cloudCall(e,t,Object.assign({pageTag:"messages",context:this,requireAuth:!0},n))},switchTab:function(e){var t=e.currentTarget.dataset.tab;t!==this.activeTab&&(this.setData({activeTab:t,messages:[],page:0,hasMore:!0}),this.loadMessages())},loadMessages:function(t){var n=this;if(!this.isLoading){e("log","\ud83d\udd0d [\u6d88\u606f\u9875] \u5f00\u59cb\u52a0\u8f7d\u6d88\u606f\uff0c\u9875\u7801:",this.page,"\u7c7b\u578b:",this.activeTab," at pages/messages/messages.vue:197"),this.setData({isLoading:!0});var r=this.page,o=this.PAGE_SIZE,a=this.activeTab;this.callCloudFunction("getMessages",{skip:r*o,limit:o,type:"all"===a?null:a}).then((function(t){if(e("log","\ud83d\udd0d [\u6d88\u606f\u9875] \u4e91\u51fd\u6570\u8fd4\u56de\u7ed3\u679c:",t," at pages/messages/messages.vue:207"),t.result&&t.result.success){var a=t.result.messages||[];t.result.totalCount;a.forEach((function(e){if(e.createTime){var t=i(e.createTime);e.formattedTime=t;var n=e.fromUserName||"\u67d0\u7528\u6237",r=e.content||"";if("like"===e.type)e.content="".concat(n," ").concat(t,"\u70b9\u8d5e\u4e86\u4f60\u7684\u5e16\u5b50");else if("comment"===e.type){var o=r.includes("\u56de\u590d\u4e86\u4f60\u7684\u8bc4\u8bba"),a=o?"\u56de\u590d\u4e86\u4f60\u7684\u8bc4\u8bba":"\u8bc4\u8bba\u4e86\u4f60\u7684\u5e16\u5b50";e.content="".concat(n," ").concat(t).concat(a)}else"favorite"===e.type?e.content="".concat(n," ").concat(t,"\u6536\u85cf\u4e86\u4f60\u7684\u5e16\u5b50"):"feedback"===e.type?e.content="".concat(n," ").concat(t,"\u63d0\u4ea4\u4e86\u65b0\u7684\u610f\u89c1\u53cd\u9988"):"feedback_processed"===e.type&&(e.content="\u7ba1\u7406\u5458 ".concat(t,"\u5904\u7406\u4e86\u60a8\u7684\u610f\u89c1\u53cd\u9988"))}}));var s=0===r?a:n.messages.concat(a);n.setData({messages:s,page:r+1,hasMore:a.length===o,unreadCount:t.result.unreadCount||0}),a.length>0&&n.markMessagesAsRead(a.filter((function(e){return!e.isRead})).map((function(e){return e._id})))}})).catch((function(t){e("error","\u83b7\u53d6\u6d88\u606f\u5931\u8d25:",t," at pages/messages/messages.vue:252"),uni.showToast({title:"\u83b7\u53d6\u6d88\u606f\u5931\u8d25",icon:"none"})})).finally((function(){n.setData({isLoading:!1}),t&&t()}))}},checkUnreadCount:function(){var t=this;this.callCloudFunction("getUnreadMessageCount",{}).then((function(e){e.result&&e.result.success&&t.setData({unreadCount:e.result.count||0})})).catch((function(t){e("error","\u83b7\u53d6\u672a\u8bfb\u6d88\u606f\u6570\u91cf\u5931\u8d25:",t," at pages/messages/messages.vue:276")}))},markMessagesAsRead:function(t){var n=this;t&&0!==t.length&&this.callCloudFunction("markMessagesAsRead",{messageIds:t}).then((function(e){if(e.result&&e.result.success){var r=n.messages.map((function(e){return t.includes(e._id)&&(e.isRead=!0),e}));n.setData({messages:r,unreadCount:Math.max(0,n.unreadCount-t.length)})}})).catch((function(t){e("error","\u6807\u8bb0\u6d88\u606f\u4e3a\u5df2\u8bfb\u5931\u8d25:",t," at pages/messages/messages.vue:302")}))},navigateToPost:function(e){var t=e.currentTarget.dataset.postid;t&&uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},deleteMessage:function(t){var n=this,r=t.currentTarget.dataset.messageid,i=t.currentTarget.dataset.index;uni.showModal({title:"\u786e\u8ba4\u5220\u9664",content:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u6d88\u606f\u5417\uff1f",success:function(t){t.confirm&&n.callCloudFunction("deleteMessage",{messageId:r}).then((function(e){if(e.result&&e.result.success){var t=n.messages.filter((function(e,t){return t!==i}));n.setData({messages:t}),uni.showToast({title:"\u5220\u9664\u6210\u529f",icon:"success"})}})).catch((function(t){e("error","\u5220\u9664\u6d88\u606f\u5931\u8d25:",t," at pages/messages/messages.vue:339"),uni.showToast({title:"\u5220\u9664\u5931\u8d25",icon:"none"})}))}})},clearAllMessages:function(){var t=this;uni.showModal({title:"\u6e05\u7a7a\u6d88\u606f",content:"\u786e\u5b9a\u8981\u6e05\u7a7a\u6240\u6709\u6d88\u606f\u5417\uff1f\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d\u3002",success:function(n){n.confirm&&t.callCloudFunction("clearAllMessages",{}).then((function(e){e.result&&e.result.success&&(t.setData({messages:[],page:0,hasMore:!1,unreadCount:0}),uni.showToast({title:"\u5df2\u6e05\u7a7a",icon:"success"}))})).catch((function(t){e("error","\u6e05\u7a7a\u6d88\u606f\u5931\u8d25:",t," at pages/messages/messages.vue:371"),uni.showToast({title:"\u6e05\u7a7a\u5931\u8d25",icon:"none"})}))}})}}};t.default=o}).call(this,n("f3b9")["default"])},"2ce5":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationUsages=t.ErrorType=t.ApiUrlsV2=t.ApiUrls=t.AUTH_API_PREFIX=void 0;var r,i,o,a;t.AUTH_API_PREFIX="/auth",t.ApiUrls=r,function(e){e["AUTH_SIGN_UP_URL"]="/v1/signup",e["AUTH_TOKEN_URL"]="/v1/token",e["AUTH_REVOKE_URL"]="/v1/revoke",e["WEDA_USER_URL"]="/v1/plugin/weda/userinfo",e["AUTH_RESET_PASSWORD"]="/v1/reset",e["AUTH_GET_DEVICE_CODE"]="/v1/device/code",e["CHECK_USERNAME"]="/v1/checkUsername",e["CHECK_IF_USER_EXIST"]="/v1/checkIfUserExist",e["GET_PROVIDER_TYPE"]="/v1/mgr/provider/providerSubType",e["AUTH_SIGN_IN_URL"]="/v1/signin",e["AUTH_SIGN_IN_ANONYMOUSLY_URL"]="/v1/signin/anonymously",e["AUTH_SIGN_IN_WITH_PROVIDER_URL"]="/v1/signin/with/provider",e["AUTH_SIGN_IN_WITH_WECHAT_URL"]="/v1/signin/wechat/noauth",e["AUTH_SIGN_IN_CUSTOM"]="/v1/signin/custom",e["PROVIDER_TOKEN_URL"]="/v1/provider/token",e["PROVIDER_URI_URL"]="/v1/provider/uri",e["USER_ME_URL"]="/v1/user/me",e["AUTH_SIGNOUT_URL"]="/v1/user/signout",e["USER_QUERY_URL"]="/v1/user/query",e["USER_PRIFILE_URL"]="/v1/user/profile",e["USER_BASIC_EDIT_URL"]="/v1/user/basic/edit",e["USER_TRANS_BY_PROVIDER_URL"]="/v1/user/trans/by/provider",e["PROVIDER_LIST"]="/v1/user/provider",e["PROVIDER_BIND_URL"]="/v1/user/provider/bind",e["PROVIDER_UNBIND_URL"]="/v1/user/provider",e["CHECK_PWD_URL"]="/v1/user/sudo",e["SUDO_URL"]="/v1/user/sudo",e["BIND_CONTACT_URL"]="/v1/user/contact",e["AUTH_SET_PASSWORD"]="/v1/user/password",e["AUTHORIZE_DEVICE_URL"]="/v1/user/device/authorize",e["AUTHORIZE_URL"]="/v1/user/authorize",e["AUTHORIZE_INFO_URL"]="/v1/user/authorize/info",e["AUTHORIZED_DEVICES_DELETE_URL"]="/v1/user/authorized/devices/",e["AUTH_REVOKE_ALL_URL"]="/v1/user/revoke/all",e["GET_USER_BEHAVIOR_LOG"]="/v1/user/security/history",e["VERIFICATION_URL"]="/v1/verification",e["VERIFY_URL"]="/v1/verification/verify",e["CAPTCHA_DATA_URL"]="/v1/captcha/data",e["VERIFY_CAPTCHA_DATA_URL"]="/v1/captcha/data/verify",e["GET_CAPTCHA_URL"]="/v1/captcha/init",e["GET_MINIPROGRAM_QRCODE"]="/v1/qrcode/generate",e["GET_MINIPROGRAM_QRCODE_STATUS"]="/v1/qrcode/get/status"}(r||(t.ApiUrls=r={})),t.ApiUrlsV2=i,function(e){e["AUTH_SIGN_IN_URL"]="/v2/signin/username",e["AUTH_TOKEN_URL"]="/v2/token",e["USER_ME_URL"]="/v2/user/me",e["VERIFY_URL"]="/v2/signin/verificationcode",e["AUTH_SIGN_IN_WITH_PROVIDER_URL"]="/v2/signin/with/provider",e["AUTH_PUBLIC_KEY"]="/v2/signin/publichkey",e["AUTH_RESET_PASSWORD"]="/v2/signin/password/update"}(i||(t.ApiUrlsV2=i={})),t.VerificationUsages=o,function(e){e["REGISTER"]="REGISTER",e["SIGN_IN"]="SIGN_IN",e["PASSWORD_RESET"]="PASSWORD_RESET",e["EMAIL_ADDRESS_CHANGE"]="EMAIL_ADDRESS_CHANGE",e["PHONE_NUMBER_CHANGE"]="PHONE_NUMBER_CHANGE"}(o||(t.VerificationUsages=o={})),t.ErrorType=a,function(e){e["UNREACHABLE"]="unreachable",e["LOCAL"]="local",e["CANCELLED"]="cancelled",e["UNKNOWN"]="unknown",e["UNAUTHENTICATED"]="unauthenticated",e["RESOURCE_EXHAUSTED"]="resource_exhausted",e["FAILED_PRECONDITION"]="failed_precondition",e["INVALID_ARGUMENT"]="invalid_argument",e["DEADLINE_EXCEEDED"]="deadline_exceeded",e["NOT_FOUND"]="not_found",e["ALREADY_EXISTS"]="already_exists",e["PERMISSION_DENIED"]="permission_denied",e["ABORTED"]="aborted",e["OUT_OF_RANGE"]="out_of_range",e["UNIMPLEMENTED"]="unimplemented",e["INTERNAL"]="internal",e["UNAVAILABLE"]="unavailable",e["DATA_LOSS"]="data_loss",e["INVALID_PASSWORD"]="invalid_password",e["PASSWORD_NOT_SET"]="password_not_set",e["INVALID_STATUS"]="invalid_status",e["USER_PENDING"]="user_pending",e["USER_BLOCKED"]="user_blocked",e["INVALID_VERIFICATION_CODE"]="invalid_verification_code",e["TWO_FACTOR_REQUIRED"]="two_factor_required",e["INVALID_TWO_FACTOR"]="invalid_two_factor",e["INVALID_TWO_FACTOR_RECOVERY"]="invalid_two_factor_recovery",e["UNDER_REVIEW"]="under_review",e["INVALID_REQUEST"]="invalid_request",e["UNAUTHORIZED_CLIENT"]="unauthorized_client",e["ACCESS_DENIED"]="access_denied",e["UNSUPPORTED_RESPONSE_TYPE"]="unsupported_response_type",e["INVALID_SCOPE"]="invalid_scope",e["INVALID_GRANT"]="invalid_grant",e["SERVER_ERROR"]="server_error",e["TEMPORARILY_UNAVAILABLE"]="temporarily_unavailable",e["INTERACTION_REQUIRED"]="interaction_required",e["LOGIN_REQUIRED"]="login_required",e["ACCOUNT_SELECTION_REQUIRED"]="account_selection_required",e["CONSENT_REQUIRED"]="consent_required",e["INVALID_REQUEST_URI"]="invalid_request_uri",e["INVALID_REQUEST_OBJECT"]="invalid_request_object",e["REQUEST_NOT_SUPPORTED"]="request_not_supported",e["REQUEST_URI_NOT_SUPPORTED"]="request_uri_not_supported",e["REGISTRATION_NOT_SUPPORTED"]="registration_not_supported",e["CAPTCHA_REQUIRED"]="captcha_required",e["CAPTCHA_INVALID"]="captcha_invalid"}(a||(t.ErrorType=a={}))},"2f87":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.RealtimeWebSocketClient=void 0;var r=n("b3cf"),i=n("9ac9"),o=n("013c"),a=n("274f"),s=n("7ba2"),u=n("31ec"),c=function(){return c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},c.apply(this,arguments)},l=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},d=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},f={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},p=function(){function t(t){var n=this;this.virtualWSClient=new Set,this.queryIdClientMap=new Map,this.watchIdClientMap=new Map,this.pingFailed=0,this.pongMissed=0,this.logins=new Map,this.wsReadySubsribers=[],this.wsResponseWait=new Map,this.rttObserved=[],this.send=function(e){return l(n,void 0,void 0,(function(){var t=this;return d(this,(function(n){return[2,new Promise((function(n,r){!function(){l(t,void 0,void 0,(function(){var t,i,o,s,c,p,h,g,v=this;return d(this,(function(m){switch(m.label){case 0:i=!1,o=!1,s=function(e){i=!0,t&&clearTimeout(t),n(e)},c=function(e){o=!0,t&&clearTimeout(t),r(e)},e.timeout&&(t=setTimeout((function(){(function(){l(v,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return i&&o?[3,2]:[4,(0,u.sleep)(0)];case 1:e.sent(),i&&o||c(new a.TimeoutError("wsclient.send timedout")),e.label=2;case 2:return[2]}}))}))})()}),e.timeout)),m.label=1;case 1:return m.trys.push([1,8,,9]),void 0===this.wsInitPromise&&null===this.wsInitPromise?[3,3]:[4,this.wsInitPromise];case 2:m.sent(),m.label=3;case 3:if(!this.ws)return c(new Error("invalid state: ws connection not exists, can not send message")),[2];if(this.ws.readyState!==f.OPEN)return c(new Error("ws readyState invalid: ".concat(this.ws.readyState,", can not send message"))),[2];e.waitResponse&&(p={resolve:s,reject:c,skipOnMessage:e.skipOnMessage},this.wsResponseWait.set(e.msg.requestId,p)),m.label=4;case 4:return m.trys.push([4,6,,7]),[4,this.ws.send(JSON.stringify(e.msg))];case 5:return m.sent(),e.waitResponse||s(void 0),[3,7];case 6:return h=m.sent(),h&&(c(h),e.waitResponse&&this.wsResponseWait.delete(e.msg.requestId)),[3,7];case 7:return[3,9];case 8:return g=m.sent(),c(g),[3,9];case 9:return[2]}}))}))}()}))]}))}))},this.closeAllClients=function(e){n.virtualWSClient.forEach((function(t){t.closeWithError(e)}))},this.pauseClients=function(e){(e||n.virtualWSClient).forEach((function(e){e.pause()}))},this.resumeClients=function(e){(e||n.virtualWSClient).forEach((function(e){e.resume()}))},this.initWebSocketConnection=function(t,r){return void 0===r&&(r=n.maxReconnect),l(n,void 0,void 0,(function(){var n=this;return d(this,(function(i){switch(i.label){case 0:if(t&&this.reconnectState)return[2];if(t&&(this.reconnectState=!0),void 0!==this.wsInitPromise&&null!==this.wsInitPromise)return[2,this.wsInitPromise];t&&this.pauseClients(),this.close(o.CloseEventCode.ReconnectWebSocket),this.wsInitPromise=new Promise((function(i,o){(function(){l(n,void 0,void 0,(function(){var n,c,l=this;return d(this,(function(d){switch(d.label){case 0:return d.trys.push([0,6,,11]),[4,this.getWsSign()];case 1:return n=d.sent(),[4,new Promise((function(e){var t=n.wsUrl||"wss://tcb-ws.tencentcloudapi.com",r=(0,s.getWsClass)();l.ws=r?new r(t):new WebSocket(t),e(void 0)}))];case 2:return d.sent(),this.ws.connect?[4,this.ws.connect()]:[3,4];case 3:d.sent(),d.label=4;case 4:return[4,this.initWebSocketEvent()];case 5:return d.sent(),i(),t&&(this.resumeClients(),this.reconnectState=!1),[3,11];case 6:return c=d.sent(),e("error","[realtime] initWebSocketConnection connect fail",c," at node_modules/@cloudbase/realtime/dist/esm/websocket-client.js:249"),r>0?(!0,this.wsInitPromise=void 0,[4,(0,u.sleep)(this.reconnectInterval)]):[3,9];case 7:d.sent(),t&&(this.reconnectState=!1),d.label=8;case 8:return i(this.initWebSocketConnection(t,r-1)),[3,10];case 9:o(c),t&&this.closeAllClients(new a.CloudSDKError({errCode:a.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL,errMsg:c})),d.label=10;case 10:return[3,11];case 11:return[2]}}))}))})()})),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,this.wsInitPromise];case 2:return i.sent(),this.wsReadySubsribers.forEach((function(e){var t=e.resolve;return t()})),[3,5];case 3:return i.sent(),this.wsReadySubsribers.forEach((function(e){var t=e.reject;return t()})),[3,5];case 4:return this.wsInitPromise=void 0,this.wsReadySubsribers=[],[7];case 5:return[2]}}))}))},this.initWebSocketEvent=function(){return new Promise((function(t,r){if(!n.ws)throw new Error("can not initWebSocketEvent, ws not exists");var i=!1;n.ws.onopen=function(n){e("warn","[realtime] ws event: open",n," at node_modules/@cloudbase/realtime/dist/esm/websocket-client.js:312"),i=!0,t()},n.ws.onerror=function(t){n.logins=new Map,i?(e("error","[realtime] ws event: error",t," at node_modules/@cloudbase/realtime/dist/esm/websocket-client.js:323"),n.clearHeartbeat(),n.virtualWSClient.forEach((function(e){return e.closeWithError(new a.CloudSDKError({errCode:a.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR,errMsg:t}))}))):(e("error","[realtime] ws open failed with ws event: error",t," at node_modules/@cloudbase/realtime/dist/esm/websocket-client.js:319"),r(t))},n.ws.onclose=function(t){switch(e("warn","[realtime] ws event: close",t," at node_modules/@cloudbase/realtime/dist/esm/websocket-client.js:332"),n.logins=new Map,n.clearHeartbeat(),t.code){case o.CloseEventCode.ReconnectWebSocket:break;case o.CloseEventCode.NoRealtimeListeners:break;case o.CloseEventCode.HeartbeatPingError:case o.CloseEventCode.HeartbeatPongTimeoutError:case o.CloseEventCode.NormalClosure:case o.CloseEventCode.AbnormalClosure:n.maxReconnect>0?n.initWebSocketConnection(!0,n.maxReconnect):n.closeAllClients((0,o.getWSCloseError)(t.code));break;case o.CloseEventCode.NoAuthentication:n.closeAllClients((0,o.getWSCloseError)(t.code,t.reason));break;default:n.maxReconnect>0?n.initWebSocketConnection(!0,n.maxReconnect):n.closeAllClients((0,o.getWSCloseError)(t.code))}},n.ws.onmessage=function(t){var r,i,o=(null===(r=t.data)||void 0===r?void 0:r.data)||t.data;n.heartbeat();try{i="string"===typeof o?JSON.parse(o):o}catch(g){throw new Error("[realtime] onMessage parse res.data error: ".concat(g))}if("ERROR"===i.msgType){var s=null;n.virtualWSClient.forEach((function(e){e.watchId===i.watchId&&(s=e)})),s&&s.listener.onError(i)}var u=n.wsResponseWait.get(i.requestId);if(u){try{"ERROR"===i.msgType?u.reject(new a.RealtimeErrorMessageError(i)):u.resolve(i)}catch(g){e("error","ws onMessage responseWaitSpec.resolve(msg) errored:",g," at node_modules/@cloudbase/realtime/dist/esm/websocket-client.js:401")}finally{n.wsResponseWait.delete(i.requestId)}if(u.skipOnMessage)return}if("PONG"!==i.msgType){var c=i.watchId&&n.watchIdClientMap.get(i.watchId);if(c)c.onMessage(i);else switch(e("error","[realtime] no realtime listener found responsible for watchId ".concat(i.watchId,": "),i," at node_modules/@cloudbase/realtime/dist/esm/websocket-client.js:429"),i.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":c=n.queryIdClientMap.get(i.msgData.queryID),c&&c.onMessage(i);break;default:for(var l=0,d=Array.from(n.watchIdClientMap.entries());l<d.length;l++){var f=d[l],p=f[1];p.onMessage(i);break}}}else if(n.lastPingSendTS){var h=Date.now()-n.lastPingSendTS;if(h>1e4)return void e("warn","[realtime] untrusted rtt observed: ".concat(h)," at node_modules/@cloudbase/realtime/dist/esm/websocket-client.js:414");n.rttObserved.length>=3&&n.rttObserved.splice(0,n.rttObserved.length-3+1),n.rttObserved.push(h)}},n.heartbeat()}))},this.isWSConnected=function(){return Boolean(n.ws&&n.ws.readyState===f.OPEN)},this.onceWSConnected=function(){return l(n,void 0,void 0,(function(){var e=this;return d(this,(function(t){return this.isWSConnected()?[2]:null!==this.wsInitPromise&&void 0!==this.wsInitPromise?[2,this.wsInitPromise]:[2,new Promise((function(t,n){e.wsReadySubsribers.push({resolve:t,reject:n})}))]}))}))},this.webLogin=function(e,t){return l(n,void 0,void 0,(function(){var n,r,o,a,u,c,f,p,h=this;return d(this,(function(g){switch(g.label){case 0:if(!t)if(e){if(n=this.logins.get(e),n){if(n.loggedIn&&n.loginResult)return[2,n.loginResult];if(null!==n.loggingInPromise&&void 0!==n.loggingInPromise)return[2,n.loggingInPromise]}}else if(r=this.logins.get(""),null!==(null===r||void 0===r?void 0:r.loggingInPromise)&&void 0!==(null===r||void 0===r?void 0:r.loggingInPromise))return[2,r.loggingInPromise];o=new Promise((function(e,t){(function(){l(h,void 0,void 0,(function(){var n,r,o,a,u;return d(this,(function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),[4,this.getWsSign()];case 1:return n=c.sent(),r={envId:n.envId||"",accessToken:"",referrer:"web",sdkVersion:"",dataVersion:""},o={watchId:void 0,requestId:(0,i.genRequestId)(),msgType:"LOGIN",msgData:r,exMsgData:{runtime:(0,s.getRuntime)(),signStr:n.signStr,secretVersion:n.secretVersion}},[4,this.send({msg:o,waitResponse:!0,skipOnMessage:!0,timeout:5e3})];case 2:return a=c.sent(),a.msgData.code?t(new Error("".concat(a.msgData.code," ").concat(a.msgData.message))):e({envId:n.envId}),[3,4];case 3:return u=c.sent(),t(u),[3,4];case 4:return[2]}}))}))})()})),a=e&&this.logins.get(e),u=Date.now(),a?(a.loggedIn=!1,a.loggingInPromise=o,a.loginStartTS=u):(a={loggedIn:!1,loggingInPromise:o,loginStartTS:u},this.logins.set(e||"",a)),g.label=1;case 1:return g.trys.push([1,3,,4]),[4,o];case 2:if(c=g.sent(),f=e&&this.logins.get(e),f&&f===a&&f.loginStartTS===u)return a.loggedIn=!0,a.loggingInPromise=void 0,a.loginStartTS=void 0,a.loginResult=c,[2,c];if(f){if(f.loggedIn&&f.loginResult)return[2,f.loginResult];if(null!==f.loggingInPromise&&void 0!==f.loggingInPromise)return[2,f.loggingInPromise];throw new Error("ws unexpected login info")}throw new Error("ws login info reset");case 3:throw p=g.sent(),a.loggedIn=!1,a.loggingInPromise=void 0,a.loginStartTS=void 0,a.loginResult=void 0,p;case 4:return[2]}}))}))},this.getWsSign=function(){return l(n,void 0,void 0,(function(){var e,t,n,r,i,o,a;return d(this,(function(u){switch(u.label){case 0:return this.wsSign&&this.wsSign.expiredTs>Date.now()?[2,this.wsSign]:(e=Date.now()+6e4,[4,this.context.appConfig.request.send("auth.wsWebSign",{runtime:(0,s.getRuntime)()})]);case 1:if(t=u.sent(),t.code)throw new Error("[tcb-js-sdk] \u83b7\u53d6\u5b9e\u65f6\u6570\u636e\u63a8\u9001\u767b\u5f55\u7968\u636e\u5931\u8d25: ".concat(t.code));if(t.data)return n=t.data,r=n.signStr,i=n.wsUrl,o=n.secretVersion,a=n.envId,[2,{signStr:r,wsUrl:i,secretVersion:o,envId:a,expiredTs:e}];throw new Error("[tcb-js-sdk] \u83b7\u53d6\u5b9e\u65f6\u6570\u636e\u63a8\u9001\u767b\u5f55\u7968\u636e\u5931\u8d25")}}))}))},this.getWaitExpectedTimeoutLength=function(){return n.rttObserved.length?n.rttObserved.reduce((function(e,t){return e+t}))/n.rttObserved.length*1.5:5e3},this.ping=function(){return l(n,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return e={watchId:void 0,requestId:(0,i.genRequestId)(),msgType:"PING",msgData:null},[4,this.send({msg:e})];case 1:return t.sent(),[2]}}))}))},this.onWatchStart=function(e,t){n.queryIdClientMap.set(t,e)},this.onWatchClose=function(e,t){t&&n.queryIdClientMap.delete(t),n.watchIdClientMap.delete(e.watchId),n.virtualWSClient.delete(e),n.virtualWSClient.size||n.close(o.CloseEventCode.NoRealtimeListeners)},this.maxReconnect=t.maxReconnect||5,this.reconnectInterval=t.reconnectInterval||1e4,this.context=t.context}return t.prototype.clearHeartbeat=function(){this.pingTimeoutId&&clearTimeout(this.pingTimeoutId),this.pongTimeoutId&&clearTimeout(this.pongTimeoutId)},t.prototype.close=function(e){this.clearHeartbeat(),this.ws&&(this.ws.close(e,o.CLOSE_EVENT_CODE_INFO[e].name),this.ws=void 0)},t.prototype.watch=function(e){this.ws||void 0!==this.wsInitPromise&&null!==this.wsInitPromise||this.initWebSocketConnection(!1);var t=new r.VirtualWebSocketClient(c(c({},e),{send:this.send,login:this.webLogin,isWSConnected:this.isWSConnected,onceWSConnected:this.onceWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,debug:!0}));return this.virtualWSClient.add(t),this.watchIdClientMap.set(t.watchId,t),t.listener},t.prototype.heartbeat=function(t){var n=this;this.clearHeartbeat(),this.pingTimeoutId=setTimeout((function(){(function(){l(n,void 0,void 0,(function(){var t=this;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.ws&&this.ws.readyState===f.OPEN?(this.lastPingSendTS=Date.now(),[4,this.ping()]):[2];case 1:return n.sent(),this.pingFailed=0,this.pongTimeoutId=setTimeout((function(){e("error","pong timed out"," at node_modules/@cloudbase/realtime/dist/esm/websocket-client.js:718"),t.pongMissed<2?(t.pongMissed+=1,t.heartbeat(!0)):t.initWebSocketConnection(!0)}),this.context.appConfig.realtimePongWaitTimeout),[3,3];case 2:return n.sent(),this.pingFailed<2?(this.pingFailed+=1,this.heartbeat()):this.close(o.CloseEventCode.HeartbeatPingError),[3,3];case 3:return[2]}}))}))})()}),t?0:this.context.appConfig.realtimePingInterval)},t}();t.RealtimeWebSocketClient=p}).call(this,n("f3b9")["default"])},"2fcc":function(e,t,n){"use strict";n.r(t);var r=n("a8cf"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"2fce":function(e,t,n){"use strict";(function(e){var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebRequest=t.genAdapter=void 0;var s=n("59ad"),u=n("37e5"),c=n("5cec"),l=function(t){function n(e){var n=t.call(this)||this,r=e.timeout,i=e.timeoutMsg,o=e.restrictedMethods;return n.timeout=r||0,n.timeoutMsg=i||"\u8bf7\u6c42\u8d85\u65f6",n.restrictedMethods=o||["get","post","upload","download"],n}return r(n,t),n.prototype.get=function(e){return this.request(i(i({},e),{method:"get"}),this.restrictedMethods.includes("get"))},n.prototype.post=function(e){return this.request(i(i({},e),{method:"post"}),this.restrictedMethods.includes("post"))},n.prototype.put=function(e){return this.request(i(i({},e),{method:"put"}))},n.prototype.upload=function(e){var t=e.data,n=e.file,r=e.name,o=e.method,a=e.headers,s=void 0===a?{}:a,u={post:"post",put:"put"}[null===o||void 0===o?void 0:o.toLowerCase()]||"put",c=new FormData;return"post"===u?(Object.keys(t).forEach((function(e){c.append(e,t[e])})),c.append("key",r),c.append("file",n),this.request(i(i({},e),{data:c,method:u}),this.restrictedMethods.includes("upload"))):this.request(i(i({},e),{method:"put",headers:s,body:n}),this.restrictedMethods.includes("upload"))},n.prototype.download=function(e){return o(this,void 0,void 0,(function(){var t,n,r,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.get(i(i({},e),{headers:{},responseType:"blob"}))];case 1:return t=a.sent().data,n=window.URL.createObjectURL(new Blob([t])),r=decodeURIComponent(new URL(e.url).pathname.split("/").pop()||""),o=document.createElement("a"),o.href=n,o.setAttribute("download",r),o.style.display="none",document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o),[3,3];case 2:return a.sent(),[3,3];case 3:return[2,new Promise((function(t){t({statusCode:200,tempFilePath:e.url})}))]}}))}))},n.prototype.fetch=function(t){var n;return o(this,void 0,void 0,(function(){var r,s,u,c,l,d,f,p,h,g,v,m=this;return a(this,(function(y){switch(y.label){case 0:return r=new AbortController,s=t.url,u=t.enableAbort,c=void 0!==u&&u,l=t.stream,d=void 0!==l&&l,f=t.signal,p=t.timeout,h=null!==p&&void 0!==p?p:this.timeout,f&&(f.aborted&&r.abort(),f.addEventListener("abort",(function(){return r.abort()}))),g=null,c&&h&&(g=setTimeout((function(){e("warn",m.timeoutMsg," at node_modules/@cloudbase/utilities/dist/cjs/adapters/platforms/web.js:155"),r.abort(new Error(m.timeoutMsg))}),h)),[4,fetch(s,i(i({},t),{signal:r.signal})).then((function(e){return o(m,void 0,void 0,(function(){var t,n,r;return a(this,(function(i){switch(i.label){case 0:return clearTimeout(g),e.ok?(t=e,[3,3]):[3,1];case 1:return r=(n=Promise).reject,[4,e.json()];case 2:t=r.apply(n,[i.sent()]),i.label=3;case 3:return[2,t]}}))}))})).catch((function(e){return clearTimeout(g),Promise.reject(e)}))];case 1:return v=y.sent(),[2,{data:d?v.body:(null===(n=v.headers.get("content-type"))||void 0===n?void 0:n.includes("application/json"))?v.json():v.text(),statusCode:v.status,header:v.headers}]}}))}))},n.prototype.request=function(t,n){var r=this;void 0===n&&(n=!1);var i=String(t.method).toLowerCase()||"get";return new Promise((function(o){var a,s,l=t.url,d=t.headers,f=void 0===d?{}:d,p=t.data,h=t.responseType,g=t.withCredentials,v=t.body,m=t.onUploadProgress,y=(0,u.formatUrl)((0,c.getProtocol)(),l,"get"===i?p:{}),_=new XMLHttpRequest;_.open(i,y),h&&(_.responseType=h),Object.keys(f).forEach((function(e){_.setRequestHeader(e,f[e])})),m&&_.upload.addEventListener("progress",m),_.onreadystatechange=function(){var e={};if(4===_.readyState){var t=_.getAllResponseHeaders(),n=t.trim().split(/[\r\n]+/),r={};n.forEach((function(e){var t=e.split(": "),n=t.shift().toLowerCase(),i=t.join(": ");r[n]=i})),e.header=r,e.statusCode=_.status;try{e.data="blob"===h?_.response:JSON.parse(_.responseText)}catch(i){e.data="blob"===h?_.response:_.responseText}clearTimeout(a),o(e)}},n&&r.timeout&&(a=setTimeout((function(){e("warn",r.timeoutMsg," at node_modules/@cloudbase/utilities/dist/cjs/adapters/platforms/web.js:237"),_.abort()}),r.timeout)),s=(0,u.isFormData)(p)?p:"application/x-www-form-urlencoded"===f["content-type"]?(0,u.toQueryString)(p):v||(p?JSON.stringify(p):void 0),g&&(_.withCredentials=!0),_.send(s)}))},n}(s.AbstractSDKRequest);t.WebRequest=l,t.genAdapter=function(){var e={type:"default",root:window,reqClass:l,wsClass:WebSocket,localStorage:localStorage};return e}}).call(this,n("f3b9")["default"])},3158:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DSSimpleModel=void 0;var r=n("7a9b"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};function s(e){var t=e.messages,n=e.model,r=e.temperature,o=e.tools,a=e.top_p;return i(i({},e),{messages:t,model:n,tools:o,top_p:a,temperature:r})}var u=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="dashscope/compatible-mode/v1/chat/completions",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,this.req({url:this.url,data:i(i({},s(e)),{stream:!1}),stream:!1,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,i(i({},n),{rawResponse:n})]}}))}))},e.prototype.doStream=function(e,t){return o(this,void 0,void 0,(function(){var n,o,u,c,l;return a(this,(function(a){switch(a.label){case 0:return n=null,[4,this.req({url:this.url,data:i(i({},s(e)),{stream:!0}),stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return o=a.sent(),u=(0,r.toPolyfillReadable)(o),c=(0,r.intoStandardStream)(u),l=c.pipeThrough(new r.TransformStream({transform:function(e,t){var o=e.choices.map((function(e){var t=Object.assign(e.delta,{role:"assistant"});return null==n&&(n=(0,r.isToolCallAssistantMessage)(t)),i(i({},e),n?{finish_reason:"tool_calls",delta:t}:{delta:t})})),a=i(i({},e),{choices:o});t.enqueue(i(i({},a),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(l)]}}))}))},e}();t.DSSimpleModel=u},"31a3":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.processInput=function(t){var n=t.messages,r=t.model,i=t.temperature,a=t.tool_choice,s=t.tools,u=t.top_p;return o(o({},t),{messages:function(){return n.forEach((function(t){"tool_calls"in t&&t.tool_calls.filter((function(e){return"function"!==e.type})).forEach((function(n){return e("warn","`type` in tool_call is not 'function'",n,t," at node_modules/@cloudbase/ai/dist/esm/models/HunYuan/util.js:28")}))})),n}(),model:r,tools:function(){if(s)return s.forEach((function(t){"function"!==t.type&&e("warn","`type` in tool is not 'function'",t," at node_modules/@cloudbase/ai/dist/esm/models/HunYuan/util.js:19")})),s}(),top_p:u,tool_choice:a,temperature:i})},t.titleCaseToSnakeCase=function e(t){return"object"!==(0,i.default)(t)||null==t?t:Array.isArray(t)?t.map((function(t){return e(t)})):Object.entries(t).reduce((function(t,n){var r=n[0],o=n[1],a=function(e){var t=e.replace(/[A-Z]/g,(function(e){return"_".concat(e.toLowerCase())}));return"_"===t.charAt(0)?t.slice(1):t}(r);return t[a]="object"===(0,i.default)(o)?e(o):o,t}),{})};var i=r(n("3b2d")),o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)}}).call(this,n("f3b9")["default"])},"31ec":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=void 0;t.sleep=function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))}},3210:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.Bot=void 0;var r=n("7a9b"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},u=function(){function e(e,t){this.baseUrl=t;var n=arguments[2];this.req="string"===typeof n?function(t){var r=t.headers,o=void 0===r?{}:r,a=s(t,["headers"]);return e(i(i({},a),{headers:i(i({},o),{Authorization:"Bearer ".concat(n)})}))}:e}return e.prototype.list=function(e,t){return this.req({method:"get",url:this.join("bots"),data:e,timeout:null===t||void 0===t?void 0:t.timeout})},e.prototype.create=function(e,t){var n=e.botInfo;return this.req({method:"post",url:this.join("bots"),data:n,timeout:null===t||void 0===t?void 0:t.timeout})},e.prototype.get=function(e,t){var n=e.botId;return this.req({method:"get",url:this.join("bots/".concat(n)),timeout:null===t||void 0===t?void 0:t.timeout})},e.prototype.update=function(e,t){var n=e.botId,r=e.botInfo;return this.req({method:"PATCH",url:this.join("bots/".concat(n)),data:r,timeout:null===t||void 0===t?void 0:t.timeout})},e.prototype.delete=function(e,t){var n=e.botId;return this.req({method:"delete",url:this.join("bots/".concat(n)),timeout:null===t||void 0===t?void 0:t.timeout})},e.prototype.getChatRecords=function(e,t){return this.req({method:"get",url:this.join("bots/".concat(e.botId,"/records")),data:e,timeout:null===t||void 0===t?void 0:t.timeout})},e.prototype.sendFeedback=function(e,t){var n=e.userFeedback;return this.req({method:"post",url:this.join("bots/".concat(n.botId,"/feedback")),data:n,timeout:null===t||void 0===t?void 0:t.timeout})},e.prototype.getFeedback=function(e,t){return this.req({method:"get",url:this.join("bots/".concat(e.botId,"/feedback")),data:e,timeout:null===t||void 0===t?void 0:t.timeout})},e.prototype.uploadFiles=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/files")),data:e,timeout:null===t||void 0===t?void 0:t.timeout})]}))}))},e.prototype.createConversation=function(e,t){var n=e.botId,r=s(e,["botId"]);return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,this.req({method:"post",url:this.join("bots/".concat(n,"/conversation")),data:r,timeout:null===t||void 0===t?void 0:t.timeout})]}))}))},e.prototype.getConversation=function(e,t){var n=e.pageSize,r=void 0===n?10:n,u=e.pageNumber,c=void 0===u?1:u,l=e.botId,d=s(e,["pageSize","pageNumber","botId"]);return o(this,void 0,void 0,(function(){var e,n;return a(this,(function(o){if(c<1)throw new Error("pageNumber must be greater than 0");return e=r*(c-1),n=r,[2,this.req({method:"get",url:this.join("bots/".concat(l,"/conversation")),data:i(i({},d),{offset:e,limit:n}),timeout:null===t||void 0===t?void 0:t.timeout})]}))}))},e.prototype.deleteConversation=function(e,t){var n=e.botId,r=e.conversationId,i=s(e,["botId","conversationId"]);return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,this.req({method:"delete",url:this.join("bots/".concat(n,"/conversation/").concat(r)),data:i,timeout:null===t||void 0===t?void 0:t.timeout})]}))}))},e.prototype.speechToText=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/speech-to-text")),data:e,timeout:null===t||void 0===t?void 0:t.timeout})]}))}))},e.prototype.textToSpeech=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/text-to-speech")),data:e,timeout:null===t||void 0===t?void 0:t.timeout})]}))}))},e.prototype.getTextToSpeechResult=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return[2,this.req({method:"get",url:this.join("bots/".concat(e.botId,"/text-to-speech")),data:e,timeout:null===t||void 0===t?void 0:t.timeout})]}))}))},e.prototype.getRecommendQuestions=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/recommend-questions")),data:e,stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,new c(n)]}}))}))},e.prototype.generateBot=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,this.req({method:"post",url:this.join("generate-bot"),data:e,stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,new c(n)]}}))}))},e.prototype.getPreview=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,this.req({method:"post",url:this.join("preview"),data:e,stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,new c(n)]}}))}))},e.prototype.generateImage=function(e,t){return this.req({method:"post",url:this.join("generate-image"),data:e,timeout:null===t||void 0===t?void 0:t.timeout})},e.prototype.sendMessage=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,this.req({method:"post",url:this.join("bots/".concat(e.botId,"/send-message")),data:e,stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,new c(n)]}}))}))},e.prototype.join=function(e){return"".concat(this.baseUrl,"/").concat(e)},e}();t.Bot=u;var c=function(){function t(e){var t=(0,r.toPolyfillReadable)(e);this._eventSourceStream=t.pipeThrough(new r.TextDecoderStream).pipeThrough((0,r.createEventSourceParserTransformStream)())}return Object.defineProperty(t.prototype,"teeedStream",{get:function(){var e=this._eventSourceStream.tee(),t=e[0],n=e[1];return this._eventSourceStream=n,t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"eventSourceStream",{get:function(){return(0,r.createAsyncIterable)(this.teeedStream)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataStream",{get:function(){return(0,r.createAsyncIterable)(this.eventSourceStream.pipeThrough(new r.TransformStream({transform:function(t,n){try{var r=JSON.parse(t.data);n.enqueue(r)}catch(i){"[DONE]"!==t.data?e("warn","Error when transforming event source data to json",i,t," at node_modules/@cloudbase/ai/dist/esm/bot/index.js:347"):n.terminate()}}})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textStream",{get:function(){return(0,r.createAsyncIterable)(this.dataStream.pipeThrough(new r.TransformStream({transform:function(e,t){var n;t.enqueue(null!==(n=null===e||void 0===e?void 0:e.content)&&void 0!==n?n:"")}})))},enumerable:!1,configurable:!0}),t}()}).call(this,n("f3b9")["default"])},3283:function(e,t,n){var r=n("142b"),i=n("97d2"),o=n("92d6");e.exports=function(e){return r(e,o,i)}},3325:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.UpdateCommand=t.UPDATE_COMMANDS_LITERAL=void 0,t.isKnownUpdateCommand=function(e){return a(e)&&e.operator.toUpperCase()in r},t.isUpdateCommand=a;var r,i=n("a4d5");t.UPDATE_COMMANDS_LITERAL=r,function(e){e["SET"]="set",e["REMOVE"]="remove",e["INC"]="inc",e["MUL"]="mul",e["PUSH"]="push",e["PULL"]="pull",e["PULL_ALL"]="pullAll",e["POP"]="pop",e["SHIFT"]="shift",e["UNSHIFT"]="unshift",e["ADD_TO_SET"]="addToSet",e["BIT"]="bit",e["RENAME"]="rename",e["MAX"]="max",e["MIN"]="min"}(r||(t.UPDATE_COMMANDS_LITERAL=r={}));var o=function(){function e(e,t,n){this._internalType=i.SYMBOL_UPDATE_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=n||i.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){var n=new e(this.operator,this.operands,t);return n},e}();function a(e){return e&&e instanceof o&&e._internalType===i.SYMBOL_UPDATE_COMMAND}t.UpdateCommand=o;var s=o;t.default=s},3352:function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports["default"]=e.exports},3357:function(e,t){e.exports=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;var o=Array(i);while(++r<i)o[r]=e[r+t];return o}},3437:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatUrl=function(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),i="";for(var o in n)""===i?!r&&(t+="?"):i+="&",i+=o+"="+encodeURIComponent(n[o]);if(t+=i,/^http(s)?\:\/\//.test(t))return t;return""+e+t}},3461:function(e,t){var n=Array.isArray;e.exports=n},3490:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.useDefaultAdapter=t.useAdapters=t.RUNTIME=void 0;var s,u=a(n("2fce")),c=n("37e5");(function(e){e["WEB"]="web",e["WX_MP"]="wx_mp"})(s=t.RUNTIME||(t.RUNTIME={})),t.useAdapters=function(e,t){for(var n=(0,c.isArray)(e)?e:[e],i=0,o=n;i<o.length;i++){var a=o[i],s=a.isMatch,u=a.genAdapter,l=a.runtime;if(s())return{adapter:r({isMatch:s},u(t)),runtime:l}}},t.useDefaultAdapter=function(){return{adapter:u.genAdapter(),runtime:s.WEB}}},"349f":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("127e")),o=r(n("ee10")),a=n("4073"),s=a.imageManager,u=n("139b"),c=u.formatRelativeTime,l=n("11ca"),d=l.cloudCall,f={data:function(){return{splashPreview:"",uploading:!1,imageHistory:[],isAdmin:!1,currentUserOpenid:""}},onLoad:function(){this.checkAdminPermission()},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(e,t,Object.assign({pageTag:"image-manager",context:this,requireAuth:!0},n))},checkAdminPermission:function(){var t=this;return(0,o.default)(i.default.mark((function n(){var r,o,a,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.callCloudFunction("getOpenId",{});case 3:if(r=n.sent,!r.result||!r.result.openid){n.next=17;break}if(o=r.result.openid,a=["ojYBd1_A3uCbQ1LGcHxWxOAeA5SE","ojYBd14JG3-ghYuGCI2WHmkMc9nE"],s=a.includes(o),e("log","\u56fe\u7247\u7ba1\u7406\u9875\u9762 - \u5f53\u524d\u7528\u6237:",o," at pages/image-manager/image-manager.vue:95"),e("log","\u56fe\u7247\u7ba1\u7406\u9875\u9762 - \u662f\u5426\u4e3a\u7ba1\u7406\u5458:",s," at pages/image-manager/image-manager.vue:96"),t.setData({currentUserOpenid:o,isAdmin:s}),s){n.next=14;break}return uni.showModal({title:"\u6743\u9650\u4e0d\u8db3",content:"\u60a8\u6ca1\u6709\u6743\u9650\u8bbf\u95ee\u56fe\u7247\u7ba1\u7406\u529f\u80fd",showCancel:!1,success:function(){uni.navigateBack()}}),n.abrupt("return");case 14:t.loadImageHistory(),n.next=18;break;case 17:throw new Error("\u65e0\u6cd5\u83b7\u53d6\u7528\u6237\u4fe1\u606f");case 18:n.next=24;break;case 20:n.prev=20,n.t0=n["catch"](0),e("error","\u6743\u9650\u68c0\u67e5\u5931\u8d25:",n.t0," at pages/image-manager/image-manager.vue:121"),uni.showModal({title:"\u9519\u8bef",content:"\u6743\u9650\u68c0\u67e5\u5931\u8d25\uff0c\u65e0\u6cd5\u8bbf\u95ee\u6b64\u9875\u9762",showCancel:!1,success:function(){uni.navigateBack()}});case 24:case"end":return n.stop()}}),n,null,[[0,20]])})))()},loadImageHistory:function(){var t=this;return(0,o.default)(i.default.mark((function n(){var r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s.getImageList({limit:10});case 3:r=n.sent,r.success&&t.setData({imageHistory:r.images}),n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](0),e("error","\u52a0\u8f7d\u56fe\u7247\u5386\u53f2\u5931\u8d25:",n.t0," at pages/image-manager/image-manager.vue:145");case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()},chooseSplashImage:function(){var e=this;uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){var n=t.tempFilePaths[0];e.setData({splashPreview:n})},fail:function(e){uni.showToast({title:"\u9009\u62e9\u56fe\u7247\u5931\u8d25",icon:"none"})}})},uploadSplashImage:function(){var t=this;return(0,o.default)(i.default.mark((function n(){var r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.splashPreview){n.next=3;break}return uni.showToast({title:"\u8bf7\u5148\u9009\u62e9\u56fe\u7247",icon:"none"}),n.abrupt("return");case 3:return t.setData({uploading:!0}),n.prev=4,n.next=7,s.uploadSplashImage(t.splashPreview);case 7:if(r=n.sent,!r.success){n.next=15;break}uni.showToast({title:"\u4e0a\u4f20\u6210\u529f",icon:"success",duration:2e3}),uni.setClipboardData({data:r.url,success:function(){uni.showToast({title:"URL\u5df2\u590d\u5236",icon:"none"})}}),t.setData({splashPreview:""}),t.loadImageHistory(),n.next=16;break;case 15:throw new Error(r.error);case 16:n.next=22;break;case 18:n.prev=18,n.t0=n["catch"](4),e("error","\u4e0a\u4f20\u5931\u8d25:",n.t0," at pages/image-manager/image-manager.vue:214"),uni.showToast({title:"\u4e0a\u4f20\u5931\u8d25: "+n.t0.message,icon:"none",duration:3e3});case 22:return n.prev=22,t.setData({uploading:!1}),n.finish(22);case 25:case"end":return n.stop()}}),n,null,[[4,18,22,25]])})))()},clearSplashPreview:function(){this.setData({splashPreview:""})},copyUrl:function(e){var t=e.currentTarget.dataset.url;uni.setClipboardData({data:t,success:function(){uni.showToast({title:"URL\u5df2\u590d\u5236",icon:"none"})}})},formatTime:function(e){return c(e)}}};t.default=f}).call(this,n("f3b9")["default"])},"34cf":function(e,t,n){var r=n("ed45"),i=n("7172"),o=n("6382"),a=n("dd3e");e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()},e.exports.__esModule=!0,e.exports["default"]=e.exports},3517:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[e._$s(1,"i","typing"===e.currentPhase)?n("view",{staticClass:e._$s(1,"sc","typing-phase-container"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","text-layer"),attrs:{_i:2}},[n("view",{staticClass:e._$s(3,"sc","typewriter-effect"),attrs:{_i:3}},[n("text",[e._v(e._$s(4,"t0-0",e._s(e.typedText)))]),n("view",{class:e._$s(5,"c","blinking-cursor "+(e.showNewLineCursor?"hidden":"")),attrs:{_i:5}})]),e._$s(6,"i",e.showNewLineCursor)?n("view",{staticClass:e._$s(6,"sc","new-line-cursor-container"),attrs:{_i:6}},[n("view",{staticClass:e._$s(7,"sc","new-line-cursor"),attrs:{_i:7}})]):e._e()]),e._$s(8,"i",e.showEnterButton)?n("button",{class:e._$s(8,"c","enter-btn "+(e.preloadCompleted?"":"loading")),attrs:{_i:8},on:{click:e.handleEnterButtonClick}},[n("view",{staticClass:e._$s(9,"sc","enter-key-icon"),attrs:{_i:9}}),n("text",{staticClass:e._$s(10,"sc","enter-text"),attrs:{_i:10}},[e._v(e._$s(10,"t0-0",e._s(e.preloadCompleted?"enter":"loading...")))])]):e._e()]):e._e(),e._$s(11,"i",e.isPreloading)?n("view",{staticClass:e._$s(11,"sc","loading-indicator"),attrs:{_i:11}}):e._e()])},i=[]},3644:function(e,t,n){var r=n("4d0d"),i=r.Symbol;e.exports=i},3649:function(e,t,n){var r=n("b6fd"),i=n("97d2");e.exports=function(e,t){return r(e,i(e),t)}},"36a6":function(e,t){e.exports=function(e){var t=this.__data__,n=t["delete"](e);return this.size=t.size,n}},"37e5":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.parseQueryString=t.transformPhone=t.sleep=t.printGroupLog=t.throwError=t.printInfo=t.printError=t.printWarn=t.execCallback=t.createPromiseCallback=t.removeParam=t.getHash=t.getQuery=t.toQueryString=t.formatUrl=t.generateRequestId=t.genSeqId=t.isFormData=t.isInstanceOf=t.isNull=t.isPalinObject=t.isUndefined=t.isString=t.isArray=void 0;var r=n("9e9d");t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isString=function(e){return"string"===typeof e},t.isUndefined=function(e){return"undefined"===typeof e},t.isPalinObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},t.isNull=function(e){return"[object Null]"===Object.prototype.toString.call(e)},t.isInstanceOf=function(e,t){return e instanceof t},t.isFormData=function(e){return"[object FormData]"===Object.prototype.toString.call(e)},t.genSeqId=function(){return Math.random().toString(16).slice(2)},t.generateRequestId=function(){var e=(new Date).getTime(),t=(null===Date||void 0===Date?void 0:Date.now)&&1e3*Date.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var r=16*Math.random();return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),("x"===n?r:7&r|8).toString(16)}))},t.formatUrl=function(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),i="";return Object.keys(n).forEach((function(e){""===i?!r&&(t+="?"):i+="&",i+="".concat(e,"=").concat(encodeURIComponent(n[e]))})),t+=i,/^http(s)?:\/\//.test(t)?t:"".concat(e).concat(t)},t.toQueryString=function(e){void 0===e&&(e={});var t=[];return Object.keys(e).forEach((function(n){t.push("".concat(n,"=").concat(encodeURIComponent(e[n])))})),t.join("&")},t.getQuery=function(e,t){if("undefined"===typeof window)return!1;var n=t||window.location.search,r=new RegExp("(^|&)".concat(e,"=([^&]*)(&|$)")),i=n.substr(n.indexOf("?")+1).match(r);return null!==i&&void 0!==i?i[2]:""};t.getHash=function(e){if("undefined"===typeof window)return"";var t=window.location.hash.match(new RegExp("[#?&/]".concat(e,"=([^&#]*)")));return t?t[1]:""},t.removeParam=function(e,t){var n,r=t.split("?")[0],i=[],o=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==o){i=o.split("&");for(var a=i.length-1;a>=0;a-=1)n=i[a].split("=")[0],n===e&&i.splice(a,1);r="".concat(r,"?").concat(i.join("&"))}return r},t.createPromiseCallback=function(){var e;if(!Promise){e=function(){},e.promise={};var t=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var n=new Promise((function(t,n){e=function(e,r){return e?n(e):t(r)}}));return e.promise=n,e},t.execCallback=function(e,t,n){if(void 0===n&&(n=null),e&&"function"===typeof e)return e(t,n);if(t)throw t;return n},t.printWarn=function(t,n){e("warn","[".concat((0,r.getSdkName)(),"][").concat(t,"]:").concat(n)," at node_modules/@cloudbase/utilities/dist/cjs/libs/util.js:156")},t.printError=function(t,n){e("error",{code:t,msg:"[".concat((0,r.getSdkName)(),"][").concat(t,"]:").concat(n)}," at node_modules/@cloudbase/utilities/dist/cjs/libs/util.js:160")},t.printInfo=function(t,n){e("log","[".concat((0,r.getSdkName)(),"][").concat(t,"]:").concat(n)," at node_modules/@cloudbase/utilities/dist/cjs/libs/util.js:167")},t.throwError=function(e,t){throw new Error(JSON.stringify({code:e,msg:"[".concat((0,r.getSdkName)(),"][").concat(e,"]:").concat(t)}))},t.printGroupLog=function(t){var n,r=t.title,i=t.subtitle,o=void 0===i?"":i,a=t.content,s=void 0===a?[]:a,u=t.printTrace,c=void 0!==u&&u,l=t.collapsed,d=void 0!==l&&l;d?(console.groupCollapsed||console.error)(r,o):(console.group||console.error)(r,o);for(var f=0,p=s;f<p.length;f++){var h=p[f],g=h.type,v=h.body;switch(g){case"info":e("log",v," at node_modules/@cloudbase/utilities/dist/cjs/libs/util.js:191");break;case"warn":e("warn",v," at node_modules/@cloudbase/utilities/dist/cjs/libs/util.js:194");break;case"error":e("error",v," at node_modules/@cloudbase/utilities/dist/cjs/libs/util.js:197");break}}c&&(console.trace||console.log)("stack trace:"),null===(n=console.groupEnd)||void 0===n||n.call(console)};t.sleep=function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))},t.transformPhone=function(e){return"+86".concat(e)};t.parseQueryString=function(e){e=e.replace(/^\?/,"");var t={},n=e.split("&");return n.forEach((function(e){var n=e.split("="),r=n[0],i=n[1];r=decodeURIComponent(r),i=decodeURIComponent(i),r&&(t[r]?Array.isArray(t[r])?t[r].push(i):t[r]=[t[r],i]:t[r]=i)})),t}}).call(this,n("f3b9")["default"])},"382e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Point=void 0;var r=n("be93"),i=n("a4d5"),o=n("8539"),a=function(){function e(e,t){r.Validate.isGeopoint("longitude",e),r.Validate.isGeopoint("latitude",t),this.longitude=e,this.latitude=t}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"Point",coordinates:[this.longitude,this.latitude]},t},e.prototype.toJSON=function(){return{type:"Point",coordinates:[this.longitude,this.latitude]}},e.prototype.toReadableString=function(){return"["+this.longitude+","+this.latitude+"]"},e.validate=function(e){return"Point"===e.type&&(0,o.isArray)(e.coordinates)&&r.Validate.isGeopoint("longitude",e.coordinates[0])&&r.Validate.isGeopoint("latitude",e.coordinates[1])},Object.defineProperty(e.prototype,"_internalType",{get:function(){return i.SYMBOL_GEO_POINT},enumerable:!0,configurable:!0}),e}();t.Point=a},"38fc":function(e,t,n){if("undefined"===typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))}))}),"undefined"!==typeof uni&&uni&&uni.requireGlobal){var r=uni.requireGlobal();ArrayBuffer=r.ArrayBuffer,Int8Array=r.Int8Array,Uint8Array=r.Uint8Array,Uint8ClampedArray=r.Uint8ClampedArray,Int16Array=r.Int16Array,Uint16Array=r.Uint16Array,Int32Array=r.Int32Array,Uint32Array=r.Uint32Array,Float32Array=r.Float32Array,Float64Array=r.Float64Array,BigInt64Array=r.BigInt64Array,BigUint64Array=r.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),__definePage("pages/splash/splash",(function(){return Vue.extend(n("0d14").default)})),__definePage("pages/login/login",(function(){return Vue.extend(n("d817").default)})),__definePage("pages/register/register",(function(){return Vue.extend(n("b83f").default)})),__definePage("pages/my-likes/my-likes",(function(){return Vue.extend(n("9c6c").default)})),__definePage("pages/index/index",(function(){return Vue.extend(n("aca4").default)})),__definePage("pages/poem/poem",(function(){return Vue.extend(n("1a5f").default)})),__definePage("pages/mountain/mountain",(function(){return Vue.extend(n("5dd6").default)})),__definePage("pages/profile/profile",(function(){return Vue.extend(n("ac20").default)})),__definePage("pages/following/following",(function(){return Vue.extend(n("7f32").default)})),__definePage("pages/fans/fans",(function(){return Vue.extend(n("6cda").default)})),__definePage("pages/user-profile/user-profile",(function(){return Vue.extend(n("6fc4").default)})),__definePage("pages/profile-edit/profile-edit",(function(){return Vue.extend(n("b02b").default)})),__definePage("pages/post-detail/post-detail",(function(){return Vue.extend(n("709d").default)})),__definePage("pages/add/add",(function(){return Vue.extend(n("ee49").default)})),__definePage("pages/favorite-folders/favorite-folders",(function(){return Vue.extend(n("153e").default)})),__definePage("pages/favorite-content/favorite-content",(function(){return Vue.extend(n("a88a").default)})),__definePage("pages/messages/messages",(function(){return Vue.extend(n("9a58").default)})),__definePage("pages/image-manager/image-manager",(function(){return Vue.extend(n("1b59").default)})),__definePage("pages/tag-filter/tag-filter",(function(){return Vue.extend(n("c7d2").default)})),__definePage("pages/search/search",(function(){return Vue.extend(n("09ea").default)})),__definePage("pages/draft-box/draft-box",(function(){return Vue.extend(n("6b73").default)})),__definePage("pages/feedback/feedback",(function(){return Vue.extend(n("4008").default)})),__definePage("pages/feedback-admin/feedback-admin",(function(){return Vue.extend(n("70f0").default)}))},"39e5":function(e,t,n){"use strict";n.r(t);var r=n("f1fb"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"3b09":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={skeleton:n("8cb3").default},i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[n("view",{staticClass:e._$s(1,"sc","container"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","background-wrapper"),attrs:{_i:2}},e._l(e._$s(3,"f",{forItems:e.bgLayers}),(function(t,r,i,o){return n("image",{key:e._$s(3,"f",{forIndex:i,key:r}),class:e._$s("3-"+o,"c","bg-image "+(t.visible?"visible":"")),attrs:{src:e._$s("3-"+o,"a-src",t.url),"data-layer-index":e._$s("3-"+o,"a-data-layer-index",r),_i:"3-"+o},on:{load:e.onBackgroundImageLoad}})})),0),n("view",{staticClass:e._$s(4,"sc","blur-background-wrapper"),attrs:{_i:4}},e._l(e._$s(5,"f",{forItems:e.bgLayers}),(function(t,r,i,o){return n("image",{key:e._$s(5,"f",{forIndex:i,key:r}),class:e._$s("5-"+o,"c","bg-image blur-image "+(t.visible?"visible":"")),attrs:{src:e._$s("5-"+o,"a-src",t.url),"data-layer-index":e._$s("5-"+o,"a-data-layer-index",r),_i:"5-"+o},on:{load:e.onBackgroundImageLoad}})})),0),e._$s(6,"i",e.isLoading)?n("view",{attrs:{_i:6}},[n("skeleton",{attrs:{_i:7}})],1):n("view",{attrs:{_i:8}},[e._$s(9,"i",e.postList.length>0)?n("view",{staticClass:e._$s(9,"sc","poem-mode-container"),attrs:{_i:9},on:{touchstart:e.touchStart,touchend:e.touchEnd}},[n("view",{class:e._$s(10,"c","single-post-content "+(e.isTransitioning?"is-transitioning":"")),attrs:{"data-postid":e._$s(10,"a-data-postid",e.currentPost._id),_i:10},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onSinglePostTap(t)}}},[n("view",{staticClass:e._$s(11,"sc","single-author-info"),attrs:{_i:11}},[e._$s(12,"i",e.currentPost.authorAvatar)?n("image",{staticClass:e._$s(12,"sc","single-author-avatar"),attrs:{src:e._$s(12,"a-src",e.currentPost.authorAvatar),_i:12}}):e._e(),n("text",{staticClass:e._$s(13,"sc","single-author-name"),attrs:{_i:13}},[e._v(e._$s(13,"t0-0",e._s(e.currentPost.authorName)))])]),e._$s(14,"i",e.currentPost.title)?n("view",{staticClass:e._$s(14,"sc","single-post-title"),attrs:{_i:14}},[e._v(e._$s(14,"t0-0",e._s(e.currentPost.title)))]):e._e(),e._$s(15,"i",e.currentPost.isPoem&&e.currentPost.author)?n("view",{staticClass:e._$s(15,"sc","single-poem-author"),attrs:{_i:15}},[e._v(e._$s(15,"t0-0",e._s(e.currentPost.author)))]):e._e(),e._$s(16,"i",e.currentPost.content)?n("view",{staticClass:e._$s(16,"sc","single-post-content-text"),attrs:{_i:16}},[e._v(e._$s(16,"t0-0",e._s(e.currentPost.content)))]):e._e()]),e._$s(17,"i",0===e.postList.length&&!e.isLoading)?n("view",{staticClass:e._$s(17,"sc","empty-state"),attrs:{_i:17}},[n("view",{staticClass:e._$s(18,"sc","empty-icon"),attrs:{_i:18}}),n("view",{staticClass:e._$s(19,"sc","empty-text"),attrs:{_i:19}}),n("view",{staticClass:e._$s(20,"sc","empty-subtext"),attrs:{_i:20}})]):e._e()]):e._e(),e._e()])])])},o=[]},"3b2d":function(e,t){function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports["default"]=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"3b92":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SIZE=t.QueryCommand=t.QUERY_COMMANDS_LITERAL=t.NIN=t.NEQ=t.MOD=t.LTE=t.LT=t.IN=t.GTE=t.GT=t.EXISTS=t.EQ=t.ELEM_MATCH=t.ALL=void 0,t.isComparisonCommand=function(e){return f(e)},t.isKnownQueryCommand=function(e){return f(e)&&e.operator.toUpperCase()in l},t.isQueryCommand=f;var i=r(n("3b2d")),o=n("c9ca"),a=n("a4d5"),s=n("e775"),u=n("8539"),c=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();t.EQ="eq";t.NEQ="neq";t.GT="gt";t.GTE="gte";t.LT="lt";t.LTE="lte";t.IN="in";t.NIN="nin";t.ALL="all";t.ELEM_MATCH="elemMatch";t.EXISTS="exists";t.SIZE="size";var l;t.MOD="mod",t.QUERY_COMMANDS_LITERAL=l,function(e){e["EQ"]="eq",e["NEQ"]="neq",e["GT"]="gt",e["GTE"]="gte",e["LT"]="lt",e["LTE"]="lte",e["IN"]="in",e["NIN"]="nin",e["ALL"]="all",e["ELEM_MATCH"]="elemMatch",e["EXISTS"]="exists",e["SIZE"]="size",e["MOD"]="mod",e["GEO_NEAR"]="geoNear",e["GEO_WITHIN"]="geoWithin",e["GEO_INTERSECTS"]="geoIntersects"}(l||(t.QUERY_COMMANDS_LITERAL=l={}));var d=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.operator=t,i._internalType=a.SYMBOL_QUERY_COMMAND,i}return c(t,e),t.prototype.toJSON=function(){var e,t;switch(this.operator){case l.IN:case l.NIN:return e={},e["$"+this.operator]=this.operands,e;default:return t={},t["$"+this.operator]=this.operands[0],t}},t.prototype._setFieldName=function(e){var n=new t(this.operator,this.operands,e);return n},t.prototype.eq=function(e){var n=new t(l.EQ,[e],this.fieldName);return this.and(n)},t.prototype.neq=function(e){var n=new t(l.NEQ,[e],this.fieldName);return this.and(n)},t.prototype.gt=function(e){var n=new t(l.GT,[e],this.fieldName);return this.and(n)},t.prototype.gte=function(e){var n=new t(l.GTE,[e],this.fieldName);return this.and(n)},t.prototype.lt=function(e){var n=new t(l.LT,[e],this.fieldName);return this.and(n)},t.prototype.lte=function(e){var n=new t(l.LTE,[e],this.fieldName);return this.and(n)},t.prototype.in=function(e){var n=new t(l.IN,e,this.fieldName);return this.and(n)},t.prototype.nin=function(e){var n=new t(l.NIN,e,this.fieldName);return this.and(n)},t.prototype.geoNear=function(e){if(!(e.geometry instanceof s.Point))throw new TypeError('"geometry" must be of type Point. Received type '+(0,i.default)(e.geometry));if(void 0!==e.maxDistance&&!(0,u.isNumber)(e.maxDistance))throw new TypeError('"maxDistance" must be of type Number. Received type '+(0,i.default)(e.maxDistance));if(void 0!==e.minDistance&&!(0,u.isNumber)(e.minDistance))throw new TypeError('"minDistance" must be of type Number. Received type '+(0,i.default)(e.minDistance));var n=new t(l.GEO_NEAR,[e],this.fieldName);return this.and(n)},t.prototype.geoWithin=function(e){if(!(e.geometry instanceof s.MultiPolygon)&&!(e.geometry instanceof s.Polygon))throw new TypeError('"geometry" must be of type Polygon or MultiPolygon. Received type '+(0,i.default)(e.geometry));var n=new t(l.GEO_WITHIN,[e],this.fieldName);return this.and(n)},t.prototype.geoIntersects=function(e){if(!(e.geometry instanceof s.Point)&&!(e.geometry instanceof s.LineString)&&!(e.geometry instanceof s.Polygon)&&!(e.geometry instanceof s.MultiPoint)&&!(e.geometry instanceof s.MultiLineString)&&!(e.geometry instanceof s.MultiPolygon))throw new TypeError('"geometry" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type '+(0,i.default)(e.geometry));var n=new t(l.GEO_INTERSECTS,[e],this.fieldName);return this.and(n)},t}(o.LogicCommand);function f(e){return e&&e instanceof d&&e._internalType===a.SYMBOL_QUERY_COMMAND}t.QueryCommand=d;var p=d;t.default=p},"3c4e":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LANGS",{enumerable:!0,get:function(){return f.LANGS}}),t.default=t.cloudbase=void 0,Object.defineProperty(t,"getBaseEndPoint",{enumerable:!0,get:function(){return d.getBaseEndPoint}});var i=r(n("3b2d")),o=n("5c02"),a=r(n("9eea")),s=n("d5cb"),u=n("b168"),c=n("761f"),l=n("893d"),d=n("e61a"),f=n("1ce3"),p=n("a4b5"),h=function(){return h=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},h.apply(this,arguments)},g=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":(0,i.default)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},v=function(e,t){if("object"===("undefined"===typeof Reflect?"undefined":(0,i.default)(Reflect))&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},y=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},_=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},b=o.adapters.useAdapters,w=o.adapters.useDefaultAdapter,S=o.constants.ERRORS,I=o.constants.COMMUNITY_SITE_URL,C=o.utils.printWarn,T=o.helpers.catchErrorsDecorator,O={timeout:15e3,persistence:"local"},E={},x=function(){function t(e){this.cloudbaseConfig=e||this.cloudbaseConfig,this.authInstance=null,this.oauthInstance=null,this.version=(0,d.getSdkVersion)()}return Object.defineProperty(t.prototype,"config",{get:function(){return this.cloudbaseConfig},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"platform",{get:function(){return u.Platform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cache",{get:function(){return(0,c.getCacheByEnvId)(this.cloudbaseConfig.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCache",{get:function(){return(0,c.getLocalCache)(this.cloudbaseConfig.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"request",{get:function(){return(0,l.getRequestByEnvId)(this.cloudbaseConfig.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apis",{get:function(){return p.generateApis.call(this)},enumerable:!1,configurable:!0}),t.prototype.init=function(e){var n;if(!e.env)throw new Error(JSON.stringify({code:S.INVALID_PARAMS,msg:"env must not be specified"}));u.Platform.adapter||this.useDefaultAdapter();var r={timeout:e.timeout||5e3,timeoutMsg:"[".concat((0,d.getSdkName)(),"][REQUEST TIMEOUT] request had been abort since didn't finished within").concat(e.timeout/1e3,"s")};this.requestClient=new u.Platform.adapter.reqClass(r),this.cloudbaseConfig=h(h(h({},O),e),{i18n:(0,f.i18nProxy)(u.Platform,e)}),delete this.cloudbaseConfig.lang,this.cloudbaseConfig.timeout=this.formatTimeout(this.cloudbaseConfig.timeout);var i=this.cloudbaseConfig,o=i.env,a=i.persistence,s=i.debug,p=i.timeout,g=i.oauthClient,v=i.i18n;(0,c.initCache)({env:o,persistence:a,debug:s,platformInfo:this.platform}),(0,d.setRegionLevelEndpoint)(o,e.region||""),(0,d.setGatewayEndPointWithEnv)(o,d.DEFAULT_PROTOCOL,e.region||"");var m=new t(this.cloudbaseConfig);return(0,l.initRequest)({env:o,region:e.region||"",timeout:p,oauthClient:g,_fromApp:m,i18n:v,endPointMode:e.endPointMode}),m.requestClient=this.requestClient,null===(n=null===this||void 0===this?void 0:this.fire)||void 0===n||n.call(this,"cloudbase_init",m),this.try2InitAuth(e,m),m},t.prototype.updateConfig=function(e){var t=e.persistence,n=e.debug;this.cloudbaseConfig.persistence=t,this.cloudbaseConfig.debug=n,(0,c.initCache)({env:this.cloudbaseConfig.env,persistence:t,debug:n,platformInfo:this.platform})},t.prototype.updateLang=function(e){var t;e&&e!==(null===(t=this.cloudbaseConfig.i18n)||void 0===t?void 0:t.lang)&&(this.cloudbaseConfig.i18n.lang=e)},t.prototype.registerExtension=function(e){E[e.name]=e},t.prototype.invokeExtension=function(e,t){return m(this,void 0,void 0,(function(){var n;return y(this,(function(r){switch(r.label){case 0:if(n=E[e],!n)throw new Error(JSON.stringify({code:S.INVALID_PARAMS,msg:"extension:".concat(e," must be registered before invoke")}));return[4,n.invoke(t,this)];case 1:return[2,r.sent()]}}))}))},t.prototype.useAdapters=function(e,t){var n=b(e,t)||{},r=n.adapter,i=n.runtime;r&&(u.Platform.adapter=r),i&&(u.Platform.runtime=i)},t.prototype.registerHook=function(e){(0,s.registerHook)(t,e)},t.prototype.registerComponent=function(e){(0,s.registerComponent)(t,e)},t.prototype.registerVersion=function(e){(0,d.setSdkVersion)(e),this.version=e},t.prototype.registerSdkName=function(e){(0,d.setSdkName)(e)},t.prototype.registerEndPoint=function(e,t){(0,d.setEndPointInfo)({baseUrl:e,protocol:t,env:this.config.env,endPointKey:"CLOUD_API"})},t.prototype.registerEndPointWithKey=function(e){(0,d.setEndPointInfo)({env:this.config.env,endPointKey:e.key,baseUrl:e.url,protocol:e.protocol})},t.prototype.getEndPointWithKey=function(e){var t=(0,d.getEndPointInfo)(this.config.env,e);return{BASE_URL:t.baseUrl,PROTOCOL:t.protocol}},t.prototype.parseCaptcha=function(e){var t={},n=e.match(/^(data:.*?)(\?[^#\s]*)?$/);if(n){e=n[1];var r=n[2];r&&(t=o.utils.parseQueryString(r))}var i=t.token,a=_(t,["token"]);return/^data:/.test(e)&&!i?{error:"invalid_argument",error_description:"invalid captcha data: ".concat(e)}:i?{state:a.state,token:i,captchaData:e}:{error:"unimplemented",error_description:"need to impl captcha data"}},t.prototype.useDefaultAdapter=function(){var e=w(),t=e.adapter,n=e.runtime;u.Platform.adapter=t,u.Platform.runtime=n},t.prototype.formatTimeout=function(e){switch(!0){case e>6e5:return C(S.INVALID_PARAMS,"timeout is greater than maximum value[10min]"),6e5;case e<100:return C(S.INVALID_PARAMS,"timeout is less than maximum value[100ms]"),100;default:return e}},t.prototype.try2InitAuth=function(t,n){try{t.accessKey&&n.auth()}catch(r){e("log","try2InitAuth error:",r," at node_modules/@cloudbase/app/dist/esm/index.js:300")}},g([T({mode:"sync",title:"Cloudbase \u521d\u59cb\u5316\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 cloudbase.init() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5982\u679c\u662f\u975e\u6d4f\u89c8\u5668\u73af\u5883\uff0c\u662f\u5426\u914d\u7f6e\u4e86\u5b89\u5168\u5e94\u7528\u6765\u6e90\uff08https://docs.cloudbase.net/api-reference/webv3/adapter#%E7%AC%AC-2-%E6%AD%A5%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8%E5%BA%94%E7%94%A8%E6%9D%A5%E6%BA%90\uff09","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(I)]}),v("design:type",Function),v("design:paramtypes",[Object]),v("design:returntype",t)],t.prototype,"init",null),g([T({title:"\u8c03\u7528\u6269\u5c55\u80fd\u529b\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 invokeExtension() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u88ab\u8c03\u7528\u7684\u6269\u5c55\u80fd\u529b\u662f\u5426\u5df2\u7ecf\u5b89\u88c5\u5e76\u901a\u8fc7 registerExtension() \u6ce8\u518c","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(I)]}),v("design:type",Function),v("design:paramtypes",[String,Object]),v("design:returntype",Promise)],t.prototype,"invokeExtension",null),t}(),P=new x;t.cloudbase=P,P.useAdapters(a.default);var k=P;t.default=k}).call(this,n("f3b9")["default"])},"3ccb":function(e,t,n){"use strict";n.r(t);var r=n("bf7c"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"3ce6":function(e,t,n){var r=n("2024"),i=n("4d0d"),o=r(i,"Map");e.exports=o},"3e19":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Util=void 0;var r=n("ae75"),i=n("e775"),o=n("d137"),a=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{while((void 0===t||t-- >0)&&!(r=o.next()).done)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a},s=function(){function e(){}return e.formatResDocumentData=function(t){return t.map((function(t){return e.formatField(t)}))},e.formatField=function(t){var n=Object.keys(t),o={};return Array.isArray(t)&&(o=[]),n.forEach((function(n){var s,u=t[n],c=e.whichType(u);switch(c){case r.FieldType.GeoPoint:s=new i.Point(u.coordinates[0],u.coordinates[1]);break;case r.FieldType.GeoLineString:s=new i.LineString(u.coordinates.map((function(e){return new i.Point(e[0],e[1])})));break;case r.FieldType.GeoPolygon:s=new i.Polygon(u.coordinates.map((function(e){return new i.LineString(e.map((function(e){var t=a(e,2),n=t[0],r=t[1];return new i.Point(n,r)})))})));break;case r.FieldType.GeoMultiPoint:s=new i.MultiPoint(u.coordinates.map((function(e){return new i.Point(e[0],e[1])})));break;case r.FieldType.GeoMultiLineString:s=new i.MultiLineString(u.coordinates.map((function(e){return new i.LineString(e.map((function(e){var t=a(e,2),n=t[0],r=t[1];return new i.Point(n,r)})))})));break;case r.FieldType.GeoMultiPolygon:s=new i.MultiPolygon(u.coordinates.map((function(e){return new i.Polygon(e.map((function(e){return new i.LineString(e.map((function(e){var t=a(e,2),n=t[0],r=t[1];return new i.Point(n,r)})))})))})));break;case r.FieldType.Timestamp:s=new Date(1e3*u.$timestamp);break;case r.FieldType.Object:case r.FieldType.Array:s=e.formatField(u);break;case r.FieldType.ServerDate:s=new Date(u.$date);break;default:s=u}Array.isArray(o)?o.push(s):o[n]=s})),o},e.whichType=function(e){var t=Object.prototype.toString.call(e).slice(8,-1);if(t===r.FieldType.Timestamp)return r.FieldType.BsonDate;if(t===r.FieldType.Object){if(e instanceof i.Point)return r.FieldType.GeoPoint;if(e instanceof Date)return r.FieldType.Timestamp;if(e instanceof o.ServerDate)return r.FieldType.ServerDate;e.$timestamp?t=r.FieldType.Timestamp:e.$date?t=r.FieldType.ServerDate:i.Point.validate(e)?t=r.FieldType.GeoPoint:i.LineString.validate(e)?t=r.FieldType.GeoLineString:i.Polygon.validate(e)?t=r.FieldType.GeoPolygon:i.MultiPoint.validate(e)?t=r.FieldType.GeoMultiPoint:i.MultiLineString.validate(e)?t=r.FieldType.GeoMultiLineString:i.MultiPolygon.validate(e)&&(t=r.FieldType.GeoMultiPolygon)}return t},e.generateDocId=function(){for(var e="ABCDEFabcdef0123456789",t="",n=0;n<24;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},e}();t.Util=s},"3ea6":function(e,t){e.exports=function(e,t){var n=-1,r=null==e?0:e.length;while(++n<r)if(!1===t(e[n],n,e))break;return e}},"3f29":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[e._$s(1,"i",e.isLoading&&0===e.fans.length)?n("view",{staticClass:e._$s(1,"sc","loading"),attrs:{_i:1}},[n("text")]):e._$s(3,"e",e.fans.length>0)?[n("view",{staticClass:e._$s(4,"sc","list"),attrs:{_i:4}},e._l(e._$s(5,"f",{forItems:e.fans}),(function(t,r,i,o){return n("view",{key:e._$s(5,"f",{forIndex:i,key:r}),staticClass:e._$s("5-"+o,"sc","fan-item"),attrs:{_i:"5-"+o}},[n("view",{staticClass:e._$s("6-"+o,"sc","user-info"),attrs:{"data-openid":e._$s("6-"+o,"a-data-openid",t._openid),_i:"6-"+o},on:{click:e.openUserProfile}},[n("image",{staticClass:e._$s("7-"+o,"sc","avatar"),attrs:{src:e._$s("7-"+o,"a-src",t.avatarUrl||e.defaultAvatar),"data-index":e._$s("7-"+o,"a-data-index",r),_i:"7-"+o},on:{error:e.onAvatarError}}),n("view",{staticClass:e._$s("8-"+o,"sc","info-text"),attrs:{_i:"8-"+o}},[n("text",{staticClass:e._$s("9-"+o,"sc","name"),attrs:{_i:"9-"+o}},[e._v(e._$s("9-"+o,"t0-0",e._s(t.nickName||"\u5fae\u4fe1\u7528\u6237")))]),n("text",{staticClass:e._$s("10-"+o,"sc","bio"),attrs:{_i:"10-"+o}},[e._v(e._$s("10-"+o,"t0-0",e._s(t.bio||"\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u90fd\u6ca1\u7559\u4e0b~")))]),e._$s("11-"+o,"i",t.followedAtText)?n("text",{staticClass:e._$s("11-"+o,"sc","follow-time"),attrs:{_i:"11-"+o}},[e._v(e._$s("11-"+o,"t0-0",e._s(t.followedAtText)))]):e._e(),e._$s("12-"+o,"i",t.isMutual)?n("view",{staticClass:e._$s("12-"+o,"sc","mutual-label"),attrs:{_i:"12-"+o}}):e._e()])]),n("button",{staticClass:e._$s("13-"+o,"sc","follow-btn"),attrs:{"data-openid":e._$s("13-"+o,"a-data-openid",t._openid),"data-index":e._$s("13-"+o,"a-data-index",r),loading:e._$s("13-"+o,"a-loading",e.pendingOpenid===t._openid),disabled:e._$s("13-"+o,"a-disabled",e.pendingOpenid===t._openid),_i:"13-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onToggleFollow(t)}}},[e._v(e._$s("13-"+o,"t0-0",e._s(t.isMutual?"\u53d6\u6d88\u5173\u6ce8":"\u5173\u6ce8")))])])})),0)]:n("view",{staticClass:e._$s(14,"sc","empty"),attrs:{_i:14}},[n("text")]),e._$s(16,"i",e.fans.length>0)?n("view",{staticClass:e._$s(16,"sc","footer-hint"),attrs:{_i:16}},[e._$s(17,"i",e.isLoading)?n("view",{staticClass:e._$s(17,"sc","loading-more"),attrs:{_i:17}}):e._$s(18,"e",!e.hasMore)?n("view",{staticClass:e._$s(18,"sc","loading-more"),attrs:{_i:18}}):e._e()]):e._e()],2)},i=[]},"3f62":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HunYuanExpSimpleModel=void 0;var r=n("7a9b"),i=n("31a3"),o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},u=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="hunyuan-exp/chat/completions",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,this.req({url:this.url,data:o(o({},(0,i.processInput)(e)),{stream:!1}),stream:!1})];case 1:return t=n.sent(),[2,o(o({},t),{rawResponse:t})]}}))}))},e.prototype.doStream=function(e){return a(this,void 0,void 0,(function(){var t,n,a,u,c;return s(this,(function(s){switch(s.label){case 0:return t=null,[4,this.req({url:this.url,data:o(o({},(0,i.processInput)(e)),{stream:!0}),stream:!0})];case 1:return n=s.sent(),a=(0,r.toPolyfillReadable)(n),u=(0,r.intoStandardStream)(a),c=u.pipeThrough(new r.TransformStream({transform:function(e,n){var i=e.choices.map((function(e){var n=e.delta;return null==t&&(t=(0,r.isToolCallAssistantMessage)(n)),t?o(o({},e),{finish_reason:"tool_calls",delta:n}):e})),a=o(o({},e),{choices:i});n.enqueue(o(o({},a),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(c)]}}))}))},e}();t.HunYuanExpSimpleModel=u},4008:function(e,t,n){"use strict";n.r(t);var r=n("2a89"),i=n("4afd");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},4073:function(e,t,n){(function(t,r){var i=n("127e"),o=n("7ca3"),a=n("ee10"),s=n("67ad"),u=n("0bdb");function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=n("11ca"),f=d.cloudCall,p=function(){"use strict";function e(){s(this,e),this.cloudEnv=t.cloud}return u(e,[{key:"callCloudFunction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(e,t,{pageTag:"imageManager-util",requireAuth:!0})}},{key:"uploadImage",value:function(){var e=a(i.mark((function e(t){var n,o,a,s,u,c,d,f=arguments;return i.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:{},e.prev=1,o=uni.getFileSystemManager(),a=o.readFileSync(t,"base64"),s=Date.now(),u=t&&"string"===typeof t&&t.split(".").pop()||"png",c=n.name?"".concat(n.name,"_").concat(s,".").concat(u):"image_".concat(s,".").concat(u),r("log","\u51c6\u5907\u8c03\u7528\u4e91\u51fd\u6570\u4e0a\u4f20\uff0c\u53c2\u6570:",{action:"uploadImage",cloudPath:c,category:n.category||"general",fileContentLength:a.length}," at utils/imageManager.js:36"),e.next=10,this.callCloudFunction("imageManager",{action:"uploadImage",fileContent:a,cloudPath:c,category:n.category||"general",metadata:l({name:n.name||"",originalPath:t},n.metadata)});case 10:if(d=e.sent,r("log","\u4e91\u51fd\u6570\u8fd4\u56de\u7ed3\u679c:",d," at utils/imageManager.js:53"),!d.result.success){e.next=16;break}return e.abrupt("return",{success:!0,fileID:d.result.fileID,imageId:d.result.imageId,url:d.result.url});case 16:throw new Error(d.result.error||"\u4e0a\u4f20\u5931\u8d25");case 17:e.next=25;break;case 19:return e.prev=19,e.t0=e["catch"](1),r("log","CatchClause",e.t0," at utils/imageManager.js:65"),r("log","CatchClause",e.t0," at utils/imageManager.js:66"),r("error","\u56fe\u7247\u4e0a\u4f20\u5931\u8d25:",e.t0," at utils/imageManager.js:67"),e.abrupt("return",{success:!1,error:e.t0.message});case 25:case"end":return e.stop()}}),e,this,[[1,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getImageUrl",value:function(){var e=a(i.mark((function e(){var t,n,o=arguments;return i.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},e.prev=1,e.next=4,this.callCloudFunction("imageManager",l({action:"getImageUrl"},t));case 4:if(n=e.sent,!n.result.success){e.next=9;break}return e.abrupt("return",{success:!0,url:n.result.url,fileID:n.result.fileID,expireTime:n.result.expireTime});case 9:throw new Error(n.result.error||"\u83b7\u53d6URL\u5931\u8d25");case 10:e.next=18;break;case 12:return e.prev=12,e.t0=e["catch"](1),r("log","CatchClause",e.t0," at utils/imageManager.js:101"),r("log","CatchClause",e.t0," at utils/imageManager.js:102"),r("error","\u83b7\u53d6\u56fe\u7247URL\u5931\u8d25:",e.t0," at utils/imageManager.js:103"),e.abrupt("return",{success:!1,error:e.t0.message});case 18:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"getSplashImageUrl",value:function(){var e=a(i.mark((function e(){var t;return i.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getImageUrl({category:"splash",name:"splash"});case 2:if(t=e.sent,!t.success){e.next=7;break}return e.abrupt("return",t.url);case 7:return e.abrupt("return","/static/images/splash.png");case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"uploadSplashImage",value:function(){var e=a(i.mark((function e(t){return i.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.uploadImage(t,{category:"splash",name:"splash",metadata:{description:"\u5f00\u5c4f\u56fe",usage:"splash_screen"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"preloadImages",value:function(){var e=a(i.mark((function e(t){var n;return i.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.map((function(e){return new Promise((function(t){uni.downloadFile({url:e,success:function(n){200===n.statusCode?t({success:!0,tempFilePath:n.tempFilePath,url:e}):t({success:!1,error:"\u4e0b\u8f7d\u5931\u8d25",url:e})},fail:function(n){t({success:!1,error:n.errMsg,url:e})}})}))})),e.next=3,Promise.all(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteImage",value:function(){var e=a(i.mark((function e(){var t,n,o=arguments;return i.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},e.prev=1,e.next=4,this.callCloudFunction("imageManager",l({action:"deleteImage"},t));case 4:return n=e.sent,e.abrupt("return",n.result);case 8:return e.prev=8,e.t0=e["catch"](1),r("log","CatchClause",e.t0," at utils/imageManager.js:197"),r("log","CatchClause",e.t0," at utils/imageManager.js:198"),r("error","\u5220\u9664\u56fe\u7247\u5931\u8d25:",e.t0," at utils/imageManager.js:199"),e.abrupt("return",{success:!1,error:e.t0.message});case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"getImageList",value:function(){var e=a(i.mark((function e(){var t,n,o=arguments;return i.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},e.prev=1,e.next=4,this.callCloudFunction("imageManager",l({action:"getImageList"},t));case 4:return n=e.sent,e.abrupt("return",n.result);case 8:return e.prev=8,e.t0=e["catch"](1),r("log","CatchClause",e.t0," at utils/imageManager.js:223"),r("log","CatchClause",e.t0," at utils/imageManager.js:224"),r("error","\u83b7\u53d6\u56fe\u7247\u5217\u8868\u5931\u8d25:",e.t0," at utils/imageManager.js:225"),e.abrupt("return",{success:!1,error:e.t0.message});case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),h=new p;e.exports={ImageManager:p,imageManager:h}}).call(this,n("ed83")["default"],n("f3b9")["default"])},4112:function(e,t,n){"use strict";n.r(t);var r=n("ecca"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"42d8":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),style:e._$s(0,"s","padding-bottom: calc(120rpx + "+e.keyboardHeight+"px);"),attrs:{_i:0}},[e._$s(1,"i",e.imageList.length>0)?n("view",{staticClass:e._$s(1,"sc","image-section"),attrs:{_i:1}},[n("scroll-view",{staticClass:e._$s(2,"sc","image-preview-scroll"),attrs:{_i:2}},[n("view",{staticClass:e._$s(3,"sc","image-preview-container"),attrs:{_i:3}},[e._l(e._$s(4,"f",{forItems:e.imageList}),(function(t,r,i,o){return n("view",{key:e._$s(4,"f",{forIndex:i,key:r}),staticClass:e._$s("4-"+o,"sc","image-preview-item"),attrs:{_i:"4-"+o}},[n("image",{staticClass:e._$s("5-"+o,"sc","preview-image"),attrs:{src:e._$s("5-"+o,"a-src",t.previewUrl),_i:"5-"+o},on:{error:e.onImageError}}),n("view",{staticClass:e._$s("6-"+o,"sc","image-remove-btn"),attrs:{"data-index":e._$s("6-"+o,"a-data-index",r),_i:"6-"+o},on:{click:e.removeImage}})])})),e._$s(7,"i",e.imageList.length<e.maxImageCount)?n("view",{staticClass:e._$s(7,"sc","add-image-btn"),attrs:{_i:7},on:{click:e.handleChooseImage}},[n("view",{staticClass:e._$s(8,"sc","add-icon"),attrs:{_i:8}})]):e._e()],2)])]):e._e(),n("view",{staticClass:e._$s(9,"sc","content-section"),attrs:{_i:9}},[n("view",{staticClass:e._$s(10,"sc","title-input-wrapper"),attrs:{_i:10}},[n("input",{staticClass:e._$s(11,"sc","title-input"),attrs:{value:e._$s(11,"a-value",e.title),_i:11},on:{input:e.onTitleInput}})]),e._$s(12,"i","poem"===e.publishMode)?n("view",{staticClass:e._$s(12,"sc","author-input-wrapper"),attrs:{_i:12}},[n("input",{staticClass:e._$s(13,"sc","author-input"),attrs:{placeholder:e._$s(13,"a-placeholder",e.isOriginal?"\u4f5c\u8005\uff08\u53ef\u9009\uff0c\u4e0d\u586b\u9ed8\u8ba4\u4f7f\u7528\u60a8\u7684\u6635\u79f0\uff09":"\u4f5c\u8005\uff08\u5fc5\u586b\uff09"),value:e._$s(13,"a-value",e.author),_i:13},on:{input:e.onAuthorInput}})]):e._e(),n("view",{staticClass:e._$s(14,"sc","content-input-wrapper"),attrs:{_i:14}},[n("textarea",{staticClass:e._$s(15,"sc","content-textarea"),attrs:{value:e._$s(15,"a-value",e.content),_i:15},on:{input:e.onContentInput,focus:e.onTextareaFocus,blur:e.onTextareaBlur,click:e.onTextareaTap}}),e._$s(16,"i",e.content.length>1400)?n("view",{staticClass:e._$s(16,"sc","char-count"),attrs:{_i:16}},[e._v(e._$s(16,"t0-0",e._s(e.content.length)))]):e._e()])]),e._$s(17,"i",e.showPoemSubmenu)?n("view",{staticClass:e._$s(17,"sc","poem-submenu"),attrs:{_i:17}},[n("view",{staticClass:e._$s(18,"sc","submenu-item"),attrs:{_i:18},on:{click:e.selectPoemMode}},[n("view",{staticClass:e._$s(19,"sc","submenu-icon"),attrs:{_i:19}}),n("view",{staticClass:e._$s(20,"sc","submenu-text"),attrs:{_i:20}})]),n("view",{staticClass:e._$s(21,"sc","submenu-item"),attrs:{_i:21},on:{click:e.selectPoemMode}},[n("view",{staticClass:e._$s(22,"sc","submenu-icon"),attrs:{_i:22}}),n("view",{staticClass:e._$s(23,"sc","submenu-text"),attrs:{_i:23}})])]):e._e(),n("view",{staticClass:e._$s(24,"sc","toolbar"),style:e._$s(24,"s","bottom: "+e.keyboardHeight+"px;"),attrs:{_i:24}},[n("view",{staticClass:e._$s(25,"sc","toolbar-item"),attrs:{_i:25},on:{click:e.handleChooseImage}},[n("view",{staticClass:e._$s(26,"sc","toolbar-icon"),attrs:{_i:26}}),n("view",{staticClass:e._$s(27,"sc","toolbar-text"),attrs:{_i:27}})]),n("view",{staticClass:e._$s(28,"sc","toolbar-item"),attrs:{_i:28},on:{click:e.toggleTagSelector}},[n("view",{staticClass:e._$s(29,"sc","toolbar-icon"),attrs:{_i:29}}),n("view",{staticClass:e._$s(30,"sc","toolbar-text"),attrs:{_i:30}})]),n("view",{staticClass:e._$s(31,"sc","toolbar-item"),attrs:{_i:31},on:{click:e.switchMode}},[n("view",{staticClass:e._$s(32,"sc","toolbar-icon"),attrs:{_i:32}},[e._v(e._$s(32,"t0-0",e._s("normal"===e.publishMode?"\ud83d\udcdd":"\ud83c\udfad")))]),n("view",{staticClass:e._$s(33,"sc","toolbar-text"),attrs:{_i:33}},[e._v(e._$s(33,"t0-0",e._s("normal"===e.publishMode?"\u5199\u8bd7":"\u666e\u901a")))])]),n("view",{class:e._$s(34,"c","publish-btn "+(e.canPublish?"active":"")),attrs:{_i:34},on:{click:e.submitPost}})]),e._$s(35,"i",e.showTagSelector)?n("view",{staticClass:e._$s(35,"sc","tag-section"),style:e._$s(35,"s","bottom: calc(120rpx + "+e.keyboardHeight+"px);"),attrs:{_i:35}},[n("view",{staticClass:e._$s(36,"sc","tag-header"),attrs:{_i:36}},[n("text",{staticClass:e._$s(37,"sc","tag-title"),attrs:{_i:37}}),n("text",{staticClass:e._$s(38,"sc","tag-count"),attrs:{_i:38}},[e._v(e._$s(38,"t0-0",e._s(e.selectedTags.length)))]),n("text",{staticClass:e._$s(39,"sc","tag-toggle"),attrs:{_i:39},on:{click:e.toggleTagSelector}})]),e._$s(40,"i",e.selectedTags.length>0)?n("view",{staticClass:e._$s(40,"sc","selected-tags"),attrs:{_i:40}},e._l(e._$s(41,"f",{forItems:e.selectedTags}),(function(t,r,i,o){return n("view",{key:e._$s(41,"f",{forIndex:i,key:r}),staticClass:e._$s("41-"+o,"sc","selected-tag"),attrs:{_i:"41-"+o}},[n("text",[e._v(e._$s("42-"+o,"t0-0",e._s(t)))]),n("text",{staticClass:e._$s("43-"+o,"sc","remove-tag"),attrs:{"data-tag":e._$s("43-"+o,"a-data-tag",t),_i:"43-"+o},on:{click:e.removeTag}})])})),0):e._e(),e._$s(44,"i",e.showTagSelector)?n("view",{staticClass:e._$s(44,"sc","tag-selector"),attrs:{_i:44}},[n("view",{staticClass:e._$s(45,"sc","category-selector"),attrs:{_i:45}},[n("scroll-view",{staticClass:e._$s(46,"sc","category-scroll"),attrs:{_i:46}},[n("view",{staticClass:e._$s(47,"sc","category-list"),attrs:{_i:47}},e._l(e._$s(48,"f",{forItems:e.tagCategories}),(function(t,r,i,o){return n("view",{key:e._$s(48,"f",{forIndex:i,key:r}),class:e._$s("48-"+o,"c","category-item "+(e.currentCategoryIndex===r?"active":"")),attrs:{"data-index":e._$s("48-"+o,"a-data-index",r),_i:"48-"+o},on:{click:e.switchCategory}},[n("text",{staticClass:e._$s("49-"+o,"sc","category-icon"),attrs:{_i:"49-"+o}},[e._v(e._$s("49-"+o,"t0-0",e._s(t.icon)))]),n("text",{staticClass:e._$s("50-"+o,"sc","category-name"),attrs:{_i:"50-"+o}},[e._v(e._$s("50-"+o,"t0-0",e._s(t.name)))])])})),0)])]),n("view",{staticClass:e._$s(51,"sc","current-category-tags"),attrs:{_i:51}},e._l(e._$s(52,"f",{forItems:e.tagCategories[e.currentCategoryIndex].tags}),(function(t,r,i,o){return n("view",{key:e._$s(52,"f",{forIndex:i,key:r}),class:e._$s("52-"+o,"c","preset-tag "+(e.selectedTags.includes(t)?"selected":"")),attrs:{"data-tag":e._$s("52-"+o,"a-data-tag",t),_i:"52-"+o},on:{click:e.selectTag}},[e._v(e._$s("52-"+o,"t0-0",e._s(t)))])})),0),n("view",{staticClass:e._$s(53,"sc","custom-tag-input"),attrs:{_i:53}},[n("input",{attrs:{value:e._$s(54,"a-value",e.customTag),_i:54},on:{input:e.onCustomTagInput}}),n("button",{attrs:{_i:55},on:{click:e.addCustomTag}})]),e._$s(56,"i",e.showMatchedTags&&e.matchedTags.length>0)?n("view",{staticClass:e._$s(56,"sc","matched-tags"),attrs:{_i:56}},[n("view",{staticClass:e._$s(57,"sc","matched-tags-title"),attrs:{_i:57}}),n("view",{staticClass:e._$s(58,"sc","matched-tags-list"),attrs:{_i:58}},e._l(e._$s(59,"f",{forItems:e.matchedTags}),(function(t,r,i,o){return n("view",{key:e._$s(59,"f",{forIndex:i,key:r}),staticClass:e._$s("59-"+o,"sc","matched-tag"),attrs:{"data-tag":e._$s("59-"+o,"a-data-tag",t),_i:"59-"+o},on:{click:e.selectMatchedTag}},[e._v(e._$s("59-"+o,"t0-0",e._s(t)))])})),0)]):e._e()]):e._e()]):e._e()])},i=[]},4316:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserialize=function(e){var t=s({},e);for(var n in t)switch(n){case"$date":switch((0,i.getType)(t[n])){case"number":return new Date(t[n]);case"object":return new a.ServerDate(t[n])}break;case"type":switch(t.type){case"Point":if((0,i.isArray)(t.coordinates)&&(0,i.isNumber)(t.coordinates[0])&&(0,i.isNumber)(t.coordinates[1]))return new o.Point(t.coordinates[0],t.coordinates[1]);break}break}return e},t.serialize=function(e){return function e(t,n){if(!(0,i.isInternalObject)(t)){if((0,i.isDate)(t))return{$date:+t};if((0,i.isRegExp)(t))return{$regex:t.source,$options:t.flags};if((0,i.isArray)(t))return t.map((function(t){if(n.indexOf(t)>-1)throw new Error("Cannot convert circular structure to JSON");return e(t,c(n,[t]))}));if((0,i.isObject)(t)){var o=s({},t);for(var a in o){if(n.indexOf(o[a])>-1)throw new Error("Cannot convert circular structure to JSON");o[a]=e(o[a],c(n,[o[a]]))}return o}return t}switch(t._internalType){case r.SYMBOL_GEO_POINT:return t.toJSON();case r.SYMBOL_SERVER_DATE:return t.parse();case r.SYMBOL_REGEXP:return t.parse();default:return t.toJSON?t.toJSON():t}}(e,[e])};var r=n("a4d5"),i=n("8539"),o=n("e775"),a=n("d137"),s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)},u=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{while((void 0===t||t-- >0)&&!(r=o.next()).done)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a},c=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}},"438d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toolMap=t.ReactModel=void 0;var r=n("7a9b"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},u=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){t=e[n](t),function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,t.done,t.value)}))}}},c=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function l(e){var t,n=e.onStepFinish,o=e.abortSignal,a=e.maxSteps,u=e.topP,c=e.toolChoice,l=s(e,["onStepFinish","abortSignal","maxSteps","topP","toolChoice"]);if(null!=a&&a<1)throw new Error("`maxSteps` muse be greater than 0.");return[{onStepFinish:n,abortSignal:o,maxSteps:a},i(i({},l),{tools:null===(t=l.tools)||void 0===t?void 0:t.map((function(e){return"fn"in e?(0,r.functionToolToModelTool)(e):e})),top_p:null!=u?u:l.top_p,tool_choice:null!=c?c:l.tool_choice})]}var d=function(){function e(e){this.model=e}return e.prototype.generateText=function(e,t){var n,r;return o(this,void 0,void 0,(function(){var i,o,s,u,d,h,y,_,b,w,S,I,C,T,O,E,x,P,k,A,R,D=this;return a(this,(function(a){switch(a.label){case 0:return i=[],o={completion_tokens:0,prompt_tokens:0,total_tokens:0},s=l(e),u=s[0],d=u.onStepFinish,h=u.maxSteps,y=void 0===h?10:h,_=s[1],b=function(){return D.model.doGenerate(_,t)},[4,b()];case 1:w=a.sent(),S=1,w.rawResponse&&i.push(w.rawResponse),I=null,a.label=2;case 2:if(!(S<y&&null!=(I=f(w))))return[3,9];C=v(w.usage),m(o,C),a.label=3;case 3:return a.trys.push([3,7,,8]),[4,g(I)];case 4:return T=a.sent(),O=w.choices[0],[4,null===d||void 0===d?void 0:d({finishReason:O.finish_reason,messages:_.messages.slice(),text:O.message.content,toolCall:I,toolResult:T,stepUsage:C,totalUsage:Object.assign({},o)})];case 5:return a.sent(),p(_.messages,O.message,T),[4,b()];case 6:return w=a.sent(),w.rawResponse&&i.push(w.rawResponse),S+=1,[3,8];case 7:return E=a.sent(),[2,{text:"",messages:_.messages,usage:o,error:E,rawResponses:i}];case 8:return[3,2];case 9:return x=null===(n=null===w||void 0===w?void 0:w.choices)||void 0===n?void 0:n[0],P=null===x||void 0===x?void 0:x.message,k=null!==(r=null===P||void 0===P?void 0:P.content)&&void 0!==r?r:"",A=P?c(c([],_.messages,!0),[P],!1):_.messages,R=v(w.usage),m(o,R),[4,null===d||void 0===d?void 0:d({finishReason:x.finish_reason,messages:A.slice(),text:k,toolCall:f(w),toolResult:null,stepUsage:R,totalUsage:Object.assign({},o)})];case 10:return a.sent(),[2,{text:k,messages:A,usage:o,rawResponses:i}]}}))}))},e.prototype.streamText=function(e,t){var n;return o(this,void 0,void 0,(function(){var i,s,d,f,h,v,y,_,b,w,S,I,C,T,O,E,x,P,k,A,R,D,L,N,M,$,j,U,F,B,q,W,H,V,G,Y,K=this;return a(this,(function(z){switch(z.label){case 0:return i={completion_tokens:0,prompt_tokens:0,total_tokens:0},s=l(e),d=s[0],f=d.onStepFinish,h=d.maxSteps,v=void 0===h?10:h,y=s[1],_=function(){return K.model.doStream(y,t)},[4,_()];case 1:b=z.sent(),w=1,S=null,I=function(){var e=b.tee(),t=e[0],n=e[1];return b=(0,r.createAsyncIterable)(t),function(e){var t,n,i,s,c,l,d,f,p,h;return o(this,void 0,void 0,(function(){var o,g,v,m,y,_,b,w,S,I,C,T,O;return a(this,(function(a){switch(a.label){case 0:o={completion_tokens:0,prompt_tokens:0,total_tokens:0},g=(0,r.createAsyncIterable)(e),v={id:"",function:{name:"",arguments:""},type:""},m={role:"assistant",content:"",tool_calls:[v]},a.label=1;case 1:a.trys.push([1,6,7,12]),y=!0,_=u(g),a.label=2;case 2:return[4,_.next()];case 3:if(b=a.sent(),t=b.done,t)return[3,5];s=b.value,y=!1;try{if(w=s,S=null===w||void 0===w?void 0:w.choices[0],!S)return[2,null];if(I=S.finish_reason,C=S.delta,"tool_calls"!==I)return[2,null];if(!C)return[3,4];if(C.content&&(m.content+=C.content),!("tool_calls"in C))return[3,4];T=null===(c=null===C||void 0===C?void 0:C.tool_calls)||void 0===c?void 0:c[0],(null===T||void 0===T?void 0:T.id)&&(v.id=T.id),(null===T||void 0===T?void 0:T.type)&&(v.type=T.type),(null===(l=null===T||void 0===T?void 0:T.function)||void 0===l?void 0:l.name)&&(v.function.name=T.function.name),(null===(d=null===T||void 0===T?void 0:T.function)||void 0===d?void 0:d.arguments)&&(v.function.arguments+=T.function.arguments),(null===(f=null===w||void 0===w?void 0:w.usage)||void 0===f?void 0:f.completion_tokens)&&(o.completion_tokens=w.usage.completion_tokens),(null===(p=null===w||void 0===w?void 0:w.usage)||void 0===p?void 0:p.prompt_tokens)&&(o.prompt_tokens=w.usage.prompt_tokens),(null===(h=null===w||void 0===w?void 0:w.usage)||void 0===h?void 0:h.total_tokens)&&(o.total_tokens=w.usage.total_tokens)}finally{y=!0}a.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return O=a.sent(),n={error:O},[3,12];case 7:return a.trys.push([7,,10,11]),y||t||!(i=_.return)?[3,9]:[4,i.call(_)];case 8:a.sent(),a.label=9;case 9:return[3,11];case 10:if(n)throw n.error;return[7];case 11:return[7];case 12:return[2,{message:m,usage:o}]}}))}))}(n)},z.label=2;case 2:return C=w<v,C?[4,I()]:[3,4];case 3:C=null!=(S=z.sent()),z.label=4;case 4:if(!C)return[3,11];T=S.message,O=S.usage,m(i,O),E=null===(n=T.tool_calls)||void 0===n?void 0:n[0],z.label=5;case 5:return z.trys.push([5,9,,10]),[4,g(E)];case 6:return x=z.sent(),[4,null===f||void 0===f?void 0:f({finishReason:"tool_calls",messages:y.messages.slice(),text:T.content,toolCall:E,toolResult:x,stepUsage:O,totalUsage:Object.assign({},i)})];case 7:return z.sent(),p(y.messages,T,x),[4,_()];case 8:return b=z.sent(),[3,10];case 9:return P=z.sent(),k=b.tee(),A=k[0],R=k[1],[2,{messages:Promise.resolve(y.messages),dataStream:(0,r.createAsyncIterable)(A),textStream:(0,r.createAsyncIterable)(R.pipeThrough(new r.TransformStream({transform:function(e,t){var n,r,i,o=null===(i=null===(r=null===(n=null===e||void 0===e?void 0:e.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.delta)||void 0===i?void 0:i.content;"string"===typeof o&&t.enqueue(o)}}))),usage:Promise.resolve(i),error:P}];case 10:return[3,2];case 11:return[4,I()];case 12:return S=z.sent(),S?(D=S.message,L=S.usage,m(i,L),N=c(c([],y.messages,!0),[D],!1),f({messages:N.slice(),finishReason:"tool_call",stepUsage:L,text:D.content,toolCall:D.tool_calls[0],totalUsage:Object.assign({},i)}),M=b.tee(),$=M[0],j=M[1],[2,{messages:Promise.resolve(c(c([],y.messages,!0),[D],!1)),dataStream:(0,r.createAsyncIterable)($),textStream:(0,r.createAsyncIterable)(j.pipeThrough(new r.TransformStream({transform:function(e,t){var n,r,i,o=null===(i=null===(r=null===(n=null===e||void 0===e?void 0:e.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.delta)||void 0===i?void 0:i.content;"string"===typeof o&&t.enqueue(o)}}))),usage:Promise.resolve(i)}]):(U=(0,r.createPromise)(),F=(0,r.createPromise)(),B={role:"assistant",content:""},q="",W={completion_tokens:0,prompt_tokens:0,total_tokens:0},H=b.pipeThrough(new r.TransformStream({transform:function(e,t){var n,r,i,o,a,s,u,c,l=null===(i=null===(r=null===(n=null===e||void 0===e?void 0:e.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.delta)||void 0===i?void 0:i.content;"string"===typeof l&&(B.content+=l);var d=null===(a=null===(o=null===e||void 0===e?void 0:e.choices)||void 0===o?void 0:o[0])||void 0===a?void 0:a.finish_reason;d&&(q=d),(null===(s=null===e||void 0===e?void 0:e.usage)||void 0===s?void 0:s.completion_tokens)&&(W.completion_tokens=e.usage.completion_tokens),(null===(u=null===e||void 0===e?void 0:e.usage)||void 0===u?void 0:u.prompt_tokens)&&(W.prompt_tokens=e.usage.prompt_tokens),(null===(c=null===e||void 0===e?void 0:e.usage)||void 0===c?void 0:c.total_tokens)&&(W.total_tokens=e.usage.total_tokens),t.enqueue(e)},flush:function(){U.res(c(c([],y.messages,!0),[B],!1)),m(i,W),F.res(Object.assign({},i)),null===f||void 0===f||f({messages:c(c([],y.messages,!0),[B],!1),finishReason:q,text:B.content,stepUsage:W,totalUsage:Object.assign({},i)})}})),V=H.tee(),G=V[0],Y=V[1],[2,{messages:U.promise,dataStream:(0,r.createAsyncIterable)(G),textStream:(0,r.createAsyncIterable)(Y.pipeThrough(new r.TransformStream({transform:function(e,t){var n,r,i,o=null===(i=null===(r=null===(n=null===e||void 0===e?void 0:e.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.delta)||void 0===i?void 0:i.content;"string"===typeof o&&t.enqueue(o)}}))),usage:F.promise}])}}))}))},e}();function f(e){var t,n=null===(t=null===e||void 0===e?void 0:e.choices)||void 0===t?void 0:t[0];if(!n)return null;var i=n.finish_reason,o=n.message;return"tool_calls"!==i?null:o&&(0,r.isToolCallAssistantMessage)(o)?o.tool_calls[0]:null}function p(e,t,n){e.push(t,{role:"tool",tool_call_id:t.tool_calls[0].id,content:JSON.stringify(n)})}t.ReactModel=d;var h=new Map;function g(e){return h.get(e.function.name)(JSON.parse(e.function.arguments))}function v(e){var t,n,r;return{completion_tokens:null!==(t=null===e||void 0===e?void 0:e.completion_tokens)&&void 0!==t?t:0,prompt_tokens:null!==(n=null===e||void 0===e?void 0:e.prompt_tokens)&&void 0!==n?n:0,total_tokens:null!==(r=null===e||void 0===e?void 0:e.total_tokens)&&void 0!==r?r:0}}function m(e,t){e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens}t.toolMap=h},"446a":function(e,t,n){var r=n("7426"),i=Object.prototype,o=i.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:o.call(t,e)}},"461d":function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},4679:function(e,t,n){"use strict";function r(e){this.message=e}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidTokenError=a,t.default=void 0,r.prototype=new Error,r.prototype.name="InvalidCharacterError";var i="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,i,o=0,a=0,s="";i=t.charAt(a++);~i&&(n=o%4?64*n+i:i,o++%4)?s+=String.fromCharCode(255&n>>(-2*o&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return s};function o(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(i(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return i(t)}}function a(e){this.message=e}a.prototype=new Error,a.prototype.name="InvalidTokenError";var s=function(e,t){if("string"!=typeof e)throw new a("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(o(e.split(".")[n]))}catch(e){throw new a("Invalid token specified: "+e.message)}};t.default=s},"47a9":function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports["default"]=e.exports},4861:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=void 0;var i=r(n("b7d4")),o=r(n("127e")),a=r(n("ee10")),s=r(n("7ca3")),u=r(n("67ad")),c=r(n("0bdb")),l=n("2ce5"),d=n("223b"),f=n("08c8"),p=n("a9a5"),h=r(n("140c")),g=["provider_redirect_uri","other_params"];function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t){var r=function(){try{var e=n("2bfd");return e}catch(t){return}};try{var i;if(((null===t||void 0===t||null===(i=t.root)||void 0===i?void 0:i.globalThis)||globalThis).IS_MP_BUILD)return;if(!Object({VUE_APP_DARK_MODE:"false",VUE_APP_NAME:"poementer",VUE_APP_PLATFORM:"app-plus",NODE_ENV:"production",BASE_URL:"/"}).IS_MP_BUILD&&e)return r()}catch(o){if(e)return r()}}var _=function(){function t(e){(0,u.default)(this,t);var n=e.request,r=e.credentialsClient;if(!r){var i={apiOrigin:e.apiOrigin,apiPath:e.apiPath,clientId:e.clientId,storage:e.storage,env:e.env,baseRequest:e.baseRequest,anonymousSignInFunc:e.anonymousSignInFunc,wxCloud:e.wxCloud,onCredentialsError:e.onCredentialsError,headers:e.headers||{},i18n:e.i18n};r=new d.OAuth2Client(i)}if(!n){var o=r.request.bind(r),a=new f.Captcha(m({clientId:e.clientId,request:o,storage:e.storage,adapter:e.adapter},e.captchaOptions));n=a.request.bind(a)}this.config={env:e.env,apiOrigin:e.apiOrigin,apiPath:e.apiPath,clientId:e.clientId,request:n,credentialsClient:r,storage:e.storage||d.defaultStorage,adapter:e.adapter}}return(0,c.default)(t,[{key:"getParamsByVersion",value:function(e,t){var n,r=(0,p.deepClone)(e),i=(null===(n={v2:l.ApiUrlsV2}[null===r||void 0===r?void 0:r.version])||void 0===n?void 0:n[t])||l.ApiUrls[t];return r&&delete r.version,{params:r,url:i}}},{key:"signIn",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r,i,a;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.version||"v1",r=this.getParamsByVersion(t,"AUTH_SIGN_IN_URL"),r.params.query&&delete r.params.query,e.next=5,this.getEncryptParams(r.params);case 5:return i=e.sent,e.next=8,this.config.request(r.url,{method:"POST",body:i});case 8:return a=e.sent,e.next=11,this.config.credentialsClient.setCredentials(m(m({},a),{},{version:n}));case 11:return e.abrupt("return",Promise.resolve(a));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signInAnonymously",value:function(){var e=(0,a.default)(o.default.mark((function e(){var t,n,r,i=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=i.length>1&&void 0!==i[1]&&i[1],e.next=4,this.config.request(l.ApiUrls.AUTH_SIGN_IN_ANONYMOUSLY_URL,{method:"POST",body:t,useWxCloud:n});case 4:return r=e.sent,e.next=7,this.config.credentialsClient.setCredentials(r);case 7:return e.abrupt("return",Promise.resolve(r));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signUp",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.config.request(l.ApiUrls.AUTH_SIGN_UP_URL,{method:"POST",body:t});case 2:return n=e.sent,e.next=5,this.config.credentialsClient.setCredentials(n);case 5:return e.abrupt("return",Promise.resolve(n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var t=(0,a.default)(o.default.mark((function t(n){var r,i,a;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r={},!n){t.next=14;break}return t.prev=2,t.next=5,this.config.request(l.ApiUrls.AUTH_SIGNOUT_URL,{method:"POST",withCredentials:!0,body:n});case 5:r=t.sent,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](2),t.t0.error!==l.ErrorType.UNAUTHENTICATED&&e("log","sign_out_error",t.t0," at node_modules/@cloudbase/oauth/dist/esm/auth/apis.js:136");case 11:return t.next=13,this.config.credentialsClient.setCredentials();case 13:return t.abrupt("return",r);case 14:return t.next=16,this.config.credentialsClient.getAccessToken();case 16:return i=t.sent,t.next=19,this.config.request(l.ApiUrls.AUTH_REVOKE_URL,{method:"POST",body:{token:i}});case 19:return a=t.sent,t.next=22,this.config.credentialsClient.setCredentials();case 22:return t.abrupt("return",Promise.resolve(a));case 23:case"end":return t.stop()}}),t,this,[[2,8]])})));return function(e){return t.apply(this,arguments)}}()},{key:"revokeAllDevices",value:function(){var e=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.config.request(l.ApiUrls.AUTH_REVOKE_ALL_URL,{method:"DELETE",withCredentials:!0});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"revokeDevice",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.config.request(l.ApiUrls.AUTHORIZED_DEVICES_DELETE_URL+t.device_id,{method:"DELETE",withCredentials:!0});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getVerification",value:function(){var e=(0,a.default)(o.default.mark((function e(t,n){var r,i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=!1,"CUR_USER"!==t.target){e.next=5;break}r=!0,e.next=9;break;case 5:return e.next=7,this.hasLoginState();case 7:i=e.sent,i&&(r=!0);case 9:return e.abrupt("return",this.config.request(l.ApiUrls.VERIFICATION_URL,{method:"POST",body:t,withCaptcha:(null===n||void 0===n?void 0:n.withCaptcha)||!1,withCredentials:r}));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"verify",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.getParamsByVersion(t,"VERIFY_URL"),e.next=3,this.config.request(n.url,{method:"POST",body:n.params});case 3:if(r=e.sent,"v2"!==(null===t||void 0===t?void 0:t.version)){e.next=7;break}return e.next=7,this.config.credentialsClient.setCredentials(m(m({},r),{},{version:"v2"}));case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"genProviderRedirectUri",value:function(){var e=(0,a.default)(o.default.mark((function e(n){var r,a,s,u,c;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=n.provider_redirect_uri,a=n.other_params,s=void 0===a?{}:a,u=(0,i.default)(n,g),r&&!u.redirect_uri&&(u.redirect_uri=r),c="".concat(l.ApiUrls.PROVIDER_URI_URL,"?").concat(t.parseParamsToSearch(u)),Object.keys(s).forEach((function(e){var t=s[e];("sign_out_uri"!==e||(null===t||void 0===t?void 0:t.length)>0)&&(c+="&other_params[".concat(e,"]=").concat(encodeURIComponent(t)))})),e.abrupt("return",this.config.request(c,{method:"GET"}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"grantProviderToken",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],e.abrupt("return",this.config.request(l.ApiUrls.PROVIDER_TOKEN_URL,{method:"POST",body:t,useWxCloud:n}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"patchProviderToken",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.PROVIDER_TOKEN_URL,{method:"PATCH",body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signInWithProvider",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r,i,a=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],r=this.getParamsByVersion(t,"AUTH_SIGN_IN_WITH_PROVIDER_URL"),e.next=4,this.config.request(r.url,{method:"POST",body:r.params,useWxCloud:n});case 4:return i=e.sent,e.next=7,this.config.credentialsClient.setCredentials(m(m({},i),{},{version:(null===t||void 0===t?void 0:t.version)||"v1"}));case 7:return e.abrupt("return",Promise.resolve(i));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signInCustom",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.config.request(l.ApiUrls.AUTH_SIGN_IN_CUSTOM,{method:"POST",body:t});case 2:return n=e.sent,e.next=5,this.config.credentialsClient.setCredentials(n);case 5:return e.abrupt("return",Promise.resolve(n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signInWithWechat",value:function(){var e=(0,a.default)(o.default.mark((function e(){var t,n,r=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.config.request(l.ApiUrls.AUTH_SIGN_IN_WITH_WECHAT_URL,{method:"POST",body:t});case 3:return n=e.sent,e.next=6,this.config.credentialsClient.setCredentials(n);case 6:return e.abrupt("return",Promise.resolve(n));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bindWithProvider",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.PROVIDER_BIND_URL,{method:"POST",body:t,withCredentials:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserProfile",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getUserInfo(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserInfo",value:function(){var e=(0,a.default)(o.default.mark((function e(){var t,n,r,i,a,s=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=s.length>0&&void 0!==s[0]?s[0]:{},r=this.getParamsByVersion(n,"USER_ME_URL"),null!==(t=r.params)&&void 0!==t&&t.query&&(i=new h.default(r.params.query),r.url+="?".concat(i.toString())),e.next=5,this.config.request(r.url,{method:"GET",withCredentials:!0});case 5:return a=e.sent,a.sub&&(a.uid=a.sub),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWedaUserInfo",value:function(){var e=(0,a.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.config.request(l.ApiUrls.WEDA_USER_URL,{method:"GET",withCredentials:!0});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteMe",value:function(){var e=(0,a.default)(o.default.mark((function e(n){var r,i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=this.getParamsByVersion(n,"USER_ME_URL"),i="".concat(r.url,"?").concat(t.parseParamsToSearch(r.params)),e.abrupt("return",this.config.request(i,{method:"DELETE",withCredentials:!0}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasLoginState",value:function(){var e=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.config.credentialsClient.getAccessToken();case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"hasLoginStateSync",value:function(){var e=this.config.credentialsClient.getCredentialsSync();return e}},{key:"getLoginState",value:function(){var e=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.credentialsClient.getCredentialsAsync());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"transByProvider",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.USER_TRANS_BY_PROVIDER_URL,{method:"PATCH",body:t,withCredentials:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"grantToken",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.getParamsByVersion(t,"AUTH_TOKEN_URL"),e.abrupt("return",this.config.request(n.url,{method:"POST",body:n.params}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getProviders",value:function(){var e=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.PROVIDER_LIST,{method:"GET",withCredentials:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unbindProvider",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request("".concat(l.ApiUrls.PROVIDER_UNBIND_URL,"/").concat(t.provider_id),{method:"DELETE",withCredentials:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkPassword",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request("".concat(l.ApiUrls.CHECK_PWD_URL),{method:"POST",withCredentials:!0,body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"editContact",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request("".concat(l.ApiUrls.BIND_CONTACT_URL),{method:"PATCH",withCredentials:!0,body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setPassword",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request("".concat(l.ApiUrls.AUTH_SET_PASSWORD),{method:"PATCH",withCredentials:!0,body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updatePasswordByOld",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.sudo({password:t.old_password});case 2:return n=e.sent,e.abrupt("return",this.setPassword({sudo_token:n.sudo_token,new_password:t.new_password}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sudo",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request("".concat(l.ApiUrls.SUDO_URL),{method:"POST",withCredentials:!0,body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendVerificationCodeToCurrentUser",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.target="CUR_USER",e.abrupt("return",this.config.request(l.ApiUrls.VERIFICATION_URL,{method:"POST",body:t,withCredentials:!0,withCaptcha:!0}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeBoundProvider",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request("".concat(l.ApiUrls.PROVIDER_LIST,"/").concat(t.provider_id,"/trans"),{method:"POST",body:{provider_trans_token:t.trans_token},withCredentials:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setUserProfile",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.USER_PRIFILE_URL,{method:"PATCH",body:t,withCredentials:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateUserBasicInfo",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.USER_BASIC_EDIT_URL,{method:"POST",withCredentials:!0,body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryUserProfile",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new h.default(t),e.abrupt("return",this.config.request("".concat(l.ApiUrls.USER_QUERY_URL,"?").concat(n.toString()),{method:"GET",withCredentials:!0}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setCustomSignFunc",value:function(e){this.getCustomSignTicketFn=e}},{key:"signInWithCustomTicket",value:function(){var e=(0,a.default)(o.default.mark((function e(){var t,n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.getCustomSignTicketFn,t){e.next=3;break}return e.abrupt("return",Promise.reject({error:"failed_precondition",error_description:"please use setCustomSignFunc to set custom sign function"}));case 3:return e.next=5,t();case 5:return n=e.sent,e.abrupt("return",this.signInCustom({provider_id:"custom",ticket:n}));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resetPassword",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.AUTH_RESET_PASSWORD,{method:"POST",body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authorize",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.AUTHORIZE_URL,{method:"POST",withCredentials:!0,body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizeDevice",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.AUTHORIZE_DEVICE_URL,{method:"POST",withCredentials:!0,body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deviceAuthorize",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.AUTH_GET_DEVICE_CODE,{method:"POST",body:t,withCredentials:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizeInfo",value:function(){var e=(0,a.default)(o.default.mark((function e(n){var r,i,a,s;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r="".concat(l.ApiUrls.AUTHORIZE_INFO_URL,"?").concat(t.parseParamsToSearch(n)),i=!0,a=!1,e.next=5,this.hasLoginState();case 5:return s=e.sent,s&&(a=!0,i=!1),e.abrupt("return",this.config.request(r,{method:"GET",withBasicAuth:i,withCredentials:a}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkUsername",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.CHECK_USERNAME,{method:"GET",body:t,withCredentials:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkIfUserExist",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new h.default(t),e.abrupt("return",this.config.request("".concat(l.ApiUrls.CHECK_IF_USER_EXIST,"?").concat(n.toString()),{method:"GET"}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loginScope",value:function(){var e=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.credentialsClient.getScope());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loginGroups",value:function(){var e=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.credentialsClient.getGroups());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshTokenForce",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.config.credentialsClient.getCredentials();case 2:return n=e.sent,e.next=5,this.config.credentialsClient.refreshToken(m(m({},n),{},{version:(null===t||void 0===t?void 0:t.version)||"v1"}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCredentials",value:function(){var e=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.credentialsClient.getCredentials());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPublicKey",value:function(){var e=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrlsV2.AUTH_PUBLIC_KEY,{method:"POST",body:{}}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getEncryptParams",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r,i,a,s,u;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.isEncrypt,delete t.isEncrypt,r=(0,p.deepClone)(t),i=y(n,this.config.adapter),i){e.next=6;break}return e.abrupt("return",t);case 6:return a="",s="",e.prev=8,e.next=11,this.getPublicKey();case 11:if(u=e.sent,a=u.public_key,s=u.public_key_thumbprint,a&&s){e.next=16;break}throw u;case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e["catch"](8),e.t0;case 21:return e.abrupt("return",{params:i.getEncryptInfo({publicKey:a,payload:r}),public_key_thumbprint:s});case 22:case"end":return e.stop()}}),e,this,[[8,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getProviderSubType",value:function(){var e=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.GET_PROVIDER_TYPE,{method:"POST",body:{provider_id:"weda"}}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"verifyCaptchaData",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.token,r=t.key,e.abrupt("return",this.config.request(l.ApiUrls.VERIFY_CAPTCHA_DATA_URL,{method:"POST",body:{token:n,key:r},withCredentials:!1}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createCaptchaData",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r,i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.state,r=t.redirect_uri,i=void 0===r?void 0:r,e.abrupt("return",this.config.request(l.ApiUrls.CAPTCHA_DATA_URL,{method:"POST",body:{state:n,redirect_uri:i},withCredentials:!1}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMiniProgramCode",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.GET_MINIPROGRAM_QRCODE,{method:"POST",body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMiniProgramQrCodeStatus",value:function(){var e=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.request(l.ApiUrls.GET_MINIPROGRAM_QRCODE_STATUS,{method:"POST",body:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserBehaviorLog",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={LOGIN:"query[action]=USER_LOGIN",MODIFY:"ne_query[action]=USER_LOGIN"},r="".concat(l.ApiUrls.GET_USER_BEHAVIOR_LOG,"?").concat(n[t.type],"&limit=").concat(t.limit).concat(t.page_token?"&page_token=".concat(t.page_token):""),e.abrupt("return",this.config.request(r,{method:"GET",withCredentials:!0}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modifyPassword",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r,i,a,s,u;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n="",r="",i=y(!0,this.config.adapter),i){e.next=5;break}throw new Error("do not support encrypt, a encrypt util required.");case 5:return e.prev=5,e.next=8,this.getPublicKey();case 8:if(a=e.sent,n=a.public_key,r=a.public_key_thumbprint,n&&r){e.next=13;break}throw a;case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e["catch"](5),e.t0;case 18:return s=t.password?i.getEncryptInfo({publicKey:n,payload:t.password}):"",u=i.getEncryptInfo({publicKey:n,payload:t.new_password}),e.abrupt("return",this.config.request(l.ApiUrls.USER_BASIC_EDIT_URL,{method:"POST",withCredentials:!0,body:{user_id:t.user_id,encrypt_password:s,encrypt_new_password:u,public_key_thumbprint:r}}));case 21:case"end":return e.stop()}}),e,this,[[5,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"modifyPasswordWithoutLogin",value:function(){var e=(0,a.default)(o.default.mark((function e(t){var n,r,i,a,s,u;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n="",r="",i=y(!0,this.config.adapter),i){e.next=5;break}throw new Error("do not support encrypt, a encrypt util required.");case 5:return e.prev=5,e.next=8,this.getPublicKey();case 8:if(a=e.sent,n=a.public_key,r=a.public_key_thumbprint,n&&r){e.next=13;break}throw a;case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e["catch"](5),e.t0;case 18:return s=t.password?i.getEncryptInfo({publicKey:n,payload:t.password}):"",u=i.getEncryptInfo({publicKey:n,payload:t.new_password}),e.abrupt("return",this.config.request(l.ApiUrlsV2.AUTH_RESET_PASSWORD,{method:"POST",body:{username:t.username,password:s,new_password:u,public_key_thumbprint:r}}));case 21:case"end":return e.stop()}}),e,this,[[5,15]])})));return function(t){return e.apply(this,arguments)}}()}],[{key:"parseParamsToSearch",value:function(e){Object.keys(e).forEach((function(t){e[t]||delete e[t]}));var t=new h.default(e);return t.toString()}}]),t}();t.Auth=_}).call(this,n("f3b9")["default"])},4865:function(e,t,n){var r=n("78fe"),i=n("4bba"),o=n("0dcd"),a=o&&o.isSet,s=a?i(a):r;e.exports=s},"491d":function(e,t,n){"use strict";n.r(t);var r=n("a97f"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},4965:function(e,t){e.exports=function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"===typeof e}},e.exports.__esModule=!0,e.exports["default"]=e.exports},"49a0":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("127e")),o=r(n("ee10")),a=(getApp(),n("11ca")),s=a.cloudCall,u={data:function(){return{poemId:"",password:"",isLogging:!1}},computed:{canLogin:function(){return this.poemId.trim()&&this.password.trim()}},onLoad:function(){e("log","\ud83d\udd0d [\u767b\u5f55\u9875\u9762] \u9875\u9762\u52a0\u8f7d"," at pages/login/login.vue:69"),this.checkAndInitializeOpenid(),this.tryAutoRedirect()},methods:{tryAutoRedirect:function(){try{var t=uni.getStorageSync("userInfo"),n=uni.getStorageSync("userOpenId");if(t&&(t._openid||n)){var r=getApp();r.globalData=r.globalData||{},r.globalData.userInfo=t,r.globalData.openid=t._openid||n,r.globalData._loginProcessCompleted=!0,e("log","\u2705 [\u767b\u5f55\u9875\u9762] \u68c0\u6d4b\u5230\u5df2\u767b\u5f55\u7528\u6237\uff0c\u81ea\u52a8\u8df3\u8f6c"," at pages/login/login.vue:89"),uni.switchTab({url:"/pages/poem/poem"})}}catch(i){e("log","\u26a0\ufe0f [\u767b\u5f55\u9875\u9762] \u81ea\u52a8\u8df3\u8f6c\u68c0\u67e5\u5931\u8d25(\u5ffd\u7565)\uff1a",i," at pages/login/login.vue:93")}},checkAndInitializeOpenid:function(){e("log","\ud83d\udd0d [\u767b\u5f55\u9875\u9762] \u68c0\u67e5openid\u72b6\u6001"," at pages/login/login.vue:98");var t=getApp(),n=t&&t.globalData&&t.globalData.openid;n?e("log","\u2705 [\u767b\u5f55\u9875\u9762] openid\u5df2\u5b58\u5728:",t.globalData.openid," at pages/login/login.vue:107"):(e("log","\u26a0\ufe0f [\u767b\u5f55\u9875\u9762] \u672a\u68c0\u6d4b\u5230openid\uff0c\u5c1d\u8bd5\u91cd\u65b0\u521d\u59cb\u5316"," at pages/login/login.vue:104"),this.initializeAnonymousOpenid())},initializeAnonymousOpenid:function(){e("log","\ud83d\udd04 [\u767b\u5f55\u9875\u9762] \u521d\u59cb\u5316\u533f\u540dopenid"," at pages/login/login.vue:113"),this.$tcb&&this.$tcb.callFunction?this.$tcb.callFunction({name:"login"}).then((function(t){e("log","\u2705 [\u767b\u5f55\u9875\u9762] \u533f\u540dopenid\u521d\u59cb\u5316\u6210\u529f:",t," at pages/login/login.vue:120");var n=null;if(t.result&&t.result.openid?n=t.result.openid:t.openid?n=t.openid:t.result&&t.result.uid&&(n=t.result.uid),n){var r=getApp();r&&r.globalData&&(r.globalData.openid=n,e("log","\u2705 [\u767b\u5f55\u9875\u9762] \u533f\u540dopenid\u5df2\u8bbe\u7f6e:",n," at pages/login/login.vue:137")),uni.setStorageSync("userOpenId",n)}else e("error","\u274c [\u767b\u5f55\u9875\u9762] \u65e0\u6cd5\u83b7\u53d6\u533f\u540dopenid"," at pages/login/login.vue:143")})).catch((function(t){e("error","\u274c [\u767b\u5f55\u9875\u9762] \u533f\u540dopenid\u521d\u59cb\u5316\u5931\u8d25:",t," at pages/login/login.vue:146")})):e("error","\u274c [\u767b\u5f55\u9875\u9762] TCB\u5b9e\u4f8b\u4e0d\u53ef\u7528\uff0c\u65e0\u6cd5\u521d\u59cb\u5316openid"," at pages/login/login.vue:149")},callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(e,t,Object.assign({pageTag:"login",context:this},n))},onPoemIdInput:function(e){this.poemId=e.detail.value},onPasswordInput:function(e){this.password=e.detail.value},onLogin:function(){var t=this;return(0,o.default)(i.default.mark((function n(){var r,o,a,s,u,c,l;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.canLogin&&!t.isLogging){n.next=2;break}return n.abrupt("return");case 2:return t.isLogging=!0,uni.showLoading({title:"\u767b\u5f55\u4e2d...",mask:!0}),n.prev=4,n.next=7,t.callCloudFunction("loginWithCredentials",{poemId:t.poemId.trim(),password:t.password.trim()});case 7:r=n.sent,e("log","\ud83d\udd0d [\u767b\u5f55] \u4e91\u51fd\u6570\u8fd4\u56de\u7ed3\u679c:",r," at pages/login/login.vue:184"),r.result&&r.result.success?(o=r.result.userInfo,a=r.result.openid,e("log","\u2705 [\u767b\u5f55] \u767b\u5f55\u6210\u529f:",o," at pages/login/login.vue:191"),s=getApp(),u=Object.assign({},o||{},{_openid:a}),s.globalData.userInfo=u,s.globalData.openid=a,s.globalData._loginProcessCompleted=!0,uni.setStorageSync("userInfo",u),uni.setStorageSync("userOpenId",a),uni.showToast({title:"\u767b\u5f55\u6210\u529f",icon:"success"}),setTimeout((function(){uni.switchTab({url:"/pages/poem/poem"})}),1e3)):(l=(null===(c=r.result)||void 0===c?void 0:c.message)||"\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8d26\u53f7\u5bc6\u7801",uni.showToast({title:l,icon:"none",duration:3e3})),n.next=16;break;case 12:n.prev=12,n.t0=n["catch"](4),e("error","\u274c [\u767b\u5f55] \u767b\u5f55\u5931\u8d25:",n.t0," at pages/login/login.vue:228"),uni.showToast({title:"\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none",duration:3e3});case 16:return n.prev=16,uni.hideLoading(),t.isLogging=!1,n.finish(16);case 20:case"end":return n.stop()}}),n,null,[[4,12,16,20]])})))()},goToRegister:function(){uni.navigateTo({url:"/pages/register/register"})}}};t.default=u}).call(this,n("f3b9")["default"])},"49a1":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64_url_decode=a,t.weAtob=void 0,t.weBtoa=function(e){var t,n,i,o;e=String(e);for(var a="",s=0,u=e.length%3;s<e.length;){if((n=e.charCodeAt(s++))>255||(i=e.charCodeAt(s++))>255||(o=e.charCodeAt(s++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");t=n<<16|i<<8|o,a+=r.charAt(t>>18&63)+r.charAt(t>>12&63)+r.charAt(t>>6&63)+r.charAt(63&t)}return u?a.slice(0,u-3)+"===".substring(u):a},t.weappJwtDecode=function(e,t){if("string"!==typeof e)throw new Error("Invalid token specified");t=t||{};var n=!0===t.header?0:1;try{return JSON.parse(a(e.split(".")[n]))}catch(r){throw new Error(r.message)}};var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;var o=function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!i.test(e))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");var t;e+="==".slice(2-(3&e.length));for(var n,o,a="",s=0;s<e.length;)t=r.indexOf(e.charAt(s++))<<18|r.indexOf(e.charAt(s++))<<12|(n=r.indexOf(e.charAt(s++)))<<6|(o=r.indexOf(e.charAt(s++))),a+=64===n?String.fromCharCode(t>>16&255):64===o?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return a};function a(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Illegal base64url string!")}try{return function(e){return decodeURIComponent(o(e).replace(/(.)/g,(function(e){var t=e.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0".concat(t)),"%".concat(t)})))}(t)}catch(n){return o(t)}}t.weAtob=o},"4afd":function(e,t,n){"use strict";n.r(t);var r=n("aee9"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"4bba":function(e,t){e.exports=function(e){return function(t){return e(t)}}},"4d0d":function(e,t,n){var r=n("6e56"),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();e.exports=o},"4d97":function(e,t,n){"use strict";n.r(t);var r=n("9456"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"4da8":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("127e")),o=r(n("ee10")),a=(getApp(),n("8e86")),s=a.previewImage,u=n("fcd5"),c=u.normalizePostList,l=n("11ca"),d=l.cloudCall,f=n("2b90"),p=n("0efe"),h={mixins:[p,f],data:function(){return{likedPosts:[],swiperHeights:{},imageClampHeights:{},imgindex:0,img:""}},onLoad:function(e){this.initPagination(this.loadLikedPosts,{pageSize:5})},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(e,t,Object.assign({pageTag:"my-likes",context:this,requireAuth:!0},n))},loadLikedPosts:function(t){var n=this;return(0,o.default)(i.default.mark((function r(){var o,a,s,u,l,d,f,p;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.page,a=t.isRefresh,s=5*o,e("log","\u3010my-likes\u3011\u8bf7\u6c42\u5206\u9875\u53c2\u6570",{page:o,PAGE_SIZE:5,skip:s,limit:5}," at pages/my-likes/my-likes.vue:139"),a&&n.setData({swiperHeights:{},imageClampHeights:{}}),r.prev=4,r.next=7,n.callCloudFunction("getMyLikedPosts",{skip:s,limit:5});case 7:if(u=r.sent,u.result&&!0===u.result.success){r.next=14;break}throw l=u.result&&u.result.message||"\u6570\u636e\u52a0\u8f7d\u5931\u8d25",uni.showToast({title:l,icon:"none"}),d=new Error(l),d.__toastShown=!0,d;case 14:return f=c(u.result.posts||[]),e("log","\u3010my-likes\u3011\u672c\u6b21\u8fd4\u56de\u5e16\u5b50\u6570\u91cf:",f.length," at pages/my-likes/my-likes.vue:170"),p=0===o||a?f:n.likedPosts.concat(f),e("log","\u3010my-likes\u3011\u66f4\u65b0\u540e likedPosts \u957f\u5ea6:",p.length,"hasMore:",5===f.length,"page:",o+1," at pages/my-likes/my-likes.vue:172"),n.setData({likedPosts:p}),r.abrupt("return",{list:f,hasMore:5===f.length});case 22:throw r.prev=22,r.t0=r["catch"](4),e("error","Failed to fetch liked posts",r.t0," at pages/my-likes/my-likes.vue:182"),r.t0&&r.t0.__toastShown||uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"}),r.t0;case 27:case"end":return r.stop()}}),r,null,[[4,22]])})))()},navigateToPost:function(e){var t=e.currentTarget.dataset.id;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},handlePreview:function(t){var n=s(t);!1===n&&e("warn","\u3010my-likes\u3011\u56fe\u7247\u9884\u89c8\u5931\u8d25\uff0c\u7f3a\u5c11\u5fc5\u8981\u6570\u636e"," at pages/my-likes/my-likes.vue:204")},onImageError:function(t){e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",t," at pages/my-likes/my-likes.vue:210");var n=t.detail.src;e("error","\u5931\u8d25\u7684\u56fe\u7247URL:",n," at pages/my-likes/my-likes.vue:212");var r=t.currentTarget.dataset,i=r.postindex,o=r.imgindex;if(void 0!==i&&void 0!==o){var a=this.likedPosts[i];e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25\u7684\u4e0a\u4e0b\u6587:",{postId:a?a._id:"unknown",postTitle:a?a.title:"unknown",imageIndex:o,imageUrl:n}," at pages/my-likes/my-likes.vue:217")}e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25\u8be6\u60c5:",{error:t.detail,src:n,dataset:t.currentTarget.dataset}," at pages/my-likes/my-likes.vue:225")},onAvatarError:function(t){e("error","\u5934\u50cf\u52a0\u8f7d\u5931\u8d25",t," at pages/my-likes/my-likes.vue:233")}}};t.default=h}).call(this,n("f3b9")["default"])},"4dec":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("127e")),o=r(n("ee10")),a=n("4073"),s=(a.imageManager,n("11ca")),u=s.cloudCall,c={data:function(){return{currentPhase:"typing",showEnterButton:!1,showNewLineCursor:!1,textMoveUp:!1,preloadCompleted:!1,fullText:"poementer",typedText:"",preloadedImagePath:"",preloadProgress:0,isPreloading:!1,splashImageUrl:"/static/images/splash.png",fadeOut:!1,zoomOut:!1}},onLoad:function(){this.executeTypingAnimation(),this.loadSplashImage()},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u(e,t,Object.assign({pageTag:"splash",context:this},n))},executeTypingAnimation:function(){var e=this,t=this.fullText,n=0;(function r(){if(n<t.length){e.setData({typedText:e.typedText+t[n]}),n++;var i=e.getTypingDelay(n,t);setTimeout(r,i)}else setTimeout((function(){e.setData({showEnterButton:!0,textMoveUp:!0})}),500)})()},getTypingDelay:function(e,t){var n=t[e-1],r=t[e],i=100;return i=" "===n?200:"e"===n&&"n"===r?600:"m"===n&&"e"===r?400:"t"===n&&"e"===r?180:"e"===n&&"r"===r?160:120+100*Math.random(),i},handleEnterButtonClick:function(){uni.vibrateShort(),this.preloadCompleted?(this.setData({showEnterButton:!1,showNewLineCursor:!0}),this.blinkNewLineCursorAndNavigate()):uni.showToast({title:"\u6b63\u5728\u52a0\u8f7d\u4e2d...",icon:"loading",duration:1e3})},blinkNewLineCursorAndNavigate:function(){var e=this,t=0,n=setInterval((function(){t++,t>=2&&(clearInterval(n),setTimeout((function(){e.navigateToTarget()}),500))}),600)},loadSplashImage:function(){var t=this;return(0,o.default)(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e("log","\u4f7f\u7528\u9ed8\u8ba4\u672c\u5730\u5f00\u5c4f\u56fe"," at pages/splash/splash.vue:234"),t.setData({preloadedImagePath:"/static/images/splash.png"}),t.executeOriginalPreloadTasks();case 3:case"end":return n.stop()}}),n)})))()},executeOriginalPreloadTasks:function(){var t=this;return(0,o.default)(i.default.mark((function n(){var r,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=getApp(),o=[],r.globalData.userInfo&&r.globalData.openid&&(o.push(t.preloadTabIcons()),o.push(t.preloadPoemData()),o.push(t.preloadMountainData())),n.next=5,Promise.all(o);case 5:t.setData({preloadCompleted:!0}),e("log","\u9884\u52a0\u8f7d\u4efb\u52a1\u5b8c\u6210\uff0c\u7b49\u5f85\u7528\u6237\u70b9\u51fb\u8fdb\u5165\u6309\u94ae"," at pages/splash/splash.vue:268");case 7:case"end":return n.stop()}}),n)})))()},preloadPoemData:function(){var t=this;return new Promise(function(){var n=(0,o.default)(i.default.mark((function n(r,a){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.setData({isPreloading:!0}),t.callCloudFunction("getPostList",{skip:0,limit:5,isPoem:!0,isOriginal:!0}).then(function(){var n=(0,o.default)(i.default.mark((function n(o){var s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,!(o.result&&o.result.success&&o.result.posts)){n.next=9;break}if(s=getApp(),s.globalData.preloadedPoemData=o.result.posts,!(o.result.posts.length>0)){n.next=9;break}return e("log","\u8bd7\u6b4c\u6570\u636e\u83b7\u53d6\u6210\u529f\uff0c\u5f00\u59cb\u9884\u52a0\u8f7d\u76f8\u5173\u56fe\u7247..."," at pages/splash/splash.vue:290"),n.next=8,t.preloadFirstPostImages(o.result.posts[0]);case 8:e("log","\u76f8\u5173\u56fe\u7247\u9884\u52a0\u8f7d\u5b8c\u6210\uff01"," at pages/splash/splash.vue:293");case 9:r(),n.next=17;break;case 12:n.prev=12,n.t0=n["catch"](0),e("log","CatchClause",n.t0," at pages/splash/splash.vue:298"),e("log","CatchClause",n.t0," at pages/splash/splash.vue:299"),a(n.t0);case 17:case"end":return n.stop()}}),n,null,[[0,12]])})));return function(e){return n.apply(this,arguments)}}()).catch((function(t){e("error","\u8bd7\u6b4c\u6570\u636e\u9884\u52a0\u8f7d\u5931\u8d25:",t," at pages/splash/splash.vue:303"),a(t)})).finally((function(){e("log","\u8bd7\u6b4c\u6570\u636e\u9884\u52a0\u8f7d\u6d41\u7a0b\u7ed3\u675f"," at pages/splash/splash.vue:306"),t.setData({preloadProgress:100,isPreloading:!1})}));case 2:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())},preloadMountainData:function(){var t=this;return new Promise(function(){var n=(0,o.default)(i.default.mark((function n(r,a){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.callCloudFunction("getPostList",{skip:0,limit:5,isPoem:!0,isOriginal:!1}).then(function(){var n=(0,o.default)(i.default.mark((function n(o){var s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,!(o.result&&o.result.success&&o.result.posts)){n.next=9;break}if(s=getApp(),s.globalData.preloadedMountainData=o.result.posts,!(o.result.posts.length>0)){n.next=9;break}return e("log","\u5c71\u9875\u9762\u6570\u636e\u83b7\u53d6\u6210\u529f\uff0c\u5f00\u59cb\u9884\u52a0\u8f7d\u76f8\u5173\u56fe\u7247..."," at pages/splash/splash.vue:329"),n.next=8,t.preloadFirstMountainImages(o.result.posts[0]);case 8:e("log","\u5c71\u9875\u9762\u76f8\u5173\u56fe\u7247\u9884\u52a0\u8f7d\u5b8c\u6210\uff01"," at pages/splash/splash.vue:332");case 9:r(),n.next=17;break;case 12:n.prev=12,n.t0=n["catch"](0),e("log","CatchClause",n.t0," at pages/splash/splash.vue:337"),e("log","CatchClause",n.t0," at pages/splash/splash.vue:338"),a(n.t0);case 17:case"end":return n.stop()}}),n,null,[[0,12]])})));return function(e){return n.apply(this,arguments)}}()).catch((function(t){e("error","\u5c71\u9875\u9762\u6570\u636e\u9884\u52a0\u8f7d\u5931\u8d25:",t," at pages/splash/splash.vue:342"),a(t)}));case 1:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())},preloadFirstMountainImages:function(t){var n=getApp();n.globalData.preloadedImages||(n.globalData.preloadedImages={});var r=[],i=t.poemBgImage||t.imageUrls&&t.imageUrls[0];return i&&r.push(new Promise((function(t){var r="undefined"!==typeof window;if(r&&(i.includes("tcb.qcloud.la")||i.includes("cloudbase")))return e("log","\ud83d\udd0d [H5] \u5c71\u9875\u9762\u9996\u5f20\u80cc\u666f\u56fe\u68c0\u6d4b\u5230\u817e\u8baf\u4e91\u5b58\u50a8URL\uff0c\u76f4\u63a5\u4f7f\u7528:",i," at pages/splash/splash.vue:364"),n.globalData.preloadedImages[i]=i,void t();uni.downloadFile({url:i,success:function(t){200===t.statusCode&&(e("log","\u5c71\u9875\u9762\u9996\u5f20\u80cc\u666f\u56fe\u9884\u52a0\u8f7d\u6210\u529f:",t.tempFilePath," at pages/splash/splash.vue:374"),n.globalData.preloadedImages[i]=t.tempFilePath)},fail:function(t){e("error","\u5c71\u9875\u9762\u80cc\u666f\u56fe\u9884\u52a0\u8f7d\u5931\u8d25:",i,t," at pages/splash/splash.vue:379"),r&&(e("log","\ud83d\udd0d [H5] \u5c71\u9875\u9762\u80cc\u666f\u56fe\u9884\u52a0\u8f7d\u5931\u8d25\uff0c\u4f7f\u7528\u539fURL:",i," at pages/splash/splash.vue:382"),n.globalData.preloadedImages[i]=i)},complete:function(){t()}})}))),t.authorAvatar&&r.push(new Promise((function(r){uni.downloadFile({url:t.authorAvatar,success:function(r){200===r.statusCode&&(e("log","\u5c71\u9875\u9762\u4f5c\u8005\u5934\u50cf\u9884\u52a0\u8f7d\u6210\u529f"," at pages/splash/splash.vue:402"),n.globalData.preloadedImages[t.authorAvatar]=r.tempFilePath)},fail:function(n){e("error","\u5c71\u9875\u9762\u4f5c\u8005\u5934\u50cf\u9884\u52a0\u8f7d\u5931\u8d25:",t.authorAvatar,n," at pages/splash/splash.vue:407")},complete:function(){r()}})}))),Promise.all(r)},preloadTabIcons:function(){return new Promise((function(t){var n=["/static/images/icons/home.png","/static/images/icons/home-active.png","/static/images/icons/examples.png","/static/images/icons/examples-active.png","/static/images/icons/usercenter.png","/static/images/icons/usercenter-active.png"],r=0,i=n.length;0!==i?n.forEach((function(n){uni.getImageInfo({src:n,complete:function(){r++,r===i&&(e("log","\u6240\u6709Tab\u56fe\u6807\u9884\u52a0\u8f7d\u5c1d\u8bd5\u5b8c\u6bd5"," at pages/splash/splash.vue:442"),t())}})})):t()}))},preloadFirstPostImages:function(t){var n=getApp();n.globalData.preloadedImages||(n.globalData.preloadedImages={});var r=[],i=t.poemBgImage||t.imageUrls&&t.imageUrls[0];i&&r.push(new Promise((function(t){var r="undefined"!==typeof window;if(r&&(i.includes("tcb.qcloud.la")||i.includes("cloudbase")))return e("log","\ud83d\udd0d [H5] \u9996\u5f20\u80cc\u666f\u56fe\u68c0\u6d4b\u5230\u817e\u8baf\u4e91\u5b58\u50a8URL\uff0c\u76f4\u63a5\u4f7f\u7528:",i," at pages/splash/splash.vue:470"),n.globalData.preloadedImages[i]=i,void t();uni.downloadFile({url:i,success:function(t){200===t.statusCode&&(e("log","\u9996\u5f20\u80cc\u666f\u56fe\u9884\u52a0\u8f7d\u6210\u529f:",t.tempFilePath," at pages/splash/splash.vue:480"),n.globalData.preloadedImages[i]=t.tempFilePath)},fail:function(t){e("error","\u9996\u5f20\u80cc\u666f\u56fe\u9884\u52a0\u8f7d\u5931\u8d25:",i,t," at pages/splash/splash.vue:485"),r&&(e("log","\ud83d\udd0d [H5] \u9996\u5f20\u80cc\u666f\u56fe\u9884\u52a0\u8f7d\u5931\u8d25\uff0c\u4f7f\u7528\u539fURL:",i," at pages/splash/splash.vue:488"),n.globalData.preloadedImages[i]=i)},complete:function(){t()}})}))),t.authorAvatar&&r.push(new Promise((function(r){uni.downloadFile({url:t.authorAvatar,success:function(r){200===r.statusCode&&(e("log","\u4f5c\u8005\u5934\u50cf\u9884\u52a0\u8f7d\u6210\u529f"," at pages/splash/splash.vue:508"),n.globalData.preloadedImages[t.authorAvatar]=r.tempFilePath)},complete:function(){r()}})})));return["/static/images/like.png","/static/images/liked.png"].forEach((function(t){r.push(new Promise((function(n){uni.getImageInfo({src:t,complete:function(){e("log","\u901a\u7528\u56fe\u7247\u9884\u52a0\u8f7d\u5c1d\u8bd5\u5b8c\u6bd5:",t," at pages/splash/splash.vue:528"),n()}})})))})),Promise.all(r)},navigateToTarget:function(){this.startFadeOut(),setTimeout((function(){var e=getApp();e.globalData.userInfo&&e.globalData.openid?uni.switchTab({url:"/pages/poem/poem"}):uni.redirectTo({url:"/pages/login/login"})}),800)},startFadeOut:function(){this.setData({fadeOut:!0,zoomOut:!0})}}};t.default=c}).call(this,n("f3b9")["default"])},"4ec1":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[n("view",{staticClass:e._$s(1,"sc","container"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","title"),attrs:{_i:2}}),n("view",{staticClass:e._$s(3,"sc","subtitle"),attrs:{_i:3}}),n("view",{staticClass:e._$s(4,"sc","form-wrapper"),attrs:{_i:4}},[n("view",{staticClass:e._$s(5,"sc","input-wrapper"),attrs:{_i:5}},[n("text",{staticClass:e._$s(6,"sc","input-label"),attrs:{_i:6}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.poemId,expression:"poemId"}],staticClass:e._$s(7,"sc","input-field"),attrs:{_i:7},domProps:{value:e._$s(7,"v-model",e.poemId)},on:{input:[function(t){t.target.composing||(e.poemId=t.target.value)},e.onPoemIdInput]}})]),n("view",{staticClass:e._$s(8,"sc","input-wrapper"),attrs:{_i:8}},[n("text",{staticClass:e._$s(9,"sc","input-label"),attrs:{_i:9}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:e._$s(10,"sc","input-field"),attrs:{_i:10},domProps:{value:e._$s(10,"v-model",e.password)},on:{input:[function(t){t.target.composing||(e.password=t.target.value)},e.onPasswordInput]}})]),n("view",{staticClass:e._$s(11,"sc","input-wrapper"),attrs:{_i:11}},[n("text",{staticClass:e._$s(12,"sc","input-label"),attrs:{_i:12}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.confirmPassword,expression:"confirmPassword"}],staticClass:e._$s(13,"sc","input-field"),attrs:{_i:13},domProps:{value:e._$s(13,"v-model",e.confirmPassword)},on:{input:[function(t){t.target.composing||(e.confirmPassword=t.target.value)},e.onConfirmPasswordInput]}})]),n("view",{staticClass:e._$s(14,"sc","input-wrapper"),attrs:{_i:14}},[n("text",{staticClass:e._$s(15,"sc","input-label"),attrs:{_i:15}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.nickName,expression:"nickName"}],staticClass:e._$s(16,"sc","input-field"),attrs:{_i:16},domProps:{value:e._$s(16,"v-model",e.nickName)},on:{input:[function(t){t.target.composing||(e.nickName=t.target.value)},e.onNickNameInput]}})]),n("button",{staticClass:e._$s(17,"sc","register-button"),class:e._$s(17,"c",{loading:e.isRegistering}),attrs:{disabled:e._$s(17,"a-disabled",!e.canRegister||e.isRegistering),_i:17},on:{click:e.onRegister}},[e._v(e._$s(17,"t0-0",e._s(e.isRegistering?"\u6ce8\u518c\u4e2d...":"\u6ce8\u518c")))]),n("view",{staticClass:e._$s(18,"sc","login-link-wrapper"),attrs:{_i:18}},[n("text",{staticClass:e._$s(19,"sc","login-text"),attrs:{_i:19}}),n("text",{staticClass:e._$s(20,"sc","login-link"),attrs:{_i:20},on:{click:e.goToLogin}})])])])])},i=[]},"4ecf":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("127e")),o=r(n("ee10")),a={data:function(){return{globalData:{userInfo:null,openid:null}}},onLaunch:function(){uni.removeStorageSync("cachedPostList"),this.loginAndCheckUser(),this.globalData._loginProcessStarted=!0},methods:{loginAndCheckUser:function(){var t=this;return(0,o.default)(i.default.mark((function n(){var r,o,a,s,u,c,l,d,f,p,h,g,v,m;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.$tcb){n.next=3;break}return e("error","\u81f4\u547d\u9519\u8bef\uff1athis.$tcb \u672a\u5b9a\u4e49\uff01\u8bf7\u68c0\u67e5 main.js \u7684\u521d\u59cb\u5316\u4ee3\u7801\u662f\u5426\u6267\u884c\uff01"," at App.vue:33"),n.abrupt("return");case 3:if(r=uni.getStorageSync("userInfo"),!r||!r._openid){n.next=35;break}if(n.prev=5,o=t.$tcb.auth().currentUser,o){n.next=10;break}return n.next=10,t.$tcb.auth().signInAnonymously();case 10:return n.next=12,t.$tcb.callFunction({name:"getUserProfile",data:{userId:r._openid}});case 12:if(a=n.sent,!(a.result&&a.result.success&&a.result.userInfo)){n.next=26;break}return s=a.result.userInfo,t.globalData.userInfo=s,t.globalData.openid=s._openid,u=getApp(),u&&(u.globalData=u.globalData||{},u.globalData.userInfo=s,u.globalData.openid=s._openid,e("log","\u2705 [\u767b\u5f55\u6d41\u7a0b] getApp().globalData \u5df2\u66f4\u65b0:",u.globalData," at App.vue:67")),uni.setStorageSync("userInfo",s),t.globalData._loginProcessCompleted=!0,u&&(u.globalData._loginProcessCompleted=!0),e("log","\u2705 [\u767b\u5f55\u6d41\u7a0b] \u7f13\u5b58\u9a8c\u8bc1\u6210\u529f\uff0c\u7528\u6237\u5df2\u767b\u5f55"," at App.vue:80"),n.abrupt("return");case 26:e("log","\u26a0\ufe0f [\u767b\u5f55\u6d41\u7a0b] \u4e91\u7aef\u9a8c\u8bc1\u5931\u8d25\uff0c\u7528\u6237\u8d26\u6237\u4e0d\u5b58\u5728\uff0c\u5c06\u91cd\u65b0\u6ce8\u518c"," at App.vue:83"),uni.removeStorageSync("userInfo");case 28:n.next=35;break;case 30:n.prev=30,n.t0=n["catch"](5),e("error","\u274c [\u767b\u5f55\u6d41\u7a0b] \u4e91\u7aef\u9a8c\u8bc1\u5931\u8d25:",n.t0," at App.vue:89"),e("log","\u26a0\ufe0f [\u767b\u5f55\u6d41\u7a0b] \u9a8c\u8bc1\u5931\u8d25\uff0c\u5c06\u91cd\u65b0\u6ce8\u518c"," at App.vue:90"),uni.removeStorageSync("userInfo");case 35:if(e("log","\ud83e\udd14 [\u767b\u5f55\u6d41\u7a0b] \u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5f00\u59cb\u6267\u884c\u4e91\u7aef\u767b\u5f55..."," at App.vue:98"),n.prev=36,c=t.$tcb.auth().currentUser,c){n.next=46;break}return e("log","\ud83d\udd10 [\u8ba4\u8bc1] \u5c1d\u8bd5\u533f\u540d\u767b\u5f55..."," at App.vue:104"),n.next=42,t.$tcb.auth().signInAnonymously();case 42:l=n.sent,e("log","\u2705 [\u8ba4\u8bc1] \u533f\u540d\u767b\u5f55\u6210\u529f:",l," at App.vue:106"),n.next=47;break;case 46:e("log","\u2705 [\u8ba4\u8bc1] \u7528\u6237\u5df2\u767b\u5f55\uff0c\u8df3\u8fc7\u533f\u540d\u767b\u5f55"," at App.vue:108");case 47:return n.next=49,t.$tcb.callFunction({name:"login"});case 49:if(d=n.sent,e("log","\ud83d\udd0d [\u8c03\u8bd5] login\u4e91\u51fd\u6570\u5b8c\u6574\u8fd4\u56de\u6570\u636e:",d," at App.vue:117"),e("log","\ud83d\udd0d [\u8c03\u8bd5] loginRes.result:",d.result," at App.vue:118"),e("log","\ud83d\udd0d [\u8c03\u8bd5] loginRes.openid:",d.openid," at App.vue:119"),f=null,!d.result||!d.result.openid){n.next=59;break}f=d.result.openid,e("log","\u2705 [\u8c03\u8bd5] \u4eceresult.openid\u83b7\u53d6\u5230openid:",f," at App.vue:125"),n.next=72;break;case 59:if(!d.openid){n.next=64;break}f=d.openid,e("log","\u2705 [\u8c03\u8bd5] \u4ece\u6839\u7ea7\u522bopenid\u83b7\u53d6\u5230openid:",f," at App.vue:128"),n.next=72;break;case 64:if(!d.result||!d.result.uid){n.next=69;break}f=d.result.uid,e("log","\u2705 [\u8c03\u8bd5] \u4eceresult.uid\u83b7\u53d6\u5230openid:",f," at App.vue:131"),n.next=72;break;case 69:throw e("error","\u274c [\u767b\u5f55\u6d41\u7a0b] \u65e0\u6cd5\u4ecelogin\u4e91\u51fd\u6570\u8fd4\u56de\u6570\u636e\u4e2d\u83b7\u53d6openid"," at App.vue:133"),e("error","\u274c [\u767b\u5f55\u6d41\u7a0b] \u5b8c\u6574\u8fd4\u56de\u6570\u636e:",JSON.stringify(d,null,2)," at App.vue:134"),new Error("\u4e91\u51fd\u6570 login \u672a\u8fd4\u56de openid");case 72:return e("log","\u2705 [\u4e91\u51fd\u6570 login] \u8c03\u7528\u6210\u529f, openid: ",f," at App.vue:137"),t.globalData.openid=f,uni.setStorageSync("userOpenId",f),p=t.$tcb.database(),n.next=78,p.collection("users").where({_openid:f}).get();case 78:h=n.sent,h.data.length>0?(g=h.data[0],e("log","\u2705 [\u6570\u636e\u5e93\u67e5\u8be2] \u7528\u6237\u5df2\u6ce8\u518c, \u767b\u5f55\u6210\u529f: ",g," at App.vue:151"),t.globalData.userInfo=g,uni.setStorageSync("userInfo",g)):(e("log","\ud83e\udd14 [\u6570\u636e\u5e93\u67e5\u8be2] \u65b0\u7528\u6237\uff0c\u5c1a\u672a\u6ce8\u518c"," at App.vue:156"),t.globalData.userInfo=null),v=getApp(),v&&(v.globalData=v.globalData||{},v.globalData.userInfo=t.globalData.userInfo,v.globalData.openid=t.globalData.openid,v.globalData._loginProcessCompleted=!0,e("log","\u2705 [\u767b\u5f55\u6d41\u7a0b] getApp().globalData \u5df2\u66f4\u65b0:",v.globalData," at App.vue:167")),n.next=89;break;case 84:n.prev=84,n.t1=n["catch"](36),m=getApp(),m&&(m.globalData=m.globalData||{},m.globalData._loginProcessCompleted=!0),uni.showToast({icon:"none",title:"\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"});case 89:case"end":return n.stop()}}),n,null,[[5,30],[36,84]])})))()}}};t.default=a}).call(this,n("f3b9")["default"])},"4ff6":function(e,t,n){var r=n("f78b"),i=n("b9ef"),o=n("7952"),a=n("446a"),s=n("676a");function u(e){var t=-1,n=null==e?0:e.length;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype["delete"]=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},"4ffb":function(e,t,n){var r=n("3b2d")["default"],i=n("3352");e.exports=function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports["default"]=e.exports},"506b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.escape2Html=function(e){if(!e)return e;var t={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return e.replace(/&(lt|gt|nbsp|amp|quot);/gi,(function(e,n){return t[n]}))},t.html2Escape=function(e){return e?e.replace(/[<>&"]/g,(function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]})):e}},"50f3":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={skeleton:n("8cb3").default},i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[n("view",{staticClass:e._$s(1,"sc","container"),attrs:{_i:1}},[e._$s(2,"i",e.isLoading)?n("view",{attrs:{_i:2}},[n("skeleton",{attrs:{_i:3}})],1):e._e(),n("scroll-view",{staticClass:e._$s(4,"sc","scroll-container"),attrs:{_i:4},on:{scrolltolower:e.onScrollToLower}},[e._$s(5,"i",e.isSidebarOpen)?n("view",{staticClass:e._$s(5,"sc","sidebar-mask"),attrs:{_i:5},on:{click:e.toggleSidebar}}):e._e(),n("view",{class:e._$s(6,"c","sidebar "+(e.isSidebarOpen?"open":"")),attrs:{_i:6}},[n("view",{staticClass:e._$s(7,"sc","sidebar-header"),attrs:{_i:7}},[n("image",{staticClass:e._$s(8,"sc","sidebar-avatar"),attrs:{src:e._$s(8,"a-src",e.userInfo.avatarUrl||"/static/images/avatar.png"),_i:8},on:{error:e.onAvatarError}}),n("text",{staticClass:e._$s(9,"sc","sidebar-nickname"),attrs:{_i:9}},[e._v(e._$s(9,"t0-0",e._s(e.userInfo.nickName||"\u5fae\u4fe1\u7528\u6237")))])]),n("view",{staticClass:e._$s(10,"sc","sidebar-menu"),attrs:{_i:10}},[n("view",{staticClass:e._$s(11,"sc","sidebar-item"),attrs:{_i:11},on:{click:e.navigateToEditProfile}},[n("text")]),e._$s(13,"i",e.isAdmin)?n("view",{staticClass:e._$s(13,"sc","sidebar-item"),attrs:{_i:13},on:{click:e.navigateToImageManager}},[n("text")]):e._e(),n("view",{staticClass:e._$s(15,"sc","sidebar-item"),attrs:{_i:15},on:{click:e.navigateToMessages}},[n("text"),e._$s(17,"i",e.unreadCount>0)?n("view",{staticClass:e._$s(17,"sc","unread-badge"),attrs:{_i:17}},[e._v(e._$s(17,"t0-0",e._s(e.unreadCount)))]):e._e()]),n("view",{staticClass:e._$s(18,"sc","sidebar-item"),attrs:{_i:18},on:{click:e.navigateToMyLikes}},[n("text")]),n("view",{staticClass:e._$s(20,"sc","sidebar-item"),attrs:{_i:20},on:{click:e.navigateToFollowing}},[n("text")]),n("view",{staticClass:e._$s(22,"sc","sidebar-item"),attrs:{_i:22},on:{click:e.navigateToFans}},[n("text"),e._$s(24,"i",e.newFollowerCount>0)?n("view",{staticClass:e._$s(24,"sc","unread-dot"),attrs:{_i:24}}):e._e()]),n("view",{staticClass:e._$s(25,"sc","sidebar-item"),attrs:{_i:25},on:{click:e.navigateToFavoriteFolders}},[n("text")]),n("view",{staticClass:e._$s(27,"sc","sidebar-item"),attrs:{_i:27},on:{click:e.navigateToDraftBox}},[n("text")]),n("view",{staticClass:e._$s(29,"sc","sidebar-item"),attrs:{_i:29},on:{click:e.navigateToFeedback}},[n("text")]),e._$s(31,"i",e.isAdmin)?n("view",{staticClass:e._$s(31,"sc","sidebar-item"),attrs:{_i:31},on:{click:e.navigateToFeedbackAdmin}},[n("text")]):e._e(),n("view",{staticClass:e._$s(33,"sc","sidebar-item logout-item"),attrs:{_i:33},on:{click:e.showLogoutConfirm}},[n("text")])])]),n("view",{staticClass:e._$s(35,"sc","main-content"),attrs:{_i:35}},[n("view",{staticClass:e._$s(36,"sc","profile-card profile-card-center"),attrs:{_i:36}},[n("image",{staticClass:e._$s(37,"sc","menu-btn-large"),attrs:{_i:37},on:{click:e.toggleSidebar}}),n("view",{staticClass:e._$s(38,"sc","profile-avatar-large"),attrs:{_i:38}},[n("image",{attrs:{src:e._$s(39,"a-src",e.userInfo.avatarUrl||"/static/images/avatar.png"),_i:39},on:{error:e.onAvatarError}})]),n("view",{staticClass:e._$s(40,"sc","profile-info-center"),attrs:{_i:40}},[n("text",{staticClass:e._$s(41,"sc","profile-name-center"),attrs:{_i:41}},[e._v(e._$s(41,"t0-0",e._s(e.userInfo.nickName||"\u5fae\u4fe1\u7528\u6237")))]),n("text",{staticClass:e._$s(42,"sc","profile-bio-center"),attrs:{_i:42}},[e._v(e._$s(42,"t0-0",e._s(e.userInfo.bio||"\u8fd9\u4e2a\u7528\u6237\u5f88\u61d2,\u4ec0\u4e48\u90fd\u6ca1\u7559\u4e0b...")))])])]),e._$s(43,"i",e.isViewingSelf)?n("view",{staticClass:e._$s(43,"sc","profile-detail-card"),attrs:{_i:43}},[n("text",{staticClass:e._$s(44,"sc","detail-item-inline"),attrs:{_i:44}},[e._v(e._$s(44,"t0-0",e._s(e.userInfo.birthday?e.userInfo.birthday:"\u672a\u8bbe\u7f6e")))]),n("text",{staticClass:e._$s(45,"sc","detail-item-inline"),attrs:{_i:45}},[e._v(e._$s(45,"t0-0",e._s(e.userInfo.age?e.userInfo.age+"\u5c81":"\u672a\u77e5")))])]):e._e(),n("view",{staticClass:e._$s(46,"sc","tab-navigation"),attrs:{_i:46}},[n("view",{class:e._$s(47,"c","tab-item "+("posts"===e.currentTab?"active":"")),attrs:{_i:47},on:{click:e.switchTab}},[n("text")]),n("view",{class:e._$s(49,"c","tab-item "+("favorites"===e.currentTab?"active":"")),attrs:{_i:49},on:{click:e.switchTab}},[n("text")])]),e._$s(51,"i","posts"===e.currentTab)?n("view",{staticClass:e._$s(51,"sc","my-posts-section"),attrs:{_i:51}},[e._$s(52,"i",e.myPosts.length>0)?[e._l(e._$s(53,"f",{forItems:e.myPosts}),(function(t,r,i,o){return n("view",{key:e._$s(53,"f",{forIndex:i,key:r}),class:e._$s("53-"+o,"c","post-item-wrapper "+(t.isOriginal?"original-post":"")),attrs:{_i:"53-"+o}},[n("view",{staticClass:e._$s("54-"+o,"sc","author-info-outside"),attrs:{_i:"54-"+o}},[e._$s("55-"+o,"i",t.authorAvatar)?n("image",{staticClass:e._$s("55-"+o,"sc","author-avatar"),attrs:{src:e._$s("55-"+o,"a-src",t.authorAvatar),"data-postindex":e._$s("55-"+o,"a-data-postindex",r),"data-user-id":e._$s("55-"+o,"a-data-user-id",t._openid),_i:"55-"+o},on:{error:e.onAvatarError,load:e.onAvatarLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.navigateToUserProfile(t)}}}):e._e(),n("text",{staticClass:e._$s("56-"+o,"sc","author-name"),attrs:{_i:"56-"+o}},[e._v(e._$s("56-"+o,"t0-0",e._s(t.authorName)))])]),n("navigator",{staticClass:e._$s("57-"+o,"sc","post-content-navigator"),attrs:{url:e._$s("57-"+o,"a-url","/pages/post-detail/post-detail?id="+t._id),_i:"57-"+o}},[n("view",{staticClass:e._$s("58-"+o,"sc","post-item"),attrs:{_i:"58-"+o}},[n("view",{staticClass:e._$s("59-"+o,"sc","post-title"),attrs:{_i:"59-"+o}},[e._v(e._$s("59-"+o,"t0-0",e._s(t.title)))]),e._$s("60-"+o,"i",t.isPoem&&t.author)?n("view",{staticClass:e._$s("60-"+o,"sc","poem-author"),attrs:{_i:"60-"+o}},[e._v(e._$s("60-"+o,"t0-0",e._s(t.author)))]):e._e(),e._$s("61-"+o,"i",t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("61-"+o,"sc","image-container-wrapper"),style:e._$s("61-"+o,"s",t.imageStyle),attrs:{"data-src":e._$s("61-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("61-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"61-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}},[e._$s("62-"+o,"i",1===t.imageUrls.length)?[n("image",{staticClass:e._$s("63-"+o,"sc","post-image"),attrs:{id:e._$s("63-"+o,"a-id","single-image-"+t._id),src:e._$s("63-"+o,"a-src",t.imageUrls[0]),"data-postid":e._$s("63-"+o,"a-data-postid",t._id),"data-postindex":e._$s("63-"+o,"a-data-postindex",r),_i:"63-"+o},on:{error:e.onImageError,load:e.onImageLoad}})]:e._$s("64-"+o,"e",t.imageUrls.length>1)?[n("swiper",{staticClass:e._$s("65-"+o,"sc","image-swiper"),style:e._$s("65-"+o,"s","height: "+(e.swiperHeights[r]?e.swiperHeights[r]+"px":"220px")+";"),attrs:{id:e._$s("65-"+o,"a-id","swiper-"+t._id),_i:"65-"+o}},[e._l(e._$s("66-"+o,"f",{forItems:t.imageUrls}),(function(i,a,s,u){return[n("swiper-item",{key:e._$s("66-"+o,"f",{forIndex:s,keyIndex:0,key:a+"_0"})},[n("image",{staticClass:e._$s("68-"+o+"-"+u,"sc","post-image"),attrs:{src:e._$s("68-"+o+"-"+u,"a-src",i),"data-src":e._$s("68-"+o+"-"+u,"a-data-src",i),"data-original-image-urls":e._$s("68-"+o+"-"+u,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),"data-postid":e._$s("68-"+o+"-"+u,"a-data-postid",t._id),"data-postindex":e._$s("68-"+o+"-"+u,"a-data-postindex",r),"data-imgindex":e._$s("68-"+o+"-"+u,"a-data-imgindex",a),_i:"68-"+o+"-"+u},on:{error:e.onImageError,load:e.onImageLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._e()],2):e._e(),e._$s("69-"+o,"i",t.content)?n("view",{staticClass:e._$s("69-"+o,"sc","post-content"),attrs:{_i:"69-"+o}},[e._v(e._$s("69-"+o,"t0-0",e._s(t.content)))]):e._e(),e._$s("70-"+o,"i",t.tags&&t.tags.length>0)?n("view",{staticClass:e._$s("70-"+o,"sc","post-tags"),attrs:{_i:"70-"+o}},e._l(e._$s("71-"+o,"f",{forItems:t.tags}),(function(t,r,i,a){return n("text",{key:e._$s("71-"+o,"f",{forIndex:i,key:r}),staticClass:e._$s("71-"+o+"-"+a,"sc","post-tag"),attrs:{"data-tag":e._$s("71-"+o+"-"+a,"a-data-tag",t),_i:"71-"+o+"-"+a},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onTagClick(t)}}},[e._v(e._$s("71-"+o+"-"+a,"t0-0",e._s(t)))])})),0):e._e()])]),n("view",{staticClass:e._$s("72-"+o,"sc","delete-section"),attrs:{_i:"72-"+o}},[n("view",{staticClass:e._$s("73-"+o,"sc","time-left"),attrs:{_i:"73-"+o}},[n("text",{staticClass:e._$s("74-"+o,"sc","post-time"),attrs:{_i:"74-"+o}},[e._v(e._$s("74-"+o,"t0-0",e._s(t.formattedCreateTime||"\u672a\u77e5\u65f6\u95f4")))])]),n("view",{staticClass:e._$s("75-"+o,"sc","button-group"),attrs:{_i:"75-"+o}},[n("button",{staticClass:e._$s("76-"+o,"sc","delete-btn"),attrs:{"data-postid":e._$s("76-"+o,"a-data-postid",t._id),"data-index":e._$s("76-"+o,"a-data-index",r),_i:"76-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onDelete(t)}}})])])])})),n("view",{staticClass:e._$s(77,"sc","loading-footer"),attrs:{_i:77}},[e._$s(78,"i",e.isLoadingMore)||e._$s(80,"e",!e.hasMore&&e.myPosts.length>0)?[n("text")]:e._e()],2),n("view")]:n("view",{staticClass:e._$s(83,"sc","empty-tip"),attrs:{_i:83}},[n("text")])],2):e._e(),e._$s(85,"i","favorites"===e.currentTab)?n("view",{staticClass:e._$s(85,"sc","favorites-section"),attrs:{_i:85}},[e._$s(86,"i",e.favoriteList.length>0)?[e._l(e._$s(87,"f",{forItems:e.favoriteList}),(function(t,r,i,o){return n("view",{key:e._$s(87,"f",{forIndex:i,key:r}),class:e._$s("87-"+o,"c","post-item-wrapper "+(t.isOriginal?"original-post":"")),attrs:{_i:"87-"+o}},[n("view",{staticClass:e._$s("88-"+o,"sc","author-info-outside"),attrs:{_i:"88-"+o}},[e._$s("89-"+o,"i",t.authorAvatar)?n("image",{staticClass:e._$s("89-"+o,"sc","author-avatar"),attrs:{src:e._$s("89-"+o,"a-src",t.authorAvatar),"data-postindex":e._$s("89-"+o,"a-data-postindex",r),"data-user-id":e._$s("89-"+o,"a-data-user-id",t._openid),_i:"89-"+o},on:{error:e.onAvatarError,load:e.onAvatarLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.navigateToUserProfile(t)}}}):e._e(),n("text",{staticClass:e._$s("90-"+o,"sc","author-name"),attrs:{_i:"90-"+o}},[e._v(e._$s("90-"+o,"t0-0",e._s(t.authorName)))])]),n("navigator",{staticClass:e._$s("91-"+o,"sc","post-content-navigator"),attrs:{url:e._$s("91-"+o,"a-url","/pages/post-detail/post-detail?id="+t._id),_i:"91-"+o}},[n("view",{staticClass:e._$s("92-"+o,"sc","post-item"),attrs:{_i:"92-"+o}},[n("view",{staticClass:e._$s("93-"+o,"sc","post-title"),attrs:{_i:"93-"+o}},[e._v(e._$s("93-"+o,"t0-0",e._s(t.title)))]),e._$s("94-"+o,"i",t.isPoem&&t.author)?n("view",{staticClass:e._$s("94-"+o,"sc","poem-author"),attrs:{_i:"94-"+o}},[e._v(e._$s("94-"+o,"t0-0",e._s(t.author)))]):e._e(),e._$s("95-"+o,"i",t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("95-"+o,"sc","image-container-wrapper"),style:e._$s("95-"+o,"s",t.imageStyle),attrs:{"data-src":e._$s("95-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("95-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"95-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}},[e._$s("96-"+o,"i",1===t.imageUrls.length)?[n("image",{staticClass:e._$s("97-"+o,"sc","post-image"),attrs:{id:e._$s("97-"+o,"a-id","single-image-"+t._id),src:e._$s("97-"+o,"a-src",t.imageUrls[0]),"data-postid":e._$s("97-"+o,"a-data-postid",t._id),"data-postindex":e._$s("97-"+o,"a-data-postindex",r),_i:"97-"+o},on:{error:e.onImageError,load:e.onImageLoad}})]:e._$s("98-"+o,"e",t.imageUrls.length>1)?[n("swiper",{staticClass:e._$s("99-"+o,"sc","image-swiper"),style:e._$s("99-"+o,"s","height: "+(e.swiperHeights[r]?e.swiperHeights[r]+"px":"220px")+";"),attrs:{id:e._$s("99-"+o,"a-id","swiper-"+t._id),_i:"99-"+o}},[e._l(e._$s("100-"+o,"f",{forItems:t.imageUrls}),(function(i,a,s,u){return[n("swiper-item",{key:e._$s("100-"+o,"f",{forIndex:s,keyIndex:0,key:a+"_0"})},[n("image",{staticClass:e._$s("102-"+o+"-"+u,"sc","post-image"),attrs:{src:e._$s("102-"+o+"-"+u,"a-src",i),"data-src":e._$s("102-"+o+"-"+u,"a-data-src",i),"data-original-image-urls":e._$s("102-"+o+"-"+u,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),"data-postid":e._$s("102-"+o+"-"+u,"a-data-postid",t._id),"data-postindex":e._$s("102-"+o+"-"+u,"a-data-postindex",r),"data-imgindex":e._$s("102-"+o+"-"+u,"a-data-imgindex",a),_i:"102-"+o+"-"+u},on:{error:e.onImageError,load:e.onImageLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._e()],2):e._e(),e._$s("103-"+o,"i",t.content)?n("view",{staticClass:e._$s("103-"+o,"sc","post-content"),attrs:{_i:"103-"+o}},[e._v(e._$s("103-"+o,"t0-0",e._s(t.content)))]):e._e(),e._$s("104-"+o,"i",t.tags&&t.tags.length>0)?n("view",{staticClass:e._$s("104-"+o,"sc","post-tags"),attrs:{_i:"104-"+o}},e._l(e._$s("105-"+o,"f",{forItems:t.tags}),(function(t,r,i,a){return n("text",{key:e._$s("105-"+o,"f",{forIndex:i,key:r}),staticClass:e._$s("105-"+o+"-"+a,"sc","post-tag"),attrs:{"data-tag":e._$s("105-"+o+"-"+a,"a-data-tag",t),_i:"105-"+o+"-"+a},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onTagClick(t)}}},[e._v(e._$s("105-"+o+"-"+a,"t0-0",e._s(t)))])})),0):e._e()])]),n("view",{staticClass:e._$s("106-"+o,"sc","delete-section"),attrs:{_i:"106-"+o}},[n("view",{staticClass:e._$s("107-"+o,"sc","time-left"),attrs:{_i:"107-"+o}},[n("text",{staticClass:e._$s("108-"+o,"sc","favorite-time"),attrs:{_i:"108-"+o}},[e._v(e._$s("108-"+o,"t0-0",e._s(t.formattedFavoriteTime||"\u672a\u77e5\u65f6\u95f4")))])]),n("view",{staticClass:e._$s("109-"+o,"sc","button-group"),attrs:{_i:"109-"+o}},[n("button",{staticClass:e._$s("110-"+o,"sc","remove-favorite-btn"),attrs:{"data-favorite-id":e._$s("110-"+o,"a-data-favorite-id",t.favoriteId),"data-index":e._$s("110-"+o,"a-data-index",r),_i:"110-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.removeFavorite(t)}}})])])])})),n("view",{staticClass:e._$s(111,"sc","loading-footer"),attrs:{_i:111}},[e._$s(112,"i",e.favoriteLoading)||e._$s(114,"e",!e.favoriteHasMore&&e.favoriteList.length>0)?[n("text")]:e._e()],2),n("view")]:n("view",{staticClass:e._$s(117,"sc","empty-tip"),attrs:{_i:117}},[n("text")])],2):e._e()])])])])},o=[]},"511c":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.WebRequest=void 0,t.genAdapter=function(){var e={type:"default",root:window,reqClass:l,wsClass:WebSocket,localStorage:localStorage};return e};var r=n("59ad"),i=n("6e68"),o=n("c785"),a=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)},u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},c=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},l=function(t){function n(e){var n=t.call(this)||this,r=e.timeout,i=e.timeoutMsg,o=e.restrictedMethods;return n.timeout=r||0,n.timeoutMsg=i||"\u8bf7\u6c42\u8d85\u65f6",n.restrictedMethods=o||["get","post","upload","download"],n}return a(n,t),n.prototype.get=function(e){return this.request(s(s({},e),{method:"get"}),this.restrictedMethods.includes("get"))},n.prototype.post=function(e){return this.request(s(s({},e),{method:"post"}),this.restrictedMethods.includes("post"))},n.prototype.put=function(e){return this.request(s(s({},e),{method:"put"}))},n.prototype.upload=function(e){var t=e.data,n=e.file,r=e.name,i=e.method,o=e.headers,a=void 0===o?{}:o,u={post:"post",put:"put"}[null===i||void 0===i?void 0:i.toLowerCase()]||"put",c=new FormData;return"post"===u?(Object.keys(t).forEach((function(e){c.append(e,t[e])})),c.append("key",r),c.append("file",n),this.request(s(s({},e),{data:c,method:u}),this.restrictedMethods.includes("upload"))):this.request(s(s({},e),{method:"put",headers:a,body:n}),this.restrictedMethods.includes("upload"))},n.prototype.download=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i;return c(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.get(s(s({},e),{headers:{},responseType:"blob"}))];case 1:return t=o.sent().data,n=window.URL.createObjectURL(new Blob([t])),r=decodeURIComponent(new URL(e.url).pathname.split("/").pop()||""),i=document.createElement("a"),i.href=n,i.setAttribute("download",r),i.style.display="none",document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(n),document.body.removeChild(i),[3,3];case 2:return o.sent(),[3,3];case 3:return[2,new Promise((function(t){t({statusCode:200,tempFilePath:e.url})}))]}}))}))},n.prototype.fetch=function(t){var n;return u(this,void 0,void 0,(function(){var r,i,o,a,l,d,f,p,h,g,v,m=this;return c(this,(function(y){switch(y.label){case 0:return r=new AbortController,i=t.url,o=t.enableAbort,a=void 0!==o&&o,l=t.stream,d=void 0!==l&&l,f=t.signal,p=t.timeout,h=null!==p&&void 0!==p?p:this.timeout,f&&(f.aborted&&r.abort(),f.addEventListener("abort",(function(){return r.abort()}))),g=null,a&&h&&(g=setTimeout((function(){e("warn",m.timeoutMsg," at node_modules/@cloudbase/utilities/dist/esm/adapters/platforms/web.js:152"),r.abort(new Error(m.timeoutMsg))}),h)),[4,fetch(i,s(s({},t),{signal:r.signal})).then((function(e){return u(m,void 0,void 0,(function(){var t,n,r;return c(this,(function(i){switch(i.label){case 0:return clearTimeout(g),e.ok?(t=e,[3,3]):[3,1];case 1:return r=(n=Promise).reject,[4,e.json()];case 2:t=r.apply(n,[i.sent()]),i.label=3;case 3:return[2,t]}}))}))})).catch((function(e){return clearTimeout(g),Promise.reject(e)}))];case 1:return v=y.sent(),[2,{data:d?v.body:(null===(n=v.headers.get("content-type"))||void 0===n?void 0:n.includes("application/json"))?v.json():v.text(),statusCode:v.status,header:v.headers}]}}))}))},n.prototype.request=function(t,n){var r=this;void 0===n&&(n=!1);var a=String(t.method).toLowerCase()||"get";return new Promise((function(s){var u,c,l=t.url,d=t.headers,f=void 0===d?{}:d,p=t.data,h=t.responseType,g=t.withCredentials,v=t.body,m=t.onUploadProgress,y=(0,i.formatUrl)((0,o.getProtocol)(),l,"get"===a?p:{}),_=new XMLHttpRequest;_.open(a,y),h&&(_.responseType=h),Object.keys(f).forEach((function(e){_.setRequestHeader(e,f[e])})),m&&_.upload.addEventListener("progress",m),_.onreadystatechange=function(){var e={};if(4===_.readyState){var t=_.getAllResponseHeaders(),n=t.trim().split(/[\r\n]+/),r={};n.forEach((function(e){var t=e.split(": "),n=t.shift().toLowerCase(),i=t.join(": ");r[n]=i})),e.header=r,e.statusCode=_.status;try{e.data="blob"===h?_.response:JSON.parse(_.responseText)}catch(i){e.data="blob"===h?_.response:_.responseText}clearTimeout(u),s(e)}},n&&r.timeout&&(u=setTimeout((function(){e("warn",r.timeoutMsg," at node_modules/@cloudbase/utilities/dist/esm/adapters/platforms/web.js:234"),_.abort()}),r.timeout)),c=(0,i.isFormData)(p)?p:"application/x-www-form-urlencoded"===f["content-type"]?(0,i.toQueryString)(p):v||(p?JSON.stringify(p):void 0),g&&(_.withCredentials=!0),_.send(c)}))},n}(r.AbstractSDKRequest);t.WebRequest=l}).call(this,n("f3b9")["default"])},"513b":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:e._$s(1,"sc","header"),attrs:{_i:1}},[n("text",{staticClass:e._$s(2,"sc","title"),attrs:{_i:2}}),n("text",{staticClass:e._$s(3,"sc","subtitle"),attrs:{_i:3}})]),n("view",{staticClass:e._$s(4,"sc","section"),attrs:{_i:4}},[n("view",{staticClass:e._$s(5,"sc","section-title"),attrs:{_i:5}}),n("view",{staticClass:e._$s(6,"sc","upload-area"),attrs:{_i:6},on:{click:e.chooseSplashImage}},[n("view",{staticClass:e._$s(7,"sc","upload-content"),attrs:{_i:7}},[n("text",{staticClass:e._$s(8,"sc","upload-icon"),attrs:{_i:8}}),n("text",{staticClass:e._$s(9,"sc","upload-text"),attrs:{_i:9}}),n("text",{staticClass:e._$s(10,"sc","upload-hint"),attrs:{_i:10}})])]),e._$s(11,"i",e.splashPreview)?n("view",{staticClass:e._$s(11,"sc","preview-area"),attrs:{_i:11}},[n("text",{staticClass:e._$s(12,"sc","preview-title"),attrs:{_i:12}}),n("image",{staticClass:e._$s(13,"sc","preview-image"),attrs:{src:e._$s(13,"a-src",e.splashPreview),_i:13}}),n("view",{staticClass:e._$s(14,"sc","button-group"),attrs:{_i:14}},[n("button",{staticClass:e._$s(15,"sc","btn btn-primary"),attrs:{loading:e._$s(15,"a-loading",e.uploading),_i:15},on:{click:e.uploadSplashImage}},[e._v(e._$s(15,"t0-0",e._s(e.uploading?"\u4e0a\u4f20\u4e2d...":"\u786e\u8ba4\u4e0a\u4f20")))]),n("button",{staticClass:e._$s(16,"sc","btn btn-secondary"),attrs:{_i:16},on:{click:e.clearSplashPreview}})])]):e._e()]),e._$s(17,"i",e.imageHistory.length>0)?n("view",{staticClass:e._$s(17,"sc","section"),attrs:{_i:17}},[n("view",{staticClass:e._$s(18,"sc","section-title"),attrs:{_i:18}}),n("view",{staticClass:e._$s(19,"sc","history-list"),attrs:{_i:19}},e._l(e._$s(20,"f",{forItems:e.imageHistory}),(function(t,r,i,o){return n("view",{key:e._$s(20,"f",{forIndex:i,key:r}),staticClass:e._$s("20-"+o,"sc","history-item"),attrs:{_i:"20-"+o}},[n("image",{staticClass:e._$s("21-"+o,"sc","history-thumb"),attrs:{src:e._$s("21-"+o,"a-src",t.tempUrl),_i:"21-"+o}}),n("view",{staticClass:e._$s("22-"+o,"sc","history-info"),attrs:{_i:"22-"+o}},[n("text",{staticClass:e._$s("23-"+o,"sc","history-name"),attrs:{_i:"23-"+o}},[e._v(e._$s("23-"+o,"t0-0",e._s(t.metadata.name||"\u672a\u547d\u540d")))]),n("text",{staticClass:e._$s("24-"+o,"sc","history-time"),attrs:{_i:"24-"+o}},[e._v(e._$s("24-"+o,"t0-0",e._s(e.formatTime(t.uploadTime))))]),n("text",{staticClass:e._$s("25-"+o,"sc","history-category"),attrs:{_i:"25-"+o}},[e._v(e._$s("25-"+o,"t0-0",e._s(t.category)))])]),n("view",{staticClass:e._$s("26-"+o,"sc","history-actions"),attrs:{_i:"26-"+o}},[n("button",{staticClass:e._$s("27-"+o,"sc","btn-small"),attrs:{"data-url":e._$s("27-"+o,"a-data-url",t.tempUrl),_i:"27-"+o},on:{click:e.copyUrl}})])])})),0)]):e._e(),n("view",{staticClass:e._$s(28,"sc","tips"),attrs:{_i:28}},[n("text",{staticClass:e._$s(29,"sc","tips-title"),attrs:{_i:29}}),n("text",{staticClass:e._$s(30,"sc","tips-item"),attrs:{_i:30}}),n("text",{staticClass:e._$s(31,"sc","tips-item"),attrs:{_i:31}}),n("text",{staticClass:e._$s(32,"sc","tips-item"),attrs:{_i:32}})])])},i=[]},"51b8":function(e,t,n){var r=n("e8c8");e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},"51f4":function(e,t){var n=Object.prototype,r=n.hasOwnProperty;e.exports=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&r.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},5271:function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},5272:function(e,t,n){var r=n("7cca"),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,a=r((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(i,(function(e,n,r,i){t.push(r?i.replace(o,"$1"):n||e)})),t}));e.exports=a},"54e4":function(e,t,n){var r=n("c823"),i=Object.create,o=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=o},"551c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HunYuanBetaSimpleModel=void 0;var r=n("7a9b"),i=n("31a3"),o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},u=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="hunyuan-beta/openapi/v1/chat/completions",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e,t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return[4,this.req({url:this.url,data:o(o({},(0,i.processInput)(e)),{stream:!1}),stream:!1,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,o(o({},n),{rawResponse:n})]}}))}))},e.prototype.doStream=function(e,t){return a(this,void 0,void 0,(function(){var n,a,u,c,l;return s(this,(function(s){switch(s.label){case 0:return n=null,[4,this.req({url:this.url,data:o(o({},(0,i.processInput)(e)),{stream:!0}),stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return a=s.sent(),u=(0,r.toPolyfillReadable)(a),c=(0,r.intoStandardStream)(u),l=c.pipeThrough(new r.TransformStream({transform:function(e,t){var i=e.choices.map((function(e){var t=e.delta;return null==n&&(n=(0,r.isToolCallAssistantMessage)(t)),n?o(o({},e),{finish_reason:"tool_calls",delta:t}):e})),a=o(o({},e),{choices:i});t.enqueue(o(o({},a),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(l)]}}))}))},e}();t.HunYuanBetaSimpleModel=u},"562d":function(e,t,n){var r=n("6c88"),i=n("a2a2"),o=n("09fe"),a=n("51b8");e.exports=function(e,t){return t=r(t,e),e=o(e,t),null==e||delete e[a(i(t))]}},"563d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionReference=void 0;var r=n("873a"),i=n("705c"),o=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),t.prototype.doc=function(e){if("string"!==typeof e&&"number"!==typeof e)throw new Error("docId\u5fc5\u987b\u4e3a\u5b57\u7b26\u4e32\u6216\u6570\u5b57");return new r.DocumentReference(this._transaction,this._coll,e)},t.prototype.add=function(e){var t;void 0!==e._id&&(t=e._id);var n=new r.DocumentReference(this._transaction,this._coll,t);return n.create(e)},t}(i.Query);t.CollectionReference=a},5901:function(e,t,n){var r=n("54e4"),i=n("be2d"),o=n("1d3e");e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(i(e))}},"59ad":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("ec46");Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}));var i=n("3437");Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},"5a7a":function(e){e.exports=JSON.parse('{"name":"@cloudbase/js-sdk","version":"2.21.9","description":"cloudbase javascript sdk","main":"dist/index.cjs.js","module":"dist/index.esm.js","miniprogram":"miniprogram_dist","typings":"./index.d.ts","scripts":{"lint":"eslint --fix \\"./src/**/*.ts\\"","build":"rm -rf dist/ && gulp build","build:cdn":"gulp cdn","build:e2e":"rm -rf dist/ && NODE_ENV=e2e gulp e2e","precommit":"npm run lint"},"publishConfig":{"access":"public"},"repository":{"type":"git","url":"https://github.com/TencentCloudBase/cloudbase-js-sdk"},"keywords":["tcb","cloudbase","Cloudbase","serverless","Serverless","javascript","JavaScript"],"files":["miniprogram_dist","**/dist/","/index.d.ts","**/package.json"],"components":["app","auth","database","functions","storage"],"author":"","license":"Apache-2.0","dependencies":{"@cloudbase/adapter-interface":"^0.7.1","@cloudbase/ai":"2.21.9","@cloudbase/analytics":"2.21.9","@cloudbase/app":"2.21.9","@cloudbase/auth":"2.21.9","@cloudbase/cloudrun":"2.21.9","@cloudbase/database":"0.9.22","@cloudbase/functions":"2.21.9","@cloudbase/model":"2.21.9","@cloudbase/realtime":"2.21.9","@cloudbase/storage":"2.21.9","@cloudbase/types":"2.21.9","@cloudbase/utilities":"2.21.9"},"browserslist":["last 2 version","> 1%","chrome 53"],"gitHead":"c671de51da2e4fa309c35277dc36b28a724b75ff"}')},"5b12":function(e,t){e.exports=function(){this.__data__=[],this.size=0}},"5b20":function(e,t){var n=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,n.exec(e));return t.lastIndex=e.lastIndex,t}},"5b9d":function(e,t,n){var r=n("7fdd"),i=r(Object.keys,Object);e.exports=i},"5bbe":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("7ca3"));function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=n("139b"),u=s.formatRelativeTime,c=n("11ca"),l=c.cloudCall,d={data:function(){return{fans:[],isLoading:!1,hasMore:!0,page:0,PAGE_SIZE:20,pendingOpenid:null,defaultAvatar:"/static/images/avatar.png",total:""}},onLoad:function(){this.markFollowNotificationsRead(),this.loadFans(!0)},onPullDownRefresh:function(){this.loadFans(!0)},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadFans()},methods:(0,i.default)({formatTime:void 0,callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(e,t,Object.assign({pageTag:"fans",context:this,requireAuth:!0},n))},loadFans:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLoading){n&&(this.setData({page:0,hasMore:!0}),this.markFollowNotificationsRead());var r=n?0:this.page;this.setData({isLoading:!0}),this.callCloudFunction("follow",{action:"getFollowerList",skip:r*this.PAGE_SIZE,limit:this.PAGE_SIZE}).then((function(e){if(e.result&&e.result.success){var i=e.result.list||[],o=i.map((function(e){return a(a({},e),{},{followedAtText:e.followedAt?t.formatTime(e.followedAt):""})})),s=n?o:t.fans.concat(o);t.setData({fans:s,page:r+1,hasMore:!!e.result.hasMore,total:e.result.total||s.length})}else uni.showToast({title:e.result&&e.result.message?e.result.message:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u83b7\u53d6\u7c89\u4e1d\u5217\u8868\u5931\u8d25:",t," at pages/fans/fans.vue:123"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){t.setData({isLoading:!1}),n&&uni.stopPullDownRefresh()}))}},markFollowNotificationsRead:function(){this.callCloudFunction("follow",{action:"markFollowNotificationsRead"}).catch((function(t){e("error","\u6807\u8bb0\u5173\u6ce8\u6d88\u606f\u5df2\u8bfb\u5931\u8d25:",t," at pages/fans/fans.vue:142")}))},onToggleFollow:function(t){var n=this,r=t.currentTarget.dataset.openid,o=t.currentTarget.dataset.index;r&&void 0!==o&&!this.pendingOpenid&&(this.setData({pendingOpenid:r}),this.callCloudFunction("follow",{action:"toggleFollow",targetOpenid:r}).then((function(e){if(e.result&&e.result.success){var t=!!e.result.isFollowing;n.setData((0,i.default)({},"fans[".concat(o,"].isMutual"),t)),uni.showToast({title:t?"\u5173\u6ce8\u6210\u529f":"\u5df2\u53d6\u6d88\u5173\u6ce8",icon:"success"}),n.refreshFanStatus(r,o)}else uni.showToast({title:e.result&&e.result.message?e.result.message:"\u64cd\u4f5c\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u64cd\u4f5c\u7c89\u4e1d\u5173\u6ce8\u72b6\u6001\u5931\u8d25:",t," at pages/fans/fans.vue:176"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){n.setData({pendingOpenid:null})})))},refreshFanStatus:function(t,n){var r=this;this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:t}).then((function(e){e.result&&e.result.success&&r.setData((0,i.default)({},"fans[".concat(n,"].isMutual"),!!e.result.isMutual))})).catch((function(t){e("error","\u5237\u65b0\u7c89\u4e1d\u72b6\u6001\u5931\u8d25:",t," at pages/fans/fans.vue:199")}))},onAvatarError:function(e){var t=e.currentTarget.dataset.index;void 0!==t&&this.setData((0,i.default)({},"fans[".concat(t,"].avatarUrl"),this.defaultAvatar))},openUserProfile:function(e){var t=e.currentTarget.dataset.openid;t&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(t)})}},"formatTime",(function(e){return u(e)}))};t.default=d}).call(this,n("f3b9")["default"])},"5c02":function(e,t,n){"use strict";var r=n("47a9"),i=n("3b2d");Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortController",{enumerable:!0,get:function(){return f.default}}),t.utils=t.langEvent=t.jwt=t.helpers=t.events=t.constants=t.cache=t.adapters=void 0;var o=g(n("c7a0"));t.constants=o;var a=g(n("2a0b"));t.adapters=a;var s=g(n("bd01"));t.cache=s;var u=g(n("0a32"));t.events=u;var c=g(n("804d"));t.langEvent=c;var l=g(n("6e68"));t.utils=l;var d=g(n("84ff"));t.helpers=d;var f=r(n("9f39")),p=r(n("4679"));function h(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!==typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}var v={decode:p.default};t.jwt=v},"5c7c":function(e,t,n){"use strict";n.r(t);var r=n("ecf3"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"5cec":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMMUNITY_SITE_URL=t.IS_DEBUG_MODE=t.getProtocol=t.setProtocol=t.getSdkName=t.setSdkName=void 0;var r="@cloudbase/js-sdk";t.setSdkName=function(e){r=e},t.getSdkName=function(){return r};var i="https:";t.setProtocol=function(e){i=e},t.getProtocol=function(){return i},t.IS_DEBUG_MODE=!1,t.COMMUNITY_SITE_URL="https://support.qq.com/products/148793"},"5dd6":function(e,t,n){"use strict";n.r(t);var r=n("3b09"),i=n("dd56");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"5e49":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.Query=void 0;var i=r(n("3b2d")),o=n("95fb"),a=n("ae75"),s=n("b8e2"),u=n("be93"),c=n("3e19"),l=n("a601"),d=n("831e"),f=n("f208"),p=function(){return p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},p.apply(this,arguments)},h=function(){function t(e,t,n,r,i){var o=this;this.watch=function(e){var t=(0,f.getWsInstance)(o._db);return t.watch(p(p({},e),{envId:o._db.config.env,collectionName:o._coll,query:JSON.stringify(o._fieldFilters||{}),limit:o._queryOptions.limit,orderBy:o._fieldOrders?o._fieldOrders.reduce((function(e,t){return e[t.field]=t.direction,e}),{}):void 0}))},this._db=e,this._coll=t,this._fieldFilters=n,this._fieldOrders=r||[],this._queryOptions=i||{},this._request=new s.Db.reqClass(this._db.config)}return t.prototype.get=function(e){e=e||(0,o.createPromiseCallback)();var t=[];this._fieldOrders&&this._fieldOrders.forEach((function(e){t.push(e)}));var n={collectionName:this._coll,queryType:a.QueryType.WHERE};return this._fieldFilters&&(n.query=this._fieldFilters),t.length>0&&(n.order=t),this._queryOptions.offset&&(n.offset=this._queryOptions.offset),this._queryOptions.limit?n.limit=this._queryOptions.limit<1e3?this._queryOptions.limit:1e3:n.limit=100,this._queryOptions.projection&&(n.projection=this._queryOptions.projection),this._request.send("database.queryDocument",n).then((function(t){if(t.code)e(0,t);else{var n=c.Util.formatResDocumentData(t.data.list),r={data:n,requestId:t.requestId};t.total&&(r.total=t.total),t.limit&&(r.limit=t.limit),t.offset&&(r.offset=t.offset),e(0,r)}})).catch((function(t){e(t)})),e.promise},t.prototype.count=function(e){e=e||(0,o.createPromiseCallback)();var t={collectionName:this._coll,queryType:a.QueryType.WHERE};return this._fieldFilters&&(t.query=this._fieldFilters),this._request.send("database.countDocument",t).then((function(t){t.code?e(0,t):e(0,{requestId:t.requestId,total:t.data.total})})).catch((function(t){e(t)})),e.promise},t.prototype.where=function(e){if("Object"!==Object.prototype.toString.call(e).slice(8,-1))throw Error(a.ErrorCode.QueryParamTypeError);var n=Object.keys(e),r=n.some((function(t){return void 0!==e[t]}));if(n.length&&!r)throw Error(a.ErrorCode.QueryParamValueError);return new t(this._db,this._coll,l.QuerySerializer.encode(e),this._fieldOrders,this._queryOptions)},t.prototype.orderBy=function(e,n){u.Validate.isFieldPath(e),u.Validate.isFieldOrder(n);var r={field:e,direction:n},i=this._fieldOrders.concat(r);return new t(this._db,this._coll,this._fieldFilters,i,this._queryOptions)},t.prototype.limit=function(e){u.Validate.isInteger("limit",e);var n=p({},this._queryOptions);return n.limit=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,n)},t.prototype.skip=function(e){u.Validate.isInteger("offset",e);var n=p({},this._queryOptions);return n.offset=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,n)},t.prototype.update=function(e,t){if(t=t||(0,o.createPromiseCallback)(),!e||"object"!==(0,i.default)(e))return Promise.resolve({code:"INVALID_PARAM",message:"\u53c2\u6570\u5fc5\u9700\u662f\u975e\u7a7a\u5bf9\u8c61"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"\u4e0d\u80fd\u66f4\u65b0_id\u7684\u503c"});var n={collectionName:this._coll,query:this._fieldFilters,queryType:a.QueryType.WHERE,multi:!0,merge:!0,upsert:!1,data:d.UpdateSerializer.encode(e)};return this._request.send("database.updateDocument",n).then((function(e){e.code?t(0,e):t(0,{requestId:e.requestId,updated:e.data.updated,upsertId:e.data.upsert_id})})).catch((function(e){t(e)})),t.promise},t.prototype.field=function(e){for(var n in e)e[n]?"object"!==(0,i.default)(e[n])&&(e[n]=1):e[n]=0;var r=p({},this._queryOptions);return r.projection=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},t.prototype.remove=function(t){t=t||(0,o.createPromiseCallback)(),Object.keys(this._queryOptions).length>0&&e("warn","`offset`, `limit` and `projection` are not supported in remove() operation"," at node_modules/@cloudbase/database/dist/esm/query.js:218"),this._fieldOrders.length>0&&e("warn","`orderBy` is not supported in remove() operation"," at node_modules/@cloudbase/database/dist/esm/query.js:221");var n={collectionName:this._coll,query:l.QuerySerializer.encode(this._fieldFilters),queryType:a.QueryType.WHERE,multi:!0};return this._request.send("database.deleteDocument",n).then((function(e){e.code?t(0,e):t(0,{requestId:e.requestId,deleted:e.data.deleted})})).catch((function(e){t(e)})),t.promise},t}();t.Query=h}).call(this,n("f3b9")["default"])},"606d":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("3c4e")),o=n("f7d7"),a=n("8e05"),s=n("c051"),u=n("88f6"),c=n("616b"),l=n("7a72"),d=n("fc99"),f=n("a671"),p=n("031a"),h=r(n("5a7a")),g=h.default.version;i.default.registerVersion(g);try{(0,o.registerAuth)(i.default),(0,a.registerFunctions)(i.default),(0,s.registerStorage)(i.default),(0,p.registerDatabase)(i.default),(0,u.registerRealtime)(i.default),(0,c.registerAnalytics)(i.default),(0,l.registerModel)(i.default),(0,d.registerAi)(i.default),(0,f.registerCloudrun)(i.default)}catch(m){}try{window.cloudbase=i.default}catch(m){}var v=i.default;t.default=v},"612d":function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a=i(n("8ffa")),s=i(n("4ffb")),u=i(n("b4d2")),c=i(n("67ad")),l=i(n("0bdb"));function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}if(!globalThis.IS_MP_BUILD){var f,p,h,g=function(e){return R.charAt(e)},v=function(e,t){return e&t},m=function(e,t){return e|t},y=function(e,t){return e^t},_=function(e,t){return e&~t},b=function(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t},w=function(e){var t=0;while(0!=e)e&=e-1,++t;return t},S=function(e){var t,n,r="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+=D.charAt(n>>6)+D.charAt(63&n);t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+=D.charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+=D.charAt(n>>2)+D.charAt((3&n)<<4));while((3&r.length)>0)r+=L;return r},I=function(e){var t,n="",r=0,i=0;for(t=0;t<e.length;++t){if(e.charAt(t)==L)break;var o=D.indexOf(e.charAt(t));o<0||(0==r?(n+=g(o>>2),i=3&o,r=1):1==r?(n+=g(i<<2|o>>4),i=15&o,r=2):2==r?(n+=g(i),n+=g(o>>2),i=3&o,r=3):(n+=g(i<<2|o>>4),n+=g(15&o),r=0))}return 1==r&&(n+=g(i<<2)),n},C=function(e,t){return e.length>t&&(e=e.substring(0,t)+U),e},T=function(){return new Y(null)},O=function(e,t){return new Y(e,t)},E=function(e,t){var n=ee[e.charCodeAt(t)];return null==n?-1:n},x=function(e){var t=T();return t.fromInt(e),t},P=function(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n},k=function(){if(null==te){te=function(){return new re}();while(ne<ie){var e=Math.floor(65536*Math.random());oe[ne++]=255&e}for(te.init(oe),ne=0;ne<oe.length;++ne)oe[ne]=0;ne=0}return te.next()},A="undefined"!==typeof globalThis?globalThis.navigator:window.globalThis,R="0123456789abcdefghijklmnopqrstuvwxyz",D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L="=",N={decode:function(e){var t;if(void 0===f){var n="0123456789ABCDEF";for(f={},t=0;t<16;++t)f[n.charAt(t)]=t;for(n=n.toLowerCase(),t=10;t<16;++t)f[n.charAt(t)]=t;for(t=0;t<" \f\n\r\t\xa0\u2028\u2029".length;++t)f[" \f\n\r\t\xa0\u2028\u2029".charAt(t)]=-1}var r=[],i=0,o=0;for(t=0;t<e.length;++t){var a=e.charAt(t);if("="==a)break;if(a=f[a],-1!=a){if(void 0===a)throw new Error("Illegal character at offset "+t);i|=a,++o>=2?(r[r.length]=i,i=0,o=0):i<<=4}}if(o)throw new Error("Hex encoding incomplete: 4 bits missing");return r}},M={decode:function(e){var t;if(void 0===p){for(p=Object.create(null),t=0;t<64;++t)p["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(t=0;t<"= \f\n\r\t\xa0\u2028\u2029".length;++t)p["= \f\n\r\t\xa0\u2028\u2029".charAt(t)]=-1}var n=[],r=0,i=0;for(t=0;t<e.length;++t){var o=e.charAt(t);if("="==o)break;if(o=p[o],-1!=o){if(void 0===o)throw new Error("Illegal character at offset "+t);r|=o,++i>=4?(n[n.length]=r>>16,n[n.length]=r>>8&255,n[n.length]=255&r,r=0,i=0):r<<=6}}switch(i){case 1:throw new Error("Base64 encoding incomplete: at least 2 bits missing");case 2:n[n.length]=r>>10;break;case 3:n[n.length]=r>>16,n[n.length]=r>>8&255;break}return n},re:/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,unarmor:function(e){var t=M.re.exec(e);if(t)if(t[1])e=t[1];else{if(!t[2])throw new Error("RegExp out of sync");e=t[2]}return M.decode(e)}},$=1e13,j=function(){function e(t){(0,c.default)(this,e),this.buf=[+t||0]}return(0,l.default)(e,[{key:"mulAdd",value:function(e,t){var n,r,i=this.buf,o=i.length;for(n=0;n<o;++n)r=i[n]*e+t,r<$?t=0:(t=0|r/$,r-=t*$),i[n]=r;t>0&&(i[n]=t)}},{key:"sub",value:function(e){var t,n,r=this.buf,i=r.length;for(t=0;t<i;++t)n=r[t]-e,n<0?(n+=$,e=1):e=0,r[t]=n;while(0===r[r.length-1])r.pop()}},{key:"toString",value:function(e){if(10!=(e||10))throw new Error("only base 10 is supported");for(var t=this.buf,n=t[t.length-1].toString(),r=t.length-2;r>=0;--r)n+=($+t[r]).toString().substring(1);return n}},{key:"valueOf",value:function(){for(var e=this.buf,t=0,n=e.length-1;n>=0;--n)t=t*$+e[n];return t}},{key:"simplify",value:function(){var e=this.buf;return 1==e.length?e[0]:this}}]),e}(),U="\u2026",F=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,B=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,q=function(){function e(t,n){(0,c.default)(this,e),this.hexDigits="0123456789ABCDEF",t instanceof e?(this.enc=t.enc,this.pos=t.pos):(this.enc=t,this.pos=n)}return(0,l.default)(e,[{key:"get",value:function(e){if(void 0===e&&(e=this.pos++),e>=this.enc.length)throw new Error("Requesting byte offset "+e+" on a stream of length "+this.enc.length);return"string"===typeof this.enc?this.enc.charCodeAt(e):this.enc[e]}},{key:"hexByte",value:function(e){return this.hexDigits.charAt(e>>4&15)+this.hexDigits.charAt(15&e)}},{key:"hexDump",value:function(e,t,n){for(var r="",i=e;i<t;++i)if(r+=this.hexByte(this.get(i)),!0!==n)switch(15&i){case 7:r+="  ";break;case 15:r+="\n";break;default:r+=" "}return r}},{key:"isASCII",value:function(e,t){for(var n=e;n<t;++n){var r=this.get(n);if(r<32||r>176)return!1}return!0}},{key:"parseStringISO",value:function(e,t){for(var n="",r=e;r<t;++r)n+=String.fromCharCode(this.get(r));return n}},{key:"parseStringUTF",value:function(e,t){for(var n="",r=e;r<t;){var i=this.get(r++);n+=i<128?String.fromCharCode(i):i>191&&i<224?String.fromCharCode((31&i)<<6|63&this.get(r++)):String.fromCharCode((15&i)<<12|(63&this.get(r++))<<6|63&this.get(r++))}return n}},{key:"parseStringBMP",value:function(e,t){for(var n,r,i="",o=e;o<t;)n=this.get(o++),r=this.get(o++),i+=String.fromCharCode(n<<8|r);return i}},{key:"parseTime",value:function(e,t,n){var r=this.parseStringISO(e,t),i=(n?F:B).exec(r);return i?(n&&(i[1]=+i[1],i[1]+=+i[1]<70?2e3:1900),r=i[1]+"-"+i[2]+"-"+i[3]+" "+i[4],i[5]&&(r+=":"+i[5],i[6]&&(r+=":"+i[6],i[7]&&(r+="."+i[7]))),i[8]&&(r+=" UTC","Z"!=i[8]&&(r+=i[8],i[9]&&(r+=":"+i[9]))),r):"Unrecognized time: "+r}},{key:"parseInteger",value:function(e,t){var n,r=this.get(e),i=r>127,o=i?255:0,a="";while(r==o&&++e<t)r=this.get(e);if(n=t-e,0===n)return i?-1:0;if(n>4){a=r,n<<=3;while(0==(128&(+a^o)))a=+a<<1,--n;a="("+n+" bit)\n"}i&&(r-=256);for(var s=new j(r),u=e+1;u<t;++u)s.mulAdd(256,this.get(u));return a+s.toString()}},{key:"parseBitString",value:function(e,t,n){for(var r=this.get(e),i=(t-e-1<<3)-r,o="("+i+" bit)\n",a="",s=e+1;s<t;++s){for(var u=this.get(s),c=s==t-1?r:0,l=7;l>=c;--l)a+=u>>l&1?"1":"0";if(a.length>n)return o+C(a,n)}return o+a}},{key:"parseOctetString",value:function(e,t,n){if(this.isASCII(e,t))return C(this.parseStringISO(e,t),n);var r=t-e,i="("+r+" byte)\n";n/=2,r>n&&(t=e+n);for(var o=e;o<t;++o)i+=this.hexByte(this.get(o));return r>n&&(i+=U),i}},{key:"parseOID",value:function(e,t,n){for(var r="",i=new j,o=0,a=e;a<t;++a){var s=this.get(a);if(i.mulAdd(128,127&s),o+=7,!(128&s)){if(""===r)if(i=i.simplify(),i instanceof j)i.sub(80),r="2."+i.toString();else{var u=i<80?i<40?0:1:2;r=u+"."+(i-40*u)}else r+="."+i.toString();if(r.length>n)return C(r,n);i=new j,o=0}}return o>0&&(r+=".incomplete"),r}}]),e}(),W=function(){function e(t,n,r,i,o){if((0,c.default)(this,e),!(i instanceof H))throw new Error("Invalid tag value.");this.stream=t,this.header=n,this.length=r,this.tag=i,this.sub=o}return(0,l.default)(e,[{key:"typeName",value:function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}}},{key:"content",value:function(e){if(void 0===this.tag)return null;void 0===e&&(e=1/0);var t=this.posContent(),n=Math.abs(this.length);if(!this.tag.isUniversal())return null!==this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(t,t+n,e);switch(this.tag.tagNumber){case 1:return 0===this.stream.get(t)?"false":"true";case 2:return this.stream.parseInteger(t,t+n);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(t,t+n,e);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(t,t+n,e);case 6:return this.stream.parseOID(t,t+n,e);case 16:case 17:return null!==this.sub?"("+this.sub.length+" elem)":"(no elem)";case 12:return C(this.stream.parseStringUTF(t,t+n),e);case 18:case 19:case 20:case 21:case 22:case 26:return C(this.stream.parseStringISO(t,t+n),e);case 30:return C(this.stream.parseStringBMP(t,t+n),e);case 23:case 24:return this.stream.parseTime(t,t+n,23==this.tag.tagNumber)}return null}},{key:"toString",value:function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"}},{key:"toPrettyString",value:function(e){void 0===e&&(e="");var t=e+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(t+="+"),t+=this.length,this.tag.tagConstructed?t+=" (constructed)":!this.tag.isUniversal()||3!=this.tag.tagNumber&&4!=this.tag.tagNumber||null===this.sub||(t+=" (encapsulates)"),t+="\n",null!==this.sub){e+="  ";for(var n=0,r=this.sub.length;n<r;++n)t+=this.sub[n].toPrettyString(e)}return t}},{key:"posStart",value:function(){return this.stream.pos}},{key:"posContent",value:function(){return this.stream.pos+this.header}},{key:"posEnd",value:function(){return this.stream.pos+this.header+Math.abs(this.length)}},{key:"toHexString",value:function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)}},{key:"getHexStringValue",value:function(){var e=this.toHexString(),t=2*this.header,n=2*this.length;return e.substr(t,n)}}],[{key:"decodeLength",value:function(e){var t=e.get(),n=127&t;if(n==t)return n;if(n>6)throw new Error("Length over 48 bits not supported at position "+(e.pos-1));if(0===n)return null;t=0;for(var r=0;r<n;++r)t=256*t+e.get();return t}},{key:"decode",value:function(t){var n;n=t instanceof q?t:new q(t,0);var r=new q(n),i=new H(n),o=e.decodeLength(n),a=n.pos,s=a-r.pos,u=null,c=function(){var t=[];if(null!==o){var r=a+o;while(n.pos<r)t[t.length]=e.decode(n);if(n.pos!=r)throw new Error("Content size is not correct for container starting at offset "+a)}else try{for(;;){var i=e.decode(n);if(i.tag.isEOC())break;t[t.length]=i}o=a-n.pos}catch(s){throw new Error("Exception while decoding undefined length content: "+s)}return t};if(i.tagConstructed)u=c();else if(i.isUniversal()&&(3==i.tagNumber||4==i.tagNumber))try{if(3==i.tagNumber&&0!=n.get())throw new Error("BIT STRINGs with unused bits cannot encapsulate.");u=c();for(var l=0;l<u.length;++l)if(u[l].tag.isEOC())throw new Error("EOC is not supposed to be actual content.")}catch(d){u=null}if(null===u){if(null===o)throw new Error("We can't skip over an invalid tag with undefined length at offset "+a);n.pos=a+Math.abs(o)}return new e(r,s,o,i,u)}}]),e}(),H=function(){function e(t){(0,c.default)(this,e);var n=t.get();if(this.tagClass=n>>6,this.tagConstructed=0!==(32&n),this.tagNumber=31&n,31==this.tagNumber){var r=new j;do{n=t.get(),r.mulAdd(128,127&n)}while(128&n);this.tagNumber=r.simplify()}}return(0,l.default)(e,[{key:"isUniversal",value:function(){return 0===this.tagClass}},{key:"isEOC",value:function(){return 0===this.tagClass&&0===this.tagNumber}}]),e}(),V=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],G=(1<<26)/V[V.length-1],Y=function(){function e(t,n,r){(0,c.default)(this,e),null!=t&&("number"==typeof t?this.fromNumber(t,n,r):null==n&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,n))}return(0,l.default)(e,[{key:"toString",value:function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,r=(1<<t)-1,i=!1,o="",a=this.t,s=this.DB-a*this.DB%t;if(a-- >0){s<this.DB&&(n=this[a]>>s)>0&&(i=!0,o=g(n));while(a>=0)s<t?(n=(this[a]&(1<<s)-1)<<t-s,n|=this[--a]>>(s+=this.DB-t)):(n=this[a]>>(s-=t)&r,s<=0&&(s+=this.DB,--a)),n>0&&(i=!0),i&&(o+=g(n))}return i?o:"0"}},{key:"negate",value:function(){var t=T();return e.ZERO.subTo(this,t),t}},{key:"abs",value:function(){return this.s<0?this.negate():this}},{key:"compareTo",value:function(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(t=n-e.t,0!=t)return this.s<0?-t:t;while(--n>=0)if(0!=(t=this[n]-e[n]))return t;return 0}},{key:"bitLength",value:function(){return this.t<=0?0:this.DB*(this.t-1)+P(this[this.t-1]^this.s&this.DM)}},{key:"mod",value:function(t){var n=T();return this.abs().divRemTo(t,null,n),this.s<0&&n.compareTo(e.ZERO)>0&&t.subTo(n,n),n}},{key:"modPowInt",value:function(e,t){var n;return n=e<256||t.isEven()?new z(t):new J(t),this.exp(e,n)}},{key:"clone",value:function(){var e=T();return this.copyTo(e),e}},{key:"intValue",value:function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}},{key:"byteValue",value:function(){return 0==this.t?this.s:this[0]<<24>>24}},{key:"shortValue",value:function(){return 0==this.t?this.s:this[0]<<16>>16}},{key:"signum",value:function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}},{key:"toByteArray",value:function(){var e=this.t,t=[];t[0]=this.s;var n,r=this.DB-e*this.DB%8,i=0;if(e-- >0){r<this.DB&&(n=this[e]>>r)!=(this.s&this.DM)>>r&&(t[i++]=n|this.s<<this.DB-r);while(e>=0)r<8?(n=(this[e]&(1<<r)-1)<<8-r,n|=this[--e]>>(r+=this.DB-8)):(n=this[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(t[i++]=n)}return t}},{key:"equals",value:function(e){return 0==this.compareTo(e)}},{key:"min",value:function(e){return this.compareTo(e)<0?this:e}},{key:"max",value:function(e){return this.compareTo(e)>0?this:e}},{key:"and",value:function(e){var t=T();return this.bitwiseTo(e,v,t),t}},{key:"or",value:function(e){var t=T();return this.bitwiseTo(e,m,t),t}},{key:"xor",value:function(e){var t=T();return this.bitwiseTo(e,y,t),t}},{key:"andNot",value:function(e){var t=T();return this.bitwiseTo(e,_,t),t}},{key:"not",value:function(){for(var e=T(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}},{key:"shiftLeft",value:function(e){var t=T();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}},{key:"shiftRight",value:function(e){var t=T();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}},{key:"getLowestSetBit",value:function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+b(this[e]);return this.s<0?this.t*this.DB:-1}},{key:"bitCount",value:function(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=w(this[n]^t);return e}},{key:"testBit",value:function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)}},{key:"setBit",value:function(e){return this.changeBit(e,m)}},{key:"clearBit",value:function(e){return this.changeBit(e,_)}},{key:"flipBit",value:function(e){return this.changeBit(e,y)}},{key:"add",value:function(e){var t=T();return this.addTo(e,t),t}},{key:"subtract",value:function(e){var t=T();return this.subTo(e,t),t}},{key:"multiply",value:function(e){var t=T();return this.multiplyTo(e,t),t}},{key:"divide",value:function(e){var t=T();return this.divRemTo(e,t,null),t}},{key:"remainder",value:function(e){var t=T();return this.divRemTo(e,null,t),t}},{key:"divideAndRemainder",value:function(e){var t=T(),n=T();return this.divRemTo(e,t,n),[t,n]}},{key:"modPow",value:function(e,t){var n,r,i=e.bitLength(),o=x(1);if(i<=0)return o;n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=i<8?new z(t):t.isEven()?new Q(t):new J(t);var a=[],s=3,u=n-1,c=(1<<n)-1;if(a[1]=r.convert(this),n>1){var l=T();r.sqrTo(a[1],l);while(s<=c)a[s]=T(),r.mulTo(l,a[s-2],a[s]),s+=2}var d,f,p=e.t-1,h=!0,g=T();i=P(e[p])-1;while(p>=0){i>=u?d=e[p]>>i-u&c:(d=(e[p]&(1<<i+1)-1)<<u-i,p>0&&(d|=e[p-1]>>this.DB+i-u)),s=n;while(0==(1&d))d>>=1,--s;if((i-=s)<0&&(i+=this.DB,--p),h)a[d].copyTo(o),h=!1;else{while(s>1)r.sqrTo(o,g),r.sqrTo(g,o),s-=2;s>0?r.sqrTo(o,g):(f=o,o=g,g=f),r.mulTo(g,a[d],o)}while(p>=0&&0==(e[p]&1<<i))r.sqrTo(o,g),f=o,o=g,g=f,--i<0&&(i=this.DB-1,--p)}return r.revert(o)}},{key:"modInverse",value:function(t){var n=t.isEven();if(this.isEven()&&n||0==t.signum())return e.ZERO;var r=t.clone(),i=this.clone(),o=x(1),a=x(0),s=x(0),u=x(1);while(0!=r.signum()){while(r.isEven())r.rShiftTo(1,r),n?(o.isEven()&&a.isEven()||(o.addTo(this,o),a.subTo(t,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);while(i.isEven())i.rShiftTo(1,i),n?(s.isEven()&&u.isEven()||(s.addTo(this,s),u.subTo(t,u)),s.rShiftTo(1,s)):u.isEven()||u.subTo(t,u),u.rShiftTo(1,u);r.compareTo(i)>=0?(r.subTo(i,r),n&&o.subTo(s,o),a.subTo(u,a)):(i.subTo(r,i),n&&s.subTo(o,s),u.subTo(a,u))}return 0!=i.compareTo(e.ONE)?e.ZERO:u.compareTo(t)>=0?u.subtract(t):u.signum()<0?(u.addTo(t,u),u.signum()<0?u.add(t):u):u}},{key:"pow",value:function(e){return this.exp(e,new K)}},{key:"gcd",value:function(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),o=n.getLowestSetBit();if(o<0)return t;i<o&&(o=i),o>0&&(t.rShiftTo(o,t),n.rShiftTo(o,n));while(t.signum()>0)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return o>0&&n.lShiftTo(o,n),n}},{key:"isProbablePrime",value:function(e){var t,n=this.abs();if(1==n.t&&n[0]<=V[V.length-1]){for(t=0;t<V.length;++t)if(n[0]==V[t])return!0;return!1}if(n.isEven())return!1;t=1;while(t<V.length){var r=V[t],i=t+1;while(i<V.length&&r<G)r*=V[i++];r=n.modInt(r);while(t<i)if(r%V[t++]==0)return!1}return n.millerRabin(e)}},{key:"copyTo",value:function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}},{key:"fromInt",value:function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}},{key:"fromString",value:function(t,n){var r;if(16==n)r=4;else if(8==n)r=3;else if(256==n)r=8;else if(2==n)r=1;else if(32==n)r=5;else{if(4!=n)return void this.fromRadix(t,n);r=2}this.t=0,this.s=0;var i=t.length,o=!1,a=0;while(--i>=0){var s=8==r?255&+t[i]:E(t,i);s<0?"-"==t.charAt(i)&&(o=!0):(o=!1,0==a?this[this.t++]=s:a+r>this.DB?(this[this.t-1]|=(s&(1<<this.DB-a)-1)<<a,this[this.t++]=s>>this.DB-a):this[this.t-1]|=s<<a,a+=r,a>=this.DB&&(a-=this.DB))}8==r&&0!=(128&+t[0])&&(this.s=-1,a>0&&(this[this.t-1]|=(1<<this.DB-a)-1<<a)),this.clamp(),o&&e.ZERO.subTo(this,this)}},{key:"clamp",value:function(){var e=this.s&this.DM;while(this.t>0&&this[this.t-1]==e)--this.t}},{key:"dlShiftTo",value:function(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}},{key:"drShiftTo",value:function(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}},{key:"lShiftTo",value:function(e,t){for(var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,o=Math.floor(e/this.DB),a=this.s<<n&this.DM,s=this.t-1;s>=0;--s)t[s+o+1]=this[s]>>r|a,a=(this[s]&i)<<n;for(s=o-1;s>=0;--s)t[s]=0;t[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()}},{key:"rShiftTo",value:function(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var r=e%this.DB,i=this.DB-r,o=(1<<r)-1;t[0]=this[n]>>r;for(var a=n+1;a<this.t;++a)t[a-n-1]|=(this[a]&o)<<i,t[a-n]=this[a]>>r;r>0&&(t[this.t-n-1]|=(this.s&o)<<i),t.t=this.t-n,t.clamp()}}},{key:"subTo",value:function(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r-=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}},{key:"multiplyTo",value:function(t,n){var r=this.abs(),i=t.abs(),o=r.t;n.t=o+i.t;while(--o>=0)n[o]=0;for(o=0;o<i.t;++o)n[o+r.t]=r.am(0,i[o],n,o,0,r.t);n.s=0,n.clamp(),this.s!=t.s&&e.ZERO.subTo(n,n)}},{key:"squareTo",value:function(e){var t=this.abs(),n=e.t=2*t.t;while(--n>=0)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}},{key:"divRemTo",value:function(t,n,r){var i=t.abs();if(!(i.t<=0)){var o=this.abs();if(o.t<i.t)return null!=n&&n.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=T());var a=T(),s=this.s,u=t.s,c=this.DB-P(i[i.t-1]);c>0?(i.lShiftTo(c,a),o.lShiftTo(c,r)):(i.copyTo(a),o.copyTo(r));var l=a.t,d=a[l-1];if(0!=d){var f=d*(1<<this.F1)+(l>1?a[l-2]>>this.F2:0),p=this.FV/f,h=(1<<this.F1)/f,g=1<<this.F2,v=r.t,m=v-l,y=null==n?T():n;a.dlShiftTo(m,y),r.compareTo(y)>=0&&(r[r.t++]=1,r.subTo(y,r)),e.ONE.dlShiftTo(l,y),y.subTo(a,a);while(a.t<l)a[a.t++]=0;while(--m>=0){var _=r[--v]==d?this.DM:Math.floor(r[v]*p+(r[v-1]+g)*h);if((r[v]+=a.am(0,_,r,m,0,l))<_){a.dlShiftTo(m,y),r.subTo(y,r);while(r[v]<--_)r.subTo(y,r)}}null!=n&&(r.drShiftTo(l,n),s!=u&&e.ZERO.subTo(n,n)),r.t=l,r.clamp(),c>0&&r.rShiftTo(c,r),s<0&&e.ZERO.subTo(r,r)}}}},{key:"invDigit",value:function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return t=t*(2-(15&e)*t)&15,t=t*(2-(255&e)*t)&255,t=t*(2-((65535&e)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}},{key:"isEven",value:function(){return 0==(this.t>0?1&this[0]:this.s)}},{key:"exp",value:function(t,n){if(t>4294967295||t<1)return e.ONE;var r=T(),i=T(),o=n.convert(this),a=P(t)-1;o.copyTo(r);while(--a>=0)if(n.sqrTo(r,i),(t&1<<a)>0)n.mulTo(i,o,r);else{var s=r;r=i,i=s}return n.revert(r)}},{key:"chunkSize",value:function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}},{key:"toRadix",value:function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=x(n),i=T(),o=T(),a="";this.divRemTo(r,i,o);while(i.signum()>0)a=(n+o.intValue()).toString(e).substr(1)+a,i.divRemTo(r,i,o);return o.intValue().toString(e)+a}},{key:"fromRadix",value:function(t,n){this.fromInt(0),null==n&&(n=10);for(var r=this.chunkSize(n),i=Math.pow(n,r),o=!1,a=0,s=0,u=0;u<t.length;++u){var c=E(t,u);c<0?"-"==t.charAt(u)&&0==this.signum()&&(o=!0):(s=n*s+c,++a>=r&&(this.dMultiply(i),this.dAddOffset(s,0),a=0,s=0))}a>0&&(this.dMultiply(Math.pow(n,a)),this.dAddOffset(s,0)),o&&e.ZERO.subTo(this,this)}},{key:"fromNumber",value:function(t,n,r){if("number"==typeof n)if(t<2)this.fromInt(1);else{this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),m,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(n))this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(e.ONE.shiftLeft(t-1),this)}else{var i=[],o=7&t;i.length=1+(t>>3),n.nextBytes(i),o>0?i[0]&=(1<<o)-1:i[0]=0,this.fromString(i,256)}}},{key:"bitwiseTo",value:function(e,t,n){var r,i,o=Math.min(e.t,this.t);for(r=0;r<o;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){for(i=e.s&this.DM,r=o;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=o;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}},{key:"changeBit",value:function(t,n){var r=e.ONE.shiftLeft(t);return this.bitwiseTo(r,n,r),r}},{key:"addTo",value:function(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r+=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()}},{key:"dMultiply",value:function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}},{key:"dAddOffset",value:function(e,t){if(0!=e){while(this.t<=t)this[this.t++]=0;this[t]+=e;while(this[t]>=this.DV)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}}},{key:"multiplyLowerTo",value:function(e,t,n){var r=Math.min(this.t+e.t,t);n.s=0,n.t=r;while(r>0)n[--r]=0;for(var i=n.t-this.t;r<i;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);r<i;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}},{key:"multiplyUpperTo",value:function(e,t,n){--t;var r=n.t=this.t+e.t-t;n.s=0;while(--r>=0)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}},{key:"modInt",value:function(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}},{key:"millerRabin",value:function(t){var n=this.subtract(e.ONE),r=n.getLowestSetBit();if(r<=0)return!1;var i=n.shiftRight(r);t=t+1>>1,t>V.length&&(t=V.length);for(var o=T(),a=0;a<t;++a){o.fromInt(V[Math.floor(Math.random()*V.length)]);var s=o.modPow(i,this);if(0!=s.compareTo(e.ONE)&&0!=s.compareTo(n)){var u=1;while(u++<r&&0!=s.compareTo(n))if(s=s.modPowInt(2,this),0==s.compareTo(e.ONE))return!1;if(0!=s.compareTo(n))return!1}}return!0}},{key:"square",value:function(){var e=T();return this.squareTo(e),e}},{key:"gcda",value:function(e,t){var n=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(n.compareTo(r)<0){var i=n;n=r,r=i}var o=n.getLowestSetBit(),a=r.getLowestSetBit();if(a<0)t(n);else{o<a&&(a=o),a>0&&(n.rShiftTo(a,n),r.rShiftTo(a,r));setTimeout((function e(){(o=n.getLowestSetBit())>0&&n.rShiftTo(o,n),(o=r.getLowestSetBit())>0&&r.rShiftTo(o,r),n.compareTo(r)>=0?(n.subTo(r,n),n.rShiftTo(1,n)):(r.subTo(n,r),r.rShiftTo(1,r)),n.signum()>0?setTimeout(e,0):(a>0&&r.lShiftTo(a,r),setTimeout((function(){t(r)}),0))}),10)}}},{key:"fromNumberAsync",value:function(t,n,r,i){if("number"==typeof n)if(t<2)this.fromInt(1);else{this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),m,this),this.isEven()&&this.dAddOffset(1,0);var o=this;setTimeout((function r(){o.dAddOffset(2,0),o.bitLength()>t&&o.subTo(e.ONE.shiftLeft(t-1),o),o.isProbablePrime(n)?setTimeout((function(){i()}),0):setTimeout(r,0)}),0)}else{var a=[],s=7&t;a.length=1+(t>>3),n.nextBytes(a),s>0?a[0]&=(1<<s)-1:a[0]=0,this.fromString(a,256)}}}]),e}(),K=function(){function e(){}return e.prototype.convert=function(e){return e},e.prototype.revert=function(e){return e},e.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n)},e.prototype.sqrTo=function(e,t){e.squareTo(t)},e}(),z=function(){function e(e){this.m=e}return e.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},e.prototype.revert=function(e){return e},e.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},e.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},e.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e}(),J=function(){function e(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}return e.prototype.convert=function(e){var t=T();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(Y.ZERO)>0&&this.m.subTo(t,t),t},e.prototype.revert=function(e){var t=T();return e.copyTo(t),this.reduce(t),t},e.prototype.reduce=function(e){while(e.t<=this.mt2)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);while(e[n]>=e.DV)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},e.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},e.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e}(),Q=function(){function e(e){this.m=e,this.r2=T(),this.q3=T(),Y.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e)}return e.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=T();return e.copyTo(t),this.reduce(t),t},e.prototype.revert=function(e){return e},e.prototype.reduce=function(e){e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(e.compareTo(this.r2)<0)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);while(e.compareTo(this.m)>=0)e.subTo(this.m,e)},e.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},e.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e}();"undefined"!==typeof A&&"Microsoft Internet Explorer"==(null===A||void 0===A?void 0:A.appName)?(Y.prototype.am=function(e,t,n,r,i,o){var a=32767&t,s=t>>15;while(--o>=0){var u=32767&this[e],c=this[e++]>>15,l=s*u+c*a;u=a*u+((32767&l)<<15)+n[r]+(1073741823&i),i=(u>>>30)+(l>>>15)+s*c+(i>>>30),n[r++]=1073741823&u}return i},h=30):"Netscape"!=(null===A||void 0===A?void 0:A.appName)?(Y.prototype.am=function(e,t,n,r,i,o){while(--o>=0){var a=t*this[e++]+n[r]+i;i=Math.floor(a/67108864),n[r++]=67108863&a}return i},h=26):(Y.prototype.am=function(e,t,n,r,i,o){var a=16383&t,s=t>>14;while(--o>=0){var u=16383&this[e],c=this[e++]>>14,l=s*u+c*a;u=a*u+((16383&l)<<14)+n[r]+i,i=(u>>28)+(l>>14)+s*c,n[r++]=268435455&u}return i},h=28),Y.prototype.DB=h,Y.prototype.DM=(1<<h)-1,Y.prototype.DV=1<<h;Y.prototype.FV=Math.pow(2,52),Y.prototype.F1=52-h,Y.prototype.F2=2*h-52;var X,Z,ee=[];for(X="0".charCodeAt(0),Z=0;Z<=9;++Z)ee[X++]=Z;for(X="a".charCodeAt(0),Z=10;Z<36;++Z)ee[X++]=Z;for(X="A".charCodeAt(0),Z=10;Z<36;++Z)ee[X++]=Z;Y.ZERO=x(0),Y.ONE=x(1);var te,ne,re=function(){function e(){(0,c.default)(this,e),this.i=0,this.j=0,this.S=[]}return(0,l.default)(e,[{key:"init",value:function(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;for(n=0,t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0}},{key:"next",value:function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]}}]),e}(),ie=256,oe=null;if(null==oe){var ae,se,ue,ce;oe=[],ne=0;var le=void 0;if(null!==(ae=window)&&void 0!==ae&&r&&null!==(se=window)&&void 0!==se&&r.getRandomValues){var de,fe=new Uint32Array(256);for(null===(de=window)||void 0===de||r.getRandomValues(fe),le=0;le<fe.length;++le)oe[ne++]=255&fe[le]}var pe,he=function e(t){var n,r,i;if(this.count=this.count||0,this.count>=256||ne>=ie){if(null!==(n=window)&&void 0!==n&&n.removeEventListener)null===(i=window)||void 0===i||i.removeEventListener("mousemove",e,!1);else if(null!==(r=window)&&void 0!==r&&r.detachEvent){var o;null===(o=window)||void 0===o||o.detachEvent("onmousemove",e)}}else try{var a=t.x+t.y;oe[ne++]=255&a,this.count+=1}catch(s){}};if(null!==(ue=window)&&void 0!==ue&&ue.addEventListener)null===(pe=window)||void 0===pe||pe.addEventListener("mousemove",he,!1);else if(null!==(ce=window)&&void 0!==ce&&ce.attachEvent){var ge;null===(ge=window)||void 0===ge||ge.attachEvent("onmousemove",he)}}var ve=function(){function e(){(0,c.default)(this,e)}return(0,l.default)(e,[{key:"nextBytes",value:function(e){for(var t=0;t<e.length;++t)e[t]=k()}}]),e}(),me=function(){function t(){(0,c.default)(this,t),this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}return(0,l.default)(t,[{key:"doPublic",value:function(e){return e.modPowInt(this.e,this.n)}},{key:"doPrivate",value:function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);while(t.compareTo(n)<0)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}},{key:"setPublic",value:function(t,n){null!=t&&null!=n&&t.length>0&&n.length>0?(this.n=O(t,16),this.e=parseInt(n,16)):e("error","Invalid RSA public key"," at node_modules/@cloudbase/oauth/dist/esm/utils/encryptlong/index.js:2569")}},{key:"encrypt",value:function(t){var n=function(t,n){if(n<t.length+11)return e("error","Message too long for RSA"," at node_modules/@cloudbase/oauth/dist/esm/utils/encryptlong/index.js:2504"),null;var r=[],i=t.length-1;while(i>=0&&n>0){var o=t.charCodeAt(i--);o<128?r[--n]=o:o>127&&o<2048?(r[--n]=63&o|128,r[--n]=o>>6|192):(r[--n]=63&o|128,r[--n]=o>>6&63|128,r[--n]=o>>12|224)}r[--n]=0;var a=new ve,s=[];while(n>2){s[0]=0;while(0==s[0])a.nextBytes(s);r[--n]=s[0]}return r[--n]=2,r[--n]=0,new Y(r)}(t,this.n.bitLength()+7>>3);if(null==n)return null;var r=this.doPublic(n);if(null==r)return null;var i=r.toString(16);return 0==(1&i.length)?i:"0"+i}},{key:"encryptLong",value:function(e){var t=this,n=(this.n.bitLength()+7>>3)-11;try{var r="";if(e.length>n){var i=e.match(/.{1,117}/g);return i.forEach((function(e){var n=t.encrypt(e);r+=n})),S(r)}var o=this.encrypt(e),a=S(o);return a}catch(s){return!1}}},{key:"decryptLong",value:function(e){var t=this,n=this.n.bitLength()+7>>3;e=I(e);try{if(e.length>n){var r="",i=e.match(/.{1,256}/g);return i.forEach((function(e){var n=t.decrypt(e);r+=n})),r}var o=this.decrypt(e);return o}catch(a){return!1}}},{key:"setPrivate",value:function(t,n,r){null!=t&&null!=n&&t.length>0&&n.length>0?(this.n=O(t,16),this.e=parseInt(n,16),this.d=O(r,16)):e("error","Invalid RSA private key"," at node_modules/@cloudbase/oauth/dist/esm/utils/encryptlong/index.js:2638")}},{key:"setPrivateEx",value:function(t,n,r,i,o,a,s,u){null!=t&&null!=n&&t.length>0&&n.length>0?(this.n=O(t,16),this.e=parseInt(n,16),this.d=O(r,16),this.p=O(i,16),this.q=O(o,16),this.dmp1=O(a,16),this.dmq1=O(s,16),this.coeff=O(u,16)):e("error","Invalid RSA private key"," at node_modules/@cloudbase/oauth/dist/esm/utils/encryptlong/index.js:2653")}},{key:"generate",value:function(e,t){var n=new ve,r=e>>1;this.e=parseInt(t,16);for(var i=new Y(t,16);;){for(;;)if(this.p=new Y(e-r,1,n),0==this.p.subtract(Y.ONE).gcd(i).compareTo(Y.ONE)&&this.p.isProbablePrime(10))break;for(;;)if(this.q=new Y(r,1,n),0==this.q.subtract(Y.ONE).gcd(i).compareTo(Y.ONE)&&this.q.isProbablePrime(10))break;if(this.p.compareTo(this.q)<=0){var o=this.p;this.p=this.q,this.q=o}var a=this.p.subtract(Y.ONE),s=this.q.subtract(Y.ONE),u=a.multiply(s);if(0==u.gcd(i).compareTo(Y.ONE)){this.n=this.p.multiply(this.q),this.d=i.modInverse(u),this.dmp1=this.d.mod(a),this.dmq1=this.d.mod(s),this.coeff=this.q.modInverse(this.p);break}}}},{key:"decrypt",value:function(e){var t=O(e,16),n=this.doPrivate(t);return null==n?null:function(e,t){var n=e.toByteArray(),r=0;while(r<n.length&&0==n[r])++r;if(n.length-r!=t-1||2!=n[r])return null;++r;while(0!=n[r])if(++r>=n.length)return null;var i="";while(++r<n.length){var o=255&n[r];o<128?i+=String.fromCharCode(o):o>191&&o<224?(i+=String.fromCharCode((31&o)<<6|63&n[r+1]),++r):(i+=String.fromCharCode((15&o)<<12|(63&n[r+1])<<6|63&n[r+2]),r+=2)}return i}(n,this.n.bitLength()+7>>3)}},{key:"generateAsync",value:function(e,t,n){var r=new ve,i=e>>1;this.e=parseInt(t,16);var o=new Y(t,16),a=this;setTimeout((function t(){var s=function(){if(a.p.compareTo(a.q)<=0){var e=a.p;a.p=a.q,a.q=e}var r=a.p.subtract(Y.ONE),i=a.q.subtract(Y.ONE),s=r.multiply(i);0==s.gcd(o).compareTo(Y.ONE)?(a.n=a.p.multiply(a.q),a.d=o.modInverse(s),a.dmp1=a.d.mod(r),a.dmq1=a.d.mod(i),a.coeff=a.q.modInverse(a.p),setTimeout((function(){n()}),0)):setTimeout(t,0)},u=function e(){a.q=T(),a.q.fromNumberAsync(i,1,r,(function(){a.q.subtract(Y.ONE).gcda(o,(function(t){0==t.compareTo(Y.ONE)&&a.q.isProbablePrime(10)?setTimeout(s,0):setTimeout(e,0)}))}))};setTimeout((function t(){a.p=T(),a.p.fromNumberAsync(e-i,1,r,(function(){a.p.subtract(Y.ONE).gcda(o,(function(e){0==e.compareTo(Y.ONE)&&a.p.isProbablePrime(10)?setTimeout(u,0):setTimeout(t,0)}))}))}),0)}),0)}}]),t}(),ye=function(e){(0,a.default)(n,e);var t=d(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,c.default)(this,n),e=t.call(this),r&&("string"===typeof r?e.parseKey(r):(e.hasPrivateKeyProperty(r)||e.hasPublicKeyProperty(r))&&e.parsePropertiesFrom(r)),e}return(0,l.default)(n,[{key:"parseKey",value:function(e){try{var t=0,n=0,r=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/.test(e)?N.decode(e):M.unarmor(e),i=W.decode(r);if(3===i.sub.length&&(i=i.sub[2].sub[0]),9===i.sub.length){t=i.sub[1].getHexStringValue(),this.n=O(t,16),n=i.sub[2].getHexStringValue(),this.e=parseInt(n,16);var o=i.sub[3].getHexStringValue();this.d=O(o,16);var a=i.sub[4].getHexStringValue();this.p=O(a,16);var s=i.sub[5].getHexStringValue();this.q=O(s,16);var u=i.sub[6].getHexStringValue();this.dmp1=O(u,16);var c=i.sub[7].getHexStringValue();this.dmq1=O(c,16);var l=i.sub[8].getHexStringValue();this.coeff=O(l,16)}else{if(2!==i.sub.length)return!1;var d=i.sub[1],f=d.sub[0];t=f.sub[0].getHexStringValue(),this.n=O(t,16),n=f.sub[1].getHexStringValue(),this.e=parseInt(n,16)}return!0}catch(p){return!1}}},{key:"hasPublicKeyProperty",value:function(e){return e=e||{},e.hasOwnProperty("n")&&e.hasOwnProperty("e")}},{key:"hasPrivateKeyProperty",value:function(e){return e=e||{},e.hasOwnProperty("n")&&e.hasOwnProperty("e")&&e.hasOwnProperty("d")&&e.hasOwnProperty("p")&&e.hasOwnProperty("q")&&e.hasOwnProperty("dmp1")&&e.hasOwnProperty("dmq1")&&e.hasOwnProperty("coeff")}},{key:"parsePropertiesFrom",value:function(e){this.n=e.n,this.e=e.e,e.hasOwnProperty("d")&&(this.d=e.d,this.p=e.p,this.q=e.q,this.dmp1=e.dmp1,this.dmq1=e.dmq1,this.coeff=e.coeff)}}]),n}(me);o=function(e){e=e||{},this.default_key_size=parseInt(e.default_key_size,10)||1024,this.default_public_exponent=e.default_public_exponent||"010001",this.log=e.log||!1,this.key=null},o.prototype.setKey=function(t){this.log&&this.key&&e("warn","A key was already set, overriding existing."," at node_modules/@cloudbase/oauth/dist/esm/utils/encryptlong/index.js:2887"),this.key=new ye(t)},o.prototype.setPrivateKey=function(e){this.setKey(e)},o.prototype.setPublicKey=function(e){this.setKey(e)},o.prototype.decrypt=function(e){try{return this.getKey().decrypt(I(e))}catch(t){return!1}},o.prototype.encrypt=function(e){try{return S(this.getKey().encrypt(e))}catch(t){return!1}},o.prototype.encryptLong=function(e){try{var t=this.getKey().encryptLong(e)||"",n=this.getKey().decryptLong(t)||"",r=0,i=/null$/g;while(i.test(n))if(r++,t=this.getKey().encryptLong(e)||"",n=this.getKey().decryptLong(t)||"",r>10)break;return t}catch(o){return!1}},o.prototype.getKey=function(e){if(!this.key){if(this.key=new ye,e&&"[object Function]"==={}.toString.call(e))return void this.key.generateAsync(this.default_key_size,this.default_public_exponent,e);this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},o.version="3.1.4"}var _e=o;t.default=_e}).call(this,n("f3b9")["default"],n("0b64")["default"])},"616b":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.registerAnalytics=function(t){try{t.registerComponent(v)}catch(n){e("warn",n," at node_modules/@cloudbase/analytics/dist/esm/index.js:137")}};var i=r(n("3b2d")),o=n("5c02"),a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":(0,i.default)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},s=function(e,t){if("object"===("undefined"===typeof Reflect?"undefined":(0,i.default)(Reflect))&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},c=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},l=o.constants.ERRORS,d=o.constants.COMMUNITY_SITE_URL,f=o.helpers.catchErrorsDecorator,p=["mall"];var h=function(){function e(){}return e.prototype.analytics=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i;return c(this,(function(o){if(!function(e){if("Object"!==Object.prototype.toString.call(e).slice(8,-1))return!1;var t=e.report_data,n=e.report_type;return!1!==p.includes(n)&&("Object"===Object.prototype.toString.call(t).slice(8,-1)&&(!(void 0!==t.action_time&&!Number.isInteger(t.action_time))&&"string"===typeof t.action_type))}(e))throw new Error(JSON.stringify({code:l.INVALID_PARAMS,msg:"[".concat("analytics",".analytics] invalid report data")}));return"analytics.report",t=void 0===e.report_data.action_time?Math.floor(Date.now()/1e3):e.report_data.action_time,n={analytics_scene:e.report_type,analytics_data:Object.assign({},e.report_data,{action_time:t})},r={requestData:n},i=this.request,i.send("analytics.report",r),[2]}))}))},a([f({customInfo:{className:"Cloudbase",methodName:"analytics"},title:"\u4e0a\u62a5\u8c03\u7528\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 analytics() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(d)]}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"analytics",null),e}(),g=new h,v={name:"analytics",entity:{analytics:g.analytics}};try{cloudbase.registerComponent(v)}catch(m){}}).call(this,n("f3b9")["default"])},"61e0":function(e,t,n){var r=n("096e"),i=n("03d9"),o=n("bfc0"),a=n("6a08"),s=n("0efd");function u(e){var t=-1,n=null==e?0:e.length;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype["delete"]=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},"62c5":function(e,t,n){var r=n("cf88"),i=n("4bba"),o=n("0dcd"),a=o&&o.isTypedArray,s=a?i(a):r;e.exports=s},"631c":function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.useAuthAdapter=void 0;var o=i(n("3b2d")),a=n("264a"),s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)},u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},c=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},l=function(){function e(e){var t,n;try{this.localStorage=(null===e||void 0===e?void 0:e.localStorage)||((null===(n=null===(t=null===e||void 0===e?void 0:e.adapter)||void 0===t?void 0:t.root)||void 0===n?void 0:n.globalThis)||globalThis).localStorage}catch(r){this.localStorage=(null===e||void 0===e?void 0:e.localStorage)||{}}}return e.prototype.getItem=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.localStorage.getItem(e)]}))}))},e.prototype.removeItem=function(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){return this.localStorage.removeItem(e),[2]}))}))},e.prototype.setItem=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){return this.localStorage.setItem(e,t),[2]}))}))},e.prototype.getItemSync=function(e){return this.localStorage.getItem(e)},e.prototype.setItemSync=function(e,t){this.localStorage.setItem(e,t)},e.prototype.removeItemSync=function(e){this.localStorage.removeItem(e)},e}(),d=/^[^:]+:\/\/[^/]+(\/[^?#]+)/,f=function(e,t){var n,r,i,o=null===(n=null===t||void 0===t?void 0:t.headers)||void 0===n?void 0:n["x-request-id"];return e||(e={}),((null===e||void 0===e?void 0:e.code)||(null===(r=null===e||void 0===e?void 0:e.data)||void 0===r?void 0:r.error_code))&&(e={error:e.code||e.data.error,error_description:e.data.error_description||e.message||e.code||e.data.error_code,request_id:e.requestId,error_code:null===(i=e.data)||void 0===i?void 0:i.error_code}),(null===e||void 0===e?void 0:e.request_id)||(e.request_id=e.request_id||o),(null===e||void 0===e?void 0:e.error)?(e.error_uri=function(e){return d.test(e)?RegExp.$1:e}(null===t||void 0===t?void 0:t.url),e):(null===e||void 0===e?void 0:e.data)||{}};var p=function(t,n){if(!a.adapterForWxMp.isMatch()||t.storage&&t.baseRequest)return t;var i=s({},t),o={};try{var d=a.adapterForWxMp.genAdapter({}),p=d.localStorage,h=d.reqClass;if(p&&(o.storage=new l({localStorage:p,adapter:n})),h){var g=new h({timeout:1e4,restrictedMethods:["get","post","upload","download","request"]});o.request=function(t){return function(n,i){return u(this,void 0,void 0,(function(){return c(this,(function(o){return[2,new Promise((function(o,a){var u=Object.assign({},i);u.body&&"string"!==typeof u.body&&(u.body=JSON.stringify(u.body));var c=e.request({url:n,data:u.body,timeout:t._timeout,method:u.method||"GET",header:u.headers,success:function(e){e=f(e,s(s({},i),{url:n})),e.error&&a(e),o(e)},fail:function(e){a({error:"unreachable",error_description:e.message})},complete:function(e){if(e&&e.errMsg&&t._timeout&&-1!==t._restrictedMethods.indexOf("request")){var n=e.errMsg;if("request:fail timeout"===n){r("warn",t._timeoutMsg," at node_modules/@cloudbase/auth/dist/esm/adapter.js:154");try{c.abort()}catch(i){}}}}})}))]}))}))}}(g)}return i.captchaOptions&&(o.baseRequest=o.request,o.request=void 0),s(s({},i),o)}catch(v){r("error","adapter generate fail:",v," at node_modules/@cloudbase/auth/dist/esm/adapter.js:254")}return i};t.useAuthAdapter=function(e){return e.adapter&&"default"!==e.adapter.type?function(e,t){var n=s({},e);try{if(!(null===e||void 0===e?void 0:e.storage)&&(null===t||void 0===t?void 0:t.localStorage)&&(n.storage=new l({localStorage:t.localStorage,adapter:t})),!e.captchaOptions&&(null===t||void 0===t?void 0:t.captchaOptions)&&(n.captchaOptions=t.captchaOptions),!e.baseRequest&&!e.request&&(null===t||void 0===t?void 0:t.reqClass)){var i=new t.reqClass({timeout:1e4,restrictedMethods:["get","post","upload","download","request"]});n.baseRequest=function(e,t){var n,r,a,l,d;return u(this,void 0,void 0,(function(){var u,p,h,g;return c(this,(function(c){switch(c.label){case 0:if(u={},p=(null===(n=t.method)||void 0===n?void 0:n.toLocaleLowerCase())||"post",h=null===(a=null===(r=null===i||void 0===i?void 0:i[p])||void 0===r?void 0:r.bind)||void 0===a?void 0:a.call(r,i),"function"!==typeof h)throw new Error("invalid \u3010".concat(p,"\u3011 request method"));c.label=1;case 1:return c.trys.push([1,3,,4]),(null===(l=t.headers)||void 0===l?void 0:l["content-type"])&&!(null===(d=t.headers)||void 0===d?void 0:d["content-type"].includes("application/json"))||["string","undefined"].includes((0,o.default)(t.body))||(t.data=t.data||t.body,t.body=JSON.stringify(t.body)),[4,h(s({url:e},t))];case 2:return u=c.sent(),u=f(u,s(s({},t),{url:e})),[3,4];case 3:throw g=c.sent(),u=g,g;case 4:if(null===u||void 0===u?void 0:u.error)throw u;return[2,u]}}))}))}}}catch(a){r("error","user adapter generate fail:",a," at node_modules/@cloudbase/auth/dist/esm/adapter.js:226")}return n}(e,e.adapter):p(e,e.adapter)}}).call(this,n("ed83")["default"],n("f3b9")["default"])},6382:function(e,t,n){var r=n("6454");e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports["default"]=e.exports},6454:function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports["default"]=e.exports},6468:function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var r=typeof e;return t=null==t?9007199254740991:t,!!t&&("number"==r||"symbol"!=r&&n.test(e))&&e>-1&&e%1==0&&e<t}},6492:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YiSimpleModel=void 0;var r=n("7a9b"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};function s(e){var t=e.messages,n=e.model,r=e.temperature,o=e.tools,a=e.top_p;return i(i({},e),{messages:t,model:n,tools:o,top_p:a,temperature:r})}var u=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="01-ai/v1/chat/completions",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,this.req({url:this.url,data:i(i({},s(e)),{stream:!1}),stream:!1,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,i(i({},n),{rawResponse:n})]}}))}))},e.prototype.doStream=function(e,t){return o(this,void 0,void 0,(function(){var n,o,u,c,l;return a(this,(function(a){switch(a.label){case 0:return n=null,[4,this.req({url:this.url,data:i(i({},s(e)),{stream:!0}),stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return o=a.sent(),u=(0,r.toPolyfillReadable)(o),c=(0,r.intoStandardStream)(u),l=c.pipeThrough(new r.TransformStream({transform:function(e,t){var o,a,s,u,c,l;if((null===(s=null===(a=null===(o=null===e||void 0===e?void 0:e.choices)||void 0===o?void 0:o[0])||void 0===a?void 0:a.delta)||void 0===s?void 0:s.content)||(null===(l=null===(c=null===(u=null===e||void 0===e?void 0:e.choices)||void 0===u?void 0:u[0])||void 0===c?void 0:c.delta)||void 0===l?void 0:l.tool_calls)){var d=e.choices.map((function(e){var t=Object.assign(e.delta,{role:"assistant"});return null==n&&(n=(0,r.isToolCallAssistantMessage)(t)),i(i({},e),n?{finish_reason:"tool_calls",delta:t}:{delta:t})})),f=i(i({},e),{choices:d});t.enqueue(i(i({},f),{rawResponse:e}))}}})),[2,(0,r.createAsyncIterable)(l)]}}))}))},e}();t.YiSimpleModel=u},"64ef":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ErrorType",{enumerable:!0,get:function(){return i.ErrorType}}),t.Syntax=void 0;var r,i=n("2ce5");t.Syntax=r,function(e){e["CLIENT_ID"]="client_id",e["CLIENT_SECRET"]="client_secret",e["RESPONSE_TYPE"]="response_type",e["SCOPE"]="scope",e["STATE"]="state",e["REDIRECT_URI"]="redirect_uri",e["ERROR"]="error",e["ERROR_DESCRIPTION"]="error_description",e["ERROR_URI"]="error_uri",e["GRANT_TYPE"]="grant_type",e["CODE"]="code",e["ACCESS_TOKEN"]="access_token",e["TOKEN_TYPE"]="token_type",e["EXPIRES_IN"]="expires_in",e["USERNAME"]="username",e["PASSWORD"]="password",e["REFRESH_TOKEN"]="refresh_token"}(r||(t.Syntax=r={}))},"653d":function(e,t,n){var r=n("a369");e.exports=function(e){return null==e?"":r(e)}},6748:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEventDynamicCode=function(e,t){"function"===typeof this[t]&&this[t](e)}},"676a":function(e,t,n){var r=n("7426");e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},"67ad":function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports["default"]=e.exports},"67cf":function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i},e.exports.__esModule=!0,e.exports["default"]=e.exports},6823:function(e,t,n){var r=n("3644"),i=n("b8b8"),o=n("fbae"),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):o(e)}},"6a08":function(e,t,n){var r=n("a535");e.exports=function(e){return r(this,e).has(e)}},"6b73":function(e,t,n){"use strict";n.r(t);var r=n("95ee"),i=n("b9dc");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"6c67":function(e,t,n){var r=n("806a"),i=n("461d");e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},"6c86":function(e,t,n){var r=n("2024"),i=n("4d0d"),o=r(i,"WeakMap");e.exports=o},"6c88":function(e,t,n){var r=n("3461"),i=n("8483"),o=n("5272"),a=n("653d");e.exports=function(e,t){return r(e)?e:i(e,t)?[e]:o(a(e))}},"6c95":function(e,t,n){var r=n("76e0"),i=n("2a65"),o=n("36a6"),a=n("1381"),s=n("1b6c"),u=n("ce95");function c(e){var t=this.__data__=new r(e);this.size=t.size}c.prototype.clear=i,c.prototype["delete"]=o,c.prototype.get=a,c.prototype.has=s,c.prototype.set=u,e.exports=c},"6caf":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createParser",{enumerable:!0,get:function(){return r.createParser}});var r=n("1f0f")},"6cda":function(e,t,n){"use strict";n.r(t);var r=n("3f29"),i=n("d6d6");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"6ced":function(e,t,n){var r=n("2024"),i=n("4d0d"),o=r(i,"Promise");e.exports=o},"6d01":function(e,t,n){"use strict";n.r(t);var r=n("eeaa"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"6e56":function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n("0ee4"))},"6e68":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.createPromiseCallback=function(){var e;if(!Promise){e=function(){},e.promise={};var t=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var n=new Promise((function(t,n){e=function(e,r){return e?n(e):t(r)}}));return e.promise=n,e},t.execCallback=function(e,t,n){void 0===n&&(n=null);if(e&&"function"===typeof e)return e(t,n);if(t)throw t;return n},t.formatUrl=function(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),i="";if(Object.keys(n).forEach((function(e){""===i?!r&&(t+="?"):i+="&",i+="".concat(e,"=").concat(encodeURIComponent(n[e]))})),t+=i,/^http(s)?:\/\//.test(t))return t;return"".concat(e).concat(t)},t.genSeqId=function(){return Math.random().toString(16).slice(2)},t.generateRequestId=function(){var e=(new Date).getTime(),t=(null===Date||void 0===Date?void 0:Date.now)&&1e3*Date.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var r=16*Math.random();return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),("x"===n?r:7&r|8).toString(16)}))},t.getHash=void 0,t.getQuery=function(e,t){if("undefined"===typeof window)return!1;var n=t||window.location.search,r=new RegExp("(^|&)".concat(e,"=([^&]*)(&|$)")),i=n.substr(n.indexOf("?")+1).match(r);return null!==i&&void 0!==i?i[2]:""},t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isFormData=function(e){return"[object FormData]"===Object.prototype.toString.call(e)},t.isInstanceOf=function(e,t){return e instanceof t},t.isNull=function(e){return"[object Null]"===Object.prototype.toString.call(e)},t.isPalinObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},t.isString=function(e){return"string"===typeof e},t.isUndefined=function(e){return"undefined"===typeof e},t.parseQueryString=void 0,t.printError=function(t,n){e("error",{code:t,msg:"[".concat((0,r.getSdkName)(),"][").concat(t,"]:").concat(n)}," at node_modules/@cloudbase/utilities/dist/esm/libs/util.js:140")},t.printGroupLog=function(t){var n,r=t.title,i=t.subtitle,o=void 0===i?"":i,a=t.content,s=void 0===a?[]:a,u=t.printTrace,c=void 0!==u&&u,l=t.collapsed,d=void 0!==l&&l;d?(console.groupCollapsed||console.error)(r,o):(console.group||console.error)(r,o);for(var f=0,p=s;f<p.length;f++){var h=p[f],g=h.type,v=h.body;switch(g){case"info":e("log",v," at node_modules/@cloudbase/utilities/dist/esm/libs/util.js:168");break;case"warn":e("warn",v," at node_modules/@cloudbase/utilities/dist/esm/libs/util.js:171");break;case"error":e("error",v," at node_modules/@cloudbase/utilities/dist/esm/libs/util.js:174");break}}c&&(console.trace||console.log)("stack trace:");null===(n=console.groupEnd)||void 0===n||n.call(console)},t.printInfo=function(t,n){e("log","[".concat((0,r.getSdkName)(),"][").concat(t,"]:").concat(n)," at node_modules/@cloudbase/utilities/dist/esm/libs/util.js:146")},t.printWarn=function(t,n){e("warn","[".concat((0,r.getSdkName)(),"][").concat(t,"]:").concat(n)," at node_modules/@cloudbase/utilities/dist/esm/libs/util.js:137")},t.removeParam=function(e,t){var n,r=t.split("?")[0],i=[],o=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==o){i=o.split("&");for(var a=i.length-1;a>=0;a-=1)n=i[a].split("=")[0],n===e&&i.splice(a,1);r="".concat(r,"?").concat(i.join("&"))}return r},t.sleep=void 0,t.throwError=function(e,t){throw new Error(JSON.stringify({code:e,msg:"[".concat((0,r.getSdkName)(),"][").concat(e,"]:").concat(t)}))},t.toQueryString=function(e){void 0===e&&(e={});var t=[];return Object.keys(e).forEach((function(n){t.push("".concat(n,"=").concat(encodeURIComponent(e[n])))})),t.join("&")},t.transformPhone=function(e){return"+86".concat(e)};var r=n("c7a0");t.getHash=function(e){if("undefined"===typeof window)return"";var t=window.location.hash.match(new RegExp("[#?&/]".concat(e,"=([^&#]*)")));return t?t[1]:""};t.sleep=function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))};t.parseQueryString=function(e){e=e.replace(/^\?/,"");var t={},n=e.split("&");return n.forEach((function(e){var n=e.split("="),r=n[0],i=n[1];r=decodeURIComponent(r),i=decodeURIComponent(i),r&&(t[r]?Array.isArray(t[r])?t[r].push(i):t[r]=[t[r],i]:t[r]=i)})),t}}).call(this,n("f3b9")["default"])},"6fc4":function(e,t,n){"use strict";n.r(t);var r=n("7766"),i=n("491d");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"705c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Query=void 0;var r=function(){return function(e,t){this._coll=t,this._transaction=e}}();t.Query=r},"709d":function(e,t,n){"use strict";n.r(t);var r=n("b5de"),i=n("6d01");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"70f0":function(e,t,n){"use strict";n.r(t);var r=n("1673"),i=n("8253");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},7172:function(e,t){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n["return"]&&(a=n["return"](),Object(a)!==a))return}finally{if(c)throw i}}return s}},e.exports.__esModule=!0,e.exports["default"]=e.exports},7425:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={skeleton:n("8cb3").default},i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[e._$s(1,"i",e.isLoading)?n("view",{attrs:{_i:1}},[n("skeleton",{attrs:{_i:2}})],1):n("view",{attrs:{_i:3}},[e._$s(4,"i",0===e.postList.length&&!e.isLoading)?n("view",{staticClass:e._$s(4,"sc","empty-state"),attrs:{_i:4}},[n("view",{staticClass:e._$s(5,"sc","empty-icon"),attrs:{_i:5}}),n("view",{staticClass:e._$s(6,"sc","empty-text"),attrs:{_i:6}},[e._v(e._$s(6,"t0-0",e._s(e.tag)))]),n("view",{staticClass:e._$s(7,"sc","empty-subtext"),attrs:{_i:7}})]):e._e(),e._$s(8,"i",e.postList.length>0)?n("view",{staticClass:e._$s(8,"sc","post-list"),attrs:{_i:8}},e._l(e._$s(9,"f",{forItems:e.postList}),(function(t,r,i,o){return n("view",{key:e._$s(9,"f",{forIndex:i,key:r}),staticClass:e._$s("9-"+o,"sc","post-item-wrapper"),attrs:{_i:"9-"+o}},[n("view",{staticClass:e._$s("10-"+o,"sc","author-info-outside"),attrs:{_i:"10-"+o}},[e._$s("11-"+o,"i",t.authorAvatar)?n("image",{staticClass:e._$s("11-"+o,"sc","author-avatar"),attrs:{src:e._$s("11-"+o,"a-src",t.authorAvatar),"data-user-id":e._$s("11-"+o,"a-data-user-id",t._openid),_i:"11-"+o},on:{error:e.onAvatarError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.navigateToUserProfile(t)}}}):e._e(),n("text",{staticClass:e._$s("12-"+o,"sc","author-name"),attrs:{_i:"12-"+o}},[e._v(e._$s("12-"+o,"t0-0",e._s(t.authorName)))])]),n("view",{staticClass:e._$s("13-"+o,"sc","post-item"),attrs:{"data-postid":e._$s("13-"+o,"a-data-postid",t._id),_i:"13-"+o},on:{click:e.onPostTap}},[n("view",{staticClass:e._$s("14-"+o,"sc","post-title"),attrs:{_i:"14-"+o}},[e._v(e._$s("14-"+o,"t0-0",e._s(t.title)))]),e._$s("15-"+o,"i",t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("15-"+o,"sc","image-container-wrapper"),style:e._$s("15-"+o,"s",t.imageStyle),attrs:{"data-src":e._$s("15-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("15-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"15-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}},[e._$s("16-"+o,"i",1===t.imageUrls.length)?[n("image",{staticClass:e._$s("17-"+o,"sc","post-image"),attrs:{src:e._$s("17-"+o,"a-src",t.imageUrls[0]),"data-src":e._$s("17-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("17-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"17-"+o},on:{error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})]:e._$s("18-"+o,"e",t.imageUrls.length>1)?[n("swiper",{staticClass:e._$s("19-"+o,"sc","image-swiper"),attrs:{_i:"19-"+o}},[e._l(e._$s("20-"+o,"f",{forItems:t.imageUrls}),(function(r,i,a,s){return[n("swiper-item",{key:e._$s("20-"+o,"f",{forIndex:a,keyIndex:0,key:i+"_0"})},[n("image",{staticClass:e._$s("22-"+o+"-"+s,"sc","post-image"),attrs:{src:e._$s("22-"+o+"-"+s,"a-src",r),"data-src":e._$s("22-"+o+"-"+s,"a-data-src",r),"data-original-image-urls":e._$s("22-"+o+"-"+s,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"22-"+o+"-"+s},on:{error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._e()],2):e._e(),e._$s("23-"+o,"i",t.content)?n("view",{staticClass:e._$s("23-"+o,"sc","post-content"),attrs:{_i:"23-"+o}},[e._v(e._$s("23-"+o,"t0-0",e._s(t.content)))]):e._e(),e._$s("24-"+o,"i",t.tags&&t.tags.length>0)?n("view",{staticClass:e._$s("24-"+o,"sc","post-tags"),attrs:{_i:"24-"+o}},e._l(e._$s("25-"+o,"f",{forItems:t.tags}),(function(t,r,i,a){return n("text",{key:e._$s("25-"+o,"f",{forIndex:i,key:r}),staticClass:e._$s("25-"+o+"-"+a,"sc","post-tag"),attrs:{"data-tag":e._$s("25-"+o+"-"+a,"a-data-tag",t),_i:"25-"+o+"-"+a},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onTagClick(t)}}},[e._v(e._$s("25-"+o+"-"+a,"t0-0",e._s(t)))])})),0):e._e()]),n("view",{staticClass:e._$s("26-"+o,"sc","vote-section"),attrs:{_i:"26-"+o}},[n("view",{staticClass:e._$s("27-"+o,"sc","actions-left"),attrs:{_i:"27-"+o}}),n("view",{staticClass:e._$s("28-"+o,"sc","actions-right"),attrs:{_i:"28-"+o}},[n("view",{staticClass:e._$s("29-"+o,"sc","action-item"),attrs:{"data-postid":e._$s("29-"+o,"a-data-postid",t._id),_i:"29-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onCommentClick(t)}}},[n("text",{staticClass:e._$s("30-"+o,"sc","action-emoji"),attrs:{_i:"30-"+o}}),n("text",{staticClass:e._$s("31-"+o,"sc","action-text"),attrs:{_i:"31-"+o}},[e._v(e._$s("31-"+o,"t0-0",e._s(t.commentCount||0)))])]),n("view",{staticClass:e._$s("32-"+o,"sc","action-item"),attrs:{_i:"32-"+o}},[n("text",{staticClass:e._$s("33-"+o,"sc","action-text"),attrs:{_i:"33-"+o}},[e._v(e._$s("33-"+o,"t0-0",e._s(t.votes||0)))])])])])])})),0):e._e(),e._$s(34,"i",e.isLoadingMore)?n("view",{staticClass:e._$s(34,"sc","loading-more"),attrs:{_i:34}},[n("text",{staticClass:e._$s(35,"sc","loading-text"),attrs:{_i:35}})]):e._e(),e._$s(36,"i",!e.hasMore&&e.postList.length>0)?n("view",{staticClass:e._$s(36,"sc","loading-more"),attrs:{_i:36}},[n("text",{staticClass:e._$s(37,"sc","loading-text"),attrs:{_i:37}})]):e._e()])])},o=[]},7426:function(e,t,n){var r=n("2024"),i=r(Object,"create");e.exports=i},"745a":function(e,t,n){var r=n("8a60"),i=Array.prototype,o=i.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);if(n<0)return!1;var i=t.length-1;return n==i?t.pop():o.call(t,n,1),--this.size,!0}},7505:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("7ca3")),o=r(n("8cb3")),a=r(n("84be")),s=r(n("8cb3")),u=r(n("84be")),c=n("2b90"),l={components:{skeleton:o.default,folderSelector:a.default},mixins:[c],data:function(){return{isLoading:!0,postList:[],currentPostIndex:0,touchStartX:0,touchEndX:0,touchStartY:0,touchEndY:0,hasMore:!0,page:0,backgroundImage:"",isTransitioning:!1,preloadedImages:{},hasFirstLoad_var:!1,currentPost:null,bgLayers:[{url:"",visible:!1},{url:"",visible:!1}],activeLayerIndex:0,swiperHeights:{},imageClampHeights:{},selected:0,url:"",visible:!1}},onLoad:function(){e("log","Mountain \u9875\u9762 onLoad"," at pages/mountain/mountain.vue:143");var t=getApp();t.globalData.preloadedMountainData&&t.globalData.preloadedMountainData.length>0?(e("log","Mountain: \u4f7f\u7528\u9884\u52a0\u8f7d\u6570\u636e"," at pages/mountain/mountain.vue:148"),this.setData({postList:t.globalData.preloadedMountainData,isLoading:!1,page:1,hasFirstLoad_var:!0}),this.updatePostDisplay(0),t.globalData.preloadedMountainData=null):(e("log","Mountain: \u65e0\u9884\u52a0\u8f7d\u6570\u636e\uff0c\u5f00\u59cb\u8bf7\u6c42"," at pages/mountain/mountain.vue:161"),this.getMountainData())},onShow:function(){var t=n("d87a"),r=t.updateTabBarStatus;r(this,2);try{var i=uni.getStorageSync("shouldRefreshMountain");if(i)return e("log","\u3010mountain\u3011\u68c0\u6d4b\u5230\u53d1\u5e03\u6807\u8bb0\uff0c\u5237\u65b0\u6570\u636e"," at pages/mountain/mountain.vue:174"),uni.removeStorageSync("shouldRefreshMountain"),void this.refreshMountainData()}catch(o){e("log","CatchClause",o," at pages/mountain/mountain.vue:180"),e("log","CatchClause",o," at pages/mountain/mountain.vue:181"),e("error","\u68c0\u67e5\u5237\u65b0\u6807\u8bb0\u5931\u8d25:",o," at pages/mountain/mountain.vue:182")}this._hasFirstLoad?e("log","\u3010mountain\u3011\u518d\u6b21\u8fdb\u5165\uff0c\u4fdd\u6301\u4e4b\u524d\u5185\u5bb9"," at pages/mountain/mountain.vue:190"):(e("log","\u3010mountain\u3011\u9996\u6b21\u8fdb\u5165\uff0c\u5237\u65b0\u6570\u636e"," at pages/mountain/mountain.vue:187"),this.refreshMountainData())},methods:{refreshMountainData:function(){e("log","\u3010mountain\u3011\u5f00\u59cb\u5237\u65b0mountain\u6570\u636e"," at pages/mountain/mountain.vue:196"),this.setData({postList:[],currentPostIndex:0,page:0,hasMore:!0,bgLayers:[{url:"",visible:!1},{url:"",visible:!1}],activeLayerIndex:0}),this.getMountainData()},getMountainData:function(){var t=this;this.$tcb&&this.$tcb.callFunction&&this.$tcb.callFunction({name:"getPostList",data:{isPoem:!0,isOriginal:!1}}).then((function(n){e("log","Mountain\u6570\u636e\u83b7\u53d6\u6210\u529f:",n," at pages/mountain/mountain.vue:228");var r=n.result.posts||[];t.setData({postList:r,isLoading:!1,hasFirstLoad_var:!0}),t.postList.length>0&&(t.setData({currentPost:t.postList[0]}),t.updatePostDisplay())})).catch((function(n){e("error","Mountain\u6570\u636e\u83b7\u53d6\u5931\u8d25:",n," at pages/mountain/mountain.vue:244"),t.setData({isLoading:!1})}))},getPostList:function(t){var n=this;if(!this.isLoading){this.setData({isLoading:!0});var r=5*this.page;e("log","\u5f00\u59cb\u83b7\u53d6\u5c71\u8bd7\u6b4c\u5217\u8868\uff0cskip:",r,"page:",this.page," at pages/mountain/mountain.vue:260"),this.$tcb&&this.$tcb.callFunction&&this.$tcb.callFunction({name:"getPostList",data:{skip:r,limit:5,isPoem:!0,isOriginal:!1}}).then((function(t){if(e("log","\u83b7\u53d6\u5c71\u8bd7\u6b4c\u5217\u8868\u7ed3\u679c:",t," at pages/mountain/mountain.vue:273"),t.result&&t.result.success){var r=t.result.posts||[];e("log","\u83b7\u53d6\u5230\u5c71\u8bd7\u6b4c\u6570\u91cf:",r.length," at pages/mountain/mountain.vue:276"),r.forEach((function(t,n){e("log","\u5c71\u8bd7\u6b4c".concat(n+1,":"),{title:t.title,isPoem:t.isPoem,isOriginal:t.isOriginal,content:t.content?t.content.substring(0,50)+"...":"\u65e0\u5185\u5bb9"}," at pages/mountain/mountain.vue:280")})),r.forEach((function(e){e.imageUrls&&0!==e.imageUrls.length||(e.imageUrls=e.imageUrl?[e.imageUrl]:[])}));var i=0===n.page?r:n.postList.concat(r);e("log","\u5c71postList:",i," at pages/mountain/mountain.vue:293"),n.setData({postList:i,page:n.page+1,hasMore:5===r.length}),1===n.page&&i.length>0?(e("log","\u7b2c\u4e00\u4e2a\u5c71\u8bd7\u6b4c\u5e16\u5b50\u6570\u636e:",{title:i[0].title,imageUrls:i[0].imageUrls,poemBgImage:i[0].poemBgImage,hasBgImage:!!i[0].poemBgImage}," at pages/mountain/mountain.vue:302"),n.updatePostDisplay(0),i.length>1&&n.loadImageForIndex(1),i.length>2&&n.loadImageForIndex(2)):e("log","\u672a\u83b7\u53d6\u5230\u5c71\u8bd7\u6b4c\u5e16\u5b50\u6570\u636e"," at pages/mountain/mountain.vue:318")}else uni.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u83b7\u53d6\u5c71\u8bd7\u6b4c\u5217\u8868\u5931\u8d25:",t," at pages/mountain/mountain.vue:327"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){n.setData({isLoading:!1}),"function"===typeof t&&t()}))}},touchStart:function(e){this.setData({touchStartX:e.touches[0].clientX,touchStartY:e.touches[0].clientY})},touchEnd:function(e){var t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,r=this.touchStartX-t,i=this.touchStartY-n,o=Math.sqrt(r*r+i*i),a=Math.abs(180*Math.atan2(Math.abs(i),Math.abs(r))/Math.PI);o>80&&Math.abs(r)>50&&a<45&&(r>0?this.nextPost():this.prevPost())},nextPost:function(){var e=this;this.currentPostIndex<this.postList.length-1?(this.setData({isTransitioning:!0}),this.updatePostDisplay(this.currentPostIndex+1),setTimeout((function(){e.setData({isTransitioning:!1})}),500)):this.hasMore&&!this.isLoading&&this.loadMorePosts((function(){e.postList.length>e.currentPostIndex+1&&e.updatePostDisplay(e.currentPostIndex+1)}))},prevPost:function(){var e=this;this.currentPostIndex>0&&(this.setData({isTransitioning:!0}),this.updatePostDisplay(this.currentPostIndex-1),setTimeout((function(){e.setData({isTransitioning:!1})}),500))},onSinglePostTap:function(e){var t=e.currentTarget.dataset.postid;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},onImageError:function(t){e("error","\u5c71\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",t.detail," at pages/mountain/mountain.vue:417")},loadMorePosts:function(t){var n=this;if(!this.isLoading){var r=5*this.page;e("log","\u5f00\u59cb\u52a0\u8f7d\u66f4\u591a\u5c71\u8bd7\u6b4c\uff0cskip:",r,"page:",this.page," at pages/mountain/mountain.vue:428"),this.$tcb&&this.$tcb.callFunction&&this.$tcb.callFunction({name:"getPostList",data:{skip:r,limit:5,isPoem:!0,isOriginal:!1}}).then((function(t){if(e("log","\u52a0\u8f7d\u66f4\u591a\u5c71\u8bd7\u6b4c\u7ed3\u679c:",t," at pages/mountain/mountain.vue:440"),t.result&&t.result.success){var r=t.result.posts||[];e("log","\u83b7\u53d6\u5230\u66f4\u591a\u5c71\u8bd7\u6b4c\u6570\u91cf:",r.length," at pages/mountain/mountain.vue:443"),r.forEach((function(e){e.imageUrls&&0!==e.imageUrls.length||(e.imageUrls=e.imageUrl?[e.imageUrl]:[])}));var i=n.postList.concat(r);n.setData({postList:i,page:n.page+1,hasMore:5===r.length});var o=n.postList.length-r.length;r.forEach((function(e,t){n.loadImageForIndex(o+t)}))}})).catch((function(t){e("error","\u52a0\u8f7d\u66f4\u591a\u5c71\u8bd7\u6b4c\u5931\u8d25:",t," at pages/mountain/mountain.vue:463")})).finally((function(){"function"===typeof t&&t()}))}},preloadNextBackgroundImage:function(e){var t=this,n=e+1;n>=this.postList.length?this.hasMore&&!this.isLoading&&this.loadMorePosts((function(){n<t.postList.length&&t.loadImageForIndex(n)})):this.loadImageForIndex(n)},updatePostDisplay:function(t){var n=this;if(!(t<0||t>=this.postList.length)){var r=this.postList[t];if(r){this.setData({currentPost:r,currentPostIndex:t});var o=r.poemBgImage||r.imageUrls&&r.imageUrls[0]||"",a=this.preloadedImages[o];if(!a){var s=getApp();s.globalData.preloadedImages&&s.globalData.preloadedImages[o]?(a=s.globalData.preloadedImages[o],this.setData((0,i.default)({},"preloadedImages.".concat(o),a))):a=o}var u=""===this.bgLayers[0].url&&""===this.bgLayers[1].url;u?(e("log","\u9996\u6b21\u663e\u793a\u80cc\u666f\u56fe\uff0c\u76f4\u63a5\u8bbe\u7f6e\u7b2c\u4e00\u4e2a\u56fe\u5c42"," at pages/mountain/mountain.vue:532"),this.setData({"bgLayers[0].url":a,"bgLayers[0].visible":!0,"bgLayers[1].visible":!1,activeLayerIndex:0}),e("log","\u9996\u6b21\u663e\u793a\u5b8c\u6210\uff0c\u7acb\u5373\u9884\u52a0\u8f7d\u7b2c\u4e8c\u5f20\u56fe\u7247"," at pages/mountain/mountain.vue:541"),this.preloadNextBackgroundImage(t)):(setTimeout((function(){n.switchBackgroundImage(a)}),100),this.preloadNextBackgroundImage(t))}}},switchBackgroundImage:function(t){var n;if(t){var r=this.preloadedImages[t],o=r||t;e("log","\u5207\u6362\u80cc\u666f\u56fe:",{originalUrl:t,preloadedUrl:r,finalUrl:o,hasPreloaded:!!r}," at pages/mountain/mountain.vue:563");var a=this.activeLayerIndex,s=(a+1)%2;this.pendingLayerIndex=s,this.pendingCurrentIndex=a,this.setData((n={},(0,i.default)(n,"bgLayers[".concat(s,"].url"),o),(0,i.default)(n,"bgLayers[".concat(s,"].visible"),!1),n))}},onBackgroundImageLoad:function(t){var n,r=t.currentTarget.dataset.layerIndex;(e("log","\u56fe\u5c42".concat(r,"\u56fe\u7247\u52a0\u8f7d\u5b8c\u6210")," at pages/mountain/mountain.vue:586"),this.pendingLayerIndex===r)&&(e("log","\u5f85\u5207\u6362\u56fe\u5c42\u56fe\u7247\u52a0\u8f7d\u5b8c\u6210\uff0c\u5f00\u59cb\u5207\u6362\u900f\u660e\u5ea6"," at pages/mountain/mountain.vue:590"),this.setData((n={},(0,i.default)(n,"bgLayers[".concat(this.pendingCurrentIndex,"].visible"),!1),(0,i.default)(n,"bgLayers[".concat(this.pendingLayerIndex,"].visible"),!0),(0,i.default)(n,"activeLayerIndex",this.pendingLayerIndex),n)),this.pendingLayerIndex=null,this.pendingCurrentIndex=null)},loadImageForIndex:function(t,n){var r=this,o=this.postList[t];if(o){var a=o.poemBgImage||o.imageUrls&&o.imageUrls[0]||"";if(a){var s=getApp();if(s.globalData.preloadedImages&&s.globalData.preloadedImages[a])return e("log","\u4f7f\u7528\u5168\u5c40\u9884\u52a0\u8f7d\u7f13\u5b58:",a," at pages/mountain/mountain.vue:621"),this.setData((0,i.default)({},"preloadedImages.".concat(a),s.globalData.preloadedImages[a])),void("function"===typeof n&&n(s.globalData.preloadedImages[a]));if(!this.preloadedImages[a]){e("log","\u5f00\u59cb\u9884\u52a0\u8f7d\u5c71\u56fe\u7247:",a," at pages/mountain/mountain.vue:635");var u="undefined"!==typeof window;if(u&&(a.includes("tcb.qcloud.la")||a.includes("cloudbase")))return e("log","\ud83d\udd0d [H5] \u5c71\u9875\u9762\u68c0\u6d4b\u5230\u817e\u8baf\u4e91\u5b58\u50a8URL\uff0c\u76f4\u63a5\u4f7f\u7528:",a," at pages/mountain/mountain.vue:640"),this.setData((0,i.default)({},"preloadedImages.".concat(a),a)),void("function"===typeof n&&n(a));uni.downloadFile({url:a,success:function(t){200===t.statusCode&&(e("log","\u5c71\u56fe\u7247\u9884\u52a0\u8f7d\u6210\u529f:",a," at pages/mountain/mountain.vue:656"),r.setData((0,i.default)({},"preloadedImages.".concat(a),t.tempFilePath)),"function"===typeof n&&n(t.tempFilePath))},fail:function(t){e("error","\u5c71\u56fe\u7247\u9884\u52a0\u8f7d\u5931\u8d25:",a,t," at pages/mountain/mountain.vue:667"),u&&(e("log","\ud83d\udd0d [H5] \u5c71\u9875\u9762\u9884\u52a0\u8f7d\u5931\u8d25\uff0c\u4f7f\u7528\u539fURL:",a," at pages/mountain/mountain.vue:670"),r.setData((0,i.default)({},"preloadedImages.".concat(a),a)),"function"===typeof n&&n(a))}})}}}},testImageUrls:function(){e("log","\u5360\u4f4d\uff1a\u51fd\u6570 testImageUrls \u672a\u58f0\u660e"," at pages/mountain/mountain.vue:683")}}};t.default=l,t.default.components=Object.assign({skeleton:s.default,"folder-selector":u.default},t.default.components||{})}).call(this,n("f3b9")["default"])},"75e5":function(e,t,n){var r=n("8a60");e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},"761f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCacheByEnvId=function(e){return a[e]},t.getLocalCache=function(e){return s[e]},t.initCache=function(e){var t=e.env,n=e.platformInfo,r="".concat("user_info","_").concat(t),u={userInfoKey:r};a[t]=a[t]||new o(i(i({},e),{keys:u,platformInfo:n})),s[t]=s[t]||new o(i(i({},e),{keys:u,platformInfo:n,persistence:"local"}))};var r=n("5c02"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=r.cache.CloudbaseCache,a={},s={}},7647:function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports["default"]=e.exports,n(t,r)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"766b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERRORS=void 0;t.ERRORS={CREATE_WATCH_NET_ERROR:{code:"CREATE_WATCH_NET_ERROR",message:"create watch network error"},CREATE_WACTH_EXCEED_ERROR:{code:"CREATE_WACTH_EXCEED_ERROR",message:"maximum connections exceed"},CREATE_WATCH_SERVER_ERROR:{code:"CREATE_WATCH_SERVER_ERROR",message:"create watch server error"},CONN_ERROR:{code:"CONN_ERROR",message:"connection error"},INVALID_PARAM:{code:"INVALID_PARAM",message:"Invalid request param"},INSERT_DOC_FAIL:{code:"INSERT_DOC_FAIL",message:"insert document failed"},DATABASE_TRANSACTION_CONFLICT:{code:"DATABASE_TRANSACTION_CONFLICT",message:"database transaction conflict"}}},"76db":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HunYuanSimpleModel=void 0;var r=n("7a9b"),i=n("31a3"),o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},u=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="hunyuan",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e,t){return a(this,void 0,void 0,(function(){var n,r;return s(this,(function(a){switch(a.label){case 0:return[4,this.req({url:this.url,headers:{"X-Tc-Action":"ChatCompletions"},data:o(o({},(0,i.processInput)(e)),{stream:!1}),stream:!1,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=a.sent(),r=(0,i.titleCaseToSnakeCase)(n.Response),[2,o(o({},r),{rawResponse:n})]}}))}))},e.prototype.doStream=function(e,t){return a(this,void 0,void 0,(function(){var n,a,u,c,l;return s(this,(function(s){switch(s.label){case 0:return n=null,[4,this.req({url:this.url,headers:{"X-Tc-Action":"ChatCompletions"},data:o(o({},e),{stream:!0}),stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return a=s.sent(),u=(0,r.toPolyfillReadable)(a),c=(0,r.intoStandardStream)(u),l=c.pipeThrough(new r.TransformStream({transform:function(e,t){var a=(0,i.titleCaseToSnakeCase)(e),s=a.choices.map((function(e){var t=e.delta;return null==n&&(n=(0,r.isToolCallAssistantMessage)(t)),n?o(o({},e),{finish_reason:"tool_calls",delta:t}):e})),u=o(o({},a),{choices:s});t.enqueue(o(o({},u),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(l)]}}))}))},e}();t.HunYuanSimpleModel=u},"76e0":function(e,t,n){var r=n("5b12"),i=n("745a"),o=n("241b"),a=n("d87b"),s=n("75e5");function u(e){var t=-1,n=null==e?0:e.length;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype["delete"]=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},"770b":function(e,t,n){var r=n("f3ab"),i=n("4bba"),o=n("0dcd"),a=o&&o.isMap,s=a?i(a):r;e.exports=s},7744:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return Object(e)!==e||(Array.isArray(t)||(t=t.toString().match(/[^.[\]]+/g)||[]),t.slice(0,-1).reduce((function(e,n,r){return Object(e[n])===e[n]?e[n]:e[n]=Math.abs(t[r+1])>>0===+t[r+1]?[]:{}}),e)[t[t.length-1]]=n),e};t.default=r},7766:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[e._$s(1,"i",e.isLoading&&0===e.userPosts.length)?n("view",{staticClass:e._$s(1,"sc","loading-container"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","loading-text"),attrs:{_i:2}})]):n("view",{attrs:{_i:3}},[n("view",{staticClass:e._$s(4,"sc","profile-card"),attrs:{_i:4}},[n("view",{staticClass:e._$s(5,"sc","profile-avatar"),attrs:{_i:5}},[n("image",{attrs:{src:e._$s(6,"a-src",e.userInfo.avatarUrl||"/static/images/avatar.png"),_i:6},on:{error:e.onAvatarError}})]),n("view",{staticClass:e._$s(7,"sc","profile-info"),attrs:{_i:7}},[n("text",{staticClass:e._$s(8,"sc","profile-name"),attrs:{_i:8}},[e._v(e._$s(8,"t0-0",e._s(e.userInfo.nickName||"\u5fae\u4fe1\u7528\u6237")))]),n("text",{staticClass:e._$s(9,"sc","profile-bio"),attrs:{_i:9}},[e._v(e._$s(9,"t0-0",e._s(e.userInfo.bio||"\u8fd9\u4e2a\u7528\u6237\u5f88\u61d2\uff0c\u4ec0\u4e48\u90fd\u6ca1\u7559\u4e0b...")))])]),e._$s(10,"i",e.showFollowButton)?n("button",{class:e._$s(10,"c","profile-follow-btn "+(e.isFollowing?"following":"")),attrs:{loading:e._$s(10,"a-loading",e.followPending),disabled:e._$s(10,"a-disabled",e.followPending),_i:10},on:{click:e.onFollowTap}},[e._v(e._$s(10,"t0-0",e._s(e.isFollowing?"\u5df2\u5173\u6ce8":"\u5173\u6ce8")))]):e._e(),e._$s(11,"i",e.isMutualFollow)?n("view",{staticClass:e._$s(11,"sc","mutual-pill"),attrs:{_i:11}}):e._$s(12,"e",e.isFollowedByTarget)?n("view",{staticClass:e._$s(12,"sc","followed-pill"),attrs:{_i:12}}):e._e()]),n("view",{staticClass:e._$s(13,"sc","posts-section"),attrs:{_i:13}},[n("view",{staticClass:e._$s(14,"sc","section-title"),attrs:{_i:14}}),e._$s(15,"i",e.userPosts.length>0)?[e._l(e._$s(16,"f",{forItems:e.userPosts}),(function(t,r,i,o){return n("view",{key:e._$s(16,"f",{forIndex:i,key:r}),staticClass:e._$s("16-"+o,"sc","post-card"),attrs:{"data-id":e._$s("16-"+o,"a-data-id",t._id),_i:"16-"+o},on:{click:e.navigateToPostDetail}},[n("view",{staticClass:e._$s("17-"+o,"sc","post-header"),attrs:{_i:"17-"+o}},[n("text",{staticClass:e._$s("18-"+o,"sc","post-title"),attrs:{_i:"18-"+o}},[e._v(e._$s("18-"+o,"t0-0",e._s(t.title)))])]),e._$s("19-"+o,"i",t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("19-"+o,"sc","image-container"),attrs:{_i:"19-"+o}},[e._$s("20-"+o,"i",t.imageUrls.length>1)?[n("swiper",{staticClass:e._$s("21-"+o,"sc","image-swiper"),style:e._$s("21-"+o,"s","width: 100%; height: "+(e.swiperHeights[r]?e.swiperHeights[r]+"px":"220px")+";"),attrs:{id:e._$s("21-"+o,"a-id","swiper-"+r),_i:"21-"+o}},[e._l(e._$s("22-"+o,"f",{forItems:t.imageUrls}),(function(i,a,s,u){return[n("swiper-item",{key:e._$s("22-"+o,"f",{forIndex:s,keyIndex:0,key:a+"_0"})},[n("image",{staticClass:e._$s("24-"+o+"-"+u,"sc","post-image"),attrs:{id:e._$s("24-"+o+"-"+u,"a-id","user-swiper-img-"+r+"-"+a),src:e._$s("24-"+o+"-"+u,"a-src",i),"data-src":e._$s("24-"+o+"-"+u,"a-data-src",i),"data-original-image-urls":e._$s("24-"+o+"-"+u,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),"data-postindex":e._$s("24-"+o+"-"+u,"a-data-postindex",r),"data-imgindex":e._$s("24-"+o+"-"+u,"a-data-imgindex",a),_i:"24-"+o+"-"+u},on:{error:e.onImageError,load:e.onImageLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._$s("25-"+o,"e",1===t.imageUrls.length)?[n("image",{staticClass:e._$s("26-"+o,"sc","post-image"),style:e._$s("26-"+o,"s","width: 100%; height: "+(e.imageClampHeights[r]?e.imageClampHeights[r]+"px":"auto")+"; object-fit: "+(e.imageClampHeights[r]?"cover":"contain")+"; background-color: #f0f0f0;"),attrs:{id:e._$s("26-"+o,"a-id","single-image-"+r),src:e._$s("26-"+o,"a-src",t.imageUrls[0]),mode:e._$s("26-"+o,"a-mode",e.imageClampHeights[r]?"aspectFill":"widthFix"),"data-src":e._$s("26-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("26-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),"data-postindex":e._$s("26-"+o,"a-data-postindex",r),_i:"26-"+o},on:{error:e.onImageError,load:e.onImageLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})]:e._e()],2):e._e(),e._$s("27-"+o,"i",t.content)?n("view",{staticClass:e._$s("27-"+o,"sc","post-content"),attrs:{_i:"27-"+o}},[e._v(e._$s("27-"+o,"t0-0",e._s(t.content)))]):e._e(),n("view",{staticClass:e._$s("28-"+o,"sc","post-footer"),attrs:{_i:"28-"+o}},[n("view",{staticClass:e._$s("29-"+o,"sc","post-stats"),attrs:{_i:"29-"+o}},[n("text",{staticClass:e._$s("30-"+o,"sc","stat-item"),attrs:{_i:"30-"+o}},[e._v(e._$s("30-"+o,"t0-0",e._s(t.votes||0)))]),n("text",{staticClass:e._$s("31-"+o,"sc","stat-item"),attrs:{_i:"31-"+o}},[e._v(e._$s("31-"+o,"t0-0",e._s(t.commentCount||0)))])]),n("view",{staticClass:e._$s("32-"+o,"sc","post-time"),attrs:{_i:"32-"+o}},[e._v(e._$s("32-"+o,"t0-0",e._s(t.formattedCreateTime)))])])])})),e._$s(33,"i",e.isLoading&&e.userPosts.length>0)?n("view",{staticClass:e._$s(33,"sc","loading-container"),attrs:{_i:33}},[n("view",{staticClass:e._$s(34,"sc","loading-text"),attrs:{_i:34}})]):e._e(),n("view")]:n("view",{staticClass:e._$s(36,"sc","empty-tip"),attrs:{_i:36}},[n("text")])],2)])])},i=[]},7785:function(e,t,n){var r=n("2024"),i=n("4d0d"),o=r(i,"DataView");e.exports=o},"785a":function(e,t,n){var r=n("fa08"),i=function(){var e=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();e.exports=function(e){return!!i&&i in e}},"78fe":function(e,t,n){var r=n("8073"),i=n("5271");e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},7952:function(e,t,n){var r=n("7426"),i=Object.prototype,o=i.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return o.call(t,e)?t[e]:void 0}},"7a38":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={pages:[{path:"pages/splash/splash",style:{usingComponents:{},navigationStyle:"custom"}},{path:"pages/login/login",style:{usingComponents:{}}},{path:"pages/register/register",style:{usingComponents:{}}},{path:"pages/my-likes/my-likes",style:{navigationBarTitleText:"\u6211\u7684\u70b9\u8d5e",enablePullDownRefresh:!0,usingComponents:{}}},{path:"pages/index/index",style:{navigationBarTitleText:"\u56de\u8f66\u952e",enablePullDownRefresh:!0,usingComponents:{skeleton:"/components/skeleton/skeleton"}}},{path:"pages/poem/poem",style:{usingComponents:{skeleton:"/components/skeleton/skeleton","folder-selector":"/components/folder-selector/folder-selector"},navigationBarTitleText:"\u8def"}},{path:"pages/mountain/mountain",style:{usingComponents:{skeleton:"/components/skeleton/skeleton","folder-selector":"/components/folder-selector/folder-selector"},navigationBarTitleText:"\u5c71"}},{path:"pages/profile/profile",style:{navigationBarTitleText:"\u6211\u7684",enablePullDownRefresh:!0,backgroundTextStyle:"dark",usingComponents:{}}},{path:"pages/following/following",style:{navigationBarTitleText:"\u6211\u5173\u6ce8\u7684\u4eba",enablePullDownRefresh:!0,usingComponents:{}}},{path:"pages/fans/fans",style:{navigationBarTitleText:"\u6211\u7684\u7c89\u4e1d",enablePullDownRefresh:!0,usingComponents:{}}},{path:"pages/user-profile/user-profile",style:{usingComponents:{},navigationBarTitleText:"\u7528\u6237\u4e3b\u9875",enablePullDownRefresh:!0,onReachBottomDistance:50}},{path:"pages/profile-edit/profile-edit",style:{navigationBarTitleText:"\u7f16\u8f91\u4e2a\u4eba\u8d44\u6599",usingComponents:{}}},{path:"pages/post-detail/post-detail",style:{navigationBarTitleText:"\u5e16\u5b50\u8be6\u60c5",usingComponents:{"cloud-tip-modal":"/components/cloudTipModal/index","folder-selector":"/components/folder-selector/folder-selector"}}},{path:"pages/add/add",style:{usingComponents:{}}},{path:"pages/favorite-folders/favorite-folders",style:{usingComponents:{},navigationBarTitleText:"\u6211\u7684\u6536\u85cf\u5939"}},{path:"pages/favorite-content/favorite-content",style:{usingComponents:{},enablePullDownRefresh:!0,onReachBottomDistance:50}},{path:"pages/messages/messages",style:{navigationBarTitleText:"\u6d88\u606f\u901a\u77e5",enablePullDownRefresh:!0,backgroundColor:"#f8f9fa",backgroundTextStyle:"dark",usingComponents:{}}},{path:"pages/image-manager/image-manager",style:{navigationBarTitleText:"\u56fe\u7247\u7ba1\u7406",usingComponents:{}}},{path:"pages/tag-filter/tag-filter",style:{usingComponents:{skeleton:"/components/skeleton/skeleton"},enablePullDownRefresh:!0,onReachBottomDistance:50}},{path:"pages/search/search",style:{usingComponents:{skeleton:"/components/skeleton/skeleton"},navigationBarTitleText:"\u641c\u7d22",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f7f8fa"}},{path:"pages/draft-box/draft-box",style:{usingComponents:{},navigationBarTitleText:"\u8349\u7a3f\u7bb1"}},{path:"pages/feedback/feedback",style:{navigationBarTitleText:"\u610f\u89c1\u53cd\u9988",navigationStyle:"custom",backgroundColor:"#f5f5f5",usingComponents:{}}},{path:"pages/feedback-admin/feedback-admin",style:{navigationBarTitleText:"\u53cd\u9988\u7ba1\u7406",navigationStyle:"custom",backgroundColor:"#f5f5f5",enablePullDownRefresh:!0,usingComponents:{}}}],tabBar:{custom:!1,color:"#999999",selectedColor:"#9ed7ee",backgroundColor:"#ffffff",borderStyle:"black",list:[{pagePath:"pages/index/index",text:"\u5e7f\u573a",iconPath:"static/images/market.png",selectedIconPath:"static/images/marketplus.png"},{pagePath:"pages/poem/poem",text:"\u8def",iconPath:"static/images/road.png",selectedIconPath:"static/images/roadplus.png"},{pagePath:"pages/mountain/mountain",text:"\u5c71",iconPath:"static/images/mountain.png",selectedIconPath:"static/images/mountainplus.png"},{pagePath:"pages/profile/profile",text:"\u6e56",iconPath:"static/images/pools.png",selectedIconPath:"static/images/poolsplus.png"}]},sitemapLocation:"sitemap.json",style:"v2",lazyCodeLoading:"requiredComponents",globalStyle:{backgroundColor:"#F6F6F6",backgroundTextStyle:"light",navigationBarBackgroundColor:"#F6F6F6",navigationBarTitleText:"\u56de\u8f66\u952e",navigationBarTextStyle:"black"},subPackages:[]}},"7a72":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r={lazyGetEntity:!0,registerModel:!0};t.lazyGetEntity=d,t.registerModel=function(t){try{t.registerComponent(p)}catch(n){e("warn",n," at node_modules/@cloudbase/model/dist/esm/index.js:117")}};var i=n("8b28");Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var o=n("5c02"),a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a.apply(this,arguments)},s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},c=o.events.CloudbaseEventEmitter;var l=new WeakMap;function d(e){return new Proxy({},{get:function(t,n){var r=e.getEndPointWithKey("GATEWAY"),o=r.BASE_URL,c=r.PROTOCOL,d=a(a({},e),{BASE_URL:o,PROTOCOL:c}),f=l.get(d);return f||(f=function(e){var t=this,n=e.callFunction.bind(e),r=e.request.fetch.bind(e.request),o=e.getEndPointWithKey("GATEWAY"),c=o.BASE_URL,l=o.PROTOCOL,d="".concat(l).concat(c,"/model"),f="".concat(l).concat(c,"/sql"),p=(0,i.generateHTTPClient)(n,(function(e){return s(t,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return[4,r(a(a({},e),{headers:a({"Content-Type":"application/json"},e.headers)}))];case 1:return t=n.sent(),[4,t.data];case 2:return[2,n.sent()]}}))}))}),d,{sqlBaseUrl:f});return p}(e),l.set(d,f)),f[n]}})}var f=new c;f.on("cloudbase_init",(function(e){var t=e.data;Object.assign(t,{models:d(t)})}));var p={name:"models",namespace:"models",entity:new Proxy({},{get:function(t,n){e("warn","\u3010deprecated\u3011Accessing Cloudbase.prototype.models.".concat(n,".")," at node_modules/@cloudbase/model/dist/esm/index.js:100")}}),injectEvents:{bus:f,events:["cloudbase_init"]}};try{cloudbase.registerComponent(p)}catch(h){}}).call(this,n("f3b9")["default"])},"7a9b":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.TransformStream=t.TextDecoderStream=t.ReadableStream=void 0,t.createAsyncIterable=g,t.createEventSourceParserTransformStream=void 0,t.createPromise=function(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return{promise:n,res:e,rej:t}},t.functionToolToModelTool=function(e){return{type:"function",function:{description:e.description,name:e.name,parameters:e.parameters}}},t.intoStandardStream=function(t){return g(t.pipeThrough(new h).pipeThrough(f()).pipeThrough(new d({transform:function(t,n){try{var r=JSON.parse(t.data);n.enqueue(r)}catch(i){"[DONE]"!==t.data?e("warn","Error when transforming event source data to json",i,t," at node_modules/@cloudbase/ai/dist/esm/utils.js:167"):n.terminate()}}})))},t.intoTextStream=v,t.isToolCallAssistantMessage=function(e){var t;return"assistant"===e.role&&"tool_calls"in e&&null!=(null===(t=e.tool_calls)||void 0===t?void 0:t[0])},t.readableStream2JsonObject=function(e){var t,n,r,i;return s(this,void 0,void 0,(function(){var o,a,s,l,d,f,p;return u(this,(function(u){switch(u.label){case 0:o=v(e),a="",u.label=1;case 1:u.trys.push([1,6,7,12]),s=!0,l=c(o),u.label=2;case 2:return[4,l.next()];case 3:if(d=u.sent(),t=d.done,t)return[3,5];i=d.value,s=!1;try{f=i,a+=f}finally{s=!0}u.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return p=u.sent(),n={error:p},[3,12];case 7:return u.trys.push([7,,10,11]),s||t||!(r=l.return)?[3,9]:[4,r.call(l)];case 8:u.sent(),u.label=9;case 9:return[3,11];case 10:if(n)throw n.error;return[7];case 11:return[7];case 12:return[2,JSON.parse(a)]}}))}))},t.toPolyfillReadable=void 0;var r=n("f37f"),i=n("15ee"),o=n("6caf"),a=n("8b5e"),s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},c=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){t=e[n](t),function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,t.done,t.value)}))}}},l=r.ReadableStream;t.ReadableStream=l;var d=r.TransformStream;t.TransformStream=d;var f=function(){var e;return new d({start:function(t){e=(0,o.createParser)((function(e){"event"===e.type&&t.enqueue(e)}))},transform:function(t){e.feed(t)}})};t.createEventSourceParserTransformStream=f;var p=(0,i.createReadableStreamWrapper)(l);t.toPolyfillReadable=p;var h=function(){function e(e,t){void 0===e&&(e="utf-8"),void 0===t&&(t={});var n=this;this.transform=new d({transform:function(e,t){var r=n.handle.decode(new Uint8Array(e),{stream:!0});r&&t.enqueue(r)},flush:function(e){var t=n.handle.decode();t&&e.enqueue(t),e.terminate()}}),this.handle=new a.TextDecoder(e,t)}return Object.defineProperty(e.prototype,"encoding",{get:function(){return this.handle.encoding},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fatal",{get:function(){return this.handle.fatal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ignoreBOM",{get:function(){return this.handle.ignoreBOM},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readable",{get:function(){return this.transform.readable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"writable",{get:function(){return this.transform.writable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"TextDecoderStream"},enumerable:!1,configurable:!0}),e}();function g(e){var t=e;return t[Symbol.asyncIterator]=function(){var t=e.getReader();return{next:function(){return s(this,void 0,void 0,(function(){var e,n,r;return u(this,(function(i){switch(i.label){case 0:return[4,t.read()];case 1:return e=i.sent(),n=e.done,r=e.value,[2,n?{done:!0,value:void 0}:{done:!1,value:r}]}}))}))}}},t}function v(e){return g(p(e).pipeThrough(new h))}t.TextDecoderStream=h}).call(this,n("f3b9")["default"])},"7ab1":function(e,t,n){(function(t){e.exports={compressAvatar:function(e){return new Promise((function(n,r){uni.getSystemInfo({success:function(i){i.pixelRatio;var o=i.system,a=/(ios)/gi.test(o),s={maxWidth:200,maxHeight:200,quality:a?.3:.2,maxSize:51200};t("log","\u5f00\u59cb\u538b\u7f29\u5934\u50cf\uff0c\u539f\u59cb\u8def\u5f84:",e," at utils/avatarCompress.js:26"),t("log","\u538b\u7f29\u914d\u7f6e:",s," at utils/avatarCompress.js:27"),uni.getImageInfo({src:e,success:function(i){t("log","\u539f\u59cb\u56fe\u7247\u4fe1\u606f:",{width:i.width,height:i.height,path:i.path}," at utils/avatarCompress.js:33");var o=i.width,a=i.height,u=s.maxWidth,c=s.maxHeight;if(o>u||a>c){var l=Math.min(u/o,c/a);o=Math.floor(o*l),a=Math.floor(a*l)}t("log","\u538b\u7f29\u540e\u5c3a\u5bf8:",{width:o,height:a}," at utils/avatarCompress.js:49");var d=uni.createCanvasContext("avatarCompressCanvas");d.drawImage(e,0,0,o,a),d.draw(!1,(function(){uni.canvasToTempFilePath({canvasId:"avatarCompressCanvas",x:0,y:0,width:o,height:a,destWidth:o,destHeight:a,fileType:"jpg",quality:s.quality,success:function(e){t("log","Canvas\u538b\u7f29\u5b8c\u6210\uff0c\u4e34\u65f6\u6587\u4ef6:",e.tempFilePath," at utils/avatarCompress.js:73"),uni.getFileInfo({filePath:e.tempFilePath,success:function(r){t("log","\u538b\u7f29\u540e\u6587\u4ef6\u5927\u5c0f:",(r.size/1024).toFixed(2),"KB"," at utils/avatarCompress.js:79"),r.size>s.maxSize?(t("log","\u6587\u4ef6\u4ecd\u7136\u8fc7\u5927\uff0c\u4f7f\u7528wx.compressImage\u8fdb\u4e00\u6b65\u538b\u7f29"," at utils/avatarCompress.js:83"),uni.compressImage({src:e.tempFilePath,quality:.1,success:function(e){t("log","\u6700\u7ec8\u538b\u7f29\u5b8c\u6210:",e.tempFilePath," at utils/avatarCompress.js:89"),n(e.tempFilePath)},fail:function(r){t("error","wx.compressImage\u538b\u7f29\u5931\u8d25:",r," at utils/avatarCompress.js:93"),n(e.tempFilePath)}})):n(e.tempFilePath)},fail:function(r){t("error","\u83b7\u53d6\u538b\u7f29\u540e\u6587\u4ef6\u4fe1\u606f\u5931\u8d25:",r," at utils/avatarCompress.js:103"),n(e.tempFilePath)}})},fail:function(i){t("error","Canvas\u538b\u7f29\u5931\u8d25:",i," at utils/avatarCompress.js:109"),uni.compressImage({src:e,quality:s.quality,success:function(e){t("log","\u5907\u9009\u538b\u7f29\u5b8c\u6210:",e.tempFilePath," at utils/avatarCompress.js:115"),n(e.tempFilePath)},fail:function(e){t("error","\u5907\u9009\u538b\u7f29\u4e5f\u5931\u8d25:",e," at utils/avatarCompress.js:119"),r(e)}})}})}))},fail:function(i){t("error","\u83b7\u53d6\u56fe\u7247\u4fe1\u606f\u5931\u8d25:",i," at utils/avatarCompress.js:128"),uni.compressImage({src:e,quality:s.quality,success:function(e){t("log","\u76f4\u63a5\u538b\u7f29\u5b8c\u6210:",e.tempFilePath," at utils/avatarCompress.js:134"),n(e.tempFilePath)},fail:function(e){t("error","\u76f4\u63a5\u538b\u7f29\u5931\u8d25:",e," at utils/avatarCompress.js:138"),r(e)}})}})},fail:function(e){t("error","\u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\u5931\u8d25:",e," at utils/avatarCompress.js:146"),r(e)}})}))},createAvatarCompressCanvas:function(){}}}).call(this,n("f3b9")["default"])},"7ba2":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRuntime=function(){return i},t.getWsClass=function(){return r},t.setRuntime=function(e){i=e},t.setWsClass=function(e){r=e};var r=null,i="web"},"7c29":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction=void 0,t.runTransaction=function e(t,n){void 0===n&&(n=3);return a(this,void 0,void 0,(function(){var r,i,c,l,d=this;return s(this,(function(f){switch(f.label){case 0:return f.trys.push([0,4,,10]),r=new u(this),[4,r.init()];case 1:return f.sent(),[4,t(r)];case 2:if(i=f.sent(),!0===r.aborted)throw r.abortReason;return[4,r.commit()];case 3:return f.sent(),[2,i];case 4:if(c=f.sent(),!1===r.inited)throw c;return l=function(e){return a(d,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:if(r.aborted||r.commited)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.rollback()];case 2:return t.sent(),[3,4];case 3:return t.sent(),[3,4];case 4:throw e;case 5:if(!0===r.aborted)throw r.abortReason;throw e}}))}))},n<=0?[4,l(c)]:[3,6];case 5:f.sent(),f.label=6;case 6:return c&&c.code===o.ERRORS.DATABASE_TRANSACTION_CONFLICT.code?[4,e.bind(this)(t,--n)]:[3,8];case 7:return[2,f.sent()];case 8:return[4,l(c)];case 9:return f.sent(),[3,10];case 10:return[2]}}))}))},t.startTransaction=function(){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=new u(this),[4,e.init()];case 1:return t.sent(),[2,e]}}))}))};var r=n("b8e2"),i=n("563d"),o=n("766b"),a=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},u=function(){function e(e){this._db=e,this._request=new r.Db.reqClass(this._db.config),this.aborted=!1,this.commited=!1,this.inited=!1}return e.prototype.init=function(){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,this._request.send("database.startTransaction")];case 1:if(e=t.sent(),e.code)throw e;return this.inited=!0,this._id=e.transactionId,[2]}}))}))},e.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new i.CollectionReference(this,e)},e.prototype.getTransactionId=function(){return this._id},e.prototype.getRequestMethod=function(){return this._request},e.prototype.commit=function(){return a(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e={transactionId:this._id},[4,this._request.send("database.commitTransaction",e)];case 1:if(t=n.sent(),t.code)throw t;return this.commited=!0,[2,t]}}))}))},e.prototype.rollback=function(e){return a(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t={transactionId:this._id},[4,this._request.send("database.abortTransaction",t)];case 1:if(n=r.sent(),n.code)throw n;return this.aborted=!0,this.abortReason=e,[2,n]}}))}))},e}();t.Transaction=u},"7c35":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERRORS=void 0;t.ERRORS={INVALID_PARAMS:"INVALID_PARAMS",INVALID_SYNTAX:"INVALID_SYNTAX",INVALID_OPERATION:"INVALID_OPERATION",OPERATION_FAIL:"OPERATION_FAIL",NETWORK_ERROR:"NETWORK_ERROR",UNKOWN_ERROR:"UNKOWN_ERROR"}},"7ca3":function(e,t,n){var r=n("d551");e.exports=function(e,t,n){return t=r(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports["default"]=e.exports},"7cca":function(e,t,n){var r=n("cc66");e.exports=function(e){var t=r(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},"7ce1":function(e,t,n){var r=n("b4d2"),i=n("7647"),o=n("4965"),a=n("931d");function s(t){var n="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports["default"]=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports["default"]=e.exports},"7da3":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"7f32":function(e,t,n){"use strict";n.r(t);var r=n("c649"),i=n("e89e");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"7fdd":function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},"804d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bus=t.LANG_CHANGE_EVENT=void 0;var r=n("0a32"),i=new r.CloudbaseEventEmitter;t.bus=i;t.LANG_CHANGE_EVENT="lang_change"},"806a":function(e,t,n){var r=n("6823"),i=n("c823");e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},8073:function(e,t,n){var r=n("7785"),i=n("3ce6"),o=n("6ced"),a=n("e4de"),s=n("6c86"),u=n("6823"),c=n("022f"),l=c(r),d=c(i),f=c(o),p=c(a),h=c(s),g=u;(r&&"[object DataView]"!=g(new r(new ArrayBuffer(1)))||i&&"[object Map]"!=g(new i)||o&&"[object Promise]"!=g(o.resolve())||a&&"[object Set]"!=g(new a)||s&&"[object WeakMap]"!=g(new s))&&(g=function(e){var t=u(e),n="[object Object]"==t?e.constructor:void 0,r=n?c(n):"";if(r)switch(r){case l:return"[object DataView]";case d:return"[object Map]";case f:return"[object Promise]";case p:return"[object Set]";case h:return"[object WeakMap]"}return t}),e.exports=g},8203:function(e,t,n){(function(e){var r=n("4d0d"),i=n("8307"),o=t&&!t.nodeType&&t,a=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=a&&a.exports===o,u=s?r.Buffer:void 0,c=u?u.isBuffer:void 0,l=c||i;e.exports=l}).call(this,n("dc84")(e))},8253:function(e,t,n){"use strict";n.r(t);var r=n("ca30"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"828b":function(e,t,n){"use strict";function r(e,t,n,r,i,o,a,s,u,c){var l,d="function"===typeof e?e.options:e;if(u){d.components||(d.components={});var f=Object.prototype.hasOwnProperty;for(var p in u)f.call(u,p)&&!f.call(d.components,p)&&(d.components[p]=u[p])}if(c&&("function"===typeof c.beforeCreate&&(c.beforeCreate=[c.beforeCreate]),(c.beforeCreate||(c.beforeCreate=[])).unshift((function(){this[c.__module]=this})),(d.mixins||(d.mixins=[])).push(c)),t&&(d.render=t,d.staticRenderFns=n,d._compiled=!0),r&&(d.functional=!0),o&&(d._scopeId="data-v-"+o),a?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},d._ssrRegister=l):i&&(l=s?function(){i.call(this,this.$root.$options.shadowRoot)}:i),l)if(d.functional){d._injectStyles=l;var h=d.render;d.render=function(e,t){return l.call(t),h(e,t)}}else{var g=d.beforeCreate;d.beforeCreate=g?[].concat(g,l):[l]}return{exports:e,options:d}}n.d(t,"a",(function(){return r}))},8307:function(e,t){e.exports=function(){return!1}},"831e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateSerializer=void 0;var r=n("3325"),i=n("a4d5"),o=n("8539"),a=n("f442"),s=n("eb9b"),u=function(){function e(){}return e.encode=function(t){var n=new e;return n.encodeUpdate(t)},e.prototype.encodeUpdate=function(e){return(0,r.isUpdateCommand)(e)?this.encodeUpdateCommand(e):"object"===(0,o.getType)(e)?this.encodeUpdateObject(e):e},e.prototype.encodeUpdateCommand=function(e){if(e.fieldName===i.SYMBOL_UNSET_FIELD_NAME)throw new Error("Cannot encode a comparison command with unset field name");switch(e.operator){case r.UPDATE_COMMANDS_LITERAL.PUSH:case r.UPDATE_COMMANDS_LITERAL.PULL:case r.UPDATE_COMMANDS_LITERAL.PULL_ALL:case r.UPDATE_COMMANDS_LITERAL.POP:case r.UPDATE_COMMANDS_LITERAL.SHIFT:case r.UPDATE_COMMANDS_LITERAL.UNSHIFT:case r.UPDATE_COMMANDS_LITERAL.ADD_TO_SET:return this.encodeArrayUpdateCommand(e);default:return this.encodeFieldUpdateCommand(e)}},e.prototype.encodeFieldUpdateCommand=function(e){var t,n,i,o,s=(0,a.operatorToString)(e.operator);switch(e.operator){case r.UPDATE_COMMANDS_LITERAL.REMOVE:return t={},t[s]=(n={},n[e.fieldName]="",n),t;default:return i={},i[s]=(o={},o[e.fieldName]=e.operands[0],o),i}},e.prototype.encodeArrayUpdateCommand=function(e){var t,n,i,u,c,l,d,f,p,h,g=(0,a.operatorToString)(e.operator);switch(e.operator){case r.UPDATE_COMMANDS_LITERAL.PUSH:var v=void 0;return v=(0,o.isArray)(e.operands)?{$each:e.operands.map(s.encodeInternalDataType)}:e.operands,t={},t[g]=(n={},n[e.fieldName]=v,n),t;case r.UPDATE_COMMANDS_LITERAL.UNSHIFT:v={$each:e.operands.map(s.encodeInternalDataType),$position:0};return i={},i[g]=(u={},u[e.fieldName]=v,u),i;case r.UPDATE_COMMANDS_LITERAL.POP:return c={},c[g]=(l={},l[e.fieldName]=1,l),c;case r.UPDATE_COMMANDS_LITERAL.SHIFT:return d={},d[g]=(f={},f[e.fieldName]=-1,f),d;default:return p={},p[g]=(h={},h[e.fieldName]=(0,s.encodeInternalDataType)(e.operands),h),p}},e.prototype.encodeUpdateObject=function(e){var t=(0,s.flattenQueryObject)(e);for(var n in t)if(!/^\$/.test(n)){var i=t[n];if((0,r.isUpdateCommand)(i)){t[n]=i._setFieldName(n);var o=this.encodeUpdateCommand(t[n]);(0,s.mergeConditionAfterEncode)(t,o,n)}else{t[n]=i=(0,s.encodeInternalDataType)(i);var a=new r.UpdateCommand(r.UPDATE_COMMANDS_LITERAL.SET,[i],n);o=this.encodeUpdateCommand(a);(0,s.mergeConditionAfterEncode)(t,o,n)}}return t},e}();t.UpdateSerializer=u},8360:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={appid:"__UNI__E0A1A41"}},8483:function(e,t,n){var r=n("3461"),i=n("e8c8"),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=function(e,t){if(r(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!i(e))||(a.test(e)||!o.test(e)||null!=t&&e in Object(t))}},"84be":function(e,t,n){"use strict";n.r(t);var r=n("e6db"),i=n("daaa");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"84ff":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("206c");Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}))},8539:function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.isString=t.isRegExp=t.isPromise=t.isPlainObject=t.isObject=t.isNumber=t.isInternalObject=t.isFunction=t.isDate=t.isArray=t.getType=void 0;var i=r(n("3b2d")),o=n("08b0"),a=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()};t.getType=a;t.isObject=function(e){return"object"===a(e)};t.isString=function(e){return"string"===a(e)};t.isNumber=function(e){return"number"===a(e)};t.isPromise=function(e){return"promise"===a(e)};t.isFunction=function(e){return"function"===typeof e};t.isArray=function(e){return Array.isArray(e)};t.isDate=function(e){return"date"===a(e)};t.isRegExp=function(e){return"regexp"===a(e)};t.isInternalObject=function(e){return e&&e._internalType instanceof o.InternalSymbol};t.isPlainObject=function(e){if("object"!==(0,i.default)(e)||null===e)return!1;var t=e;while(null!==Object.getPrototypeOf(t))t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}},"861b":function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.uniCloud=t.default=t.UniCloudError=void 0;var o=i(n("127e")),a=i(n("3352")),s=i(n("34cf")),u=i(n("3b2d")),c=i(n("af34")),l=i(n("ee10")),d=i(n("7ca3")),f=i(n("8ffa")),p=i(n("4ffb")),h=i(n("b4d2")),g=i(n("7ce1")),v=i(n("67ad")),m=i(n("0bdb")),y=i(n("7a38"));function _(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,d.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,h.default)(e);if(t){var i=(0,h.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,p.default)(this,n)}}function C(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof e||"undefined"!=typeof self&&self;var T=C((function(e,t){var n;e.exports=(n=n||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},i=r.lib={},o=i.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var a=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=a<<24-(r+o)%4*8}else for(o=0;o<i;o+=4)t[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],i=function(t){var n=987654321,r=4294967295;return function(){var i=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var s=i(4294967296*(n||e.random()));n=987654071*s(),r.push(4294967296*s()|0)}return new a.init(r,t)}}),s=r.enc={},u=s.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},c=s.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,s=i/(4*o),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,c=e.min(4*u,i);if(u){for(var l=0;l<u;l+=o)this._doProcessBlock(r,l);var d=r.splice(0,u);n.sigBytes-=c}return new a.init(d,c)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=r.algo={};return r}(Math),n)})),O=T,E=(C((function(e,t){var n;e.exports=(n=O,function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var u=a.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,a=e[t+0],u=e[t+1],p=e[t+2],h=e[t+3],g=e[t+4],v=e[t+5],m=e[t+6],y=e[t+7],_=e[t+8],b=e[t+9],w=e[t+10],S=e[t+11],I=e[t+12],C=e[t+13],T=e[t+14],O=e[t+15],E=o[0],x=o[1],P=o[2],k=o[3];E=c(E,x,P,k,a,7,s[0]),k=c(k,E,x,P,u,12,s[1]),P=c(P,k,E,x,p,17,s[2]),x=c(x,P,k,E,h,22,s[3]),E=c(E,x,P,k,g,7,s[4]),k=c(k,E,x,P,v,12,s[5]),P=c(P,k,E,x,m,17,s[6]),x=c(x,P,k,E,y,22,s[7]),E=c(E,x,P,k,_,7,s[8]),k=c(k,E,x,P,b,12,s[9]),P=c(P,k,E,x,w,17,s[10]),x=c(x,P,k,E,S,22,s[11]),E=c(E,x,P,k,I,7,s[12]),k=c(k,E,x,P,C,12,s[13]),P=c(P,k,E,x,T,17,s[14]),E=l(E,x=c(x,P,k,E,O,22,s[15]),P,k,u,5,s[16]),k=l(k,E,x,P,m,9,s[17]),P=l(P,k,E,x,S,14,s[18]),x=l(x,P,k,E,a,20,s[19]),E=l(E,x,P,k,v,5,s[20]),k=l(k,E,x,P,w,9,s[21]),P=l(P,k,E,x,O,14,s[22]),x=l(x,P,k,E,g,20,s[23]),E=l(E,x,P,k,b,5,s[24]),k=l(k,E,x,P,T,9,s[25]),P=l(P,k,E,x,h,14,s[26]),x=l(x,P,k,E,_,20,s[27]),E=l(E,x,P,k,C,5,s[28]),k=l(k,E,x,P,p,9,s[29]),P=l(P,k,E,x,y,14,s[30]),E=d(E,x=l(x,P,k,E,I,20,s[31]),P,k,v,4,s[32]),k=d(k,E,x,P,_,11,s[33]),P=d(P,k,E,x,S,16,s[34]),x=d(x,P,k,E,T,23,s[35]),E=d(E,x,P,k,u,4,s[36]),k=d(k,E,x,P,g,11,s[37]),P=d(P,k,E,x,y,16,s[38]),x=d(x,P,k,E,w,23,s[39]),E=d(E,x,P,k,C,4,s[40]),k=d(k,E,x,P,a,11,s[41]),P=d(P,k,E,x,h,16,s[42]),x=d(x,P,k,E,m,23,s[43]),E=d(E,x,P,k,b,4,s[44]),k=d(k,E,x,P,I,11,s[45]),P=d(P,k,E,x,O,16,s[46]),E=f(E,x=d(x,P,k,E,p,23,s[47]),P,k,a,6,s[48]),k=f(k,E,x,P,y,10,s[49]),P=f(P,k,E,x,T,15,s[50]),x=f(x,P,k,E,v,21,s[51]),E=f(E,x,P,k,I,6,s[52]),k=f(k,E,x,P,h,10,s[53]),P=f(P,k,E,x,w,15,s[54]),x=f(x,P,k,E,u,21,s[55]),E=f(E,x,P,k,_,6,s[56]),k=f(k,E,x,P,O,10,s[57]),P=f(P,k,E,x,m,15,s[58]),x=f(x,P,k,E,C,21,s[59]),E=f(E,x,P,k,g,6,s[60]),k=f(k,E,x,P,S,10,s[61]),P=f(P,k,E,x,p,15,s[62]),x=f(x,P,k,E,b,21,s[63]),o[0]=o[0]+E|0,o[1]=o[1]+x|0,o[2]=o[2]+P|0,o[3]=o[3]+k|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296),a=r;n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,u=s.words,c=0;c<4;c++){var l=u[c];u[c]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,n,r,i,o,a){var s=e+(t&n|~t&r)+i+a;return(s<<o|s>>>32-o)+t}function l(e,t,n,r,i,o,a){var s=e+(t&r|n&~r)+i+a;return(s<<o|s>>>32-o)+t}function d(e,t,n,r,i,o,a){var s=e+(t^n^r)+i+a;return(s<<o|s>>>32-o)+t}function f(e,t,n,r,i,o,a){var s=e+(n^(t|~r))+i+a;return(s<<o|s>>>32-o)+t}t.MD5=o._createHelper(u),t.HmacMD5=o._createHmacHelper(u)}(Math),n.MD5)})),C((function(e,t){var n;e.exports=(n=O,void function(){var e=n,t=e.lib.Base,r=e.enc.Utf8;e.algo.HMAC=t.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),a=this._iKey=t.clone(),s=o.words,u=a.words,c=0;c<n;c++)s[c]^=1549556828,u[c]^=909522486;o.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}())})),C((function(e,t){e.exports=O.HmacMD5}))),x=C((function(e,t){e.exports=O.enc.Utf8})),P=C((function(e,t){var n;e.exports=(n=O,function(){var e=n,t=e.lib.WordArray;function r(e,n,r){for(var i=[],o=0,a=0;a<n;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2,u=r[e.charCodeAt(a)]>>>6-a%4*2;i[o>>>2]|=(s|u)<<24-o%4*8,o++}return t.create(i,o)}e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;o<n;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<n;s++)i.push(r.charAt(a>>>6*(3-s)&63));var u=r.charAt(64);if(u)for(;i.length%4;)i.push(u);return i.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<n.length;o++)i[n.charCodeAt(o)]=o}var a=n.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return r(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),n.enc.Base64)})),k="uni_id_token",A="uni_id_token_expired",R={DEFAULT:"FUNCTION",FUNCTION:"FUNCTION",OBJECT:"OBJECT",CLIENT_DB:"CLIENT_DB"},D="pending",L="fulfilled",N="rejected";function M(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function $(e){return"object"===M(e)}function j(e){return"function"==typeof e}function U(e){return function(){try{return e.apply(e,arguments)}catch(e){console.error(e)}}}var F="REJECTED",B="NOT_PENDING",q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.createPromise,r=t.retryRule,i=void 0===r?F:r;(0,v.default)(this,e),this.createPromise=n,this.status=null,this.promise=null,this.retryRule=i}return(0,m.default)(e,[{key:"needRetry",get:function(){if(!this.status)return!0;switch(this.retryRule){case F:return this.status===N;case B:return this.status!==D}}},{key:"exec",value:function(){var e=this;return this.needRetry?(this.status=D,this.promise=this.createPromise().then((function(t){return e.status=L,Promise.resolve(t)}),(function(t){return e.status=N,Promise.reject(t)})),this.promise):this.promise}}]),e}(),W=function(){function e(){(0,v.default)(this,e),this._callback={}}return(0,m.default)(e,[{key:"addListener",value:function(e,t){this._callback[e]||(this._callback[e]=[]),this._callback[e].push(t)}},{key:"on",value:function(e,t){return this.addListener(e,t)}},{key:"removeListener",value:function(e,t){if(!t)throw new Error('The "listener" argument must be of type function. Received undefined');var n=this._callback[e];if(n){var r=function(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t)return n;return-1}(n,t);n.splice(r,1)}}},{key:"off",value:function(e,t){return this.removeListener(e,t)}},{key:"removeAllListener",value:function(e){delete this._callback[e]}},{key:"emit",value:function(e){for(var t=this._callback[e],n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(t)for(var o=0;o<t.length;o++)t[o].apply(t,r)}}]),e}();function H(e){return e&&"string"==typeof e?JSON.parse(e):e}var V=H([]),G="app",Y=(H(void 0),H([])||[]);try{(n("8360").default||n("8360")).appid}catch(Tr){}var K,z={};function J(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=z,n=e,Object.prototype.hasOwnProperty.call(t,n)||(z[e]=r),z[e]}"app"===G&&(z=uni._globalUniCloudObj?uni._globalUniCloudObj:uni._globalUniCloudObj={});var Q=["invoke","success","fail","complete"],X=J("_globalUniCloudInterceptor");function Z(e,t){X[e]||(X[e]={}),$(t)&&Object.keys(t).forEach((function(n){Q.indexOf(n)>-1&&function(e,t,n){var r=X[e][t];r||(r=X[e][t]=[]),-1===r.indexOf(n)&&j(n)&&r.push(n)}(e,n,t[n])}))}function ee(e,t){X[e]||(X[e]={}),$(t)?Object.keys(t).forEach((function(n){Q.indexOf(n)>-1&&function(e,t,n){var r=X[e][t];if(r){var i=r.indexOf(n);i>-1&&r.splice(i,1)}}(e,n,t[n])})):delete X[e]}function te(e,t){return e&&0!==e.length?e.reduce((function(e,n){return e.then((function(){return n(t)}))}),Promise.resolve()):Promise.resolve()}function ne(e,t){return X[e]&&X[e][t]||[]}function re(e){Z("callObject",e)}var ie=J("_globalUniCloudListener"),oe={RESPONSE:"response",NEED_LOGIN:"needLogin",REFRESH_TOKEN:"refreshToken"},ae={CLIENT_DB:"clientdb",CLOUD_FUNCTION:"cloudfunction",CLOUD_OBJECT:"cloudobject"};function se(e){return ie[e]||(ie[e]=[]),ie[e]}function ue(e,t){var n=se(e);n.includes(t)||n.push(t)}function ce(e,t){var n=se(e),r=n.indexOf(t);-1!==r&&n.splice(r,1)}function le(e,t){for(var n=se(e),r=0;r<n.length;r++)(0,n[r])(t)}var de,fe=!1;function pe(){return de||(de=new Promise((function(e){fe&&e(),function t(){if("function"==typeof getCurrentPages){var n=getCurrentPages();n&&n[0]&&(fe=!0,e())}fe||setTimeout((function(){t()}),30)}()})),de)}function he(e){var t={};for(var n in e){var r=e[n];j(r)&&(t[n]=U(r))}return t}var ge=function(e){(0,f.default)(n,e);var t=I(n);function n(e){var r;(0,v.default)(this,n);var i=e.message||e.errMsg||"unknown system error";return r=t.call(this,i),r.errMsg=i,r.code=r.errCode=e.code||e.errCode||"SYSTEM_ERROR",r.errSubject=r.subject=e.subject||e.errSubject,r.cause=e.cause,r.requestId=e.requestId,r}return(0,m.default)(n,[{key:"toJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!(e>=10))return e++,{errCode:this.errCode,errMsg:this.errMsg,errSubject:this.errSubject,cause:this.cause&&this.cause.toJson?this.cause.toJson(e):this.cause}}}]),n}((0,g.default)(Error));t.UniCloudError=ge;var ve,me,ye={request:function(e){return uni.request(e)},uploadFile:function(e){return uni.uploadFile(e)},setStorageSync:function(e,t){return uni.setStorageSync(e,t)},getStorageSync:function(e){return uni.getStorageSync(e)},removeStorageSync:function(e){return uni.removeStorageSync(e)},clearStorageSync:function(){return uni.clearStorageSync()},connectSocket:function(e){return uni.connectSocket(e)}};function _e(){return{token:ye.getStorageSync(k)||ye.getStorageSync("uniIdToken"),tokenExpired:ye.getStorageSync(A)}}function be(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.token,n=e.tokenExpired;t&&ye.setStorageSync(k,t),n&&ye.setStorageSync(A,n)}function we(){return ve||(ve="mp-weixin"===G&&r.canIUse("getAppBaseInfo")&&r.canIUse("getDeviceInfo")?S(S({},uni.getAppBaseInfo()),uni.getDeviceInfo()):uni.getSystemInfoSync()),ve}var Se={};function Ie(){var e=uni.getLocale&&uni.getLocale()||"en";if(me)return S(S(S({},Se),me),{},{locale:e,LOCALE:e});var t=we(),n=t.deviceId,r=t.osName,i=t.uniPlatform,o=t.appId,a=["appId","appLanguage","appName","appVersion","appVersionCode","appWgtVersion","browserName","browserVersion","deviceBrand","deviceId","deviceModel","deviceType","osName","osVersion","romName","romVersion","ua","hostName","hostVersion","uniPlatform","uniRuntimeVersion","uniRuntimeVersionCode","uniCompilerVersion","uniCompilerVersionCode"];for(var s in t)Object.hasOwnProperty.call(t,s)&&-1===a.indexOf(s)&&delete t[s];return me=S(S({PLATFORM:i,OS:r,APPID:o,DEVICEID:n},function(){var e,t;try{if(uni.getLaunchOptionsSync){if(uni.getLaunchOptionsSync.toString().indexOf("not yet implemented")>-1)return;var n=uni.getLaunchOptionsSync(),r=n.scene,i=n.channel;e=i,t=r}}catch(e){}return{channel:e,scene:t}}()),t),S(S(S({},Se),me),{},{locale:e,LOCALE:e})}var Ce,Te={sign:function(e,t){var n="";return Object.keys(e).sort().forEach((function(t){e[t]&&(n=n+"&"+t+"="+e[t])})),n=n.slice(1),E(n,t).toString()},wrappedRequest:function(e,t){return new Promise((function(n,r){t(Object.assign(e,{complete:function(e){e||(e={});var t=e.data&&e.data.header&&e.data.header["x-serverless-request-id"]||e.header&&e.header["request-id"];if(!e.statusCode||e.statusCode>=400){var i=e.data&&e.data.error&&e.data.error.code||"SYS_ERR",o=e.data&&e.data.error&&e.data.error.message||e.errMsg||"request:fail";return r(new ge({code:i,message:o,requestId:t}))}var a=e.data;if(a.error)return r(new ge({code:a.error.code,message:a.error.message,requestId:t}));a.result=a.data,a.requestId=t,delete a.data,n(a)}}))}))},toBase64:function(e){return P.stringify(x.parse(e))}},Oe=function(){function e(t){var n=this;(0,v.default)(this,e),["spaceId","clientSecret"].forEach((function(e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new Error("".concat(e," required"))})),this.config=Object.assign({},{endpoint:0===t.spaceId.indexOf("mp-")?"https://api.next.bspapp.com":"https://api.bspapp.com"},t),this.config.provider="aliyun",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.config.accessTokenKey="access_token_"+this.config.spaceId,this.adapter=ye,this._getAccessTokenPromiseHub=new q({createPromise:function(){return n.requestAuth(n.setupRequest({method:"serverless.auth.user.anonymousAuthorize",params:"{}"},"auth")).then((function(e){if(!e.result||!e.result.accessToken)throw new ge({code:"AUTH_FAILED",message:"\u83b7\u53d6accessToken\u5931\u8d25"});n.setAccessToken(e.result.accessToken)}))},retryRule:B})}return(0,m.default)(e,[{key:"hasAccessToken",get:function(){return!!this.accessToken}},{key:"setAccessToken",value:function(e){this.accessToken=e}},{key:"requestWrapped",value:function(e){return Te.wrappedRequest(e,this.adapter.request)}},{key:"requestAuth",value:function(e){return this.requestWrapped(e)}},{key:"request",value:function(e,t){var n=this;return Promise.resolve().then((function(){return n.hasAccessToken?t?n.requestWrapped(e):n.requestWrapped(e).catch((function(t){return new Promise((function(e,n){!t||"GATEWAY_INVALID_TOKEN"!==t.code&&"InvalidParameter.InvalidToken"!==t.code?n(t):e()})).then((function(){return n.getAccessToken()})).then((function(){var t=n.rebuildRequest(e);return n.request(t,!0)}))})):n.getAccessToken().then((function(){var t=n.rebuildRequest(e);return n.request(t,!0)}))}))}},{key:"rebuildRequest",value:function(e){var t=Object.assign({},e);return t.data.token=this.accessToken,t.header["x-basement-token"]=this.accessToken,t.header["x-serverless-sign"]=Te.sign(t.data,this.config.clientSecret),t}},{key:"setupRequest",value:function(e,t){var n=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),r={"Content-Type":"application/json"};return"auth"!==t&&(n.token=this.accessToken,r["x-basement-token"]=this.accessToken),r["x-serverless-sign"]=Te.sign(n,this.config.clientSecret),{url:this.config.requestUrl,method:"POST",data:n,dataType:"json",header:r}}},{key:"getAccessToken",value:function(){return this._getAccessTokenPromiseHub.exec()}},{key:"authorize",value:function(){var e=(0,l.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getAccessToken();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"callFunction",value:function(e){var t={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:e.name,functionArgs:e.data||{}})};return this.request(S(S({},this.setupRequest(t)),{},{timeout:e.timeout}))}},{key:"getOSSUploadOptionsFromPath",value:function(e){var t={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}},{key:"uploadFileToOSS",value:function(e){var t=this,n=e.url,r=e.formData,i=e.name,o=e.filePath,a=e.fileType,s=e.onUploadProgress;return new Promise((function(e,u){var c=t.adapter.uploadFile({url:n,formData:r,name:i,filePath:o,fileType:a,header:{"X-OSS-server-side-encrpytion":"AES256"},success:function(t){t&&t.statusCode<400?e(t):u(new ge({code:"UPLOAD_FAILED",message:"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"}))},fail:function(e){u(new ge({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"}))}});"function"==typeof s&&c&&"function"==typeof c.onProgressUpdate&&c.onProgressUpdate((function(e){s({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}},{key:"reportOSSUpload",value:function(e){var t={method:"serverless.file.resource.report",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}},{key:"uploadFile",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r,i,a,s,u,c,l,d,f,p,h,g,v,m,y,_,b,w,S,I,C;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.filePath,r=t.cloudPath,i=t.fileType,a=void 0===i?"image":i,s=t.cloudPathAsRealPath,u=void 0!==s&&s,c=t.onUploadProgress,l=t.config,"string"===M(r)){e.next=3;break}throw new ge({code:"INVALID_PARAM",message:"cloudPath\u5fc5\u987b\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b"});case 3:if(r=r.trim()){e.next=5;break}throw new ge({code:"INVALID_PARAM",message:"cloudPath\u4e0d\u53ef\u4e3a\u7a7a"});case 5:if(!/:\/\//.test(r)){e.next=7;break}throw new ge({code:"INVALID_PARAM",message:"cloudPath\u4e0d\u5408\u6cd5"});case 7:if(d=l&&l.envType||this.config.envType,!(u&&("/"!==r[0]&&(r="/"+r),r.indexOf("\\")>-1))){e.next=10;break}throw new ge({code:"INVALID_PARAM",message:"\u4f7f\u7528cloudPath\u4f5c\u4e3a\u8def\u5f84\u65f6\uff0ccloudPath\u4e0d\u53ef\u5305\u542b\u201c\\\u201d"});case 10:return e.next=12,this.getOSSUploadOptionsFromPath({env:d,filename:u?r.split("/").pop():r,fileId:u?r:void 0});case 12:return f=e.sent.result,p="https://"+f.cdnDomain+"/"+f.ossPath,h=f.securityToken,g=f.accessKeyId,v=f.signature,m=f.host,y=f.ossPath,_=f.id,b=f.policy,w=f.ossCallbackUrl,S={"Cache-Control":"max-age=2592000","Content-Disposition":"attachment",OSSAccessKeyId:g,Signature:v,host:m,id:_,key:y,policy:b,success_action_status:200},h&&(S["x-oss-security-token"]=h),w&&(I=JSON.stringify({callbackUrl:w,callbackBody:JSON.stringify({fileId:_,spaceId:this.config.spaceId}),callbackBodyType:"application/json"}),S.callback=Te.toBase64(I)),C={url:"https://"+f.host,formData:S,fileName:"file",name:"file",filePath:n,fileType:a},e.next=27,this.uploadFileToOSS(Object.assign({},C,{onUploadProgress:c}));case 27:if(!w){e.next=29;break}return e.abrupt("return",{success:!0,filePath:n,fileID:p});case 29:return e.next=31,this.reportOSSUpload({id:_});case 31:if(!e.sent.success){e.next=33;break}return e.abrupt("return",{success:!0,filePath:n,fileID:p});case 33:throw new ge({code:"UPLOAD_FAILED",message:"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"});case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTempFileURL",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.fileList;return new Promise((function(t,r){Array.isArray(n)&&0!==n.length||r(new ge({code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7d20\u5fc5\u987b\u662f\u975e\u7a7a\u7684\u5b57\u7b26\u4e32"})),e.getFileInfo({fileList:n}).then((function(e){t({fileList:n.map((function(t,n){var r=e.fileList[n];return{fileID:t,tempFileURL:r&&r.url||t}}))})}))}))}},{key:"getFileInfo",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n,r,i=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=t.fileList,Array.isArray(n)&&0!==n.length){e.next=3;break}throw new ge({code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7d20\u5fc5\u987b\u662f\u975e\u7a7a\u7684\u5b57\u7b26\u4e32"});case 3:return r={method:"serverless.file.resource.info",params:JSON.stringify({id:n.map((function(e){return e.split("?")[0]})).join(",")})},e.next=6,this.request(this.setupRequest(r));case 6:return e.t0=e.sent.result,e.abrupt("return",{fileList:e.t0});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Ee={init:function(e){var t=new Oe(e),n={signInAnonymously:function(){return t.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return n},t.customAuth=t.auth,t}},xe="undefined"!=typeof location&&"http:"===location.protocol?"http:":"https:";!function(e){e.local="local",e.none="none",e.session="session"}(Ce||(Ce={}));var Pe,ke=function(){},Ae=C((function(e,t){var n;e.exports=(n=O,function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,a=t.algo,s=[],u=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(s[i]=n(e.pow(r,.5))),u[i]=n(e.pow(r,1/3)),i++),r++}();var c=[],l=a.SHA256=o.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],d=n[6],f=n[7],p=0;p<64;p++){if(p<16)c[p]=0|e[t+p];else{var h=c[p-15],g=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,v=c[p-2],m=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;c[p]=g+c[p-7]+m+c[p-16]}var y=r&i^r&o^i&o,_=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),b=f+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&d)+u[p]+c[p];f=d,d=l,l=s,s=a+b|0,a=o,o=i,i=r,r=b+(_+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+f|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),n.SHA256)})),Re=Ae,De=C((function(e,t){e.exports=O.HmacSHA256})),Le=function(){var e;if(!Promise){e=function(){},e.promise={};var t=function(){throw new ge({message:'Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.'})};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var n=new Promise((function(t,n){e=function(e,r){return e?n(e):t(r)}}));return e.promise=n,e};function Ne(e){return void 0===e}function Me(e){return"[object Null]"===Object.prototype.toString.call(e)}function $e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/([\s\S]+)\s+(\u8bf7\u524d\u5f80\u4e91\u5f00\u53d1AI\u5c0f\u52a9\u624b\u67e5\u770b\u95ee\u9898\uff1a.*)/,"$1")}function je(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<e;r++)n+=t.charAt(Math.floor(62*Math.random()));return n}!function(e){e.WEB="web",e.WX_MP="wx_mp"}(Pe||(Pe={}));var Ue={adapter:null,runtime:void 0},Fe=["anonymousUuidKey"],Be=function(e){(0,f.default)(n,e);var t=I(n);function n(){var e;return(0,v.default)(this,n),e=t.call(this),Ue.adapter.root.tcbObject||(Ue.adapter.root.tcbObject={}),e}return(0,m.default)(n,[{key:"setItem",value:function(e,t){Ue.adapter.root.tcbObject[e]=t}},{key:"getItem",value:function(e){return Ue.adapter.root.tcbObject[e]}},{key:"removeItem",value:function(e){delete Ue.adapter.root.tcbObject[e]}},{key:"clear",value:function(){delete Ue.adapter.root.tcbObject}}]),n}(ke);function qe(e,t){switch(e){case"local":return t.localStorage||new Be;case"none":return new Be;default:return t.sessionStorage||new Be}}var We=function(){function e(t){if((0,v.default)(this,e),!this._storage){this._persistence=Ue.adapter.primaryStorage||t.persistence,this._storage=qe(this._persistence,Ue.adapter);var n="access_token_".concat(t.env),r="access_token_expire_".concat(t.env),i="refresh_token_".concat(t.env),o="anonymous_uuid_".concat(t.env),a="login_type_".concat(t.env),s="token_type_".concat(t.env),u="user_info_".concat(t.env);this.keys={accessTokenKey:n,accessTokenExpireKey:r,refreshTokenKey:i,anonymousUuidKey:o,loginTypeKey:a,userInfoKey:u,deviceIdKey:"device_id",tokenTypeKey:s}}}return(0,m.default)(e,[{key:"updatePersistence",value:function(e){if(e!==this._persistence){var t="local"===this._persistence;this._persistence=e;var n=qe(e,Ue.adapter);for(var r in this.keys){var i=this.keys[r];if(!t||!Fe.includes(r)){var o=this._storage.getItem(i);Ne(o)||Me(o)||(n.setItem(i,o),this._storage.removeItem(i))}}this._storage=n}}},{key:"setStore",value:function(e,t,n){if(this._storage){var r={version:n||"localCachev1",content:t},i=JSON.stringify(r);try{this._storage.setItem(e,i)}catch(e){throw e}}}},{key:"getStore",value:function(e,t){try{if(!this._storage)return}catch(e){return""}t=t||"localCachev1";var n=this._storage.getItem(e);return n&&n.indexOf(t)>=0?JSON.parse(n).content:""}},{key:"removeStore",value:function(e){this._storage.removeItem(e)}}]),e}(),He={},Ve={};function Ge(e){return He[e]}var Ye=(0,m.default)((function e(t,n){(0,v.default)(this,e),this.data=n||null,this.name=t})),Ke=function(e){(0,f.default)(n,e);var t=I(n);function n(e,r){var i;return(0,v.default)(this,n),i=t.call(this,"error",{error:e,data:r}),i.error=e,i}return(0,m.default)(n)}(Ye),ze=new(function(){function e(){(0,v.default)(this,e),this._listeners={}}return(0,m.default)(e,[{key:"on",value:function(e,t){return function(e,t,n){n[e]=n[e]||[],n[e].push(t)}(e,t,this._listeners),this}},{key:"off",value:function(e,t){return function(e,t,n){if(n&&n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}(e,t,this._listeners),this}},{key:"fire",value:function(e,t){if(e instanceof Ke)return console.error(e.error),this;var n="string"==typeof e?new Ye(e,t||{}):e,r=n.name;if(this._listens(r)){n.target=this;var i,o=this._listeners[r]?(0,c.default)(this._listeners[r]):[],a=_(o);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.call(this,n)}}catch(u){a.e(u)}finally{a.f()}}return this}},{key:"_listens",value:function(e){return this._listeners[e]&&this._listeners[e].length>0}}]),e}());function Je(e,t){ze.on(e,t)}function Qe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ze.fire(e,t)}function Xe(e,t){ze.off(e,t)}var Ze,et="loginStateChanged",tt="loginStateExpire",nt="loginTypeChanged",rt="anonymousConverted",it="refreshAccessToken";!function(e){e.ANONYMOUS="ANONYMOUS",e.WECHAT="WECHAT",e.WECHAT_PUBLIC="WECHAT-PUBLIC",e.WECHAT_OPEN="WECHAT-OPEN",e.CUSTOM="CUSTOM",e.EMAIL="EMAIL",e.USERNAME="USERNAME",e.NULL="NULL"}(Ze||(Ze={}));var ot=function(){function e(){(0,v.default)(this,e),this._fnPromiseMap=new Map}return(0,m.default)(e,[{key:"run",value:function(){var e=(0,l.default)(o.default.mark((function e(t,n){var r,i=this;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=this._fnPromiseMap.get(t),e.abrupt("return",(r||(r=new Promise(function(){var e=(0,l.default)(o.default.mark((function e(r,a){var s;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i._runIdlePromise();case 3:return s=n(),e.t0=r,e.next=7,s;case 7:e.t1=e.sent,(0,e.t0)(e.t1),e.next=14;break;case 11:e.prev=11,e.t2=e["catch"](0),a(e.t2);case 14:return e.prev=14,i._fnPromiseMap.delete(t),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,11,14,17]])})));return function(t,n){return e.apply(this,arguments)}}()),this._fnPromiseMap.set(t,r)),r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_runIdlePromise",value:function(){return Promise.resolve()}}]),e}(),at=function(){function e(t){(0,v.default)(this,e),this._singlePromise=new ot,this._cache=Ge(t.env),this._baseURL="https://".concat(t.env,".ap-shanghai.tcb-api.tencentcloudapi.com"),this._reqClass=new Ue.adapter.reqClass({timeout:t.timeout,timeoutMsg:"\u8bf7\u6c42\u5728".concat(t.timeout/1e3,"s\u5185\u672a\u5b8c\u6210\uff0c\u5df2\u4e2d\u65ad"),restrictedMethods:["post"]})}return(0,m.default)(e,[{key:"_getDeviceId",value:function(){if(this._deviceID)return this._deviceID;var e=this._cache.keys.deviceIdKey,t=this._cache.getStore(e);return"string"==typeof t&&t.length>=16&&t.length<=48||(t=je(),this._cache.setStore(e,t)),this._deviceID=t,t}},{key:"_request",value:function(){var e=(0,l.default)(o.default.mark((function e(t,n){var r,i,a,s,u,c=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=c.length>2&&void 0!==c[2]?c[2]:{},i={"x-request-id":je(),"x-device-id":this._getDeviceId()},!r.withAccessToken){e.next=9;break}return a=this._cache.keys.tokenTypeKey,e.next=6,this.getAccessToken();case 6:s=e.sent,u=this._cache.getStore(a),i.authorization="".concat(u," ").concat(s);case 9:return e.abrupt("return",this._reqClass["get"===r.method?"get":"post"]({url:"".concat(this._baseURL).concat(t),data:n,headers:i}));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_fetchAccessToken",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n,r,i,a,s,u,c,d,f,p=this;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this._cache.keys,n=t.loginTypeKey,r=t.accessTokenKey,i=t.accessTokenExpireKey,a=t.tokenTypeKey,s=this._cache.getStore(n),!s||s===Ze.ANONYMOUS){e.next=3;break}throw new ge({code:"INVALID_OPERATION",message:"\u975e\u533f\u540d\u767b\u5f55\u4e0d\u652f\u6301\u5237\u65b0 access token"});case 3:return e.next=5,this._singlePromise.run("fetchAccessToken",(0,l.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p._request("/auth/v1/signin/anonymously",{},{method:"post"});case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}}),e)}))));case 5:return u=e.sent,c=u.access_token,d=u.expires_in,f=u.token_type,e.abrupt("return",(this._cache.setStore(a,f),this._cache.setStore(r,c),this._cache.setStore(i,Date.now()+1e3*d),c));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isAccessTokenExpired",value:function(e,t){var n=!0;return e&&t&&(n=t<Date.now()),n}},{key:"getAccessToken",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n,r,i,a;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,i=this._cache.getStore(n),a=this._cache.getStore(r),e.abrupt("return",this.isAccessTokenExpired(i,a)?this._fetchAccessToken():i);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAccessToken",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n,r,i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,i=t.loginTypeKey,e.abrupt("return",(this._cache.removeStore(n),this._cache.removeStore(r),this._cache.setStore(i,Ze.ANONYMOUS),this.getAccessToken()));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUserInfo",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t=this;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._singlePromise.run("getUserInfo",(0,l.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t._request("/auth/v1/user/me",{},{withAccessToken:!0,method:"get"});case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),st=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"],ut={"X-SDK-Version":"1.3.5"};function ct(e,t,n){var r=e[t];e[t]=function(t){var i={},o={};n.forEach((function(n){var r=n.call(e,t),a=r.data,s=r.headers;Object.assign(i,a),Object.assign(o,s)}));var a=t.data;return a&&function(){var e;if(e=a,"[object FormData]"!==Object.prototype.toString.call(e))t.data=S(S({},a),i);else for(var n in i)a.append(n,i[n])}(),t.headers=S(S({},t.headers||{}),o),r.call(e,t)}}function lt(){var e=Math.random().toString(16).slice(2);return{data:{seqId:e},headers:S(S({},ut),{},{"x-seqid":e})}}var dt=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,v.default)(this,e),this.config=n,this._reqClass=new Ue.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:"\u8bf7\u6c42\u5728".concat(this.config.timeout/1e3,"s\u5185\u672a\u5b8c\u6210\uff0c\u5df2\u4e2d\u65ad"),restrictedMethods:["post"]}),this._cache=Ge(this.config.env),this._localCache=(t=this.config.env,Ve[t]),this.oauth=new at(this.config),ct(this._reqClass,"post",[lt]),ct(this._reqClass,"upload",[lt]),ct(this._reqClass,"download",[lt])}return(0,m.default)(e,[{key:"post",value:function(){var e=(0,l.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._reqClass.post(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"upload",value:function(){var e=(0,l.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._reqClass.upload(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=(0,l.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._reqClass.download(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAccessToken",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken()),e.prev=1,e.next=4,this._refreshAccessTokenPromise;case 4:t=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](1),n=e.t0;case 10:if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,!n){e.next=12;break}throw n;case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"_refreshAccessToken",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n,r,i,a,s,u,c,l,d,f,p,h;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,i=t.refreshTokenKey,a=t.loginTypeKey,s=t.anonymousUuidKey,this._cache.removeStore(n),this._cache.removeStore(r),u=this._cache.getStore(i),u){e.next=5;break}throw new ge({message:"\u672a\u767b\u5f55CloudBase"});case 5:return c={refresh_token:u},e.next=8,this.request("auth.fetchAccessTokenWithRefreshToken",c);case 8:if(l=e.sent,!l.data.code){e.next=21;break}if(d=l.data.code,"SIGN_PARAM_INVALID"!==d&&"REFRESH_TOKEN_EXPIRED"!==d&&"INVALID_REFRESH_TOKEN"!==d){e.next=20;break}if(this._cache.getStore(a)!==Ze.ANONYMOUS||"INVALID_REFRESH_TOKEN"!==d){e.next=19;break}return f=this._cache.getStore(s),p=this._cache.getStore(i),e.next=17,this.send("auth.signInAnonymously",{anonymous_uuid:f,refresh_token:p});case 17:return h=e.sent,e.abrupt("return",(this.setRefreshToken(h.refresh_token),this._refreshAccessToken()));case 19:Qe(tt),this._cache.removeStore(i);case 20:throw new ge({code:l.data.code,message:"\u5237\u65b0access token\u5931\u8d25\uff1a".concat(l.data.code)});case 21:if(!l.data.access_token){e.next=23;break}return e.abrupt("return",(Qe(it),this._cache.setStore(n,l.data.access_token),this._cache.setStore(r,l.data.access_token_expire+Date.now()),{accessToken:l.data.access_token,accessTokenExpire:l.data.access_token_expire}));case 23:l.data.refresh_token&&(this._cache.removeStore(i),this._cache.setStore(i,l.data.refresh_token),this._refreshAccessToken());case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAccessToken",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n,r,i,a,s,u;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,i=t.refreshTokenKey,this._cache.getStore(i)){e.next=3;break}throw new ge({message:"refresh token\u4e0d\u5b58\u5728\uff0c\u767b\u5f55\u72b6\u6001\u5f02\u5e38"});case 3:if(a=this._cache.getStore(n),s=this._cache.getStore(r),u=!0,e.t0=this._shouldRefreshAccessTokenHook,!e.t0){e.next=9;break}return e.next=8,this._shouldRefreshAccessTokenHook(a,s);case 8:e.t0=!e.sent;case 9:if(e.t1=e.t0,!e.t1){e.next=12;break}u=!1;case 12:return e.abrupt("return",(!a||!s||s<Date.now())&&u?this.refreshAccessToken():{accessToken:a,accessTokenExpire:s});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,l.default)(o.default.mark((function e(t,n,r){var i,a,s,u,c,l,d,f,p,h,g,v,m,y,_;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i="x-tcb-trace_".concat(this.config.env),a="application/x-www-form-urlencoded",s=S({action:t,env:this.config.env,dataVersion:"2019-08-16"},n),e.t0=-1===st.indexOf(t),!e.t0){e.next=9;break}return this._cache.keys,e.next=8,this.oauth.getAccessToken();case 8:s.access_token=e.sent;case 9:if("storage.uploadFile"!==t){e.next=15;break}for(c in u=new FormData,u)u.hasOwnProperty(c)&&void 0!==u[c]&&u.append(c,s[c]);a="multipart/form-data",e.next=17;break;case 15:for(l in a="application/json",u={},s)void 0!==s[l]&&(u[l]=s[l]);case 17:return d={headers:{"content-type":a}},r&&r.timeout&&(d.timeout=r.timeout),r&&r.onUploadProgress&&(d.onUploadProgress=r.onUploadProgress),f=this._localCache.getStore(i),f&&(d.headers["X-TCB-Trace"]=f),p=n.parse,h=n.inQuery,g=n.search,v={env:this.config.env},p&&(v.parse=!0),h&&(v=S(S({},h),v)),m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=/\?/.test(t),i="";for(var o in n)""===i?!r&&(t+="?"):i+="&",i+="".concat(o,"=").concat(encodeURIComponent(n[o]));return/^http(s)?\:\/\//.test(t+=i)?t:"".concat(e).concat(t)}(xe,"//tcb-api.tencentcloudapi.com/web",v),g&&(m+=g),e.next=28,this.post(S({url:m,data:u},d));case 28:if(y=e.sent,_=y.header&&y.header["x-tcb-trace"],_&&this._localCache.setStore(i,_),(200===Number(y.status)||200===Number(y.statusCode))&&y.data){e.next=32;break}throw new ge({code:"NETWORK_ERROR",message:"network request error"});case 32:return e.abrupt("return",y);case 33:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r,i,a,s=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=4,this.request(t,n,S(S({},r),{},{onUploadProgress:n.onUploadProgress}));case 4:if(i=e.sent,"ACCESS_TOKEN_DISABLED"!==i.data.code&&"ACCESS_TOKEN_EXPIRED"!==i.data.code||-1!==st.indexOf(t)){e.next=14;break}return e.next=8,this.oauth.refreshAccessToken();case 8:return e.next=10,this.request(t,n,S(S({},r),{},{onUploadProgress:n.onUploadProgress}));case 10:if(a=e.sent,!a.data.code){e.next=13;break}throw new ge({code:a.data.code,message:$e(a.data.message)});case 13:return e.abrupt("return",a.data);case 14:if(!i.data.code){e.next=16;break}throw new ge({code:i.data.code,message:$e(i.data.message)});case 16:return e.abrupt("return",i.data);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setRefreshToken",value:function(e){var t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,i=t.refreshTokenKey;this._cache.removeStore(n),this._cache.removeStore(r),this._cache.setStore(i,e)}}]),e}(),ft={};function pt(e){return ft[e]}var ht=function(){function e(t){(0,v.default)(this,e),this.config=t,this._cache=Ge(t.env),this._request=pt(t.env)}return(0,m.default)(e,[{key:"setRefreshToken",value:function(e){var t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,i=t.refreshTokenKey;this._cache.removeStore(n),this._cache.removeStore(r),this._cache.setStore(i,e)}},{key:"setAccessToken",value:function(e,t){var n=this._cache.keys,r=n.accessTokenKey,i=n.accessTokenExpireKey;this._cache.setStore(r,e),this._cache.setStore(i,t)}},{key:"refreshUserInfo",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._request.send("auth.getUserInfo",{});case 2:return t=e.sent,n=t.data,e.abrupt("return",(this.setLocalUserInfo(n),n));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setLocalUserInfo",value:function(e){var t=this._cache.keys.userInfoKey;this._cache.setStore(t,e)}}]),e}(),gt=function(){function e(t){if((0,v.default)(this,e),!t)throw new ge({code:"PARAM_ERROR",message:"envId is not defined"});this._envId=t,this._cache=Ge(this._envId),this._request=pt(this._envId),this.setUserInfo()}return(0,m.default)(e,[{key:"linkWithTicket",value:function(e){if("string"!=typeof e)throw new ge({code:"PARAM_ERROR",message:"ticket must be string"});return this._request.send("auth.linkWithTicket",{ticket:e})}},{key:"linkWithRedirect",value:function(e){e.signInWithRedirect()}},{key:"updatePassword",value:function(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})}},{key:"updateEmail",value:function(e){return this._request.send("auth.updateEmail",{newEmail:e})}},{key:"updateUsername",value:function(e){if("string"!=typeof e)throw new ge({code:"PARAM_ERROR",message:"username must be a string"});return this._request.send("auth.updateUsername",{username:e})}},{key:"getLinkedUidList",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n,r,i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._request.send("auth.getLinkedUidList",{});case 2:return t=e.sent,n=t.data,r=!1,i=n.users,e.abrupt("return",(i.forEach((function(e){e.wxOpenId&&e.wxPublicId&&(r=!0)})),{users:i,hasPrimaryUid:r}));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setPrimaryUid",value:function(e){return this._request.send("auth.setPrimaryUid",{uid:e})}},{key:"unlink",value:function(e){return this._request.send("auth.unlink",{platform:e})}},{key:"update",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r,i,a,s,u,c,l;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.nickName,r=t.gender,i=t.avatarUrl,a=t.province,s=t.country,u=t.city,e.next=8,this._request.send("auth.updateUserInfo",{nickName:n,gender:r,avatarUrl:i,province:a,country:s,city:u});case 8:c=e.sent,l=c.data,this.setLocalUserInfo(l);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._request.oauth.getUserInfo();case 2:return t=e.sent,e.abrupt("return",(this.setLocalUserInfo(t),t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setUserInfo",value:function(){var e=this,t=this._cache.keys.userInfoKey,n=this._cache.getStore(t);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl"].forEach((function(t){e[t]=n[t]})),this.location={country:n.country,province:n.province,city:n.city}}},{key:"setLocalUserInfo",value:function(e){var t=this._cache.keys.userInfoKey;this._cache.setStore(t,e),this.setUserInfo()}}]),e}(),vt=function(){function e(t){if((0,v.default)(this,e),!t)throw new ge({code:"PARAM_ERROR",message:"envId is not defined"});this._cache=Ge(t);var n=this._cache.keys,r=n.refreshTokenKey,i=n.accessTokenKey,o=n.accessTokenExpireKey,a=this._cache.getStore(r),s=this._cache.getStore(i),u=this._cache.getStore(o);this.credential={refreshToken:a,accessToken:s,accessTokenExpire:u},this.user=new gt(t)}return(0,m.default)(e,[{key:"isAnonymousAuth",get:function(){return this.loginType===Ze.ANONYMOUS}},{key:"isCustomAuth",get:function(){return this.loginType===Ze.CUSTOM}},{key:"isWeixinAuth",get:function(){return this.loginType===Ze.WECHAT||this.loginType===Ze.WECHAT_OPEN||this.loginType===Ze.WECHAT_PUBLIC}},{key:"loginType",get:function(){return this._cache.getStore(this._cache.keys.loginTypeKey)}}]),e}(),mt=function(e){(0,f.default)(n,e);var t=I(n);function n(){return(0,v.default)(this,n),t.apply(this,arguments)}return(0,m.default)(n,[{key:"signIn",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._cache.updatePersistence("local"),e.next=3,this._request.oauth.getAccessToken();case 3:return Qe(et),Qe(nt,{env:this.config.env,loginType:Ze.ANONYMOUS,persistence:"local"}),t=new vt(this.config.env),e.next=8,t.user.refresh();case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"linkAndRetrieveDataWithTicket",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r,i,a,s,u;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this._cache.keys,r=n.anonymousUuidKey,i=n.refreshTokenKey,a=this._cache.getStore(r),s=this._cache.getStore(i),e.next=7,this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:a,refresh_token:s,ticket:t});case 7:if(u=e.sent,!u.refresh_token){e.next=16;break}return this._clearAnonymousUUID(),this.setRefreshToken(u.refresh_token),e.next=13,this._request.refreshAccessToken();case 13:return Qe(rt,{env:this.config.env}),Qe(nt,{loginType:Ze.CUSTOM,persistence:"local"}),e.abrupt("return",{credential:{refreshToken:u.refresh_token}});case 16:throw new ge({message:"\u533f\u540d\u8f6c\u5316\u5931\u8d25"});case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setAnonymousUUID",value:function(e){var t=this._cache.keys,n=t.anonymousUuidKey,r=t.loginTypeKey;this._cache.removeStore(n),this._cache.setStore(n,e),this._cache.setStore(r,Ze.ANONYMOUS)}},{key:"_clearAnonymousUUID",value:function(){this._cache.removeStore(this._cache.keys.anonymousUuidKey)}}]),n}(ht),yt=function(e){(0,f.default)(n,e);var t=I(n);function n(){return(0,v.default)(this,n),t.apply(this,arguments)}return(0,m.default)(n,[{key:"signIn",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new ge({code:"PARAM_ERROR",message:"ticket must be a string"});case 2:return n=this._cache.keys.refreshTokenKey,e.next=5,this._request.send("auth.signInWithTicket",{ticket:t,refresh_token:this._cache.getStore(n)||""});case 5:if(r=e.sent,!r.refresh_token){e.next=15;break}return this.setRefreshToken(r.refresh_token),e.next=10,this._request.refreshAccessToken();case 10:return Qe(et),Qe(nt,{env:this.config.env,loginType:Ze.CUSTOM,persistence:this.config.persistence}),e.next=14,this.refreshUserInfo();case 14:return e.abrupt("return",new vt(this.config.env));case 15:throw new ge({message:"\u81ea\u5b9a\u4e49\u767b\u5f55\u5931\u8d25"});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ht),_t=function(e){(0,f.default)(n,e);var t=I(n);function n(){return(0,v.default)(this,n),t.apply(this,arguments)}return(0,m.default)(n,[{key:"signIn",value:function(){var e=(0,l.default)(o.default.mark((function e(t,n){var r,i,a,s,u;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new ge({code:"PARAM_ERROR",message:"email must be a string"});case 2:return r=this._cache.keys.refreshTokenKey,e.next=5,this._request.send("auth.signIn",{loginType:"EMAIL",email:t,password:n,refresh_token:this._cache.getStore(r)||""});case 5:if(i=e.sent,a=i.refresh_token,s=i.access_token,u=i.access_token_expire,!a){e.next=22;break}if(this.setRefreshToken(a),!s||!u){e.next=15;break}this.setAccessToken(s,u),e.next=17;break;case 15:return e.next=17,this._request.refreshAccessToken();case 17:return e.next=19,this.refreshUserInfo();case 19:return Qe(et),Qe(nt,{env:this.config.env,loginType:Ze.EMAIL,persistence:this.config.persistence}),e.abrupt("return",new vt(this.config.env));case 22:throw i.code?new ge({code:i.code,message:"\u90ae\u7bb1\u767b\u5f55\u5931\u8d25: ".concat(i.message)}):new ge({message:"\u90ae\u7bb1\u767b\u5f55\u5931\u8d25"});case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"activate",value:function(){var e=(0,l.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._request.send("auth.activateEndUserMail",{token:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetPasswordWithToken",value:function(){var e=(0,l.default)(o.default.mark((function e(t,n){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._request.send("auth.resetPasswordWithToken",{token:t,newPassword:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ht),bt=function(e){(0,f.default)(n,e);var t=I(n);function n(){return(0,v.default)(this,n),t.apply(this,arguments)}return(0,m.default)(n,[{key:"signIn",value:function(){var e=(0,l.default)(o.default.mark((function e(t,n){var r,i,a,s,u;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new ge({code:"PARAM_ERROR",message:"username must be a string"});case 2:return"string"!=typeof n&&(n="",console.warn("password is empty")),r=this._cache.keys.refreshTokenKey,e.next=6,this._request.send("auth.signIn",{loginType:Ze.USERNAME,username:t,password:n,refresh_token:this._cache.getStore(r)||""});case 6:if(i=e.sent,a=i.refresh_token,s=i.access_token_expire,u=i.access_token,!a){e.next=23;break}if(this.setRefreshToken(a),!u||!s){e.next=16;break}this.setAccessToken(u,s),e.next=18;break;case 16:return e.next=18,this._request.refreshAccessToken();case 18:return e.next=20,this.refreshUserInfo();case 20:return Qe(et),Qe(nt,{env:this.config.env,loginType:Ze.USERNAME,persistence:this.config.persistence}),e.abrupt("return",new vt(this.config.env));case 23:throw i.code?new ge({code:i.code,message:"\u7528\u6237\u540d\u5bc6\u7801\u767b\u5f55\u5931\u8d25: ".concat(i.message)}):new ge({message:"\u7528\u6237\u540d\u5bc6\u7801\u767b\u5f55\u5931\u8d25"});case 24:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ht),wt=function(){function e(t){(0,v.default)(this,e),this.config=t,this._cache=Ge(t.env),this._request=pt(t.env),this._onAnonymousConverted=this._onAnonymousConverted.bind(this),this._onLoginTypeChanged=this._onLoginTypeChanged.bind(this),Je(nt,this._onLoginTypeChanged)}return(0,m.default)(e,[{key:"currentUser",get:function(){var e=this.hasLoginState();return e&&e.user||null}},{key:"loginType",get:function(){return this._cache.getStore(this._cache.keys.loginTypeKey)}},{key:"anonymousAuthProvider",value:function(){return new mt(this.config)}},{key:"customAuthProvider",value:function(){return new yt(this.config)}},{key:"emailAuthProvider",value:function(){return new _t(this.config)}},{key:"usernameAuthProvider",value:function(){return new bt(this.config)}},{key:"signInAnonymously",value:function(){var e=(0,l.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new mt(this.config).signIn());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signInWithEmailAndPassword",value:function(){var e=(0,l.default)(o.default.mark((function e(t,n){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new _t(this.config).signIn(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signInWithUsernameAndPassword",value:function(e,t){return new bt(this.config).signIn(e,t)}},{key:"linkAndRetrieveDataWithTicket",value:function(){var e=(0,l.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._anonymousAuthProvider||(this._anonymousAuthProvider=new mt(this.config)),Je(rt,this._onAnonymousConverted),e.next=3,this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=(0,l.default)(o.default.mark((function e(){var t,n,r,i,a,s;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.loginType!==Ze.ANONYMOUS){e.next=2;break}throw new ge({message:"\u533f\u540d\u7528\u6237\u4e0d\u652f\u6301\u767b\u51fa\u64cd\u4f5c"});case 2:if(t=this._cache.keys,n=t.refreshTokenKey,r=t.accessTokenKey,i=t.accessTokenExpireKey,a=this._cache.getStore(n),a){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this._request.send("auth.logout",{refresh_token:a});case 7:return s=e.sent,e.abrupt("return",(this._cache.removeStore(n),this._cache.removeStore(r),this._cache.removeStore(i),Qe(et),Qe(nt,{env:this.config.env,loginType:Ze.NULL,persistence:this.config.persistence}),s));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signUpWithEmailAndPassword",value:function(){var e=(0,l.default)(o.default.mark((function e(t,n){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._request.send("auth.signUpWithEmailAndPassword",{email:t,password:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendPasswordResetEmail",value:function(){var e=(0,l.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._request.send("auth.sendPasswordResetEmail",{email:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onLoginStateChanged",value:function(e){var t=this;Je(et,(function(){var n=t.hasLoginState();e.call(t,n)}));var n=this.hasLoginState();e.call(this,n)}},{key:"onLoginStateExpired",value:function(e){Je(tt,e.bind(this))}},{key:"onAccessTokenRefreshed",value:function(e){Je(it,e.bind(this))}},{key:"onAnonymousConverted",value:function(e){Je(rt,e.bind(this))}},{key:"onLoginTypeChanged",value:function(e){var t=this;Je(nt,(function(){var n=t.hasLoginState();e.call(t,n)}))}},{key:"getAccessToken",value:function(){var e=(0,l.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._request.getAccessToken();case 2:return e.t0=e.sent.accessToken,e.t1=this.config.env,e.abrupt("return",{accessToken:e.t0,env:e.t1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasLoginState",value:function(){var e=this._cache.keys,t=e.accessTokenKey,n=e.accessTokenExpireKey,r=this._cache.getStore(t),i=this._cache.getStore(n);return this._request.oauth.isAccessTokenExpired(r,i)?null:new vt(this.config.env)}},{key:"isUsernameRegistered",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new ge({code:"PARAM_ERROR",message:"username must be a string"});case 2:return e.next=4,this._request.send("auth.isUsernameRegistered",{username:t});case 4:return n=e.sent,r=n.data,e.abrupt("return",r&&r.isRegistered);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLoginState",value:function(){return Promise.resolve(this.hasLoginState())}},{key:"signInWithTicket",value:function(){var e=(0,l.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new yt(this.config).signIn(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"shouldRefreshAccessToken",value:function(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)}},{key:"getUserInfo",value:function(){return this._request.send("auth.getUserInfo",{}).then((function(e){return e.code?e:S(S({},e.data),{},{requestId:e.seqId})}))}},{key:"getAuthHeader",value:function(){var e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=this._cache.getStore(t);return{"x-cloudbase-credentials":this._cache.getStore(n)+"/@@/"+r}}},{key:"_onAnonymousConverted",value:function(e){var t=e.data.env;t===this.config.env&&this._cache.updatePersistence(this.config.persistence)}},{key:"_onLoginTypeChanged",value:function(e){var t=e.data,n=t.loginType,r=t.persistence,i=t.env;i===this.config.env&&(this._cache.updatePersistence(r),this._cache.setStore(this._cache.keys.loginTypeKey,n))}}]),e}(),St=function(e,t){t=t||Le();var n=pt(this.config.env),r=e.cloudPath,i=e.filePath,o=e.onUploadProgress,a=e.fileType,s=void 0===a?"image":a;return n.send("storage.getUploadMetadata",{path:r}).then((function(e){var a=e.data,u=a.url,c=a.authorization,l=a.token,d=a.fileId,f=a.cosFileId,p=e.requestId,h={key:r,signature:c,"x-cos-meta-fileid":f,success_action_status:"201","x-cos-security-token":l};n.upload({url:u,data:h,file:i,name:r,fileType:s,onUploadProgress:o}).then((function(e){201===e.statusCode?t(null,{fileID:d,requestId:p}):t(new ge({code:"STORAGE_REQUEST_FAIL",message:"STORAGE_REQUEST_FAIL: ".concat(e.data)}))})).catch((function(e){t(e)}))})).catch((function(e){t(e)})),t.promise},It=function(e,t){t=t||Le();var n=pt(this.config.env),r=e.cloudPath;return n.send("storage.getUploadMetadata",{path:r}).then((function(e){t(null,e)})).catch((function(e){t(e)})),t.promise},Ct=function(e,t){var n=e.fileList;if(t=t||Le(),!n||!Array.isArray(n))return{code:"INVALID_PARAM",message:"fileList\u5fc5\u987b\u662f\u975e\u7a7a\u7684\u6570\u7ec4"};var r,i=_(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(!o||"string"!=typeof o)return{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7d20\u5fc5\u987b\u662f\u975e\u7a7a\u7684\u5b57\u7b26\u4e32"}}}catch(s){i.e(s)}finally{i.f()}var a={fileid_list:n};return pt(this.config.env).send("storage.batchDeleteFile",a).then((function(e){e.code?t(null,e):t(null,{fileList:e.data.delete_list,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},Tt=function(e,t){var n=e.fileList;t=t||Le(),n&&Array.isArray(n)||t(null,{code:"INVALID_PARAM",message:"fileList\u5fc5\u987b\u662f\u975e\u7a7a\u7684\u6570\u7ec4"});var r,i=[],o=_(n);try{for(o.s();!(r=o.n()).done;){var a=r.value;"object"==(0,u.default)(a)?(a.hasOwnProperty("fileID")&&a.hasOwnProperty("maxAge")||t(null,{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7d20\u5fc5\u987b\u662f\u5305\u542bfileID\u548cmaxAge\u7684\u5bf9\u8c61"}),i.push({fileid:a.fileID,max_age:a.maxAge})):"string"==typeof a?i.push({fileid:a}):t(null,{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7d20\u5fc5\u987b\u662f\u5b57\u7b26\u4e32"})}}catch(c){o.e(c)}finally{o.f()}var s={file_list:i};return pt(this.config.env).send("storage.batchGetDownloadUrl",s).then((function(e){e.code?t(null,e):t(null,{fileList:e.data.download_list,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},Ot=function(){var e=(0,l.default)(o.default.mark((function e(t,n){var r,i,a,s;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.fileID,e.next=3,Tt.call(this,{fileList:[{fileID:r,maxAge:600}]});case 3:if(i=e.sent.fileList[0],"SUCCESS"===i.code){e.next=6;break}return e.abrupt("return",n?n(i):new Promise((function(e){e(i)})));case 6:if(a=pt(this.config.env),s=i.download_url,s=encodeURI(s),n){e.next=10;break}return e.abrupt("return",a.download({url:s}));case 10:return e.t0=n,e.next=13,a.download({url:s});case 13:e.t1=e.sent,(0,e.t0)(e.t1);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),Et=function(e,t){var n,r=e.name,i=e.data,o=e.query,a=e.parse,s=e.search,u=e.timeout,c=t||Le();try{n=i?JSON.stringify(i):""}catch(r){return Promise.reject(r)}if(!r)return Promise.reject(new ge({code:"PARAM_ERROR",message:"\u51fd\u6570\u540d\u4e0d\u80fd\u4e3a\u7a7a"}));var l={inQuery:o,parse:a,search:s,function_name:r,request_data:n};return pt(this.config.env).send("functions.invokeFunction",l,{timeout:u}).then((function(e){if(e.code)c(null,e);else{var t=e.data.response_data;if(a)c(null,{result:t,requestId:e.requestId});else try{t=JSON.parse(e.data.response_data),c(null,{result:t,requestId:e.requestId})}catch(e){c(new ge({message:"response data must be json"}))}}return c.promise})).catch((function(e){c(e)})),c.promise},xt={timeout:15e3,persistence:"session"},Pt={},kt=function(){function e(t){(0,v.default)(this,e),this.config=t||this.config,this.authObj=void 0}return(0,m.default)(e,[{key:"init",value:function(t){switch(Ue.adapter||(this.requestClient=new Ue.adapter.reqClass({timeout:t.timeout||5e3,timeoutMsg:"\u8bf7\u6c42\u5728".concat((t.timeout||5e3)/1e3,"s\u5185\u672a\u5b8c\u6210\uff0c\u5df2\u4e2d\u65ad")})),this.config=S(S({},xt),t),!0){case this.config.timeout>6e5:console.warn("timeout\u5927\u4e8e\u53ef\u914d\u7f6e\u4e0a\u9650[10\u5206\u949f]\uff0c\u5df2\u91cd\u7f6e\u4e3a\u4e0a\u9650\u6570\u503c"),this.config.timeout=6e5;break;case this.config.timeout<100:console.warn("timeout\u5c0f\u4e8e\u53ef\u914d\u7f6e\u4e0b\u9650[100ms]\uff0c\u5df2\u91cd\u7f6e\u4e3a\u4e0b\u9650\u6570\u503c"),this.config.timeout=100}return new e(this.config)}},{key:"auth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.persistence;if(this.authObj)return this.authObj;var n,r=t||Ue.adapter.primaryStorage||xt.persistence;return r!==this.config.persistence&&(this.config.persistence=r),function(e){var t=e.env;He[t]=new We(e),Ve[t]=new We(S(S({},e),{},{persistence:"local"}))}(this.config),n=this.config,ft[n.env]=new dt(n),this.authObj=new wt(this.config),this.authObj}},{key:"on",value:function(e,t){return Je.apply(this,[e,t])}},{key:"off",value:function(e,t){return Xe.apply(this,[e,t])}},{key:"callFunction",value:function(e,t){return Et.apply(this,[e,t])}},{key:"deleteFile",value:function(e,t){return Ct.apply(this,[e,t])}},{key:"getTempFileURL",value:function(e,t){return Tt.apply(this,[e,t])}},{key:"downloadFile",value:function(e,t){return Ot.apply(this,[e,t])}},{key:"uploadFile",value:function(e,t){return St.apply(this,[e,t])}},{key:"getUploadMetadata",value:function(e,t){return It.apply(this,[e,t])}},{key:"registerExtension",value:function(e){Pt[e.name]=e}},{key:"invokeExtension",value:function(){var e=(0,l.default)(o.default.mark((function e(t,n){var r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=Pt[t],r){e.next=3;break}throw new ge({message:"\u6269\u5c55".concat(t," \u5fc5\u987b\u5148\u6ce8\u518c")});case 3:return e.next=5,r.invoke(n,this);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"useAdapters",value:function(e){var t=function(e){var t,n,r=(t=e,"[object Array]"===Object.prototype.toString.call(t)?e:[e]),i=_(r);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=o.isMatch,s=o.genAdapter,u=o.runtime;if(a())return{adapter:s(),runtime:u}}}catch(c){i.e(c)}finally{i.f()}}(e)||{},n=t.adapter,r=t.runtime;n&&(Ue.adapter=n),r&&(Ue.runtime=r)}}]),e}(),At=new kt;function Rt(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),i="";for(var o in n)""===i?!r&&(t+="?"):i+="&",i+=o+"="+encodeURIComponent(n[o]);return/^http(s)?:\/\//.test(t+=i)?t:""+e+t}var Dt=function(){function e(){(0,v.default)(this,e)}return(0,m.default)(e,[{key:"get",value:function(e){var t=e.url,n=e.data,r=e.headers,i=e.timeout;return new Promise((function(e,o){ye.request({url:Rt("https:",t),data:n,method:"GET",header:r,timeout:i,success:function(t){e(t)},fail:function(e){o(e)}})}))}},{key:"post",value:function(e){var t=e.url,n=e.data,r=e.headers,i=e.timeout;return new Promise((function(e,o){ye.request({url:Rt("https:",t),data:n,method:"POST",header:r,timeout:i,success:function(t){e(t)},fail:function(e){o(e)}})}))}},{key:"upload",value:function(e){return new Promise((function(t,n){var r=e.url,i=e.file,o=e.data,a=e.headers,s=e.fileType,u=ye.uploadFile({url:Rt("https:",r),name:"file",formData:Object.assign({},o),filePath:i,fileType:s,header:a,success:function(e){var n={statusCode:e.statusCode,data:e.data||{}};200===e.statusCode&&o.success_action_status&&(n.statusCode=parseInt(o.success_action_status,10)),t(n)},fail:function(e){n(new Error(e.errMsg||"uploadFile:fail"))}});"function"==typeof e.onUploadProgress&&u&&"function"==typeof u.onProgressUpdate&&u.onProgressUpdate((function(t){e.onUploadProgress({loaded:t.totalBytesSent,total:t.totalBytesExpectedToSend})}))}))}}]),e}(),Lt={setItem:function(e,t){ye.setStorageSync(e,t)},getItem:function(e){return ye.getStorageSync(e)},removeItem:function(e){ye.removeStorageSync(e)},clear:function(){ye.clearStorageSync()}},Nt={genAdapter:function(){return{root:{},reqClass:Dt,localStorage:Lt,primaryStorage:"local"}},isMatch:function(){return!0},runtime:"uni_app"};At.useAdapters(Nt);var Mt=At,$t=Mt.init;Mt.init=function(e){e.env=e.spaceId;var t=$t.call(this,e);t.config.provider="tencent",t.config.spaceId=e.spaceId;var n=t.auth;return t.auth=function(e){var t=n.call(this,e);return["linkAndRetrieveDataWithTicket","signInAnonymously","signOut","getAccessToken","getLoginState","signInWithTicket","getUserInfo"].forEach((function(e){var n;t[e]=(n=t[e],function(e){e=e||{};var t=he(e),r=t.success,i=t.fail,o=t.complete;if(!(r||i||o))return n.call(this,e);n.call(this,e).then((function(e){r&&r(e),o&&o(e)}),(function(e){i&&i(e),o&&o(e)}))}).bind(t)})),t},t.customAuth=t.auth,t};var jt=Mt;function Ut(e,t){return Ft.apply(this,arguments)}function Ft(){return Ft=(0,l.default)(o.default.mark((function e(t,n){var r,i,a;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r="http://".concat(t,":").concat(n,"/system/ping"),e.prev=1,e.next=4,a={url:r,timeout:500},new Promise((function(e,t){ye.request(S(S({},a),{},{success:function(t){e(t)},fail:function(e){t(e)}}))}));case 4:return i=e.sent,e.abrupt("return",!(!i.data||0!==i.data.code));case 8:return e.prev=8,e.t0=e["catch"](1),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[1,8]])}))),Ft.apply(this,arguments)}function Bt(e,t){return qt.apply(this,arguments)}function qt(){return qt=(0,l.default)(o.default.mark((function e(t,n){var r,i,a;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<t.length)){e.next=11;break}return a=t[i],e.next=5,Ut(a,n);case 5:if(!e.sent){e.next=8;break}return r=a,e.abrupt("break",11);case 8:i++,e.next=1;break;case 11:return e.abrupt("return",{address:r,port:n});case 12:case"end":return e.stop()}}),e)}))),qt.apply(this,arguments)}var Wt={"serverless.file.resource.generateProximalSign":"storage/generate-proximal-sign","serverless.file.resource.report":"storage/report","serverless.file.resource.delete":"storage/delete","serverless.file.resource.getTempFileURL":"storage/get-temp-file-url"},Ht=function(){function e(t){if((0,v.default)(this,e),["spaceId","clientSecret"].forEach((function(e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new Error("".concat(e," required"))})),!t.endpoint)throw new Error("\u96c6\u7fa4\u7a7a\u95f4\u672a\u914d\u7f6eApiEndpoint\uff0c\u914d\u7f6e\u540e\u9700\u8981\u91cd\u65b0\u5173\u8054\u670d\u52a1\u7a7a\u95f4\u540e\u751f\u6548");this.config=Object.assign({},t),this.config.provider="dcloud",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.adapter=ye}return(0,m.default)(e,[{key:"request",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r=this,i=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(i.length>1&&void 0!==i[1])||i[1],n=!1,!n){e.next=8;break}return e.next=5,this.setupLocalRequest(t);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=this.setupRequest(t);case 9:return t=e.t0,e.abrupt("return",Promise.resolve().then((function(){return n?r.requestLocal(t):Te.wrappedRequest(t,r.adapter.request)})));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestLocal",value:function(e){var t=this;return new Promise((function(n,r){t.adapter.request(Object.assign(e,{complete:function(e){if(e||(e={}),!e.statusCode||e.statusCode>=400){var t=e.data&&e.data.code||"SYS_ERR",i=e.data&&e.data.message||"request:fail";return r(new ge({code:t,message:i}))}n({success:!0,result:e.data})}}))}))}},{key:"setupRequest",value:function(e){var t=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),n={"Content-Type":"application/json"};n["x-serverless-sign"]=Te.sign(t,this.config.clientSecret);var r=Ie();n["x-client-info"]=encodeURIComponent(JSON.stringify(r));var i=_e(),o=i.token;return n["x-client-token"]=o,{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:JSON.parse(JSON.stringify(n))}}},{key:"setupLocalRequest",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r,i,a,s,u,c,l,d;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Ie(),r=_e(),i=r.token,a=Object.assign({},t,{spaceId:this.config.spaceId,timestamp:Date.now(),clientInfo:n,token:i}),s=this.__dev__&&this.__dev__.debugInfo||{},u=s.address,c=s.servePort,e.next=9,Bt(u,c);case 9:return l=e.sent,d=l.address,e.abrupt("return",{url:"http://".concat(d,":").concat(c,"/").concat(Wt[t.method]),method:"POST",data:a,dataType:"json",header:JSON.parse(JSON.stringify({"Content-Type":"application/json"}))});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"callFunction",value:function(e){var t={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:e.name,functionArgs:e.data||{}})};return this.request(t,!1)}},{key:"getUploadFileOptions",value:function(e){var t={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(e)};return this.request(t)}},{key:"reportUploadFile",value:function(e){var t={method:"serverless.file.resource.report",params:JSON.stringify(e)};return this.request(t)}},{key:"uploadFile",value:function(e){var t,n=this,r=e.filePath,i=e.cloudPath,o=e.fileType,a=void 0===o?"image":o,s=e.onUploadProgress;if(!i)throw new ge({code:"CLOUDPATH_REQUIRED",message:"cloudPath\u4e0d\u53ef\u4e3a\u7a7a"});return this.getUploadFileOptions({cloudPath:i}).then((function(e){var i=e.result,o=i.url,u=i.formData,c=i.name;return t=e.result.fileUrl,new Promise((function(e,t){var i=n.adapter.uploadFile({url:o,formData:u,name:c,filePath:r,fileType:a,success:function(n){n&&n.statusCode<400?e(n):t(new ge({code:"UPLOAD_FAILED",message:"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"}))},fail:function(e){t(new ge({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"}))}});"function"==typeof s&&i&&"function"==typeof i.onProgressUpdate&&i.onProgressUpdate((function(e){s({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))})).then((function(){return n.reportUploadFile({cloudPath:i})})).then((function(e){return new Promise((function(n,i){e.success?n({success:!0,filePath:r,fileID:t}):i(new ge({code:"UPLOAD_FAILED",message:"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"}))}))}))}},{key:"deleteFile",value:function(e){var t=e.fileList,n={method:"serverless.file.resource.delete",params:JSON.stringify({fileList:t})};return this.request(n).then((function(e){if(e.success)return e.result;throw new ge({code:"DELETE_FILE_FAILED",message:"\u5220\u9664\u6587\u4ef6\u5931\u8d25"})}))}},{key:"getTempFileURL",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fileList,n=e.maxAge;if(!Array.isArray(t)||0===t.length)throw new ge({code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7d20\u5fc5\u987b\u662f\u975e\u7a7a\u7684\u5b57\u7b26\u4e32"});var r={method:"serverless.file.resource.getTempFileURL",params:JSON.stringify({fileList:t,maxAge:n})};return this.request(r).then((function(e){if(e.success)return{fileList:e.result.fileList.map((function(e){return{fileID:e.fileID,tempFileURL:e.tempFileURL}}))};throw new ge({code:"GET_TEMP_FILE_URL_FAILED",message:"\u83b7\u53d6\u4e34\u65f6\u6587\u4ef6\u94fe\u63a5\u5931\u8d25"})}))}}]),e}(),Vt={init:function(e){var t=new Ht(e),n={signInAnonymously:function(){return Promise.resolve()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return n},t.customAuth=t.auth,t}},Gt=C((function(e,t){e.exports=O.enc.Hex}));function Yt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function Kt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.data,r=t.functionName,i=t.method,o=t.headers,a=t.signHeaderKeys,u=void 0===a?[]:a,c=t.config,l=String(Date.now()),d=Yt(),f=Object.assign({},o,{"x-from-app-id":c.spaceAppId,"x-from-env-id":c.spaceId,"x-to-env-id":c.spaceId,"x-from-instance-id":l,"x-from-function-name":r,"x-client-timestamp":l,"x-alipay-source":"client","x-request-id":d,"x-alipay-callid":d,"x-trace-id":d}),p=["x-from-app-id","x-from-env-id","x-to-env-id","x-from-instance-id","x-from-function-name","x-client-timestamp"].concat(u),h=e.split("?")||[],g=(0,s.default)(h,2),v=g[0],m=void 0===v?"":v,y=g[1],_=void 0===y?"":y,b=function(e){var t="HMAC-SHA256",n=e.signedHeaders.join(";"),r=e.signedHeaders.map((function(t){return"".concat(t.toLowerCase(),":").concat(e.headers[t],"\n")})).join(""),i=Re(e.body).toString(Gt),o="".concat(e.method.toUpperCase(),"\n").concat(e.path,"\n").concat(e.query,"\n").concat(r,"\n").concat(n,"\n").concat(i,"\n"),a=Re(o).toString(Gt),s="".concat(t,"\n").concat(e.timestamp,"\n").concat(a,"\n"),u=De(s,e.secretKey).toString(Gt);return"".concat(t," Credential=").concat(e.secretId,", SignedHeaders=").concat(n,", Signature=").concat(u)}({path:m,query:_,method:i,headers:f,timestamp:l,body:JSON.stringify(n),secretId:c.accessKey,secretKey:c.secretKey,signedHeaders:p.sort()});return{url:"".concat(c.endpoint).concat(e),headers:Object.assign({},f,{Authorization:b})}}function zt(e){var t=e.url,n=e.data,r=e.method,i=void 0===r?"POST":r,o=e.headers,a=void 0===o?{}:o,s=e.timeout;return new Promise((function(e,r){ye.request({url:t,method:i,data:"object"==(0,u.default)(n)?JSON.stringify(n):n,header:a,dataType:"json",timeout:s,complete:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a["x-trace-id"]||"";if(!t.statusCode||t.statusCode>=400){var i=t.data||{},o=i.message,s=i.errMsg,u=i.trace_id;return r(new ge({code:"SYS_ERR",message:o||s||"request:fail",requestId:u||n}))}e({status:t.statusCode,data:t.data,headers:t.header,requestId:n})}})}))}function Jt(e,t){var n=e.path,r=e.data,i=e.method,o=void 0===i?"GET":i,a=Kt(n,{functionName:"",data:r,method:o,headers:{"x-alipay-cloud-mode":"oss","x-data-api-type":"oss","x-expire-timestamp":Date.now()+6e4},signHeaderKeys:["x-data-api-type","x-expire-timestamp"],config:t}),s=a.url,u=a.headers;return zt({url:s,data:r,method:o,headers:u}).then((function(e){var t=e.data||{};if(!t.success)throw new ge({code:e.errCode,message:e.errMsg,requestId:e.requestId});return t.data||{}})).catch((function(e){throw new ge({code:e.errCode,message:e.errMsg,requestId:e.requestId})}))}function Qt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.trim().replace(/^cloud:\/\//,""),n=t.indexOf("/");if(n<=0)throw new ge({code:"INVALID_PARAM",message:"fileID\u4e0d\u5408\u6cd5"});var r=t.substring(0,n),i=t.substring(n+1);return r!==this.config.spaceId&&console.warn("file ".concat(e," does not belong to env ").concat(this.config.spaceId)),i}function Xt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"cloud://".concat(this.config.spaceId,"/").concat(e.replace(/^\/+/,""))}var Zt=function(){function e(t){(0,v.default)(this,e),this.config=t}return(0,m.default)(e,[{key:"signedURL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="/ws/function/".concat(e),r=this.config.wsEndpoint.replace(/^ws(s)?:\/\//,""),i=Object.assign({},t,{accessKeyId:this.config.accessKey,signatureNonce:Yt(),timestamp:""+Date.now()}),o=[n,["accessKeyId","authorization","signatureNonce","timestamp"].sort().map((function(e){return i[e]?"".concat(e,"=").concat(i[e]):null})).filter(Boolean).join("&"),"host:".concat(r)].join("\n"),a=["HMAC-SHA256",Re(o).toString(Gt)].join("\n"),s=De(a,this.config.secretKey).toString(Gt),u=Object.keys(i).map((function(e){return"".concat(e,"=").concat(encodeURIComponent(i[e]))})).join("&");return"".concat(this.config.wsEndpoint).concat(n,"?").concat(u,"&signature=").concat(s)}}]),e}(),en=function(){function e(t){if((0,v.default)(this,e),["spaceId","spaceAppId","accessKey","secretKey"].forEach((function(e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new Error("".concat(e," required"))})),t.endpoint){if("string"!=typeof t.endpoint)throw new Error("endpoint must be string");if(!/^https:\/\//.test(t.endpoint))throw new Error("endpoint must start with https://");t.endpoint=t.endpoint.replace(/\/$/,"")}this.config=Object.assign({},t,{endpoint:t.endpoint||"https://".concat(t.spaceId,".api-hz.cloudbasefunction.cn"),wsEndpoint:t.wsEndpoint||"wss://".concat(t.spaceId,".api-hz.cloudbasefunction.cn")}),this._websocket=new Zt(this.config)}return(0,m.default)(e,[{key:"callFunction",value:function(e){return function(e,t){var n=e.name,r=e.data,i=e.async,o=void 0!==i&&i,a=e.timeout,s="POST",u={"x-to-function-name":n};o&&(u["x-function-invoke-type"]="async");var c=Kt("/functions/invokeFunction",{functionName:n,data:r,method:s,headers:u,signHeaderKeys:["x-to-function-name"],config:t}),l=c.url,d=c.headers;return zt({url:l,data:r,method:s,headers:d,timeout:a}).then((function(e){var t=0;if(o){var n=e.data||{};t="200"===n.errCode?0:n.errCode,e.data=n.data||{},e.errMsg=n.errMsg}if(0!==t)throw new ge({code:t,message:e.errMsg,requestId:e.requestId});return{errCode:t,success:0===t,requestId:e.requestId,result:e.data}})).catch((function(e){throw new ge({code:e.errCode,message:e.errMsg,requestId:e.requestId})}))}(e,this.config)}},{key:"uploadFileToOSS",value:function(e){var t=e.url,n=e.filePath,r=e.fileType,i=e.formData,o=e.onUploadProgress;return new Promise((function(e,a){var s=ye.uploadFile({url:t,filePath:n,fileType:r,formData:i,name:"file",success:function(t){t&&t.statusCode<400?e(t):a(new ge({code:"UPLOAD_FAILED",message:"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"}))},fail:function(e){a(new ge({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"}))}});"function"==typeof o&&s&&"function"==typeof s.onProgressUpdate&&s.onProgressUpdate((function(e){o({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}},{key:"uploadFile",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r,i,a,s,u,c,l,d,f,p;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.filePath,r=t.cloudPath,i=void 0===r?"":r,a=t.fileType,s=void 0===a?"image":a,u=t.onUploadProgress,"string"===M(i)){e.next=3;break}throw new ge({code:"INVALID_PARAM",message:"cloudPath\u5fc5\u987b\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b"});case 3:if(i=i.trim()){e.next=5;break}throw new ge({code:"INVALID_PARAM",message:"cloudPath\u4e0d\u53ef\u4e3a\u7a7a"});case 5:if(!/:\/\//.test(i)){e.next=7;break}throw new ge({code:"INVALID_PARAM",message:"cloudPath\u4e0d\u5408\u6cd5"});case 7:return e.next=9,Jt({path:"/".concat(i.replace(/^\//,""),"?post_url")},this.config);case 9:return c=e.sent,l=c.file_id,d=c.upload_url,f=c.form_data,p=f&&f.reduce((function(e,t){return e[t.key]=t.value,e}),{}),e.abrupt("return",this.uploadFileToOSS({url:d,filePath:n,fileType:s,formData:p,onUploadProgress:u}).then((function(){return{fileID:l}})));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTempFileURL",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r=this;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.fileList,e.abrupt("return",new Promise((function(e,t){(!n||n.length<0)&&e({code:"INVALID_PARAM",message:"fileList\u4e0d\u80fd\u4e3a\u7a7a\u6570\u7ec4"}),n.length>50&&e({code:"INVALID_PARAM",message:"fileList\u6570\u7ec4\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750"});var i,o=[],a=_(n);try{for(a.s();!(i=a.n()).done;){var s=i.value,u=void 0;"string"!==M(s)&&e({code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7d20\u5fc5\u987b\u662f\u975e\u7a7a\u7684\u5b57\u7b26\u4e32"});try{u=Qt.call(r,s)}catch(e){console.warn(e.errCode,e.errMsg),u=s}o.push({file_id:u,expire:600})}}catch(c){a.e(c)}finally{a.f()}Jt({path:"/?download_url",data:{file_list:o},method:"POST"},r.config).then((function(t){var n=t.file_list,i=void 0===n?[]:n;e({fileList:i.map((function(e){return{fileID:Xt.call(r,e.file_id),tempFileURL:e.download_url}}))})})).catch((function(e){return t(e)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"connectWebSocket",value:function(){var e=(0,l.default)(o.default.mark((function e(t){var n,r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.name,r=t.query,e.abrupt("return",ye.connectSocket({url:this._websocket.signedURL(n,r),complete:function(){}}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),tn={init:function(e){e.provider="alipay";var t=new en(e);return t.auth=function(){return{signInAnonymously:function(){return Promise.resolve()},getLoginState:function(){return Promise.resolve(!0)}}},t}};function nn(e){var t,n=e.data;t=Ie();var r=JSON.parse(JSON.stringify(n||{}));if(Object.assign(r,{clientInfo:t}),!r.uniIdToken){var i=_e(),o=i.token;o&&(r.uniIdToken=o)}return r}var rn=[{rule:/fc_function_not_found|FUNCTION_NOT_FOUND/,content:"\uff0c\u4e91\u51fd\u6570[{functionName}]\u5728\u4e91\u7aef\u4e0d\u5b58\u5728\uff0c\u8bf7\u68c0\u67e5\u6b64\u4e91\u51fd\u6570\u540d\u79f0\u662f\u5426\u6b63\u786e\u4ee5\u53ca\u8be5\u4e91\u51fd\u6570\u662f\u5426\u5df2\u4e0a\u4f20\u5230\u670d\u52a1\u7a7a\u95f4",mode:"append"}],on=/[\\^$.*+?()[\]{}|]/g,an=RegExp(on.source);function sn(e,t,n){return e.replace(new RegExp((r=t)&&an.test(r)?r.replace(on,"\\$&"):r,"g"),n);var r}var un={NONE:"none",REQUEST:"request",RESPONSE:"response",BOTH:"both"},cn="_globalUniCloudStatus",ln="_globalUniCloudSecureNetworkCache__{spaceId}",dn="uni-secure-network",fn={SYSTEM_ERROR:{code:2e4,message:"System error"},APP_INFO_INVALID:{code:20101,message:"Invalid client"},GET_ENCRYPT_KEY_FAILED:{code:20102,message:"Get encrypt key failed"}};function pn(e){var t=e||{},n=t.errSubject,r=t.subject,i=t.errCode,o=t.errMsg,a=t.code,s=t.message,u=t.cause;return new ge({subject:n||r||dn,code:i||a||fn.SYSTEM_ERROR.code,message:o||s,cause:u})}var hn;hn="0123456789abcdef";var gn;function vn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.secretType;return t===un.REQUEST||t===un.RESPONSE||t===un.BOTH}function mn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=e.data,r=void 0===n?{}:n;return"app"===G&&"DCloud-clientDB"===t&&"encryption"===r.redirectTo&&"getAppClientKey"===r.action}function yn(e){e.functionName,e.result,e.logPvd}function _n(e){var t=e.callFunction,n=function(n){var r=this,i=n.name;n.data=nn.call(e,{data:n.data});var o={aliyun:"aliyun",tencent:"tcb",tcb:"tcb",alipay:"alipay",dcloud:"dcloud"}[this.config.provider],a=vn(n),s=mn(n),u=a||s;return t.call(this,n).then((function(e){return e.errCode=0,!u&&yn.call(r,{functionName:i,result:e,logPvd:o}),Promise.resolve(e)}),(function(e){return!u&&yn.call(r,{functionName:i,result:e,logPvd:o}),e&&e.message&&(e.message=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.message,n=void 0===t?"":t,r=e.extraInfo,i=void 0===r?{}:r,o=e.formatter,a=void 0===o?[]:o,s=0;s<a.length;s++){var u=a[s],c=u.rule,l=u.content,d=u.mode,f=n.match(c);if(f){for(var p=l,h=1;h<f.length;h++)p=sn(p,"{$".concat(h,"}"),f[h]);for(var g in i)p=sn(p,"{".concat(g,"}"),i[g]);return"replace"===d?p:n+p}}return n}({message:"[".concat(n.name,"]: ").concat(e.message),formatter:rn,extraInfo:{functionName:i}})),Promise.reject(e)}))};e.callFunction=function(t){var r,i,o=e.config,a=o.provider,s=o.spaceId,u=t.name;return t.data=t.data||{},r=n,r=r.bind(e),i=mn(t)?n.call(e,t):function(e){var t=e.name,n=e.data,r=void 0===n?{}:n;return"mp-weixin"===G&&"uni-id-co"===t&&"secureNetworkHandshakeByWeixin"===r.method}(t)?r.call(e,t):vn(t)?new gn({secretType:t.secretType,uniCloudIns:e}).wrapEncryptDataCallFunction(n.bind(e))(t):function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.provider,n=e.spaceId,r=e.functionName,i=we(),o=i.appId,a=i.uniPlatform,s=i.osName,u=a;"app"===a&&(u=s);var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.provider,n=e.spaceId,r=V;if(!r)return{};t=function(e){return"tencent"===e?"tcb":e}(t);var i=r.find((function(e){return e.provider===t&&e.spaceId===n}));return i&&i.config}({provider:t,spaceId:n});if(!c||!c.accessControl||!c.accessControl.enable)return!1;var l=c.accessControl.function||{},d=Object.keys(l);if(0===d.length)return!0;var f=function(e,t){for(var n,r,i,o=0;o<e.length;o++){var a=e[o];a!==t?"*"!==a?a.split(",").map((function(e){return e.trim()})).indexOf(t)>-1&&(r=a):i=a:n=a}return n||r||i}(d,r);if(!f)return!1;if((l[f]||[]).find((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.appId===o&&(e.platform||"").toLowerCase()===u.toLowerCase()})))return!0;throw console.error("\u6b64\u5e94\u7528[appId: ".concat(o,", platform: ").concat(u,"]\u4e0d\u5728\u4e91\u7aef\u914d\u7f6e\u7684\u5141\u8bb8\u8bbf\u95ee\u7684\u5e94\u7528\u5217\u8868\u5185\uff0c\u53c2\u8003\uff1ahttps://uniapp.dcloud.net.cn/uniCloud/secure-network.html#verify-client")),pn(fn.APP_INFO_INVALID)}({provider:a,spaceId:s,functionName:u})?new gn({secretType:t.secretType,uniCloudIns:e}).wrapVerifyClientCallFunction(n.bind(e))(t):r(t),Object.defineProperty(i,"result",{get:function(){return console.warn("\u5f53\u524d\u8fd4\u56de\u7ed3\u679c\u4e3aPromise\u7c7b\u578b\uff0c\u4e0d\u53ef\u76f4\u63a5\u8bbf\u95ee\u5176result\u5c5e\u6027\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003\uff1ahttps://uniapp.dcloud.net.cn/uniCloud/faq?id=promise"),{}}}),i.then((function(e){return e}))}}gn="mp-weixin"!==G&&"app"!==G?function(){return(0,m.default)((function e(){throw(0,v.default)(this,e),pn({message:"Platform ".concat(G," is not supported by secure network")})}))}():function(){return(0,m.default)((function e(){throw(0,v.default)(this,e),pn({message:"Platform ".concat(G," is not enabled, please check whether secure network module is enabled in your manifest.json")})}))}();var bn=Symbol("CLIENT_DB_INTERNAL");function wn(e,t){return e.then="DoNotReturnProxyWithAFunctionNamedThen",e._internalType=bn,e.inspect=null,e.__ob__=void 0,new Proxy(e,{get:function(e,n,r){if("_uniClient"===n)return null;if("symbol"==(0,u.default)(n))return e[n];if(n in e||"string"!=typeof n){var i=e[n];return"function"==typeof i?i.bind(e):i}return t.get(e,n,r)}})}function Sn(e){return{on:function(t,n){e[t]=e[t]||[],e[t].indexOf(n)>-1||e[t].push(n)},off:function(t,n){e[t]=e[t]||[];var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}}}var In=["db.Geo","db.command","command.aggregate"];function Cn(e,t){return In.indexOf("".concat(e,".").concat(t))>-1}function Tn(e){switch(M(e)){case"array":return e.map((function(e){return Tn(e)}));case"object":return e._internalType===bn||Object.keys(e).forEach((function(t){e[t]=Tn(e[t])})),e;case"regexp":return{$regexp:{source:e.source,flags:e.flags}};case"date":return{$date:e.toISOString()};default:return e}}function On(e){return e&&e.content&&e.content.$method}var En=function(){function e(t,n,r){(0,v.default)(this,e),this.content=t,this.prevStage=n||null,this.udb=null,this._database=r}return(0,m.default)(e,[{key:"toJSON",value:function(){for(var e=this,t=[e.content];e.prevStage;)e=e.prevStage,t.push(e.content);return{$db:t.reverse().map((function(e){return{$method:e.$method,$param:Tn(e.$param)}}))}}},{key:"toString",value:function(){return JSON.stringify(this.toJSON())}},{key:"getAction",value:function(){var e=this.toJSON().$db.find((function(e){return"action"===e.$method}));return e&&e.$param&&e.$param[0]}},{key:"getCommand",value:function(){return{$db:this.toJSON().$db.filter((function(e){return"action"!==e.$method}))}}},{key:"isAggregate",get:function(){for(var e=this;e;){var t=On(e),n=On(e.prevStage);if("aggregate"===t&&"collection"===n||"pipeline"===t)return!0;e=e.prevStage}return!1}},{key:"isCommand",get:function(){for(var e=this;e;){if("command"===On(e))return!0;e=e.prevStage}return!1}},{key:"isAggregateCommand",get:function(){for(var e=this;e;){var t=On(e),n=On(e.prevStage);if("aggregate"===t&&"command"===n)return!0;e=e.prevStage}return!1}},{key:"getNextStageFn",value:function(e){var t=this;return function(){return xn({$method:e,$param:Tn(Array.from(arguments))},t,t._database)}}},{key:"count",get:function(){return this.isAggregate?this.getNextStageFn("count"):function(){return this._send("count",Array.from(arguments))}}},{key:"remove",get:function(){return this.isCommand?this.getNextStageFn("remove"):function(){return this._send("remove",Array.from(arguments))}}},{key:"get",value:function(){return this._send("get",Array.from(arguments))}},{key:"add",get:function(){return this.isCommand?this.getNextStageFn("add"):function(){return this._send("add",Array.from(arguments))}}},{key:"update",value:function(){return this._send("update",Array.from(arguments))}},{key:"end",value:function(){return this._send("end",Array.from(arguments))}},{key:"set",get:function(){return this.isCommand?this.getNextStageFn("set"):function(){throw new Error("JQL\u7981\u6b62\u4f7f\u7528set\u65b9\u6cd5")}}},{key:"_send",value:function(e,t){var n=this.getAction(),r=this.getCommand();return r.$db.push({$method:e,$param:Tn(t)}),this._database._callCloudFunction({action:n,command:r})}}]),e}();function xn(e,t,n){return wn(new En(e,t,n),{get:function(e,t){var r="db";return e&&e.content&&(r=e.content.$method),Cn(r,t)?xn({$method:t},e,n):function(){return xn({$method:t,$param:Tn(Array.from(arguments))},e,n)}}})}function Pn(e){var t=e.path,n=e.method;return function(){function e(){(0,v.default)(this,e),this.param=Array.from(arguments)}return(0,m.default)(e,[{key:"toJSON",value:function(){return{$newDb:[].concat((0,c.default)(t.map((function(e){return{$method:e}}))),[{$method:n,$param:this.param}])}}},{key:"toString",value:function(){return JSON.stringify(this.toJSON())}}]),e}()}var kn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.uniClient,r=void 0===n?{}:n,i=t.isJQL,o=void 0!==i&&i;(0,v.default)(this,e),this._uniClient=r,this._authCallBacks={},this._dbCallBacks={},r._isDefault&&(this._dbCallBacks=J("_globalUniCloudDatabaseCallback")),o||(this.auth=Sn(this._authCallBacks)),this._isJQL=o,Object.assign(this,Sn(this._dbCallBacks)),this.env=wn({},{get:function(e,t){return{$env:t}}}),this.Geo=wn({},{get:function(e,t){return Pn({path:["Geo"],method:t})}}),this.serverDate=Pn({path:[],method:"serverDate"}),this.RegExp=Pn({path:[],method:"RegExp"})}return(0,m.default)(e,[{key:"getCloudEnv",value:function(e){if("string"!=typeof e||!e.trim())throw new Error("getCloudEnv\u53c2\u6570\u9519\u8bef");return{$env:e.replace("$cloudEnv_","")}}},{key:"_callback",value:function(e,t){var n=this._dbCallBacks;n[e]&&n[e].forEach((function(e){e.apply(void 0,(0,c.default)(t))}))}},{key:"_callbackAuth",value:function(e,t){var n=this._authCallBacks;n[e]&&n[e].forEach((function(e){e.apply(void 0,(0,c.default)(t))}))}},{key:"multiSend",value:function(){var e=Array.from(arguments),t=e.map((function(e){var t=e.getAction(),n=e.getCommand();if("getTemp"!==n.$db[n.$db.length-1].$method)throw new Error("multiSend\u53ea\u652f\u6301\u5b50\u547d\u4ee4\u5185\u4f7f\u7528getTemp");return{action:t,command:n}}));return this._callCloudFunction({multiCommand:t,queryList:e})}}]),e}();function An(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return wn(new e(t),{get:function(e,t){return Cn("db",t)?xn({$method:t},null,e):function(){return xn({$method:t,$param:Tn(Array.from(arguments))},null,e)}}})}var Rn=function(e){(0,f.default)(n,e);var t=I(n);function n(){return(0,v.default)(this,n),t.apply(this,arguments)}return(0,m.default)(n,[{key:"_parseResult",value:function(e){return this._isJQL?e.result:e}},{key:"_callCloudFunction",value:function(e){var t=this,n=e.action,r=e.command,i=e.multiCommand,o=e.queryList;function a(e,t){if(i&&o)for(var n=0;n<o.length;n++){var r=o[n];r.udb&&"function"==typeof r.udb.setResult&&(t?r.udb.setResult(t):r.udb.setResult(e.result.dataList[n]))}}var s=this,u=this._isJQL?"databaseForJQL":"database";function c(e){return s._callback("error",[e]),te(ne(u,"fail"),e).then((function(){return te(ne(u,"complete"),e)})).then((function(){return a(null,e),le(oe.RESPONSE,{type:ae.CLIENT_DB,content:e}),Promise.reject(e)}))}var l=te(ne(u,"invoke")),d=this._uniClient;return l.then((function(){return d.callFunction({name:"DCloud-clientDB",type:R.CLIENT_DB,data:{action:n,command:r,multiCommand:i}})})).then((function(e){var n=e.result,r=n.code,i=n.message,o=n.token,l=n.tokenExpired,d=n.systemInfo,f=void 0===d?[]:d;if(f)for(var p=0;p<f.length;p++){var h=f[p],g=h.level,v=h.message,m=h.detail,y="[System Info]"+v;m&&(y="".concat(y,"\n\u8be6\u7ec6\u4fe1\u606f\uff1a").concat(m)),(console["app"===G&&"warn"===g?"error":g]||console.log)(y)}if(r)return c(new ge({code:r,message:i,requestId:e.requestId}));e.result.errCode=e.result.errCode||e.result.code,e.result.errMsg=e.result.errMsg||e.result.message,o&&l&&(be({token:o,tokenExpired:l}),t._callbackAuth("refreshToken",[{token:o,tokenExpired:l}]),t._callback("refreshToken",[{token:o,tokenExpired:l}]),le(oe.REFRESH_TOKEN,{token:o,tokenExpired:l}));for(var _=[{prop:"affectedDocs",tips:"affectedDocs\u4e0d\u518d\u63a8\u8350\u4f7f\u7528\uff0c\u8bf7\u4f7f\u7528inserted/deleted/updated/data.length\u66ff\u4ee3"},{prop:"code",tips:"code\u4e0d\u518d\u63a8\u8350\u4f7f\u7528\uff0c\u8bf7\u4f7f\u7528errCode\u66ff\u4ee3"},{prop:"message",tips:"message\u4e0d\u518d\u63a8\u8350\u4f7f\u7528\uff0c\u8bf7\u4f7f\u7528errMsg\u66ff\u4ee3"}],b=function(t){var n=_[t],r=n.prop,i=n.tips;if(r in e.result){var o=e.result[r];Object.defineProperty(e.result,r,{get:function(){return console.warn(i),o}})}},w=0;w<_.length;w++)b(w);return function(e){return te(ne(u,"success"),e).then((function(){return te(ne(u,"complete"),e)})).then((function(){a(e,null);var t=s._parseResult(e);return le(oe.RESPONSE,{type:ae.CLIENT_DB,content:t}),Promise.resolve(t)}))}(e)}),(function(e){return/fc_function_not_found|FUNCTION_NOT_FOUND/g.test(e.message)&&console.warn("clientDB\u672a\u521d\u59cb\u5316\uff0c\u8bf7\u5728web\u63a7\u5236\u53f0\u4fdd\u5b58\u4e00\u6b21schema\u4ee5\u5f00\u542fclientDB"),c(new ge({code:e.code||"SYSTEM_ERROR",message:e.message,requestId:e.requestId}))}))}}]),n}(kn),Dn="token\u65e0\u6548\uff0c\u8df3\u8f6c\u767b\u5f55\u9875\u9762",Ln="token\u8fc7\u671f\uff0c\u8df3\u8f6c\u767b\u5f55\u9875\u9762",Nn={TOKEN_INVALID_TOKEN_EXPIRED:Ln,TOKEN_INVALID_INVALID_CLIENTID:Dn,TOKEN_INVALID:Dn,TOKEN_INVALID_WRONG_TOKEN:Dn,TOKEN_INVALID_ANONYMOUS_USER:Dn},Mn={"uni-id-token-expired":Ln,"uni-id-check-token-failed":Dn,"uni-id-token-not-exist":Dn,"uni-id-check-device-feature-failed":Dn},$n=S(S(S({},Nn),Mn),{},{default:"\u7528\u6237\u672a\u767b\u5f55\u6216\u767b\u5f55\u72b6\u6001\u8fc7\u671f\uff0c\u81ea\u52a8\u8df3\u8f6c\u767b\u5f55\u9875\u9762"});function jn(e,t){var n="";return n=e?"".concat(e,"/").concat(t):t,n.replace(/^\//,"")}function Un(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=[],r=[];return e.forEach((function(e){!0===e.needLogin?n.push(jn(t,e.path)):!1===e.needLogin&&r.push(jn(t,e.path))})),{needLoginPage:n,notNeedLoginPage:r}}function Fn(e){return e.split("?")[0].replace(/^\//,"")}function Bn(){return function(e){var t=e&&e.$page&&e.$page.fullPath;return t?("/"!==t.charAt(0)&&(t="/"+t),t):""}(function(){var e=getCurrentPages();return e[e.length-1]}())}function qn(){return Fn(Bn())}function Wn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;if(!(t&&t.list&&t.list.length))return!1;var n=t.list,r=Fn(e);return n.some((function(e){return e.pagePath===r}))}var Hn,Vn=!!y.default.uniIdRouter,Gn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.default,t=e.pages,n=void 0===t?[]:t,r=e.subPackages,i=void 0===r?[]:r,o=e.uniIdRouter,a=void 0===o?{}:o,s=e.tabBar,u=void 0===s?{}:s,l=a.loginPage,d=a.needLogin,f=void 0===d?[]:d,p=a.resToLogin,h=void 0===p||p,g=Un(n),v=g.needLoginPage,m=g.notNeedLoginPage,_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[],n=[];return e.forEach((function(e){var r=e.root,i=e.pages,o=void 0===i?[]:i,a=Un(o,r),s=a.needLoginPage,u=a.notNeedLoginPage;t.push.apply(t,(0,c.default)(s)),n.push.apply(n,(0,c.default)(u))})),{needLoginPage:t,notNeedLoginPage:n}}(i),b=_.needLoginPage,w=_.notNeedLoginPage;return{loginPage:l,routerNeedLogin:f,resToLogin:h,needLoginPage:[].concat((0,c.default)(v),(0,c.default)(b)),notNeedLoginPage:[].concat((0,c.default)(m),(0,c.default)(w)),loginPageInTabBar:Wn(l,u)}}(),Yn=Gn.loginPage,Kn=Gn.routerNeedLogin,zn=Gn.resToLogin,Jn=Gn.needLoginPage,Qn=Gn.notNeedLoginPage,Xn=Gn.loginPageInTabBar;if(Jn.indexOf(Yn)>-1)throw new Error("Login page [".concat(Yn,'] should not be "needLogin", please check your pages.json'));function Zn(e){var t=qn();if("/"===e.charAt(0))return e;var n=e.split("?"),r=(0,s.default)(n,2),i=r[0],o=r[1],a=i.replace(/^\//,"").split("/"),u=t.split("/");u.pop();for(var c=0;c<a.length;c++){var l=a[c];".."===l?u.pop():"."!==l&&u.push(l)}return""===u[0]&&u.shift(),"/"+u.join("/")+(o?"?"+o:"")}function er(e){var t=Fn(Zn(e));return!(Qn.indexOf(t)>-1)&&(Jn.indexOf(t)>-1||Kn.some((function(t){return function(e,t){return new RegExp(t).test(e)}(e,t)})))}function tr(e){var t=e.redirect,n=Fn(t),r=Fn(Yn);return qn()!==r&&n!==r}function nr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.api,n=e.redirect;if(n&&tr({redirect:n})){var r=function(e,t){return"/"!==e.charAt(0)&&(e="/"+e),t?e.indexOf("?")>-1?e+"&uniIdRedirectUrl=".concat(encodeURIComponent(t)):e+"?uniIdRedirectUrl=".concat(encodeURIComponent(t)):e}(Yn,n);Xn?"navigateTo"!==t&&"redirectTo"!==t||(t="switchTab"):"switchTab"===t&&(t="navigateTo");var i={navigateTo:uni.navigateTo,redirectTo:uni.redirectTo,switchTab:uni.switchTab,reLaunch:uni.reLaunch};setTimeout((function(){i[t]({url:r})}),0)}}function rr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,n={abortLoginPageJump:!1,autoToLoginPage:!1},r=function(){var e,t=_e(),n=t.token,r=t.tokenExpired;if(n){if(r<Date.now()){var i="uni-id-token-expired";e={errCode:i,errMsg:$n[i]}}}else{var o="uni-id-check-token-failed";e={errCode:o,errMsg:$n[o]}}return e}();if(er(t)&&r){if(r.uniIdRedirectUrl=t,se(oe.NEED_LOGIN).length>0)return setTimeout((function(){le(oe.NEED_LOGIN,r)}),0),n.abortLoginPageJump=!0,n;n.autoToLoginPage=!0}return n}function ir(){!function(){var e=Bn(),t=rr({url:e}),n=t.abortLoginPageJump,r=t.autoToLoginPage;n||r&&nr({api:"redirectTo",redirect:e})}();for(var e=["navigateTo","redirectTo","reLaunch","switchTab"],t=function(t){var n=e[t];uni.addInterceptor(n,{invoke:function(e){var t=rr({url:e.url}),r=t.abortLoginPageJump,i=t.autoToLoginPage;return r?e:i?(nr({api:n,redirect:Zn(e.url)}),!1):e}})},n=0;n<e.length;n++)t(n)}function or(){this.onResponse((function(e){var t=e.type,n=e.content,r=!1;switch(t){case"cloudobject":r=function(e){if("object"!=(0,u.default)(e))return!1;var t=e||{},n=t.errCode;return n in $n}(n);break;case"clientdb":r=function(e){if("object"!=(0,u.default)(e))return!1;var t=e||{},n=t.errCode;return n in Nn}(n)}r&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=se(oe.NEED_LOGIN);pe().then((function(){var n=Bn();if(n&&tr({redirect:n}))return t.length>0?le(oe.NEED_LOGIN,Object.assign({uniIdRedirectUrl:n},e)):void(Yn&&nr({api:"navigateTo",redirect:n}))}))}(n)}))}function ar(e){!function(e){e.onResponse=function(e){ue(oe.RESPONSE,e)},e.offResponse=function(e){ce(oe.RESPONSE,e)}}(e),function(e){e.onNeedLogin=function(e){ue(oe.NEED_LOGIN,e)},e.offNeedLogin=function(e){ce(oe.NEED_LOGIN,e)},Vn&&(J(cn).needLoginInit||(J(cn).needLoginInit=!0,pe().then((function(){ir.call(e)})),zn&&or.call(e)))}(e),function(e){e.onRefreshToken=function(e){ue(oe.REFRESH_TOKEN,e)},e.offRefreshToken=function(e){ce(oe.REFRESH_TOKEN,e)}}(e)}var sr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ur=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;function cr(){var e,t,n=_e().token||"",r=n.split(".");if(!n||3!==r.length)return{uid:null,role:[],permission:[],tokenExpired:0};try{e=JSON.parse((t=r[1],decodeURIComponent(Hn(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))))}catch(n){throw new Error("\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f\u51fa\u9519\uff0c\u8be6\u7ec6\u9519\u8bef\u4fe1\u606f\u4e3a\uff1a"+n.message)}return e.tokenExpired=1e3*e.exp,delete e.exp,delete e.iat,e}Hn="function"!=typeof atob?function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!ur.test(e))throw new Error("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");var t;e+="==".slice(2-(3&e.length));for(var n,r,i="",o=0;o<e.length;)t=sr.indexOf(e.charAt(o++))<<18|sr.indexOf(e.charAt(o++))<<12|(n=sr.indexOf(e.charAt(o++)))<<6|(r=sr.indexOf(e.charAt(o++))),i+=64===n?String.fromCharCode(t>>16&255):64===r?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return i}:atob;var lr=C((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="chooseAndUploadFile:ok",i="chooseAndUploadFile:fail";function o(e,t){return e.tempFiles.forEach((function(e,n){e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),t&&(e.fileType=t),e.cloudPath=Date.now()+"_"+n+e.name.substring(e.name.lastIndexOf("."))})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((function(e){return e.path}))),e}function a(e,t,r){var i=r.onChooseFile,o=r.onUploadProgress;return t.then((function(e){if(i){var t=i(e);if(void 0!==t)return Promise.resolve(t).then((function(t){return void 0===t?e:t}))}return e})).then((function(t){return!1===t?{errMsg:n,tempFilePaths:[],tempFiles:[]}:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,i=arguments.length>3?arguments[3]:void 0;(t=Object.assign({},t)).errMsg=n;var o=t.tempFiles,a=o.length,s=0;return new Promise((function(n){for(;s<r;)u();function u(){var r=s++;if(r>=a)!o.find((function(e){return!e.url&&!e.errMsg}))&&n(t);else{var c=o[r];e.uploadFile({provider:c.provider,filePath:c.path,cloudPath:c.cloudPath,fileType:c.fileType,cloudPathAsRealPath:c.cloudPathAsRealPath,onUploadProgress:function(e){e.index=r,e.tempFile=c,e.tempFilePath=c.path,i&&i(e)}}).then((function(e){c.url=e.fileID,r<a&&u()})).catch((function(e){c.errMsg=e.errMsg||e.message,r<a&&u()}))}}}))}(e,t,5,o)}))}t.initChooseAndUploadFile=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"all"};return"image"===t.type?a(e,function(e){var t=e.count,n=e.sizeType,r=e.sourceType,a=void 0===r?["album","camera"]:r,s=e.extension;return new Promise((function(e,r){uni.chooseImage({count:t,sizeType:n,sourceType:a,extension:s,success:function(t){e(o(t,"image"))},fail:function(e){r({errMsg:e.errMsg.replace("chooseImage:fail",i)})}})}))}(t),t):"video"===t.type?a(e,function(e){var t=e.camera,n=e.compressed,r=e.maxDuration,a=e.sourceType,s=void 0===a?["album","camera"]:a,u=e.extension;return new Promise((function(e,a){uni.chooseVideo({camera:t,compressed:n,maxDuration:r,sourceType:s,extension:u,success:function(t){var n=t.tempFilePath,r=t.duration,i=t.size,a=t.height,s=t.width;e(o({errMsg:"chooseVideo:ok",tempFilePaths:[n],tempFiles:[{name:t.tempFile&&t.tempFile.name||"",path:n,size:i,type:t.tempFile&&t.tempFile.type||"",width:s,height:a,duration:r,fileType:"video",cloudPath:""}]},"video"))},fail:function(e){a({errMsg:e.errMsg.replace("chooseVideo:fail",i)})}})}))}(t),t):a(e,function(e){var t=e.count,n=e.extension;return new Promise((function(e,a){var s=uni.chooseFile;if("undefined"!=typeof r&&"function"==typeof r.chooseMessageFile&&(s=r.chooseMessageFile),"function"!=typeof s)return a({errMsg:i+" \u8bf7\u6307\u5b9a type \u7c7b\u578b\uff0c\u8be5\u5e73\u53f0\u4ec5\u652f\u6301\u9009\u62e9 image \u6216 video\u3002"});s({type:"all",count:t,extension:n,success:function(t){e(o(t))},fail:function(e){a({errMsg:e.errMsg.replace("chooseFile:fail",i)})}})}))}(t),t)}}})),dr=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(lr),fr={auto:"auto",onready:"onready",manual:"manual"};function pr(e){return{props:{localdata:{type:Array,default:function(){return[]}},options:{type:[Object,Array],default:function(){return{}}},spaceInfo:{type:Object,default:function(){return{}}},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1}},data:function(){return{mixinDatacomLoading:!1,mixinDatacomHasMore:!1,mixinDatacomResData:[],mixinDatacomErrorMessage:"",mixinDatacomPage:{},mixinDatacomError:null}},created:function(){var e=this;this.mixinDatacomPage={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch((function(){var t=[];return["pageCurrent","pageSize","localdata","collection","action","field","orderby","where","getont","getcount","gettree","groupby","groupField","distinct"].forEach((function(n){t.push(e[n])})),t}),(function(t,n){if(e.loadtime!==fr.manual){for(var r=!1,i=[],o=2;o<t.length;o++)t[o]!==n[o]&&(i.push(t[o]),r=!0);t[0]!==n[0]&&(e.mixinDatacomPage.current=e.pageCurrent),e.mixinDatacomPage.size=e.pageSize,e.onMixinDatacomPropsChange(r,i)}}))},methods:{onMixinDatacomPropsChange:function(e,t){},mixinDatacomEasyGet:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.getone,r=void 0!==n&&n,i=t.success,o=t.fail;this.mixinDatacomLoading||(this.mixinDatacomLoading=!0,this.mixinDatacomErrorMessage="",this.mixinDatacomError=null,this.mixinDatacomGet().then((function(t){e.mixinDatacomLoading=!1;var n=t.result,o=n.data,a=n.count;e.getcount&&(e.mixinDatacomPage.count=a),e.mixinDatacomHasMore=o.length<e.pageSize;var s=r?o.length?o[0]:void 0:o;e.mixinDatacomResData=s,i&&i(s)})).catch((function(t){e.mixinDatacomLoading=!1,e.mixinDatacomErrorMessage=t,e.mixinDatacomError=t,o&&o(t)})))},mixinDatacomGet:function(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r=r||{},n="undefined"!=typeof __uniX&&__uniX?e.databaseForJQL(this.spaceInfo):e.database(this.spaceInfo);var i=r.action||this.action;i&&(n=n.action(i));var o=r.collection||this.collection;n=Array.isArray(o)?(t=n).collection.apply(t,(0,c.default)(o)):n.collection(o);var a=r.where||this.where;a&&Object.keys(a).length&&(n=n.where(a));var s=r.field||this.field;s&&(n=n.field(s));var u=r.foreignKey||this.foreignKey;u&&(n=n.foreignKey(u));var l=r.groupby||this.groupby;l&&(n=n.groupBy(l));var d=r.groupField||this.groupField;d&&(n=n.groupField(d)),!0===(void 0!==r.distinct?r.distinct:this.distinct)&&(n=n.distinct());var f=r.orderby||this.orderby;f&&(n=n.orderBy(f));var p=void 0!==r.pageCurrent?r.pageCurrent:this.mixinDatacomPage.current,h=void 0!==r.pageSize?r.pageSize:this.mixinDatacomPage.size,g=void 0!==r.getcount?r.getcount:this.getcount,v=void 0!==r.gettree?r.gettree:this.gettree,m=void 0!==r.gettreepath?r.gettreepath:this.gettreepath,y={getCount:g},_={limitLevel:void 0!==r.limitlevel?r.limitlevel:this.limitlevel,startWith:void 0!==r.startwith?r.startwith:this.startwith};return v&&(y.getTree=_),m&&(y.getTreePath=_),n=n.skip(h*(p-1)).limit(h).get(y),n}}}}function hr(e){return J(ln.replace("{spaceId}",e.config.spaceId))}function gr(){return vr.apply(this,arguments)}function vr(){return vr=(0,l.default)(o.default.mark((function e(){var t,n,r,i,a,s,u,c=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:{},n=t.openid,r=t.callLoginByWeixin,i=void 0!==r&&r,a=hr(this),"mp-weixin"===G){e.next=4;break}throw new Error("[SecureNetwork] API `initSecureNetworkByWeixin` is not supported on platform `".concat(G,"`"));case 4:if(!n||!i){e.next=6;break}throw new Error("[SecureNetwork] openid and callLoginByWeixin cannot be passed at the same time");case 6:if(!n){e.next=8;break}return e.abrupt("return",(a.mpWeixinOpenid=n,{}));case 8:return e.next=10,new Promise((function(e,t){uni.login({success:function(t){e(t.code)},fail:function(e){t(new Error(e.errMsg))}})}));case 10:return s=e.sent,u=this.importObject("uni-id-co",{customUI:!0}),e.next=14,u.secureNetworkHandshakeByWeixin({code:s,callLoginByWeixin:i});case 14:return a.mpWeixinCode=s,e.abrupt("return",{code:s});case 16:case"end":return e.stop()}}),e,this)}))),vr.apply(this,arguments)}function mr(e){return yr.apply(this,arguments)}function yr(){return yr=(0,l.default)(o.default.mark((function e(t){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=hr(this),e.abrupt("return",(n.initPromise||(n.initPromise=gr.call(this,t).then((function(e){return e})).catch((function(e){throw delete n.initPromise,e}))),n.initPromise));case 2:case"end":return e.stop()}}),e,this)}))),yr.apply(this,arguments)}function _r(e){!function(e){Se=e}(e)}function br(e){var t="mp-weixin"===G&&r.canIUse("getAppBaseInfo"),n={getAppBaseInfo:t?uni.getAppBaseInfo:uni.getSystemInfo,getPushClientId:uni.getPushClientId};return function(r){return new Promise((function(i,o){t&&"getAppBaseInfo"===e?i(n[e]()):n[e](S(S({},r),{},{success:function(e){i(e)},fail:function(e){o(e)}}))}))}}var wr=function(e){(0,f.default)(n,e);var t=I(n);function n(){var e;return(0,v.default)(this,n),e=t.call(this),e._uniPushMessageCallback=e._receivePushMessage.bind((0,a.default)(e)),e._currentMessageId=-1,e._payloadQueue=[],e}return(0,m.default)(n,[{key:"init",value:function(){var e=this;return Promise.all([br("getAppBaseInfo")(),br("getPushClientId")()]).then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=(0,s.default)(t,2),r=n[0];r=void 0===r?{}:r;var i=r.appId,o=n[1];o=void 0===o?{}:o;var a=o.cid;if(!i)throw new Error("Invalid appId, please check the manifest.json file");if(!a)throw new Error("Invalid push client id");e._appId=i,e._pushClientId=a,e._seqId=Date.now()+"-"+Math.floor(9e5*Math.random()+1e5),e.emit("open"),e._initMessageListener()}),(function(t){throw e.emit("error",t),e.close(),t}))}},{key:"open",value:function(){var e=(0,l.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.init());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_isUniCloudSSE",value:function(e){if("receive"!==e.type)return!1;var t=e&&e.data&&e.data.payload;return!(!t||"UNI_CLOUD_SSE"!==t.channel||t.seqId!==this._seqId)}},{key:"_receivePushMessage",value:function(e){if(this._isUniCloudSSE(e)){var t=e&&e.data&&e.data.payload,n=t.action,r=t.messageId,i=t.message;this._payloadQueue.push({action:n,messageId:r,message:i}),this._consumMessage()}}},{key:"_consumMessage",value:function(){for(var e=this;;){var t=this._payloadQueue.find((function(t){return t.messageId===e._currentMessageId+1}));if(!t)break;this._currentMessageId++,this._parseMessagePayload(t)}}},{key:"_parseMessagePayload",value:function(e){var t=e.action,n=e.messageId,r=e.message;"end"===t?this._end({messageId:n,message:r}):"message"===t&&this._appendMessage({messageId:n,message:r})}},{key:"_appendMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.messageId,e.message);this.emit("message",t)}},{key:"_end",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.messageId,e.message);this.emit("end",t),this.close()}},{key:"_initMessageListener",value:function(){uni.onPushMessage(this._uniPushMessageCallback)}},{key:"_destroy",value:function(){uni.offPushMessage(this._uniPushMessageCallback)}},{key:"toJSON",value:function(){return{appId:this._appId,pushClientId:this._pushClientId,seqId:this._seqId}}},{key:"close",value:function(){this._destroy(),this.emit("close")}}]),n}(W);var Sr={tcb:jt,tencent:jt,aliyun:Ee,private:Vt,dcloud:Vt,alipay:tn},Ir=new(function(){function e(){(0,v.default)(this,e)}return(0,m.default)(e,[{key:"init",value:function(e){var t={},n=Sr[e.provider];if(!n)throw new Error("\u672a\u63d0\u4f9b\u6b63\u786e\u7684provider\u53c2\u6570");return t=n.init(e),function(e){e._initPromiseHub||(e._initPromiseHub=new q({createPromise:function(){var t=Promise.resolve();t=new Promise((function(e){setTimeout((function(){e()}),1)}));var n=e.auth();return t.then((function(){return n.getLoginState()})).then((function(e){return e?Promise.resolve():n.signInAnonymously()}))}}))}(t),_n(t),function(e){var t=e.uploadFile;e.uploadFile=function(e){return t.call(this,e)}}(t),function(e){e.database=function(t){if(t&&Object.keys(t).length>0)return e.init(t).database();if(this._database)return this._database;var n=An(Rn,{uniClient:e});return this._database=n,n},e.databaseForJQL=function(t){if(t&&Object.keys(t).length>0)return e.init(t).databaseForJQL();if(this._databaseForJQL)return this._databaseForJQL;var n=An(Rn,{uniClient:e,isJQL:!0});return this._databaseForJQL=n,n}}(t),function(e){e.getCurrentUserInfo=cr,e.chooseAndUploadFile=dr.initChooseAndUploadFile(e),Object.assign(e,{get mixinDatacom(){return pr(e)}}),e.SSEChannel=wr,e.initSecureNetworkByWeixin=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.openid,r=t.callLoginByWeixin,i=void 0!==r&&r;return mr.call(e,{openid:n,callLoginByWeixin:i})}}(e),e.setCustomClientInfo=_r,e.importObject=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.customUI=t.customUI||e.customUI,e.parseSystemError=t.parseSystemError||e.parseSystemError,Object.assign(e.loadingOptions,t.loadingOptions),Object.assign(e.errorOptions,t.errorOptions),"object"==(0,u.default)(t.secretMethods)&&(e.secretMethods=t.secretMethods),e}({customUI:!1,loadingOptions:{title:"\u52a0\u8f7d\u4e2d...",mask:!0},errorOptions:{type:"modal",retry:!1}},n);var r=n,i=r.customUI,a=r.loadingOptions,s=r.errorOptions,c=r.parseSystemError,d=!i;return new Proxy({},{get:function(r,i){switch(i){case"toString":return"[object UniCloudObject]";case"toJSON":return{}}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fn,n=e.interceptorName,r=e.getCallbackArgs;return(0,l.default)(o.default.mark((function e(){var i,a,s,u,c,l,d=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(i=d.length,a=new Array(i),s=0;s<i;s++)a[s]=d[s];return u=r?r({params:a}):{},e.prev=2,e.next=5,te(ne(n,"invoke"),S({},u));case 5:return e.next=7,t.apply(void 0,a);case 7:return c=e.sent,e.next=10,te(ne(n,"success"),S(S({},u),{},{result:c}));case 10:return e.abrupt("return",c);case 13:return e.prev=13,e.t0=e["catch"](2),l=e.t0,e.next=18,te(ne(n,"fail"),S(S({},u),{},{error:l}));case 18:throw l;case 19:return e.prev=19,e.next=22,te(ne(n,"complete"),S(S({},u),{},l?{error:l}:{result:c}));case 22:return e.finish(19);case 23:case"end":return e.stop()}}),e,null,[[2,13,19,23]])})))}({fn:function(){var r=(0,l.default)(o.default.mark((function r(){var p,h,g,v,m,y,_,b,w,I,C,T,O,E,x,P=arguments;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:for(d&&uni.showLoading({title:a.title,mask:a.mask}),h=P.length,g=new Array(h),v=0;v<h;v++)g[v]=P[v];return m={name:t,type:R.OBJECT,data:{method:i,params:g}},"object"==(0,u.default)(n.secretMethods)&&function(e,t){var n=t.data.method,r=e.secretMethods||{},i=r[n]||r["*"];i&&(t.secretType=i)}(n,m),y=!1,r.prev=5,r.next=8,e.callFunction(m);case 8:p=r.sent,r.next=14;break;case 11:r.prev=11,r.t0=r["catch"](5),y=!0,p={result:new ge(r.t0)};case 14:if(_=p.result||{},b=_.errSubject,w=_.errCode,I=_.errMsg,C=_.newToken,d&&uni.hideLoading(),C&&C.token&&C.tokenExpired&&(be(C),le(oe.REFRESH_TOKEN,S({},C))),!w){r.next=39;break}if(T=I,!y||!c){r.next=24;break}return r.next=20,c({objectName:t,methodName:i,params:g,errSubject:b,errCode:w,errMsg:I});case 20:if(r.t1=r.sent.errMsg,r.t1){r.next=23;break}r.t1=I;case 23:T=r.t1;case 24:if(!d){r.next=37;break}if("toast"!==s.type){r.next=29;break}uni.showToast({title:T,icon:"none"}),r.next=37;break;case 29:if("modal"===s.type){r.next=31;break}throw new Error("Invalid errorOptions.type: ".concat(s.type));case 31:return r.next=33,(0,l.default)(o.default.mark((function e(){var t,n,r,i,a,s,u=arguments;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=t.title,r=t.content,i=t.showCancel,a=t.cancelText,s=t.confirmText,e.abrupt("return",new Promise((function(e,t){uni.showModal({title:n,content:r,showCancel:i,cancelText:a,confirmText:s,success:function(t){e(t)},fail:function(){e({confirm:!1,cancel:!0})}})})));case 2:case"end":return e.stop()}}),e)})))({title:"\u63d0\u793a",content:T,showCancel:s.retry,cancelText:"\u53d6\u6d88",confirmText:s.retry?"\u91cd\u8bd5":"\u786e\u5b9a"});case 33:if(O=r.sent,E=O.confirm,!s.retry||!E){r.next=37;break}return r.abrupt("return",f.apply(void 0,g));case 37:throw x=new ge({subject:b,code:w,message:I,requestId:p.requestId}),x.detail=p.result,le(oe.RESPONSE,{type:ae.CLOUD_OBJECT,content:x}),x;case 39:return r.abrupt("return",(le(oe.RESPONSE,{type:ae.CLOUD_OBJECT,content:p.result}),p.result));case 40:case"end":return r.stop()}}),r,null,[[5,11]])})));function f(){return r.apply(this,arguments)}return f}(),interceptorName:"callObject",getCallbackArgs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.params;return{objectName:t,methodName:i,params:n}}})}})}}(e)}(t),["callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","chooseAndUploadFile"].forEach((function(e){if(t[e]){var n=t[e];t[e]=function(){return n.apply(t,Array.from(arguments))},t[e]=function(e,t){return function(n){var r=this,i=!1;if("callFunction"===t){var o=n&&n.type||R.DEFAULT;i=o!==R.DEFAULT}var a="callFunction"===t&&!i,s=this._initPromiseHub.exec();n=n||{};var u=he(n),c=u.success,l=u.fail,d=u.complete,f=s.then((function(){return i?Promise.resolve():te(ne(t,"invoke"),n)})).then((function(){return e.call(r,n)})).then((function(e){return i?Promise.resolve(e):te(ne(t,"success"),e).then((function(){return te(ne(t,"complete"),e)})).then((function(){return a&&le(oe.RESPONSE,{type:ae.CLOUD_FUNCTION,content:e}),Promise.resolve(e)}))}),(function(e){return i?Promise.reject(e):te(ne(t,"fail"),e).then((function(){return te(ne(t,"complete"),e)})).then((function(){return le(oe.RESPONSE,{type:ae.CLOUD_FUNCTION,content:e}),Promise.reject(e)}))}));if(!(c||l||d))return f;f.then((function(e){c&&c(e),d&&d(e),a&&le(oe.RESPONSE,{type:ae.CLOUD_FUNCTION,content:e})}),(function(e){l&&l(e),d&&d(e),a&&le(oe.RESPONSE,{type:ae.CLOUD_FUNCTION,content:e})}))}}(t[e],e).bind(t)}})),t.init=this.init,t}}]),e}());t.uniCloud=Ir,function(){var e=Y,n={};if(e&&1===e.length)n=e[0],t.uniCloud=Ir=Ir.init(n),Ir._isDefault=!0;else{var r,i=["database","getCurrentUserInfo","importObject"];r=e&&e.length>0?"\u5e94\u7528\u6709\u591a\u4e2a\u670d\u52a1\u7a7a\u95f4\uff0c\u8bf7\u901a\u8fc7uniCloud.init\u65b9\u6cd5\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u670d\u52a1\u7a7a\u95f4":"\u5e94\u7528\u672a\u5173\u8054\u670d\u52a1\u7a7a\u95f4\uff0c\u8bf7\u5728uniCloud\u76ee\u5f55\u53f3\u952e\u5173\u8054\u670d\u52a1\u7a7a\u95f4",[].concat(["auth","callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile"],i).forEach((function(e){Ir[e]=function(){if(console.error(r),-1===i.indexOf(e))return Promise.reject(new ge({code:"SYS_ERR",message:r}));console.error(r)}}))}if(Object.assign(Ir,{get mixinDatacom(){return pr(Ir)}}),ar(Ir),Ir.addInterceptor=Z,Ir.removeInterceptor=ee,Ir.interceptObject=re,"app"===G&&(uni.__uniCloud=Ir),"app"===G||"web"===G){var o=function(){return K||(K=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;function e(){return this}return void 0!==e()?e():new Function("return this")()}(),K)}();o.uniCloud=Ir,o.UniCloudError=ge}}();var Cr=Ir;t.default=Cr}).call(this,n("0ee4"),n("ed83")["default"])},"86b3":function(e,t){e.exports=function(e,t){var n=-1,r=e.length;t||(t=Array(r));while(++n<r)t[n]=e[n];return t}},"873a":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentReference=void 0;var r=n("b9ff"),i=n("766b"),o=n("831e"),a=n("4316"),s=n("3e19"),u=function(){return u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},u.apply(this,arguments)},c=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},l=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},d="database.updateDocInTransaction",f=function(){function e(e,t,n){this._coll=t,this.id=n,this._transaction=e,this._request=this._transaction.getRequestMethod(),this._transactionId=this._transaction.getTransactionId()}return e.prototype.create=function(e){return c(this,void 0,void 0,(function(){var t,n,o,s;return l(this,(function(c){switch(c.label){case 0:return t={collectionName:this._coll,transactionId:this._transactionId,data:r.EJSON.stringify((0,a.serialize)(e),{relaxed:!1})},this.id&&(t["_id"]=this.id),[4,this._request.send("database.insertDocInTransaction",t)];case 1:if(n=c.sent(),n.code)throw n;if(o=r.EJSON.parse(n.inserted),s=r.EJSON.parse(n.ok),1==s&&1==o)return[2,u(u({},n),{ok:s,inserted:o})];throw new Error(i.ERRORS.INSERT_DOC_FAIL.message)}}))}))},e.prototype.get=function(){return c(this,void 0,void 0,(function(){var e,t;return l(this,(function(n){switch(n.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send("database.getInTransaction",e)];case 1:if(t=n.sent(),t.code)throw t;return[2,{data:"null"!==t.data?s.Util.formatField(r.EJSON.parse(t.data)):r.EJSON.parse(t.data),requestId:t.requestId}]}}))}))},e.prototype.set=function(e){return c(this,void 0,void 0,(function(){var t,n;return l(this,(function(i){switch(i.label){case 0:return t={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:r.EJSON.stringify((0,a.serialize)(e),{relaxed:!1}),upsert:!0},[4,this._request.send(d,t)];case 1:if(n=i.sent(),n.code)throw n;return[2,u(u({},n),{updated:r.EJSON.parse(n.updated),upserted:n.upserted?JSON.parse(n.upserted):null})]}}))}))},e.prototype.update=function(e){return c(this,void 0,void 0,(function(){var t,n;return l(this,(function(i){switch(i.label){case 0:return t={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:r.EJSON.stringify(o.UpdateSerializer.encode(e),{relaxed:!1})},[4,this._request.send(d,t)];case 1:if(n=i.sent(),n.code)throw n;return[2,u(u({},n),{updated:r.EJSON.parse(n.updated)})]}}))}))},e.prototype.delete=function(){return c(this,void 0,void 0,(function(){var e,t;return l(this,(function(n){switch(n.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send("database.deleteDocInTransaction",e)];case 1:if(t=n.sent(),t.code)throw t;return[2,u(u({},t),{deleted:r.EJSON.parse(t.deleted)})]}}))}))},e}();t.DocumentReference=f},"880e":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("7ca3")),o=(getApp(),n("139b")),a=o.formatRelativeTime,s=n("8e86"),u=s.previewImage,c=n("11ca"),l=c.cloudCall,d=n("2b90"),f={components:{},mixins:[d],data:function(){return{isLoading:!0,userInfo:{avatarUrl:"",nickName:"",bio:"",birthday:!1,age:!1},isSidebarOpen:!1,myPosts:[],page:0,hasMore:!0,PAGE_SIZE:5,swiperHeights:{},imageClampHeights:{},hasFirstShow_var:!1,unreadCount:0,currentTab:"posts",favoriteList:[],favoritePage:0,favoriteHasMore:!0,favoriteLoading:!1,currentUserOpenid:"",isAdmin:!1,swiperFixedHeight:"",selected:0,newFollowerCount:"",isLoadingMore:!1,isViewingSelf:!1,imgindex:0,img:""}},onLoad:function(e){var t=uni.getSystemInfoSync().windowWidth,n=Math.round(4*t/3);this.setData({swiperFixedHeight:n}),this.getProfileData()},onShow:function(){var t=n("d87a"),r=t.updateTabBarStatus;r(this,3),this._hasFirstShow?(e("log","\u3010profile\u3011onShow\u89e6\u53d1,\u5f00\u59cb\u5237\u65b0\u6570\u636e"," at pages/profile/profile.vue:443"),this.refreshProfileData()):(e("log","\u3010profile\u3011\u9996\u6b21\u663e\u793a,\u6807\u8bb0\u5df2\u663e\u793a"," at pages/profile/profile.vue:446"),this.setData({hasFirstShow_var:!0}))},onPullDownRefresh:function(){e("log","\u3010profile\u3011\u4e0b\u62c9\u5237\u65b0\u89e6\u53d1\uff0c\u5f53\u524d\u6807\u7b7e:",this.currentTab," at pages/profile/profile.vue:453"),"posts"===this.currentTab?(this.setData({myPosts:[],page:0,hasMore:!0,swiperHeights:{},imageClampHeights:{}}),this.loadMyPosts((function(){uni.stopPullDownRefresh(),e("log","\u3010profile\u3011\u4e0b\u62c9\u5237\u65b0\u7ed3\u675f"," at pages/profile/profile.vue:464")}))):"favorites"===this.currentTab&&(this.setData({favoriteList:[],favoritePage:0,favoriteHasMore:!0,swiperHeights:{},imageClampHeights:{}}),this.loadFavorites((function(){uni.stopPullDownRefresh(),e("log","\u3010profile\u3011\u6536\u85cf\u4e0b\u62c9\u5237\u65b0\u7ed3\u675f"," at pages/profile/profile.vue:476")})))},onReachBottom:function(){if(e("log","\u3010profile\u3011\u89e6\u5e95\u52a0\u8f7d\u89e6\u53d1, currentTab:",this.currentTab," at pages/profile/profile.vue:481"),"posts"===this.currentTab){if(e("log","\u3010profile\u3011\u89e6\u5e95\u52a0\u8f7d\u6211\u7684\u5e16\u5b50, hasMore:",this.hasMore,"isLoading:",this.isLoading,"\u5f53\u524d\u9875:",this.page," at pages/profile/profile.vue:483"),!this.hasMore||this.isLoading)return;this.loadMyPosts()}else if("favorites"===this.currentTab){if(e("log","\u3010profile\u3011\u89e6\u5e95\u52a0\u8f7d\u6536\u85cf, favoriteHasMore:",this.favoriteHasMore,"favoriteLoading:",this.favoriteLoading," at pages/profile/profile.vue:489"),!this.favoriteHasMore||this.favoriteLoading)return;this.loadFavorites()}},methods:{getProfileData:function(){this.checkLoginAndFetchData()},refreshProfileData:function(){e("log","\u3010profile\u3011\u5f00\u59cb\u5237\u65b0\u4e2a\u4eba\u8d44\u6599\u6570\u636e\uff0c\u5f53\u524d\u6807\u7b7e:",this.currentTab," at pages/profile/profile.vue:504");var t=uni.getStorageSync("shouldRefreshIndex");t&&(e("log","\u3010profile\u3011\u68c0\u6d4b\u5230\u9996\u9875\u9700\u8981\u5237\u65b0\u6807\u8bb0\uff0c\u6e05\u9664\u7f13\u5b58"," at pages/profile/profile.vue:509"),uni.removeStorageSync("shouldRefreshIndex")),this.userInfo&&this.userInfo._openid&&this.fetchUserProfile(),"posts"===this.currentTab?(this.setData({myPosts:[],page:0,hasMore:!0,swiperHeights:{},imageClampHeights:{}}),this.loadMyPosts((function(){e("log","\u3010profile\u3011onShow\u5237\u65b0\u5e16\u5b50\u6570\u636e\u5b8c\u6210"," at pages/profile/profile.vue:528")}))):"favorites"===this.currentTab&&(this.setData({favoriteList:[],favoritePage:0,favoriteHasMore:!0,swiperHeights:{},imageClampHeights:{}}),this.loadFavorites((function(){e("log","\u3010profile\u3011onShow\u5237\u65b0\u6536\u85cf\u6570\u636e\u5b8c\u6210"," at pages/profile/profile.vue:539")}))),this.checkUnreadMessages()},forceRefresh:function(){e("log","\u5f3a\u5236\u5237\u65b0\u6570\u636e"," at pages/profile/profile.vue:549"),this.setData({userInfo:{},myPosts:[],isLoading:!0,swiperHeights:{},imageClampHeights:{}}),this.checkLoginAndFetchData()},checkLoginAndFetchData:function(){var t=getApp(),n=t.globalData&&t.globalData.userInfo,r=t.globalData&&t.globalData._loginProcessCompleted;e("log","\ud83d\udd0d [profile] \u68c0\u67e5\u767b\u5f55\u72b6\u6001:",{hasUserInfo:!!n,hasOpenid:!(!n||!n._openid),loginProcessCompleted:r}," at pages/profile/profile.vue:568"),n&&n._openid?(this.fetchUserProfile(),this.loadMyPosts()):r?(this.setData({isLoading:!1}),e("log","\u26a0\ufe0f [profile] \u767b\u5f55\u6d41\u7a0b\u5df2\u5b8c\u6210\u4f46\u65e0\u7528\u6237\u4fe1\u606f\uff0c\u7528\u6237\u672a\u767b\u5f55"," at pages/profile/profile.vue:583")):(e("log","\u23f3 [profile] \u767b\u5f55\u6d41\u7a0b\u672a\u5b8c\u6210\uff0c\u7b49\u5f85\u4e2d..."," at pages/profile/profile.vue:587"),this.waitForLoginProcess())},waitForLoginProcess:function(){var t=this,n=setInterval((function(){var r=getApp(),i=r.globalData&&r.globalData._loginProcessCompleted;i&&(clearInterval(n),e("log","\u2705 [profile] \u767b\u5f55\u6d41\u7a0b\u5df2\u5b8c\u6210\uff0c\u91cd\u65b0\u68c0\u67e5\u767b\u5f55\u72b6\u6001"," at pages/profile/profile.vue:600"),t.checkLoginAndFetchData())}),100);setTimeout((function(){clearInterval(n),e("log","\u26a0\ufe0f [profile] \u7b49\u5f85\u767b\u5f55\u6d41\u7a0b\u8d85\u65f6\uff0c\u7ee7\u7eed\u6267\u884c"," at pages/profile/profile.vue:608"),t.checkLoginAndFetchData()}),5e3)},fetchUserProfile:function(){var t=this;this.$tcb.callFunction({name:"getOpenId"}).then((function(n){if(n.result&&n.result.openid){var r=n.result.openid,i=["ojYBd1_A3uCbQ1LGcHxWxOAeA5SE","ojYBd14JG3-ghYuGCI2WHmkMc9nE"].includes(r);e("log","\u5f53\u524d\u7528\u6237openid:",r," at pages/profile/profile.vue:622"),e("log","\u662f\u5426\u4e3a\u7ba1\u7406\u5458:",i," at pages/profile/profile.vue:623"),t.setData({currentUserOpenid:r,isAdmin:i})}var o=getApp(),a=o&&o.globalData&&o.globalData.openid;return t.$tcb.callFunction({name:"getMyProfileData",data:{openid:a}})})).then((function(n){if(e("log","getMyProfileData \u8fd4\u56de:",n," at pages/profile/profile.vue:642"),n.result&&n.result.success&&n.result.userInfo){var r=n.result.userInfo;r.birthday?r.age=t.calculateAge(r.birthday):r.age="",t.setData({userInfo:r,isLoading:!1})}else{uni.showToast({title:"\u4e2a\u4eba\u8d44\u6599\u6570\u636e\u5f02\u5e38",icon:"none",duration:3e3}),e("error","\u4e2a\u4eba\u8d44\u6599\u6570\u636e\u5f02\u5e38",n," at pages/profile/profile.vue:661");var i=uni.getStorageSync("userInfo");i&&(i.birthday&&(i.age=t.calculateAge(i.birthday)),t.setData({userInfo:i,isLoading:!1}))}})).catch((function(n){e("error","\u83b7\u53d6openid\u5931\u8d25:",n," at pages/profile/profile.vue:674");var r=getApp(),i=r&&r.globalData&&r.globalData.openid;t.$tcb.callFunction({name:"getMyProfileData",data:{openid:i}}).then((function(n){if(e("log","getMyProfileData \u8fd4\u56de:",n," at pages/profile/profile.vue:686"),n.result&&n.result.success&&n.result.userInfo){var r=n.result.userInfo;r.birthday?r.age=t.calculateAge(r.birthday):r.age="",t.setData({userInfo:r,isLoading:!1})}else{uni.showToast({title:"\u4e2a\u4eba\u8d44\u6599\u6570\u636e\u5f02\u5e38",icon:"none",duration:3e3});var i=uni.getStorageSync("userInfo");i&&(i.birthday&&(i.age=t.calculateAge(i.birthday)),t.setData({userInfo:i,isLoading:!1}))}})).catch((function(n){uni.showToast({title:"\u83b7\u53d6\u6570\u636e\u5931\u8d25",icon:"none"}),e("error","\u83b7\u53d6\u6570\u636e\u5931\u8d25",n," at pages/profile/profile.vue:720");var r=uni.getStorageSync("userInfo");r&&(r.birthday&&(r.age=t.calculateAge(r.birthday)),t.setData({userInfo:r,isLoading:!1}))}))}))},loadMyPosts:function(t){var n=this,r=this.page,i=this.PAGE_SIZE;e("log","\u3010profile\u3011\u8bf7\u6c42\u5206\u9875\u53c2\u6570:",{page:r,PAGE_SIZE:i,skip:r*i,limit:i}," at pages/profile/profile.vue:737"),0===r&&this.setData({isLoading:!0});var o=getApp(),a=o&&o.globalData&&o.globalData.openid;this.$tcb.callFunction({name:"getMyProfileData",data:{skip:r*i,limit:i,openid:a}}).then((function(t){if(t.result&&t.result.success){var o=t.result.posts||[];e("log","\u3010profile\u3011\u672c\u6b21\u8fd4\u56de\u5e16\u5b50\u6570\u91cf:",o.length," at pages/profile/profile.vue:764"),o.forEach((function(e){e.createTime&&(e.formattedCreateTime=n.formatTime(e.createTime)),e.imageUrls&&e.imageUrls.length>0&&(e.imageStyle="height: 0; padding-bottom: 75%;")}));var a=0===r?o:n.myPosts.concat(o);e("log","\u3010profile\u3011\u66f4\u65b0\u540e myPosts \u957f\u5ea6:",a.length,"hasMore:",o.length===i,"page:",r+1," at pages/profile/profile.vue:776"),n.setData({myPosts:a,page:r+1,hasMore:o.length===i})}})).catch((function(t){e("error","\u3010profile\u3011\u83b7\u53d6\u5e16\u5b50\u5931\u8d25:",t," at pages/profile/profile.vue:784"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){n.setData({isLoading:!1}),"function"===typeof t&&t()}))},calculateAge:function(t){if(!t)return"";try{var n=new Date(t);if(isNaN(n.getTime()))return"";var r=new Date,i=r.getFullYear()-n.getFullYear(),o=r.getMonth()-n.getMonth();return(o<0||0===o&&r.getDate()<n.getDate())&&i--,i>0?i:""}catch(a){return e("log","CatchClause",a," at pages/profile/profile.vue:817"),e("log","CatchClause",a," at pages/profile/profile.vue:818"),e("error","\u8ba1\u7b97\u5e74\u9f84\u5931\u8d25:",a," at pages/profile/profile.vue:819"),""}},formatTime:function(e){return a(e)},navigateToPostDetail:function(e){var t=e.currentTarget.dataset.id;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},onDelete:function(e){var t=e.currentTarget.dataset.postid,n=e.currentTarget.dataset.index,r=this;uni.showModal({title:"\u5220\u9664\u5e16\u5b50",content:"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u5e16\u5b50\u5417\uff1f",confirmText:"\u5220\u9664",cancelText:"\u4fdd\u5b58\u8349\u7a3f",confirmColor:"#ff4d4f",success:function(e){e.confirm?r.deletePost(t,n):r.saveToDraftBox(t,n)}})},deletePost:function(t,n){var r=this;uni.showLoading({title:"\u5220\u9664\u4e2d..."}),this.$tcb.callFunction({name:"deletePost",data:{postId:t}}).then((function(n){if(uni.hideLoading(),n.result&&n.result.success){uni.showToast({title:"\u5220\u9664\u6210\u529f"});var i=r.myPosts.filter((function(e){return e._id!==t}));r.setData({myPosts:i});try{uni.setStorageSync("shouldRefreshIndex",!0)}catch(o){e("log","CatchClause",o," at pages/profile/profile.vue:885"),e("log","CatchClause",o," at pages/profile/profile.vue:886")}}else uni.showToast({title:"\u5220\u9664\u5931\u8d25",icon:"none"})})).catch((function(e){uni.hideLoading(),uni.showToast({title:"\u8c03\u7528\u5931\u8d25",icon:"none"})}))},saveToDraftBox:function(t,n){var r=this,i=this;uni.showLoading({title:"\u4fdd\u5b58\u4e2d..."}),this.$tcb.callFunction({name:"getPostDetail",data:{postId:t}}).then((function(e){if(e.result&&e.result.post){var t=e.result.post,n={title:t.title||"",content:t.content||"",imageList:t.imageUrls?t.imageUrls.map((function(e){return{previewUrl:e,compressedPath:e,originalPath:e,needCompression:!1}})):[],publishMode:t.isPoem?"poem":"normal",isOriginal:t.isOriginal||!1,selectedTags:t.tags||[],customTag:"",author:t.author||"",saveTime:new Date},i=getApp(),o=i&&i.globalData&&i.globalData.openid;return r.$tcb.callFunction({name:"getMyProfileData",data:{action:"saveDraft",draftData:n,openid:o}})}return uni.hideLoading(),uni.showToast({title:"\u83b7\u53d6\u5e16\u5b50\u4fe1\u606f\u5931\u8d25",icon:"none"}),Promise.reject("\u83b7\u53d6\u5e16\u5b50\u4fe1\u606f\u5931\u8d25")})).then((function(e){var r;(uni.hideLoading(),e.result&&e.result.success)?(uni.showToast({title:"\u5df2\u4fdd\u5b58\u5230\u8349\u7a3f\u7bb1",icon:"success"}),i.deletePost(t,n)):uni.showToast({title:(null===(r=e.result)||void 0===r?void 0:r.message)||"\u4fdd\u5b58\u8349\u7a3f\u5931\u8d25",icon:"none"})})).catch((function(t){uni.hideLoading(),e("error","\u4fdd\u5b58\u8349\u7a3f\u5931\u8d25:",t," at pages/profile/profile.vue:975"),uni.showToast({title:"\u4fdd\u5b58\u8349\u7a3f\u5931\u8d25",icon:"none"})}))},updatePostCommentCount:function(e,t){var n=this.myPosts.findIndex((function(t){return t._id===e}));n>-1&&this.setData((0,i.default)({},"myPosts[".concat(n,"].commentCount"),t))},handlePreview:function(e){return u(e)},stopPropagation:function(){},onAvatarError:function(t){e("error","\u5934\u50cf\u52a0\u8f7d\u5931\u8d25:",t," at pages/profile/profile.vue:1004")},onImageError:function(t){e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25:",t.detail," at pages/profile/profile.vue:1010");var n=t.detail.src;e("error","\u5931\u8d25\u7684\u56fe\u7247URL:",n," at pages/profile/profile.vue:1012");var r=t.currentTarget.dataset,i=r.postindex,o=r.imgindex;if(void 0!==i&&void 0!==o){var a=this.myPosts[i];e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25\u7684\u4e0a\u4e0b\u6587:",{postId:a?a._id:"unknown",postTitle:a?a.title:"unknown",imageIndex:o,imageUrl:n}," at pages/profile/profile.vue:1016")}e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25\u8be6\u60c5:",{error:t.detail,src:n,dataset:t.currentTarget.dataset}," at pages/profile/profile.vue:1024")},testImageUrls:function(){e("log","=== \u5f00\u59cb\u6d4b\u8bd5\u56fe\u7247URL\u6709\u6548\u6027 ==="," at pages/profile/profile.vue:1033"),this.myPosts.forEach((function(t,n){e("log","\u5e16\u5b50".concat(n+1," (").concat(t._id,"):")," at pages/profile/profile.vue:1035"),e("log","  - \u6807\u9898:",t.title," at pages/profile/profile.vue:1036"),e("log","  - \u4f5c\u8005\u5934\u50cf:",t.authorAvatar," at pages/profile/profile.vue:1037"),e("log","  - \u56fe\u7247URLs:",t.imageUrls," at pages/profile/profile.vue:1038"),e("log","  - \u539f\u56feURLs:",t.originalImageUrls," at pages/profile/profile.vue:1039"),t.imageUrls&&t.imageUrls.length>0?t.imageUrls.forEach((function(t,n){e("log","  - \u56fe\u7247".concat(n+1,":"),t," at pages/profile/profile.vue:1042"),t&&t.startsWith("http")?e("log","    \u2705 \u683c\u5f0f\u6b63\u786e (HTTP URL)"," at pages/profile/profile.vue:1045"):t&&t.startsWith("cloud://")?e("log","    \u26a0\ufe0f \u683c\u5f0f\u4e3acloud:// (\u9700\u8981\u8f6c\u6362)"," at pages/profile/profile.vue:1047"):t?e("log","    ? \u672a\u77e5\u683c\u5f0f: ".concat(t)," at pages/profile/profile.vue:1051"):e("log","    \u274c URL\u4e3a\u7a7a"," at pages/profile/profile.vue:1049")})):e("log","  - \u65e0\u56fe\u7247"," at pages/profile/profile.vue:1055"),e("log","---"," at pages/profile/profile.vue:1057")})),e("log","=== \u56fe\u7247URL\u6d4b\u8bd5\u5b8c\u6210 ==="," at pages/profile/profile.vue:1059")},toggleSidebar:function(){this.setData({isSidebarOpen:!this.isSidebarOpen})},navigateToMyLikes:function(){uni.navigateTo({url:"/pages/my-likes/my-likes"})},navigateToFollowing:function(){uni.navigateTo({url:"/pages/following/following"})},navigateToFans:function(){uni.navigateTo({url:"/pages/fans/fans"})},navigateToEditProfile:function(){uni.navigateTo({url:"/pages/profile-edit/profile-edit"})},navigateToFavoriteFolders:function(){uni.navigateTo({url:"/pages/favorite-folders/favorite-folders"})},navigateToDraftBox:function(){uni.navigateTo({url:"/pages/draft-box/draft-box"})},navigateToMessages:function(){uni.navigateTo({url:"/pages/messages/messages"})},checkUnreadMessages:function(){var t=this;this.$tcb.callFunction({name:"getUnreadMessageCount"}).then((function(e){e.result&&e.result.success&&t.setData({unreadCount:e.result.count||0})})).catch((function(t){e("error","\u83b7\u53d6\u672a\u8bfb\u6d88\u606f\u5931\u8d25:",t," at pages/profile/profile.vue:1127")})),this.$tcb.callFunction({name:"follow",data:{action:"getNewFollowerCount"}}).then((function(e){e.result&&e.result.success&&t.setData({newFollowerCount:e.result.count||0})})).catch((function(t){e("error","\u83b7\u53d6\u65b0\u7c89\u4e1d\u6570\u91cf\u5931\u8d25:",t," at pages/profile/profile.vue:1142")}))},switchTab:function(t){var n=t.currentTarget.dataset.tab;e("log","\u3010profile\u3011\u5207\u6362\u5230\u6807\u7b7e:",n," at pages/profile/profile.vue:1149"),n!==this.currentTab&&(this.setData({currentTab:n}),"favorites"===n&&0===this.favoriteList.length&&this.loadFavorites())},loadFavorites:function(t){var n=this,r=this.favoritePage,i=this.PAGE_SIZE;e("log","\u3010profile\u3011\u8bf7\u6c42\u6536\u85cf\u5206\u9875\u53c2\u6570:",{favoritePage:r,PAGE_SIZE:i,skip:r*i,limit:i}," at pages/profile/profile.vue:1169"),this.setData({favoriteLoading:!0});var o=getApp(),a=o&&o.globalData&&o.globalData.openid;this.$tcb.callFunction({name:"getMyProfileData",data:{action:"getAllFavorites",skip:r*i,limit:i,openid:a}}).then((function(t){if(e("log","\u3010profile\u3011\u83b7\u53d6\u6536\u85cf\u8fd4\u56de:",t," at pages/profile/profile.vue:1191"),t.result&&t.result.success){var o=t.result.favorites||[];e("log","\u3010profile\u3011\u672c\u6b21\u8fd4\u56de\u6536\u85cf\u6570\u91cf:",o.length," at pages/profile/profile.vue:1194"),o.forEach((function(e){e.favoriteTime&&(e.formattedFavoriteTime=n.formatTime(e.favoriteTime)),e.imageUrls&&e.imageUrls.length>0&&(e.imageStyle="height: 0; padding-bottom: 75%;")}));var a=0===r?o:n.favoriteList.concat(o);e("log","\u3010profile\u3011\u66f4\u65b0\u540e\u6536\u85cf\u5217\u8868\u957f\u5ea6:",a.length,"favoriteHasMore:",o.length===i,"favoritePage:",r+1," at pages/profile/profile.vue:1208"),n.setData({favoriteList:a,favoritePage:r+1,favoriteHasMore:o.length===i})}else{var s;uni.showToast({title:(null===(s=t.result)||void 0===s?void 0:s.message)||"\u52a0\u8f7d\u6536\u85cf\u5931\u8d25",icon:"none"})}})).catch((function(t){e("error","\u3010profile\u3011\u83b7\u53d6\u6536\u85cf\u5931\u8d25:",t," at pages/profile/profile.vue:1228"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){n.setData({favoriteLoading:!1}),"function"===typeof t&&t()}))},navigateToFavoriteDetail:function(e){var t=e.currentTarget.dataset.id;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},removeFavorite:function(e){var t=e.currentTarget.dataset.favoriteId,n=e.currentTarget.dataset.index,r=this;uni.showModal({title:"\u786e\u8ba4\u53d6\u6d88\u6536\u85cf",content:"\u786e\u5b9a\u8981\u53d6\u6d88\u6536\u85cf\u8fd9\u4e2a\u5185\u5bb9\u5417\uff1f",success:function(e){if(e.confirm){uni.showLoading({title:"\u53d6\u6d88\u6536\u85cf\u4e2d..."});var i=getApp(),o=i&&i.globalData&&i.globalData.openid;r.callCloudFunction("getMyProfileData",{action:"removeFromFavorite",favoriteId:t,openid:o}).then((function(e){if(uni.hideLoading(),e.result&&e.result.success){uni.showToast({title:"\u5df2\u53d6\u6d88\u6536\u85cf"});var t=r.favoriteList.filter((function(e,t){return t!==n}));r.setData({favoriteList:t})}else uni.showToast({title:"\u53d6\u6d88\u6536\u85cf\u5931\u8d25",icon:"none"})})).catch((function(e){uni.hideLoading(),uni.showToast({title:"\u64cd\u4f5c\u5931\u8d25",icon:"none"})}))}}})},navigateBack:function(){uni.navigateBack()},navigateToImageManager:function(){uni.navigateTo({url:"/pages/image-manager/image-manager"})},navigateToFeedback:function(){uni.navigateTo({url:"/pages/feedback/feedback"})},navigateToFeedbackAdmin:function(){uni.navigateTo({url:"/pages/feedback-admin/feedback-admin"})},showLogoutConfirm:function(){var e=this;this.isSidebarOpen&&(this.isSidebarOpen=!1),setTimeout((function(){uni.showModal({title:"\u9000\u51fa\u767b\u5f55",content:"\u786e\u5b9a\u8981\u9000\u51fa\u767b\u5f55\u5417\uff1f",confirmText:"\u9000\u51fa",cancelText:"\u53d6\u6d88",confirmColor:"#ff6b6b",success:function(t){t.confirm&&e.performLogout()}})}),100)},performLogout:function(){e("log","\ud83d\udd0d [\u9000\u51fa\u767b\u5f55] \u5f00\u59cb\u6267\u884c\u9000\u51fa\u767b\u5f55\u6d41\u7a0b"," at pages/profile/profile.vue:1353");try{uni.removeStorageSync("userInfo"),uni.removeStorageSync("userOpenId");var t=getApp();t&&t.globalData&&(t.globalData.userInfo=null,t.globalData.openid=null,t.globalData._loginProcessCompleted=!1),this.setData({userInfo:null,myPosts:[],favoriteList:[],isLoading:!1,isSidebarOpen:!1}),e("log","\u2705 [\u9000\u51fa\u767b\u5f55] \u672c\u5730\u6570\u636e\u6e05\u9664\u5b8c\u6210"," at pages/profile/profile.vue:1377"),this.reinitializeAnonymousOpenid(),uni.showToast({title:"\u5df2\u9000\u51fa\u767b\u5f55",icon:"success",duration:1500}),setTimeout((function(){uni.redirectTo({url:"/pages/login/login"})}),1500)}catch(n){e("error","\u274c [\u9000\u51fa\u767b\u5f55] \u9000\u51fa\u767b\u5f55\u5931\u8d25:",n," at pages/profile/profile.vue:1397"),uni.showToast({title:"\u9000\u51fa\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none"})}},reinitializeAnonymousOpenid:function(){e("log","\ud83d\udd04 [\u9000\u51fa\u767b\u5f55] \u91cd\u65b0\u521d\u59cb\u5316\u533f\u540dopenid"," at pages/profile/profile.vue:1407"),this.$tcb.callFunction({name:"login"}).then((function(t){e("log","\u2705 [\u9000\u51fa\u767b\u5f55] \u533f\u540dopenid\u521d\u59cb\u5316\u6210\u529f:",t," at pages/profile/profile.vue:1413");var n=null;if(t.result&&t.result.openid?n=t.result.openid:t.openid?n=t.openid:t.result&&t.result.uid&&(n=t.result.uid),n){var r=getApp();r&&r.globalData&&(r.globalData.openid=n,e("log","\u2705 [\u9000\u51fa\u767b\u5f55] \u533f\u540dopenid\u5df2\u8bbe\u7f6e:",n," at pages/profile/profile.vue:1430")),uni.setStorageSync("userOpenId",n)}else e("error","\u274c [\u9000\u51fa\u767b\u5f55] \u65e0\u6cd5\u83b7\u53d6\u533f\u540dopenid"," at pages/profile/profile.vue:1436")})).catch((function(t){e("error","\u274c [\u9000\u51fa\u767b\u5f55] \u533f\u540dopenid\u521d\u59cb\u5316\u5931\u8d25:",t," at pages/profile/profile.vue:1439")}))},onScrollToLower:function(){var t=this;e("log","\u3010profile\u3011\u6eda\u52a8\u5230\u5e95\u90e8\uff0c\u5f53\u524d\u6807\u7b7e:",this.currentTab," at pages/profile/profile.vue:1446"),"posts"===this.currentTab?!this.hasMore||this.isLoadingMore||this.isLoading||(e("log","\u3010profile\u3011\u5f00\u59cb\u52a0\u8f7d\u66f4\u591a\u5e16\u5b50"," at pages/profile/profile.vue:1450"),this.setData({isLoadingMore:!0}),this.loadMyPosts((function(){t.setData({isLoadingMore:!1}),e("log","\u3010profile\u3011\u52a0\u8f7d\u66f4\u591a\u5e16\u5b50\u5b8c\u6210"," at pages/profile/profile.vue:1458")}))):"favorites"===this.currentTab&&this.favoriteHasMore&&!this.favoriteLoading&&(e("log","\u3010profile\u3011\u5f00\u59cb\u52a0\u8f7d\u66f4\u591a\u6536\u85cf"," at pages/profile/profile.vue:1464"),this.loadFavorites((function(){e("log","\u3010profile\u3011\u52a0\u8f7d\u66f4\u591a\u6536\u85cf\u5b8c\u6210"," at pages/profile/profile.vue:1466")})))},onAvatarLoad:function(){e("log","\u5360\u4f4d\uff1a\u51fd\u6570 onAvatarLoad \u672a\u58f0\u660e"," at pages/profile/profile.vue:1473")},navigateToUserProfile:function(){e("log","\u5360\u4f4d\uff1a\u51fd\u6570 navigateToUserProfile \u672a\u58f0\u660e"," at pages/profile/profile.vue:1477")},onTagClick:function(){e("log","\u5360\u4f4d\uff1a\u51fd\u6570 onTagClick \u672a\u58f0\u660e"," at pages/profile/profile.vue:1481")},callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(e,t,Object.assign({pageTag:"profile",context:this,requireAuth:!0},n))}}};t.default=f}).call(this,n("f3b9")["default"])},"88f6":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.registerRealtime=function(t){try{t.registerComponent(a),t.registerHook(o)}catch(n){e("warn",n," at node_modules/@cloudbase/realtime/dist/esm/index.js:29")}};var r=n("2f87"),i=n("7ba2"),o={target:"database",entity:function(){var e=this.platform,t=e.adapter,n=e.runtime;(0,i.setWsClass)(t.wsClass),(0,i.setRuntime)(n)}},a={name:"realtime",IIFE:!0,entity:function(){this.prototype.wsClientClass=r.RealtimeWebSocketClient}};try{cloudbase.registerComponent(a),cloudbase.registerHook(o)}catch(s){}}).call(this,n("f3b9")["default"])},"893d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloudbaseRequest=void 0,t.getRequestByEnvId=function(e){return _[e]},t.initRequest=function(e){_[e.env]=new y(s(s({},e),{throw:!0}))};var r=n("e61a"),i=n("5c02"),o=n("761f"),a=n("b168"),s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)},u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},c=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},d=i.constants.ERRORS,f=i.utils.genSeqId,p=i.utils.isFormData,h=i.utils.formatUrl,g=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"];function v(e,t,n){var r=e[t];e[t]=function(t){var i={},o={};n.forEach((function(n){var r=n.call(e,t),a=r.data,s=r.headers;Object.assign(i,a),Object.assign(o,s)}));var a=t.data;return a&&function(){p(a)?Object.keys(i).forEach((function(e){a.append(e,i[e])})):t.data=s(s({},a),i)}(),t.headers=s(s({},t.headers||{}),o),r.call(e,t)}}function m(){var e=f();return{data:{seqId:e},headers:{"X-SDK-Version":"@cloudbase/js-sdk/".concat((0,r.getSdkVersion)()),"x-seqid":e}}}var y=function(){function e(e){var t=this;this.throwWhenRequestFail=!1,this.config=e;var n={timeout:this.config.timeout,timeoutMsg:"[@cloudbase/js-sdk] \u8bf7\u6c42\u5728".concat(this.config.timeout/1e3,"s\u5185\u672a\u5b8c\u6210\uff0c\u5df2\u4e2d\u65ad"),restrictedMethods:["post","put"]};this.reqClass=new a.Platform.adapter.reqClass(n),this.throwWhenRequestFail=e.throw||!1,this.localCache=(0,o.getLocalCache)(this.config.env),v(this.reqClass,"post",[m]),v(this.reqClass,"upload",[m]),v(this.reqClass,"download",[m]),i.langEvent.bus.on(i.langEvent.LANG_CHANGE_EVENT,(function(e){var n;t.config.i18n=(null===(n=e.data)||void 0===n?void 0:n.i18n)||t.config.i18n}))}return e.prototype.getDefaultHeaders=function(){var e,t,n;return e={},e[null===(t=this.config.i18n)||void 0===t?void 0:t.LANG_HEADER_KEY]=null===(n=this.config.i18n)||void 0===n?void 0:n.lang,e},e.prototype.post=function(e,t){return u(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return[4,this.reqClass.post(s(s({},e),{headers:s(s({},e.headers),this.getDefaultHeaders()),customReqOpts:t}))];case 1:return n=r.sent(),[2,n]}}))}))},e.prototype.upload=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.reqClass.upload(s(s({},e),{headers:s(s({},e.headers),this.getDefaultHeaders())}))];case 1:return t=n.sent(),[2,t]}}))}))},e.prototype.download=function(e){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.reqClass.download(s(s({},e),{headers:s(s({},e.headers),this.getDefaultHeaders())}))];case 1:return t=n.sent(),[2,t]}}))}))},e.prototype.getBaseEndPoint=function(e){return void 0===e&&(e="CLOUD_API"),(0,r.getBaseEndPoint)(this.config.env,e)},e.prototype.getOauthAccessTokenV2=function(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return[4,e.getAccessToken()];case 1:return t=r.sent(),[4,e.getCredentials()];case 2:return n=r.sent(),[2,{accessToken:t,accessTokenExpire:new Date(n.expires_at).getTime()}]}}))}))},e.prototype.request=function(e,t,n,i){var o,a;return u(this,void 0,void 0,(function(){var u,l,d,f,p,v,m,y,_,b,w,S,I,C,T,O,E,x,P,k,A;return c(this,(function(c){switch(c.label){case 0:if(u="x-tcb-trace_".concat(this.config.env),l="application/x-www-form-urlencoded",d=s({action:e,dataVersion:r.DATA_VERSION,env:this.config.env},t),-1!==g.indexOf(e))return[3,2];if(f=this.config._fromApp,!f.oauthInstance)throw new Error("you can't request without auth");return p=f.oauthInstance,v=p.oauth2client,m=d,[4,this.getOauthAccessTokenV2(v)];case 1:m.access_token=c.sent().accessToken,c.label=2;case 2:return"storage.uploadFile"===e?(y=new FormData,Object.keys(y).forEach((function(e){Object.prototype.hasOwnProperty.call(y,e)&&void 0!==y[e]&&y.append(e,d[e])})),l="multipart/form-data"):(l="application/json;charset=UTF-8",y={},Object.keys(d).forEach((function(e){void 0!==d[e]&&(y[e]=d[e])}))),_={headers:s({"content-type":l},this.getDefaultHeaders())},(null===n||void 0===n?void 0:n.onUploadProgress)&&(_.onUploadProgress=n.onUploadProgress),this.config.region&&(_.headers["X-TCB-Region"]=this.config.region),b=this.localCache.getStore(u),b&&(_.headers["X-TCB-Trace"]=b),w=void 0!==(null===n||void 0===n?void 0:n.parse)?n.parse:t.parse,S=void 0!==(null===n||void 0===n?void 0:n.inQuery)?n.inQuery:t.inQuery,I=void 0!==(null===n||void 0===n?void 0:n.search)?n.search:t.search,C=s(s({},(null===n||void 0===n?void 0:n.defaultQuery)||{}),{env:this.config.env}),w&&(C.parse=!0),S&&(C=s(s({},S),C)),T=this.config.endPointMode||"CLOUD_API",O=(0,r.getEndPointInfo)(this.config.env,T),E=O.baseUrl,x=O.protocol,"functions.invokeFunction"!==e&&!/^(storage|database)\./.test(e)||"GATEWAY"!==T||(E="".concat(E.match(/\/\/([^/?#]*)/)[0],"/web")),P=n.pathname?h(x,"".concat(null===(o=(0,r.getBaseEndPoint)(this.config.env,T))||void 0===o?void 0:o.replace(/^https?:/,""),"/").concat(n.pathname),C):h(x,E,C),I&&(P+=I),[4,this.post(s({url:P,data:y},_),i)];case 3:if(k=c.sent(),A=null===(a=k.header)||void 0===a?void 0:a["x-tcb-trace"],A&&this.localCache.setStore(u,A),200!==Number(k.status)&&200!==Number(k.statusCode)||!k.data)throw new Error("network request error");return[2,k]}}))}))},e.prototype.fetch=function(e){var t,n,i,o,a,d,f,p;return u(this,void 0,void 0,(function(){var h,g,v,m,y,_,b,w,S=this;return c(this,(function(I){switch(I.label){case 0:h=e.token,g=e.headers,v=void 0===g?{}:g,m=l(e,["token","headers"]),y=function(){return u(S,void 0,void 0,(function(){var e,t,n;return c(this,(function(r){switch(r.label){case 0:if(null!=h)return[2,h];if(e=this.config._fromApp,!e.oauthInstance)throw new Error("you can't request without auth");return t=e.oauthInstance,n=t.oauth2client,[4,this.getOauthAccessTokenV2(n)];case 1:return[2,r.sent().accessToken]}}))}))},_=function(){return u(S,void 0,void 0,(function(){var e,t,n,i,o;return c(this,(function(a){switch(a.label){case 0:return t=(e=this.reqClass).fetch,i={},o={"X-SDK-Version":"@cloudbase/js-sdk/".concat((0,r.getSdkVersion)())},n="Bearer ".concat,[4,y()];case 1:return[2,t.apply(e,[s.apply(void 0,[(i.headers=s.apply(void 0,[s.apply(void 0,[(o.Authorization=n.apply("Bearer ",[a.sent()]),o),this.getDefaultHeaders()]),v]),i),m])])]}}))}))},I.label=1;case 1:return I.trys.push([1,3,,6]),[4,_()];case 2:return b=I.sent(),[2,b];case 3:if(w=I.sent(),"ACCESS_TOKEN_EXPIRED"!==(null===w||void 0===w?void 0:w.code))return[3,5];if("function"!==typeof(null===(o=null===(i=null===(n=null===(t=this.config)||void 0===t?void 0:t._fromApp)||void 0===n?void 0:n.oauthInstance)||void 0===i?void 0:i.authApi)||void 0===o?void 0:o.refreshTokenForce))throw w;return[4,null===(p=null===(f=null===(d=null===(a=this.config)||void 0===a?void 0:a._fromApp)||void 0===d?void 0:d.oauthInstance)||void 0===f?void 0:f.authApi)||void 0===p?void 0:p.refreshTokenForce()];case 4:return I.sent(),[2,_()];case 5:throw w;case 6:return[2]}}))}))},e.prototype.send=function(e,t,n,r){return void 0===t&&(t={}),void 0===n&&(n={}),u(this,void 0,void 0,(function(){var i;return c(this,(function(o){switch(o.label){case 0:return[4,this.request(e,t,s(s({},n),{onUploadProgress:t.onUploadProgress}),r)];case 1:if(i=o.sent(),i.data.code&&this.throwWhenRequestFail)throw new Error(JSON.stringify({code:d.OPERATION_FAIL,msg:"[".concat(i.data.code,"] ").concat(i.data.message)}));return[2,i.data]}}))}))},e.prototype.gateWay=function(e,t){return u(this,void 0,void 0,(function(){var n,o,a,u,l,f,p,h,g,v,m,y,_,b,w,S;return c(this,(function(c){switch(c.label){case 0:if(n=e.name,o=e.data,a=e.path,u=void 0===a?"":a,l=e.method,f=e.header,p=void 0===f?{}:f,!n||!u)throw new Error(JSON.stringify({code:d.INVALID_PARAMS,msg:"[gateWay] invalid function name or path"}));try{h=o?JSON.stringify(o):""}catch(I){throw new Error(JSON.stringify({code:d.INVALID_PARAMS,msg:"[gateWay] invalid data"}))}return g=i.utils.generateRequestId(),v=(0,r.getEndPointInfo)(this.config.env,"GATEWAY"),m=v.baseUrl,y=v.protocol,_="".concat(y).concat(m,"/").concat(u,"/").concat(n),[4,this.fetch({method:l||"POST",headers:s({"Content-Type":"application/json; charset=utf-8","X-Request-Id":g},p),body:h,url:_,customReqOpts:t})];case 1:return b=c.sent(),w=[s({requestId:g},b)],S={},[4,b.data];case 2:return[2,s.apply(void 0,w.concat([(S.data=c.sent(),S)]))]}}))}))},e}();t.CloudbaseRequest=y;var _={}},"8a2b":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.ZhiPuSimpleModel=void 0;var r=n("7a9b"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};function s(t){var n=t.messages,r=t.model,o=t.temperature,a=t.tool_choice,s=t.tools,u=t.top_p;return i(i({},t),{messages:n,model:r,temperature:o,tool_choice:function(){return a&&"auto"!==a&&e("warn","`tool_choice` is not 'auto'"," at node_modules/@cloudbase/ai/dist/esm/models/ZhiPu/index.js:53"),a}(),tools:s,top_p:u})}var u=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="zhipu/api/paas/v4/chat/completions",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(o){switch(o.label){case 0:return n=s(e),[4,this.req({url:this.url,data:i(i({},n),{stream:!1}),stream:!1,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return r=o.sent(),[2,i(i({},r),{rawResponse:r})]}}))}))},e.prototype.doStream=function(e,t){return o(this,void 0,void 0,(function(){var n,o,u,c,l,d;return a(this,(function(a){switch(a.label){case 0:return n=s(e),o=null,[4,this.req({url:this.url,data:i(i({},n),{stream:!0}),stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return u=a.sent(),c=(0,r.toPolyfillReadable)(u),l=(0,r.intoStandardStream)(c),d=l.pipeThrough(new r.TransformStream({transform:function(e,t){var n=e.choices.map((function(e){var t=e.delta;return null==o&&(o=(0,r.isToolCallAssistantMessage)(t)),o?i(i({},e),{finish_reason:"tool_calls",delta:t}):e})),a=i(i({},e),{choices:n});t.enqueue(i(i({},a),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(d)]}}))}))},e}();t.ZhiPuSimpleModel=u}).call(this,n("f3b9")["default"])},"8a60":function(e,t,n){var r=n("db60");e.exports=function(e,t){var n=e.length;while(n--)if(r(e[n][0],t))return n;return-1}},"8b28":function(e,t,n){(function(r,i){var o,a,s,u=n("3b2d");(function(n,r){"object"===u(t)&&"undefined"!==typeof e?r(t):(a=[t],o=r,s="function"===typeof o?o.apply(t,a):o,void 0===s||(e.exports=s))})(0,(function(e){"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{s(r.next(e))}catch(t){i(t)}}function a(e){try{s(r["throw"](e))}catch(t){i(t)}}function s(e){e.done?t(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}s((r=r.apply(e,[])).next())}))}function a(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var s=function(e){function n(t,n){var r=e.call(this,t)||this;return r.name="WxCloudSDKError",r.code=null===n||void 0===n?void 0:n.code,r.requestId=null===n||void 0===n?void 0:n.requestId,r.originError=null===n||void 0===n?void 0:n.originError,r}return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,e),n}(Error);function c(){return"undefined"!==typeof window&&window||"undefined"!==typeof globalThis&&globalThis}function l(){try{var e=c();if(!e)return;return"undefined"===typeof r?c().location.href:e.__wxRoute}catch(t){}}function d(){var e,t=c();return(null===t||void 0===t?void 0:t.navigator)?t.navigator.userAgent:"undefined"!==typeof r&&r.getSystemInfo?(r.getSystemInfo({success:function(t){t&&(e=["brand","model","version","system","platform","SDKVersion","language"].map((function(e){return"".concat(e,": ").concat(t[e])})).join(", "))}}),e):void 0}var f=function(e){var t=e.dataSourceName,n=e.methodName,r=e.params,u=e.realMethodName,c=e.callFunction,f=e.envType,p=void 0===f?"prod":f,h=e.mode;return o(void 0,0,void 0,(function(){var e,o,f,g,v,m;return a(this,(function(a){switch(a.label){case 0:e={data:{},requestId:""},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,c({name:"lowcode-datasource",data:{dataSourceName:t,methodName:n,params:r,userAgent:d(),referrer:l(),"x-sdk-version":"1.6.1",envType:p,mode:h}})];case 2:if(o=a.sent(),f=(null===(v=null===o||void 0===o?void 0:o.result)||void 0===v?void 0:v.requestId)||(null===o||void 0===o?void 0:o.requestId)||(null===o||void 0===o?void 0:o.requestID),null===o||void 0===o?void 0:o.result.code)throw new s("\u3010\u9519\u8bef\u3011".concat(null===o||void 0===o?void 0:o.result.message,"\n\u3010\u64cd\u4f5c\u3011\u8c03\u7528 models.").concat(t?"".concat(t,"."):"").concat(u,"\n\u3010\u9519\u8bef\u7801\u3011").concat(null===o||void 0===o?void 0:o.result.code,"\n\u3010\u8bf7\u6c42ID\u3011").concat(f||"N/A"),{code:null===o||void 0===o?void 0:o.result.code,requestId:f});return e.data=(null===(m=null===o||void 0===o?void 0:o.result)||void 0===m?void 0:m.data)||{},e.requestId=f,[3,4];case 3:throw g=a.sent(),"WxCloudSDKError"===g.name?g:(i("log",g," at node_modules/@cloudbase/wx-cloud-client-sdk/lib/wxCloudClientSDK.umd.js:203"),new s("\u3010\u9519\u8bef\u3011".concat(g.message,"\n      \u3010\u64cd\u4f5c\u3011\u8c03\u7528 models.").concat(t?"".concat(t,"."):"").concat(u,"\n      \u3010\u8bf7\u6c42ID\u3011N/A"),{code:"UnknownError",originError:g}));case 4:return[2,e]}}))}))},p=function(e){var t=e.sql,n=e.params,r=e.config,i=e.callFunction,s=e.unsafe,c=void 0!==s&&s;return o(void 0,0,void 0,(function(){return a(this,(function(e){return[2,f({realMethodName:"$runSQL",methodName:"callWedaApi",params:{action:"RunMysqlCommand",data:{sqlTemplate:t,config:r,parameter:c?"":Object.entries(n||{}).reduce((function(e,t){var n=t[0],r=t[1];if(void 0!==r){var i="OBJECT",o=u(r);switch(o){case"boolean":i="BOOLEAN";break;case"number":i="NUMBER";break;case"string":i="STRING";break;default:i=Array.isArray(r)?"ARRAY":"OBJECT"}e.push({key:n,type:i,value:"STRING"===i?r:JSON.stringify(r)})}return e}),[])||[]}},callFunction:i,mode:"sdk"})]}))}))},h=function(e){return{$runSQL:function(t,r,i){return o(this,0,void 0,(function(){var o;return a(this,(function(a){switch(a.label){case 0:return[4,p({sql:t,params:r,config:n(n({},i),{preparedStatements:!0}),callFunction:e})];case 1:return o=a.sent(),[2,o]}}))}))},$runSQLRaw:function(t,r){return o(this,0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:return[4,p({sql:t,params:[],config:n(n({},r),{preparedStatements:!1}),callFunction:e})];case 1:return i=o.sent(),[2,i]}}))}))}}},g={filter:{where:{}},select:{$master:!0}};function v(e){return{getUrl:function(t){return"".concat(t,"/").concat(e)},method:"post"}}var m={get:n(n({},v("get")),{defaultParams:n({},g)}),list:n(n({},v("list")),{defaultParams:n({},g)}),create:v("create"),createMany:v("createMany"),update:n(n({},v("update")),{method:"put"}),updateMany:n(n({},v("updateMany")),{method:"put"}),upsert:v("upsert"),delete:v("delete"),deleteMany:v("deleteMany")},y=function(e,t,n,r){var i=h(e);return new Proxy({},{get:function(e,o){if("string"===typeof o)return Object.prototype.hasOwnProperty.call(i,o)?i[o]:b(n,o,t,r)}})},_=function(e,t,n,r,i){return new s("\u3010\u9519\u8bef\u3011".concat(e,"\n\u3010\u64cd\u4f5c\u3011\u8c03\u7528 models.").concat(t,".").concat(n,"\n\u3010\u9519\u8bef\u7801\u3011").concat(r,"\n\u3010\u8bf7\u6c42ID\u3011").concat(i),{code:r,requestId:i})},b=function(e,t,r,i){var c=new Proxy({},{get:function(c,l){if("runSQLTemplate"!==l){var d=m[l];if(!d){var f=new Error("\u4e0d\u652f\u6301\u7684\u64cd\u4f5c: ".concat(l));throw new s(f.message||"Unknown error occurred",{originError:f,code:"NotSupported",requestId:"N/A"})}return function(n){return void 0===n&&(n={}),o(void 0,0,void 0,(function(){var i,o,u,c,f,p,h,g,v,m;return a(this,(function(a){switch(a.label){case 0:i=d.getUrl,o=d.method,u=d.defaultParams,c=void 0===u?{}:u,f=Object.assign({},c,n),p="pre"===f.envType?"pre":"prod",h=[e,p,i(t)].join("/"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,r({url:h,body:JSON.stringify(f),method:o})];case 2:if(g=a.sent(),g.code)throw _(null===g||void 0===g?void 0:g.message,t,l,null===g||void 0===g?void 0:g.code,null===g||void 0===g?void 0:g.requestId);return"get"===l&&Object.assign(g,{data:null!==(m=g.data.record)&&void 0!==m?m:g.data}),[2,g];case 3:throw v=a.sent(),new s((null===v||void 0===v?void 0:v.message)||"Unknown error occurred",{originError:v});case 4:return[2]}}))}))}}if(!(null===i||void 0===i?void 0:i.sqlBaseUrl)){f=new Error("\u4e0d\u652f\u6301\u7684\u64cd\u4f5c: ".concat(l));throw new s(f.message||"Unknown error occurred",{originError:f,code:"NotSupported",requestId:"N/A"})}return function(e){return o(void 0,0,void 0,(function(){var o,c,d,f,p,h,g,v,m,y,b,w,S,I,C,T;return a(this,(function(a){switch(a.label){case 0:o=e.params,c=e.templateName,d=e.envType,f="pre"===d?"pre":"prod",p=[i.sqlBaseUrl,f,c,"run"].join("/"),h=Object.entries(o||{}).reduce((function(e,t){var n=t[0],r=t[1];if(void 0!==r){var i="OBJECT",o=u(r);switch(o){case"boolean":i="BOOLEAN";break;case"number":i="NUMBER";break;case"string":i="STRING";break;default:i=Array.isArray(r)?"ARRAY":"OBJECT"}e.push({key:n,type:i,value:"STRING"===i?r:JSON.stringify(r)})}return e}),[]),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,r({url:p,body:JSON.stringify({parameter:h}),method:"POST"})];case 2:if(g=a.sent(),null===(m=null===g||void 0===g?void 0:g.Response)||void 0===m?void 0:m.Error)throw _(null===(b=null===(y=null===g||void 0===g?void 0:g.Response)||void 0===y?void 0:y.Error)||void 0===b?void 0:b.Message,t,l,null===(S=null===(w=null===g||void 0===g?void 0:g.Response)||void 0===w?void 0:w.Error)||void 0===S?void 0:S.Code,null===(I=null===g||void 0===g?void 0:g.Response)||void 0===I?void 0:I.RequestId);return[2,n(n({},null!==(C=null===g||void 0===g?void 0:g.Response)&&void 0!==C?C:{}),{data:null===(T=null===g||void 0===g?void 0:g.Response)||void 0===T?void 0:T.Data})];case 3:throw v=a.sent(),new s((null===v||void 0===v?void 0:v.message)||"Unknown error occurred",{originError:v});case 4:return[2]}}))}))}}});return c},w={create:{methodName:"wedaCreateV2"},createMany:{methodName:"wedaBatchCreateV2"},update:{methodName:"wedaUpdateV2"},upsert:{methodName:"wedaUpsertV2"},updateMany:{methodName:"wedaBatchUpdateV2"},delete:{methodName:"wedaDeleteV2"},deleteMany:{methodName:"wedaBatchDeleteV2"},get:{methodName:"wedaGetItemV2",defaultParams:{filter:{where:{}},select:{$master:!0}}},list:{methodName:"wedaGetRecordsV2",defaultParams:{filter:{where:{}},select:{$master:!0}}}},S=function(e){var t=h(e);return new Proxy({},{get:function(r,i){if("string"===typeof i)return Object.prototype.hasOwnProperty.call(t,i)?t[i]:function(e,t){var r=new Proxy({},{get:function(r,i){var u=w[i];if(!u){var c=new Error("\u4e0d\u652f\u6301\u7684\u64cd\u4f5c: ".concat(i));throw new s(c.message||"Unknown error occurred",{originError:c,code:"NotSupported",requestId:"N/A"})}return function(r){return o(void 0,0,void 0,(function(){var o,s,c,l,d;return a(this,(function(a){switch(a.label){case 0:return o=n(n({},u.defaultParams||{}),r||{}),[4,f({callFunction:t,dataSourceName:e,methodName:u.methodName,realMethodName:i,params:o,envType:null===r||void 0===r?void 0:r.envType})];case 1:return s=a.sent(),c={data:{}},l=u.responseKey,c.data=l?null===(d=null===s||void 0===s?void 0:s.data)||void 0===d?void 0:d[l]:null===s||void 0===s?void 0:s.data,[2,c]}}))}))}}});return r}(i,e)}})};function I(e){if(!e)throw new Error("cloud is required");if(!e.callFunction)throw new Error("cloud.callFunction is required");var t=S(e.callFunction.bind(e));return e.models=t,e}function C(e){var t,n,r,i,o=null===(n=null===(t=null===e||void 0===e?void 0:e.extend)||void 0===t?void 0:t.AI)||void 0===n?void 0:n.env;if("string"===typeof o&&o.trim()||(o=null===(r=null===e||void 0===e?void 0:e.config)||void 0===r?void 0:r.env),"string"===typeof o&&o.trim()||(o=null===(i=null===e||void 0===e?void 0:e.config)||void 0===i?void 0:i.envName),"string"!==typeof o||!o.trim())throw new Error("Generating default gateway base url failed: env not found");return o=o.trim(),{model:"https://".concat(o,".api.tcloudbasegateway.com/v1/model"),sql:"https://".concat(o,".api.tcloudbasegateway.com/v1/sql")}}var T={init:I,generateHTTPClient:y};e.default=T,e.generateHTTPClient=y,e.init=I,e.initHTTPOverCallFunction=function(e,t){var r=this;if(!e)throw new Error("cloud is required");if(!e.callFunction)throw new Error("cloud.callFunction is required");var s,u=e.callFunction.bind(e);try{var c=(null===t||void 0===t?void 0:t.baseUrl)||C(e).model,l=(null===t||void 0===t?void 0:t.sqlBaseUrl)||C(e).sql;s=y(u,(function(e){var t=e.url,i=e.body,s=e.method,c=e.headers;return o(r,0,void 0,(function(){var e,r,o;return a(this,(function(a){switch(a.label){case 0:return[4,u({name:"httpOverCallFunction",data:{url:t,method:null===s||void 0===s?void 0:s.toUpperCase(),headers:n(n({},c||{}),{"Content-Type":"application/json"}),body:i}})];case 1:return e=a.sent(),r=null===(o=null===e||void 0===e?void 0:e.result)||void 0===o?void 0:o.body,[2,r]}}))}))}),c,{sqlBaseUrl:l})}catch(d){i("error","init http orm client failed, try call function orm",d," at node_modules/@cloudbase/wx-cloud-client-sdk/lib/wxCloudClientSDK.umd.js:638"),s=S(u)}return e.models=s,e},Object.defineProperty(e,"__esModule",{value:!0})}))}).call(this,n("ed83")["default"],n("f3b9")["default"])},"8b5e":function(e,t,n){(function(r){var i,o,a;n("3b2d");(function(n,s){o=[],i=function(){"use strict";var e="undefined"!==typeof r?r:self;if("undefined"!==typeof e.TextEncoder&&"undefined"!==typeof e.TextDecoder)return{TextEncoder:e.TextEncoder,TextDecoder:e.TextDecoder};var t=["utf8","utf-8","unicode-1-1-utf-8"];return{TextEncoder:function(e){if(t.indexOf(e)<0&&"undefined"!==typeof e&&null!==e)throw new RangeError("Invalid encoding type. Only utf-8 is supported");this.encoding="utf-8",this.encode=function(e){if("string"!==typeof e)throw new TypeError("passed argument must be of type string");var t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);return t.split("").forEach((function(e,t){n[t]=e.charCodeAt(0)})),n}},TextDecoder:function(e,n){if(t.indexOf(e)<0&&"undefined"!==typeof e&&null!==e)throw new RangeError("Invalid encoding type. Only utf-8 is supported");if(this.encoding="utf-8",this.ignoreBOM=!1,this.fatal="undefined"!==typeof n&&"fatal"in n&&n.fatal,"boolean"!==typeof this.fatal)throw new TypeError("fatal flag must be boolean");this.decode=function(e,t){if("undefined"===typeof e)return"";var n="undefined"!==typeof t&&"stream"in t&&t.stream;if("boolean"!==typeof n)throw new TypeError("stream option must be boolean");if(ArrayBuffer.isView(e)){var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i=new Array(r.length);return r.forEach((function(e,t){i[t]=String.fromCharCode(e)})),decodeURIComponent(escape(i.join("")))}throw new TypeError("passed argument must be an array buffer view")}}}},a="function"===typeof i?i.apply(t,o):i,void 0===a||(e.exports=a)})()}).call(this,n("0ee4"))},"8b83":function(e,t,n){var r=n("9f0d"),i=n("db60"),o=Object.prototype,a=o.hasOwnProperty;e.exports=function(e,t,n){var o=e[t];a.call(e,t)&&i(o,n)&&(void 0!==n||t in e)||r(e,t,n)}},"8c3e":function(e,t,n){var r=n("b6fd"),i=n("92d6");e.exports=function(e,t){return e&&r(t,i(t),e)}},"8cb3":function(e,t,n){"use strict";n.r(t);var r=n("8e88"),i=n("4d97");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"8e05":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(t){try{t.registerComponent(_)}catch(n){e("warn",n," at node_modules/@cloudbase/functions/dist/esm/index.js:204")}};var i=r(n("3b2d")),o=n("5c02"),a=n("a671"),s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)},u=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":(0,i.default)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},c=function(e,t){if("object"===("undefined"===typeof Reflect?"undefined":(0,i.default)(Reflect))&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},d=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},f=o.constants.getSdkName,p=o.constants.ERRORS,h=o.constants.COMMUNITY_SITE_URL,g=o.utils.execCallback,v=o.helpers.catchErrorsDecorator,m=function(){function e(){}return e.prototype.callFunction=function(e,t,n){var r,i,u;return l(this,void 0,void 0,(function(){var c,l,h,v,m,y,_,b,w,S,I,C,T,O,E,x,P,k,A,R,D,L;return d(this,(function(d){switch(d.label){case 0:if(c=e.name,l=e.data,h=e.query,v=e.parse,m=e.search,y=e.type,_=e.path,b=void 0===_?"":_,w=e.method,S=e.header,I=void 0===S?{}:S,!c)throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("functions",".callFunction] invalid function name")}));try{C=l?JSON.stringify(l):""}catch(N){throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("functions",".callFunction] invalid data")}))}return"cloudrun"!==y?[3,2]:(T=o.utils.generateRequestId(),[4,a.requestContainer.call(this,{name:c,data:C,path:b,method:w,header:s(s({},I),{"X-Request-Id":T})})]);case 1:return D=d.sent(),[2,{result:D,requestId:T}];case 2:O=this,E=O.request,x=O.config,P="functions.invokeFunction",k={inQuery:h,parse:v,search:m,function_name:c,request_data:C},A={},d.label=3;case 3:return d.trys.push([3,8,,9]),"GATEWAY"!==x.endPointMode?[3,5]:[4,E.gateWay(s(s({},e),{path:"functions"}),n)];case 4:return R=d.sent(),A=s({requestId:R.requestId},(null===(r=R.data)||void 0===r?void 0:r.code)?R.data:{data:{response_data:R.data}}),[3,7];case 5:return[4,E.send(P,k,{defaultQuery:(null===(i=null===l||void 0===l?void 0:l.params)||void 0===i?void 0:i.action)?{action:null===(u=null===l||void 0===l?void 0:l.params)||void 0===u?void 0:u.action}:{}},n)];case 6:A=d.sent(),d.label=7;case 7:if(A.code)return[2,g(t,null,A)];if(D=A.data.response_data,v||"GATEWAY"===x.endPointMode)return[2,g(t,null,{result:D,requestId:A.requestId})];try{return D=JSON.parse(A.data.response_data),[2,g(t,null,{result:D,requestId:A.requestId})]}catch(N){g(t,new Error("[".concat(f(),"][").concat(p.INVALID_PARAMS,"][").concat("functions",".callFunction] response data must be json")))}return[3,9];case 8:return L=d.sent(),g(t,L),[3,9];case 9:return[2]}}))}))},u([v({customInfo:{className:"Cloudbase",methodName:"callFunction"},title:"\u51fd\u6570\u8c03\u7528\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 callFunction() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u73af\u5883\u4e0b\u662f\u5426\u5b58\u5728\u6b64\u51fd\u6570","  3 - \u51fd\u6570\u5b89\u5168\u89c4\u5219\u662f\u5426\u9650\u5236\u4e86\u5f53\u524d\u767b\u5f55\u72b6\u6001\u8bbf\u95ee","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(h)]}),c("design:type",Function),c("design:paramtypes",[Object,Function,Object]),c("design:returntype",Promise)],e.prototype,"callFunction",null),e}(),y=new m,_={name:"functions",entity:{callFunction:y.callFunction}};try{cloudbase.registerComponent(_)}catch(b){}}).call(this,n("f3b9")["default"])},"8e37":function(e,t,n){"use strict";n.r(t);var r=n("880e"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"8e86":function(e,t){function n(e){if(!e)return{current:"",urls:[]};if(e.currentTarget&&e.currentTarget.dataset){var t=e.currentTarget.dataset,n=t.src||t.current||t.url||Array.isArray(t.urls)&&t.urls[0]||"",r=t.originalImageUrls||t.urls||t.urlList,i=Array.isArray(r)?r.filter(Boolean):"string"===typeof r&&r?[r]:[];return{current:n,urls:i}}var o=e.current||e.src||Array.isArray(e.urls)&&e.urls[0]||Array.isArray(e.list)&&e.list[0]||"",a=Array.isArray(e.urls)?e.urls.filter(Boolean):Array.isArray(e.list)?e.list.filter(Boolean):[];return{current:o,urls:a}}function r(e){"undefined"!==typeof uni&&uni.showToast&&uni.showToast({title:e,icon:"none"})}e.exports={previewImage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.fallbackToast,o=void 0===i||i,a=n(e);if(!a.current&&0===a.urls.length)return o&&r("\u56fe\u7247\u6570\u636e\u7f3a\u5931"),!1;var s=a.urls.length?a.urls:[a.current],u=a.current||s[0];return u&&0!==s.length?uni.previewImage({current:u,urls:s}):(o&&r("\u56fe\u7247\u4e0d\u53ef\u9884\u89c8"),!1)}}},"8e88":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","skeleton-wrapper"),attrs:{_i:0}},[n("view",{staticClass:e._$s(1,"sc","skeleton-poem-card"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","skeleton-original-badge skeleton-animate"),attrs:{_i:2}}),n("view",{staticClass:e._$s(3,"sc","skeleton-author-info"),attrs:{_i:3}},[n("view",{staticClass:e._$s(4,"sc","skeleton-avatar skeleton-animate"),attrs:{_i:4}}),n("view",{staticClass:e._$s(5,"sc","skeleton-name skeleton-animate"),attrs:{_i:5}})]),n("view",{staticClass:e._$s(6,"sc","skeleton-title skeleton-animate"),attrs:{_i:6}}),n("view",{staticClass:e._$s(7,"sc","skeleton-content-large skeleton-animate"),attrs:{_i:7}}),n("view",{staticClass:e._$s(8,"sc","skeleton-content-large skeleton-animate"),attrs:{_i:8}}),n("view",{staticClass:e._$s(9,"sc","skeleton-content-large skeleton-animate"),attrs:{_i:9}})]),n("view",{staticClass:e._$s(10,"sc","skeleton-poem-card skeleton-secondary"),attrs:{_i:10}},[n("view",{staticClass:e._$s(11,"sc","skeleton-author-info"),attrs:{_i:11}},[n("view",{staticClass:e._$s(12,"sc","skeleton-avatar skeleton-animate"),attrs:{_i:12}}),n("view",{staticClass:e._$s(13,"sc","skeleton-name skeleton-animate"),attrs:{_i:13}})]),n("view",{staticClass:e._$s(14,"sc","skeleton-title skeleton-animate"),attrs:{_i:14}}),n("view",{staticClass:e._$s(15,"sc","skeleton-content-large skeleton-animate"),attrs:{_i:15}}),n("view",{staticClass:e._$s(16,"sc","skeleton-content-large skeleton-animate"),attrs:{_i:16}})])])},i=[]},"8ffa":function(e,t,n){var r=n("7647");e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports["default"]=e.exports},9008:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports["default"]=e.exports},"907e":function(e,t,n){"use strict";n.r(t);var r=n("4ecf"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"92b6":function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("7ca3")),o=n("df29"),a=n("a314"),s=n("978d"),u=n("506b"),c=n("6748"),l=n("b031"),d=n("be29"),f=n("2a43"),p=n("d9d2");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v={install:function(e,t){e.mixin(g(g({},o.pageLifetimes),{},{methods:{clone:a.clone,handleDataset:s.handleDataset,escape2Html:u.escape2Html,html2Escape:u.html2Escape,parseEventDynamicCode:c.parseEventDynamicCode,getTabBar:l.getTabBar,getRelationNodes:d.getRelationNodes,zpSelectComponent:f.selectComponent,zpSelectAllComponents:f.selectAllComponents,setData:p.setData}}))}};t.default=v},"92d6":function(e,t,n){var r=n("edee"),i=n("fc69"),o=n("6c67");e.exports=function(e){return o(e)?r(e):i(e)}},"92f5":function(e,t,n){var r=n("164b");e.exports=function(e){return r(e,5)}},"931d":function(e,t,n){var r=n("7647"),i=n("011a");e.exports=function(e,t,n){if(i())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,t);var a=new(e.bind.apply(e,o));return n&&r(a,n.prototype),a},e.exports.__esModule=!0,e.exports["default"]=e.exports},9456:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={data:function(){return{}},props:{},methods:{},created:function(){}}},"951c":function(e,t){e.exports=Vue},"95be":function(e,t){e.exports=function(e,t){var n=-1,r=null==e?0:e.length,i=0,o=[];while(++n<r){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}},"95ee":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[e._$s(1,"i",e.drafts.length>0)?n("view",{staticClass:e._$s(1,"sc","draft-list"),attrs:{_i:1}},e._l(e._$s(2,"f",{forItems:e.drafts}),(function(t,r,i,o){return n("view",{key:e._$s(2,"f",{forIndex:i,key:r}),staticClass:e._$s("2-"+o,"sc","draft-item"),attrs:{"data-draft":e._$s("2-"+o,"a-data-draft",t),_i:"2-"+o},on:{click:e.editDraft}},[n("view",{staticClass:e._$s("3-"+o,"sc","draft-content"),attrs:{_i:"3-"+o}},[n("view",{staticClass:e._$s("4-"+o,"sc","draft-title"),attrs:{_i:"4-"+o}},[e._v(e._$s("4-"+o,"t0-0",e._s(t.title||"\u65e0\u6807\u9898")))]),n("view",{staticClass:e._$s("5-"+o,"sc","draft-preview"),attrs:{_i:"5-"+o}},[e._v(e._$s("5-"+o,"t0-0",e._s(t.content||"\u65e0\u5185\u5bb9")))]),n("view",{staticClass:e._$s("6-"+o,"sc","draft-meta"),attrs:{_i:"6-"+o}},[n("text",{staticClass:e._$s("7-"+o,"sc","draft-time"),attrs:{_i:"7-"+o}},[e._v(e._$s("7-"+o,"t0-0",e._s(t.formattedSaveTime)))]),n("text",{staticClass:e._$s("8-"+o,"sc","draft-mode"),attrs:{_i:"8-"+o}},[e._v(e._$s("8-"+o,"t0-0",e._s("poem"===t.publishMode?"\u8bd7\u6b4c":"\u666e\u901a")))]),e._$s("9-"+o,"i",t.isOriginal)?n("text",{staticClass:e._$s("9-"+o,"sc","draft-original"),attrs:{_i:"9-"+o}}):e._e()])]),n("view",{staticClass:e._$s("10-"+o,"sc","draft-actions"),attrs:{_i:"10-"+o}},[n("button",{staticClass:e._$s("11-"+o,"sc","action-btn edit-btn"),attrs:{"data-draft":e._$s("11-"+o,"a-data-draft",t),_i:"11-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.editDraft(t)}}}),n("button",{staticClass:e._$s("12-"+o,"sc","action-btn delete-btn"),attrs:{"data-draft-id":e._$s("12-"+o,"a-data-draft-id",t._id),_i:"12-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.deleteDraft(t)}}})])])})),0):n("view",{staticClass:e._$s(13,"sc","empty-container"),attrs:{_i:13}},[n("view",{staticClass:e._$s(14,"sc","empty-icon"),attrs:{_i:14}}),n("view",{staticClass:e._$s(15,"sc","empty-text"),attrs:{_i:15}}),n("view",{staticClass:e._$s(16,"sc","empty-subtext"),attrs:{_i:16}}),n("button",{staticClass:e._$s(17,"sc","create-btn"),attrs:{_i:17},on:{click:e.goToPublish}})])])},i=[]},"95fb":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPromiseCallback=void 0;t.createPromiseCallback=function(){var e;if(!Promise){e=function(){},e.promise={};var t=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var n=new Promise((function(t,n){e=function(e,r){return e?n(e):t(r)}}));return e.promise=n,e}},"96f3":function(e,t,n){"use strict";n.r(t);var r=n("2c09"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},"978d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleDataset=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e&&!e.currentTarget&&(t.tagId?e.currentTarget={id:t.tagId}:e.currentTarget={dataset:t})}},"97d2":function(e,t,n){var r=n("95be"),i=n("0b48"),o=Object.prototype,a=o.propertyIsEnumerable,s=Object.getOwnPropertySymbols,u=s?function(e){return null==e?[]:(e=Object(e),r(s(e),(function(t){return a.call(e,t)})))}:i;e.exports=u},"98a0":function(e,t,n){(function(e){var r=n("4d0d"),i=t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===i,s=a?r.Buffer:void 0,u=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=u?u(n):new e.constructor(n);return e.copy(r),r}}).call(this,n("dc84")(e))},9930:function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},"9a09":function(e,t,n){var r=n("6823"),i=n("5271");e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},"9a58":function(e,t,n){"use strict";n.r(t);var r=n("1a29"),i=n("96f3");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"9ac9":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genRequestId=function(e){void 0===e&&(e="");return"".concat(e?"".concat(e,"_"):"").concat(+new Date,"_").concat(Math.random())},t.isInitEventMessage=function(e){return"INIT_EVENT"===e.msgType}},"9b0c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RealtimeListener=void 0;var r=function(){return function(e){this.close=e.close,this.onChange=e.onChange,this.onError=e.onError,e.debug&&Object.defineProperty(this,"virtualClient",{get:function(){return e.virtualClient}})}}();t.RealtimeListener=r},"9c6c":function(e,t,n){"use strict";n.r(t);var r=n("1f0b"),i=n("d7ac");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"9c82":function(e,t,n){"use strict";var r=n("47a9"),i=n("3b2d");Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AUTH_API_PREFIX",{enumerable:!0,get:function(){return l.AUTH_API_PREFIX}}),Object.defineProperty(t,"Auth",{enumerable:!0,get:function(){return c.Auth}}),t.authModels=t.CloudbaseOAuth=void 0;var o=r(n("7ca3")),a=r(n("0bdb")),s=r(n("67ad")),u=n("223b"),c=n("4861"),l=n("2ce5"),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!==typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n("7da3"));function f(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.authModels=d;var g=(0,a.default)((function e(t){(0,s.default)(this,e);var n=t.apiOrigin,r=t.apiPath,i=void 0===r?l.AUTH_API_PREFIX:r,o=t.clientId,a=t.env,d=t.storage,f=t.request,p=t.baseRequest,g=t.anonymousSignInFunc,v=t.wxCloud,m=t.adapter,y=t.onCredentialsError,_=t.headers,b=t.i18n,w=t.useWxCloud;this.oauth2client=new u.OAuth2Client({apiOrigin:n,apiPath:i,clientId:o,env:a,storage:d,baseRequest:p||f,anonymousSignInFunc:g,wxCloud:v,onCredentialsError:y,headers:_||{},i18n:b,useWxCloud:w}),this.authApi=new c.Auth(h(h({credentialsClient:this.oauth2client},t),{},{request:f?this.oauth2client.request.bind(this.oauth2client):void 0,adapter:m}))}));t.CloudbaseOAuth=g},"9e9d":function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.OATUH_LOGINTYPE=void 0,i(n("5cec"),t),i(n("a3ba"),t),t.OATUH_LOGINTYPE="constants"},"9ed9":function(e,t,n){"use strict";(function(e,t){var r=n("47a9"),i=r(n("7ca3"));n("38fc");var o,a=r(n("1bb2")),s=r(n("92b6")),u=r(n("951c")),c=r(n("606d"));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var d=c.default.init({env:"cloud1-5gb0pbyl400845f5",auth:{persistence:"local"}});function f(e){if("login"===e||"getOpenId"===e)return{openid:null,allowed:!0};var t=getApp(),n=t&&t.globalData&&t.globalData.openid;if(!n)try{n=uni.getStorageSync("userOpenId")||uni.getStorageSync("openid"),n&&(t.globalData=t.globalData||{},t.globalData.openid=n)}catch(i){}if(!n){var r=!t.globalData||!t.globalData._loginProcessCompleted;return r||uni.showToast({title:"\u7528\u6237\u672a\u767b\u5f55",icon:"none"}),{openid:null,allowed:!1}}return{openid:n,allowed:!0}}u.default.prototype.$tcb=d,e("log","\ud83d\udd27 [TCB\u521d\u59cb\u5316] TCB\u5b9e\u4f8b\u5df2\u521b\u5efa:",d," at main.js:27"),e("log","\ud83d\udd27 [TCB\u521d\u59cb\u5316] \u73af\u5883ID:",null===(o=d.config)||void 0===o?void 0:o.env," at main.js:28"),e("log","\ud83d\udd27 [TCB\u521d\u59cb\u5316] \u6570\u636e\u5e93\u65b9\u6cd5\u53ef\u7528:","function"===typeof d.database," at main.js:29"),u.default.prototype.$requireOpenid=function(){var e=getApp(),t=e&&e.globalData&&e.globalData.openid;if(!t)try{t=uni.getStorageSync("userOpenId")||uni.getStorageSync("openid"),t&&(e.globalData=e.globalData||{},e.globalData.openid=t)}catch(r){}if(!t){var n=!e.globalData||!e.globalData._loginProcessCompleted;n||uni.showToast({title:"\u7528\u6237\u672a\u767b\u5f55",icon:"none"})}return t};var p=t.callFunction.bind(t);t.callFunction=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name;if(!t)return p(e);var n=f(t),r=n.openid,i=n.allowed;if(!i){var o=new Error("NO_OPENID");return o.code="NO_OPENID","function"===typeof e.fail&&e.fail(o),"function"===typeof e.complete&&e.complete(o),Promise.reject(o)}var a=Object.assign({},e.data||{});r&&(a.openid=r);var s=Object.assign({},e,{data:a});return p(s)};var h=d.callFunction.bind(d);d.callFunction=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name;if(!t)return h(e);var n=f(t),r=n.openid,i=n.allowed;if(!i){var o=new Error("NO_OPENID");return o.code="NO_OPENID","function"===typeof e.fail&&e.fail(o),"function"===typeof e.complete&&e.complete(o),Promise.reject(o)}var a=Object.assign({},e.data||{});r&&(a.openid=r);var s=Object.assign({},e,{data:a});return h(s)},u.default.use(s.default),u.default.config.productionTip=!1,a.default.mpType="app";var g=new u.default(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},a.default));g.$mount()}).call(this,n("f3b9")["default"],n("861b")["uniCloud"])},"9eea":function(e,t,n){"use strict";(function(e,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.WxRequest=t.WxMpWebSocket=void 0,t.parseQueryString=g,t.wxMpStorage=void 0;var o=n("59ad"),a=n("f37f"),s=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(){return u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},u.apply(this,arguments)},c=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},l=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},d=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};var f=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this,r=e.timeout,i=e.timeoutMsg,o=e.restrictedMethods;return n._timeout=r||0,n._timeoutMsg=i||"\u8bf7\u6c42\u8d85\u65f6",n._restrictedMethods=o||["get","post","upload","download"],n}return s(n,t),n.prototype.post=function(t){var n=this;return new Promise((function(r,a){var s=t.url,u=t.data,c=t.headers,l=e.request({url:(0,o.formatUrl)("https:",s),data:u,timeout:n._timeout,method:"POST",header:c,success:function(e){e.statusCode>=200&&e.statusCode<300?r({statusCode:e.statusCode,status:e.statusCode,data:e.data}):a(e)},fail:function(e){a(e)},complete:function(e){if(e&&e.errMsg&&n._timeout&&-1!==n._restrictedMethods.indexOf("post")){var t=e.errMsg;if("request:fail timeout"===t){i("warn",n._timeoutMsg," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:159");try{l.abort()}catch(r){}}}}})}))},n.prototype.get=function(t){var n=this;return new Promise((function(r,a){var s=t.url,u=t.body,c=t.headers,l=(0,o.formatUrl)("https:",s),d=e.request({url:l,data:u,timeout:n._timeout,method:"GET",header:c,success:function(e){e.statusCode>=200&&e.statusCode<300?r({statusCode:e.statusCode,status:e.statusCode,data:e.data}):a(e)},fail:function(e){a(e)},complete:function(e){if(e&&e.errMsg&&n._timeout&&-1!==n._restrictedMethods.indexOf("get")){var t=e.errMsg;if(t.includes("timeout")){i("warn",n._timeoutMsg," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:204");try{d.abort()}catch(r){i("warn","Error when aborting requestTask",r," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:209")}}}}})}))},n.prototype.upload=function(t){var n=this,r=this;return new Promise((function(o){return c(n,void 0,void 0,(function(){var n,a,s,c,d,f;return l(this,(function(l){return n=t.url,a=t.file,s=t.data,c=t.headers,d=t.onUploadProgress,f=e.uploadFile({url:n,filePath:a,name:"file",formData:u({},s),header:c,timeout:this._timeout,success:function(e){var t={statusCode:e.statusCode,data:e.data||{}};200===e.statusCode&&s.success_action_status&&(t.statusCode=parseInt(s.success_action_status,10)),o(t)},fail:function(e){o(e)},complete:function(e){if(e&&e.errMsg&&r._timeout&&-1!==r._restrictedMethods.indexOf("upload")){var t=e.errMsg;if("request:fail timeout"===t){i("warn",r._timeoutMsg," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:252");try{f.abort()}catch(n){}}}}}),d&&f.onProgressUpdate((function(e){d(e)})),[2]}))}))}))},n.prototype.download=function(t){var n=this,r=this;return new Promise((function(a,s){var u=t.url,c=t.headers,l=e.downloadFile({url:(0,o.formatUrl)("https:",u),header:c,timeout:n._timeout,success:function(e){200===e.statusCode&&e.tempFilePath?a({statusCode:200,tempFilePath:e.tempFilePath}):a(e)},fail:function(e){s(e)},complete:function(e){if(e&&e.errMsg&&r._timeout&&-1!==r._restrictedMethods.indexOf("download")){var t=e.errMsg;if("request:fail timeout"===t){i("warn",r._timeoutMsg," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:301");try{l.abort()}catch(n){}}}}})}))},n.prototype.fetch=function(t){var n=t.url,r=t.body,s=t.enableAbort,u=t.headers,c=t.method,l=t.stream,d=void 0!==l&&l,f=t.signal,p=t.timeout,h=this,g=null!==p&&void 0!==p?p:this._timeout,v=null,m=new a.ReadableStream({start:function(e){v=e},cancel:function(){v=null}});return new Promise((function(t,a){d&&t({data:m});var l=e.request({url:(0,o.formatUrl)("https:",n),data:r,timeout:g,method:c.toUpperCase(),header:u,success:function(e){var n;null===(n=v)||void 0===n||n.close(),!d&&t(e)},fail:function(e){var t;if(null===(t=v)||void 0===t||t.close(),a(e),d)throw e},complete:function(e){if(e&&e.errMsg&&g&&-1!==h._restrictedMethods.indexOf("post")&&s){var t=e.errMsg;if("request:fail timeout"===t){i("warn",h._timeoutMsg," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:356");try{l.abort()}catch(n){i("warn","Error when aborting requestTask",n," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:361")}}}},enableChunked:d});if(l.onChunkReceived((function(e){var t;null===(t=v)||void 0===t||t.enqueue(new Uint8Array(e.data))})),f){var p=function(){try{l.abort()}catch(e){i("warn","Error when aborting requestTask",e," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:377")}};f.aborted?p():f.addEventListener("abort",(function(){return p()}))}}))},n}(o.AbstractSDKRequest);t.WxRequest=f;var p={setItem:function(t,n){e.setStorageSync(t,n)},getItem:function(t){return e.getStorageSync(t)},removeItem:function(t){e.removeStorageSync(t)},clear:function(){e.clearStorageSync()}};t.wxMpStorage=p;var h=function(){return function(t,n){void 0===n&&(n={});var r=e.connectSocket(u({url:t},n)),i={set onopen(e){r.onOpen(e)},set onmessage(e){r.onMessage(e)},set onclose(e){r.onClose(e)},set onerror(e){r.onError(e)},send:function(e){return r.send({data:e})},close:function(e,t){return r.close({code:e,reason:t})},get readyState(){return r.readyState},CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3};return i}}();function g(e){var t={},n=e.replace(/^[?#]/,"");if(!n)return t;var r=n.split("&");return r.forEach((function(e){var n=e.split("="),r=n[0],i=n[1];r=decodeURIComponent(r),i=decodeURIComponent(i),r&&(t[r]?Array.isArray(t[r])?t[r].push(i):t[r]=[t[r],i]:t[r]=i)})),t}t.WxMpWebSocket=h;var v={genAdapter:function(t){var n={root:{globalThis:{}},reqClass:f,wsClass:h,captchaOptions:{openURIWithCallback:function(e){var n=t.EventBus,r={},o=e;i("log","openURIWithCallback",e," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:478");var a=e.match(/^(data:.*?)(\?[^#\s]*)?$/);if(a){o=a[1],i("log","openURIWithCallback url",o," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:482");var s=a[2];s&&(r=g(s))}i("log","openURIWithCallback queryObj",r," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:488");var c=r.token,l=d(r,["token"]);return/^data:/.test(o)&&!c?Promise.reject({error:"invalid_argument",error_description:"invalie captcha data: "+e}):c?new Promise((function(e){i("log","wait for captcha..."," at node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js:503"),n.$emit("CAPTCHA_DATA_CHANGE",u(u({},l),{token:c,url:o})),n.$once("RESOLVE_CAPTCHA_DATA",(function(t){e(t)}))})):Promise.reject({error:"unimplemented",error_description:"need to impl captcha data"})}},localStorage:p,primaryStorage:o.StorageType.local,getAppSign:function(){var t=e.getAccountInfoSync();return function(){return"undefined"===typeof App&&"undefined"===typeof getApp&&!e.onAppHide&&!e.offAppHide&&!e.onAppShow&&!e.offAppShow}()?t&&t.plugin?t.plugin.appId:"":t&&t.miniProgram?t.miniProgram.appId:""}};return n},isMatch:function(){if("undefined"===typeof e)return!1;if("undefined"===typeof r)return!1;if(!e.getSystemInfoSync)return!1;if(!e.getStorageSync)return!1;if(!e.setStorageSync)return!1;if(!e.connectSocket)return!1;if(!e.request)return!1;try{if(!e.getSystemInfoSync())return!1;if("qq"===e.getSystemInfoSync().AppPlatform)return!1}catch(t){return!1}return!0},runtime:"wx_mp"},m=v;t.default=m}).call(this,n("ed83")["default"],n("ed83")["Page"],n("f3b9")["default"])},"9f0d":function(e,t,n){var r=n("a746");e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},"9f39":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){var e=this;this.listeners=[],this.signal={aborted:!1,addEventListener:function(t,n){"abort"===t&&e.listeners.push(n)}}}return e.prototype.abort=function(){this.signal.aborted||(this.signal.aborted=!0,this.listeners.forEach((function(e){return e()})))},e}(),i=r;t.default=i},"9fc1":function(e,t,n){var r=n("3b2d")["default"];function i(){"use strict";
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports["default"]=e.exports;var t,n={},o=Object.prototype,a=o.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",l=u.asyncIterator||"@@asyncIterator",d=u.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(t){f=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var i=t&&t.prototype instanceof _?t:_,o=Object.create(i.prototype),a=new R(r||[]);return s(o,"_invoke",{value:x(e,n,a)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var g="suspendedStart",v="executing",m="completed",y={};function _(){}function b(){}function w(){}var S={};f(S,c,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(D([])));C&&C!==o&&a.call(C,c)&&(S=C);var T=w.prototype=_.prototype=Object.create(S);function O(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,o,s,u){var c=h(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==r(d)&&a.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;s(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function x(e,n,r){var i=g;return function(o,a){if(i===v)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===g)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=v;var c=h(e,n,r);if("normal"===c.type){if(i=r.done?m:"suspendedYield",c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator["return"]&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=h(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function D(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(a.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(r(e)+" is not iterable")}return b.prototype=w,s(T,"constructor",{value:w,configurable:!0}),s(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,d,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,d,"GeneratorFunction")),e.prototype=Object.create(T),e},n.awrap=function(e){return{__await:e}},O(E.prototype),f(E.prototype,l,(function(){return this})),n.AsyncIterator=E,n.async=function(e,t,r,i,o){void 0===o&&(o=Promise);var a=new E(p(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},O(T),f(T,d,"Generator"),f(T,c,(function(){return this})),f(T,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=D,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:D(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},n}e.exports=i,e.exports.__esModule=!0,e.exports["default"]=e.exports},a212:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ArkSimpleModel",{enumerable:!0,get:function(){return a.ArkSimpleModel}}),Object.defineProperty(t,"DSSimpleModel",{enumerable:!0,get:function(){return s.DSSimpleModel}}),Object.defineProperty(t,"DefaultSimpleModel",{enumerable:!0,get:function(){return p.DefaultSimpleModel}}),Object.defineProperty(t,"HunYuanBetaSimpleModel",{enumerable:!0,get:function(){return i.HunYuanBetaSimpleModel}}),Object.defineProperty(t,"HunYuanExpSimpleModel",{enumerable:!0,get:function(){return l.HunYuanExpSimpleModel}}),Object.defineProperty(t,"HunYuanOpenSimpleModel",{enumerable:!0,get:function(){return d.HunYuanOpenSimpleModel}}),Object.defineProperty(t,"HunYuanSimpleModel",{enumerable:!0,get:function(){return o.HunYuanSimpleModel}}),t.MODELS=void 0,Object.defineProperty(t,"MoonshotSimpleModel",{enumerable:!0,get:function(){return c.MoonshotSimpleModel}}),Object.defineProperty(t,"ReactModel",{enumerable:!0,get:function(){return h.ReactModel}}),Object.defineProperty(t,"YiSimpleModel",{enumerable:!0,get:function(){return u.YiSimpleModel}}),Object.defineProperty(t,"ZhiPuSimpleModel",{enumerable:!0,get:function(){return r.ZhiPuSimpleModel}}),Object.defineProperty(t,"toolMap",{enumerable:!0,get:function(){return h.toolMap}});var r=n("8a2b"),i=n("551c"),o=n("76db"),a=n("edb3"),s=n("3158"),u=n("6492"),c=n("0f7e"),l=n("3f62"),d=n("e0e4"),f=n("ef55"),p=n("f16f"),h=n("438d"),g={hunyuan:o.HunYuanSimpleModel,"hunyuan-beta":i.HunYuanBetaSimpleModel,ark:a.ArkSimpleModel,dashscope:s.DSSimpleModel,"01-ai":u.YiSimpleModel,moonshot:c.MoonshotSimpleModel,zhipu:r.ZhiPuSimpleModel,"hunyuan-exp":l.HunYuanExpSimpleModel,"hunyuan-open":d.HunYuanOpenSimpleModel,deepseek:f.DeepSeekSimpleModel};t.MODELS=g},a2a2:function(e,t){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},a314:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clone=function(e){return JSON.parse(JSON.stringify(e))}},a369:function(e,t,n){var r=n("3644"),i=n("1f17"),o=n("3461"),a=n("e8c8"),s=r?r.prototype:void 0,u=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(a(t))return u?u.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},a383:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RegExp=void 0,t.RegExpConstructor=function(e){return new i(e)};var r=n("a4d5"),i=function(){function e(e){var t=e.regexp,n=e.options;if(!t)throw new TypeError("regexp must be a string");this.$regex=t,this.$options=n}return e.prototype.parse=function(){return{$regex:this.$regex,$options:this.$options}},Object.defineProperty(e.prototype,"_internalType",{get:function(){return r.SYMBOL_REGEXP},enumerable:!0,configurable:!0}),e}();t.RegExp=i},a3ba:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERRORS=void 0,t.ERRORS={INVALID_PARAMS:"INVALID_PARAMS",INVALID_SYNTAX:"INVALID_SYNTAX",INVALID_OPERATION:"INVALID_OPERATION",OPERATION_FAIL:"OPERATION_FAIL",NETWORK_ERROR:"NETWORK_ERROR",UNKOWN_ERROR:"UNKOWN_ERROR"}},a3fc:function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var a=o>=0?arguments[o]:e.cwd();if("string"!==typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(t=a+"/"+t,i="/"===a.charAt(0))}return t=n(r(t.split("/"),(function(e){return!!e})),!i).join("/"),(i?"/":"")+t||"."},t.normalize=function(e){var o=t.isAbsolute(e),a="/"===i(e,-1);return e=n(r(e.split("/"),(function(e){return!!e})),!o).join("/"),e||o||(e="."),e&&a&&(e+="/"),(o?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!==typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length;t++)if(""!==e[t])break;for(var n=e.length-1;n>=0;n--)if(""!==e[n])break;return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var i=r(e.split("/")),o=r(n.split("/")),a=Math.min(i.length,o.length),s=a,u=0;u<a;u++)if(i[u]!==o[u]){s=u;break}var c=[];for(u=s;u<i.length;u++)c.push("..");return c=c.concat(o.slice(s)),c.join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!==typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,i=!0,o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),47===t){if(!i){r=o;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!==typeof e&&(e+="");var t,n=0,r=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){n=t+1;break}}else-1===r&&(i=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!==typeof e&&(e+="");for(var t=-1,n=0,r=-1,i=!0,o=0,a=e.length-1;a>=0;--a){var s=e.charCodeAt(a);if(47!==s)-1===r&&(i=!1,r=a+1),46===s?-1===t?t=a:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){n=a+1;break}}return-1===t||-1===r||0===o||1===o&&t===r-1&&t===n+1?"":e.slice(t,r)};var i="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n("28d0"))},a42e:function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.MultiPolygon=void 0;var i=r(n("3b2d")),o=n("a4d5"),a=n("8539"),s=n("b8f2"),u=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=function(){function e(e){var t,n;if(!(0,a.isArray)(e))throw new TypeError('"polygons" must be of type Polygon[]. Received type '+(0,i.default)(e));if(0===e.length)throw new Error("MultiPolygon must contain 1 polygon at least");try{for(var r=u(e),o=r.next();!o.done;o=r.next()){var c=o.value;if(!(c instanceof s.Polygon))throw new TypeError('"polygon" must be of type Polygon[]. Received type '+(0,i.default)(c)+"[]")}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}this.polygons=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"MultiPolygon",coordinates:this.polygons.map((function(e){return e.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}))},t},e.prototype.toJSON=function(){return{type:"MultiPolygon",coordinates:this.polygons.map((function(e){return e.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}))}},e.validate=function(e){var t,n,r,i,o,s;if("MultiPolygon"!==e.type||!(0,a.isArray)(e.coordinates))return!1;try{for(var c=u(e.coordinates),l=c.next();!l.done;l=c.next()){var d=l.value;try{for(var f=(r=void 0,u(d)),p=f.next();!p.done;p=f.next()){var h=p.value;try{for(var g=(o=void 0,u(h)),v=g.next();!v.done;v=g.next()){var m=v.value;if(!(0,a.isNumber)(m[0])||!(0,a.isNumber)(m[1]))return!1}}catch(y){o={error:y}}finally{try{v&&!v.done&&(s=g.return)&&s.call(g)}finally{if(o)throw o.error}}}}catch(_){r={error:_}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}}catch(b){t={error:b}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return o.SYMBOL_GEO_POLYGON},enumerable:!0,configurable:!0}),e}();t.MultiPolygon=c},a4b5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.callApi=s,t.generateApis=function(){var e=this;return new Proxy({},{get:function(t,n){if("string"===typeof n)return c.call(e,n)}})},t.generateCallApis=c;var r=n("9e9d"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};function s(e,t){var n,s,u;return o(this,void 0,void 0,(function(){var o,c,l,d,f,p,h,g,v,m,y,_,b,w,S,I;return a(this,(function(a){switch(a.label){case 0:if(o=e||{},c=o.name,l=o.body,d=o.path,f=void 0===d?"":d,p=o.method,h=void 0===p?"POST":p,g=o.headers,v=void 0===g?{}:g,m=o.token,!c)throw new Error(JSON.stringify({code:r.ERRORS.INVALID_PARAMS,msg:"[apis] invalid api name"}));return y=this.getEndPointWithKey("GATEWAY"),_=y.BASE_URL,b=y.PROTOCOL,w="".concat(b).concat(_,"/apis/").concat(c),S=f.startsWith("/")?f:"/".concat(f),[4,this.request.fetch(i({url:"".concat(w).concat(S),method:h||"POST",headers:i({"Content-Type":"application/json; charset=utf-8"},v),body:l,token:(null===(n=null===m||void 0===m?void 0:m.trim)||void 0===n?void 0:n.call(m))||(null===(u=null===(s=v.Authorization)||void 0===s?void 0:s.replace)||void 0===u?void 0:u.call(s,/^Bearer /,""))||null},t))];case 1:return I=a.sent(),[4,I.data];case 2:return[2,a.sent()]}}))}))}var u=["GET","POST","PUT","DELETE","HEAD","OPTIONS","PATCH","REQUEST"];function c(e){var t=this;return new Proxy({},{get:function(n,r){if("string"!==typeof r)throw new Error("[apis] method must be string");var c=r.toLocaleUpperCase();if(!u.includes(c))throw new Error("[apis] invalid method: ".concat(r));return function(n,r){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,s.call(this,i({name:e,method:("REQUEST"===c?n.method:c)||"POST"},n),r)];case 1:return[2,t.sent()]}}))}))}}})}},a4d5:function(e,t,n){"use strict";var r=n("3b2d");Object.defineProperty(t,"__esModule",{value:!0});var i={SYMBOL_UNSET_FIELD_NAME:!0,SYMBOL_UPDATE_COMMAND:!0,SYMBOL_QUERY_COMMAND:!0,SYMBOL_LOGIC_COMMAND:!0,SYMBOL_GEO_POINT:!0,SYMBOL_GEO_LINE_STRING:!0,SYMBOL_GEO_POLYGON:!0,SYMBOL_GEO_MULTI_POINT:!0,SYMBOL_GEO_MULTI_LINE_STRING:!0,SYMBOL_GEO_MULTI_POLYGON:!0,SYMBOL_SERVER_DATE:!0,SYMBOL_REGEXP:!0};t.SYMBOL_UPDATE_COMMAND=t.SYMBOL_UNSET_FIELD_NAME=t.SYMBOL_SERVER_DATE=t.SYMBOL_REGEXP=t.SYMBOL_QUERY_COMMAND=t.SYMBOL_LOGIC_COMMAND=t.SYMBOL_GEO_POLYGON=t.SYMBOL_GEO_POINT=t.SYMBOL_GEO_MULTI_POLYGON=t.SYMBOL_GEO_MULTI_POINT=t.SYMBOL_GEO_MULTI_LINE_STRING=t.SYMBOL_GEO_LINE_STRING=void 0;var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var u=o?Object.getOwnPropertyDescriptor(e,s):null;u&&(u.get||u.set)?Object.defineProperty(i,s,u):i[s]=e[s]}i.default=e,n&&n.set(e,i);return i}(n("08b0"));function a(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var s=o.default.for("UNSET_FIELD_NAME");t.SYMBOL_UNSET_FIELD_NAME=s;var u=o.default.for("UPDATE_COMMAND");t.SYMBOL_UPDATE_COMMAND=u;var c=o.default.for("QUERY_COMMAND");t.SYMBOL_QUERY_COMMAND=c;var l=o.default.for("LOGIC_COMMAND");t.SYMBOL_LOGIC_COMMAND=l;var d=o.default.for("GEO_POINT");t.SYMBOL_GEO_POINT=d;var f=o.default.for("SYMBOL_GEO_LINE_STRING");t.SYMBOL_GEO_LINE_STRING=f;var p=o.default.for("SYMBOL_GEO_POLYGON");t.SYMBOL_GEO_POLYGON=p;var h=o.default.for("SYMBOL_GEO_MULTI_POINT");t.SYMBOL_GEO_MULTI_POINT=h;var g=o.default.for("SYMBOL_GEO_MULTI_LINE_STRING");t.SYMBOL_GEO_MULTI_LINE_STRING=g;var v=o.default.for("SYMBOL_GEO_MULTI_POLYGON");t.SYMBOL_GEO_MULTI_POLYGON=v;var m=o.default.for("SERVER_DATE");t.SYMBOL_SERVER_DATE=m;var y=o.default.for("REGEXP");t.SYMBOL_REGEXP=y},a535:function(e,t,n){var r=n("fc8d");e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},a601:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.QuerySerializer=void 0;var r=n("3b92"),i=n("c9ca"),o=n("a4d5"),a=n("8539"),s=n("f442"),u=n("eb9b"),c=function(){function e(){}return e.encode=function(e){var t=new l;return t.encodeQuery(e)},e}();t.QuerySerializer=c;var l=function(){function t(){}return t.prototype.encodeQuery=function(e,t){var n;return(0,u.isConversionRequired)(e)?(0,i.isLogicCommand)(e)?this.encodeLogicCommand(e):(0,r.isQueryCommand)(e)?this.encodeQueryCommand(e):(n={},n[t]=this.encodeQueryObject(e),n):(0,a.isObject)(e)?this.encodeQueryObject(e):e},t.prototype.encodeRegExp=function(e){return{$regex:e.source,$options:e.flags}},t.prototype.encodeLogicCommand=function(e){var t,n,r,o,u,c,l,d=this;switch(e.operator){case i.LOGIC_COMMANDS_LITERAL.NOR:case i.LOGIC_COMMANDS_LITERAL.AND:case i.LOGIC_COMMANDS_LITERAL.OR:var f=(0,s.operatorToString)(e.operator),p=e.operands.map((function(t){return d.encodeQuery(t,e.fieldName)}));return t={},t[f]=p,t;case i.LOGIC_COMMANDS_LITERAL.NOT:f=(0,s.operatorToString)(e.operator);var h=e.operands[0];if((0,a.isRegExp)(h))return n={},n[e.fieldName]=(r={},r[f]=this.encodeRegExp(h),r),n;p=this.encodeQuery(h)[e.fieldName];return o={},o[e.fieldName]=(u={},u[f]=p,u),o;default:f=(0,s.operatorToString)(e.operator);if(1===e.operands.length){var g=this.encodeQuery(e.operands[0]);return c={},c[f]=g,c}p=e.operands.map(this.encodeQuery.bind(this));return l={},l[f]=p,l}},t.prototype.encodeQueryCommand=function(e){return(0,r.isComparisonCommand)(e),this.encodeComparisonCommand(e)},t.prototype.encodeComparisonCommand=function(e){var t,n,i,a,c,l,d,f,p;if(e.fieldName===o.SYMBOL_UNSET_FIELD_NAME)throw new Error("Cannot encode a comparison command with unset field name");var h=(0,s.operatorToString)(e.operator);switch(e.operator){case r.QUERY_COMMANDS_LITERAL.EQ:case r.QUERY_COMMANDS_LITERAL.NEQ:case r.QUERY_COMMANDS_LITERAL.LT:case r.QUERY_COMMANDS_LITERAL.LTE:case r.QUERY_COMMANDS_LITERAL.GT:case r.QUERY_COMMANDS_LITERAL.GTE:case r.QUERY_COMMANDS_LITERAL.ELEM_MATCH:case r.QUERY_COMMANDS_LITERAL.EXISTS:case r.QUERY_COMMANDS_LITERAL.SIZE:case r.QUERY_COMMANDS_LITERAL.MOD:return t={},t[e.fieldName]=(n={},n[h]=(0,u.encodeInternalDataType)(e.operands[0]),n),t;case r.QUERY_COMMANDS_LITERAL.IN:case r.QUERY_COMMANDS_LITERAL.NIN:case r.QUERY_COMMANDS_LITERAL.ALL:return i={},i[e.fieldName]=(a={},a[h]=(0,u.encodeInternalDataType)(e.operands),a),i;case r.QUERY_COMMANDS_LITERAL.GEO_NEAR:var g=e.operands[0];return c={},c[e.fieldName]={$nearSphere:{$geometry:g.geometry.toJSON(),$maxDistance:g.maxDistance,$minDistance:g.minDistance}},c;case r.QUERY_COMMANDS_LITERAL.GEO_WITHIN:g=e.operands[0];return l={},l[e.fieldName]={$geoWithin:{$geometry:g.geometry.toJSON()}},l;case r.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS:g=e.operands[0];return d={},d[e.fieldName]={$geoIntersects:{$geometry:g.geometry.toJSON()}},d;default:return f={},f[e.fieldName]=(p={},p[h]=(0,u.encodeInternalDataType)(e.operands[0]),p),f}},t.prototype.encodeQueryObject=function(e){var t=(0,u.flattenQueryObject)(e);for(var n in t){var o=t[n];if((0,i.isLogicCommand)(o)){t[n]=o._setFieldName(n);var a=this.encodeLogicCommand(t[n]);this.mergeConditionAfterEncode(t,a,n)}else if((0,r.isComparisonCommand)(o)){t[n]=o._setFieldName(n);a=this.encodeComparisonCommand(t[n]);this.mergeConditionAfterEncode(t,a,n)}else(0,u.isConversionRequired)(o)&&(t[n]=(0,u.encodeInternalDataType)(o))}return t},t.prototype.mergeConditionAfterEncode=function(t,n,r){for(var i in n[r]||delete t[r],n)t[i]?(0,a.isArray)(t[i])?t[i]=t[i].concat(n[i]):(0,a.isObject)(t[i])?(0,a.isObject)(n[i])?Object.assign(t,n):(e("warn","unmergable condition, query is object but condition is "+(0,a.getType)(n)+", can only overwrite",n,r," at node_modules/@cloudbase/database/dist/esm/serializer/query.js:214"),t[i]=n[i]):(e("warn","to-merge query is of type "+(0,a.getType)(t)+", can only overwrite",t,n,r," at node_modules/@cloudbase/database/dist/esm/serializer/query.js:219"),t[i]=n[i]):t[i]=n[i]},t}()}).call(this,n("f3b9")["default"])},a637:function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("af34")),a=i(n("3b2d")),s=n("11ca"),u=s.cloudCall,c={data:function(){return{title:"",content:"",imageList:[],maxImageCount:9,publishMode:"normal",isOriginal:!1,showPoemSubmenu:!1,canPublish:!1,selectedTags:[],customTag:"",showTagSelector:!1,currentCategoryIndex:0,allExistingTags:[],matchedTags:[],showMatchedTags:!1,isPublished:!1,isTemporaryHide:!1,author:"",keyboardHeight:0,tagCategories:[{name:"\u5185\u5bb9\u4e3b\u9898",icon:"\ud83d\udcdd",tags:["\u7231\u60c5","\u4eb2\u60c5","\u53cb\u60c5","\u4e61\u6101","\u601d\u5ff5","\u5b64\u72ec","\u548f\u7269","\u5c71\u6c34","\u7530\u56ed","\u5b63\u8282","\u6625\u5929","\u590f\u65e5","\u79cb\u98ce","\u51ac\u96ea","\u4eba\u751f","\u7406\u60f3","\u54f2\u7406","\u65f6\u95f4","\u9752\u6625","\u6210\u957f","\u751f\u6b7b","\u6000\u53e4","\u548f\u53f2","\u8fb9\u585e","\u6218\u4e89","\u7231\u56fd","\u57ce\u5e02","\u4e61\u6751","\u751f\u6d3b","\u65c5\u884c","\u996e\u98df","\u52b3\u52a8"]},{name:"\u60c5\u611f\u57fa\u8c03",icon:"\ud83d\udcad",tags:["\u6cbb\u6108","\u6e29\u6696","\u6d6a\u6f2b","\u552f\u7f8e","\u60b2\u4f24","\u4f24\u611f","\u60c6\u6005","\u5bc2\u5bde","\u8c6a\u653e","\u8c41\u8fbe","\u6fc0\u6602","\u70ed\u8840","\u5a49\u7ea6","\u7ec6\u817b","\u6e05\u65b0","\u5b81\u9759","\u52b1\u5fd7","\u9f13\u821e","\u575a\u5b9a","\u5145\u6ee1\u5e0c\u671b","\u8bbd\u523a","\u6279\u5224","\u6df1\u6c89","\u5f15\u4eba\u6df1\u601d"]},{name:"\u5f62\u5f0f\u4f53\u88c1",icon:"\ud83d\udcd6",tags:["\u53e4\u4f53\u8bd7","\u8fd1\u4f53\u8bd7","\u4e94\u8a00","\u4e03\u8a00","\u7edd\u53e5","\u5f8b\u8bd7","\u8bcd","\u66f2","\u4e50\u5e9c","\u9a9a\u4f53","\u73b0\u4ee3\u8bd7","\u81ea\u7531\u8bd7","\u6563\u6587\u8bd7","\u5341\u56db\u884c\u8bd7","\u53d9\u4e8b\u8bd7","\u4ff3\u53e5","\u77ed\u6b4c","\u53f2\u8bd7","\u957f\u8bd7","\u77ed\u8bd7","\u5fae\u578b\u8bd7","\u4e09\u884c\u8bd7"]},{name:"\u610f\u8c61\u5143\u7d20",icon:"\ud83c\udf19",tags:["\u6708\u4eae","\u661f\u661f","\u592a\u9633","\u5b87\u5b99","\u94f6\u6cb3","\u98ce","\u96e8","\u96ea","\u4e91","\u96fe","\u6cb3\u6d41","\u5927\u6d77","\u5c71\u5cf0","\u68ee\u6797","\u82b1","\u8349","\u6811","\u9ea6\u7530","\u843d\u53f6","\u6885","\u5170","\u7af9","\u83ca","\u9e1f","\u9a6c","\u8749","\u9c7c","\u8774\u8776","\u9152","\u5251","\u7434","\u706f","\u8239","\u955c\u5b50","\u7ea2\u8272","\u767d\u8272","\u84dd\u8272","\u91d1\u8272"]},{name:"\u98ce\u683c\u6d41\u6d3e",icon:"\ud83c\udfad",tags:["\u5510\u8bd7","\u5b8b\u8bcd","\u5143\u66f2","\u5148\u79e6","\u4e24\u6c49","\u9b4f\u664b","\u5efa\u5b89\u98ce\u9aa8","\u6726\u80e7\u8bd7","\u65b0\u6708\u6d3e","\u6d6a\u6f2b\u4e3b\u4e49","\u73b0\u5b9e\u4e3b\u4e49","\u8c61\u5f81\u4e3b\u4e49","\u73b0\u4ee3\u4e3b\u4e49","\u610f\u8c61\u6d3e","\u57ae\u6389\u7684\u4e00\u4ee3","\u4e2d\u6587\u8bd7","\u82f1\u6587\u8bd7","\u65e5\u6587\u8bd7","\u6cd5\u6587\u8bd7","\u7ffb\u8bd1\u8bd7","\u4e2d\u56fd","\u82f1\u56fd","\u7f8e\u56fd","\u65e5\u672c","\u4fc4\u7f57\u65af"]},{name:"\u573a\u666f\u7528\u9014",icon:"\ud83c\udfaf",tags:["\u665a\u5b89\u8bd7","\u65e9\u5b89\u95ee\u5019","\u8282\u65e5\u795d\u798f","\u6625\u8282","\u4e2d\u79cb","\u60c5\u4eba\u8282","\u6bd5\u4e1a\u5b63","\u5a5a\u793c\u81f4\u8f9e","\u65c5\u884c\u9014\u4e2d","\u96e8\u5929\u8bfb\u8bd7","\u5199\u7ed9\u5b69\u5b50","\u81f4\u656c\u6bcd\u4eb2","\u9001\u7ed9\u670b\u53cb","\u9002\u5408\u6458\u6284","\u53ef\u4ee5\u7528\u4f5c\u7b7e\u540d"]}],tags:[]}},onLoad:function(e){this.loadAllExistingTags(),"edit"===e.mode?this.loadEditingDraft():this.loadDraft(),this.preventPageScroll()},onShow:function(){this.preventPageScroll()},onUnload:function(){this.isPublished||this.checkAndSaveDraft()},onHide:function(){this.isPublished||this.isTemporaryHide||this.checkAndSaveDraft(),this.setData({isTemporaryHide:!1})},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u(e,t,Object.assign({pageTag:"add",context:this,requireAuth:!0},n))},uploadFile:function(t,r){var i=this;return new Promise((function(o,a){var s=n("fd09"),u=s.getCurrentPlatform,c=s.getCloudFunctionMethod,l=(u(),c());"tcb"===l?i.uploadFileViaCloudFunction(t,r).then(o).catch(a):"wx-cloud"===l?e.cloud&&e.cloud.uploadFile?e.cloud.uploadFile({cloudPath:t,filePath:r,success:function(e){o(e)},fail:function(e){a(e)}}):a(new Error("\u5fae\u4fe1\u4e91\u5f00\u53d1\u4e0d\u53ef\u7528")):a(new Error("\u4e0d\u652f\u6301\u7684\u4e91\u51fd\u6570\u8c03\u7528\u65b9\u5f0f: ".concat(l)))}))},uploadFileViaCloudFunction:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((function(o,a){if("undefined"!==typeof window&&"undefined"!==typeof FileReader)fetch(t).then((function(e){if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return e.blob()})).then((function(s){var u=new FileReader;u.onload=function(){var s=u.result;if(!s||"string"!==typeof s)return r("error","\u274c [Add\u9875\u9762] FileReader\u7ed3\u679c\u65e0\u6548:",s," at pages/add/add.vue:511"),void a(new Error("\u6587\u4ef6\u8bfb\u53d6\u5931\u8d25"));var c=s.split(",")[1];r("log","\ud83d\udd0d [Add\u9875\u9762] \u6587\u4ef6\u8f6c\u6362\u4e3abase64\u5b8c\u6210\uff0c\u957f\u5ea6: ".concat(c.length)," at pages/add/add.vue:516"),c.length>6291456&&r("warn","\u26a0\ufe0f [Add\u9875\u9762] base64\u6587\u4ef6\u8fc7\u5927\uff0c\u5c1d\u8bd5\u8fdb\u4e00\u6b65\u538b\u7f29"," at pages/add/add.vue:519"),n.callCloudFunction("upload",{cloudPath:e,fileContent:c}).then((function(e){r("log","\u4e0a\u4f20\u4e91\u51fd\u6570\u8fd4\u56de\u7ed3\u679c:",e," at pages/add/add.vue:527"),e&&e.result&&e.result.success?o({fileID:e.result.fileID,cloudPath:e.result.cloudPath}):a(new Error("\u4e0a\u4f20\u4e91\u51fd\u6570\u8fd4\u56de\u683c\u5f0f\u9519\u8bef"))})).catch((function(s){var u;i<2&&("request:fail"===s.errMsg||null!==(u=s.message)&&void 0!==u&&u.includes("fail"))?(r("log","\ud83d\udd04 [Add\u9875\u9762] \u4e0a\u4f20\u5931\u8d25\uff0c\u51c6\u5907\u91cd\u8bd5 (".concat(i+1,"/2)")," at pages/add/add.vue:540"),setTimeout((function(){n.uploadFileViaCloudFunction(e,t,i+1).then(o).catch(a)}),1e3*(i+1))):a(s)}))},u.onerror=function(){r("error","\u274c [Add\u9875\u9762] FileReader\u8bfb\u53d6\u5931\u8d25"," at pages/add/add.vue:551"),a(new Error("\u6587\u4ef6\u8bfb\u53d6\u5931\u8d25"))},u.readAsDataURL(s)})).catch((function(e){r("error","\u274c [Add\u9875\u9762] \u83b7\u53d6\u6587\u4ef6blob\u5931\u8d25:",e," at pages/add/add.vue:557"),a(new Error("\u83b7\u53d6\u6587\u4ef6\u5931\u8d25: "+e.message))}));else{r("log","\ud83d\udd0d [Add\u9875\u9762] App\u73af\u5883\u4f7f\u7528uni-app API\u8bfb\u53d6\u6587\u4ef6"," at pages/add/add.vue:562");try{var s=uni.getFileSystemManager();s&&s.readFile?s.readFile({filePath:t,encoding:"base64",success:function(t){var i=t.data;r("log","\ud83d\udd0d [Add\u9875\u9762] \u6587\u4ef6\u8bfb\u53d6\u5b8c\u6210\uff0cbase64\u957f\u5ea6: ".concat(i.length)," at pages/add/add.vue:571"),n.callCloudFunction("upload",{cloudPath:e,fileContent:i}).then((function(e){r("log","App\u73af\u5883\u4e0a\u4f20\u4e91\u51fd\u6570\u8fd4\u56de\u7ed3\u679c:",e," at pages/add/add.vue:576"),e&&e.result&&e.result.success?o({fileID:e.result.fileID,cloudPath:e.result.cloudPath}):a(new Error("\u4e0a\u4f20\u4e91\u51fd\u6570\u8fd4\u56de\u683c\u5f0f\u9519\u8bef"))})).catch(a)},fail:function(e){r("error","\u274c [Add\u9875\u9762] \u6587\u4ef6\u8bfb\u53d6\u5931\u8d25\uff1a",e," at pages/add/add.vue:589"),a(new Error("\u6587\u4ef6\u8bfb\u53d6\u5931\u8d25: ".concat(e.errMsg||"\u672a\u77e5\u9519\u8bef")))}}):(r("error","\u274c [Add\u9875\u9762] getFileSystemManager\u4e0d\u53ef\u7528"," at pages/add/add.vue:594"),a(new Error("\u6587\u4ef6\u7cfb\u7edfAPI\u4e0d\u53ef\u7528")))}catch(u){r("error","\u274c [Add\u9875\u9762] \u6587\u4ef6\u7cfb\u7edfAPI\u8c03\u7528\u5931\u8d25:",u," at pages/add/add.vue:598"),a(new Error("\u6587\u4ef6\u7cfb\u7edfAPI\u4e0d\u53ef\u7528"))}}}))},preventPageScroll:function(){try{uni.pageScrollTo({scrollTop:0,duration:0})}catch(e){r("log","CatchClause",e," at pages/add/add.vue:613"),r("log","CatchClause",e," at pages/add/add.vue:614"),r("log","preventPageScroll error:",e," at pages/add/add.vue:615")}},onTitleInput:function(e){this.setData({title:e.detail.value}),this.checkCanPublish()},onContentInput:function(e){var t=e.detail,n=t.value;t.cursor;this.setData({content:n}),this.checkCanPublish()},onContainerTap:function(e){r("log","\u5bb9\u5668\u88ab\u70b9\u51fb\uff0c\u51c6\u5907\u9690\u85cf\u952e\u76d8"," at pages/add/add.vue:636"),setTimeout((function(){uni.hideKeyboard()}),100)},onTextareaTap:function(e){r("log","textarea\u88ab\u70b9\u51fb\uff0c\u5e94\u8be5\u83b7\u53d6\u7126\u70b9"," at pages/add/add.vue:644")},onTextareaFocus:function(e){r("log","textarea\u83b7\u5f97\u7126\u70b9\uff0c\u952e\u76d8\u9ad8\u5ea6:",e.detail.height," at pages/add/add.vue:649");var t=e.detail.height;if(!t||0===t){var n=uni.getSystemInfoSync();r("log","\u7cfb\u7edf\u4fe1\u606f:",n," at pages/add/add.vue:657"),t=Math.min(.4*n.windowHeight,300),r("log","\u4f7f\u7528\u9ed8\u8ba4\u952e\u76d8\u9ad8\u5ea6:",t," at pages/add/add.vue:660")}this.setData({keyboardHeight:t})},onTextareaBlur:function(){r("log","textarea\u5931\u53bb\u7126\u70b9"," at pages/add/add.vue:669"),this.setData({keyboardHeight:0})},onAuthorInput:function(e){this.setData({author:e.detail.value}),this.checkCanPublish()},checkCanPublish:function(){var e=this.imageList.length>0,t=this.title&&this.title.trim(),n=this.content&&this.content.trim(),r=e||t&&n;if("poem"===this.publishMode&&!this.isOriginal){var i=this.author&&this.author.trim();r=r&&i}this.setData({canPublish:r})},switchMode:function(){"normal"===this.publishMode?this.showPoemSubmenu?this.setData({showPoemSubmenu:!1}):this.setData({showPoemSubmenu:!0,showTagSelector:!1}):(this.setData({publishMode:"normal",isOriginal:!1,showPoemSubmenu:!1,maxImageCount:9}),this.checkCanPublish())},selectPoemMode:function(e){var t="true"===e.currentTarget.dataset.original;this.setData({publishMode:"poem",isOriginal:t,showPoemSubmenu:!1,imageList:this.imageList.length>1?[]:this.imageList,maxImageCount:1}),this.checkCanPublish()},handleChooseImage:function(){var e=this,t=this,n=this.maxImageCount-this.imageList.length;n<=0?uni.showToast({title:"\u6700\u591a\u53ea\u80fd\u4e0a\u4f209\u5f20\u56fe\u7247",icon:"none"}):(this.setData({isTemporaryHide:!0}),uni.chooseImage({count:n,sizeType:["original"],sourceType:["album","camera"],success:function(e){uni.showLoading({title:"\u5904\u7406\u4e2d..."}),r("log","wx.chooseImage \u8fd4\u56de\u7684\u8be6\u7ec6\u6587\u4ef6\u4fe1\u606f:",e.tempFiles," at pages/add/add.vue:767");var n=e.tempFiles.map((function(e){var n=e.path,i=e.size;if(r("log","\u83b7\u53d6\u5230\u56fe\u7247 ".concat(n," \u7684\u539f\u59cb\u5927\u5c0f:"),(i/1024).toFixed(2),"KB"," at pages/add/add.vue:772"),i>5242880)throw new Error("\u56fe\u7247\u6587\u4ef6\u8fc7\u5927 (".concat((i/1024/1024).toFixed(2),"MB)\uff0c\u8bf7\u9009\u62e9\u5c0f\u4e8e5MB\u7684\u56fe\u7247"));var o=i>2e5,a={originalPath:n,imageSize:i,needCompression:o,previewUrl:n,compressedPath:n,originalUrl:"",compressedUrl:""};return o?t.compressImage(a):Promise.resolve(a)}));Promise.all(n).then((function(e){uni.hideLoading(),t.updateImageList(e),t.checkCanPublish()})).catch((function(e){uni.hideLoading(),r("error","\u56fe\u7247\u5904\u7406\u5931\u8d25:",e," at pages/add/add.vue:805");var t="\u56fe\u7247\u5904\u7406\u5931\u8d25";e.message&&e.message.includes("\u56fe\u7247\u6587\u4ef6\u8fc7\u5927")?t=e.message:e.message&&(t="\u56fe\u7247\u5904\u7406\u5931\u8d25: ".concat(e.message)),uni.showModal({title:"\u9519\u8bef",content:t,showCancel:!1,confirmText:"\u786e\u5b9a"})}))},fail:function(t){r("log","\u9009\u62e9\u56fe\u7247\u53d6\u6d88\u6216\u5931\u8d25:",t," at pages/add/add.vue:824"),e.setData({isTemporaryHide:!1})}}))},compressImage:function(e){var t=this;return new Promise((function(i){var o=n("fd09"),a=o.getCurrentPlatform,s=a();"h5"===s?(r("log","\ud83d\udd0d [Add\u9875\u9762] H5\u73af\u5883\u4f7f\u7528Canvas\u538b\u7f29\u56fe\u7247"," at pages/add/add.vue:841"),t.compressImageWithCanvas(e).then(i).catch((function(){r("log","Canvas\u538b\u7f29\u5931\u8d25\uff0c\u4f7f\u7528\u539f\u56fe"," at pages/add/add.vue:844"),e.compressedPath=e.originalPath,e.previewUrl=e.originalPath,i(e)}))):(r("log","\ud83d\udd0d [Add\u9875\u9762] \u5c0f\u7a0b\u5e8f/App\u73af\u5883\u4f7f\u7528uni.compressImage"," at pages/add/add.vue:851"),uni.compressImage({src:e.originalPath,quality:80,success:function(t){e.compressedPath=t.tempFilePath,e.previewUrl=t.tempFilePath,i(e)},fail:function(t){r("log","\u538b\u7f29\u5931\u8d25\uff0c\u4f7f\u7528\u539f\u56fe:",t," at pages/add/add.vue:862"),e.compressedPath=e.originalPath,e.previewUrl=e.originalPath,i(e)}}))}))},compressImageWithCanvas:function(e){return new Promise((function(t,n){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){try{var o=document.createElement("canvas"),a=o.getContext("2d"),s=i.width,u=i.height;s>u?s>1200&&(u=1200*u/s,s=1200):u>1200&&(s=1200*s/u,u=1200),o.width=s,o.height=u,a.drawImage(i,0,0,s,u),o.toBlob((function(i){if(i){var o=URL.createObjectURL(i);e.compressedPath=o,e.previewUrl=o,r("log","\u2705 [Add\u9875\u9762] Canvas\u538b\u7f29\u6210\u529f\uff0c\u65b0\u5c3a\u5bf8:",s,"x",u," at pages/add/add.vue:913"),t(e)}else n(new Error("Canvas\u538b\u7f29\u5931\u8d25"))}),"image/jpeg",.6)}catch(c){r("error","Canvas\u538b\u7f29\u8fc7\u7a0b\u51fa\u9519:",c," at pages/add/add.vue:921"),n(c)}},i.onerror=function(){n(new Error("\u56fe\u7247\u52a0\u8f7d\u5931\u8d25"))},i.src=e.originalPath}))},updateImageList:function(e){var t=this.imageList,n=t.concat(e);this.setData({imageList:n})},removeImage:function(e){var t=e.currentTarget.dataset.index,n=this.imageList;n.splice(t,1),this.setData({imageList:n}),this.checkCanPublish()},submitPost:function(){if(this.canPublish){var e=this.title&&this.title.trim(),t=this.content&&this.content.trim();if(!e||t){if("poem"===this.publishMode&&!this.isOriginal){var n=this.author&&this.author.trim();if(!n)return void uni.showToast({title:"\u975e\u539f\u521b\u8bd7\u6b4c\u5fc5\u987b\u586b\u5199\u4f5c\u8005",icon:"none"})}r("log","\u63d0\u4ea4\u5e16\u5b50:",{imageList:this.imageList,title:this.title,content:this.content}," at pages/add/add.vue:981"),"poem"!==this.publishMode||this.isOriginal?(uni.showLoading({title:"\u53d1\u5e03\u4e2d..."}),this.imageList.length>0?this.uploadImagesAndSubmit():this.submitTextOnly()):this.checkDuplicatePoem()}else uni.showToast({title:"\u8bf7\u8f93\u5165\u6b63\u6587\u5185\u5bb9",icon:"none"})}else uni.showToast({title:"\u8bf7\u81f3\u5c11\u4e0a\u4f20\u56fe\u7247\u6216\u8f93\u5165\u5185\u5bb9",icon:"none"})},checkDuplicatePoem:function(){var e=this;uni.showLoading({title:"\u68c0\u67e5\u4e2d..."}),this.callCloudFunction("checkDuplicatePoem",{title:this.title.trim(),author:this.author.trim(),isOriginal:this.isOriginal}).then((function(t){uni.hideLoading(),r("log","\u91cd\u590d\u68c0\u67e5\u7ed3\u679c:",t.result," at pages/add/add.vue:1014"),t.result.success?t.result.isDuplicate?e.showDuplicateConfirmDialog(t.result.duplicateCount):e.proceedWithPublish():uni.showToast({title:"\u68c0\u67e5\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none"})})).catch((function(e){uni.hideLoading(),r("error","\u68c0\u67e5\u91cd\u590d\u5931\u8d25:",e," at pages/add/add.vue:1031"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5",icon:"none"})}))},showDuplicateConfirmDialog:function(e){var t=this;uni.showModal({title:"\u53d1\u73b0\u91cd\u590d\u8bd7\u6b4c",content:"\u5df2\u6709 ".concat(e," \u7bc7\u76f8\u540c\u7684\u8bd7\u6b4c\u53d1\u5e03\uff0c\u662f\u5426\u7ee7\u7eed\u53d1\u5e03\uff1f"),confirmText:"\u7ee7\u7eed\u53d1\u5e03",cancelText:"\u53d6\u6d88\u53d1\u5e03",success:function(e){e.confirm?t.proceedWithPublish():r("log","\u7528\u6237\u53d6\u6d88\u53d1\u5e03\u91cd\u590d\u8bd7\u6b4c"," at pages/add/add.vue:1052")}})},proceedWithPublish:function(){uni.showLoading({title:"\u53d1\u5e03\u4e2d..."}),this.imageList.length>0?this.uploadImagesAndSubmit():this.submitTextOnly()},uploadImagesAndSubmit:function(){var e=this,t=(new Date).getTime(),n=this.imageList;r("log","\u5f00\u59cb\u4e0a\u4f20\u56fe\u7247:",n.length+"\u5f20"," at pages/add/add.vue:1074");var i=n.map((function(n,i){return new Promise((function(o,s){var u=t+i,c="post_images/".concat(u,"_compressed.jpg");e.uploadFile(c,n.compressedPath).then((function(t){r("log","\u538b\u7f29\u56fe\u4e0a\u4f20\u6210\u529f:",t," at pages/add/add.vue:1083"),r("log","\u538b\u7f29\u56fefileID:",t.fileID," at pages/add/add.vue:1084"),r("log","\u538b\u7f29\u56fefileID\u7c7b\u578b:",(0,a.default)(t.fileID)," at pages/add/add.vue:1085");var i=t.fileID;if(n.needCompression){var s="post_images/".concat(u,"_original.jpg");return e.uploadFile(s,n.originalPath).then((function(e){r("log","\u539f\u56fe\u4e0a\u4f20\u6210\u529f:",e," at pages/add/add.vue:1091"),r("log","\u539f\u56fefileID:",e.fileID," at pages/add/add.vue:1092"),r("log","\u539f\u56fefileID\u7c7b\u578b:",(0,a.default)(e.fileID)," at pages/add/add.vue:1093"),o({compressedUrl:i,originalUrl:e.fileID})}))}o({compressedUrl:i,originalUrl:i})})).catch(s)}))}));Promise.all(i).then((function(t){return r("log","\u6240\u6709\u56fe\u7247\u4e0a\u4f20\u5b8c\u6210:",t," at pages/add/add.vue:1111"),e.submitWithContentCheck(t)})).catch((function(t){r("error","\u4e0a\u4f20\u5931\u8d25:",t," at pages/add/add.vue:1115"),e.publishFail(t)}))},submitToDatabase:function(e){var t=this;r("log","\u63d0\u4ea4\u5230\u6570\u636e\u5e93:",{uploadResults:e,title:this.title,content:this.content,publishMode:this.publishMode,isOriginal:this.isOriginal}," at pages/add/add.vue:1121"),r("log","uploadResults\u8be6\u7ec6\u4fe1\u606f:",e," at pages/add/add.vue:1128"),r("log","uploadResults\u957f\u5ea6:",e.length," at pages/add/add.vue:1129");var n=e.map((function(e){return e.compressedUrl})),i=e.map((function(e){return e.originalUrl}));r("log","\u5904\u7406\u540e\u7684\u56fe\u7247URLs:",{imageUrls:n,originalImageUrls:i,imageUrlsType:n.map((function(e){return(0,a.default)(e)})),originalImageUrlsType:i.map((function(e){return(0,a.default)(e)})),imageUrlsValues:n.map((function(e){return e?e.substring(0,50)+"...":"null/undefined"}))}," at pages/add/add.vue:1134");var o="";if("poem"===this.publishMode)if(this.isOriginal){var s=uni.getStorageSync("userInfo"),u=s?s.nickName:"\u533f\u540d\u7528\u6237";o=this.author&&this.author.trim()?this.author.trim():u}else o=this.author&&this.author.trim()?this.author.trim():"";var c={title:this.title,content:this.content,createTime:new Date,votes:0,isPoem:"poem"===this.publishMode,isOriginal:this.isOriginal,author:o,tags:this.selectedTags||[]};n.length>0&&(c.imageUrl=n[0],c.imageUrls=n,c.originalImageUrl=i[0],c.originalImageUrls=i,"poem"===this.publishMode&&n.length>0&&(c.poemBgImage=n[0]));var l=n.filter((function(e){return e})),d=i.filter((function(e){return e}));r("log","\u4f20\u9012\u7ed9\u4e91\u51fd\u6570\u7684\u53c2\u6570:",{fileIDs:l,originalFileIDs:d,fileIDsLength:l.length,originalFileIDsLength:d.length}," at pages/add/add.vue:1187");var f={title:this.title,content:this.content,fileIDs:l,originalFileIDs:d,publishMode:this.publishMode,isOriginal:this.isOriginal,author:this.author,tags:this.selectedTags||[]};return this.callCloudFunction("contentCheck",f).then((function(e){var n;(r("log","\u6570\u636e\u5e93\u63d0\u4ea4\u6210\u529f:",e," at pages/add/add.vue:1206"),e&&e.result&&0===e.result.code)?t.publishSuccess({_id:e.result.postId}):(r("error","\u4e91\u51fd\u6570\u8fd4\u56de\u5931\u8d25:",e," at pages/add/add.vue:1215"),t.publishFail(new Error((null===(n=e.result)||void 0===n?void 0:n.msg)||"\u4e91\u51fd\u6570\u8fd4\u56de\u5931\u8d25")))})).catch((function(e){r("error","\u6570\u636e\u5e93\u63d0\u4ea4\u5931\u8d25:",e," at pages/add/add.vue:1219"),t.publishFail(e)}))},submitTextOnly:function(){this.submitWithContentCheck([])},submitWithContentCheck:function(e){return r("log","\u5f00\u59cb\u5185\u5bb9\u5ba1\u6838\u548c\u63d0\u4ea4:",{uploadResults:e,title:this.title,content:this.content,publishMode:this.publishMode,isOriginal:this.isOriginal,author:this.author,tags:this.selectedTags}," at pages/add/add.vue:1231"),r("log","\u26a0\ufe0f \u5185\u5bb9\u5ba1\u6838\u5df2\u6682\u65f6\u5173\u95ed\uff0c\u76f4\u63a5\u53d1\u5e03\u5185\u5bb9"," at pages/add/add.vue:1243"),this.submitToDatabase(e)},publishSuccess:function(e){uni.hideLoading(),uni.showToast({title:"\u53d1\u5e03\u6210\u529f\uff01"});try{uni.setStorageSync("shouldRefreshIndex",!0),uni.setStorageSync("shouldRefreshProfile",!0),uni.setStorageSync("shouldRefreshPoem",!0),uni.setStorageSync("shouldRefreshMountain",!0)}catch(t){r("log","CatchClause",t," at pages/add/add.vue:1300"),r("log","CatchClause",t," at pages/add/add.vue:1301")}this.setData({isPublished:!0}),this.clearDraft(),uni.navigateBack({delta:1})},publishFail:function(e){uni.hideLoading(),r("error","[\u53d1\u5e03\u6d41\u7a0b] \u5931\u8d25\uff1a",e," at pages/add/add.vue:1316");var t="\u53d1\u5e03\u5931\u8d25";e&&e.message?t="\u53d1\u5e03\u5931\u8d25: ".concat(e.message):e&&e.errMsg&&(t="\u53d1\u5e03\u5931\u8d25: ".concat(e.errMsg)),uni.showModal({title:"\u53d1\u5e03\u5931\u8d25",content:t,showCancel:!1,confirmText:"\u786e\u5b9a"})},onImageError:function(e){uni.showToast({title:"\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",icon:"none"}),r("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",e," at pages/add/add.vue:1340")},toggleTagSelector:function(){this.setData({showTagSelector:!this.showTagSelector})},selectTag:function(e){var t=e.currentTarget.dataset.tag,n=this.selectedTags;if(n.includes(t)){var r=n.indexOf(t);n.splice(r,1)}else{if(!(n.length<5))return void uni.showToast({title:"\u6700\u591a\u9009\u62e95\u4e2a\u6807\u7b7e",icon:"none"});n.push(t)}this.setData({selectedTags:n})},onCustomTagInput:function(e){var t=this,n=e.detail.value;r("log","\u3010\u6807\u7b7e\u8f93\u5165\u3011\u7528\u6237\u8f93\u5165:",n," at pages/add/add.vue:1376"),this.setData({customTag:n}),this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout((function(){r("log","\u3010\u6807\u7b7e\u641c\u7d22\u3011\u5f00\u59cb\u641c\u7d22\u5339\u914d\u6807\u7b7e:",n," at pages/add/add.vue:1386"),t.searchMatchingTags(n)}),300)},addCustomTag:function(){var e=this.customTag.trim();if(e)if(this.selectedTags.includes(e))uni.showToast({title:"\u6807\u7b7e\u5df2\u5b58\u5728",icon:"none"});else if(this.selectedTags.length>=5)uni.showToast({title:"\u6700\u591a\u9009\u62e95\u4e2a\u6807\u7b7e",icon:"none"});else{var t=[].concat((0,o.default)(this.selectedTags),[e]);this.setData({selectedTags:t,customTag:""})}else uni.showToast({title:"\u8bf7\u8f93\u5165\u6807\u7b7e",icon:"none"})},removeTag:function(e){var t=e.currentTarget.dataset.tag,n=this.selectedTags.filter((function(e){return e!==t}));this.setData({selectedTags:n})},switchCategory:function(e){var t=e.currentTarget.dataset.index;this.setData({currentCategoryIndex:t})},getCurrentCategoryTags:function(){return this.tagCategories[this.currentCategoryIndex].tags},loadAllExistingTags:function(){var e=this;r("log","\u3010\u6807\u7b7e\u52a0\u8f7d\u3011\u5f00\u59cb\u52a0\u8f7d\u6240\u6709\u5df2\u6709\u6807\u7b7e..."," at pages/add/add.vue:1444"),this.callCloudFunction("getAllTags",{}).then((function(t){r("log","\u3010\u6807\u7b7e\u52a0\u8f7d\u3011\u4e91\u51fd\u6570\u8fd4\u56de\u7ed3\u679c:",t," at pages/add/add.vue:1446"),t.result&&t.result.success?(e.setData({allExistingTags:t.result.tags}),r("log","\u3010\u6807\u7b7e\u52a0\u8f7d\u3011\u5df2\u52a0\u8f7d\u6240\u6709\u6807\u7b7e:",t.result.tags.length,"\u4e2a\u6807\u7b7e:",t.result.tags," at pages/add/add.vue:1451")):r("error","\u3010\u6807\u7b7e\u52a0\u8f7d\u3011\u4e91\u51fd\u6570\u8fd4\u56de\u5931\u8d25:",t.result," at pages/add/add.vue:1453")})).catch((function(e){r("error","\u3010\u6807\u7b7e\u52a0\u8f7d\u3011\u83b7\u53d6\u6807\u7b7e\u5931\u8d25:",e," at pages/add/add.vue:1456")}))},searchMatchingTags:function(e){var t=this;if(r("log","\u3010\u6807\u7b7e\u641c\u7d22\u3011\u641c\u7d22\u53c2\u6570:",{inputValue:e,inputLength:e?e.length:0,allExistingTags:this.allExistingTags,selectedTags:this.selectedTags}," at pages/add/add.vue:1462"),!e||e.length<2)return r("log","\u3010\u6807\u7b7e\u641c\u7d22\u3011\u8f93\u5165\u957f\u5ea6\u4e0d\u8db3\uff0c\u6e05\u7a7a\u5339\u914d\u7ed3\u679c"," at pages/add/add.vue:1469"),void this.setData({matchedTags:[],showMatchedTags:!1});var n=this.allExistingTags;r("log","\u3010\u6807\u7b7e\u641c\u7d22\u3011\u5f00\u59cb\u5339\u914d\uff0c\u603b\u6807\u7b7e\u6570:",n.length," at pages/add/add.vue:1477");var i=n.filter((function(n){var i=n.toLowerCase().includes(e.toLowerCase()),o=!t.selectedTags.includes(n);return r("log",'\u3010\u6807\u7b7e\u641c\u7d22\u3011\u68c0\u67e5\u6807\u7b7e"'.concat(n,'": \u5339\u914d=').concat(i,", \u672a\u9009\u4e2d=").concat(o)," at pages/add/add.vue:1482"),i&&o})).slice(0,5);r("log","\u3010\u6807\u7b7e\u641c\u7d22\u3011\u5339\u914d\u7ed3\u679c:",i," at pages/add/add.vue:1487"),this.setData({matchedTags:i,showMatchedTags:i.length>0}),r("log","\u3010\u6807\u7b7e\u641c\u7d22\u3011\u8bbe\u7f6e\u72b6\u6001:",{matchedTags:i,showMatchedTags:i.length>0}," at pages/add/add.vue:1492")},selectMatchedTag:function(e){var t=e.currentTarget.dataset.tag;if(this.selectedTags.includes(t))uni.showToast({title:"\u6807\u7b7e\u5df2\u5b58\u5728",icon:"none"});else if(this.selectedTags.length>=5)uni.showToast({title:"\u6700\u591a\u9009\u62e95\u4e2a\u6807\u7b7e",icon:"none"});else{var n=[].concat((0,o.default)(this.selectedTags),[t]);this.setData({selectedTags:n,customTag:"",showMatchedTags:!1,matchedTags:[]})}},hasContent:function(){var e=this.title&&this.title.trim(),t=this.content&&this.content.trim(),n=this.imageList.length>0,r=this.selectedTags.length>0;return e||t||n||r},checkAndSaveDraft:function(){var e=this;this.hasContent()&&uni.showModal({title:"\u4fdd\u5b58\u8349\u7a3f",content:"\u68c0\u6d4b\u5230\u60a8\u6709\u672a\u5b8c\u6210\u7684\u5185\u5bb9\uff0c\u662f\u5426\u4fdd\u5b58\u4e3a\u8349\u7a3f\uff1f",confirmText:"\u4fdd\u5b58",cancelText:"\u4e0d\u4fdd\u5b58",success:function(t){t.confirm?e.saveDraft():e.clearDraft()}})},saveDraft:function(){var e=this,t={title:this.title,content:this.content,imageList:this.imageList,publishMode:this.publishMode,isOriginal:this.isOriginal,selectedTags:this.selectedTags,customTag:this.customTag,author:this.author,saveTime:new Date};uni.showLoading({title:"\u4fdd\u5b58\u4e2d..."}),this.callCloudFunction("getMyProfileData",{action:"saveDraft",draftData:t}).then((function(t){var n;(uni.hideLoading(),t.result&&t.result.success)?(uni.showToast({title:"\u8349\u7a3f\u5df2\u4fdd\u5b58",icon:"success"}),e.clearDraft()):(r("error","\u4fdd\u5b58\u8349\u7a3f\u5931\u8d25:",t.result," at pages/add/add.vue:1581"),uni.showToast({title:(null===(n=t.result)||void 0===n?void 0:n.message)||"\u4fdd\u5b58\u8349\u7a3f\u5931\u8d25",icon:"none"}))})).catch((function(e){uni.hideLoading(),r("error","\u4fdd\u5b58\u8349\u7a3f\u5931\u8d25:",e," at pages/add/add.vue:1589"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef\uff0c\u4fdd\u5b58\u5931\u8d25",icon:"none"})}))},loadDraft:function(){var e=this;try{var t=uni.getStorageSync("publish_draft");if(t&&t.saveTime){var n=(new Date).getTime(),i=n-t.saveTime;i<6048e5?uni.showModal({title:"\u6062\u590d\u8349\u7a3f",content:"\u68c0\u6d4b\u5230\u60a8\u6709\u672a\u5b8c\u6210\u7684\u8349\u7a3f\uff0c\u662f\u5426\u6062\u590d\uff1f",confirmText:"\u6062\u590d",cancelText:"\u91cd\u65b0\u5f00\u59cb",success:function(n){n.confirm?(e.setData({title:t.title||"",content:t.content||"",imageList:t.imageList||[],publishMode:t.publishMode||"normal",isOriginal:t.isOriginal||!1,selectedTags:t.selectedTags||[],customTag:t.customTag||"",author:t.author||"",maxImageCount:"poem"===t.publishMode?1:9}),e.checkCanPublish(),uni.showToast({title:"\u8349\u7a3f\u5df2\u6062\u590d",icon:"success"})):e.clearDraft()}}):this.clearDraft()}}catch(o){r("log","CatchClause",o," at pages/add/add.vue:1641"),r("log","CatchClause",o," at pages/add/add.vue:1642"),r("error","\u52a0\u8f7d\u8349\u7a3f\u5931\u8d25:",o," at pages/add/add.vue:1643")}},loadEditingDraft:function(){try{var e=uni.getStorageSync("editing_draft");e&&(this.setData({title:e.title||"",content:e.content||"",imageList:e.imageList||[],publishMode:e.publishMode||"normal",isOriginal:e.isOriginal||!1,selectedTags:e.selectedTags||[],customTag:e.customTag||"",author:e.author||"",maxImageCount:"poem"===e.publishMode?1:9}),this.checkCanPublish(),uni.showToast({title:"\u8349\u7a3f\u5df2\u52a0\u8f7d",icon:"success"}),uni.removeStorageSync("editing_draft"))}catch(t){r("log","CatchClause",t," at pages/add/add.vue:1672"),r("log","CatchClause",t," at pages/add/add.vue:1673"),r("error","\u52a0\u8f7d\u7f16\u8f91\u8349\u7a3f\u5931\u8d25:",t," at pages/add/add.vue:1674"),uni.showToast({title:"\u52a0\u8f7d\u8349\u7a3f\u5931\u8d25",icon:"none"})}},clearDraft:function(){try{uni.removeStorageSync("publish_draft")}catch(e){r("log","CatchClause",e," at pages/add/add.vue:1687"),r("log","CatchClause",e," at pages/add/add.vue:1688"),r("error","\u6e05\u9664\u8349\u7a3f\u5931\u8d25:",e," at pages/add/add.vue:1689")}}}};t.default=c}).call(this,n("ed83")["default"],n("f3b9")["default"])},a671:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.registerCloudrun=function(t){try{t.registerComponent(d)}catch(n){e("warn",n," at node_modules/@cloudbase/cloudrun/dist/esm/index.js:130")}},t.requestContainer=c;var r=n("5c02"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=r.constants.ERRORS,u=function(){function e(){}return e.prototype.callContainer=function(e,t){return o(this,void 0,void 0,(function(){var n,r,o;return a(this,(function(a){switch(a.label){case 0:if(n=e.name,r=e.data,!n)throw new Error(JSON.stringify({code:s.INVALID_PARAMS,msg:"[".concat("cloudrun",".callContainer] invalid name")}));try{o=r?JSON.stringify(r):""}catch(u){throw new Error(JSON.stringify({code:s.INVALID_PARAMS,msg:"[".concat("cloudrun",".callContainer] invalid data")}))}return[4,c.call(this,i(i({},e),{data:o}),t)];case 1:return[2,a.sent()]}}))}))},e}();function c(e,t){return o(this,void 0,void 0,(function(){var n,r,i,o,s,u,c,l,d,f,p,h,g;return a(this,(function(a){switch(a.label){case 0:return n=e.name,r=e.data,i=e.path,o=void 0===i?"":i,s=e.method,u=e.header,c=void 0===u?{}:u,l=this.getEndPointWithKey("GATEWAY"),d=l.BASE_URL,f=l.PROTOCOL,p="".concat(f).concat(d,"/cloudrun/").concat(n),h=o.startsWith("/")?o:"/".concat(o),[4,this.request.fetch({method:s||"POST",headers:Object.assign({},{"Content-Type":"application/json; charset=utf-8"},c),body:r,url:"".concat(p).concat(h),customReqOpts:t})];case 1:return g=a.sent(),"node-sdk"===t.from?[2,g]:[4,g.data];case 2:return[2,a.sent()]}}))}))}var l=new u,d={name:"cloudrun",entity:{callContainer:l.callContainer}};try{cloudbase.registerComponent(d)}catch(f){}}).call(this,n("f3b9")["default"])},a708:function(e,t,n){var r=n("6454");e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports["default"]=e.exports},a72f:function(e,t,n){var r=n("b6fd"),i=n("b7ca");e.exports=function(e,t){return e&&r(t,i(t),e)}},a746:function(e,t,n){var r=n("2024"),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();e.exports=i},a7cb:function(e,t,n){(function(t){var r=n("7ca3"),i=n("af34"),o=n("67ad"),a=n("0bdb");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=n("b99c"),l=n("11ca"),d=l.cloudCall,f=function(){"use strict";function e(){o(this,e),this.loadingAvatars=new Set}return a(e,[{key:"callCloudFunction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(e,t,{pageTag:"avatarCache"})}},{key:"getUserAvatar",value:function(e){if(!e)return Promise.resolve(null);var n=c.getAvatarCache(e);return n?(t("log","\u3010\u5934\u50cf\u7f13\u5b58\u3011\u547d\u4e2d\u7f13\u5b58: ".concat(e)," at utils/avatarCache.js:23"),Promise.resolve(n)):this.loadingAvatars.has(e)?(t("log","\u3010\u5934\u50cf\u7f13\u5b58\u3011\u6b63\u5728\u52a0\u8f7d\u4e2d\uff0c\u7b49\u5f85: ".concat(e)," at utils/avatarCache.js:29"),this.waitForAvatarLoad(e)):this.loadUserAvatar(e)}},{key:"waitForAvatarLoad",value:function(e){var t=this;return new Promise((function(n){var r=setInterval((function(){if(!t.loadingAvatars.has(e)){clearInterval(r);var i=c.getAvatarCache(e);n(i)}}),100);setTimeout((function(){clearInterval(r),t.loadingAvatars.delete(e),n(null)}),5e3)}))}},{key:"loadUserAvatar",value:function(e){var n=this;return this.loadingAvatars.add(e),t("log","\u3010\u5934\u50cf\u7f13\u5b58\u3011\u5f00\u59cb\u52a0\u8f7d\u5934\u50cf: ".concat(e)," at utils/avatarCache.js:60"),new Promise((function(r){n.callCloudFunction("getUserProfile",{userId:e}).then((function(n){if(n.result&&n.result.success&&n.result.userInfo){var i=n.result.userInfo,o={avatarUrl:i.avatarUrl,nickName:i.nickName,bio:i.bio,lastUpdated:Date.now()};c.setAvatarCache(e,o),t("log","\u3010\u5934\u50cf\u7f13\u5b58\u3011\u52a0\u8f7d\u5e76\u7f13\u5b58\u6210\u529f: ".concat(e)," at utils/avatarCache.js:77"),r(o)}else t("warn","\u3010\u5934\u50cf\u7f13\u5b58\u3011\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25: ".concat(e),n.result," at utils/avatarCache.js:80"),r(null)})).catch((function(n){t("error","\u3010\u5934\u50cf\u7f13\u5b58\u3011\u52a0\u8f7d\u5934\u50cf\u5931\u8d25: ".concat(e),n," at utils/avatarCache.js:84"),r(null)})).finally((function(){n.loadingAvatars.delete(e)}))}))}},{key:"getBatchUserAvatars",value:function(e){var n=this;if(!e||0===e.length)return Promise.resolve({});var r={},i=[];return e.forEach((function(e){var t=c.getAvatarCache(e);t?r[e]=t:i.push(e)})),i.length>0?(t("log","\u3010\u5934\u50cf\u7f13\u5b58\u3011\u6279\u91cf\u52a0\u8f7d\u5934\u50cf: ".concat(i.length,"\u4e2a")," at utils/avatarCache.js:112"),new Promise((function(e){n.callCloudFunction("getBatchUserProfiles",{userIds:i}).then((function(t){t.result&&t.result.success&&t.result.userProfiles&&t.result.userProfiles.forEach((function(e){if(e&&e._openid){var t={avatarUrl:e.avatarUrl,nickName:e.nickName,bio:e.bio,lastUpdated:Date.now()};r[e._openid]=t,c.setAvatarCache(e._openid,t)}})),e(r)})).catch((function(n){t("error","\u3010\u5934\u50cf\u7f13\u5b58\u3011\u6279\u91cf\u52a0\u8f7d\u5931\u8d25:",n," at utils/avatarCache.js:133"),e(r)}))}))):Promise.resolve(r)}},{key:"preloadAvatarsFromPosts",value:function(e){var n=this;if(e&&0!==e.length){var r=i(new Set(e.map((function(e){return e._openid})).filter(Boolean)));0!==r.length&&setTimeout((function(){n.getBatchUserAvatars(r).then((function(e){t("log","\u3010\u5934\u50cf\u7f13\u5b58\u3011\u9884\u52a0\u8f7d\u5b8c\u6210: ".concat(Object.keys(e).length,"\u4e2a\u5934\u50cf")," at utils/avatarCache.js:154")}))}),100)}}},{key:"updateUserAvatar",value:function(e,t){if(!e||!t)return!1;var n=u(u({},t),{},{lastUpdated:Date.now()});return c.setAvatarCache(e,n)}},{key:"clearUserAvatar",value:function(e){return!!e&&c.remove("avatar_".concat(e))}},{key:"getDefaultAvatar",value:function(){return"/static/images/avatar.png"}}]),e}(),p=new f;e.exports=p}).call(this,n("f3b9")["default"])},a88a:function(e,t,n){"use strict";n.r(t);var r=n("cd8e"),i=n("4112");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},a8cf:function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("34cf")),a=(getApp(),n("7ab1")),s=a.compressAvatar,u=n("11ca"),c=u.cloudCall,l={data:function(){return{avatarUrl:"",nickName:"",birthday:"",bio:"",endDate:"",isSaving:!1,tempAvatarPath:null,signatureUrl:"",signaturePreview:"",signatureTempPath:null,isProcessingSignature:!1}},onLoad:function(e){this.fetchUserProfile();var t=new Date,n=t.getFullYear()+"-"+(t.getMonth()+1).toString().padStart(2,"0")+"-"+t.getDate().toString().padStart(2,"0");this.setData({endDate:n})},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(e,t,Object.assign({pageTag:"profile-edit",context:this,requireAuth:!0},n))},uploadFile:function(t,i){return e("log","\ud83d\udd0d [ProfileEdit] \u4e0a\u4f20\u6587\u4ef6: ".concat(t),i," at pages/profile-edit/profile-edit.vue:90"),new Promise((function(o,a){var s=n("fd09"),u=s.getCurrentPlatform,c=s.getCloudFunctionMethod,l=u(),d=c();if(e("log","\ud83d\udd0d [ProfileEdit] \u8fd0\u884c\u73af\u5883: ".concat(l,", \u8c03\u7528\u65b9\u5f0f: ").concat(d)," at pages/profile-edit/profile-edit.vue:99"),"tcb"===d){var f=getApp();f&&f.$tcb&&f.$tcb.uploadFile?(e("log","\ud83d\udd0d [ProfileEdit] ".concat(l,"\u73af\u5883\u4f7f\u7528TCB\u4e0a\u4f20\u6587\u4ef6: ").concat(t)," at pages/profile-edit/profile-edit.vue:105"),f.$tcb.uploadFile({cloudPath:t,filePath:i}).then(o).catch(a)):(e("error","\u274c [ProfileEdit] ".concat(l,"\u73af\u5883TCB\u4e0d\u53ef\u7528")," at pages/profile-edit/profile-edit.vue:111"),e("error","\u274c [ProfileEdit] app:",f," at pages/profile-edit/profile-edit.vue:112"),e("error","\u274c [ProfileEdit] app.$tcb:",f&&f.$tcb," at pages/profile-edit/profile-edit.vue:113"),a(new Error("TCB\u5b9e\u4f8b\u4e0d\u53ef\u7528")))}else"wx-cloud"===d?r.cloud&&r.cloud.uploadFile?(e("log","\ud83d\udd0d [ProfileEdit] \u5c0f\u7a0b\u5e8f\u73af\u5883\u4f7f\u7528\u5fae\u4fe1\u4e91\u5f00\u53d1\u4e0a\u4f20\u6587\u4ef6: ".concat(t)," at pages/profile-edit/profile-edit.vue:119"),r.cloud.uploadFile({cloudPath:t,filePath:i,success:function(n){e("log","\u2705 [ProfileEdit] \u6587\u4ef6\u4e0a\u4f20\u6210\u529f: ".concat(t),n," at pages/profile-edit/profile-edit.vue:124"),o(n)},fail:function(n){e("error","\u274c [ProfileEdit] \u6587\u4ef6\u4e0a\u4f20\u5931\u8d25: ".concat(t),n," at pages/profile-edit/profile-edit.vue:128"),a(n)}})):(e("error","\u274c [ProfileEdit] \u5c0f\u7a0b\u5e8f\u73af\u5883\u5fae\u4fe1\u4e91\u5f00\u53d1\u4e0d\u53ef\u7528"," at pages/profile-edit/profile-edit.vue:133"),a(new Error("\u5fae\u4fe1\u4e91\u5f00\u53d1\u4e0d\u53ef\u7528"))):(e("error","\u274c [ProfileEdit] \u4e0d\u652f\u6301\u7684\u4e91\u51fd\u6570\u8c03\u7528\u65b9\u5f0f: ".concat(d)," at pages/profile-edit/profile-edit.vue:137"),a(new Error("\u4e0d\u652f\u6301\u7684\u4e91\u51fd\u6570\u8c03\u7528\u65b9\u5f0f: ".concat(d))))}))},fetchUserProfile:function(){var t=this;this.callCloudFunction("getMyProfileData",{}).then((function(e){if(e.result&&e.result.success&&e.result.userInfo){var n=e.result.userInfo;t.setData({avatarUrl:n.avatarUrl||"",nickName:n.nickName||"",birthday:n.birthday||"",bio:n.bio||"",signatureUrl:n.signatureUrl||"",signaturePreview:n.signatureUrl||"",signatureTempPath:null})}else uni.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u83b7\u53d6\u7528\u6237\u8d44\u6599\u5931\u8d25:",t," at pages/profile-edit/profile-edit.vue:163"),uni.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}))},onChooseAvatar:function(t){var r=this;e("log","\ud83d\udd0d [ProfileEdit] \u5f00\u59cb\u9009\u62e9\u5934\u50cf..."," at pages/profile-edit/profile-edit.vue:172");var i=n("fd09"),o=i.getCurrentPlatform,a=o();if(e("log","\ud83d\udd0d [ProfileEdit] \u5f53\u524d\u5e73\u53f0: ".concat(a)," at pages/profile-edit/profile-edit.vue:178"),"mp-weixin"===a&&t.detail&&t.detail.avatarUrl){var s=t.detail.avatarUrl;e("log","\ud83d\udd0d [ProfileEdit] \u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u9009\u62e9\u5934\u50cf\uff0c\u539f\u59cb\u8def\u5f84:",s," at pages/profile-edit/profile-edit.vue:183"),this.processAvatar(s)}else e("log","\ud83d\udd0d [ProfileEdit] H5/App\u73af\u5883\uff0c\u4f7f\u7528uni.chooseImage\u9009\u62e9\u5934\u50cf"," at pages/profile-edit/profile-edit.vue:187"),uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){var n=t.tempFilePaths[0];e("log","\ud83d\udd0d [ProfileEdit] \u9009\u62e9\u5934\u50cf\u6210\u529f\uff0c\u539f\u59cb\u8def\u5f84:",n," at pages/profile-edit/profile-edit.vue:194"),r.processAvatar(n)},fail:function(t){e("error","\ud83d\udd0d [ProfileEdit] \u9009\u62e9\u5934\u50cf\u5931\u8d25:",t," at pages/profile-edit/profile-edit.vue:198"),uni.showToast({title:"\u9009\u62e9\u5934\u50cf\u5931\u8d25",icon:"none"})}})},processAvatar:function(t){var n=this;e("log","\ud83d\udd0d [ProfileEdit] \u5f00\u59cb\u5904\u7406\u5934\u50cf:",t," at pages/profile-edit/profile-edit.vue:209"),uni.showLoading({title:"\u538b\u7f29\u5934\u50cf\u4e2d..."}),s(t).then((function(t){e("log","\u2705 [ProfileEdit] \u5934\u50cf\u538b\u7f29\u5b8c\u6210\uff0c\u538b\u7f29\u540e\u8def\u5f84:",t," at pages/profile-edit/profile-edit.vue:219"),n.setData({avatarUrl:t,tempAvatarPath:t}),uni.hideLoading(),uni.showToast({title:"\u5934\u50cf\u538b\u7f29\u5b8c\u6210",icon:"success",duration:1500})})).catch((function(r){e("error","\u274c [ProfileEdit] \u5934\u50cf\u538b\u7f29\u5931\u8d25:",r," at pages/profile-edit/profile-edit.vue:232"),n.setData({avatarUrl:t,tempAvatarPath:t}),uni.hideLoading(),uni.showToast({title:"\u538b\u7f29\u5931\u8d25\uff0c\u4f7f\u7528\u539f\u56fe",icon:"none",duration:2e3})}))},onChooseSignature:function(){var e=this;if(!this.isProcessingSignature){var t=function(t){t?e.processSignatureImage(t):uni.showToast({title:"\u672a\u9009\u62e9\u56fe\u7247",icon:"none"})},n={count:1,mediaType:["image"],sourceType:["album","camera"],success:function(e){var n=e.tempFiles&&e.tempFiles[0];t(n&&(n.tempFilePath||n.filePath))},fail:function(e){e&&e.errMsg&&e.errMsg.includes("cancel")||uni.showToast({title:"\u9009\u62e9\u56fe\u7247\u5931\u8d25",icon:"none"})}};uni.chooseMedia?uni.chooseMedia(n):uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){return t(e.tempFilePaths&&e.tempFilePaths[0])},fail:function(e){e&&e.errMsg&&e.errMsg.includes("cancel")||uni.showToast({title:"\u9009\u62e9\u56fe\u7247\u5931\u8d25",icon:"none"})}})}},processSignatureImage:function(t){var n=this;uni.showLoading({title:"\u5904\u7406\u4e2d...",mask:!0}),this.setData({isProcessingSignature:!0}),uni.createSelectorQuery().in(uni).select("#signatureCanvas").node().exec((function(r){var i=r&&r[0]&&r[0].node;if(!i)return uni.hideLoading(),uni.showToast({title:"\u83b7\u53d6\u753b\u5e03\u5931\u8d25",icon:"none"}),void n.setData({isProcessingSignature:!1});var o=i,a=o.getContext("2d"),s=o.createImage();s.src=t,s.onload=function(){var t=s.width,r=s.height,i=Math.min(1,800/Math.max(t,r)),u=Math.max(1,Math.round(t*i)),c=Math.max(1,Math.round(r*i));o.width=u,o.height=c,a.clearRect(0,0,u,c),a.drawImage(s,0,0,u,c);try{for(var l=a.getImageData(0,0,u,c),d=l.data,f=0;f<d.length;f+=4){var p=d[f],h=d[f+1],g=d[f+2],v=(p+h+g)/3,m=Math.max(Math.abs(p-h),Math.abs(p-g),Math.abs(h-g));v>235&&m<25?d[f+3]=0:v>220&&m<30&&(d[f+3]=Math.min(d[f+3],120))}a.putImageData(l,0,0)}catch(y){return e("log","CatchClause",y," at pages/profile-edit/profile-edit.vue:357"),e("log","CatchClause",y," at pages/profile-edit/profile-edit.vue:358"),e("error","\u7b7e\u540d\u50cf\u7d20\u5904\u7406\u5931\u8d25:",y," at pages/profile-edit/profile-edit.vue:359"),uni.hideLoading(),uni.showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"}),void n.setData({isProcessingSignature:!1})}uni.canvasToTempFilePath({canvas:o,x:0,y:0,width:u,height:c,destWidth:u,destHeight:c,fileType:"png",success:function(e){uni.hideLoading(),uni.showToast({title:"\u7b7e\u540d\u5df2\u4f18\u5316",icon:"success",duration:1500}),n.setData({signaturePreview:e.tempFilePath,signatureTempPath:e.tempFilePath,signatureUrl:""})},fail:function(t){e("error","\u5bfc\u51fa\u7b7e\u540d\u5931\u8d25:",t," at pages/profile-edit/profile-edit.vue:393"),uni.hideLoading(),uni.showToast({title:"\u5bfc\u51fa\u5931\u8d25",icon:"none"})},complete:function(){n.setData({isProcessingSignature:!1})}})},s.onerror=function(t){e("error","\u7b7e\u540d\u56fe\u7247\u52a0\u8f7d\u5931\u8d25:",t," at pages/profile-edit/profile-edit.vue:408"),uni.hideLoading(),uni.showToast({title:"\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",icon:"none"}),n.setData({isProcessingSignature:!1})}}))},onNicknameInput:function(e){this.setData({nickName:e.detail.value})},onBirthdayChange:function(e){this.setData({birthday:e.detail.value})},onBioInput:function(e){this.setData({bio:e.detail.value})},onSaveChanges:function(){var t=this;if(!this.isSaving&&!this.isProcessingSignature){this.setData({isSaving:!0}),uni.showLoading({title:"\u4fdd\u5b58\u4e2d...",mask:!0});var n=this.tempAvatarPath?this.uploadFile("user_avatars/".concat(Date.now(),"_").concat(Math.floor(1e3*Math.random())),this.tempAvatarPath):Promise.resolve(null),r=this.signatureTempPath?this.uploadFile("user_signatures/".concat(Date.now(),"_").concat(Math.floor(1e3*Math.random()),".png"),this.signatureTempPath):Promise.resolve(null);Promise.all([n,r]).then((function(e){var n=(0,o.default)(e,2),r=n[0],i=n[1];return t.callCloudFunction("updateUserProfile",{avatarUrl:r,nickName:t.nickName,birthday:t.birthday,bio:t.bio,signatureUrl:i})})).then((function(e){if(!e.result.success)throw new Error(e.result.message||"\u4e91\u51fd\u6570\u4fdd\u5b58\u5931\u8d25");uni.hideLoading(),uni.showToast({title:"\u4fdd\u5b58\u6210\u529f"});var t=getCurrentPages();if(t.length>1){var n=t[t.length-2];n&&"function"===typeof n.fetchUserProfile&&n.fetchUserProfile()}setTimeout((function(){return uni.navigateBack()}),1e3)})).catch((function(t){e("error","\u4fdd\u5b58\u8d44\u6599\u5931\u8d25:",t," at pages/profile-edit/profile-edit.vue:485"),uni.hideLoading(),uni.showToast({title:t.message||"\u64cd\u4f5c\u5931\u8d25",icon:"none"})})).finally((function(){t.setData({isSaving:!1})}))}}}};t.default=l}).call(this,n("f3b9")["default"],n("ed83")["default"])},a919:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleChatModel=void 0;var r=function(){return function(){}}();t.SimpleChatModel=r},a97f:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n("139b"),i=r.formatRelativeTime,o=n("a7cb"),a=n("05f6"),s=n("8e86"),u=s.previewImage,c=n("11ca"),l=c.cloudCall,d=n("2b90"),f={mixins:[d],data:function(){return{userInfo:{avatarUrl:"",nickName:"",bio:""},isLoading:!1,userPosts:[],page:0,hasMore:!0,PAGE_SIZE:5,swiperHeights:{},imageClampHeights:{},targetUserId:"",showFollowButton:!1,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1,followPending:!1,imgindex:0,imageUrl:""}},onLoad:function(t){e("log","\u3010\u7528\u6237\u4e3b\u9875\u3011\u9875\u9762\u52a0\u8f7d,options:",t," at pages/user-profile/user-profile.vue:175");var n=t.userId;if(!n)return uni.showToast({title:"\u7528\u6237\u4fe1\u606f\u83b7\u53d6\u5931\u8d25",icon:"none"}),void uni.navigateBack();this.setData({targetUserId:n}),this.loadUserProfile()},onPullDownRefresh:function(){this.setData({userPosts:[],page:0,hasMore:!0,swiperHeights:{},imageClampHeights:{}}),this.loadUserProfile((function(){uni.stopPullDownRefresh()}))},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadUserPosts()},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(e,t,Object.assign({pageTag:"user-profile",context:this},n))},loadUserProfile:function(t){var n=this;this.setData({isLoading:!0}),this.callCloudFunction("getUserProfile",{userId:this.targetUserId,skip:0,limit:this.PAGE_SIZE}).then((function(t){if(e("log","\u3010\u7528\u6237\u4e3b\u9875\u3011getUserProfile \u8fd4\u56de:",t," at pages/user-profile/user-profile.vue:223"),t.result&&t.result.success){var r=t.result.userInfo,i=t.result.posts||[];i.forEach((function(e){e.createTime&&(e.formattedCreateTime=n.formatTime(e.createTime))})),n.setData({userInfo:r,userPosts:i,page:1,hasMore:i.length===n.PAGE_SIZE}),o.updateUserAvatar(n.targetUserId,r),n.prepareFollowStateWithCache(),uni.setNavigationBarTitle({title:r.nickName||"\u7528\u6237\u4e3b\u9875"})}else{var a;uni.showToast({title:(null===(a=t.result)||void 0===a?void 0:a.message)||"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25",icon:"none"})}})).catch((function(t){e("error","\u3010\u7528\u6237\u4e3b\u9875\u3011getUserProfile \u4e91\u51fd\u6570\u5931\u8d25",t," at pages/user-profile/user-profile.vue:256"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){n.setData({isLoading:!1}),"function"===typeof t&&t()}))},loadUserPosts:function(){var t=this;if(!this.isLoading){var n=this.page,r=this.PAGE_SIZE;this.setData({isLoading:!0}),this.callCloudFunction("getUserProfile",{userId:this.targetUserId,skip:n*r,limit:r}).then((function(e){if(e.result&&e.result.success){var i=e.result.posts||[];i.forEach((function(e){e.createTime&&(e.formattedCreateTime=t.formatTime(e.createTime))}));var o=t.userPosts.concat(i);t.setData({userPosts:o,page:n+1,hasMore:i.length===r})}})).catch((function(t){e("error","\u52a0\u8f7d\u66f4\u591a\u5e16\u5b50\u5931\u8d25:",t," at pages/user-profile/user-profile.vue:300"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){t.setData({isLoading:!1})}))}},prepareFollowState:function(){var e=this.targetUserId,t=this.getCurrentUserId();e&&t&&e!==t?(this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(e)):this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1})},prepareFollowStateWithCache:function(){var e=this.targetUserId,t=this.getCurrentUserId();e&&t&&e!==t?(this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(e)):this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByTarget:!1,isMutualFollow:!1})},fetchFollowStatusWithCache:function(e){var t=this;if(e){var n=this.getCurrentUserId();n&&a.getFollowStatus(n,e).then((function(e){e&&t.setData({isFollowing:e.isFollowing,isFollowedByTarget:e.isFollowedByAuthor,isMutualFollow:e.isMutualFollow})}))}},fetchFollowStatus:function(t){var n=this;t&&this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:t},{requireAuth:!0}).then((function(t){t.result&&t.result.success?n.setData({isFollowing:!!t.result.isFollowing,isFollowedByTarget:!!t.result.isFollower,isMutualFollow:!!t.result.isMutual}):e("warn","\u68c0\u67e5\u5173\u6ce8\u72b6\u6001\u5931\u8d25",t.result," at pages/user-profile/user-profile.vue:391")})).catch((function(t){e("error","\u68c0\u67e5\u5173\u6ce8\u72b6\u6001\u8c03\u7528\u5931\u8d25:",t," at pages/user-profile/user-profile.vue:394")}))},onFollowTap:function(){var t=this;if(!this.followPending){var n=this.targetUserId;if(n){var r=this.getCurrentUserId();r?(this.setData({followPending:!0}),a.toggleFollowStatus(r,n).then((function(e){e?(t.setData({isFollowing:e.isFollowing,isFollowedByTarget:e.isFollowedByAuthor,isMutualFollow:e.isMutualFollow}),uni.showToast({title:e.isFollowing?"\u5173\u6ce8\u6210\u529f":"\u5df2\u53d6\u6d88\u5173\u6ce8",icon:"success"})):uni.showToast({title:"\u64cd\u4f5c\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u5207\u6362\u5173\u6ce8\u72b6\u6001\u5931\u8d25:",t," at pages/user-profile/user-profile.vue:440"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){t.setData({followPending:!1})}))):uni.showToast({title:"\u8bf7\u5148\u767b\u5f55",icon:"none"})}}},getCurrentUserId:function(){return getApp().globalData.openid||uni.getStorageSync("openid")||uni.getStorageSync("userOpenId")},navigateToPostDetail:function(e){var t=e.currentTarget.dataset.id;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},handlePreview:function(e){return u(e,{fallbackToast:!1})},formatTime:function(e){return i(e)},onImageError:function(t){e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25:",t.detail," at pages/user-profile/user-profile.vue:476")},onAvatarError:function(t){e("error","\u5934\u50cf\u52a0\u8f7d\u5931\u8d25:",t.detail," at pages/user-profile/user-profile.vue:480")}}};t.default=f}).call(this,n("f3b9")["default"])},a9a5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPathName=t.deepClone=void 0;t.deepClone=function e(t){var n=function(n){for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n},r=null===t||void 0===t?"NullOrUndefined":Object.prototype.toString.call(t).slice(8,-1);if(["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"].includes(r))return t.slice();switch(r){case"Object":return n(Object.create(Object.getPrototypeOf(t)));case"Array":return n([]);case"Date":return new Date(t.valueOf());case"RegExp":return new RegExp(t.source,(t.global?"g":"")+(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.sticky?"y":"")+(t.unicode?"u":""));default:return t}};t.getPathName=function(e){var t=e.match(/^(?:http(s)?:\/\/[^\/]+)?(\/[^\?#]*)/);return t&&t[2]||""}},aa90:function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Command=void 0;var i=n("3b92"),o=n("c9ca"),a=n("3325"),s=n("8539"),u=r(n("0d49")),c={eq:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.EQ,[e])},neq:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.NEQ,[e])},lt:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.LT,[e])},lte:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.LTE,[e])},gt:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.GT,[e])},gte:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.GTE,[e])},in:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.IN,e)},nin:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.NIN,e)},all:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.ALL,e)},elemMatch:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.ELEM_MATCH,[e])},exists:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.EXISTS,[e])},size:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.SIZE,[e])},mod:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.MOD,[e])},geoNear:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.GEO_NEAR,[e])},geoWithin:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.GEO_WITHIN,[e])},geoIntersects:function(e){return new i.QueryCommand(i.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS,[e])},and:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,s.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommand(o.LOGIC_COMMANDS_LITERAL.AND,n)},nor:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,s.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommand(o.LOGIC_COMMANDS_LITERAL.NOR,n)},or:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,s.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommand(o.LOGIC_COMMANDS_LITERAL.OR,n)},not:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,s.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommand(o.LOGIC_COMMANDS_LITERAL.NOT,n)},set:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.SET,[e])},remove:function(){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.REMOVE,[])},inc:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.INC,[e])},mul:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.MUL,[e])},push:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if((0,s.isObject)(t[0])&&t[0].hasOwnProperty("each")){var r=t[0];e={$each:r.each,$position:r.position,$sort:r.sort,$slice:r.slice}}else e=(0,s.isArray)(t[0])?t[0]:Array.from(t);return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.PUSH,e)},pull:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.PULL,e)},pullAll:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.PULL_ALL,e)},pop:function(){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.POP,[])},shift:function(){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.SHIFT,[])},unshift:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,s.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.UNSHIFT,n)},addToSet:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.ADD_TO_SET,e)},rename:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.RENAME,[e])},bit:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.BIT,[e])},max:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.MAX,[e])},min:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.MIN,[e])},expr:function(e){return{$expr:e}},jsonSchema:function(e){return{$jsonSchema:e}},text:function(e){return(0,s.isString)(e)?{$search:e.search}:{$search:e.search,$language:e.language,$caseSensitive:e.caseSensitive,$diacriticSensitive:e.diacriticSensitive}},aggregate:{pipeline:function(){return new u.default},abs:function(e){return new l("abs",e)},add:function(e){return new l("add",e)},ceil:function(e){return new l("ceil",e)},divide:function(e){return new l("divide",e)},exp:function(e){return new l("exp",e)},floor:function(e){return new l("floor",e)},ln:function(e){return new l("ln",e)},log:function(e){return new l("log",e)},log10:function(e){return new l("log10",e)},mod:function(e){return new l("mod",e)},multiply:function(e){return new l("multiply",e)},pow:function(e){return new l("pow",e)},sqrt:function(e){return new l("sqrt",e)},subtract:function(e){return new l("subtract",e)},trunc:function(e){return new l("trunc",e)},arrayElemAt:function(e){return new l("arrayElemAt",e)},arrayToObject:function(e){return new l("arrayToObject",e)},concatArrays:function(e){return new l("concatArrays",e)},filter:function(e){return new l("filter",e)},in:function(e){return new l("in",e)},indexOfArray:function(e){return new l("indexOfArray",e)},isArray:function(e){return new l("isArray",e)},map:function(e){return new l("map",e)},range:function(e){return new l("range",e)},reduce:function(e){return new l("reduce",e)},reverseArray:function(e){return new l("reverseArray",e)},size:function(e){return new l("size",e)},slice:function(e){return new l("slice",e)},zip:function(e){return new l("zip",e)},and:function(e){return new l("and",e)},not:function(e){return new l("not",e)},or:function(e){return new l("or",e)},cmp:function(e){return new l("cmp",e)},eq:function(e){return new l("eq",e)},gt:function(e){return new l("gt",e)},gte:function(e){return new l("gte",e)},lt:function(e){return new l("lt",e)},lte:function(e){return new l("lte",e)},neq:function(e){return new l("ne",e)},cond:function(e){return new l("cond",e)},ifNull:function(e){return new l("ifNull",e)},switch:function(e){return new l("switch",e)},dateFromParts:function(e){return new l("dateFromParts",e)},dateFromString:function(e){return new l("dateFromString",e)},dayOfMonth:function(e){return new l("dayOfMonth",e)},dayOfWeek:function(e){return new l("dayOfWeek",e)},dayOfYear:function(e){return new l("dayOfYear",e)},isoDayOfWeek:function(e){return new l("isoDayOfWeek",e)},isoWeek:function(e){return new l("isoWeek",e)},isoWeekYear:function(e){return new l("isoWeekYear",e)},millisecond:function(e){return new l("millisecond",e)},minute:function(e){return new l("minute",e)},month:function(e){return new l("month",e)},second:function(e){return new l("second",e)},hour:function(e){return new l("hour",e)},week:function(e){return new l("week",e)},year:function(e){return new l("year",e)},literal:function(e){return new l("literal",e)},mergeObjects:function(e){return new l("mergeObjects",e)},objectToArray:function(e){return new l("objectToArray",e)},allElementsTrue:function(e){return new l("allElementsTrue",e)},anyElementTrue:function(e){return new l("anyElementTrue",e)},setDifference:function(e){return new l("setDifference",e)},setEquals:function(e){return new l("setEquals",e)},setIntersection:function(e){return new l("setIntersection",e)},setIsSubset:function(e){return new l("setIsSubset",e)},setUnion:function(e){return new l("setUnion",e)},concat:function(e){return new l("concat",e)},dateToString:function(e){return new l("dateToString",e)},indexOfBytes:function(e){return new l("indexOfBytes",e)},indexOfCP:function(e){return new l("indexOfCP",e)},split:function(e){return new l("split",e)},strLenBytes:function(e){return new l("strLenBytes",e)},strLenCP:function(e){return new l("strLenCP",e)},strcasecmp:function(e){return new l("strcasecmp",e)},substr:function(e){return new l("substr",e)},substrBytes:function(e){return new l("substrBytes",e)},substrCP:function(e){return new l("substrCP",e)},toLower:function(e){return new l("toLower",e)},toUpper:function(e){return new l("toUpper",e)},meta:function(e){return new l("meta",e)},addToSet:function(e){return new l("addToSet",e)},avg:function(e){return new l("avg",e)},first:function(e){return new l("first",e)},last:function(e){return new l("last",e)},max:function(e){return new l("max",e)},min:function(e){return new l("min",e)},push:function(e){return new l("push",e)},stdDevPop:function(e){return new l("stdDevPop",e)},stdDevSamp:function(e){return new l("stdDevSamp",e)},sum:function(e){return new l("sum",e)},let:function(e){return new l("let",e)}},project:{slice:function(e){return new d("slice",e)},elemMatch:function(e){return new d("elemMatch",e)}}};t.Command=c;var l=function(){return function(e,t){this["$"+e]=t}}(),d=function(){return function(e,t){this["$"+e]=t}}(),f=c;t.default=f},ab04:function(e,t,n){var r=n("4d0d"),i=r.Uint8Array;e.exports=i},ac20:function(e,t,n){"use strict";n.r(t);var r=n("50f3"),i=n("8e37");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},aca4:function(e,t,n){"use strict";n.r(t);var r=n("ee05"),i=n("39e5");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},ace0:function(e,t,n){"use strict";n.r(t);var r=n("b2c1"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},ad15:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("7ca3")),o=n("11ca"),a=o.cloudCall,s={data:function(){return{folders:[],isLoading:!0,selectedFolderId:"",showCreateModal:!1,newFolderName:"",showClone:!1}},props:{show:{type:Boolean,default:!1},postId:{type:String,default:""}},watch:(0,i.default)({show:function(e){e&&this.loadFolders()}},"show",{handler:function(e,t){this.showClone=e},immediate:!0}),methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,t,Object.assign({pageTag:"folder-selector",context:this,requireAuth:!0},n))},loadFolders:function(){var t=this;e("log","\u5f00\u59cb\u52a0\u8f7d\u6536\u85cf\u5939\u5217\u8868..."," at components/folder-selector/folder-selector.vue:122"),this.setData({isLoading:!0});var n=this.$requireOpenid&&this.$requireOpenid();n?this.callCloudFunction("getMyProfileData",{action:"getFavoriteFolders",openid:n}).then((function(n){if(e("log","folder-selector\u83b7\u53d6\u6536\u85cf\u5939:",n," at components/folder-selector/folder-selector.vue:139"),n.result&&n.result.success){var r=n.result.folders||[];e("log","\u83b7\u53d6\u5230\u6536\u85cf\u5939\u6570\u91cf:",r.length," at components/folder-selector/folder-selector.vue:142");var i=t.selectedFolderId;i&&!r.some((function(e){return e._id===i}))&&(e("log","\u6e05\u7a7a\u5931\u6548\u7684\u9009\u4e2d\u72b6\u6001"," at components/folder-selector/folder-selector.vue:147"),t.setData({selectedFolderId:""})),t.setData({folders:r,isLoading:!1})}else{var o;uni.showToast({title:(null===(o=n.result)||void 0===o?void 0:o.message)||"\u52a0\u8f7d\u5931\u8d25",icon:"none"}),t.setData({isLoading:!1,folders:[],selectedFolderId:""})}})).catch((function(n){e("error","\u83b7\u53d6\u6536\u85cf\u5939\u5931\u8d25:",n," at components/folder-selector/folder-selector.vue:168"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"}),t.setData({isLoading:!1,folders:[],selectedFolderId:""})})):this.setData({isLoading:!1,folders:[],selectedFolderId:""})},selectFolder:function(e){var t=e.currentTarget.dataset.folderId;this.setData({selectedFolderId:t})},confirmFavorite:function(){var t=this,n=this.selectedFolderId,r=this.postId;if(e("log","\u786e\u8ba4\u6536\u85cf\uff0cpostId:",r,"folderId:",n," at components/folder-selector/folder-selector.vue:193"),n){if(!r)return e("error","postId \u4e3a\u7a7a\uff0c\u65e0\u6cd5\u6536\u85cf"," at components/folder-selector/folder-selector.vue:202"),void uni.showToast({title:"\u53c2\u6570\u9519\u8bef\uff1a\u5e16\u5b50ID\u4e3a\u7a7a",icon:"none"});var i=this.$requireOpenid&&this.$requireOpenid();i&&(uni.showLoading({title:"\u6536\u85cf\u4e2d..."}),this.callCloudFunction("getMyProfileData",{action:"addToFavorite",postId:r,folderId:n,openid:i}).then((function(n){uni.hideLoading(),e("log","\u786e\u8ba4\u6536\u85cf\u8fd4\u56de\u7ed3\u679c:",n," at components/folder-selector/folder-selector.vue:223"),n&&n.result?n.result.success?(uni.showToast({title:"\u6536\u85cf\u6210\u529f"}),e("log","\u6536\u85cf\u6210\u529f\uff0c\u5f00\u59cb\u5173\u95ed\u5f39\u7a97"," at components/folder-selector/folder-selector.vue:229"),t.setData({selectedFolderId:""}),setTimeout((function(){t.hideModal()}),1500),t.$emit("favoriteSuccess")):(e("error","\u6536\u85cf\u4e1a\u52a1\u5931\u8d25:",n.result," at components/folder-selector/folder-selector.vue:244"),uni.showToast({title:n.result.message||"\u6536\u85cf\u5931\u8d25",icon:"none"})):(e("error","\u6536\u85cf\u8fd4\u56de\u683c\u5f0f\u5f02\u5e38:",n," at components/folder-selector/folder-selector.vue:251"),uni.showToast({title:"\u6536\u85cf\u5931\u8d25\uff1a\u8fd4\u56de\u683c\u5f0f\u9519\u8bef",icon:"none"}))})).catch((function(t){uni.hideLoading(),e("error","\u6536\u85cf\u4e91\u51fd\u6570\u8c03\u7528\u5931\u8d25:",t," at components/folder-selector/folder-selector.vue:259"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef\uff1a"+(t.errMsg||"\u672a\u77e5\u9519\u8bef"),icon:"none"})})))}else uni.showToast({title:"\u8bf7\u9009\u62e9\u6536\u85cf\u5939",icon:"none"})},createFolder:function(){this.setData({showCreateModal:!0,newFolderName:""})},hideCreateModal:function(){this.setData({showCreateModal:!1,newFolderName:""})},onFolderNameInput:function(e){var t=e.detail.value;this.setData({newFolderName:t})},createNewFolder:function(){var t=this,n=this.newFolderName.trim();if(n){this.setData({newFolderName:n}),e("log","\u7ec4\u4ef6\u5f00\u59cb\u521b\u5efa\u6536\u85cf\u5939\uff0c\u540d\u79f0:",n," at components/folder-selector/folder-selector.vue:306");var r=this.$requireOpenid&&this.$requireOpenid();r&&(uni.showLoading({title:"\u521b\u5efa\u4e2d..."}),this.callCloudFunction("getMyProfileData",{action:"createFavoriteFolder",folderName:n,openid:r}).then((function(n){uni.hideLoading(),e("log","\u7ec4\u4ef6\u521b\u5efa\u6536\u85cf\u5939\u8fd4\u56de\u7ed3\u679c:",n," at components/folder-selector/folder-selector.vue:320"),n&&n.result?n.result.success?(uni.showToast({title:"\u521b\u5efa\u6210\u529f",duration:2e3}),t.setData({showCreateModal:!1}),setTimeout((function(){t.loadFolders()}),300)):(e("error","\u7ec4\u4ef6\u521b\u5efa\u6536\u85cf\u5939\u4e1a\u52a1\u5931\u8d25:",n.result," at components/folder-selector/folder-selector.vue:337"),uni.showToast({title:n.result.message||"\u521b\u5efa\u5931\u8d25",icon:"none",duration:3e3})):(e("error","\u7ec4\u4ef6\u521b\u5efa\u6536\u85cf\u5939\u8fd4\u56de\u683c\u5f0f\u5f02\u5e38:",n," at components/folder-selector/folder-selector.vue:345"),uni.showToast({title:"\u521b\u5efa\u5931\u8d25\uff1a\u8fd4\u56de\u683c\u5f0f\u9519\u8bef",icon:"none",duration:3e3}))})).catch((function(t){uni.hideLoading(),e("error","\u7ec4\u4ef6\u521b\u5efa\u6536\u85cf\u5939\u4e91\u51fd\u6570\u8c03\u7528\u5931\u8d25:",t," at components/folder-selector/folder-selector.vue:354"),uni.showToast({title:"\u521b\u5efa\u5931\u8d25: "+(t.errMsg||"\u7f51\u7edc\u9519\u8bef"),icon:"none",duration:3e3})})))}else uni.showToast({title:"\u8bf7\u8f93\u5165\u6536\u85cf\u5939\u540d\u79f0",icon:"none"})},hideModal:function(){e("log","=== \u70b9\u51fb\u5173\u95ed\u6309\u94ae\uff0c\u5f00\u59cb\u9690\u85cf\u5f39\u7a97 ==="," at components/folder-selector/folder-selector.vue:365"),e("log","\u5f53\u524d\u72b6\u6001\uff1a",{show:this.show,showCreateModal:this.showCreateModal,selectedFolderId:this.selectedFolderId}," at components/folder-selector/folder-selector.vue:366"),this.setData({selectedFolderId:"",showClone:!1,showCreateModal:!1,newFolderName:""}),e("log","=== \u5f39\u7a97\u5df2\u9690\u85cf\uff0c\u72b6\u6001\u5df2\u91cd\u7f6e ==="," at components/folder-selector/folder-selector.vue:379"),this.$emit("hide")},trueFun:function(){e("log","\u5360\u4f4d\uff1a\u51fd\u6570 true \u672a\u58f0\u660e"," at components/folder-selector/folder-selector.vue:384")}},created:function(){}};t.default=s}).call(this,n("f3b9")["default"])},ae4d:function(e,t,n){"use strict";n.r(t);var r=n("4dec"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},ae75:function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.WhereFilterOpList=t.UpdateOperatorList=t.QueryType=t.OrderDirectionList=t.OperatorMap=t.Opeartor=t.FieldType=t.ErrorCode=void 0,t.ErrorCode=i,function(e){e["DocIDError"]="\u6587\u6863ID\u4e0d\u5408\u6cd5",e["CollNameError"]="\u96c6\u5408\u540d\u79f0\u4e0d\u5408\u6cd5",e["OpStrError"]="\u64cd\u4f5c\u7b26\u4e0d\u5408\u6cd5",e["DirectionError"]="\u6392\u5e8f\u5b57\u7b26\u4e0d\u5408\u6cd5",e["IntergerError"]="must be integer",e["QueryParamTypeError"]="\u67e5\u8be2\u53c2\u6570\u5fc5\u987b\u4e3a\u5bf9\u8c61",e["QueryParamValueError"]="\u67e5\u8be2\u53c2\u6570\u5bf9\u8c61\u503c\u4e0d\u80fd\u5747\u4e3aundefined"}(i||(t.ErrorCode=i={}));t.FieldType={String:"String",Number:"Number",Object:"Object",Array:"Array",Boolean:"Boolean",Null:"Null",GeoPoint:"GeoPoint",GeoLineString:"GeoLineString",GeoPolygon:"GeoPolygon",GeoMultiPoint:"GeoMultiPoint",GeoMultiLineString:"GeoMultiLineString",GeoMultiPolygon:"GeoMultiPolygon",Timestamp:"Date",Command:"Command",ServerDate:"ServerDate",BsonDate:"BsonDate"};t.OrderDirectionList=["desc","asc"];var o;t.WhereFilterOpList=["<","<=","==",">=",">"],t.Opeartor=o,function(e){e["lt"]="<",e["gt"]=">",e["lte"]="<=",e["gte"]=">=",e["eq"]="=="}(o||(t.Opeartor=o={}));var a=(r={},r[o.eq]="$eq",r[o.lt]="$lt",r[o.lte]="$lte",r[o.gt]="$gt",r[o.gte]="$gte",r);t.OperatorMap=a;var s;t.UpdateOperatorList=["$set","$inc","$mul","$unset","$push","$pop","$unshift","$shift","$currentDate","$each","$position"],t.QueryType=s,function(e){e["WHERE"]="WHERE",e["DOC"]="DOC"}(s||(t.QueryType=s={}))},aee9:function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("af34")),a=n("8e86"),s=a.previewImage,u=n("11ca"),c=u.cloudCall,l={data:function(){return{content:"",images:[],submitting:!1,maxImages:3,statusBarHeight:0}},onLoad:function(){var e=uni.getSystemInfoSync();this.setData({statusBarHeight:e.statusBarHeight})},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(e,t,Object.assign({pageTag:"feedback",context:this},n))},onContentInput:function(e){this.setData({content:e.detail.value})},chooseImages:function(){var t=this,n=this.images,r=this.maxImages,i=r-n.length;i<=0?uni.showToast({title:"\u6700\u591a\u53ea\u80fd\u4e0a\u4f20".concat(r,"\u5f20\u56fe\u7247"),icon:"none"}):uni.chooseMedia({count:i,mediaType:["image"],sourceType:["album","camera"],success:function(e){var r=e.tempFiles.map((function(e){return{path:e.tempFilePath,size:e.size}}));t.setData({images:[].concat((0,o.default)(n),(0,o.default)(r))})},fail:function(t){e("error","\u9009\u62e9\u56fe\u7247\u5931\u8d25:",t," at pages/feedback/feedback.vue:127"),uni.showToast({title:"\u9009\u62e9\u56fe\u7247\u5931\u8d25",icon:"none"})}})},removeImage:function(e){var t=e.currentTarget.dataset.index,n=this.images;n.splice(t,1),this.setData({images:n})},previewImage:function(e){var t=e.currentTarget.dataset.index,n=Array.isArray(this.images)?this.images:[];if(n.length){var r=n.map((function(e){return e.path})).filter(Boolean);if(r.length){var i=r[t]||r[0];return s({current:i,urls:r},{fallbackToast:!1})}}},submitFeedback:function(){var t=this,n=this.content,r=this.images,i=this.submitting;if(!i)if(n.trim()){this.setData({submitting:!0});var o=this.$requireOpenid&&this.$requireOpenid();o?this.uploadImages(r).then((function(e){return t.submitFeedbackData(n,e,o)})).then((function(){uni.showToast({title:"\u53cd\u9988\u63d0\u4ea4\u6210\u529f",icon:"success"}),t.setData({content:"",images:[]}),setTimeout((function(){uni.navigateBack()}),1500)})).catch((function(t){e("error","\u63d0\u4ea4\u53cd\u9988\u5931\u8d25:",t," at pages/feedback/feedback.vue:210"),uni.showToast({title:"\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5",icon:"none"})})).finally((function(){t.setData({submitting:!1})})):this.setData({submitting:!1})}else uni.showToast({title:"\u8bf7\u8f93\u5165\u53cd\u9988\u5185\u5bb9",icon:"none"})},uploadImages:function(t){var n=this;if(0===t.length)return Promise.resolve([]);var r=t.map((function(t,r){var i="feedback/".concat(Date.now(),"_").concat(r,".jpg");return n.uploadFile(i,t.path).then((function(e){return e.fileID})).catch((function(t){throw e("error","\u56fe\u7247\u4e0a\u4f20\u5931\u8d25:",t," at pages/feedback/feedback.vue:235"),t}))}));return Promise.all(r)},submitFeedbackData:function(t,n,r){var i=this;return new Promise((function(o,a){var s=r||i.$requireOpenid&&i.$requireOpenid();if(!s)return a(new Error("\u7528\u6237\u672a\u767b\u5f55"));i.callCloudFunction("feedbackManager",{action:"submitFeedback",content:t,imageUrls:n,openid:s}).then((function(e){var t;e.result&&e.result.success?o(e.result):a(new Error((null===(t=e.result)||void 0===t?void 0:t.message)||"\u63d0\u4ea4\u5931\u8d25"))})).catch((function(t){e("error","\u8c03\u7528\u4e91\u51fd\u6570\u5931\u8d25:",t," at pages/feedback/feedback.vue:261"),a(t)}))}))},goBack:function(){uni.navigateBack()},uploadFile:function(t,i){var o=this;return e("log","\ud83d\udd0d [\u53cd\u9988\u9875] \u4e0a\u4f20\u6587\u4ef6: ".concat(t),i," at pages/feedback/feedback.vue:274"),new Promise((function(a,s){var u=n("fd09"),c=u.getCurrentPlatform,l=u.getCloudFunctionMethod,d=c(),f=l();e("log","\ud83d\udd0d [\u53cd\u9988\u9875] \u8fd0\u884c\u73af\u5883\u68c0\u6d4b - \u5e73\u53f0: ".concat(d,", \u65b9\u6cd5: ").concat(f)," at pages/feedback/feedback.vue:283"),"tcb"===f?o.$tcb&&o.$tcb.uploadFile?(e("log","\ud83d\udd0d [\u53cd\u9988\u9875] TCB\u73af\u5883\u4e0a\u4f20\u6587\u4ef6: ".concat(t)," at pages/feedback/feedback.vue:288"),o.$tcb.uploadFile({cloudPath:t,filePath:i}).then(a).catch(s)):(e("error","\u274c [\u53cd\u9988\u9875] TCB\u5b9e\u4f8b\u4e0d\u53ef\u7528"," at pages/feedback/feedback.vue:294"),s(new Error("TCB\u5b9e\u4f8b\u4e0d\u53ef\u7528"))):"wx-cloud"===f?r.cloud&&r.cloud.uploadFile?(e("log","\ud83d\udd0d [\u53cd\u9988\u9875] \u5c0f\u7a0b\u5e8f\u73af\u5883\u4e0a\u4f20\u6587\u4ef6: ".concat(t)," at pages/feedback/feedback.vue:300"),r.cloud.uploadFile({cloudPath:t,filePath:i,success:function(n){e("log","\u2705 [\u53cd\u9988\u9875] \u6587\u4ef6\u4e0a\u4f20\u6210\u529f: ".concat(t),n," at pages/feedback/feedback.vue:305"),a(n)},fail:function(n){e("error","\u274c [\u53cd\u9988\u9875] \u6587\u4ef6\u4e0a\u4f20\u5931\u8d25: ".concat(t),n," at pages/feedback/feedback.vue:309"),s(n)}})):(e("error","\u274c [\u53cd\u9988\u9875] \u5fae\u4fe1\u4e91\u5f00\u53d1\u4e0d\u53ef\u7528"," at pages/feedback/feedback.vue:314"),s(new Error("\u5fae\u4fe1\u4e91\u5f00\u53d1\u4e0d\u53ef\u7528"))):(e("error","\u274c [\u53cd\u9988\u9875] \u4e0d\u652f\u6301\u7684\u6587\u4ef6\u4e0a\u4f20\u65b9\u5f0f: ".concat(f)," at pages/feedback/feedback.vue:318"),s(new Error("\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u4e0a\u4f20\u65b9\u5f0f: ".concat(f))))}))}}};t.default=l}).call(this,n("f3b9")["default"],n("ed83")["default"])},af34:function(e,t,n){var r=n("a708"),i=n("b893"),o=n("6382"),a=n("9008");e.exports=function(e){return r(e)||i(e)||o(e)||a()},e.exports.__esModule=!0,e.exports["default"]=e.exports},b02b:function(e,t,n){"use strict";n.r(t);var r=n("c692"),i=n("2fcc");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},b031:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.getTabBar=function(){return{setData:function(t){var n,r,i,o;"function"===typeof(null===(n=this.$mp)||void 0===n||null===(r=n.page)||void 0===r?void 0:r.getTabBar)&&null!==(i=this.$mp)&&void 0!==i&&null!==(o=i.page)&&void 0!==o&&o.getTabBar()?this.$mp.page.getTabBar().setData(t):e("log","\u5f53\u524d\u5e73\u53f0\u4e0d\u652f\u6301getTabBar()\uff0c\u5df2\u7a0d\u4f5c\u5904\u7406\uff0c\u8be6\u7ec6\u8bf7\u53c2\u89c1\u76f8\u5173\u6587\u6863\u3002"," at uni_modules/zp-mixins/methods/getTabBar.js:15")}}}}).call(this,n("f3b9")["default"])},b168:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Platform=void 0;t.Platform={}},b2c1:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("127e")),o=r(n("ee10")),a=r(n("8cb3")),s=r(n("8cb3")),u=n("8e86"),c=u.previewImage,l=n("fcd5"),d=l.normalizePostList,f=n("11ca"),p=f.cloudCall,h=n("0efe"),g={components:{skeleton:a.default},mixins:[h],data:function(){return{tag:"",postList:[],img:""}},onLoad:function(e){var t=decodeURIComponent(e.tag||"");if(!t)return uni.showToast({title:"\u6807\u7b7e\u53c2\u6570\u9519\u8bef",icon:"none"}),void uni.navigateBack();this.setData({tag:t}),uni.setNavigationBarTitle({title:"#".concat(t)}),this.initPagination(this.loadTagPosts.bind(this),{pageSize:10})},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p(e,t,Object.assign({pageTag:"tag-filter",context:this},n))},loadTagPosts:function(t){var n=this;return(0,o.default)(i.default.mark((function r(){var o,a,s,u,c,l,f,p;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.page,a=t.isRefresh,s=10*o,r.prev=2,r.next=5,n.callCloudFunction("getPostList",{skip:s,limit:10,tag:n.tag});case 5:if(u=r.sent,u.result&&!0===u.result.success){r.next=12;break}throw c=u.result&&u.result.message||"\u52a0\u8f7d\u5931\u8d25",uni.showToast({title:c,icon:"none"}),l=new Error(c),l.__toastShown=!0,l;case 12:return f=d(u.result.posts||[]),p=0===o||a?f:n.postList.concat(f),n.setData({postList:p}),r.abrupt("return",{list:f,hasMore:10===f.length});case 18:throw r.prev=18,r.t0=r["catch"](2),e("error","\u83b7\u53d6\u6807\u7b7e\u6587\u7ae0\u5931\u8d25:",r.t0," at pages/tag-filter/tag-filter.vue:199"),r.t0&&r.t0.__toastShown||uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"}),r.t0;case 23:case"end":return r.stop()}}),r,null,[[2,18]])})))()},onPostTap:function(e){var t=e.currentTarget.dataset.postid;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},navigateToUserProfile:function(e){var t=e.currentTarget.dataset.userId;if(t){var n=getApp(),r=n.globalData.openid;t===r?uni.switchTab({url:"/pages/profile/profile"}):uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(t)})}},handlePreview:function(e){return c(e,{fallbackToast:!1})},onImageError:function(t){e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",t.detail," at pages/tag-filter/tag-filter.vue:242")},onAvatarError:function(t){e("error","\u5934\u50cf\u52a0\u8f7d\u5931\u8d25",t.detail," at pages/tag-filter/tag-filter.vue:246")},onTagClick:function(t){var n=t.currentTarget.dataset.tag;e("log","\u70b9\u51fb\u6807\u7b7e:",n," at pages/tag-filter/tag-filter.vue:252"),uni.navigateTo({url:"/pages/tag-filter/tag-filter?tag=".concat(encodeURIComponent(n)),success:function(){e("log","\u8df3\u8f6c\u5230\u6807\u7b7e\u7b5b\u9009\u9875\u9762\u6210\u529f"," at pages/tag-filter/tag-filter.vue:258")},fail:function(t){e("error","\u8df3\u8f6c\u5230\u6807\u7b7e\u7b5b\u9009\u9875\u9762\u5931\u8d25:",t," at pages/tag-filter/tag-filter.vue:261"),uni.showToast({title:"\u8df3\u8f6c\u5931\u8d25",icon:"none"})}})},onCommentClick:function(t){var n=t.currentTarget.dataset.postid;e("log","\u70b9\u51fb\u8bc4\u8bba\uff0c\u8df3\u8f6c\u5230\u8be6\u60c5\u9875:",n," at pages/tag-filter/tag-filter.vue:273"),uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(n),success:function(){e("log","\u8df3\u8f6c\u5230\u8be6\u60c5\u9875\u6210\u529f"," at pages/tag-filter/tag-filter.vue:277")},fail:function(t){e("error","\u8df3\u8f6c\u5230\u8be6\u60c5\u9875\u5931\u8d25:",t," at pages/tag-filter/tag-filter.vue:280"),uni.showToast({title:"\u8df3\u8f6c\u5931\u8d25",icon:"none"})}})}}};t.default=g,t.default.components=Object.assign({skeleton:s.default},t.default.components||{})}).call(this,n("f3b9")["default"])},b3c1:function(e,t,n){"use strict";n.r(t);var r=n("0f6e"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},b3cf:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.VirtualWebSocketClient=void 0;var i,o=r(n("3b2d")),a=r(n("e321")),s=r(n("095a")),u=r(n("92f5")),c=n("9ac9"),l=n("9b0c"),d=n("df59"),f=n("274f"),p=n("31ec"),h=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},g=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},v=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};(function(e){e["LOGGINGIN"]="LOGGINGIN",e["INITING"]="INITING",e["REBUILDING"]="REBUILDING",e["ACTIVE"]="ACTIVE",e["ERRORED"]="ERRORED",e["CLOSING"]="CLOSING",e["CLOSED"]="CLOSED",e["PAUSED"]="PAUSED",e["RESUMING"]="RESUMING"})(i||(i={}));var m=function(){function t(t){var n=this;this.watchStatus=i.INITING,this.wsLogin=function(e,t){return h(n,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return this.watchStatus=i.LOGGINGIN,[4,this.login(e,t)];case 1:return n=r.sent(),this.envId||(this.envId=n.envId),[2,n]}}))}))},this.initWatch=function(t){return h(n,void 0,void 0,(function(){var n,r=this;return g(this,(function(o){switch(o.label){case 0:if(null!==this.initWatchPromise&&void 0!==this.initWatchPromise)return[2,this.initWatchPromise];this.initWatchPromise=new Promise((function(n,o){!function(){h(r,void 0,void 0,(function(){var r,a,s,u,l,f,p,h,v,m,y;return g(this,(function(g){switch(g.label){case 0:return g.trys.push([0,3,,4]),this.watchStatus===i.PAUSED?(e("log","[realtime] initWatch cancelled on pause"," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:109"),[2,n()]):[4,this.wsLogin(this.envId,t)];case 1:return r=g.sent().envId,this.watchStatus===i.PAUSED?(e("log","[realtime] initWatch cancelled on pause"," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:116"),[2,n()]):(this.watchStatus=i.INITING,a={watchId:this.watchId,requestId:(0,c.genRequestId)(),msgType:"INIT_WATCH",msgData:{envId:r,collName:this.collectionName,query:this.query,limit:this.limit,orderBy:this.orderBy}},[4,this.send({msg:a,waitResponse:!0,skipOnMessage:!0,timeout:1e4})]);case 2:if(s=g.sent(),u=s.msgData,l=u.events,f=u.currEvent,this.sessionInfo={queryID:s.msgData.queryID,currentEventId:f-1,currentDocs:[]},l.length>0){for(p=0,h=l;p<h.length;p++)v=h[p],v.ID=f;this.handleServerEvents(s)}else this.sessionInfo.currentEventId=f,m=new d.Snapshot({id:f,docChanges:[],docs:[],type:"init"}),this.listener.onChange(m),this.scheduleSendACK();return this.onWatchStart(this,this.sessionInfo.queryID),this.watchStatus=i.ACTIVE,this.availableRetries.INIT_WATCH=2,n(),[3,4];case 3:return y=g.sent(),this.handleWatchEstablishmentError(y,{operationName:"INIT_WATCH",resolve:n,reject:o}),[3,4];case 4:return[2]}}))}))}()})),n=!1,o.label=1;case 1:return o.trys.push([1,,3,4]),[4,this.initWatchPromise];case 2:return o.sent(),n=!0,[3,4];case 3:return this.initWatchPromise=void 0,[7];case 4:return e("log","[realtime] initWatch ".concat(n?"success":"fail")," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:195"),[2]}}))}))},this.rebuildWatch=function(t){return h(n,void 0,void 0,(function(){var n,r=this;return g(this,(function(o){switch(o.label){case 0:if(null!==this.rebuildWatchPromise&&void 0!==this.rebuildWatchPromise)return[2,this.rebuildWatchPromise];this.rebuildWatchPromise=new Promise((function(n,o){!function(){h(r,void 0,void 0,(function(){var r,a,s,u;return g(this,(function(l){switch(l.label){case 0:return l.trys.push([0,3,,4]),this.watchStatus===i.PAUSED?(e("log","[realtime] rebuildWatch cancelled on pause"," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:217"),[2,n()]):[4,this.wsLogin(this.envId,t)];case 1:if(r=l.sent().envId,!this.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");return this.watchStatus===i.PAUSED?(e("log","[realtime] rebuildWatch cancelled on pause"," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:227"),[2,n()]):(this.watchStatus=i.REBUILDING,a={watchId:this.watchId,requestId:(0,c.genRequestId)(),msgType:"REBUILD_WATCH",msgData:{envId:r,collName:this.collectionName,queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:a,waitResponse:!0,skipOnMessage:!1,timeout:1e4})]);case 2:return s=l.sent(),this.handleServerEvents(s),this.watchStatus=i.ACTIVE,this.availableRetries.REBUILD_WATCH=2,n(),[3,4];case 3:return u=l.sent(),this.handleWatchEstablishmentError(u,{operationName:"REBUILD_WATCH",resolve:n,reject:o}),[3,4];case 4:return[2]}}))}))}()})),n=!1,o.label=1;case 1:return o.trys.push([1,,3,4]),[4,this.rebuildWatchPromise];case 2:return o.sent(),n=!0,[3,4];case 3:return this.rebuildWatchPromise=void 0,[7];case 4:return e("log","[realtime] rebuildWatch ".concat(n?"success":"fail")," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:281"),[2]}}))}))},this.handleWatchEstablishmentError=function(e,t){return h(n,void 0,void 0,(function(){var n,r,o,a=this;return g(this,(function(s){return n="INIT_WATCH"===t.operationName,r=function(){a.closeWithError(new f.CloudSDKError({errCode:n?f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:e})),t.reject(e)},o=function(e){a.useRetryTicket(t.operationName)?n?(a.initWatchPromise=void 0,t.resolve(a.initWatch(e))):(a.rebuildWatchPromise=void 0,t.resolve(a.rebuildWatch(e))):r()},this.handleCommonError(e,{onSignError:function(){return o(!0)},onTimeoutError:function(){return o(!1)},onNotRetryableError:r,onCancelledError:t.reject,onUnknownError:function(){(function(){h(a,void 0,void 0,(function(){var e,n=this;return g(this,(function(r){switch(r.label){case 0:return r.trys.push([0,8,,9]),e=function(){return h(n,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return this.pause(),[4,this.onceWSConnected()];case 1:return e.sent(),o(!0),[2]}}))}))},this.isWSConnected()?[3,2]:[4,e()];case 1:return r.sent(),[3,7];case 2:return[4,(0,p.sleep)(100)];case 3:return r.sent(),this.watchStatus!==i.PAUSED?[3,4]:(t.reject(new f.CancelledError("".concat(t.operationName," cancelled due to pause after unknownError"))),[3,7]);case 4:return this.isWSConnected()?[3,6]:[4,e()];case 5:return r.sent(),[3,7];case 6:o(!1),r.label=7;case 7:return[3,9];case 8:return r.sent(),o(!0),[3,9];case 9:return[2]}}))}))})()}}),[2]}))}))},this.closeWatch=function(){return h(n,void 0,void 0,(function(){var e,t,n;return g(this,(function(r){switch(r.label){case 0:if(e=this.sessionInfo?this.sessionInfo.queryID:"",this.watchStatus!==i.ACTIVE)return this.watchStatus=i.CLOSED,this.onWatchClose(this,e),[2];r.label=1;case 1:return r.trys.push([1,3,4,5]),this.watchStatus=i.CLOSING,t={watchId:this.watchId,requestId:(0,c.genRequestId)(),msgType:"CLOSE_WATCH",msgData:null},[4,this.send({msg:t})];case 2:return r.sent(),this.sessionInfo=void 0,this.watchStatus=i.CLOSED,[3,5];case 3:return n=r.sent(),this.closeWithError(new f.CloudSDKError({errCode:f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL,errMsg:n})),[3,5];case 4:return this.onWatchClose(this,e),[7];case 5:return[2]}}))}))},this.scheduleSendACK=function(){n.clearACKSchedule(),n.ackTimeoutId=setTimeout((function(){n.waitExpectedTimeoutId?n.scheduleSendACK():n.sendACK()}),1e4)},this.clearACKSchedule=function(){n.ackTimeoutId&&clearTimeout(n.ackTimeoutId)},this.sendACK=function(){return h(n,void 0,void 0,(function(){var t,n,r;return g(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),this.watchStatus!==i.ACTIVE?(this.scheduleSendACK(),[2]):this.sessionInfo?(t={watchId:this.watchId,requestId:(0,c.genRequestId)(),msgType:"CHECK_LAST",msgData:{queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:t})]):(e("warn","[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)"," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:445"),[2]);case 1:return o.sent(),this.scheduleSendACK(),[3,3];case 2:if(n=o.sent(),(0,f.isRealtimeErrorMessageError)(n))switch(r=n.payload,r.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return this.rebuildWatch(),[2];case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return this.closeWithError(new f.CloudSDKError({errCode:f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:r.msgData.code})),[2];default:break}return this.availableRetries.CHECK_LAST&&this.availableRetries.CHECK_LAST>0?(this.availableRetries.CHECK_LAST-=1,this.scheduleSendACK()):this.closeWithError(new f.CloudSDKError({errCode:f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:n})),[3,3];case 3:return[2]}}))}))},this.handleCommonError=function(e,t){if((0,f.isRealtimeErrorMessageError)(e)){var n=e.payload;switch(n.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return void t.onSignError(e);case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return void t.onNotRetryableError(e);default:return void t.onNotRetryableError(e)}}else{if((0,f.isTimeoutError)(e))return void t.onTimeoutError(e);if((0,f.isCancelledError)(e))return void t.onCancelledError(e)}t.onUnknownError(e)},this.watchId="watchid_".concat(+new Date,"_").concat(Math.random()),this.envId=t.envId,this.collectionName=t.collectionName,this.query=t.query,this.limit=t.limit,this.orderBy=t.orderBy,this.send=t.send,this.login=t.login,this.isWSConnected=t.isWSConnected,this.onceWSConnected=t.onceWSConnected,this.getWaitExpectedTimeoutLength=t.getWaitExpectedTimeoutLength,this.onWatchStart=t.onWatchStart,this.onWatchClose=t.onWatchClose,this.debug=t.debug,this.availableRetries={INIT_WATCH:2,REBUILD_WATCH:2,CHECK_LAST:2},this.listener=new l.RealtimeListener({close:function(){n.closeWatch()},onChange:t.onChange,onError:t.onError,debug:this.debug,virtualClient:this}),this.initWatch()}return t.prototype.onMessage=function(t){var n=this;switch(this.watchStatus){case i.PAUSED:if("ERROR"!==t.msgType)return;break;case i.LOGGINGIN:case i.INITING:case i.REBUILDING:return void e("warn","[realtime listener] internal non-fatal error: unexpected message received while ".concat(this.watchStatus)," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:583");case i.CLOSED:return void e("warn","[realtime listener] internal non-fatal error: unexpected message received when the watch has closed"," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:587");case i.ERRORED:return void e("warn","[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error"," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:591")}if(this.sessionInfo)switch(this.scheduleSendACK(),t.msgType){case"NEXT_EVENT":e("warn","nextevent ".concat(t.msgData.currEvent," ignored"),t," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:602"),this.handleServerEvents(t);break;case"CHECK_EVENT":this.sessionInfo.currentEventId<t.msgData.currEvent&&(this.sessionInfo.expectEventId=t.msgData.currEvent,this.clearWaitExpectedEvent(),this.waitExpectedTimeoutId=setTimeout((function(){n.rebuildWatch()}),this.getWaitExpectedTimeoutLength()),e("log","[realtime] waitExpectedTimeoutLength ".concat(this.getWaitExpectedTimeoutLength())," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:613"));break;case"ERROR":this.closeWithError(new f.CloudSDKError({errCode:f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:"".concat(t.msgData.code," - ").concat(t.msgData.message)}));break;default:e("warn","[realtime listener] virtual client receive unexpected msg ".concat(t.msgType,": "),t," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:625");break}else e("warn","[realtime listener] internal non-fatal error: sessionInfo not found while message is received."," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:596")},t.prototype.closeWithError=function(t){var n;this.watchStatus=i.ERRORED,this.clearACKSchedule(),this.listener.onError(t),this.onWatchClose(this,(null===(n=this.sessionInfo)||void 0===n?void 0:n.queryID)||""),e("log","[realtime] client closed (".concat(this.collectionName," ").concat(this.query,") (watchId ").concat(this.watchId,")")," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:636")},t.prototype.pause=function(){this.watchStatus=i.PAUSED,e("log","[realtime] client paused (".concat(this.collectionName," ").concat(this.query,") (watchId ").concat(this.watchId,")")," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:640")},t.prototype.resume=function(){return h(this,void 0,void 0,(function(){var t;return g(this,(function(n){switch(n.label){case 0:this.watchStatus=i.RESUMING,e("log","[realtime] client resuming with ".concat(this.sessionInfo?"REBUILD_WATCH":"INIT_WATCH"," (").concat(this.collectionName," ").concat(this.query,") (").concat(this.watchId,")")," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:649"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.sessionInfo?this.rebuildWatch():this.initWatch()];case 2:return n.sent(),e("log","[realtime] client successfully resumed (".concat(this.collectionName," ").concat(this.query,") (").concat(this.watchId,")")," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:656"),[3,4];case 3:return t=n.sent(),e("error","[realtime] client resume failed (".concat(this.collectionName," ").concat(this.query,") (").concat(this.watchId,")"),t," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:660"),[3,4];case 4:return[2]}}))}))},t.prototype.useRetryTicket=function(t){return!!(this.availableRetries[t]&&this.availableRetries[t]>0)&&(this.availableRetries[t]-=1,e("log","[realtime] ".concat(t," use a retry ticket, now only ").concat(this.availableRetries[t]," retry left")," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:671"),!0)},t.prototype.handleServerEvents=function(t){return h(this,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.scheduleSendACK(),[4,this.handleServerEventsInternel(t)];case 1:return r.sent(),this.postHandleServerEventsValidityCheck(t),[3,3];case 2:throw n=r.sent(),e("error","[realtime listener] internal non-fatal error: handle server events failed with error: ",n," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:691"),n;case 3:return[2]}}))}))},t.prototype.handleServerEventsInternel=function(t){return h(this,void 0,void 0,(function(){var n,r,i,c,l,p,h,m,_,b,w,S;return g(this,(function(I){switch(I.label){case 0:if(n=t.requestId,r=t.msgData.events,i=t.msgType,!r.length||!this.sessionInfo)return[2];c=this.sessionInfo;try{l=r.map(y)}catch(C){return this.closeWithError(new f.CloudSDKError({errCode:f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:C})),[2]}p=v([],c.currentDocs,!0),h=!1,m=function(r,o){var m,y,b,w,S,I,C,T,O,E,x,P;return g(this,(function(g){switch(g.label){case 0:return m=l[r],c.currentEventId>=m.id?(!l[r-1]||m.id>l[r-1].id?e("warn","[realtime] duplicate event received, cur ".concat(c.currentEventId," but got ").concat(m.id)," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:731"):e("error","[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId ".concat(n,")")," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:734"),[2,"continue"]):[3,1];case 1:if(c.currentEventId!==m.id-1)return[3,2];switch(m.dataType){case"update":if(!m.doc)switch(m.queueType){case"update":case"dequeue":if(y=p.find((function(e){return e._id===m.docId})),y){if(b=(0,u.default)(y),m.updatedFields&&Object.keys(m.updatedFields).forEach((function(e){(0,a.default)(b,e,m.updatedFields[e])})),m.removedFields)for(w=0,S=m.removedFields;w<S.length;w++)I=S[w],(0,s.default)(b,I);m.doc=b}else e("error","[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated."," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:762");break;case"enqueue":throw T=new f.CloudSDKError({errCode:f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId '.concat(t.requestId,")")}),_.closeWithError(T),T;default:break}break;case"replace":if(!m.doc)throw T=new f.CloudSDKError({errCode:f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="replace" (requestId '.concat(t.requestId,")")}),_.closeWithError(T),T;break;case"remove":C=p.find((function(e){return e._id===m.docId})),C?m.doc=C:e("error","[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated."," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:798");break;case"limit":if(!m.doc)switch(m.queueType){case"dequeue":C=p.find((function(e){return e._id===m.docId})),C?m.doc=C:e("error","[realtime listener] internal non-fatal server error: unexpected limit dataType event where no doc is associated."," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:811");break;case"enqueue":throw T=new f.CloudSDKError({errCode:f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="limit" and queueType="enqueue" (requestId '.concat(t.requestId,")")}),_.closeWithError(T),T;default:break}break}switch(m.queueType){case"init":h?p.push(m.doc):(h=!0,p=[m.doc]);break;case"enqueue":p.push(m.doc);break;case"dequeue":O=p.findIndex((function(e){return e._id===m.docId})),O>-1?p.splice(O,1):e("error","[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated."," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:852");break;case"update":O=p.findIndex((function(e){return e._id===m.docId})),O>-1?p[O]=m.doc:e("error","[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated."," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:862");break}return(r===o-1||l[r+1]&&l[r+1].id!==m.id)&&(E=v([],p,!0),x=l.slice(0,r+1).filter((function(e){return e.id===m.id})),_.sessionInfo.currentEventId=m.id,_.sessionInfo.currentDocs=p,P=new d.Snapshot({id:m.id,docChanges:x,docs:E,msgType:i}),_.listener.onChange(P)),[3,4];case 2:return e("warn","[realtime listener] event received is out of order, cur ".concat(_.sessionInfo.currentEventId," but got ").concat(m.id)," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:885"),[4,_.rebuildWatch()];case 3:return g.sent(),[2,{value:void 0}];case 4:return[2]}}))},_=this,b=0,w=l.length,I.label=1;case 1:return b<w?[5,m(b,w)]:[3,4];case 2:if(S=I.sent(),"object"===(0,o.default)(S))return[2,S.value];I.label=3;case 3:return b++,[3,1];case 4:return[2]}}))}))},t.prototype.postHandleServerEventsValidityCheck=function(t){this.sessionInfo?(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<t.msgData.currEvent&&e("warn","[realtime listener] internal non-fatal error: client eventId does not match with server event id after server event handling"," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:923")):e("error","[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur"," at node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js:915")},t.prototype.clearWaitExpectedEvent=function(){this.waitExpectedTimeoutId&&(clearTimeout(this.waitExpectedTimeoutId),this.waitExpectedTimeoutId=void 0)},t}();function y(e){var t={id:e.ID,dataType:e.DataType,queueType:e.QueueType,docId:e.DocID,doc:e.Doc&&"{}"!==e.Doc?JSON.parse(e.Doc):void 0};return"update"===e.DataType&&(e.UpdatedFields&&(t.updatedFields=JSON.parse(e.UpdatedFields)),(e.removedFields||e.RemovedFields)&&(t.removedFields=JSON.parse(e.removedFields))),t}t.VirtualWebSocketClient=m}).call(this,n("f3b9")["default"])},b493:function(e,t,n){"use strict";n.r(t);var r=n("49a0"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},b4d2:function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports["default"]=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},b5de:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={folderSelector:n("84be").default},i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[n("view",{staticClass:e._$s(1,"sc","container"),attrs:{_i:1}},[e._$s(2,"i",e.isLoading)?[n("view",{staticClass:e._$s(3,"sc","loading-container"),attrs:{_i:3}},[n("view",{staticClass:e._$s(4,"sc","loading-text"),attrs:{_i:4}})])]:e._$s(5,"e",e.post&&e.post._id)?[n("view",{class:e._$s(6,"c","post-detail-card "+(e.post.isOriginal?"original-post":"")),attrs:{_i:6}},[n("view",{staticClass:e._$s(7,"sc","author-info"),attrs:{_i:7}},[n("view",{staticClass:e._$s(8,"sc","author-basic"),attrs:{_i:8}},[e._$s(9,"i",e.post.authorAvatar)?n("image",{staticClass:e._$s(9,"sc","author-avatar"),attrs:{src:e._$s(9,"a-src",e.post.authorAvatar),"data-user-id":e._$s(9,"a-data-user-id",e.post._openid),_i:9},on:{error:e.onAvatarError,click:e.navigateToUserProfile}}):e._e(),n("text",{staticClass:e._$s(10,"sc","author-name"),attrs:{_i:10}},[e._v(e._$s(10,"t0-0",e._s(e.post.authorName)))]),e._$s(11,"i",e.isMutualFollow)?n("view",{staticClass:e._$s(11,"sc","mutual-tag"),attrs:{_i:11}}):e._$s(12,"e",e.isFollowedByAuthor)?n("view",{staticClass:e._$s(12,"sc","followed-tag"),attrs:{_i:12}}):e._e()]),e._$s(13,"i",e.showFollowButton)?n("button",{class:e._$s(13,"c","follow-btn "+(e.isFollowing?"following":"")),attrs:{loading:e._$s(13,"a-loading",e.followPending),disabled:e._$s(13,"a-disabled",e.followPending),_i:13},on:{click:e.onFollowTap}},[e._v(e._$s(13,"t0-0",e._s(e.isFollowing?"\u5df2\u5173\u6ce8":"\u5173\u6ce8")))]):e._e()]),n("view",{staticClass:e._$s(14,"sc","post-title"),attrs:{_i:14}},[e._v(e._$s(14,"t0-0",e._s(e.post.title)))]),e._$s(15,"i",e.post.isPoem&&e.post.author)?n("view",{staticClass:e._$s(15,"sc","poem-author"),attrs:{_i:15}},[e._v(e._$s(15,"t0-0",e._s(e.post.author)))]):e._e(),e._$s(16,"i",e.post.content)?n("view",{staticClass:e._$s(16,"sc","post-content"),attrs:{_i:16}},[e._v(e._$s(16,"t0-0",e._s(e.post.content)))]):e._e(),e._$s(17,"i",e.post.tags&&e.post.tags.length>0)?n("view",{staticClass:e._$s(17,"sc","post-tags"),attrs:{_i:17}},e._l(e._$s(18,"f",{forItems:e.post.tags}),(function(t,r,i,o){return n("text",{key:e._$s(18,"f",{forIndex:i,key:r}),staticClass:e._$s("18-"+o,"sc","post-tag"),attrs:{"data-tag":e._$s("18-"+o,"a-data-tag",t),_i:"18-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onTagClick(t)}}},[e._v(e._$s("18-"+o,"t0-0",e._s(t)))])})),0):e._e(),e._$s(19,"i",e.post.imageUrl||e.post.imageUrls&&e.post.imageUrls.length>0)?n("view",{staticClass:e._$s(19,"sc","image-container"),attrs:{id:"detail-image-container",_i:19}},[e._$s(20,"i",e.post.imageUrls&&1===e.post.imageUrls.length)?[n("image",{style:e._$s(21,"s","width: 100%; height: "+(e.post&&e.post._id&&e.imageClampHeights[e.post._id]?e.imageClampHeights[e.post._id]+"px":"auto")+"; object-fit: "+(e.post&&e.post._id&&e.imageClampHeights[e.post._id]?"cover":"contain")+"; background-color: #f0f0f0;"),attrs:{id:e._$s(21,"a-id","single-image-"+(e.post&&e.post._id?e.post._id:"")),src:e._$s(21,"a-src",e.post.imageUrls[0]),mode:e._$s(21,"a-mode",e.post&&e.post._id&&e.imageClampHeights[e.post._id]?"aspectFill":"widthFix"),"data-postid":e._$s(21,"a-data-postid",e.post&&e.post._id?e.post._id:""),"data-src":e._$s(21,"a-data-src",e.post.imageUrls[0]),"data-original-image-urls":e._$s(21,"a-data-original-image-urls",e.post.originalImageUrls||e.post.imageUrls),_i:21},on:{load:e.onImageLoad,error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})]:e._$s(22,"e",e.post.imageUrls&&e.post.imageUrls.length>1)?[n("swiper",{staticClass:e._$s(23,"sc","image-swiper"),style:e._$s(23,"s","width: 100%; height: "+(e.swiperHeights[0]?e.swiperHeights[0]+"px":"220px")+";"),attrs:{id:e._$s(23,"a-id","swiper-"+(e.post&&e.post._id?e.post._id:"")),_i:23}},[e._l(e._$s(24,"f",{forItems:e.post.imageUrls}),(function(t,r,i,o){return[n("swiper-item",{key:e._$s(24,"f",{forIndex:i,keyIndex:0,key:r+"_0"})},[n("image",{attrs:{src:e._$s("26-"+o,"a-src",t),"data-postid":e._$s("26-"+o,"a-data-postid",e.post&&e.post._id?e.post._id:""),"data-imgindex":e._$s("26-"+o,"a-data-imgindex",r),"data-src":e._$s("26-"+o,"a-data-src",t),"data-original-image-urls":e._$s("26-"+o,"a-data-original-image-urls",e.post.originalImageUrls||e.post.imageUrls),_i:"26-"+o},on:{load:e.onImageLoad,error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._e()],2):e._e(),n("view",{staticClass:e._$s(27,"sc","post-meta"),attrs:{_i:27}},[n("text",{staticClass:e._$s(28,"sc","post-time"),attrs:{_i:28}},[e._v(e._$s(28,"t0-0",e._s(e.post.formattedCreateTime)))])]),n("view",{staticClass:e._$s(29,"sc","vote-section"),attrs:{_i:29},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.preventBubble(t)}}},[n("view",{staticClass:e._$s(30,"sc","actions-left"),attrs:{_i:30}},[n("button",{class:e._$s(31,"c",e.favoriteButtonClass),attrs:{_i:31},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onFavorite(t)}}},[e._v(e._$s(31,"t0-0",e._s(e.favoriteButtonText)))])]),n("view",{staticClass:e._$s(32,"sc","button-group"),attrs:{_i:32}},[n("view",{staticClass:e._$s(33,"sc","comment-count"),attrs:{_i:33}},[n("text",{staticClass:e._$s(34,"sc","action-emoji"),attrs:{_i:34}}),n("text",{staticClass:e._$s(35,"sc","action-text"),attrs:{_i:35}},[e._v(e._$s(35,"t0-0",e._s(e.commentCount)))])]),n("view",{staticClass:e._$s(36,"sc","like-icon-container"),attrs:{"data-postid":e._$s(36,"a-data-postid",e.post&&e.post._id?e.post._id:""),_i:36},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onVote(t)}}},[n("image",{staticClass:e._$s(37,"sc","like-icon"),attrs:{src:e._$s(37,"a-src",e.post.likeIcon),_i:37}})]),n("view",{class:e._$s(38,"c","vote-count "+(e.post.isVoted?"voted":"")),attrs:{_i:38}},[n("text",{staticClass:e._$s(39,"sc","action-text"),attrs:{_i:39}},[e._v(e._$s(39,"t0-0",e._s(e.post.votes||0)))])])])])]),n("view",{staticClass:e._$s(40,"sc","comment-section"),attrs:{_i:40}},[n("view",{staticClass:e._$s(41,"sc","section-title"),attrs:{_i:41}},[e._v(e._$s(41,"t0-0",e._s(e.commentCount)))]),n("view",{staticClass:e._$s(42,"sc","comment-list"),attrs:{_i:42}},[e._$s(43,"i",e.comments.length>0)?e._l(e._$s(44,"f",{forItems:e.comments}),(function(t,r,i,o){return n("view",{key:e._$s(44,"f",{forIndex:i,key:r}),staticClass:e._$s("44-"+o,"sc","comment-item"),attrs:{_i:"44-"+o}},[n("image",{staticClass:e._$s("45-"+o,"sc","comment-avatar"),attrs:{src:e._$s("45-"+o,"a-src",t.authorAvatar),"data-user-id":e._$s("45-"+o,"a-data-user-id",t._openid),_i:"45-"+o},on:{error:e.onAvatarError,click:e.navigateToUserProfile}}),n("view",{staticClass:e._$s("46-"+o,"sc","comment-main"),attrs:{_i:"46-"+o}},[n("view",{staticClass:e._$s("47-"+o,"sc","comment-author"),attrs:{_i:"47-"+o}},[e._v(e._$s("47-"+o,"t0-0",e._s(t.authorName)))]),n("view",{staticClass:e._$s("48-"+o,"sc","comment-content"),attrs:{_i:"48-"+o}},[e._v(e._$s("48-"+o,"t0-0",e._s(t.content)))]),e._$s("49-"+o,"i",t.imageUrls&&t.imageUrls.length)?n("view",{staticClass:e._$s("49-"+o,"sc","comment-image-grid"),attrs:{_i:"49-"+o}},e._l(e._$s("50-"+o,"f",{forItems:t.imageUrls}),(function(t,i,a,s){return n("image",{key:e._$s("50-"+o,"f",{forIndex:a,key:i}),staticClass:e._$s("50-"+o+"-"+s,"sc","comment-image"),attrs:{src:e._$s("50-"+o+"-"+s,"a-src",t),"data-comment-index":e._$s("50-"+o+"-"+s,"a-data-comment-index",r),"data-image-index":e._$s("50-"+o+"-"+s,"a-data-image-index",i),_i:"50-"+o+"-"+s},on:{click:e.previewCommentImageFromList}})})),0):e._e(),n("view",{staticClass:e._$s("51-"+o,"sc","comment-footer"),attrs:{_i:"51-"+o}},[n("view",{staticClass:e._$s("52-"+o,"sc","comment-time"),attrs:{_i:"52-"+o}},[e._v(e._$s("52-"+o,"t0-0",e._s(t.formattedCreateTime)))]),n("view",{staticClass:e._$s("53-"+o,"sc","comment-actions"),attrs:{_i:"53-"+o}},[n("view",{staticClass:e._$s("54-"+o,"sc","like-section"),attrs:{"data-comment-id":e._$s("54-"+o,"a-data-comment-id",t._id),"data-liked":e._$s("54-"+o,"a-data-liked",t.liked),_i:"54-"+o},on:{click:e.toggleLikeComment}},[n("image",{staticClass:e._$s("55-"+o,"sc","like-icon"),attrs:{src:e._$s("55-"+o,"a-src",t.likeIcon),_i:"55-"+o}}),n("text",{staticClass:e._$s("56-"+o,"sc","like-count"),attrs:{_i:"56-"+o}},[e._v(e._$s("56-"+o,"t0-0",e._s(t.likes||0)))])]),e._$s("57-"+o,"i",t.canDelete)?n("view",{staticClass:e._$s("57-"+o,"sc","delete-btn"),attrs:{"data-comment-id":e._$s("57-"+o,"a-data-comment-id",t._id),_i:"57-"+o},on:{click:e.onDeleteComment}},[n("text",{staticClass:e._$s("58-"+o,"sc","delete-text"),attrs:{_i:"58-"+o}})]):e._e(),n("view",{staticClass:e._$s("59-"+o,"sc","reply-btn"),attrs:{"data-comment-id":e._$s("59-"+o,"a-data-comment-id",t._id),"data-author-name":e._$s("59-"+o,"a-data-author-name",t.authorName),_i:"59-"+o},on:{click:e.showReplyInput}},[n("text",{staticClass:e._$s("60-"+o,"sc","reply-text"),attrs:{_i:"60-"+o}})])])]),e._$s("61-"+o,"i",t.replies&&t.replies.length>0)?n("view",{staticClass:e._$s("61-"+o,"sc","replies-container"),attrs:{_i:"61-"+o}},[e._l(e._$s("62-"+o,"f",{forItems:t.replies}),(function(i,a,s,u){return e._$s("62-"+o+"-"+u,"i",a<(t.showAllReplies?t.replies.length:3))?n("view",{key:e._$s("62-"+o,"f",{forIndex:s,key:a}),staticClass:e._$s("62-"+o+"-"+u,"sc","reply-item"),attrs:{_i:"62-"+o+"-"+u}},[n("image",{staticClass:e._$s("63-"+o+"-"+u,"sc","reply-avatar"),attrs:{src:e._$s("63-"+o+"-"+u,"a-src",i.authorAvatar),"data-user-id":e._$s("63-"+o+"-"+u,"a-data-user-id",i._openid),_i:"63-"+o+"-"+u},on:{error:e.onAvatarError,click:e.navigateToUserProfile}}),n("view",{staticClass:e._$s("64-"+o+"-"+u,"sc","reply-main"),attrs:{_i:"64-"+o+"-"+u}},[n("view",{staticClass:e._$s("65-"+o+"-"+u,"sc","reply-author"),attrs:{_i:"65-"+o+"-"+u}},[e._v(e._$s("65-"+o+"-"+u,"t0-0",e._s(i.authorName)))]),n("view",{staticClass:e._$s("66-"+o+"-"+u,"sc","reply-content"),attrs:{_i:"66-"+o+"-"+u}},[n("text",{staticClass:e._$s("67-"+o+"-"+u,"sc","reply-to"),attrs:{_i:"67-"+o+"-"+u}},[e._v(e._$s("67-"+o+"-"+u,"t0-0",e._s(t.authorName)))]),n("text",[e._v(e._$s("68-"+o+"-"+u,"t0-0",e._s(i.content)))])]),e._$s("69-"+o+"-"+u,"i",i.imageUrls&&i.imageUrls.length)?n("view",{staticClass:e._$s("69-"+o+"-"+u,"sc","comment-image-grid reply-image-grid"),attrs:{_i:"69-"+o+"-"+u}},e._l(e._$s("70-"+o+"-"+u,"f",{forItems:i.imageUrls}),(function(t,i,s,c){return n("image",{key:e._$s("70-"+o+"-"+u,"f",{forIndex:s,key:i}),staticClass:e._$s("70-"+o+"-"+u+"-"+c,"sc","comment-image"),attrs:{src:e._$s("70-"+o+"-"+u+"-"+c,"a-src",t),"data-comment-index":e._$s("70-"+o+"-"+u+"-"+c,"a-data-comment-index",r),"data-reply-index":e._$s("70-"+o+"-"+u+"-"+c,"a-data-reply-index",a),"data-image-index":e._$s("70-"+o+"-"+u+"-"+c,"a-data-image-index",i),_i:"70-"+o+"-"+u+"-"+c},on:{click:e.previewCommentImageFromList}})})),0):e._e(),n("view",{staticClass:e._$s("71-"+o+"-"+u,"sc","reply-footer"),attrs:{_i:"71-"+o+"-"+u}},[n("view",{staticClass:e._$s("72-"+o+"-"+u,"sc","reply-time"),attrs:{_i:"72-"+o+"-"+u}},[e._v(e._$s("72-"+o+"-"+u,"t0-0",e._s(i.formattedCreateTime)))]),n("view",{staticClass:e._$s("73-"+o+"-"+u,"sc","reply-actions"),attrs:{_i:"73-"+o+"-"+u}},[n("view",{staticClass:e._$s("74-"+o+"-"+u,"sc","like-section"),attrs:{"data-comment-id":e._$s("74-"+o+"-"+u,"a-data-comment-id",i._id),"data-liked":e._$s("74-"+o+"-"+u,"a-data-liked",i.liked),_i:"74-"+o+"-"+u},on:{click:e.toggleLikeComment}},[n("image",{staticClass:e._$s("75-"+o+"-"+u,"sc","like-icon"),attrs:{src:e._$s("75-"+o+"-"+u,"a-src",i.likeIcon),_i:"75-"+o+"-"+u}}),n("text",{staticClass:e._$s("76-"+o+"-"+u,"sc","like-count"),attrs:{_i:"76-"+o+"-"+u}},[e._v(e._$s("76-"+o+"-"+u,"t0-0",e._s(i.likes||0)))])]),e._$s("77-"+o+"-"+u,"i",i.canDelete)?n("view",{staticClass:e._$s("77-"+o+"-"+u,"sc","delete-btn"),attrs:{"data-comment-id":e._$s("77-"+o+"-"+u,"a-data-comment-id",i._id),"data-parent-id":e._$s("77-"+o+"-"+u,"a-data-parent-id",t._id),_i:"77-"+o+"-"+u},on:{click:e.onDeleteComment}},[n("text",{staticClass:e._$s("78-"+o+"-"+u,"sc","delete-text"),attrs:{_i:"78-"+o+"-"+u}})]):e._e(),n("view",{staticClass:e._$s("79-"+o+"-"+u,"sc","reply-btn"),attrs:{"data-comment-id":e._$s("79-"+o+"-"+u,"a-data-comment-id",t._id),"data-author-name":e._$s("79-"+o+"-"+u,"a-data-author-name",i.authorName),_i:"79-"+o+"-"+u},on:{click:e.showReplyInput}},[n("text",{staticClass:e._$s("80-"+o+"-"+u,"sc","reply-text"),attrs:{_i:"80-"+o+"-"+u}})])])])])]):e._e()})),e._$s("81-"+o,"i",t.replies.length>3&&!t.showAllReplies)?n("view",{staticClass:e._$s("81-"+o,"sc","show-more-replies"),attrs:{"data-comment-id":e._$s("81-"+o,"a-data-comment-id",t._id),_i:"81-"+o},on:{click:e.toggleShowAllReplies}},[n("text",{staticClass:e._$s("82-"+o,"sc","show-more-text"),attrs:{_i:"82-"+o}},[e._v(e._$s("82-"+o,"t0-0",e._s(t.replies.length-3)))])]):e._e(),e._$s("83-"+o,"i",t.replies.length>3&&t.showAllReplies)?n("view",{staticClass:e._$s("83-"+o,"sc","show-more-replies"),attrs:{"data-comment-id":e._$s("83-"+o,"a-data-comment-id",t._id),_i:"83-"+o},on:{click:e.toggleShowAllReplies}},[n("text",{staticClass:e._$s("84-"+o,"sc","show-more-text"),attrs:{_i:"84-"+o}})]):e._e()],2):e._e()])])})):[n("view",{staticClass:e._$s(86,"sc","no-comment-tip"),attrs:{_i:86}},[n("view",{staticClass:e._$s(87,"sc","empty-icon"),attrs:{_i:87}}),n("view",{staticClass:e._$s(88,"sc","empty-text"),attrs:{_i:88}})])]],2)])]:[n("view",{staticClass:e._$s(90,"sc","error-container"),attrs:{_i:90}},[n("view",{staticClass:e._$s(91,"sc","error-icon"),attrs:{_i:91}}),n("view",{staticClass:e._$s(92,"sc","error-text"),attrs:{_i:92}})])]],2),n("view",{class:e._$s(93,"c","input-overlay "+(e.isInputExpanded?"show":"")),attrs:{_i:93},on:{click:e.collapseInput}}),n("view",{staticClass:e._$s(94,"sc","comment-input-area"),style:e._$s(94,"s","bottom: "+e.keyboardHeight+"px;"),attrs:{_i:94}},[e._$s(95,"i",!e.isInputExpanded)?n("view",{staticClass:e._$s(95,"sc","collapsed-bar"),attrs:{_i:95},on:{click:e.expandInput}},[n("view",{staticClass:e._$s(96,"sc","collapsed-input-placeholder"),attrs:{_i:96}})]):e._e(),e._$s(97,"i",e.isInputExpanded)?n("view",{staticClass:e._$s(97,"sc","expanded-container"),attrs:{_i:97}},[e._$s(98,"i",e.replyToComment)?n("view",{staticClass:e._$s(98,"sc","reply-prompt"),attrs:{_i:98}},[n("text",{staticClass:e._$s(99,"sc","reply-prompt-text"),attrs:{_i:99}},[e._v(e._$s(99,"t0-0",e._s(e.replyToAuthor)))]),n("view",{staticClass:e._$s(100,"sc","cancel-reply"),attrs:{_i:100},on:{click:e.cancelReply}},[n("text",{staticClass:e._$s(101,"sc","cancel-text"),attrs:{_i:101}})])]):e._e(),n("textarea",{staticClass:e._$s(102,"sc","expanded-textarea"),attrs:{value:e._$s(102,"a-value",e.newComment),focus:e._$s(102,"a-focus",e.isFocus),_i:102},on:{input:e.onCommentInput,focus:e.onInputFocus,blur:e.onInputBlur}}),e._$s(103,"i",e.commentImages.length)?n("view",{staticClass:e._$s(103,"sc","selected-comment-images"),attrs:{_i:103}},e._l(e._$s(104,"f",{forItems:e.commentImages}),(function(t,r,i,o){return n("view",{key:e._$s(104,"f",{forIndex:i,key:r}),staticClass:e._$s("104-"+o,"sc","selected-image-item"),attrs:{"data-index":e._$s("104-"+o,"a-data-index",r),_i:"104-"+o}},[n("image",{staticClass:e._$s("105-"+o,"sc","selected-image-thumb"),attrs:{src:e._$s("105-"+o,"a-src",t.previewUrl),"data-index":e._$s("105-"+o,"a-data-index",r),_i:"105-"+o},on:{click:e.previewSelectedCommentImage}}),n("view",{staticClass:e._$s("106-"+o,"sc","remove-image-btn"),attrs:{"data-index":e._$s("106-"+o,"a-data-index",r),_i:"106-"+o},on:{click:e.removeCommentImage}})])})),0):e._e(),n("view",{staticClass:e._$s(107,"sc","expanded-actions"),attrs:{_i:107}},[n("view",{staticClass:e._$s(108,"sc","action-icons"),attrs:{_i:108}},[n("view",{staticClass:e._$s(109,"sc","action-icon"),attrs:{_i:109},on:{click:e.chooseCommentImages}},[n("text",{staticClass:e._$s(110,"sc","action-icon-text"),attrs:{_i:110}})]),n("view",{staticClass:e._$s(111,"sc","action-icon"),attrs:{_i:111},on:{click:e.toggleEmojiPanel}},[n("text",{staticClass:e._$s(112,"sc","action-icon-text"),attrs:{_i:112}})])]),n("button",{staticClass:e._$s(113,"sc","submit-button"),attrs:{disabled:e._$s(113,"a-disabled",e.isSubmitDisabled),_i:113},on:{click:e.onSubmitComment}})]),e._$s(114,"i",e.showEmojiPanel)?n("view",{staticClass:e._$s(114,"sc","emoji-panel"),attrs:{_i:114}},e._l(e._$s(115,"f",{forItems:e.emojiList}),(function(t,r,i,o){return n("text",{key:e._$s(115,"f",{forIndex:i,key:r}),staticClass:e._$s("115-"+o,"sc","emoji-item"),attrs:{"data-emoji":e._$s("115-"+o,"a-data-emoji",t),_i:"115-"+o},on:{click:e.insertEmoji}},[e._v(e._$s("115-"+o,"t0-0",e._s(t)))])})),0):e._e()]):e._e()]),n("cloud-tip-modal",{attrs:{showUploadTip:e.showUploadTip,_i:116}}),n("folder-selector",{attrs:{show:e.showFavoriteModal,"post-id":e.post&&e.post._id?e.post._id:"",_i:117},on:{hide:e.hideFavoriteModal,favoriteSuccess:e.onFavoriteSuccess}})],1)},o=[]},b6fd:function(e,t,n){var r=n("8b83"),i=n("9f0d");e.exports=function(e,t,n,o){var a=!n;n||(n={});var s=-1,u=t.length;while(++s<u){var c=t[s],l=o?o(n[c],e[c],c,n,e):void 0;void 0===l&&(l=e[c]),a?i(n,c,l):r(n,c,l)}return n}},b7ca:function(e,t,n){var r=n("edee"),i=n("1b45"),o=n("6c67");e.exports=function(e){return o(e)?r(e,!0):i(e)}},b7d4:function(e,t,n){var r=n("67cf");e.exports=function(e,t){if(null==e)return{};var n,i,o=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.__esModule=!0,e.exports["default"]=e.exports},b817:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[n("view",{staticClass:e._$s(1,"sc","container"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","title"),attrs:{_i:2}}),n("view",{staticClass:e._$s(3,"sc","subtitle"),attrs:{_i:3}}),n("view",{staticClass:e._$s(4,"sc","form-wrapper"),attrs:{_i:4}},[n("view",{staticClass:e._$s(5,"sc","input-wrapper"),attrs:{_i:5}},[n("text",{staticClass:e._$s(6,"sc","input-label"),attrs:{_i:6}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.poemId,expression:"poemId"}],staticClass:e._$s(7,"sc","input-field"),attrs:{_i:7},domProps:{value:e._$s(7,"v-model",e.poemId)},on:{input:[function(t){t.target.composing||(e.poemId=t.target.value)},e.onPoemIdInput]}})]),n("view",{staticClass:e._$s(8,"sc","input-wrapper"),attrs:{_i:8}},[n("text",{staticClass:e._$s(9,"sc","input-label"),attrs:{_i:9}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:e._$s(10,"sc","input-field"),attrs:{_i:10},domProps:{value:e._$s(10,"v-model",e.password)},on:{input:[function(t){t.target.composing||(e.password=t.target.value)},e.onPasswordInput]}})]),n("button",{staticClass:e._$s(11,"sc","login-button"),class:e._$s(11,"c",{loading:e.isLogging}),attrs:{disabled:e._$s(11,"a-disabled",!e.canLogin||e.isLogging),_i:11},on:{click:e.onLogin}},[e._v(e._$s(11,"t0-0",e._s(e.isLogging?"\u767b\u5f55\u4e2d...":"\u767b\u5f55")))]),n("view",{staticClass:e._$s(12,"sc","register-link-wrapper"),attrs:{_i:12}},[n("text",{staticClass:e._$s(13,"sc","register-text"),attrs:{_i:13}}),n("text",{staticClass:e._$s(14,"sc","register-link"),attrs:{_i:14},on:{click:e.goToRegister}})])])])])},i=[]},b828:function(e,t,n){var r=n("6c88"),i=n("51b8");e.exports=function(e,t){t=r(t,e);var n=0,o=t.length;while(null!=e&&n<o)e=e[i(t[n++])];return n&&n==o?e:void 0}},b83f:function(e,t,n){"use strict";n.r(t);var r=n("4ec1"),i=n("22c0");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},b88a:function(e,t){e.exports=function(e,t){var n=-1,r=t.length,i=e.length;while(++n<r)e[i+n]=t[n];return e}},b893:function(e,t){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports["default"]=e.exports},b8a7:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[e._$s(1,"i",e.isLoading)?n("view",{staticClass:e._$s(1,"sc","loading-container"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","loading-text"),attrs:{_i:2}})]):e._$s(3,"e",e.folders.length>0)?n("view",{staticClass:e._$s(3,"sc","folders-container"),attrs:{_i:3}},e._l(e._$s(4,"f",{forItems:e.folders}),(function(t,r,i,o){return n("view",{key:e._$s(4,"f",{forIndex:i,key:r}),staticClass:e._$s("4-"+o,"sc","folder-item"),attrs:{"data-folder-id":e._$s("4-"+o,"a-data-folder-id",t._id),"data-folder-name":e._$s("4-"+o,"a-data-folder-name",t.name),_i:"4-"+o},on:{longpress:e.onFolderLongPress,click:e.enterFolder}},[n("view",{staticClass:e._$s("5-"+o,"sc","folder-icon"),attrs:{_i:"5-"+o}}),n("view",{staticClass:e._$s("6-"+o,"sc","folder-info"),attrs:{_i:"6-"+o}},[n("view",{staticClass:e._$s("7-"+o,"sc","folder-name"),attrs:{_i:"7-"+o}},[e._v(e._$s("7-"+o,"t0-0",e._s(t.name)))]),n("view",{staticClass:e._$s("8-"+o,"sc","folder-meta"),attrs:{_i:"8-"+o}},[n("text",{staticClass:e._$s("9-"+o,"sc","item-count"),attrs:{_i:"9-"+o}},[e._v(e._$s("9-"+o,"t0-0",e._s(t.itemCount)))]),n("text",{staticClass:e._$s("10-"+o,"sc","create-time"),attrs:{_i:"10-"+o}},[e._v(e._$s("10-"+o,"t0-0",e._s(t.createTime)))])])]),n("view",{staticClass:e._$s("11-"+o,"sc","folder-arrow"),attrs:{_i:"11-"+o}})])})),0):n("view",{staticClass:e._$s(12,"sc","empty-container"),attrs:{_i:12}},[n("view",{staticClass:e._$s(13,"sc","empty-icon"),attrs:{_i:13}}),n("view",{staticClass:e._$s(14,"sc","empty-text"),attrs:{_i:14}}),n("view",{staticClass:e._$s(15,"sc","empty-subtext"),attrs:{_i:15}})]),n("view",{staticClass:e._$s(16,"sc","create-button"),attrs:{_i:16},on:{click:e.showCreateFolder}},[n("view",{staticClass:e._$s(17,"sc","create-icon"),attrs:{_i:17}}),n("text")]),e._$s(19,"i",e.showCreateModal)?n("view",{staticClass:e._$s(19,"sc","modal-overlay"),attrs:{_i:19}},[n("view",{staticClass:e._$s(20,"sc","modal-content"),attrs:{_i:20}},[n("view",{staticClass:e._$s(21,"sc","modal-title"),attrs:{_i:21}}),n("input",{staticClass:e._$s(22,"sc","modal-input"),attrs:{value:e._$s(22,"a-value",e.newFolderName),_i:22},on:{input:e.onFolderNameInput,click:function(t){return t.stopPropagation(),t.preventDefault(),e.trueFun(t)}}}),n("view",{staticClass:e._$s(23,"sc","modal-buttons"),attrs:{_i:23}},[n("button",{staticClass:e._$s(24,"sc","modal-btn cancel-btn"),attrs:{_i:24},on:{click:e.hideCreateModal}}),n("button",{staticClass:e._$s(25,"sc","modal-btn confirm-btn"),attrs:{_i:25},on:{click:e.createFolder}})])])]):e._e(),e._$s(26,"i",e.showEditModal)?n("view",{staticClass:e._$s(26,"sc","modal-overlay"),attrs:{_i:26}},[n("view",{staticClass:e._$s(27,"sc","modal-content"),attrs:{_i:27}},[n("view",{staticClass:e._$s(28,"sc","modal-title"),attrs:{_i:28}}),n("input",{staticClass:e._$s(29,"sc","modal-input"),attrs:{value:e._$s(29,"a-value",e.editFolderName),_i:29},on:{input:e.onEditFolderNameInput,click:function(t){return t.stopPropagation(),t.preventDefault(),e.trueFun(t)}}}),n("view",{staticClass:e._$s(30,"sc","modal-buttons"),attrs:{_i:30}},[n("button",{staticClass:e._$s(31,"sc","modal-btn cancel-btn"),attrs:{_i:31},on:{click:e.hideEditModal}}),n("button",{staticClass:e._$s(32,"sc","modal-btn confirm-btn"),attrs:{_i:32},on:{click:e.updateFolderName}})])])]):e._e()])},i=[]},b8b8:function(e,t,n){var r=n("3644"),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(u){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},b8e2:function(e,t,n){"use strict";var r=n("3b2d");Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"CollectionReference",{enumerable:!0,get:function(){return o.CollectionReference}}),t.Db=void 0,Object.defineProperty(t,"DocumentReference",{enumerable:!0,get:function(){return h.DocumentReference}}),Object.defineProperty(t,"Query",{enumerable:!0,get:function(){return p.Query}});var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(i,a,s):i[a]=e[a]}i.default=e,n&&n.set(e,i);return i}(n("e775")),o=n("e0b7"),a=n("aa90"),s=n("d137"),u=n("a383"),c=n("7c29"),l=n("c9ca"),d=n("3b92"),f=n("3325"),p=n("5e49"),h=n("e6b4");function g(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}var v=function(){function e(e){this.config=e,this.Geo=i,this.serverDate=s.ServerDateConstructor,this.command=a.Command,this.RegExp=u.RegExpConstructor,this.startTransaction=c.startTransaction,this.runTransaction=c.runTransaction,this.logicCommand=l.LogicCommand,this.updateCommand=f.UpdateCommand,this.queryCommand=d.QueryCommand}return e.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new o.CollectionReference(this,e)},e.prototype.createCollection=function(t){var n=new e.reqClass(this.config),r={collectionName:t};return n.send("database.addCollection",r)},e}();t.Db=v},b8f2:function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.Polygon=void 0;var i=r(n("3b2d")),o=n("a4d5"),a=n("8539"),s=n("2152"),u=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=function(){function e(e){if(!(0,a.isArray)(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+(0,i.default)(e));if(0===e.length)throw new Error("Polygon must contain 1 linestring at least");e.forEach((function(e){if(!(e instanceof s.LineString))throw new TypeError('"lines" must be of type LineString[]. Received type '+(0,i.default)(e)+"[]");if(!s.LineString.isClosed(e))throw new Error("LineString "+e.points.map((function(e){return e.toReadableString()}))+" is not a closed cycle")})),this.lines=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"Polygon",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))},t},e.prototype.toJSON=function(){return{type:"Polygon",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}},e.validate=function(e){var t,n,r,i;if("Polygon"!==e.type||!(0,a.isArray)(e.coordinates))return!1;try{for(var o=u(e.coordinates),s=o.next();!s.done;s=o.next()){var c=s.value;if(!this.isCloseLineString(c))return!1;try{for(var l=(r=void 0,u(c)),d=l.next();!d.done;d=l.next()){var f=d.value;if(!(0,a.isNumber)(f[0])||!(0,a.isNumber)(f[1]))return!1}}catch(p){r={error:p}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}}catch(h){t={error:h}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0},e.isCloseLineString=function(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]},Object.defineProperty(e.prototype,"_internalType",{get:function(){return o.SYMBOL_GEO_MULTI_POLYGON},enumerable:!0,configurable:!0}),e}();t.Polygon=c},b99c:function(e,t,n){(function(t){var r=n("67ad"),i=n("0bdb"),o=function(){"use strict";function e(){r(this,e),this.defaultExpiry=3e5}return i(e,[{key:"set",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaultExpiry;try{var i={data:n,timestamp:Date.now(),expiry:r};return uni.setStorageSync(e,i),!0}catch(o){return t("log","CatchClause",o," at utils/dataCache.js:18"),t("log","CatchClause",o," at utils/dataCache.js:19"),t("error","\u7f13\u5b58\u8bbe\u7f6e\u5931\u8d25:",o," at utils/dataCache.js:20"),!1}}},{key:"get",value:function(e){try{var n=uni.getStorageSync(e);if(!n)return null;var r=Date.now();return r-n.timestamp>n.expiry?(this.remove(e),null):n.data}catch(i){return t("log","CatchClause",i," at utils/dataCache.js:40"),t("log","CatchClause",i," at utils/dataCache.js:41"),t("error","\u7f13\u5b58\u83b7\u53d6\u5931\u8d25:",i," at utils/dataCache.js:42"),null}}},{key:"remove",value:function(e){try{return uni.removeStorageSync(e),!0}catch(n){return t("log","CatchClause",n," at utils/dataCache.js:53"),t("log","CatchClause",n," at utils/dataCache.js:54"),t("error","\u7f13\u5b58\u5220\u9664\u5931\u8d25:",n," at utils/dataCache.js:55"),!1}}},{key:"has",value:function(e){return null!==this.get(e)}},{key:"clear",value:function(){var e=this;try{return["index_postList_cache","poem_postList_cache","mountain_postList_cache"].forEach((function(t){return e.remove(t)})),!0}catch(n){return t("log","CatchClause",n," at utils/dataCache.js:72"),t("log","CatchClause",n," at utils/dataCache.js:73"),t("error","\u7f13\u5b58\u6e05\u7406\u5931\u8d25:",n," at utils/dataCache.js:74"),!1}}},{key:"setAvatarCache",value:function(e,t){var n="avatar_".concat(e);return this.set(n,t,864e5)}},{key:"getAvatarCache",value:function(e){var t="avatar_".concat(e);return this.get(t)}},{key:"setFollowStatusCache",value:function(e,t,n){var r="follow_".concat(e,"_").concat(t);return this.set(r,n,36e5)}},{key:"getFollowStatusCache",value:function(e,t){var n="follow_".concat(e,"_").concat(t);return this.get(n)}},{key:"getBatchAvatarCache",value:function(e){var t=this,n={};return e.forEach((function(e){var r=t.getAvatarCache(e);r&&(n[e]=r)})),n}},{key:"getBatchFollowStatusCache",value:function(e,t){var n=this,r={};return t.forEach((function(t){var i=n.getFollowStatusCache(e,t);i&&(r[t]=i)})),r}},{key:"clearUserCache",value:function(e){var n=this;try{this.remove("avatar_".concat(e));var r=uni.getStorageInfoSync().keys;return r.forEach((function(t){t.startsWith("follow_")&&t.includes("_".concat(e))&&n.remove(t)})),!0}catch(i){return t("log","CatchClause",i," at utils/dataCache.js:140"),t("log","CatchClause",i," at utils/dataCache.js:141"),t("error","\u6e05\u7406\u7528\u6237\u7f13\u5b58\u5931\u8d25:",i," at utils/dataCache.js:142"),!1}}},{key:"updatePostLikeInCache",value:function(e,n,r,i){var o=this;try{return["index_postList_cache","poem_postList_cache","mountain_postList_cache"].forEach((function(a){var s=o.get(a);if(s&&Array.isArray(s)){var u=s.findIndex((function(t){return t._id===e}));u>-1&&(s[u].votes=n,s[u].isVoted=r,s[u].likeIcon=i,o.set(a,s),t("log","\u3010\u7f13\u5b58\u66f4\u65b0\u3011".concat(a," \u4e2d\u7684\u5e16\u5b50 ").concat(e," \u70b9\u8d5e\u4fe1\u606f\u5df2\u66f4\u65b0")," at utils/dataCache.js:161"))}})),!0}catch(a){return t("log","CatchClause",a," at utils/dataCache.js:167"),t("log","CatchClause",a," at utils/dataCache.js:168"),t("error","\u66f4\u65b0\u5e16\u5b50\u70b9\u8d5e\u7f13\u5b58\u5931\u8d25:",a," at utils/dataCache.js:169"),!1}}}]),e}(),a=new o;e.exports=a}).call(this,n("f3b9")["default"])},b9dc:function(e,t,n){"use strict";n.r(t);var r=n("c855"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},b9ef:function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},b9ff:function(e,t,n){"use strict";(function(e,r,i,o){var a=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.UUID=t.Timestamp=t.ObjectId=t.ObjectID=t.MinKey=t.MaxKey=t.Map=t.LongWithoutOverridesClass=t.Long=t.Int32=t.EJSON=t.Double=t.Decimal128=t.DBRef=t.Code=t.Binary=t.BSON_INT64_MIN=t.BSON_INT64_MAX=t.BSON_INT32_MIN=t.BSON_INT32_MAX=t.BSON_DATA_UNDEFINED=t.BSON_DATA_TIMESTAMP=t.BSON_DATA_SYMBOL=t.BSON_DATA_STRING=t.BSON_DATA_REGEXP=t.BSON_DATA_OID=t.BSON_DATA_OBJECT=t.BSON_DATA_NUMBER=t.BSON_DATA_NULL=t.BSON_DATA_MIN_KEY=t.BSON_DATA_MAX_KEY=t.BSON_DATA_LONG=t.BSON_DATA_INT=t.BSON_DATA_DECIMAL128=t.BSON_DATA_DBPOINTER=t.BSON_DATA_DATE=t.BSON_DATA_CODE_W_SCOPE=t.BSON_DATA_CODE=t.BSON_DATA_BOOLEAN=t.BSON_DATA_BINARY=t.BSON_DATA_ARRAY=t.BSON_BINARY_SUBTYPE_UUID_NEW=t.BSON_BINARY_SUBTYPE_UUID=t.BSON_BINARY_SUBTYPE_USER_DEFINED=t.BSON_BINARY_SUBTYPE_MD5=t.BSON_BINARY_SUBTYPE_FUNCTION=t.BSON_BINARY_SUBTYPE_ENCRYPTED=t.BSON_BINARY_SUBTYPE_DEFAULT=t.BSON_BINARY_SUBTYPE_COLUMN=t.BSON_BINARY_SUBTYPE_BYTE_ARRAY=t.BSONTypeError=t.BSONSymbol=t.BSONRegExp=t.BSONError=void 0,t.calculateObjectSize=It,t.default=void 0,t.deserialize=St,t.deserializeStream=Ct,t.serialize=bt,t.serializeWithBufferAndIndex=wt,t.setInternalBufferSize=_t;var s=a(n("3b2d"));for(var u=function(e){var t=m(e),n=t[0],r=t[1];return 3*(n+r)/4-r},c=function(e){var t,n,r=m(e),i=r[0],o=r[1],a=new p(function(e,t,n){return 3*(t+n)/4-n}(0,i,o)),s=0,u=o>0?i-4:i;for(n=0;n<u;n+=4)t=f[e.charCodeAt(n)]<<18|f[e.charCodeAt(n+1)]<<12|f[e.charCodeAt(n+2)]<<6|f[e.charCodeAt(n+3)],a[s++]=t>>16&255,a[s++]=t>>8&255,a[s++]=255&t;2===o&&(t=f[e.charCodeAt(n)]<<2|f[e.charCodeAt(n+1)]>>4,a[s++]=255&t);1===o&&(t=f[e.charCodeAt(n)]<<10|f[e.charCodeAt(n+1)]<<4|f[e.charCodeAt(n+2)]>>2,a[s++]=t>>8&255,a[s++]=255&t);return a},l=function(e){for(var t,n=e.length,r=n%3,i=[],o=0,a=n-r;o<a;o+=16383)i.push(_(e,o,o+16383>a?a:o+16383));1===r?(t=e[n-1],i.push(d[t>>2]+d[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(d[t>>10]+d[t>>4&63]+d[t<<2&63]+"="));return i.join("")},d=[],f=[],p="undefined"!==typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,v=h.length;g<v;++g)d[g]=h[g],f[h.charCodeAt(g)]=g;function m(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function y(e){return d[e>>18&63]+d[e>>12&63]+d[e>>6&63]+d[63&e]}function _(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(y(r));return i.join("")}f["-".charCodeAt(0)]=62,f["_".charCodeAt(0)]=63;var b={byteLength:u,toByteArray:c,fromByteArray:l},w={read:function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+d],d+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=c}return(p?-1:1)*a*Math.pow(2,o-r)},write:function(e,t,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,h=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),t+=a+d>=1?f/u:f*Math.pow(2,1-d),t*u>=2&&(a++,u/=2),a+d>=l?(s=0,a=l):a+d>=1?(s=(t*u-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=h,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+p]=255&a,p+=h,a/=256,c-=8);e[n+p-h]|=128*g}},S=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}((function(t,n){var r="function"===typeof Symbol&&"function"===typeof Symbol["for"]?Symbol["for"]("nodejs.util.inspect.custom"):null;n.Buffer=o,n.SlowBuffer=function(e){+e!=e&&(e=0);return o.alloc(+e)},n.INSPECT_MAX_BYTES=50;function i(e){if(e>2147483647)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,n){if("number"===typeof e){if("string"===typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return a(e,t,n)}function a(e,t,n){if("string"===typeof e)return function(e,t){"string"===typeof t&&""!==t||(t="utf8");if(!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|f(e,t),r=i(n),a=r.write(e,t);a!==n&&(r=r.slice(0,a));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(U(e,Uint8Array)){var t=new Uint8Array(e);return l(t.buffer,t.byteOffset,t.byteLength)}return c(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers["typeof"](e));if(U(e,ArrayBuffer)||e&&U(e.buffer,ArrayBuffer))return l(e,t,n);if("undefined"!==typeof SharedArrayBuffer&&(U(e,SharedArrayBuffer)||e&&U(e.buffer,SharedArrayBuffer)))return l(e,t,n);if("number"===typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return o.from(r,t,n);var a=function(e){if(o.isBuffer(e)){var t=0|d(e.length),n=i(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!==typeof e.length||F(e.length)?i(0):c(e);if("Buffer"===e.type&&Array.isArray(e.data))return c(e.data)}(e);if(a)return a;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers["typeof"](e))}function s(e){if("number"!==typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return s(e),i(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=i(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function l(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,o.prototype),r}function d(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||U(e,ArrayBuffer))return e.byteLength;if("string"!==typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers["typeof"](e));var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return M(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return $(e).length;default:if(i)return r?-1:M(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";e||(e="utf8");while(1)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function h(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,F(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"===typeof t)return t&=255,"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var o,a=1,s=e.length,u=t.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var d=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){d=!1;break}if(d)return o}return-1}function m(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var o=t.length;r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(F(s))return a;e[n+a]=s}return a}function y(e,t,n,r){return j(M(t,e.length-n),e,n,r)}function _(e,t,n,r){return j(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return j($(t),e,n,r)}function I(e,t,n,r){return j(function(e,t){for(var n,r,i,o=[],a=0;a<e.length;++a){if((t-=2)<0)break;n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r)}return o}(t,e.length-n),e,n,r)}function C(e,t,n){return 0===t&&n===e.length?b.fromByteArray(e):b.fromByteArray(e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);var r=[],i=t;while(i<n){var o,a,s,u,c=e[i],l=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=n)switch(d){case 1:c<128&&(l=c);break;case 2:o=e[i+1],128===(192&o)&&(u=(31&c)<<6|63&o,u>127&&(l=u));break;case 3:o=e[i+1],a=e[i+2],128===(192&o)&&128===(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a,u>2047&&(u<55296||u>57343)&&(l=u));break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128===(192&o)&&128===(192&a)&&128===(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s,u>65535&&u<1114112&&(l=u))}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;while(r<t)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}n.kMaxLength=2147483647,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(n){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||e("error","This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."," at node_modules/bson/dist/bson.browser.esm.js:252"),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,n){return a(e,t,n)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,n){return function(e,t,n){return s(e),e<=0?i(e):void 0!==t?"string"===typeof n?i(e).fill(t,n):i(e).fill(t):i(e)}(e,t,n)},o.allocUnsafe=function(e){return u(e)},o.allocUnsafeSlow=function(e){return u(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(U(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),U(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(U(a,Uint8Array))i+a.length>r.length?o.from(a).copy(r,i):Uint8Array.prototype.set.call(r,a,i);else{if(!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i)}i+=a.length}return r},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=function(e,t,n,r,i){if(U(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers["typeof"](e));if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var a=i-r,s=n-t,u=Math.min(a,s),c=this.slice(r,i),l=e.slice(t,n),d=0;d<u;++d)if(c[d]!==l[d]){a=c[d],s=l[d];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return m(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":case"latin1":case"binary":return _(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function x(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=B[e[o]];return i}function P(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length-1;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function k(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,r,i,a){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function R(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(e,t,n,r,i){return t=+t,n>>>=0,i||R(e,0,n,4),w.write(e,t,n,r,23,4),n+4}function L(e,t,n,r,i){return t=+t,n>>>=0,i||R(e,0,n,8),w.write(e,t,n,r,52,8),n+8}o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,o.prototype),r},o.prototype.readUintLE=o.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);var r=this[e],i=1,o=0;while(++o<t&&(i*=256))r+=this[e+o]*i;return r},o.prototype.readUintBE=o.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);var r=this[e+--t],i=1;while(t>0&&(i*=256))r+=this[e+--t]*i;return r},o.prototype.readUint8=o.prototype.readUInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),this[e]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);var r=this[e],i=1,o=0;while(++o<t&&(i*=256))r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);var r=t,i=1,o=this[e+--r];while(r>0&&(i*=256))o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){e>>>=0,t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||k(e,4,this.length),w.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||k(e,4,this.length),w.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||k(e,8,this.length),w.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||k(e,8,this.length),w.read(this,e,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;A(this,e,t,n,i,0)}var o=1,a=0;this[t]=255&e;while(++a<n&&(o*=256))this[t+a]=e/o&255;return t+n},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;A(this,e,t,n,i,0)}var o=n-1,a=1;this[t+o]=255&e;while(--o>=0&&(a*=256))this[t+o]=e/a&255;return t+n},o.prototype.writeUint8=o.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;this[t]=255&e;while(++o<n&&(a*=256))e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;this[t+o]=255&e;while(--o>=0&&(a*=256))e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,n){return D(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return D(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;return this===e&&"function"===typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},o.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"===typeof e?e&=255:"boolean"===typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(a=t;a<n;++a)this[a]=e;else{var s=o.isBuffer(e)?e:o.from(e,r),u=s.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<n-t;++a)this[a+t]=s[a%u]}return this};var N=/[^+/0-9A-Za-z-_]/g;function M(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if(n=e.charCodeAt(a),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function $(e){return b.toByteArray(function(e){if(e=e.split("=")[0],e=e.trim().replace(N,""),e.length<2)return"";while(e.length%4!==0)e+="=";return e}(e))}function j(e,t,n,r){for(var i=0;i<r;++i){if(i+n>=t.length||i>=e.length)break;t[i+n]=e[i]}return i}function U(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function F(e){return e!==e}var B=function(){for(var e=new Array(256),t=0;t<16;++t)for(var n=16*t,r=0;r<16;++r)e[n+r]="0123456789abcdef"[t]+"0123456789abcdef"[r];return e}()})),I=S.Buffer;
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */S.SlowBuffer,S.INSPECT_MAX_BYTES,S.kMaxLength;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var C=function(e,t){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},C(e,t)};function T(e,t){function n(){this.constructor=e}C(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var O=function(){return O=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},O.apply(this,arguments)},E=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return T(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),t}(Error);t.BSONError=E;var x=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return T(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),t}(TypeError);function P(e){return e&&e.Math==Math&&e}function k(){return P("object"===("undefined"===typeof globalThis?"undefined":(0,s.default)(globalThis))&&globalThis)||P("object"===("undefined"===typeof window?"undefined":(0,s.default)(window))&&window)||P("object"===("undefined"===typeof self?"undefined":(0,s.default)(self))&&self)||P("object"===("undefined"===typeof r?"undefined":(0,s.default)(r))&&r)||Function("return this")()}function A(e){return e.toString().replace("function(","function (")}t.BSONTypeError=x;var R=function(t){var n=function(){var e=k();return"object"===(0,s.default)(e.navigator)&&"ReactNative"===e.navigator.product}()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";e("warn",n," at node_modules/bson/dist/bson.browser.esm.js:2154");for(var r=I.alloc(t),i=0;i<t;++i)r[i]=Math.floor(256*Math.random());return r},D=function(){if("undefined"!==typeof window){var e=i||window.msCrypto;if(e&&e.getRandomValues)return function(t){return e.getRandomValues(I.alloc(t))}}return"undefined"!==typeof r&&o&&o.getRandomValues?function(e){return o.getRandomValues(I.alloc(e))}:R}();function L(e){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(e))}function N(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}function M(e){return"[object BigInt64Array]"===Object.prototype.toString.call(e)}function $(e){return"[object BigUint64Array]"===Object.prototype.toString.call(e)}function j(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function U(e){return F(e)&&"[object Date]"===Object.prototype.toString.call(e)}function F(e){return"object"===(0,s.default)(e)&&null!==e}function B(t,n){var r=!1;return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return r||(e("warn",n," at node_modules/bson/dist/bson.browser.esm.js:2215"),r=!0),t.apply(this,i)}}function q(e){if(ArrayBuffer.isView(e))return I.from(e.buffer,e.byteOffset,e.byteLength);if(L(e))return I.from(e);throw new x("Must use either Buffer or TypedArray")}var W=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,H=function(e){return"string"===typeof e&&W.test(e)},V=function(e){if(!H(e))throw new x('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var t=e.replace(/-/g,"");return I.from(t,"hex")},G=function(e,t){return void 0===t&&(t=!0),t?e.toString("hex",0,4)+"-"+e.toString("hex",4,6)+"-"+e.toString("hex",6,8)+"-"+e.toString("hex",8,10)+"-"+e.toString("hex",10,16):e.toString("hex")};t.BSON_INT32_MAX=2147483647;t.BSON_INT32_MIN=-2147483648;var Y=Math.pow(2,63)-1;t.BSON_INT64_MAX=Y;var K=-Math.pow(2,63);t.BSON_INT64_MIN=K;var z=Math.pow(2,53),J=-Math.pow(2,53);t.BSON_DATA_NUMBER=1;t.BSON_DATA_STRING=2;t.BSON_DATA_OBJECT=3;t.BSON_DATA_ARRAY=4;t.BSON_DATA_BINARY=5;t.BSON_DATA_UNDEFINED=6;t.BSON_DATA_OID=7;t.BSON_DATA_BOOLEAN=8;t.BSON_DATA_DATE=9;t.BSON_DATA_NULL=10;t.BSON_DATA_REGEXP=11;t.BSON_DATA_DBPOINTER=12;t.BSON_DATA_CODE=13;t.BSON_DATA_SYMBOL=14;t.BSON_DATA_CODE_W_SCOPE=15;t.BSON_DATA_INT=16;t.BSON_DATA_TIMESTAMP=17;t.BSON_DATA_LONG=18;t.BSON_DATA_DECIMAL128=19;t.BSON_DATA_MIN_KEY=255;t.BSON_DATA_MAX_KEY=127;t.BSON_BINARY_SUBTYPE_DEFAULT=0;t.BSON_BINARY_SUBTYPE_FUNCTION=1;t.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;t.BSON_BINARY_SUBTYPE_UUID=3;t.BSON_BINARY_SUBTYPE_UUID_NEW=4;t.BSON_BINARY_SUBTYPE_MD5=5;t.BSON_BINARY_SUBTYPE_ENCRYPTED=6;t.BSON_BINARY_SUBTYPE_COLUMN=7;t.BSON_BINARY_SUBTYPE_USER_DEFINED=128;var Q=function(){function e(t,n){if(!(this instanceof e))return new e(t,n);if(null!=t&&"string"!==typeof t&&!ArrayBuffer.isView(t)&&!(t instanceof ArrayBuffer)&&!Array.isArray(t))throw new x("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=null!==n&&void 0!==n?n:e.BSON_BINARY_SUBTYPE_DEFAULT,null==t?(this.buffer=I.alloc(e.BUFFER_SIZE),this.position=0):("string"===typeof t?this.buffer=I.from(t,"binary"):Array.isArray(t)?this.buffer=I.from(t):this.buffer=q(t),this.position=this.buffer.byteLength)}return e.prototype.put=function(t){if("string"===typeof t&&1!==t.length)throw new x("only accepts single character String");if("number"!==typeof t&&1!==t.length)throw new x("only accepts single character Uint8Array or Array");var n;if(n="string"===typeof t?t.charCodeAt(0):"number"===typeof t?t:t[0],n<0||n>255)throw new x("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=n;else{var r=I.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r,this.buffer[this.position++]=n}},e.prototype.write=function(e,t){if(t="number"===typeof t?t:this.position,this.buffer.length<t+e.length){var n=I.alloc(this.buffer.length+e.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n}ArrayBuffer.isView(e)?(this.buffer.set(q(e),t),this.position=t+e.byteLength>this.position?t+e.length:this.position):"string"===typeof e&&(this.buffer.write(e,t,e.length,"binary"),this.position=t+e.length>this.position?t+e.length:this.position)},e.prototype.read=function(e,t){return t=t&&t>0?t:this.position,this.buffer.slice(e,e+t)},e.prototype.value=function(e){return e=!!e,e&&this.buffer.length===this.position?this.buffer:e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},e.prototype.length=function(){return this.position},e.prototype.toJSON=function(){return this.buffer.toString("base64")},e.prototype.toString=function(e){return this.buffer.toString(e)},e.prototype.toExtendedJSON=function(e){e=e||{};var t=this.buffer.toString("base64"),n=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===n.length?"0"+n:n}:{$binary:{base64:t,subType:1===n.length?"0"+n:n}}},e.prototype.toUUID=function(){if(this.sub_type===e.SUBTYPE_UUID)return new X(this.buffer.slice(0,this.position));throw new E('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(e.SUBTYPE_UUID,'" is currently supported.'))},e.fromExtendedJSON=function(t,n){var r,i;if(n=n||{},"$binary"in t?n.legacy&&"string"===typeof t.$binary&&"$type"in t?(i=t.$type?parseInt(t.$type,16):0,r=I.from(t.$binary,"base64")):"string"!==typeof t.$binary&&(i=t.$binary.subType?parseInt(t.$binary.subType,16):0,r=I.from(t.$binary.base64,"base64")):"$uuid"in t&&(i=4,r=V(t.$uuid)),!r)throw new x("Unexpected Binary Extended JSON format ".concat(JSON.stringify(t)));return 4===i?new X(r):new e(r,i)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.value(!0);return'new Binary(Buffer.from("'.concat(e.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},e.BSON_BINARY_SUBTYPE_DEFAULT=0,e.BUFFER_SIZE=256,e.SUBTYPE_DEFAULT=0,e.SUBTYPE_FUNCTION=1,e.SUBTYPE_BYTE_ARRAY=2,e.SUBTYPE_UUID_OLD=3,e.SUBTYPE_UUID=4,e.SUBTYPE_MD5=5,e.SUBTYPE_ENCRYPTED=6,e.SUBTYPE_COLUMN=7,e.SUBTYPE_USER_DEFINED=128,e}();t.Binary=Q,Object.defineProperty(Q.prototype,"_bsontype",{value:"Binary"});var X=function(e){function t(n){var r,i,o=this;if(null==n)r=t.generate();else if(n instanceof t)r=I.from(n.buffer),i=n.__id;else if(ArrayBuffer.isView(n)&&16===n.byteLength)r=q(n);else{if("string"!==typeof n)throw new x("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");r=V(n)}return o=e.call(this,r,4)||this,o.__id=i,o}return T(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this.buffer},set:function(e){this.buffer=e,t.cacheHexString&&(this.__id=G(e))},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(e){if(void 0===e&&(e=!0),t.cacheHexString&&this.__id)return this.__id;var n=G(this.id,e);return t.cacheHexString&&(this.__id=n),n},t.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(e){if(!e)return!1;if(e instanceof t)return e.id.equals(this.id);try{return new t(e).id.equals(this.id)}catch(n){return!1}},t.prototype.toBinary=function(){return new Q(this.id,Q.SUBTYPE_UUID)},t.generate=function(){var e=D(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,I.from(e)},t.isValid=function(e){return!!e&&(e instanceof t||("string"===typeof e?H(e):!!N(e)&&(16===e.length&&(64===(240&e[6])&&128===(128&e[8])))))},t.createFromHexString=function(e){var n=V(e);return new t(n)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},t}(Q);t.UUID=X;var Z=function(){function e(t,n){if(!(this instanceof e))return new e(t,n);this.code=t,this.scope=n}return e.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},e.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},e.fromExtendedJSON=function(t){return new e(t.$code,t.$scope)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.toJSON();return'new Code("'.concat(String(e.code),'"').concat(e.scope?", ".concat(JSON.stringify(e.scope)):"",")")},e}();function ee(e){return F(e)&&null!=e.$id&&"string"===typeof e.$ref&&(null==e.$db||"string"===typeof e.$db)}t.Code=Z,Object.defineProperty(Z.prototype,"_bsontype",{value:"Code"});var te=function(){function e(t,n,r,i){if(!(this instanceof e))return new e(t,n,r,i);var o=t.split(".");2===o.length&&(r=o.shift(),t=o.shift()),this.collection=t,this.oid=n,this.db=r,this.fields=i||{}}return Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e},e.prototype.toExtendedJSON=function(e){e=e||{};var t={$ref:this.collection,$id:this.oid};return e.legacy||(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields)),t},e.fromExtendedJSON=function(t){var n=Object.assign({},t);return delete n.$ref,delete n.$id,delete n.$db,new e(t.$ref,t.$id,t.$db,n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=void 0===this.oid||void 0===this.oid.toString?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(e),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},e}();t.DBRef=te,Object.defineProperty(te.prototype,"_bsontype",{value:"DBRef"});var ne=void 0;try{ne=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Et){}var re={},ie={},oe=function(){function e(t,n,r){if(void 0===t&&(t=0),!(this instanceof e))return new e(t,n,r);"bigint"===typeof t?Object.assign(this,e.fromBigInt(t,!!n)):"string"===typeof t?Object.assign(this,e.fromString(t,!!n)):(this.low=0|t,this.high=0|n,this.unsigned=!!r),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return e.fromBits=function(t,n,r){return new e(t,n,r)},e.fromInt=function(t,n){var r,i,o;return n?(t>>>=0,(o=0<=t&&t<256)&&(i=ie[t],i)?i:(r=e.fromBits(t,(0|t)<0?-1:0,!0),o&&(ie[t]=r),r)):(t|=0,(o=-128<=t&&t<128)&&(i=re[t],i)?i:(r=e.fromBits(t,t<0?-1:0,!1),o&&(re[t]=r),r))},e.fromNumber=function(t,n){if(isNaN(t))return n?e.UZERO:e.ZERO;if(n){if(t<0)return e.UZERO;if(t>=0x10000000000000000)return e.MAX_UNSIGNED_VALUE}else{if(t<=-0x8000000000000000)return e.MIN_VALUE;if(t+1>=0x8000000000000000)return e.MAX_VALUE}return t<0?e.fromNumber(-t,n).neg():e.fromBits(t%4294967296|0,t/4294967296|0,n)},e.fromBigInt=function(t,n){return e.fromString(t.toString(),n)},e.fromString=function(t,n,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return e.ZERO;if("number"===typeof n?(r=n,n=!1):n=!!n,r=r||10,r<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return e.fromString(t.substring(1),n,r).neg();for(var o=e.fromNumber(Math.pow(r,8)),a=e.ZERO,s=0;s<t.length;s+=8){var u=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+u),r);if(u<8){var l=e.fromNumber(Math.pow(r,u));a=a.mul(l).add(e.fromNumber(c))}else a=a.mul(o),a=a.add(e.fromNumber(c))}return a.unsigned=n,a},e.fromBytes=function(t,n,r){return r?e.fromBytesLE(t,n):e.fromBytesBE(t,n)},e.fromBytesLE=function(t,n){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)},e.fromBytesBE=function(t,n){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)},e.isLong=function(e){return F(e)&&!0===e["__isLong__"]},e.fromValue=function(t,n){return"number"===typeof t?e.fromNumber(t,n):"string"===typeof t?e.fromString(t,n):e.fromBits(t.low,t.high,"boolean"===typeof n?n:t.unsigned)},e.prototype.add=function(t){e.isLong(t)||(t=e.fromValue(t));var n=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,a=t.high>>>16,s=65535&t.high,u=t.low>>>16,c=65535&t.low,l=0,d=0,f=0,p=0;return p+=o+c,f+=p>>>16,p&=65535,f+=i+u,d+=f>>>16,f&=65535,d+=r+s,l+=d>>>16,d&=65535,l+=n+a,l&=65535,e.fromBits(f<<16|p,l<<16|d,this.unsigned)},e.prototype.and=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},e.prototype.compare=function(t){if(e.isLong(t)||(t=e.fromValue(t)),this.eq(t))return 0;var n=this.isNegative(),r=t.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},e.prototype.comp=function(e){return this.compare(e)},e.prototype.divide=function(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw Error("division by zero");if(ne){if(!this.unsigned&&-2147483648===this.high&&-1===t.low&&-1===t.high)return this;var n=(this.unsigned?ne.div_u:ne.div_s)(this.low,this.high,t.low,t.high);return e.fromBits(n,ne.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?e.UZERO:e.ZERO;var r,i,o;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return e.UZERO;if(t.gt(this.shru(1)))return e.UONE;o=e.UZERO}else{if(this.eq(e.MIN_VALUE)){if(t.eq(e.ONE)||t.eq(e.NEG_ONE))return e.MIN_VALUE;if(t.eq(e.MIN_VALUE))return e.ONE;var a=this.shr(1);return r=a.div(t).shl(1),r.eq(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(i=this.sub(t.mul(r)),o=r.add(i.div(t)),o)}if(t.eq(e.MIN_VALUE))return this.unsigned?e.UZERO:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();o=e.ZERO}i=this;while(i.gte(t)){r=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:Math.pow(2,s-48),c=e.fromNumber(r),l=c.mul(t);while(l.isNegative()||l.gt(i))r-=u,c=e.fromNumber(r,this.unsigned),l=c.mul(t);c.isZero()&&(c=e.ONE),o=o.add(c),i=i.sub(l)}return o},e.prototype.div=function(e){return this.divide(e)},e.prototype.equals=function(t){return e.isLong(t)||(t=e.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!==1||t.high>>>31!==1)&&(this.high===t.high&&this.low===t.low)},e.prototype.eq=function(e){return this.equals(e)},e.prototype.getHighBits=function(){return this.high},e.prototype.getHighBitsUnsigned=function(){return this.high>>>0},e.prototype.getLowBits=function(){return this.low},e.prototype.getLowBitsUnsigned=function(){return this.low>>>0},e.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(e.MIN_VALUE)?64:this.neg().getNumBitsAbs();var t,n=0!==this.high?this.high:this.low;for(t=31;t>0;t--)if(0!==(n&1<<t))break;return 0!==this.high?t+33:t+1},e.prototype.greaterThan=function(e){return this.comp(e)>0},e.prototype.gt=function(e){return this.greaterThan(e)},e.prototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},e.prototype.gte=function(e){return this.greaterThanOrEqual(e)},e.prototype.ge=function(e){return this.greaterThanOrEqual(e)},e.prototype.isEven=function(){return 0===(1&this.low)},e.prototype.isNegative=function(){return!this.unsigned&&this.high<0},e.prototype.isOdd=function(){return 1===(1&this.low)},e.prototype.isPositive=function(){return this.unsigned||this.high>=0},e.prototype.isZero=function(){return 0===this.high&&0===this.low},e.prototype.lessThan=function(e){return this.comp(e)<0},e.prototype.lt=function(e){return this.lessThan(e)},e.prototype.lessThanOrEqual=function(e){return this.comp(e)<=0},e.prototype.lte=function(e){return this.lessThanOrEqual(e)},e.prototype.modulo=function(t){if(e.isLong(t)||(t=e.fromValue(t)),ne){var n=(this.unsigned?ne.rem_u:ne.rem_s)(this.low,this.high,t.low,t.high);return e.fromBits(n,ne.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},e.prototype.mod=function(e){return this.modulo(e)},e.prototype.rem=function(e){return this.modulo(e)},e.prototype.multiply=function(t){if(this.isZero())return e.ZERO;if(e.isLong(t)||(t=e.fromValue(t)),ne){var n=ne.mul(this.low,this.high,t.low,t.high);return e.fromBits(n,ne.get_high(),this.unsigned)}if(t.isZero())return e.ZERO;if(this.eq(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.eq(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(e.TWO_PWR_24)&&t.lt(e.TWO_PWR_24))return e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,i=65535&this.high,o=this.low>>>16,a=65535&this.low,s=t.high>>>16,u=65535&t.high,c=t.low>>>16,l=65535&t.low,d=0,f=0,p=0,h=0;return h+=a*l,p+=h>>>16,h&=65535,p+=o*l,f+=p>>>16,p&=65535,p+=a*c,f+=p>>>16,p&=65535,f+=i*l,d+=f>>>16,f&=65535,f+=o*c,d+=f>>>16,f&=65535,f+=a*u,d+=f>>>16,f&=65535,d+=r*l+i*c+o*u+a*s,d&=65535,e.fromBits(p<<16|h,d<<16|f,this.unsigned)},e.prototype.mul=function(e){return this.multiply(e)},e.prototype.negate=function(){return!this.unsigned&&this.eq(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)},e.prototype.neg=function(){return this.negate()},e.prototype.not=function(){return e.fromBits(~this.low,~this.high,this.unsigned)},e.prototype.notEquals=function(e){return!this.equals(e)},e.prototype.neq=function(e){return this.notEquals(e)},e.prototype.ne=function(e){return this.notEquals(e)},e.prototype.or=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},e.prototype.shiftLeft=function(t){return e.isLong(t)&&(t=t.toInt()),0===(t&=63)?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):e.fromBits(0,this.low<<t-32,this.unsigned)},e.prototype.shl=function(e){return this.shiftLeft(e)},e.prototype.shiftRight=function(t){return e.isLong(t)&&(t=t.toInt()),0===(t&=63)?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},e.prototype.shr=function(e){return this.shiftRight(e)},e.prototype.shiftRightUnsigned=function(t){if(e.isLong(t)&&(t=t.toInt()),t&=63,0===t)return this;var n=this.high;if(t<32){var r=this.low;return e.fromBits(r>>>t|n<<32-t,n>>>t,this.unsigned)}return 32===t?e.fromBits(n,0,this.unsigned):e.fromBits(n>>>t-32,0,this.unsigned)},e.prototype.shr_u=function(e){return this.shiftRightUnsigned(e)},e.prototype.shru=function(e){return this.shiftRightUnsigned(e)},e.prototype.subtract=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.neg())},e.prototype.sub=function(e){return this.subtract(e)},e.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},e.prototype.toNumber=function(){return this.unsigned?4294967296*(this.high>>>0)+(this.low>>>0):4294967296*this.high+(this.low>>>0)},e.prototype.toBigInt=function(){return BigInt(this.toString())},e.prototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},e.prototype.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},e.prototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},e.prototype.toSigned=function(){return this.unsigned?e.fromBits(this.low,this.high,!1):this},e.prototype.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(e.MIN_VALUE)){var n=e.fromNumber(t),r=this.div(n),i=r.mul(n).sub(this);return r.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}var o=e.fromNumber(Math.pow(t,6),this.unsigned),a=this,s="";while(1){var u=a.div(o),c=a.sub(u.mul(o)).toInt()>>>0,l=c.toString(t);if(a=u,a.isZero())return l+s;while(l.length<6)l="0"+l;s=""+l+s}},e.prototype.toUnsigned=function(){return this.unsigned?this:e.fromBits(this.low,this.high,!0)},e.prototype.xor=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},e.prototype.eqz=function(){return this.isZero()},e.prototype.le=function(e){return this.lessThanOrEqual(e)},e.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,n){var r=e.fromString(t.$numberLong);return n&&n.relaxed?r.toNumber():r},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},e.TWO_PWR_24=e.fromInt(1<<24),e.MAX_UNSIGNED_VALUE=e.fromBits(-1,-1,!0),e.ZERO=e.fromInt(0),e.UZERO=e.fromInt(0,!0),e.ONE=e.fromInt(1),e.UONE=e.fromInt(1,!0),e.NEG_ONE=e.fromInt(-1),e.MAX_VALUE=e.fromBits(-1,2147483647,!1),e.MIN_VALUE=e.fromBits(0,-2147483648,!1),e}();t.Long=oe,Object.defineProperty(oe.prototype,"__isLong__",{value:!0}),Object.defineProperty(oe.prototype,"_bsontype",{value:"Long"});var ae=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,se=/^(\+|-)?(Infinity|inf)$/i,ue=/^(\+|-)?NaN$/i,ce=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),le=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),de=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),fe=/^([-+])?(\d+)?$/;function pe(e){return!isNaN(parseInt(e,10))}function he(e){var t=oe.fromNumber(1e9),n=oe.fromNumber(0);if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3])return{quotient:e,rem:n};for(var r=0;r<=3;r++)n=n.shiftLeft(32),n=n.add(new oe(e.parts[r],0)),e.parts[r]=n.div(t).low,n=n.modulo(t);return{quotient:e,rem:n}}function ge(e,t){throw new x('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}var ve=function(){function e(t){if(!(this instanceof e))return new e(t);if("string"===typeof t)this.bytes=e.fromString(t).bytes;else{if(!N(t))throw new x("Decimal128 must take a Buffer or string");if(16!==t.byteLength)throw new x("Decimal128 must take a Buffer of 16 bytes");this.bytes=t}}return e.fromString=function(t){var n,r=!1,i=!1,o=!1,a=0,s=0,u=0,c=0,l=0,d=[0],f=0,p=0,h=0,g=0,v=0,m=0,y=new oe(0,0),_=new oe(0,0),b=0;if(t.length>=7e3)throw new x(t+" not a valid Decimal128 string");var w=t.match(ae),S=t.match(se),C=t.match(ue);if(!w&&!S&&!C||0===t.length)throw new x(t+" not a valid Decimal128 string");if(w){var T=w[2],O=w[4],E=w[5],P=w[6];O&&void 0===P&&ge(t,"missing exponent power"),O&&void 0===T&&ge(t,"missing exponent base"),void 0===O&&(E||P)&&ge(t,"missing e before exponent")}if("+"!==t[b]&&"-"!==t[b]||(r="-"===t[b++]),!pe(t[b])&&"."!==t[b]){if("i"===t[b]||"I"===t[b])return new e(I.from(r?le:de));if("N"===t[b])return new e(I.from(ce))}while(pe(t[b])||"."===t[b])"."!==t[b]?(f<34&&("0"!==t[b]||o)&&(o||(l=s),o=!0,d[p++]=parseInt(t[b],10),f+=1),o&&(u+=1),i&&(c+=1),s+=1,b+=1):(i&&ge(t,"contains multiple periods"),i=!0,b+=1);if(i&&!s)throw new x(t+" not a valid Decimal128 string");if("e"===t[b]||"E"===t[b]){var k=t.substr(++b).match(fe);if(!k||!k[2])return new e(I.from(ce));v=parseInt(k[0],10),b+=k[0].length}if(t[b])return new e(I.from(ce));if(h=0,f){if(g=f-1,a=u,1!==a)while(0===d[l+a-1])a-=1}else h=0,g=0,d[0]=0,u=1,f=1,a=0;v<=c&&c-v>16384?v=-6176:v-=c;while(v>6111){if(g+=1,g-h>34){var A=d.join("");if(A.match(/^0+$/)){v=6111;break}ge(t,"overflow")}v-=1}while(v<-6176||f<u){if(0===g&&a<f){v=-6176,a=0;break}if(f<u?u-=1:g-=1,v<6111)v+=1;else{A=d.join("");if(A.match(/^0+$/)){v=6111;break}ge(t,"overflow")}}if(g-h+1<a){var R=s;i&&(l+=1,R+=1),r&&(l+=1,R+=1);var D=parseInt(t[l+g+1],10),L=0;if(D>=5&&(L=1,5===D))for(L=d[g]%2===1?1:0,m=l+g+2;m<R;m++)if(parseInt(t[m],10)){L=1;break}if(L)for(var N=g;N>=0;N--)if(++d[N]>9&&(d[N]=0,0===N)){if(!(v<6111))return new e(I.from(r?le:de));v+=1,d[N]=1}}if(y=oe.fromNumber(0),_=oe.fromNumber(0),0===a)y=oe.fromNumber(0),_=oe.fromNumber(0);else if(g-h<17){N=h;for(_=oe.fromNumber(d[N++]),y=new oe(0,0);N<=g;N++)_=_.multiply(oe.fromNumber(10)),_=_.add(oe.fromNumber(d[N]))}else{N=h;for(y=oe.fromNumber(d[N++]);N<=g-17;N++)y=y.multiply(oe.fromNumber(10)),y=y.add(oe.fromNumber(d[N]));for(_=oe.fromNumber(d[N++]);N<=g;N++)_=_.multiply(oe.fromNumber(10)),_=_.add(oe.fromNumber(d[N]))}var M=function(e,t){if(!e&&!t)return{high:oe.fromNumber(0),low:oe.fromNumber(0)};var n=e.shiftRightUnsigned(32),r=new oe(e.getLowBits(),0),i=t.shiftRightUnsigned(32),o=new oe(t.getLowBits(),0),a=n.multiply(i),s=n.multiply(o),u=r.multiply(i),c=r.multiply(o);return a=a.add(s.shiftRightUnsigned(32)),s=new oe(s.getLowBits(),0).add(u).add(c.shiftRightUnsigned(32)),a=a.add(s.shiftRightUnsigned(32)),c=s.shiftLeft(32).add(new oe(c.getLowBits(),0)),{high:a,low:c}}(y,oe.fromString("100000000000000000"));M.low=M.low.add(_),function(e,t){var n=e.high>>>0,r=t.high>>>0;if(n<r)return!0;if(n===r){var i=e.low>>>0,o=t.low>>>0;if(i<o)return!0}return!1}(M.low,_)&&(M.high=M.high.add(oe.fromNumber(1))),n=v+6176;var $={low:oe.fromNumber(0),high:oe.fromNumber(0)};M.high.shiftRightUnsigned(49).and(oe.fromNumber(1)).equals(oe.fromNumber(1))?($.high=$.high.or(oe.fromNumber(3).shiftLeft(61)),$.high=$.high.or(oe.fromNumber(n).and(oe.fromNumber(16383).shiftLeft(47))),$.high=$.high.or(M.high.and(oe.fromNumber(0x7fffffffffff)))):($.high=$.high.or(oe.fromNumber(16383&n).shiftLeft(49)),$.high=$.high.or(M.high.and(oe.fromNumber(562949953421311)))),$.low=M.low,r&&($.high=$.high.or(oe.fromString("9223372036854775808")));var j=I.alloc(16);return b=0,j[b++]=255&$.low.low,j[b++]=$.low.low>>8&255,j[b++]=$.low.low>>16&255,j[b++]=$.low.low>>24&255,j[b++]=255&$.low.high,j[b++]=$.low.high>>8&255,j[b++]=$.low.high>>16&255,j[b++]=$.low.high>>24&255,j[b++]=255&$.high.low,j[b++]=$.high.low>>8&255,j[b++]=$.high.low>>16&255,j[b++]=$.high.low>>24&255,j[b++]=255&$.high.high,j[b++]=$.high.high>>8&255,j[b++]=$.high.high>>16&255,j[b++]=$.high.high>>24&255,new e(j)},e.prototype.toString=function(){for(var e,t=0,n=new Array(36),r=0;r<n.length;r++)n[r]=0;var i,o,a,s=0,u=!1,c={parts:[0,0,0,0]},l=[];s=0;var d=this.bytes,f=d[s++]|d[s++]<<8|d[s++]<<16|d[s++]<<24,p=d[s++]|d[s++]<<8|d[s++]<<16|d[s++]<<24,h=d[s++]|d[s++]<<8|d[s++]<<16|d[s++]<<24,g=d[s++]|d[s++]<<8|d[s++]<<16|d[s++]<<24;s=0;var v={low:new oe(f,p),high:new oe(h,g)};v.high.lessThan(oe.ZERO)&&l.push("-");var m=g>>26&31;if(m>>3===3){if(30===m)return l.join("")+"Infinity";if(31===m)return"NaN";e=g>>15&16383,i=8+(g>>14&1)}else i=g>>14&7,e=g>>17&16383;var y=e-6176;if(c.parts[0]=(16383&g)+((15&i)<<14),c.parts[1]=h,c.parts[2]=p,c.parts[3]=f,0===c.parts[0]&&0===c.parts[1]&&0===c.parts[2]&&0===c.parts[3])u=!0;else for(a=3;a>=0;a--){var _=0,b=he(c);if(c=b.quotient,_=b.rem.low,_)for(o=8;o>=0;o--)n[9*a+o]=_%10,_=Math.floor(_/10)}if(u)t=1,n[s]=0;else{t=36;while(!n[s])t-=1,s+=1}var w=t-1+y;if(w>=34||w<=-7||y>0){if(t>34)return l.push("".concat(0)),y>0?l.push("E+".concat(y)):y<0&&l.push("E".concat(y)),l.join("");l.push("".concat(n[s++])),t-=1,t&&l.push(".");for(r=0;r<t;r++)l.push("".concat(n[s++]));l.push("E"),w>0?l.push("+".concat(w)):l.push("".concat(w))}else if(y>=0)for(r=0;r<t;r++)l.push("".concat(n[s++]));else{var S=t+y;if(S>0)for(r=0;r<S;r++)l.push("".concat(n[s++]));else l.push("0");l.push(".");while(S++<0)l.push("0");for(r=0;r<t-Math.max(S-1,0);r++)l.push("".concat(n[s++]))}return l.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},e}();t.Decimal128=ve,Object.defineProperty(ve.prototype,"_bsontype",{value:"Decimal128"});var me=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toJSON=function(){return this.value},e.prototype.toString=function(e){return this.value.toString(e)},e.prototype.toExtendedJSON=function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}},e.fromExtendedJSON=function(t,n){var r=parseFloat(t.$numberDouble);return n&&n.relaxed?r:new e(r)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.toExtendedJSON();return"new Double(".concat(e.$numberDouble,")")},e}();t.Double=me,Object.defineProperty(me.prototype,"_bsontype",{value:"Double"});var ye=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=0|+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(e){return this.value.toString(e)},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}},e.fromExtendedJSON=function(t,n){return n&&n.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},e}();t.Int32=ye,Object.defineProperty(ye.prototype,"_bsontype",{value:"Int32"});var _e=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$maxKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MaxKey()"},e}();t.MaxKey=_e,Object.defineProperty(_e.prototype,"_bsontype",{value:"MaxKey"});var be=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$minKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MinKey()"},e}();t.MinKey=be,Object.defineProperty(be.prototype,"_bsontype",{value:"MinKey"});var we=new RegExp("^[0-9a-fA-F]{24}$"),Se=null,Ie=Symbol("id"),Ce=function(){function e(t){if(!(this instanceof e))return new e(t);var n;if("object"===(0,s.default)(t)&&t&&"id"in t){if("string"!==typeof t.id&&!ArrayBuffer.isView(t.id))throw new x("Argument passed in must have an id that is of type string or Buffer");n="toHexString"in t&&"function"===typeof t.toHexString?I.from(t.toHexString(),"hex"):t.id}else n=t;if(null==n||"number"===typeof n)this[Ie]=e.generate("number"===typeof n?n:void 0);else if(ArrayBuffer.isView(n)&&12===n.byteLength)this[Ie]=n instanceof I?n:q(n);else{if("string"!==typeof n)throw new x("Argument passed in does not match the accepted types");if(12===n.length){var r=I.from(n);if(12!==r.byteLength)throw new x("Argument passed in must be a string of 12 bytes");this[Ie]=r}else{if(24!==n.length||!we.test(n))throw new x("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");this[Ie]=I.from(n,"hex")}}e.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(e.prototype,"id",{get:function(){return this[Ie]},set:function(t){this[Ie]=t,e.cacheHexString&&(this.__id=t.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(e){this.id.writeUInt32BE(e,0)},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(){if(e.cacheHexString&&this.__id)return this.__id;var t=this.id.toString("hex");return e.cacheHexString&&!this.__id&&(this.__id=t),t},e.getInc=function(){return e.index=(e.index+1)%16777215},e.generate=function(t){"number"!==typeof t&&(t=Math.floor(Date.now()/1e3));var n=e.getInc(),r=I.alloc(12);return r.writeUInt32BE(t,0),null===Se&&(Se=D(5)),r[4]=Se[0],r[5]=Se[1],r[6]=Se[2],r[7]=Se[3],r[8]=Se[4],r[11]=255&n,r[10]=n>>8&255,r[9]=n>>16&255,r},e.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){if(void 0===t||null===t)return!1;if(t instanceof e)return this[Ie][11]===t[Ie][11]&&this[Ie].equals(t[Ie]);if("string"===typeof t&&e.isValid(t)&&12===t.length&&N(this.id))return t===I.prototype.toString.call(this.id,"latin1");if("string"===typeof t&&e.isValid(t)&&24===t.length)return t.toLowerCase()===this.toHexString();if("string"===typeof t&&e.isValid(t)&&12===t.length)return I.from(t).equals(this.id);if("object"===(0,s.default)(t)&&"toHexString"in t&&"function"===typeof t.toHexString){var n=t.toHexString(),r=this.toHexString().toLowerCase();return"string"===typeof n&&n.toLowerCase()===r}return!1},e.prototype.getTimestamp=function(){var e=new Date,t=this.id.readUInt32BE(0);return e.setTime(1e3*Math.floor(t)),e},e.createPk=function(){return new e},e.createFromTime=function(t){var n=I.from([0,0,0,0,0,0,0,0,0,0,0,0]);return n.writeUInt32BE(t,0),new e(n)},e.createFromHexString=function(t){if("undefined"===typeof t||null!=t&&24!==t.length)throw new x("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new e(I.from(t,"hex"))},e.isValid=function(t){if(null==t)return!1;try{return new e(t),!0}catch(Et){return!1}},e.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},e.fromExtendedJSON=function(t){return new e(t.$oid)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},e.index=Math.floor(16777215*Math.random()),e}();t.ObjectId=t.ObjectID=Ce,Object.defineProperty(Ce.prototype,"generate",{value:B((function(e){return Ce.generate(e)}),"Please use the static `ObjectId.generate(time)` instead")}),Object.defineProperty(Ce.prototype,"getInc",{value:B((function(){return Ce.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(Ce.prototype,"get_inc",{value:B((function(){return Ce.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(Ce,"get_inc",{value:B((function(){return Ce.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(Ce.prototype,"_bsontype",{value:"ObjectID"});var Te=function(){function e(t,n){if(!(this instanceof e))return new e(t,n);if(this.pattern=t,this.options=function(e){return e.split("").sort().join("")}(null!==n&&void 0!==n?n:""),-1!==this.pattern.indexOf("\0"))throw new E("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(-1!==this.options.indexOf("\0"))throw new E("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var r=0;r<this.options.length;r++)if("i"!==this.options[r]&&"m"!==this.options[r]&&"x"!==this.options[r]&&"l"!==this.options[r]&&"s"!==this.options[r]&&"u"!==this.options[r])throw new E("The regular expression option [".concat(this.options[r],"] is not supported"))}return e.parseOptions=function(e){return e?e.split("").sort().join(""):""},e.prototype.toExtendedJSON=function(e){return e=e||{},e.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},e.fromExtendedJSON=function(t){if("$regex"in t){if("string"===typeof t.$regex)return new e(t.$regex,e.parseOptions(t.$options));if("BSONRegExp"===t.$regex._bsontype)return t}if("$regularExpression"in t)return new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options));throw new x("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(t)))},e}();t.BSONRegExp=Te,Object.defineProperty(Te.prototype,"_bsontype",{value:"BSONRegExp"});var Oe=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(){return this.value},e.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(){return{$symbol:this.value}},e.fromExtendedJSON=function(t){return new e(t.$symbol)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e}();t.BSONSymbol=Oe,Object.defineProperty(Oe.prototype,"_bsontype",{value:"Symbol"});var Ee=oe;t.LongWithoutOverridesClass=Ee;var xe=function(e){function t(n,r){var i=this;return i instanceof t?(i=oe.isLong(n)?e.call(this,n.low,n.high,!0)||this:F(n)&&"undefined"!==typeof n.t&&"undefined"!==typeof n.i?e.call(this,n.i,n.t,!0)||this:e.call(this,n,r,!0)||this,Object.defineProperty(i,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),i):new t(n,r)}return T(t,e),t.prototype.toJSON=function(){return{$timestamp:this.toString()}},t.fromInt=function(e){return new t(oe.fromInt(e,!0))},t.fromNumber=function(e){return new t(oe.fromNumber(e,!0))},t.fromBits=function(e,n){return new t(e,n)},t.fromString=function(e,n){return new t(oe.fromString(e,!0,n))},t.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},t.fromExtendedJSON=function(e){return new t(e.$timestamp)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},t.MAX_VALUE=oe.MAX_UNSIGNED_VALUE,t}(Ee);function Pe(e){return F(e)&&Reflect.has(e,"_bsontype")&&"string"===typeof e._bsontype}t.Timestamp=xe;var ke={$oid:Ce,$binary:Q,$uuid:Q,$symbol:Oe,$numberInt:ye,$numberDecimal:ve,$numberDouble:me,$numberLong:oe,$minKey:be,$maxKey:_e,$regex:Te,$regularExpression:Te,$timestamp:xe};function Ae(e){var t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}function Re(e,t){if(("object"===(0,s.default)(e)||"function"===typeof e)&&null!==e){var n=t.seenObjects.findIndex((function(t){return t.obj===e}));if(-1!==n){var r=t.seenObjects.map((function(e){return e.propertyName})),i=r.slice(0,n).map((function(e){return"".concat(e," -> ")})).join(""),o=r[n],a=" -> "+r.slice(n+1,r.length-1).map((function(e){return"".concat(e," -> ")})).join(""),u=r[r.length-1],c=" ".repeat(i.length+o.length/2),l="-".repeat(a.length+(o.length+u.length)/2-1);throw new x("Converting circular structure to EJSON:\n"+"    ".concat(i).concat(o).concat(a).concat(u,"\n")+"    ".concat(c,"\\").concat(l,"/"))}t.seenObjects[t.seenObjects.length-1].obj=e}if(Array.isArray(e))return function(e,t){return e.map((function(e,n){t.seenObjects.push({propertyName:"index ".concat(n),obj:null});try{return Re(e,t)}finally{t.seenObjects.pop()}}))}(e,t);if(void 0===e)return null;if(e instanceof Date||U(e)){var d=e.getTime(),f=d>-1&&d<2534023188e5;return t.legacy?t.relaxed&&f?{$date:e.getTime()}:{$date:Ae(e)}:t.relaxed&&f?{$date:Ae(e)}:{$date:{$numberLong:e.getTime().toString()}}}if("number"===typeof e&&(!t.relaxed||!isFinite(e))){if(Math.floor(e)===e){var p=e>=-2147483648&&e<=2147483647,h=e>=-0x8000000000000000&&e<=0x8000000000000000;if(p)return{$numberInt:e.toString()};if(h)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp||j(e)){var g=e.flags;if(void 0===g){var v=e.toString().match(/[gimuy]*$/);v&&(g=v[0])}var m=new Te(e.source,g);return m.toExtendedJSON(t)}return null!=e&&"object"===(0,s.default)(e)?function(e,t){if(null==e||"object"!==(0,s.default)(e))throw new E("not an object instance");var n=e._bsontype;if("undefined"===typeof n){var r={};for(var i in e){t.seenObjects.push({propertyName:i,obj:null});try{var o=Re(e[i],t);"__proto__"===i?Object.defineProperty(r,i,{value:o,writable:!0,enumerable:!0,configurable:!0}):r[i]=o}finally{t.seenObjects.pop()}}return r}if(Pe(e)){var a=e;if("function"!==typeof a.toExtendedJSON){var u=Ne[e._bsontype];if(!u)throw new x("Unrecognized or invalid _bsontype: "+e._bsontype);a=u(a)}return"Code"===n&&a.scope?a=new Z(a.code,Re(a.scope,t)):"DBRef"===n&&a.oid&&(a=new te(Re(a.collection,t),Re(a.oid,t),Re(a.db,t),Re(a.fields,t))),a.toExtendedJSON(t)}throw new E("_bsontype must be a string, but was: "+(0,s.default)(n))}(e,t):e}var De,Le,Ne={Binary:function(e){return new Q(e.value(),e.sub_type)},Code:function(e){return new Z(e.code,e.scope)},DBRef:function(e){return new te(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new ve(e.bytes)},Double:function(e){return new me(e.value)},Int32:function(e){return new ye(e.value)},Long:function(e){return oe.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_)},MaxKey:function(){return new _e},MinKey:function(){return new be},ObjectID:function(e){return new Ce(e)},ObjectId:function(e){return new Ce(e)},BSONRegExp:function(e){return new Te(e.pattern,e.options)},Symbol:function(e){return new Oe(e.value)},Timestamp:function(e){return xe.fromBits(e.low,e.high)}};t.EJSON=De,function(e){function t(e,t){var n=Object.assign({},{relaxed:!0,legacy:!1},t);return"boolean"===typeof n.relaxed&&(n.strict=!n.relaxed),"boolean"===typeof n.strict&&(n.relaxed=!n.strict),JSON.parse(e,(function(e,t){if(-1!==e.indexOf("\0"))throw new E("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(e)));return function e(t,n){if(void 0===n&&(n={}),"number"===typeof t){if(n.relaxed||n.legacy)return t;if(Math.floor(t)===t){if(t>=-2147483648&&t<=2147483647)return new ye(t);if(t>=-0x8000000000000000&&t<=0x8000000000000000)return oe.fromNumber(t)}return new me(t)}if(null==t||"object"!==(0,s.default)(t))return t;if(t.$undefined)return null;for(var r=Object.keys(t).filter((function(e){return e.startsWith("$")&&null!=t[e]})),i=0;i<r.length;i++){var o=ke[r[i]];if(o)return o.fromExtendedJSON(t,n)}if(null!=t.$date){var a=t.$date,u=new Date;return n.legacy?"number"===typeof a?u.setTime(a):"string"===typeof a&&u.setTime(Date.parse(a)):"string"===typeof a?u.setTime(Date.parse(a)):oe.isLong(a)?u.setTime(a.toNumber()):"number"===typeof a&&n.relaxed&&u.setTime(a),u}if(null!=t.$code){var c=Object.assign({},t);return t.$scope&&(c.$scope=e(t.$scope)),Z.fromExtendedJSON(t)}if(ee(t)||t.$dbPointer){var l=t.$ref?t:t.$dbPointer;if(l instanceof te)return l;var d=Object.keys(l).filter((function(e){return e.startsWith("$")})),f=!0;if(d.forEach((function(e){-1===["$ref","$id","$db"].indexOf(e)&&(f=!1)})),f)return te.fromExtendedJSON(l)}return t}(t,n)}))}function n(e,t,n,r){null!=n&&"object"===(0,s.default)(n)&&(r=n,n=0),null==t||"object"!==(0,s.default)(t)||Array.isArray(t)||(r=t,t=void 0,n=0);var i=Object.assign({relaxed:!0,legacy:!1},r,{seenObjects:[{propertyName:"(root)",obj:null}]}),o=Re(e,i);return JSON.stringify(o,t,n)}e.parse=t,e.stringify=n,e.serialize=function(e,t){return t=t||{},JSON.parse(n(e,t))},e.deserialize=function(e,n){return n=n||{},t(JSON.stringify(e),n)}}(De||(t.EJSON=De={})),t.Map=Le;var Me=k();function $e(e,t,n){var r=5;if(Array.isArray(e))for(var i=0;i<e.length;i++)r+=je(i.toString(),e[i],t,!0,n);else for(var o in"function"===typeof(null===e||void 0===e?void 0:e.toBSON)&&(e=e.toBSON()),e)r+=je(o,e[o],t,!1,n);return r}function je(e,t,n,r,i){switch(void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),"function"===typeof(null===t||void 0===t?void 0:t.toBSON)&&(t=t.toBSON()),(0,s.default)(t)){case"string":return 1+I.byteLength(e,"utf8")+1+4+I.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=J&&t<=z&&t>=-2147483648&&t<=2147483647?(null!=e?I.byteLength(e,"utf8")+1:0)+5:(null!=e?I.byteLength(e,"utf8")+1:0)+9;case"undefined":return r||!i?(null!=e?I.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(null!=e?I.byteLength(e,"utf8")+1:0)+2;case"object":if(null==t||"MinKey"===t["_bsontype"]||"MaxKey"===t["_bsontype"])return(null!=e?I.byteLength(e,"utf8")+1:0)+1;if("ObjectId"===t["_bsontype"]||"ObjectID"===t["_bsontype"])return(null!=e?I.byteLength(e,"utf8")+1:0)+13;if(t instanceof Date||U(t))return(null!=e?I.byteLength(e,"utf8")+1:0)+9;if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||L(t))return(null!=e?I.byteLength(e,"utf8")+1:0)+6+t.byteLength;if("Long"===t["_bsontype"]||"Double"===t["_bsontype"]||"Timestamp"===t["_bsontype"])return(null!=e?I.byteLength(e,"utf8")+1:0)+9;if("Decimal128"===t["_bsontype"])return(null!=e?I.byteLength(e,"utf8")+1:0)+17;if("Code"===t["_bsontype"])return null!=t.scope&&Object.keys(t.scope).length>0?(null!=e?I.byteLength(e,"utf8")+1:0)+1+4+4+I.byteLength(t.code.toString(),"utf8")+1+$e(t.scope,n,i):(null!=e?I.byteLength(e,"utf8")+1:0)+1+4+I.byteLength(t.code.toString(),"utf8")+1;if("Binary"===t["_bsontype"]){var o=t;return o.sub_type===Q.SUBTYPE_BYTE_ARRAY?(null!=e?I.byteLength(e,"utf8")+1:0)+(o.position+1+4+1+4):(null!=e?I.byteLength(e,"utf8")+1:0)+(o.position+1+4+1)}if("Symbol"===t["_bsontype"])return(null!=e?I.byteLength(e,"utf8")+1:0)+I.byteLength(t.value,"utf8")+4+1+1;if("DBRef"===t["_bsontype"]){var a=Object.assign({$ref:t.collection,$id:t.oid},t.fields);return null!=t.db&&(a["$db"]=t.db),(null!=e?I.byteLength(e,"utf8")+1:0)+1+$e(a,n,i)}return t instanceof RegExp||j(t)?(null!=e?I.byteLength(e,"utf8")+1:0)+1+I.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:"BSONRegExp"===t["_bsontype"]?(null!=e?I.byteLength(e,"utf8")+1:0)+1+I.byteLength(t.pattern,"utf8")+1+I.byteLength(t.options,"utf8")+1:(null!=e?I.byteLength(e,"utf8")+1:0)+$e(t,n,i)+1;case"function":if(t instanceof RegExp||j(t)||"[object RegExp]"===String.call(t))return(null!=e?I.byteLength(e,"utf8")+1:0)+1+I.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?I.byteLength(e,"utf8")+1:0)+1+4+4+I.byteLength(A(t),"utf8")+1+$e(t.scope,n,i);if(n)return(null!=e?I.byteLength(e,"utf8")+1:0)+1+4+I.byteLength(A(t),"utf8")+1}return 0}Me.Map?t.Map=Le=Me.Map:t.Map=Le=function(){function e(e){void 0===e&&(e=[]),this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var n=e[t],r=n[0],i=n[1];this._keys.push(r),this._values[r]={v:i,i:this._keys.length-1}}}return e.prototype.clear=function(){this._keys=[],this._values={}},e.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},e.prototype.entries=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?[n,e._values[n].v]:void 0,done:void 0===n}}}},e.prototype.forEach=function(e,t){t=t||this;for(var n=0;n<this._keys.length;n++){var r=this._keys[n];e.call(t,this._values[r].v,r,t)}},e.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},e.prototype.has=function(e){return null!=this._values[e]},e.prototype.keys=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?n:void 0,done:void 0===n}}}},e.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},e.prototype.values=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?e._values[n].v:void 0,done:void 0===n}}}},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),e}();function Ue(e,t,n){for(var r=0,i=t;i<n;i+=1){var o=e[i];if(r){if(128!==(192&o))return!1;r-=1}else if(128&o)if(192===(224&o))r=1;else if(224===(240&o))r=2;else{if(240!==(248&o))return!1;r=3}}return!r}var Fe=oe.fromNumber(z),Be=oe.fromNumber(J),qe={};function We(e,t,n){t=null==t?{}:t;var r=t&&t.index?t.index:0,i=e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24;if(i<5)throw new E("bson size must be >= 5, is ".concat(i));if(t.allowObjectSmallerThanBufferSize&&e.length<i)throw new E("buffer length ".concat(e.length," must be >= bson size ").concat(i));if(!t.allowObjectSmallerThanBufferSize&&e.length!==i)throw new E("buffer length ".concat(e.length," must === bson size ").concat(i));if(i+r>e.byteLength)throw new E("(bson size ".concat(i," + options.index ").concat(r," must be <= buffer length ").concat(e.byteLength,")"));if(0!==e[r+i-1])throw new E("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return function e(t,n,r,i){void 0===i&&(i=!1);var o,a=null!=r["evalFunctions"]&&r["evalFunctions"],s=null!=r["cacheFunctions"]&&r["cacheFunctions"],u=null==r["fieldsAsRaw"]?null:r["fieldsAsRaw"],c=null!=r["raw"]&&r["raw"],l="boolean"===typeof r["bsonRegExp"]&&r["bsonRegExp"],d=null!=r["promoteBuffers"]&&r["promoteBuffers"],f=null==r["promoteLongs"]||r["promoteLongs"],p=null==r["promoteValues"]||r["promoteValues"],h=null==r.validation?{utf8:!0}:r.validation,g=!0,v=new Set,m=h.utf8;if("boolean"===typeof m)o=m;else{g=!1;var y=Object.keys(m).map((function(e){return m[e]}));if(0===y.length)throw new E("UTF-8 validation setting cannot be empty");if("boolean"!==typeof y[0])throw new E("Invalid UTF-8 validation option, must specify boolean values");if(o=y[0],!y.every((function(e){return e===o})))throw new E("Invalid UTF-8 validation option - keys must be all true or all false")}if(!g)for(var _=0,b=Object.keys(m);_<b.length;_++){var w=b[_];v.add(w)}var S=n;if(t.length<5)throw new E("corrupt bson message < 5 bytes long");var C=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(C<5||C>t.length)throw new E("corrupt bson message");var T=i?[]:{},x=0,P=!i&&null,k=new DataView(t.buffer,t.byteOffset,t.byteLength);while(1){var A=t[n++];if(0===A)break;var R=n;while(0!==t[R]&&R<t.length)R++;if(R>=t.byteLength)throw new E("Bad BSON Document: illegal CString");var D=i?x++:t.toString("utf8",n,R),L=!0;L=g||v.has(D)?o:!o,!1!==P&&"$"===D[0]&&(P=He.test(D));var N=void 0;if(n=R+1,2===A){var M=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(M<=0||M>t.length-n||0!==t[n+M-1])throw new E("bad string length in bson");N=Ge(t,n,n+M-1,L),n+=M}else if(7===A){var $=I.alloc(12);t.copy($,0,n,n+12),N=new Ce($),n+=12}else if(16===A&&!1===p)N=new ye(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24);else if(16===A)N=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;else if(1===A&&!1===p)N=new me(k.getFloat64(n,!0)),n+=8;else if(1===A)N=k.getFloat64(n,!0),n+=8;else if(9===A){var j=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,U=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;N=new Date(new oe(j,U).toNumber())}else if(8===A){if(0!==t[n]&&1!==t[n])throw new E("illegal boolean type value");N=1===t[n++]}else if(3===A){var F=n,B=t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24;if(B<=0||B>t.length-n)throw new E("bad embedded document length in bson");if(c)N=t.slice(n,n+B);else{var q=r;g||(q=O(O({},r),{validation:{utf8:L}})),N=e(t,F,q,!1)}n+=B}else if(4===A){F=n,B=t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24;var W=r,H=n+B;if(u&&u[D]){for(var V in W={},r)W[V]=r[V];W["raw"]=!0}if(g||(W=O(O({},W),{validation:{utf8:L}})),N=e(t,F,W,!0),n+=B,0!==t[n-1])throw new E("invalid array terminator byte");if(n!==H)throw new E("corrupted array bson")}else if(6===A)N=void 0;else if(10===A)N=null;else if(18===A){j=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,U=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;var G=new oe(j,U);N=f&&!0===p&&G.lessThanOrEqual(Fe)&&G.greaterThanOrEqual(Be)?G.toNumber():G}else if(19===A){var Y=I.alloc(16);t.copy(Y,0,n,n+16),n+=16;var K=new ve(Y);N="toObject"in K&&"function"===typeof K.toObject?K.toObject():K}else if(5===A){var z=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,J=z,X=t[n++];if(z<0)throw new E("Negative binary type element size found");if(z>t.byteLength)throw new E("Binary type size larger than document size");if(null!=t["slice"]){if(X===Q.SUBTYPE_BYTE_ARRAY){if(z=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,z<0)throw new E("Negative binary type element size found for subtype 0x02");if(z>J-4)throw new E("Binary type with subtype 0x02 contains too long binary size");if(z<J-4)throw new E("Binary type with subtype 0x02 contains too short binary size")}d&&p?N=t.slice(n,n+z):(N=new Q(t.slice(n,n+z),X),4===X&&(N=N.toUUID()))}else{var ne=I.alloc(z);if(X===Q.SUBTYPE_BYTE_ARRAY){if(z=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,z<0)throw new E("Negative binary type element size found for subtype 0x02");if(z>J-4)throw new E("Binary type with subtype 0x02 contains too long binary size");if(z<J-4)throw new E("Binary type with subtype 0x02 contains too short binary size")}for(R=0;R<z;R++)ne[R]=t[n+R];N=d&&p?ne:4===X?new Q(t.slice(n,n+z),X).toUUID():new Q(t.slice(n,n+z),X)}n+=z}else if(11===A&&!1===l){R=n;while(0!==t[R]&&R<t.length)R++;if(R>=t.length)throw new E("Bad BSON Document: illegal CString");var re=t.toString("utf8",n,R);n=R+1,R=n;while(0!==t[R]&&R<t.length)R++;if(R>=t.length)throw new E("Bad BSON Document: illegal CString");var ie=t.toString("utf8",n,R);n=R+1;var ae=new Array(ie.length);for(R=0;R<ie.length;R++)switch(ie[R]){case"m":ae[R]="m";break;case"s":ae[R]="g";break;case"i":ae[R]="i";break}N=new RegExp(re,ae.join(""))}else if(11===A&&!0===l){R=n;while(0!==t[R]&&R<t.length)R++;if(R>=t.length)throw new E("Bad BSON Document: illegal CString");re=t.toString("utf8",n,R);n=R+1,R=n;while(0!==t[R]&&R<t.length)R++;if(R>=t.length)throw new E("Bad BSON Document: illegal CString");ie=t.toString("utf8",n,R);n=R+1,N=new Te(re,ie)}else if(14===A){M=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(M<=0||M>t.length-n||0!==t[n+M-1])throw new E("bad string length in bson");var se=Ge(t,n,n+M-1,L);N=p?se:new Oe(se),n+=M}else if(17===A){j=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,U=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;N=new xe(j,U)}else if(255===A)N=new be;else if(127===A)N=new _e;else if(13===A){M=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(M<=0||M>t.length-n||0!==t[n+M-1])throw new E("bad string length in bson");var ue=Ge(t,n,n+M-1,L);N=a?s?Ve(ue,qe,T):Ve(ue):new Z(ue),n+=M}else if(15===A){var ce=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(ce<13)throw new E("code_w_scope total size shorter minimum expected length");M=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(M<=0||M>t.length-n||0!==t[n+M-1])throw new E("bad string length in bson");ue=Ge(t,n,n+M-1,L);n+=M;F=n,B=t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24;var le=e(t,F,r,!1);if(n+=B,ce<8+B+M)throw new E("code_w_scope total size is too short, truncating scope");if(ce>8+B+M)throw new E("code_w_scope total size is too long, clips outer document");a?(N=s?Ve(ue,qe,T):Ve(ue),N.scope=le):N=new Z(ue,le)}else{if(12!==A)throw new E("Detected unknown BSON type ".concat(A.toString(16),' for fieldname "').concat(D,'"'));M=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(M<=0||M>t.length-n||0!==t[n+M-1])throw new E("bad string length in bson");if(null!=h&&h.utf8&&!Ue(t,n,n+M-1))throw new E("Invalid UTF-8 string in BSON document");var de=t.toString("utf8",n,n+M-1);n+=M;var fe=I.alloc(12);t.copy(fe,0,n,n+12);$=new Ce(fe);n+=12,N=new te(de,$)}"__proto__"===D?Object.defineProperty(T,D,{value:N,writable:!0,enumerable:!0,configurable:!0}):T[D]=N}if(C!==n-S){if(i)throw new E("corrupt array bson");throw new E("corrupt object bson")}if(!P)return T;if(ee(T)){var pe=Object.assign({},T);return delete pe.$ref,delete pe.$id,delete pe.$db,new te(T.$ref,T.$id,T.$db,pe)}return T}(e,r,t,n)}var He=/^\$ref$|^\$id$|^\$db$/;function Ve(e,t,n){return t?(null==t[e]&&(t[e]=new Function(e)),t[e].bind(n)):new Function(e)}function Ge(e,t,n,r){var i=e.toString("utf8",t,n);if(r)for(var o=0;o<i.length;o++)if(65533===i.charCodeAt(o)){if(!Ue(e,t,n))throw new E("Invalid UTF-8 string in BSON document");break}return i}var Ye=/\x00/,Ke=new Set(["$db","$ref","$id","$clusterTime"]);function ze(e,t,n,r,i){e[r++]=2;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r=r+o+1,e[r-1]=0;var a=e.write(n,r+4,void 0,"utf8");return e[r+3]=a+1>>24&255,e[r+2]=a+1>>16&255,e[r+1]=a+1>>8&255,e[r]=a+1&255,r=r+4+a,e[r++]=0,r}var Je=new Uint8Array(8),Qe=new DataView(Je.buffer,Je.byteOffset,Je.byteLength);function Xe(e,t,n,r,i){if(Number.isInteger(n)&&n>=-2147483648&&n<=2147483647){e[r++]=16;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=o,e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255}else{e[r++]=1;o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=o,e[r++]=0,Qe.setFloat64(0,n,!0),e.set(Je,r),r+=8}return r}function Ze(e,t,n,r,i){e[r++]=10;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");return r+=o,e[r++]=0,r}function et(e,t,n,r,i){e[r++]=8;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");return r+=o,e[r++]=0,e[r++]=n?1:0,r}function tt(e,t,n,r,i){e[r++]=9;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=o,e[r++]=0;var a=oe.fromNumber(n.getTime()),s=a.getLowBits(),u=a.getHighBits();return e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=255&u,e[r++]=u>>8&255,e[r++]=u>>16&255,e[r++]=u>>24&255,r}function nt(e,t,n,r,i){e[r++]=11;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");if(r+=o,e[r++]=0,n.source&&null!=n.source.match(Ye))throw Error("value "+n.source+" must not contain null bytes");return r+=e.write(n.source,r,void 0,"utf8"),e[r++]=0,n.ignoreCase&&(e[r++]=105),n.global&&(e[r++]=115),n.multiline&&(e[r++]=109),e[r++]=0,r}function rt(e,t,n,r,i){e[r++]=11;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");if(r+=o,e[r++]=0,null!=n.pattern.match(Ye))throw Error("pattern "+n.pattern+" must not contain null bytes");return r+=e.write(n.pattern,r,void 0,"utf8"),e[r++]=0,r+=e.write(n.options.split("").sort().join(""),r,void 0,"utf8"),e[r++]=0,r}function it(e,t,n,r,i){null===n?e[r++]=10:"MinKey"===n._bsontype?e[r++]=255:e[r++]=127;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");return r+=o,e[r++]=0,r}function ot(e,t,n,r,i){e[r++]=7;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");if(r+=o,e[r++]=0,"string"===typeof n.id)e.write(n.id,r,void 0,"binary");else{if(!N(n.id))throw new x("object ["+JSON.stringify(n)+"] is not a valid ObjectId");e.set(n.id.subarray(0,12),r)}return r+12}function at(e,t,n,r,i){e[r++]=5;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=o,e[r++]=0;var a=n.length;return e[r++]=255&a,e[r++]=a>>8&255,e[r++]=a>>16&255,e[r++]=a>>24&255,e[r++]=0,e.set(q(n),r),r+=a,r}function st(e,t,n,r,i,o,a,s,u,c){void 0===i&&(i=!1),void 0===o&&(o=0),void 0===a&&(a=!1),void 0===s&&(s=!0),void 0===u&&(u=!1),void 0===c&&(c=[]);for(var l=0;l<c.length;l++)if(c[l]===n)throw new E("cyclic dependency detected");c.push(n),e[r++]=Array.isArray(n)?4:3;var d=u?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=d,e[r++]=0;var f=mt(e,n,i,r,o+1,a,s,c);return c.pop(),f}function ut(e,t,n,r,i){e[r++]=19;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");return r+=o,e[r++]=0,e.set(n.bytes.subarray(0,16),r),r+16}function ct(e,t,n,r,i){e[r++]="Long"===n._bsontype?18:17;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=o,e[r++]=0;var a=n.getLowBits(),s=n.getHighBits();return e[r++]=255&a,e[r++]=a>>8&255,e[r++]=a>>16&255,e[r++]=a>>24&255,e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,r}function lt(e,t,n,r,i){n=n.valueOf(),e[r++]=16;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");return r+=o,e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255,r}function dt(e,t,n,r,i){e[r++]=1;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");return r+=o,e[r++]=0,Qe.setFloat64(0,n.value,!0),e.set(Je,r),r+=8,r}function ft(e,t,n,r,i,o,a){e[r++]=13;var s=a?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=s,e[r++]=0;var u=A(n),c=e.write(u,r+4,void 0,"utf8")+1;return e[r]=255&c,e[r+1]=c>>8&255,e[r+2]=c>>16&255,e[r+3]=c>>24&255,r=r+4+c-1,e[r++]=0,r}function pt(e,t,n,r,i,o,a,u,c){if(void 0===i&&(i=!1),void 0===o&&(o=0),void 0===a&&(a=!1),void 0===u&&(u=!0),void 0===c&&(c=!1),n.scope&&"object"===(0,s.default)(n.scope)){e[r++]=15;var l=c?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=l,e[r++]=0;var d=r,f="string"===typeof n.code?n.code:n.code.toString();r+=4;var p=e.write(f,r+4,void 0,"utf8")+1;e[r]=255&p,e[r+1]=p>>8&255,e[r+2]=p>>16&255,e[r+3]=p>>24&255,e[r+4+p-1]=0,r=r+p+4;var h=mt(e,n.scope,i,r,o+1,a,u);r=h-1;var g=h-d;e[d++]=255&g,e[d++]=g>>8&255,e[d++]=g>>16&255,e[d++]=g>>24&255,e[r++]=0}else{e[r++]=13;l=c?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=l,e[r++]=0;f=n.code.toString();var v=e.write(f,r+4,void 0,"utf8")+1;e[r]=255&v,e[r+1]=v>>8&255,e[r+2]=v>>16&255,e[r+3]=v>>24&255,r=r+4+v-1,e[r++]=0}return r}function ht(e,t,n,r,i){e[r++]=5;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=o,e[r++]=0;var a=n.value(!0),s=n.position;return n.sub_type===Q.SUBTYPE_BYTE_ARRAY&&(s+=4),e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=n.sub_type,n.sub_type===Q.SUBTYPE_BYTE_ARRAY&&(s-=4,e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255),e.set(a,r),r+=n.position,r}function gt(e,t,n,r,i){e[r++]=14;var o=i?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=o,e[r++]=0;var a=e.write(n.value,r+4,void 0,"utf8")+1;return e[r]=255&a,e[r+1]=a>>8&255,e[r+2]=a>>16&255,e[r+3]=a>>24&255,r=r+4+a-1,e[r++]=0,r}function vt(e,t,n,r,i,o,a){e[r++]=3;var s=a?e.write(t,r,void 0,"ascii"):e.write(t,r,void 0,"utf8");r+=s,e[r++]=0;var u=r,c={$ref:n.collection||n.namespace,$id:n.oid};null!=n.db&&(c.$db=n.db),c=Object.assign(c,n.fields);var l=mt(e,c,!1,r,i+1,o),d=l-u;return e[u++]=255&d,e[u++]=d>>8&255,e[u++]=d>>16&255,e[u++]=d>>24&255,l}function mt(e,t,n,r,i,o,a,u){void 0===n&&(n=!1),void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=!1),void 0===a&&(a=!0),void 0===u&&(u=[]),r=r||0,u=u||[],u.push(t);var c=r+4;if(Array.isArray(t))for(var l=0;l<t.length;l++){var d="".concat(l),f=t[l];if("function"===typeof(null===f||void 0===f?void 0:f.toBSON)&&(f=f.toBSON()),"string"===typeof f)c=ze(e,d,f,c,!0);else if("number"===typeof f)c=Xe(e,d,f,c,!0);else{if("bigint"===typeof f)throw new x("Unsupported type BigInt, please use Decimal128");if("boolean"===typeof f)c=et(e,d,f,c,!0);else if(f instanceof Date||U(f))c=tt(e,d,f,c,!0);else if(void 0===f)c=Ze(e,d,0,c,!0);else if(null===f)c=Ze(e,d,0,c,!0);else if("ObjectId"===f["_bsontype"]||"ObjectID"===f["_bsontype"])c=ot(e,d,f,c,!0);else if(N(f))c=at(e,d,f,c,!0);else if(f instanceof RegExp||j(f))c=nt(e,d,f,c,!0);else if("object"===(0,s.default)(f)&&null==f["_bsontype"])c=st(e,d,f,c,n,i,o,a,!0,u);else if("object"===(0,s.default)(f)&&Pe(f)&&"Decimal128"===f._bsontype)c=ut(e,d,f,c,!0);else if("Long"===f["_bsontype"]||"Timestamp"===f["_bsontype"])c=ct(e,d,f,c,!0);else if("Double"===f["_bsontype"])c=dt(e,d,f,c,!0);else if("function"===typeof f&&o)c=ft(e,d,f,c,0,0,!0);else if("Code"===f["_bsontype"])c=pt(e,d,f,c,n,i,o,a,!0);else if("Binary"===f["_bsontype"])c=ht(e,d,f,c,!0);else if("Symbol"===f["_bsontype"])c=gt(e,d,f,c,!0);else if("DBRef"===f["_bsontype"])c=vt(e,d,f,c,i,o,!0);else if("BSONRegExp"===f["_bsontype"])c=rt(e,d,f,c,!0);else if("Int32"===f["_bsontype"])c=lt(e,d,f,c,!0);else if("MinKey"===f["_bsontype"]||"MaxKey"===f["_bsontype"])c=it(e,d,f,c,!0);else if("undefined"!==typeof f["_bsontype"])throw new x("Unrecognized or invalid _bsontype: ".concat(String(f["_bsontype"])))}}else if(t instanceof Le||function(e){return"[object Map]"===Object.prototype.toString.call(e)}(t)){var p=t.entries(),h=!1;while(!h){var g=p.next();if(h=!!g.done,!h){d=g.value[0],f=g.value[1];var v=(0,s.default)(f);if("string"===typeof d&&!Ke.has(d)){if(null!=d.match(Ye))throw Error("key "+d+" must not contain null bytes");if(n){if("$"===d[0])throw Error("key "+d+" must not start with '$'");if(~d.indexOf("."))throw Error("key "+d+" must not contain '.'")}}if("string"===v)c=ze(e,d,f,c);else if("number"===v)c=Xe(e,d,f,c);else{if("bigint"===v||M(f)||$(f))throw new x("Unsupported type BigInt, please use Decimal128");if("boolean"===v)c=et(e,d,f,c);else if(f instanceof Date||U(f))c=tt(e,d,f,c);else if(null===f||void 0===f&&!1===a)c=Ze(e,d,0,c);else if("ObjectId"===f["_bsontype"]||"ObjectID"===f["_bsontype"])c=ot(e,d,f,c);else if(N(f))c=at(e,d,f,c);else if(f instanceof RegExp||j(f))c=nt(e,d,f,c);else if("object"===v&&null==f["_bsontype"])c=st(e,d,f,c,n,i,o,a,!1,u);else if("object"===v&&"Decimal128"===f["_bsontype"])c=ut(e,d,f,c);else if("Long"===f["_bsontype"]||"Timestamp"===f["_bsontype"])c=ct(e,d,f,c);else if("Double"===f["_bsontype"])c=dt(e,d,f,c);else if("Code"===f["_bsontype"])c=pt(e,d,f,c,n,i,o,a);else if("function"===typeof f&&o)c=ft(e,d,f,c,0,0,o);else if("Binary"===f["_bsontype"])c=ht(e,d,f,c);else if("Symbol"===f["_bsontype"])c=gt(e,d,f,c);else if("DBRef"===f["_bsontype"])c=vt(e,d,f,c,i,o);else if("BSONRegExp"===f["_bsontype"])c=rt(e,d,f,c);else if("Int32"===f["_bsontype"])c=lt(e,d,f,c);else if("MinKey"===f["_bsontype"]||"MaxKey"===f["_bsontype"])c=it(e,d,f,c);else if("undefined"!==typeof f["_bsontype"])throw new x("Unrecognized or invalid _bsontype: ".concat(String(f["_bsontype"])))}}}}else{if("function"===typeof(null===t||void 0===t?void 0:t.toBSON)&&(t=t.toBSON(),null!=t&&"object"!==(0,s.default)(t)))throw new x("toBSON function did not return an object");for(var d in t){f=t[d];"function"===typeof(null===f||void 0===f?void 0:f.toBSON)&&(f=f.toBSON());v=(0,s.default)(f);if("string"===typeof d&&!Ke.has(d)){if(null!=d.match(Ye))throw Error("key "+d+" must not contain null bytes");if(n){if("$"===d[0])throw Error("key "+d+" must not start with '$'");if(~d.indexOf("."))throw Error("key "+d+" must not contain '.'")}}if("string"===v)c=ze(e,d,f,c);else if("number"===v)c=Xe(e,d,f,c);else{if("bigint"===v)throw new x("Unsupported type BigInt, please use Decimal128");if("boolean"===v)c=et(e,d,f,c);else if(f instanceof Date||U(f))c=tt(e,d,f,c);else if(void 0===f)!1===a&&(c=Ze(e,d,0,c));else if(null===f)c=Ze(e,d,0,c);else if("ObjectId"===f["_bsontype"]||"ObjectID"===f["_bsontype"])c=ot(e,d,f,c);else if(N(f))c=at(e,d,f,c);else if(f instanceof RegExp||j(f))c=nt(e,d,f,c);else if("object"===v&&null==f["_bsontype"])c=st(e,d,f,c,n,i,o,a,!1,u);else if("object"===v&&"Decimal128"===f["_bsontype"])c=ut(e,d,f,c);else if("Long"===f["_bsontype"]||"Timestamp"===f["_bsontype"])c=ct(e,d,f,c);else if("Double"===f["_bsontype"])c=dt(e,d,f,c);else if("Code"===f["_bsontype"])c=pt(e,d,f,c,n,i,o,a);else if("function"===typeof f&&o)c=ft(e,d,f,c,0,0,o);else if("Binary"===f["_bsontype"])c=ht(e,d,f,c);else if("Symbol"===f["_bsontype"])c=gt(e,d,f,c);else if("DBRef"===f["_bsontype"])c=vt(e,d,f,c,i,o);else if("BSONRegExp"===f["_bsontype"])c=rt(e,d,f,c);else if("Int32"===f["_bsontype"])c=lt(e,d,f,c);else if("MinKey"===f["_bsontype"]||"MaxKey"===f["_bsontype"])c=it(e,d,f,c);else if("undefined"!==typeof f["_bsontype"])throw new x("Unrecognized or invalid _bsontype: ".concat(String(f["_bsontype"])))}}}u.pop(),e[c++]=0;var m=c-r;return e[r++]=255&m,e[r++]=m>>8&255,e[r++]=m>>16&255,e[r++]=m>>24&255,c}var yt=I.alloc(17825792);function _t(e){yt.length<e&&(yt=I.alloc(e))}function bt(e,t){void 0===t&&(t={});var n="boolean"===typeof t.checkKeys&&t.checkKeys,r="boolean"===typeof t.serializeFunctions&&t.serializeFunctions,i="boolean"!==typeof t.ignoreUndefined||t.ignoreUndefined,o="number"===typeof t.minInternalBufferSize?t.minInternalBufferSize:17825792;yt.length<o&&(yt=I.alloc(o));var a=mt(yt,e,n,0,0,r,i,[]),s=I.alloc(a);return yt.copy(s,0,0,s.length),s}function wt(e,t,n){void 0===n&&(n={});var r="boolean"===typeof n.checkKeys&&n.checkKeys,i="boolean"===typeof n.serializeFunctions&&n.serializeFunctions,o="boolean"!==typeof n.ignoreUndefined||n.ignoreUndefined,a="number"===typeof n.index?n.index:0,s=mt(yt,e,r,0,0,i,o);return yt.copy(t,a,0,s),a+s-1}function St(e,t){return void 0===t&&(t={}),We(e instanceof I?e:q(e),t)}function It(e,t){void 0===t&&(t={}),t=t||{};var n="boolean"===typeof t.serializeFunctions&&t.serializeFunctions,r="boolean"!==typeof t.ignoreUndefined||t.ignoreUndefined;return $e(e,n,r)}function Ct(e,t,n,r,i,o){for(var a=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},o),s=q(e),u=t,c=0;c<n;c++){var l=s[u]|s[u+1]<<8|s[u+2]<<16|s[u+3]<<24;a.index=u,r[i+c]=We(s,a),u+=l}return u}var Tt={Binary:Q,Code:Z,DBRef:te,Decimal128:ve,Double:me,Int32:ye,Long:oe,UUID:X,Map:Le,MaxKey:_e,MinKey:be,ObjectId:Ce,ObjectID:Ce,BSONRegExp:Te,BSONSymbol:Oe,Timestamp:xe,EJSON:De,setInternalBufferSize:_t,serialize:bt,serializeWithBufferAndIndex:wt,deserialize:St,calculateObjectSize:It,deserializeStream:Ct,BSONError:E,BSONTypeError:x},Ot=Tt;t.default=Ot}).call(this,n("f3b9")["default"],n("0ee4"),n("0b64")["default"],n("0b64")["default"])},ba27:function(e,t){e.exports=function(e,t){var n=-1,r=Array(e);while(++n<e)r[n]=t(n);return r}},bc94:function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.MultiLineString=void 0;var i=r(n("3b2d")),o=n("a4d5"),a=n("8539"),s=n("2152"),u=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=function(){function e(e){if(!(0,a.isArray)(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+(0,i.default)(e));if(0===e.length)throw new Error("Polygon must contain 1 linestring at least");e.forEach((function(e){if(!(e instanceof s.LineString))throw new TypeError('"lines" must be of type LineString[]. Received type '+(0,i.default)(e)+"[]")})),this.lines=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"MultiLineString",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))},t},e.prototype.toJSON=function(){return{type:"MultiLineString",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}},e.validate=function(e){var t,n,r,i;if("MultiLineString"!==e.type||!(0,a.isArray)(e.coordinates))return!1;try{for(var o=u(e.coordinates),s=o.next();!s.done;s=o.next()){var c=s.value;try{for(var l=(r=void 0,u(c)),d=l.next();!d.done;d=l.next()){var f=d.value;if(!(0,a.isNumber)(f[0])||!(0,a.isNumber)(f[1]))return!1}}catch(p){r={error:p}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}}catch(h){t={error:h}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return o.SYMBOL_GEO_MULTI_LINE_STRING},enumerable:!0,configurable:!0}),e}();t.MultiLineString=c},bd01:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.CloudbaseCache=void 0;var r=n("59ad"),i=n("6e68"),o=n("c7a0"),a=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},c=function(e){function t(t){var n=e.call(this)||this;return n.root=t,t.tcbCacheObject||(t.tcbCacheObject={}),n}return a(t,e),t.prototype.setItem=function(e,t){this.root.tcbCacheObject[e]=t},t.prototype.getItem=function(e){return this.root.tcbCacheObject[e]},t.prototype.removeItem=function(e){delete this.root.tcbCacheObject[e]},t.prototype.clear=function(){delete this.root.tcbCacheObject},t}(r.AbstractStorage);var l=function(){function t(e){this.keys={};var t=e.persistence,n=e.platformInfo,r=void 0===n?{}:n,a=e.keys,s=void 0===a?{}:a;this.platformInfo=r,this.storage||(this.persistenceTag=this.platformInfo.adapter.primaryStorage||t,this.storage=function(e,t){switch(e){case"local":return t.localStorage?t.localStorage:((0,i.printWarn)(o.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new c(t.root));case"none":return new c(t.root);default:return t.localStorage?t.localStorage:((0,i.printWarn)(o.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new c(t.root))}}(this.persistenceTag,this.platformInfo.adapter),this.keys=s)}return Object.defineProperty(t.prototype,"mode",{get:function(){return this.storage.mode||"sync"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"persistence",{get:function(){return this.persistenceTag},enumerable:!1,configurable:!0}),t.prototype.setStore=function(e,t,n){if("async"!==this.mode){if(this.storage)try{var r={version:n||"localCachev1",content:t};this.storage.setItem(e,JSON.stringify(r))}catch(a){throw new Error(JSON.stringify({code:o.ERRORS.OPERATION_FAIL,msg:"[".concat((0,o.getSdkName)(),"][").concat(o.ERRORS.OPERATION_FAIL,"]setStore failed"),info:a}))}}else(0,i.printWarn)(o.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use setStoreAsync insteed")},t.prototype.setStoreAsync=function(e,t,n){return s(this,void 0,void 0,(function(){var r;return u(this,(function(i){switch(i.label){case 0:if(!this.storage)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),r={version:n||"localCachev1",content:t},[4,this.storage.setItem(e,JSON.stringify(r))];case 2:return i.sent(),[3,4];case 3:return i.sent(),[2];case 4:return[2]}}))}))},t.prototype.getStore=function(t,n){var r;if("async"!==this.mode){try{if("undefined"!==typeof e&&(null===(r=Object({VUE_APP_DARK_MODE:"false",VUE_APP_NAME:"poementer",VUE_APP_PLATFORM:"app-plus",NODE_ENV:"production",BASE_URL:"/"}))||void 0===r?void 0:r.tcb_token))return Object({VUE_APP_DARK_MODE:"false",VUE_APP_NAME:"poementer",VUE_APP_PLATFORM:"app-plus",NODE_ENV:"production",BASE_URL:"/"}).tcb_token;if(!this.storage)return""}catch(u){return""}n=n||"localCachev1";var a=this.storage.getItem(t);if(!a)return"";if(a.indexOf(n)>=0){var s=JSON.parse(a);return s.content}return""}(0,i.printWarn)(o.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getStoreAsync insteed")},t.prototype.getStoreAsync=function(t,n){var r;return s(this,void 0,void 0,(function(){var i,o;return u(this,(function(a){switch(a.label){case 0:try{if("undefined"!==typeof e&&(null===(r=Object({VUE_APP_DARK_MODE:"false",VUE_APP_NAME:"poementer",VUE_APP_PLATFORM:"app-plus",NODE_ENV:"production",BASE_URL:"/"}))||void 0===r?void 0:r.tcb_token))return[2,Object({VUE_APP_DARK_MODE:"false",VUE_APP_NAME:"poementer",VUE_APP_PLATFORM:"app-plus",NODE_ENV:"production",BASE_URL:"/"}).tcb_token];if(!this.storage)return[2,""]}catch(s){return[2,""]}return n=n||"localCachev1",[4,this.storage.getItem(t)];case 1:return i=a.sent(),i&&i.indexOf(n)>=0?(o=JSON.parse(i),[2,o.content]):[2,""]}}))}))},t.prototype.removeStore=function(e){"async"!==this.mode?this.storage.removeItem(e):(0,i.printWarn)(o.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use removeStoreAsync insteed")},t.prototype.removeStoreAsync=function(e){return s(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this.storage.removeItem(e)];case 1:return t.sent(),[2]}}))}))},t}();t.CloudbaseCache=l}).call(this,n("28d0"))},be29:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRelationNodes=function(e){if(!this.$unicom)throw"this.getRelationNodes()\u9700\u4e0ep-f-unicom\u914d\u5408\u4f7f\u7528\uff01";return this.$unicom("@"+e)}},be2d:function(e,t,n){var r=n("7fdd"),i=r(Object.getPrototypeOf,Object);e.exports=i},be93:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Validate=void 0;var r=n("ae75"),i=n("3e19"),o=function(){function e(){}return e.isGeopoint=function(e,t){if(i.Util.whichType(t)!==r.FieldType.Number)throw new Error("Geo Point must be number type");var n=Math.abs(t);if("latitude"===e&&n>90)throw new Error("latitude should be a number ranges from -90 to 90");if("longitude"===e&&n>180)throw new Error("longitude should be a number ranges from -180 to 180");return!0},e.isInteger=function(e,t){if(!Number.isInteger(t))throw new Error(e+r.ErrorCode.IntergerError);return!0},e.isFieldOrder=function(e){if(-1===r.OrderDirectionList.indexOf(e))throw new Error(r.ErrorCode.DirectionError);return!0},e.isFieldPath=function(e){if(!/^[a-zA-Z0-9-_\.]/.test(e))throw new Error;return!0},e.isOperator=function(e){if(-1===r.WhereFilterOpList.indexOf(e))throw new Error(r.ErrorCode.OpStrError);return!0},e.isCollName=function(e){if(!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(e))throw new Error(r.ErrorCode.CollNameError);return!0},e.isDocID=function(e){if(!/^([a-fA-F0-9]){24}$/.test(e))throw new Error(r.ErrorCode.DocIDError);return!0},e}();t.Validate=o},bf7c:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={data:function(){return{showTip:!1}},props:{showTipProps:Boolean,title:String,content:String},watch:{showTipProps:function(e){this.setData({showTip:e})}},methods:{onClose:function(){this.setData({showTip:!this.showTip})}},created:function(){}};t.default=r},bfc0:function(e,t,n){var r=n("a535");e.exports=function(e){return r(this,e).get(e)}},c051:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.registerStorage=function(t){try{t.registerComponent(I)}catch(n){e("warn",n," at node_modules/@cloudbase/storage/dist/esm/index.js:578")}};var i,o=r(n("3b2d")),a=n("5c02"),s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)},u=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":(0,o.default)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},c=function(e,t){if("object"===("undefined"===typeof Reflect?"undefined":(0,o.default)(Reflect))&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},d=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};(function(e){e["put"]="put",e["post"]="post"})(i||(i={}));var f=a.constants.getSdkName,p=a.constants.ERRORS,h=a.constants.COMMUNITY_SITE_URL,g=a.utils.isArray,v=a.utils.isString,m=a.utils.isPalinObject,y=a.utils.execCallback,_=a.helpers.catchErrorsDecorator;function b(e){var t=e.lastIndexOf("/");return-1===t?e:e.slice(t+1)}var w=function(){function e(){}return e.prototype.uploadFile=function(e,t){return l(this,void 0,void 0,(function(){var n,r,o,a,u,c,l,h,g,m,_,b,w,S,I,C,T,O,E,x,P,k,A,R,D,L;return d(this,(function(d){switch(d.label){case 0:if(n=e.cloudPath,r=e.filePath,o=e.onUploadProgress,a=e.method,u=void 0===a?"put":a,c=e.headers,l=void 0===c?{}:c,h=e.fileContent,!v(n)||!r&&!h)throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".uploadFile] invalid params")}));return g={put:i.put,post:i.post}[u.toLocaleLowerCase()]||i.put,"storage.getUploadMetadata",m=this.request,_={path:n,method:g},g===i.put&&(_["headers"]=l),[4,m.send("storage.getUploadMetadata",_,e.customReqOpts)];case 1:return b=d.sent(),w=b.data,S=w.url,I=w.authorization,C=w.token,T=w.fileId,O=w.cosFileId,E=w.download_url,x=b.requestId,P={url:S,file:r,name:n,onUploadProgress:o,fileContent:h,fileId:T,requestId:x},k=s(s({},P),{method:i.put,headers:s(s({},l),{authorization:I,"x-cos-meta-fileid":O,"x-cos-security-token":C})}),A=s(s({},P),{method:i.post,data:{key:n,signature:I,"x-cos-meta-fileid":O,success_action_status:"201","x-cos-security-token":C}}),L={},L[i.put]={params:k,isSuccess:function(e){return e>=200&&e<300}},L[i.post]={params:A,isSuccess:function(e){return 201===e}},R=L,[4,m.upload(R[g].params)];case 2:return D=d.sent(),R[g].isSuccess(D.statusCode)?[2,y(t,null,{fileID:T,download_url:E,requestId:x})]:[2,y(t,new Error("[".concat(f(),"][").concat(p.OPERATION_FAIL,"][").concat("storage","]:").concat(D.data)))]}}))}))},e.prototype.getUploadMetadata=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i,o,a;return d(this,(function(s){switch(s.label){case 0:if(n=e.cloudPath,!v(n))throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".getUploadMetadata] invalid cloudPath")}));r=this.request,i="storage.getUploadMetadata",s.label=1;case 1:return s.trys.push([1,3,,4]),[4,r.send(i,{path:n},e.customReqOpts)];case 2:return o=s.sent(),[2,y(t,null,o)];case 3:return a=s.sent(),[2,y(t,a)];case 4:return[2]}}))}))},e.prototype.deleteFile=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i,o,a,s,u;return d(this,(function(c){switch(c.label){case 0:if(n=e.fileList,!n||!g(n)||0===n.length)throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".deleteFile] fileList must not be empty")}));for(r=0,i=n;r<i.length;r++)if(o=i[r],!o||!v(o))throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".deleteFile] fileID must be string")}));return"storage.batchDeleteFile",a=this.request,[4,a.send("storage.batchDeleteFile",{fileid_list:n},e.customReqOpts)];case 1:return s=c.sent(),s.code?[2,y(t,null,s)]:(u={fileList:s.data.delete_list,requestId:s.requestId},[2,y(t,null,u)])}}))}))},e.prototype.getTempFileURL=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i,o,a,s,u;return d(this,(function(c){switch(c.label){case 0:if(n=e.fileList,!n||!g(n)||0===n.length)throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".getTempFileURL] fileList must not be empty")}));for(r=[],i=0,o=n;i<o.length;i++)if(a=o[i],m(a)){if(!Object.prototype.hasOwnProperty.call(a,"fileID")||!Object.prototype.hasOwnProperty.call(a,"maxAge"))throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".getTempFileURL] file info must include fileID and maxAge")}));r.push({fileid:a.fileID,max_age:a.maxAge})}else{if(!v(a))throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".getTempFileURL] invalid fileList")}));r.push({fileid:a})}return"storage.batchGetDownloadUrl",s=this.request,[4,s.send("storage.batchGetDownloadUrl",{file_list:r},e.customReqOpts)];case 1:return u=c.sent(),u.code?[2,y(t,null,u)]:[2,y(t,null,{fileList:u.data.download_list,requestId:u.requestId})]}}))}))},e.prototype.downloadFile=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i,o,a,s;return d(this,(function(u){switch(u.label){case 0:if(n=e.fileID,!v(n))throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".getTempFileURL] fileID must be string")}));return[4,this.getTempFileURL.call(this,{fileList:[{fileID:n,maxAge:600}],customReqOpts:e.customReqOpts})];case 1:return r=u.sent(),i=r.fileList[0],"SUCCESS"!==i.code?[2,y(t,i)]:(o=this.request,a=encodeURI(i.download_url),[4,o.download({url:a,tempFilePath:e.tempFilePath})]);case 2:return s=u.sent(),[2,y(t,null,s)]}}))}))},e.prototype.copyFile=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l;return d(this,(function(d){switch(d.label){case 0:if(n=e.fileList,!n||!g(n)||0===n.length)throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".copyFile] fileList must not be empty")}));for(r=[],i=0,o=n;i<o.length;i++){if(a=o[i],s=a.srcPath,u=a.dstPath,!s||!u||"string"!==typeof s||"string"!==typeof u)throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".copyFile] srcPath and dstPath may not be empty")}));if(s===u)throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".copyFile] srcPath and dstPath can not be the same")}));if(b(s)!==b(u))throw new Error(JSON.stringify({code:p.INVALID_PARAMS,msg:"[".concat("storage",".copyFile] srcPath and dstPath file name must be the same")}));r.push({src_path:s,dst_path:u,overwrite:a.overwrite,remove_original:a.removeOriginal})}return"storage.batchCopyFile",c=this.request,[4,c.send("storage.batchCopyFile",{file_list:r},e.customReqOpts)];case 1:return l=d.sent(),l.code?[2,y(t,null,l)]:[2,y(t,null,{fileList:l.data.copy_list,requestId:l.requestId})]}}))}))},e.prototype.getFileInfo=function(e){var t;return l(this,void 0,void 0,(function(){var n,r,i=this;return d(this,(function(o){switch(o.label){case 0:return[4,this.getTempFileURL(e)];case 1:return n=o.sent(),(null===n||void 0===n?void 0:n.fileList)&&(null===(t=null===n||void 0===n?void 0:n.fileList)||void 0===t?void 0:t.length)>0?[4,Promise.all(n.fileList.map((function(e){return l(i,void 0,void 0,(function(){var t,n,r,i,o;return d(this,(function(a){switch(a.label){case 0:if("SUCCESS"!==e.code)return[2,{code:e.code,fileID:e.fileID,tempFileURL:e.tempFileURL}];a.label=1;case 1:return a.trys.push([1,3,,4]),t=this.request,[4,t.fetch({url:e.tempFileURL,method:"HEAD"})];case 2:return n=a.sent(),r=parseInt(n.headers["content-length"])||0,i=n.headers["content-type"]||"",o={code:e.code,fileID:e.fileID,tempFileURL:e.tempFileURL,cloudId:e.fileID,fileName:e.fileID.split("/").pop(),contentType:i,mime:i.split(";")[0].trim(),size:r},[2,o];case 3:return a.sent(),[2,{code:"FETCH_FILE_INFO_ERROR",fileID:e.fileID,tempFileURL:e.tempFileURL}];case 4:return[2]}}))}))})))]:[3,3];case 2:return r=o.sent(),[2,{fileList:r,requestId:n.requestId}];case 3:return[2,{fileList:[],requestId:n.requestId}]}}))}))},u([_({customInfo:{className:"Cloudbase",methodName:"uploadFile"},title:"\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 uploadFile() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u57df\u540d\u662f\u5426\u5728\u5b89\u5168\u57df\u540d\u5217\u8868\u4e2d\uff1ahttps://console.cloud.tencent.com/tcb/env/safety","  3 - \u4e91\u5b58\u50a8\u5b89\u5168\u89c4\u5219\u662f\u5426\u9650\u5236\u4e86\u5f53\u524d\u767b\u5f55\u72b6\u6001\u8bbf\u95ee","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(h)]}),c("design:type",Function),c("design:paramtypes",[Object,Function]),c("design:returntype",Promise)],e.prototype,"uploadFile",null),u([_({customInfo:{className:"Cloudbase",methodName:"getUploadMetadata"},title:"\u83b7\u53d6\u4e0a\u4f20\u5143\u4fe1\u606f\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 getUploadMetadata() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u57df\u540d\u662f\u5426\u5728\u5b89\u5168\u57df\u540d\u5217\u8868\u4e2d\uff1ahttps://console.cloud.tencent.com/tcb/env/safety","  3 - \u4e91\u5b58\u50a8\u5b89\u5168\u89c4\u5219\u662f\u5426\u9650\u5236\u4e86\u5f53\u524d\u767b\u5f55\u72b6\u6001\u8bbf\u95ee","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(h)]}),c("design:type",Function),c("design:paramtypes",[Object,Function]),c("design:returntype",Promise)],e.prototype,"getUploadMetadata",null),u([_({customInfo:{className:"Cloudbase",methodName:"deleteFile"},title:"\u5220\u9664\u6587\u4ef6\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 deleteFile() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u57df\u540d\u662f\u5426\u5728\u5b89\u5168\u57df\u540d\u5217\u8868\u4e2d\uff1ahttps://console.cloud.tencent.com/tcb/env/safety","  3 - \u4e91\u5b58\u50a8\u5b89\u5168\u89c4\u5219\u662f\u5426\u9650\u5236\u4e86\u5f53\u524d\u767b\u5f55\u72b6\u6001\u8bbf\u95ee","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(h)]}),c("design:type",Function),c("design:paramtypes",[Object,Function]),c("design:returntype",Promise)],e.prototype,"deleteFile",null),u([_({customInfo:{className:"Cloudbase",methodName:"getTempFileURL"},title:"\u83b7\u53d6\u6587\u4ef6\u4e0b\u8f7d\u94fe\u63a5",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 getTempFileURL() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u57df\u540d\u662f\u5426\u5728\u5b89\u5168\u57df\u540d\u5217\u8868\u4e2d\uff1ahttps://console.cloud.tencent.com/tcb/env/safety","  3 - \u4e91\u5b58\u50a8\u5b89\u5168\u89c4\u5219\u662f\u5426\u9650\u5236\u4e86\u5f53\u524d\u767b\u5f55\u72b6\u6001\u8bbf\u95ee","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(h)]}),c("design:type",Function),c("design:paramtypes",[Object,Function]),c("design:returntype",Promise)],e.prototype,"getTempFileURL",null),u([_({customInfo:{className:"Cloudbase",methodName:"downloadFile"},title:"\u4e0b\u8f7d\u6587\u4ef6\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 downloadFile() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u57df\u540d\u662f\u5426\u5728\u5b89\u5168\u57df\u540d\u5217\u8868\u4e2d\uff1ahttps://console.cloud.tencent.com/tcb/env/safety","  3 - \u4e91\u5b58\u50a8\u5b89\u5168\u89c4\u5219\u662f\u5426\u9650\u5236\u4e86\u5f53\u524d\u767b\u5f55\u72b6\u6001\u8bbf\u95ee","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(h)]}),c("design:type",Function),c("design:paramtypes",[Object,Function]),c("design:returntype",Promise)],e.prototype,"downloadFile",null),u([_({customInfo:{className:"Cloudbase",methodName:"copyFile"},title:"\u6279\u91cf\u590d\u5236\u6587\u4ef6",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 copyFile() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u57df\u540d\u662f\u5426\u5728\u5b89\u5168\u57df\u540d\u5217\u8868\u4e2d\uff1ahttps://console.cloud.tencent.com/tcb/env/safety","  3 - \u4e91\u5b58\u50a8\u5b89\u5168\u89c4\u5219\u662f\u5426\u9650\u5236\u4e86\u5f53\u524d\u767b\u5f55\u72b6\u6001\u8bbf\u95ee","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(h)]}),c("design:type",Function),c("design:paramtypes",[Object,Function]),c("design:returntype",Promise)],e.prototype,"copyFile",null),e}(),S=new w,I={name:"storage",entity:{uploadFile:S.uploadFile,deleteFile:S.deleteFile,getTempFileURL:S.getTempFileURL,downloadFile:S.downloadFile,getUploadMetadata:S.getUploadMetadata,copyFile:S.copyFile,getFileInfo:S.getFileInfo}};try{cloudbase.registerComponent(I)}catch(C){}}).call(this,n("f3b9")["default"])},c649:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[e._$s(1,"i",e.isLoading&&0===e.followings.length)?n("view",{staticClass:e._$s(1,"sc","loading"),attrs:{_i:1}},[n("text")]):e._$s(3,"e",e.followings.length>0)?[n("view",{staticClass:e._$s(4,"sc","list"),attrs:{_i:4}},e._l(e._$s(5,"f",{forItems:e.followings}),(function(t,r,i,o){return n("view",{key:e._$s(5,"f",{forIndex:i,key:r}),staticClass:e._$s("5-"+o,"sc","following-item"),attrs:{_i:"5-"+o}},[n("view",{staticClass:e._$s("6-"+o,"sc","user-info"),attrs:{"data-openid":e._$s("6-"+o,"a-data-openid",t._openid),_i:"6-"+o},on:{click:e.openUserProfile}},[n("image",{staticClass:e._$s("7-"+o,"sc","avatar"),attrs:{src:e._$s("7-"+o,"a-src",t.avatarUrl||e.defaultAvatar),"data-index":e._$s("7-"+o,"a-data-index",r),_i:"7-"+o},on:{error:e.onAvatarError}}),n("view",{staticClass:e._$s("8-"+o,"sc","info-text"),attrs:{_i:"8-"+o}},[n("text",{staticClass:e._$s("9-"+o,"sc","name"),attrs:{_i:"9-"+o}},[e._v(e._$s("9-"+o,"t0-0",e._s(t.nickName||"\u5fae\u4fe1\u7528\u6237")))]),n("text",{staticClass:e._$s("10-"+o,"sc","bio"),attrs:{_i:"10-"+o}},[e._v(e._$s("10-"+o,"t0-0",e._s(t.bio||"\u8fd9\u4e2a\u7528\u6237\u8fd8\u6ca1\u6709\u7559\u4e0b\u7b80\u4ecb~")))])])]),n("button",{staticClass:e._$s("11-"+o,"sc","unfollow-btn"),attrs:{"data-openid":e._$s("11-"+o,"a-data-openid",t._openid),"data-index":e._$s("11-"+o,"a-data-index",r),loading:e._$s("11-"+o,"a-loading",e.pendingOpenid===t._openid),disabled:e._$s("11-"+o,"a-disabled",e.pendingOpenid===t._openid),_i:"11-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onToggleFollow(t)}}})])})),0)]:n("view",{staticClass:e._$s(12,"sc","empty"),attrs:{_i:12}},[n("text")]),e._$s(14,"i",e.followings.length>0)?n("view",{staticClass:e._$s(14,"sc","footer-hint"),attrs:{_i:14}},[e._$s(15,"i",e.isLoading)?n("view",{staticClass:e._$s(15,"sc","loading-more"),attrs:{_i:15}}):e._$s(16,"e",!e.hasMore)?n("view",{staticClass:e._$s(16,"sc","loading-more"),attrs:{_i:16}}):e._e()]):e._e()],2)},i=[]},c689:function(e,t,n){var r=n("142b"),i=n("d3d4"),o=n("b7ca");e.exports=function(e){return r(e,o,i)}},c692:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[n("view",{staticClass:e._$s(1,"sc","container"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","form-group"),attrs:{_i:2}},[n("view",{staticClass:e._$s(3,"sc","label"),attrs:{_i:3}}),n("button",{staticClass:e._$s(4,"sc","avatar-wrapper"),attrs:{_i:4},on:{click:e.onChooseAvatar}},[n("image",{staticClass:e._$s(5,"sc","avatar-preview"),attrs:{src:e._$s(5,"a-src",e.avatarUrl||"/static/images/avatar.png"),_i:5}}),e._$s(6,"i",!e.avatarUrl)?n("view",{staticClass:e._$s(6,"sc","avatar-placeholder"),attrs:{_i:6}},[n("text",{staticClass:e._$s(7,"sc","avatar-placeholder-text"),attrs:{_i:7}})]):e._e()])]),n("view",{staticClass:e._$s(8,"sc","form-group-column signature-section"),attrs:{_i:8}},[n("label",{staticClass:e._$s(9,"sc","label"),attrs:{_i:9}}),n("view",{staticClass:e._$s(10,"sc","signature-actions"),attrs:{_i:10}},[n("button",{staticClass:e._$s(11,"sc","signature-upload-btn"),attrs:{loading:e._$s(11,"a-loading",e.isProcessingSignature),disabled:e._$s(11,"a-disabled",e.isProcessingSignature),_i:11},on:{click:e.onChooseSignature}})]),n("view",{staticClass:e._$s(12,"sc","signature-tip"),attrs:{_i:12}}),e._$s(13,"i",e.signaturePreview)?n("image",{staticClass:e._$s(13,"sc","signature-preview"),attrs:{src:e._$s(13,"a-src",e.signaturePreview),_i:13}}):e._e()]),n("view",{staticClass:e._$s(14,"sc","form-group"),attrs:{_i:14}},[n("label",{staticClass:e._$s(15,"sc","label"),attrs:{_i:15}}),n("input",{staticClass:e._$s(16,"sc","input"),attrs:{id:"nickname",value:e._$s(16,"a-value",e.nickName),_i:16},on:{input:e.onNicknameInput}})]),n("view",{staticClass:e._$s(17,"sc","form-group"),attrs:{_i:17}},[n("label",{staticClass:e._$s(18,"sc","label"),attrs:{_i:18}}),n("picker",{attrs:{value:e._$s(19,"a-value",e.birthday),end:e._$s(19,"a-end",e.endDate),_i:19},on:{change:e.onBirthdayChange}},[n("view",{staticClass:e._$s(20,"sc","picker-display"),attrs:{_i:20}},[e._v(e._$s(20,"t0-0",e._s(e.birthday||"\u8bf7\u9009\u62e9\u60a8\u7684\u751f\u65e5")))])])]),n("view",{staticClass:e._$s(21,"sc","form-group-column"),attrs:{_i:21}},[n("label",{staticClass:e._$s(22,"sc","label"),attrs:{_i:22}}),n("textarea",{staticClass:e._$s(23,"sc","textarea"),attrs:{value:e._$s(23,"a-value",e.bio),_i:23},on:{input:e.onBioInput}})]),n("button",{staticClass:e._$s(24,"sc","save-button"),attrs:{loading:e._$s(24,"a-loading",e.isSaving),_i:24},on:{click:e.onSaveChanges}})]),n("canvas",{attrs:{id:"signatureCanvas",_i:25}}),n("canvas",{})])},i=[]},c785:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IS_DEBUG_MODE=t.COMMUNITY_SITE_URL=void 0,t.getProtocol=function(){return i},t.getSdkName=function(){return r},t.setProtocol=function(e){i=e},t.setSdkName=function(e){r=e};var r="@cloudbase/js-sdk";var i="https:";t.IS_DEBUG_MODE=!1;t.COMMUNITY_SITE_URL="https://support.qq.com/products/148793"},c7a0:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={OATUH_LOGINTYPE:!0};t.OATUH_LOGINTYPE=void 0;var i=n("c785");Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var o=n("7c35");Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));t.OATUH_LOGINTYPE="constants"},c7d2:function(e,t,n){"use strict";n.r(t);var r=n("7425"),i=n("ace0");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},c823:function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},c855:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("7ca3"));function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=n("139b"),u=s.formatRelativeTime,c=s.formatDate,l=n("11ca"),d=l.cloudCall,f={data:function(){return{drafts:[],isLoading:!0}},onLoad:function(){this.loadDrafts()},onShow:function(){this.loadDrafts()},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(e,t,Object.assign({pageTag:"draft-box",context:this,requireAuth:!0},n))},loadDrafts:function(){var t=this;this.setData({isLoading:!0});var n=this.$requireOpenid&&this.$requireOpenid();n?this.callCloudFunction("getMyProfileData",{action:"getDrafts",openid:n}).then((function(n){if(e("log","\u83b7\u53d6\u8349\u7a3f\u5217\u8868\u7ed3\u679c:",n," at pages/draft-box/draft-box.vue:74"),n.result&&n.result.success){var r=n.result.drafts||[],i=r.map((function(e){return a(a({},e),{},{formattedSaveTime:u(e.saveTime)||c(e.saveTime,"yyyy-MM-dd HH:mm")})}));t.setData({drafts:i,isLoading:!1})}else e("error","\u83b7\u53d6\u8349\u7a3f\u5931\u8d25:",n.result," at pages/draft-box/draft-box.vue:87"),t.setData({isLoading:!1}),uni.showToast({title:"\u52a0\u8f7d\u8349\u7a3f\u5931\u8d25",icon:"none"})})).catch((function(n){e("error","\u83b7\u53d6\u8349\u7a3f\u5931\u8d25:",n," at pages/draft-box/draft-box.vue:97"),t.setData({isLoading:!1}),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})):this.setData({isLoading:!1})},editDraft:function(t){var n=t.currentTarget.dataset.draft;if(n)try{uni.setStorageSync("editing_draft",n),uni.navigateTo({url:"/pages/add/add?mode=edit"})}catch(r){e("log","CatchClause",r," at pages/draft-box/draft-box.vue:122"),e("log","CatchClause",r," at pages/draft-box/draft-box.vue:123"),e("error","\u5b58\u50a8\u8349\u7a3f\u6570\u636e\u5931\u8d25:",r," at pages/draft-box/draft-box.vue:124"),uni.showToast({title:"\u6253\u5f00\u8349\u7a3f\u5931\u8d25",icon:"none"})}},deleteDraft:function(t){var n=this,r=t.currentTarget.dataset.draftId;r&&uni.showModal({title:"\u5220\u9664\u8349\u7a3f",content:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u8349\u7a3f\u5417\uff1f",confirmColor:"#ff4d4f",success:function(t){if(t.confirm){var i=n.$requireOpenid&&n.$requireOpenid();i&&(uni.showLoading({title:"\u5220\u9664\u4e2d..."}),n.callCloudFunction("getMyProfileData",{action:"deleteDraft",draftId:r,openid:i}).then((function(e){var t;(uni.hideLoading(),e.result&&e.result.success)?(uni.showToast({title:"\u5220\u9664\u6210\u529f",icon:"success"}),n.loadDrafts()):uni.showToast({title:(null===(t=e.result)||void 0===t?void 0:t.message)||"\u5220\u9664\u5931\u8d25",icon:"none"})})).catch((function(t){uni.hideLoading(),e("error","\u5220\u9664\u8349\u7a3f\u5931\u8d25:",t," at pages/draft-box/draft-box.vue:174"),uni.showToast({title:"\u5220\u9664\u5931\u8d25",icon:"none"})})))}}})},goToPublish:function(){uni.navigateTo({url:"/pages/add/add"})},formatTime:function(e){return u(e)||c(e,"yyyy-MM-dd HH:mm")}}};t.default=f}).call(this,n("f3b9")["default"])},c9ca:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.OR=t.NOT=t.NOR=t.LogicCommand=t.LOGIC_COMMANDS_LITERAL=t.AND=void 0,t.isKnownLogicCommand=function(e){return s&&e.operator.toUpperCase()in o},t.isLogicCommand=s;var r=n("a4d5"),i=n("3b92");t.AND="and";t.OR="or";t.NOT="not";var o;t.NOR="nor",t.LOGIC_COMMANDS_LITERAL=o,function(e){e["AND"]="and",e["OR"]="or",e["NOT"]="not",e["NOR"]="nor"}(o||(t.LOGIC_COMMANDS_LITERAL=o={}));var a=function(){function e(e,t,n){if(this._internalType=r.SYMBOL_LOGIC_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=n||r.SYMBOL_UNSET_FIELD_NAME,this.fieldName!==r.SYMBOL_UNSET_FIELD_NAME)if(Array.isArray(t)){t=t.slice(),this.operands=t;for(var o=0,a=t.length;o<a;o++){var u=t[o];(s(u)||(0,i.isQueryCommand)(u))&&(t[o]=u._setFieldName(this.fieldName))}}else{u=t;(s(u)||(0,i.isQueryCommand)(u))&&(t=u._setFieldName(this.fieldName))}}return e.prototype._setFieldName=function(t){var n=this.operands.map((function(n){return n instanceof e?n._setFieldName(t):n})),r=new e(this.operator,n,t);return r},e.prototype.and=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return r.unshift(this),new e(o.AND,r,this.fieldName)},e.prototype.or=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return r.unshift(this),new e(o.OR,r,this.fieldName)},e}();function s(e){return e&&e instanceof a&&e._internalType===r.SYMBOL_LOGIC_COMMAND}t.LogicCommand=a;var u=a;t.default=u},ca30:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("127e")),o=r(n("7ca3")),a=r(n("ee10")),s=n("139b"),u=s.formatRelativeTime,c=n("8e86"),l=c.previewImage,d=n("11ca"),f=d.cloudCall,p={data:function(){return{feedbackList:[],loading:!1,hasMore:!0,page:0,pageSize:10,isAdmin:!1,currentUserOpenid:"",statusBarHeight:0,imageUrl:""}},onLoad:function(){var e=uni.getSystemInfoSync();this.setData({statusBarHeight:e.statusBarHeight}),uni.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#ffffff"}),this.checkAdminPermission()},onShow:function(){this.isAdmin&&this.refreshFeedbackList()},onPullDownRefresh:function(){this.refreshFeedbackList(),uni.stopPullDownRefresh()},onReachBottom:function(){this.hasMore&&!this.loading&&this.loadFeedbackList()},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return f(e,t,Object.assign({pageTag:"feedback-admin",context:this},n))},checkAdminPermission:function(){var t=this;return(0,a.default)(i.default.mark((function n(){var r,o,a,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.callCloudFunction("getOpenId",{});case 3:if(r=n.sent,!r.result||!r.result.openid){n.next=17;break}if(o=r.result.openid,a=["ojYBd1_A3uCbQ1LGcHxWxOAeA5SE","ojYBd14JG3-ghYuGCI2WHmkMc9nE"],s=a.includes(o),e("log","\u53cd\u9988\u7ba1\u7406\u9875\u9762 - \u5f53\u524d\u7528\u6237:",o," at pages/feedback-admin/feedback-admin.vue:163"),e("log","\u53cd\u9988\u7ba1\u7406\u9875\u9762 - \u662f\u5426\u4e3a\u7ba1\u7406\u5458:",s," at pages/feedback-admin/feedback-admin.vue:164"),t.setData({currentUserOpenid:o,isAdmin:s}),s){n.next=14;break}return uni.showModal({title:"\u6743\u9650\u4e0d\u8db3",content:"\u60a8\u6ca1\u6709\u6743\u9650\u8bbf\u95ee\u53cd\u9988\u7ba1\u7406\u529f\u80fd",showCancel:!1,success:function(){uni.navigateBack()}}),n.abrupt("return");case 14:t.loadFeedbackList(),n.next=18;break;case 17:throw new Error("\u65e0\u6cd5\u83b7\u53d6\u7528\u6237\u4fe1\u606f");case 18:n.next=26;break;case 20:n.prev=20,n.t0=n["catch"](0),e("log","CatchClause",n.t0," at pages/feedback-admin/feedback-admin.vue:189"),e("log","CatchClause",n.t0," at pages/feedback-admin/feedback-admin.vue:190"),e("error","\u6743\u9650\u68c0\u67e5\u5931\u8d25:",n.t0," at pages/feedback-admin/feedback-admin.vue:191"),uni.showModal({title:"\u9519\u8bef",content:"\u6743\u9650\u68c0\u67e5\u5931\u8d25\uff0c\u65e0\u6cd5\u8bbf\u95ee\u6b64\u9875\u9762",showCancel:!1,success:function(){uni.navigateBack()}});case 26:case"end":return n.stop()}}),n,null,[[0,20]])})))()},loadFeedbackList:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.loading){var r=this.page,i=this.pageSize,o=n?0:r;this.setData({loading:!0}),this.callCloudFunction("feedbackManager",{action:"getFeedbackList",skip:o*i,limit:i}).then((function(e){if(e.result&&e.result.success){var r=e.result.feedbackList||[];r.forEach((function(e){e.formattedCreateTime=t.formatTime(e.createTime)}));var a=n?r:t.feedbackList.concat(r);t.setData({feedbackList:a,page:o+1,hasMore:r.length===i})}else{var s;uni.showToast({title:(null===(s=e.result)||void 0===s?void 0:s.message)||"\u52a0\u8f7d\u5931\u8d25",icon:"none"})}})).catch((function(t){e("error","\u52a0\u8f7d\u53cd\u9988\u5217\u8868\u5931\u8d25:",t," at pages/feedback-admin/feedback-admin.vue:238"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){t.setData({loading:!1})}))}},refreshFeedbackList:function(){this.setData({feedbackList:[],page:0,hasMore:!0}),this.loadFeedbackList(!0)},formatTime:function(e){return u(e)},previewImage:function(e){return l(e,{fallbackToast:!1})},deleteFeedback:function(t){var n=t.currentTarget.dataset.id,r=t.currentTarget.dataset.index,i=this;uni.showModal({title:"\u786e\u8ba4\u5220\u9664",content:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u53cd\u9988\u5417\uff1f",confirmColor:"#ff4d4f",success:function(t){t.confirm&&(uni.showLoading({title:"\u5220\u9664\u4e2d..."}),this.callCloudFunction("feedbackManager",{action:"deleteFeedback",feedbackId:n}).then((function(e){if(uni.hideLoading(),e.result&&e.result.success){uni.showToast({title:"\u5220\u9664\u6210\u529f",icon:"success"});var t=i.feedbackList.filter((function(e,t){return t!==r}));i.setData({feedbackList:t})}else{var n;uni.showToast({title:(null===(n=e.result)||void 0===n?void 0:n.message)||"\u5220\u9664\u5931\u8d25",icon:"none"})}})).catch((function(t){uni.hideLoading(),e("error","\u5220\u9664\u53cd\u9988\u5931\u8d25:",t," at pages/feedback-admin/feedback-admin.vue:308"),uni.showToast({title:"\u5220\u9664\u5931\u8d25",icon:"none"})})))}})},markAsProcessed:function(t){var n=t.currentTarget.dataset.id,r=t.currentTarget.dataset.index,i=this;uni.showLoading({title:"\u5904\u7406\u4e2d..."}),this.callCloudFunction("feedbackManager",{action:"markAsProcessed",feedbackId:n}).then((function(e){var t,n;(uni.hideLoading(),e.result&&e.result.success)?(uni.showToast({title:"\u5df2\u6807\u8bb0\u4e3a\u5904\u7406",icon:"success"}),i.setData((t={},(0,o.default)(t,"feedbackList[".concat(r,"].isProcessed"),!0),(0,o.default)(t,"feedbackList[".concat(r,"].processedTime"),new Date),t))):uni.showToast({title:(null===(n=e.result)||void 0===n?void 0:n.message)||"\u64cd\u4f5c\u5931\u8d25",icon:"none"})})).catch((function(t){uni.hideLoading(),e("error","\u6807\u8bb0\u5904\u7406\u5931\u8d25:",t," at pages/feedback-admin/feedback-admin.vue:351"),uni.showToast({title:"\u64cd\u4f5c\u5931\u8d25",icon:"none"})}))},goBack:function(){uni.navigateBack()}}};t.default=p}).call(this,n("f3b9")["default"])},cb25:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("8cb3")),o=r(n("8cb3")),a=n("8e86"),s=a.previewImage,u=n("fcd5"),c=u.normalizePostList,l=n("11ca"),d=l.cloudCall,f={components:{skeleton:i.default},data:function(){return{searchKeyword:"",searchResults:[],isSearching:!1,searchHistory:[],hotSearches:["\u8bd7\u6b4c","\u539f\u521b","\u751f\u6d3b","\u611f\u609f","\u65c5\u884c","\u7f8e\u98df","\u6444\u5f71","\u8bfb\u4e66"],searchTimer:null,img:""}},onLoad:function(e){this.loadSearchHistory()},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(e,t,Object.assign({pageTag:"search",context:this},n))},onSearchInput:function(e){var t=this,n=e.detail.value;if(this.setData({searchKeyword:n}),this.searchTimer&&clearTimeout(this.searchTimer),n.trim()){var r=setTimeout((function(){t.performSearch(n)}),500);this.setData({searchTimer:r})}else this.setData({searchResults:[],isSearching:!1})},onSearchConfirm:function(e){var t=e.detail.value.trim();t&&(this.searchTimer&&(clearTimeout(this.searchTimer),this.setData({searchTimer:null})),this.setData({searchKeyword:t}),this.performSearch(t))},clearSearch:function(){this.searchTimer&&clearTimeout(this.searchTimer),this.setData({searchKeyword:"",searchResults:[],isSearching:!1,searchTimer:null})},performSearch:function(t){var n=this,r=t||this.searchKeyword;e("log","\u6267\u884c\u641c\u7d22\uff0c\u5173\u952e\u8bcd:",r,"\u4f20\u5165\u53c2\u6570:",t,"\u5f53\u524d\u6570\u636e:",this.searchKeyword," at pages/search/search.vue:260"),r.trim()&&(this.setData({searchResults:[],isSearching:!0,searchKeyword:r}),this.saveSearchHistory(r),this.callCloudFunction("searchPosts",{keyword:r,limit:20}).then((function(t){if(e("log","\u641c\u7d22\u7ed3\u679c:",t," at pages/search/search.vue:280"),t.result&&t.result.success){var i=c(t.result.posts||[]);e("log","\u8bbe\u7f6e\u641c\u7d22\u7ed3\u679c:",i.length,"\u6761\u7ed3\u679c\uff0c\u5173\u952e\u8bcd:",r," at pages/search/search.vue:283"),n.setData({searchResults:i})}else uni.showToast({title:"\u641c\u7d22\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u641c\u7d22\u5931\u8d25:",t," at pages/search/search.vue:294"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){n.setData({isSearching:!1})})))},selectHistoryKeyword:function(e){var t=this,n=e.currentTarget.dataset.keyword;this.setData({searchKeyword:n},(function(){t.performSearch(n)}))},selectHotKeyword:function(e){var t=this,n=e.currentTarget.dataset.keyword;this.setData({searchKeyword:n},(function(){t.performSearch(n)}))},clearHistory:function(){var e=this;uni.showModal({title:"\u786e\u8ba4\u6e05\u7a7a",content:"\u786e\u5b9a\u8981\u6e05\u7a7a\u641c\u7d22\u5386\u53f2\u5417\uff1f",success:function(t){t.confirm&&(uni.removeStorageSync("searchHistory"),e.setData({searchHistory:[]}))}})},loadSearchHistory:function(){try{var t=uni.getStorageSync("searchHistory")||[];this.setData({searchHistory:t.slice(0,10)})}catch(n){e("log","CatchClause",n," at pages/search/search.vue:356"),e("log","CatchClause",n," at pages/search/search.vue:357"),e("error","\u52a0\u8f7d\u641c\u7d22\u5386\u53f2\u5931\u8d25:",n," at pages/search/search.vue:358")}},saveSearchHistory:function(t){try{var n=uni.getStorageSync("searchHistory")||[];n=n.filter((function(e){return e!==t})),n.unshift(t),n=n.slice(0,20),uni.setStorageSync("searchHistory",n),this.setData({searchHistory:n.slice(0,10)})}catch(r){e("log","CatchClause",r," at pages/search/search.vue:380"),e("log","CatchClause",r," at pages/search/search.vue:381"),e("error","\u4fdd\u5b58\u641c\u7d22\u5386\u53f2\u5931\u8d25:",r," at pages/search/search.vue:382")}},goBack:function(){uni.navigateBack()},onPostTap:function(e){var t=e.currentTarget.dataset.postid;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},onTagClick:function(e){var t=e.currentTarget.dataset.tag;uni.navigateTo({url:"/pages/tag-filter/tag-filter?tag=".concat(encodeURIComponent(t))})},onCommentClick:function(e){var t=e.currentTarget.dataset.postid;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},handlePreview:function(e){return s(e,{fallbackToast:!1})},onAvatarError:function(t){e("error","\u5934\u50cf\u52a0\u8f7d\u5931\u8d25",t.detail," at pages/search/search.vue:422")},onImageError:function(t){e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",t.detail," at pages/search/search.vue:427")},navigateToUserProfile:function(e){var t=e.currentTarget.dataset.userId;uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(t)})}}};t.default=f,t.default.components=Object.assign({skeleton:o.default},t.default.components||{})}).call(this,n("f3b9")["default"])},cc66:function(e,t,n){var r=n("61e0");function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(i.Cache||r),n}i.Cache=r,e.exports=i},cd8e:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[e._$s(1,"i",e.isLoading&&0===e.favorites.length)?n("view",{staticClass:e._$s(1,"sc","loading-container"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","loading-text"),attrs:{_i:2}})]):e._$s(3,"e",e.favorites.length>0)?n("view",{staticClass:e._$s(3,"sc","favorites-container"),attrs:{_i:3}},e._l(e._$s(4,"f",{forItems:e.favorites}),(function(t,r,i,o){return n("view",{key:e._$s(4,"f",{forIndex:i,key:r}),class:e._$s("4-"+o,"c","post-item-wrapper "+(t.isOriginal?"original-post":"")),attrs:{_i:"4-"+o}},[n("view",{staticClass:e._$s("5-"+o,"sc","author-info-outside"),attrs:{_i:"5-"+o}},[e._$s("6-"+o,"i",t.postAuthorAvatar)?n("image",{staticClass:e._$s("6-"+o,"sc","author-avatar"),attrs:{src:e._$s("6-"+o,"a-src",t.postAuthorAvatar),"data-postindex":e._$s("6-"+o,"a-data-postindex",r),"data-user-id":e._$s("6-"+o,"a-data-user-id",t.postAuthorOpenid),_i:"6-"+o},on:{error:e.onAvatarError,load:e.onAvatarLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.navigateToUserProfile(t)}}}):e._e(),n("text",{staticClass:e._$s("7-"+o,"sc","author-name"),attrs:{_i:"7-"+o}},[e._v(e._$s("7-"+o,"t0-0",e._s(t.postAuthorName)))])]),n("navigator",{staticClass:e._$s("8-"+o,"sc","post-content-navigator"),attrs:{url:e._$s("8-"+o,"a-url","/pages/post-detail/post-detail?id="+t.postId),_i:"8-"+o}},[n("view",{staticClass:e._$s("9-"+o,"sc","post-item"),attrs:{_i:"9-"+o}},[n("view",{staticClass:e._$s("10-"+o,"sc","post-title"),attrs:{_i:"10-"+o}},[e._v(e._$s("10-"+o,"t0-0",e._s(t.postTitle)))]),e._$s("11-"+o,"i",t.postIsPoem&&t.postAuthor)?n("view",{staticClass:e._$s("11-"+o,"sc","poem-author"),attrs:{_i:"11-"+o}},[e._v(e._$s("11-"+o,"t0-0",e._s(t.postAuthor)))]):e._e(),e._$s("12-"+o,"i",t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("12-"+o,"sc","image-container-wrapper"),style:e._$s("12-"+o,"s",t.imageStyle),attrs:{"data-src":e._$s("12-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("12-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"12-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}},[e._$s("13-"+o,"i",1===t.imageUrls.length)?[n("image",{staticClass:e._$s("14-"+o,"sc","post-image"),attrs:{id:e._$s("14-"+o,"a-id","single-image-"+t.postId),src:e._$s("14-"+o,"a-src",t.imageUrls[0]),"data-postid":e._$s("14-"+o,"a-data-postid",t.postId),"data-postindex":e._$s("14-"+o,"a-data-postindex",r),_i:"14-"+o},on:{error:e.onImageError,load:e.onImageLoad}})]:e._$s("15-"+o,"e",t.imageUrls.length>1)?[n("swiper",{staticClass:e._$s("16-"+o,"sc","image-swiper"),style:e._$s("16-"+o,"s","height: "+(e.swiperHeights[r]?e.swiperHeights[r]+"px":"220px")+";"),attrs:{id:e._$s("16-"+o,"a-id","swiper-"+t.postId),_i:"16-"+o}},[e._l(e._$s("17-"+o,"f",{forItems:t.imageUrls}),(function(i,a,s,u){return[n("swiper-item",{key:e._$s("17-"+o,"f",{forIndex:s,keyIndex:0,key:a+"_0"})},[n("image",{staticClass:e._$s("19-"+o+"-"+u,"sc","post-image"),attrs:{src:e._$s("19-"+o+"-"+u,"a-src",i),"data-src":e._$s("19-"+o+"-"+u,"a-data-src",i),"data-original-image-urls":e._$s("19-"+o+"-"+u,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),"data-postid":e._$s("19-"+o+"-"+u,"a-data-postid",t.postId),"data-postindex":e._$s("19-"+o+"-"+u,"a-data-postindex",r),"data-imgindex":e._$s("19-"+o+"-"+u,"a-data-imgindex",a),_i:"19-"+o+"-"+u},on:{error:e.onImageError,load:e.onImageLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._e()],2):e._e(),e._$s("20-"+o,"i",t.postContent)?n("view",{staticClass:e._$s("20-"+o,"sc","post-content"),attrs:{_i:"20-"+o}},[e._v(e._$s("20-"+o,"t0-0",e._s(t.postContent)))]):e._e(),e._$s("21-"+o,"i",t.postTags&&t.postTags.length>0)?n("view",{staticClass:e._$s("21-"+o,"sc","post-tags"),attrs:{_i:"21-"+o}},e._l(e._$s("22-"+o,"f",{forItems:t.postTags}),(function(t,r,i,a){return n("text",{key:e._$s("22-"+o,"f",{forIndex:i,key:r}),staticClass:e._$s("22-"+o+"-"+a,"sc","post-tag"),attrs:{"data-tag":e._$s("22-"+o+"-"+a,"a-data-tag",t),_i:"22-"+o+"-"+a},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onTagClick(t)}}},[e._v(e._$s("22-"+o+"-"+a,"t0-0",e._s(t)))])})),0):e._e()])]),n("view",{staticClass:e._$s("23-"+o,"sc","delete-section"),attrs:{_i:"23-"+o}},[n("view",{staticClass:e._$s("24-"+o,"sc","time-left"),attrs:{_i:"24-"+o}},[n("text",{staticClass:e._$s("25-"+o,"sc","favorite-time"),attrs:{_i:"25-"+o}},[e._v(e._$s("25-"+o,"t0-0",e._s(t.formattedCreateTime||"\u672a\u77e5\u65f6\u95f4")))])]),n("view",{staticClass:e._$s("26-"+o,"sc","button-group"),attrs:{_i:"26-"+o}},[n("button",{staticClass:e._$s("27-"+o,"sc","remove-favorite-btn"),attrs:{"data-favorite-id":e._$s("27-"+o,"a-data-favorite-id",t._id),"data-index":e._$s("27-"+o,"a-data-index",r),_i:"27-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.removeFavorite(t)}}})])])])})),0):n("view",{staticClass:e._$s(28,"sc","empty-container"),attrs:{_i:28}},[n("view",{staticClass:e._$s(29,"sc","empty-icon"),attrs:{_i:29}}),n("view",{staticClass:e._$s(30,"sc","empty-text"),attrs:{_i:30}}),n("view",{staticClass:e._$s(31,"sc","empty-subtext"),attrs:{_i:31}}),n("button",{attrs:{_i:32},on:{click:e.manualLoad}})]),e._$s(33,"i",e.favorites.length>0&&e.isLoading)?n("view",{staticClass:e._$s(33,"sc","loading-more"),attrs:{_i:33}},[n("view",{staticClass:e._$s(34,"sc","loading-text"),attrs:{_i:34}})]):e._e(),e._$s(35,"i",e.favorites.length>0&&!e.hasMore&&!e.isLoading)?n("view",{staticClass:e._$s(35,"sc","no-more"),attrs:{_i:35}},[n("text")]):e._e()])},i=[]},ce95:function(e,t,n){var r=n("76e0"),i=n("3ce6"),o=n("61e0");e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},cf88:function(e,t,n){var r=n("6823"),i=n("461d"),o=n("5271"),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[r(e)]}},d137:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerDate=void 0,t.ServerDateConstructor=function(e){return new i(e)};var r=n("a4d5"),i=function(){function e(e){var t=(void 0===e?{}:e).offset,n=void 0===t?0:t;this.offset=n}return Object.defineProperty(e.prototype,"_internalType",{get:function(){return r.SYMBOL_SERVER_DATE},enumerable:!0,configurable:!0}),e.prototype.parse=function(){return{$date:{offset:this.offset}}},e}();t.ServerDate=i},d2e5:function(e,t,n){var r=n("3644"),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},d3d4:function(e,t,n){var r=n("b88a"),i=n("be2d"),o=n("97d2"),a=n("0b48"),s=Object.getOwnPropertySymbols,u=s?function(e){var t=[];while(e)r(t,o(e)),e=i(e);return t}:a;e.exports=u},d500:function(e,t,n){var r=n("b6fd"),i=n("d3d4");e.exports=function(e,t){return r(e,i(e),t)}},d551:function(e,t,n){var r=n("3b2d")["default"],i=n("e6db4");e.exports=function(e){var t=i(e,"string");return"symbol"==r(t)?t:t+""},e.exports.__esModule=!0,e.exports["default"]=e.exports},d586:function(e,t,n){var r=n("9a09"),i=n("5271"),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},d5cb:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerComponent=function(e,t){var n=t.name,r=t.namespace,s=t.entity,u=t.injectEvents,c=t.IIFE,l=void 0!==c&&c;if(a[n]||r&&e[r])throw new Error(JSON.stringify({code:o.INVALID_OPERATION,msg:"Duplicate component ".concat(n)}));if(l){if(!s||"function"!==typeof s)throw new Error(JSON.stringify({code:o.INVALID_PARAMS,msg:"IIFE component's entity must be a function"}));s.call(e)}a[n]=t,r?e.prototype[r]=s:function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:var r=n;return new Date(r.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(var i=Object.keys(n),o=0,a=i;o<a.length;o++){var s=a[o];Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=e(t[s],n[s]))}return t}(e.prototype,s);if(u){var d=u.bus,f=u.events;if(!d||!f||0===f.length)return;var p=e.prototype.fire||function(){};e.prototype.events||(e.prototype.events={});var h=e.prototype.events||{};h[n]?e.prototype.events[n].events=i(i([],e.prototype.events[n].events,!0),f,!0):e.prototype.events[n]={bus:d,events:f},e.prototype.fire=function(e,t){p(e,t);for(var n=Object.keys(this.events),r=0,i=n;r<i.length;r++){var o=i[r],a=this.events[o],s=a.bus,u=a.events;if(u.includes(e)){s.fire(e,t);break}}}}},t.registerHook=function(e,t){var n=t.entity,r=t.target;if(Object.prototype.hasOwnProperty.call(e,r))throw new Error(JSON.stringify({code:o.INVALID_OPERATION,msg:"target:".concat(r," is not exist")}));var a=e.prototype[r];if("function"!==typeof a)throw new Error(JSON.stringify({code:o.INVALID_OPERATION,msg:"target:".concat(r," is not a function which is the only type supports hook")}));e.prototype[r]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.call.apply(n,i([this],e,!1)),a.call.apply(a,i([this],e,!1))}};var r=n("5c02"),i=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},o=r.constants.ERRORS,a={}},d6d6:function(e,t,n){"use strict";n.r(t);var r=n("5bbe"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},d749:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.catchErrorsDecorator=void 0;var o=n("37e5"),a=n("9e9d"),s=!1;"undefined"!==typeof navigator&&navigator.userAgent&&(s=-1!==navigator.userAgent.indexOf("Firefox"));var u=s?/(\.js\/)?__decorate(\$\d+)?<@.*\d$/:/(\/\w+\.js\.)?__decorate(\$\d+)?\s*\(.*\)$/,c=/https?:\/\/.+:\d*\/.*\.js:\d+:\d+/;function l(e){var t=e.err,n=e.className,r=e.methodName,i=e.sourceLink;if(!i)return null;var o,a=t.stack.split("\n"),u=s?/^catchErrorsDecorator\/<\/descriptor.value@.*\d$/:new RegExp("".concat(n,"\\.descriptor.value\\s*\\[as\\s").concat(r,"\\]\\s*\\(.*\\)$")),l=s?/^catchErrorsDecorator\/<\/descriptor.value/:new RegExp("".concat(n,"\\.descriptor.value\\s*\\[as\\s").concat(r,"\\]")),d=a.findIndex((function(e){return u.test(e)}));if(-1!==d){var f=a.filter((function(e,t){return t>d}));f.unshift(a[d].replace(l,"".concat(n,".").concat(r)).replace(c,i)),o=new Error,o.stack="".concat(s?"@debugger":"Error","\n").concat(f.join("\n"))}return o}t.catchErrorsDecorator=function(e){var t=e.mode,n=void 0===t?"async":t,s=e.customInfo,d=void 0===s?{}:s,f=e.title,p=e.messages,h=void 0===p?[]:p;return function(e,t,s){if(a.IS_DEBUG_MODE){var p=d.className||e.constructor.name,g=d.methodName||t,v=s.value,m=function(e){var t="",n=e.stack.split("\n"),r=n.findIndex((function(e){return u.test(e)}));if(-1!==r){var i=c.exec(n[r+1]||"");t=i?i[0]:""}return t}(new Error);s.value="sync"===n?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=l({err:new Error,className:p,methodName:g,sourceLink:m});try{return v.apply(this,e)}catch(d){var r=d,i=d.message,a=d.error,s=d.error_description,u={title:f||"".concat(p,".").concat(g," failed"),content:[{type:"error",body:d}]};if(i&&/^\{.*\}$/.test(i)){var c=JSON.parse(i);u.subtitle=i,c.code&&(n?(n.code=c.code,n.msg=c.msg):(d.code=c.code,d.message=c.msg),r=n||d,u.content=h.map((function(e){return{type:"info",body:e}})))}throw a&&s&&(u.subtitle=s,n?(n.code=a,n.msg=s):(d.code=a,d.message=s),r=n||d,u.content=h.map((function(e){return{type:"info",body:e}}))),(0,o.printGroupLog)(u),r}}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t,n,r,a,s,u,c,d;return i(this,(function(i){switch(i.label){case 0:t=l({err:new Error,className:p,methodName:g,sourceLink:m}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,v.apply(this,e)];case 2:return[2,i.sent()];case 3:throw n=i.sent(),r=n,a=n.message,s=n.error,u=n.error_description,c={title:f||"".concat(p,".").concat(g," failed"),content:[{type:"error",body:n}]},a&&/^\{.*\}$/.test(a)&&(d=JSON.parse(a),c.subtitle=d,d.code&&(t?(t.code=d.code,t.message=d.msg):(n.code=d.code,n.message=d.msg),r=t||n,c.content=h.map((function(e){return{type:"info",body:e}})))),s&&u&&(c.subtitle=u,t?(t.code=s,t.msg=u):(n.code=s,n.message=u),r=t||n,c.content=h.map((function(e){return{type:"info",body:e}}))),(0,o.printGroupLog)(c),r;case 4:return[2]}}))}))}}}}},d7ac:function(e,t,n){"use strict";n.r(t);var r=n("4da8"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},d817:function(e,t,n){"use strict";n.r(t);var r=n("b817"),i=n("b493");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},d87a:function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTabBarStatus=function(t){try{if("function"===typeof t.getTabBar&&t.getTabBar()){var n,r=t.getTabBar();return(null===(n=r.data)||void 0===n?void 0:n.selected)||null}}catch(a){e("log","\u65e0\u6cd5\u4ece\u539f\u751fgetTabBar\u83b7\u53d6\u72b6\u6001"," at utils/tabBarCompatibility.js:51")}try{var i,o=null===(i=t.$refs)||void 0===i?void 0:i.customTabBar;if(o&&o.data)return o.data.selected||null}catch(a){e("log","\u65e0\u6cd5\u4ece\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u83b7\u53d6\u72b6\u6001"," at utils/tabBarCompatibility.js:61")}try{return uni.getStorageSync("currentTabIndex")||null}catch(a){e("log","\u65e0\u6cd5\u4ece\u5b58\u50a8\u83b7\u53d6\u72b6\u6001"," at utils/tabBarCompatibility.js:68")}return null},t.isTabBarSupported=function(){try{return!("undefined"===typeof n||!n.getTabBar)||!("undefined"===typeof uni||!uni.getTabBar)}catch(e){return!1}},t.updateTabBarStatus=function(t,n){try{if("function"===typeof t.getTabBar&&t.getTabBar())return t.getTabBar().setData({selected:n}),e("log","TabBar\u72b6\u6001\u66f4\u65b0\u6210\u529f (\u539f\u751fAPI): selected=".concat(n)," at utils/tabBarCompatibility.js:18"),!0}catch(r){e("log","\u539f\u751fgetTabBar API\u4e0d\u53ef\u7528:",r.message," at utils/tabBarCompatibility.js:22")}try{return uni.setStorageSync("currentTabIndex",n),e("log","TabBar\u72b6\u6001\u5df2\u4fdd\u5b58\u5230\u5b58\u50a8: selected=".concat(n)," at utils/tabBarCompatibility.js:28"),!0}catch(r){e("log","\u5b58\u50a8\u673a\u5236\u4e0d\u53ef\u7528:",r.message," at utils/tabBarCompatibility.js:31")}return e("warn","\u539f\u751fgetTabBar API\u4e0d\u53ef\u7528\uff0c\u5f53\u524d\u5e73\u53f0\u53ef\u80fd\u4e0d\u652f\u6301getTabBar()"," at utils/tabBarCompatibility.js:34"),!1}}).call(this,n("f3b9")["default"],n("ed83")["default"])},d87b:function(e,t,n){var r=n("8a60");e.exports=function(e){return r(this.__data__,e)>-1}},d9d2:function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.setData=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Object.keys(e).forEach((function(n){if((0,i.default)(t,n,e[n]),o.test(n)&&n.endsWith("Clone")){var r=n.replace(/Clone$/,"");t.$options&&t.$options.propsData[r]&&t.$emit("update:".concat(r),e[n])}})),this.$forceUpdate(),"function"==typeof n&&this.$nextTick(n)};var i=r(n("7744"));r(n("099c"));var o=/^([^\x00-\xff]|[a-zA-Z_$])([^\x00-\xff]|[a-zA-Z0-9_$])*$/},daaa:function(e,t,n){"use strict";n.r(t);var r=n("ad15"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},db60:function(e,t){e.exports=function(e,t){return e===t||e!==e&&t!==t}},dc84:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},dceb:function(e,t,n){"use strict";n.r(t);var r=n("349f"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},dd05:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={skeleton:n("8cb3").default},i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[n("view",{staticClass:e._$s(1,"sc","container"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","background-wrapper"),attrs:{_i:2}},e._l(e._$s(3,"f",{forItems:e.bgLayers}),(function(t,r,i,o){return n("image",{key:e._$s(3,"f",{forIndex:i,key:r}),class:e._$s("3-"+o,"c","bg-image "+(t.visible?"visible":"")),attrs:{src:e._$s("3-"+o,"a-src",t.url),"data-layer-index":e._$s("3-"+o,"a-data-layer-index",r),_i:"3-"+o},on:{load:e.onBackgroundImageLoad}})})),0),n("view",{staticClass:e._$s(4,"sc","blur-background-wrapper"),attrs:{_i:4}},e._l(e._$s(5,"f",{forItems:e.bgLayers}),(function(t,r,i,o){return n("image",{key:e._$s(5,"f",{forIndex:i,key:r}),class:e._$s("5-"+o,"c","bg-image blur-image "+(t.visible?"visible":"")),attrs:{src:e._$s("5-"+o,"a-src",t.url),"data-layer-index":e._$s("5-"+o,"a-data-layer-index",r),_i:"5-"+o},on:{load:e.onBackgroundImageLoad}})})),0),e._$s(6,"i",e.isLoading&&0===e.postList.length)?n("view",{staticClass:e._$s(6,"sc","skeleton-container"),attrs:{_i:6}},[n("skeleton",{attrs:{_i:7}}),n("view",{staticClass:e._$s(8,"sc","loading-text"),attrs:{_i:8}})],1):e._e(),e._$s(9,"i",e.postList.length>0)?n("view",{staticClass:e._$s(9,"sc","poem-mode-container"),attrs:{_i:9},on:{touchstart:e.touchStart,touchend:e.touchEnd}},[n("view",{class:e._$s(10,"c","single-post-content "+(e.isTransitioning?"is-transitioning":"")),attrs:{"data-postid":e._$s(10,"a-data-postid",e.currentPost._id),_i:10},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onSinglePostTap(t)}}},[n("view",{staticClass:e._$s(11,"sc","single-author-info"),attrs:{_i:11}},[e._$s(12,"i",e.currentPost.authorAvatar)?n("image",{staticClass:e._$s(12,"sc","single-author-avatar"),attrs:{src:e._$s(12,"a-src",e.currentPost.authorAvatar),_i:12}}):e._e(),n("text",{staticClass:e._$s(13,"sc","single-author-name"),attrs:{_i:13}},[e._v(e._$s(13,"t0-0",e._s(e.currentPost.authorName)))])]),e._$s(14,"i",e.currentPost.title)?n("view",{staticClass:e._$s(14,"sc","single-post-title"),attrs:{_i:14}},[e._v(e._$s(14,"t0-0",e._s(e.currentPost.title)))]):e._e(),e._$s(15,"i",e.currentPost.isPoem)?n("view",{staticClass:e._$s(15,"sc","single-poem-author"),attrs:{_i:15}},[e._v(e._$s(15,"t0-0",e._s(e.currentPost.author||e.currentPost.authorName)))]):e._e(),e._$s(16,"i",e.currentPost.content)?n("view",{staticClass:e._$s(16,"sc","single-post-content-text"),attrs:{_i:16}},[e._v(e._$s(16,"t0-0",e._s(e.currentPost.content)))]):e._e(),e._$s(17,"i",e.currentAuthorSignature)?n("view",{staticClass:e._$s(17,"sc","user-signature"),attrs:{_i:17}},[n("image",{staticClass:e._$s(18,"sc","signature-image"),attrs:{src:e._$s(18,"a-src",e.currentAuthorSignature),_i:18},on:{error:e.onSignatureError,load:e.onSignatureLoad}})]):e._e()]),e._$s(19,"i",0===e.postList.length&&!e.isLoading)?n("view",{staticClass:e._$s(19,"sc","empty-state"),attrs:{_i:19}},[n("view",{staticClass:e._$s(20,"sc","empty-icon"),attrs:{_i:20}}),n("view",{staticClass:e._$s(21,"sc","empty-text"),attrs:{_i:21}}),n("view",{staticClass:e._$s(22,"sc","empty-subtext"),attrs:{_i:22}})]):e._e()]):e._e()])])},o=[]},dd3e:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports["default"]=e.exports},dd56:function(e,t,n){"use strict";n.r(t);var r=n("7505"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},df29:function(e,t,n){"use strict";function r(e,t){e.$children.map((function(e){"function"==typeof e[t]&&e[t](),r(e,t)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.pageLifetimes=void 0;var i={onLoad:function(){},onShow:function(){r(this,"handlePageShow")},onHide:function(){r(this,"handlePageHide")},onResize:function(){r(this,"handlePageResize")}};t.pageLifetimes=i},df59:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Snapshot=void 0;var r=function(){return function(e){var t,n,r=e.id,i=e.docChanges,o=e.docs,a=e.msgType,s=e.type;Object.defineProperties(this,{id:{get:function(){return r},enumerable:!0},docChanges:{get:function(){return t||(t=JSON.parse(JSON.stringify(i))),t},enumerable:!0},docs:{get:function(){return n||(n=JSON.parse(JSON.stringify(o))),n},enumerable:!0},msgType:{get:function(){return a},enumerable:!0},type:{get:function(){return s},enumerable:!0}})}}();t.Snapshot=r},df61:function(e,t,n){(function(t){var r=n("127e"),i=n("ee10"),o=n("11ca"),a=o.cloudCall,s=n("fe58"),u=null;try{u=n("b99c")}catch(g){t("warn","[likeService] dataCache \u4e0d\u53ef\u7528\uff0c\u8df3\u8fc7\u7f13\u5b58\u540c\u6b65"," at utils/likeService.js:10")}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Number(e);return Number.isFinite(n)?n:t}function l(e,n,r){if("function"===typeof e)try{return e(n,r)}catch(g){t("warn","[likeService] likeIcon resolver \u6267\u884c\u5931\u8d25",g," at utils/likeService.js:28")}return s.getLikeIcon(n,r)}function d(e){var t=e.votes,n=e.isLiked,r=e.icon;return{votes:t,isLiked:n,likeIcon:r}}function f(e){if("undefined"!==typeof uni&&"function"===typeof uni.showToast)try{uni.showToast({title:e||"\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",icon:"none"})}catch(g){t("warn","[likeService] showToast \u8c03\u7528\u5931\u8d25",g," at utils/likeService.js:52")}}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.pageTag,n=void 0===t?"like-service":t,r=e.context,i=void 0===r?null:r,o=e.currentVotes,a=void 0===o?0:o,u=e.currentIsLiked,l=void 0!==u&&u,d=e.likeIconResolver,f=void 0===d?s.getLikeIcon:d,p=e.requireAuth,h=void 0===p||p,g=e.retry,v=void 0===g?0:g,m=e.updateCache,y=void 0===m||m,_=e.showErrorToast,b=void 0===_||_,w=e.cloudOptions,S=void 0===w?{}:w;return{pageTag:n,context:i,currentVotes:c(a,0),currentIsLiked:Boolean(l),likeIconResolver:f,requireAuth:h,retry:v,updateCache:y,showErrorToast:b,cloudOptions:S}}function h(){return h=i(r.mark((function e(n){var i,o,s,h,g,v,m,y,_,b,w,S,I,C,T,O,E,x,P,k,A,R,D,L=arguments;return r.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=L.length>1&&void 0!==L[1]?L[1]:{},n){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("[likeService] postId \u4e0d\u80fd\u4e3a\u7a7a")));case 3:return o=p(i),s=o.pageTag,h=o.context,g=o.currentVotes,v=o.currentIsLiked,m=o.likeIconResolver,y=o.requireAuth,_=o.retry,b=o.updateCache,w=o.showErrorToast,S=o.cloudOptions,I=c(g,0),C=Boolean(v),T=l(m,I,C),O=d({votes:I,isLiked:C,icon:T}),e.prev=8,e.next=11,a("vote",{postId:n},Object.assign({pageTag:"likeService:".concat(s),context:h,requireAuth:y,retry:_},S));case 11:E=e.sent,e.next=19;break;case 14:return e.prev=14,e.t0=e["catch"](8),t("error","[likeService] \u8c03\u7528\u4e91\u51fd\u6570\u5931\u8d25",e.t0," at utils/likeService.js:128"),w&&f(e.t0&&e.t0.message),e.abrupt("return",{success:!1,error:e.t0,rollback:O});case 19:if(x=E&&E.result?E.result:E,P=x&&!0===x.success,P){e.next=26;break}return k=x&&x.message?x.message:"\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",t("warn","[likeService] \u4e91\u51fd\u6570\u8fd4\u56de\u5931\u8d25\u7ed3\u679c",x," at utils/likeService.js:144"),w&&f(k),e.abrupt("return",{success:!1,error:x,rollback:O});case 26:if(A=c(x.votes,I),R=Boolean(x.isLiked),D=l(m,A,R),b&&u&&"function"===typeof u.updatePostLikeInCache)try{u.updatePostLikeInCache(n,A,R,D)}catch(r){t("warn","[likeService] \u540c\u6b65\u7f13\u5b58\u5931\u8d25",r," at utils/likeService.js:163")}return e.abrupt("return",{success:!0,votes:A,isLiked:R,likeIcon:D,response:x});case 31:case"end":return e.stop()}}),e,null,[[8,14]])}))),h.apply(this,arguments)}e.exports={togglePostLike:function(e){return h.apply(this,arguments)}}}).call(this,n("f3b9")["default"])},e0b7:function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionReference=void 0;var i=n("e6b4"),o=n("5e49"),a=r(n("0d49")),s=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(e){function t(t,n){return e.call(this,t,n)||this}return s(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),t.prototype.doc=function(e){if("string"!==typeof e&&"number"!==typeof e)throw new Error("docId\u5fc5\u987b\u4e3a\u5b57\u7b26\u4e32\u6216\u6570\u5b57");return new i.DocumentReference(this._db,this._coll,e)},t.prototype.add=function(e,t){var n=new i.DocumentReference(this._db,this._coll,void 0);return n.create(e,t)},t.prototype.aggregate=function(){return new a.default(this._db,this._coll)},t}(o.Query);t.CollectionReference=u},e0e4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HunYuanOpenSimpleModel=void 0;var r=n("7a9b"),i=n("31a3"),o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},u=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="hunyuan-open/v1/chat/completions",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e,t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return[4,this.req({url:this.url,data:o(o({},(0,i.processInput)(e)),{stream:!1}),stream:!1,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,o(o({},n),{rawResponse:n})]}}))}))},e.prototype.doStream=function(e,t){return a(this,void 0,void 0,(function(){var n,a,u,c,l;return s(this,(function(s){switch(s.label){case 0:return n=null,[4,this.req({url:this.url,data:o(o({},(0,i.processInput)(e)),{stream:!0}),stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return a=s.sent(),u=(0,r.toPolyfillReadable)(a),c=(0,r.intoStandardStream)(u),l=c.pipeThrough(new r.TransformStream({transform:function(e,t){var i=e.choices.map((function(e){var t=e.delta;return null==n&&(n=(0,r.isToolCallAssistantMessage)(t)),n?o(o({},e),{finish_reason:"tool_calls",delta:t}):e})),a=o(o({},e),{choices:i});t.enqueue(o(o({},a),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(l)]}}))}))},e}();t.HunYuanOpenSimpleModel=u},e321:function(e,t,n){var r=n("1c01");e.exports=function(e,t,n){return null==e?e:r(e,t,n)}},e4de:function(e,t,n){var r=n("2024"),i=n("4d0d"),o=r(i,"Set");e.exports=o},e61a:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAUTH2_LOGINTYPE_PREFIX=t.LOGINTYPE=t.DEFAULT_PROTOCOL=t.DATA_VERSION=void 0,t.getBaseEndPoint=function(e,t){void 0===t&&(t="CLOUD_API");var n=g(e,t||"CLOUD_API"),r=n.protocol,i=n.baseUrl,o="".concat(r).concat(i);return o.match(/(http(s)?:)?\/\/([^/?#]*)/)[0]},t.getEndPointInfo=g,t.getSdkName=function(){return c},t.getSdkVersion=function(){return u},t.setEndPointInfo=h,t.setGatewayEndPointWithEnv=function(e,t,n){void 0===n&&(n="ap-shanghai");n=n||"ap-shanghai";var r="//".concat(e,".api.tcloudbasegateway.com/v1");o.includes(n)||(r="//".concat(e,".api.intl.tcloudbasegateway.com/v1"));h({endPointKey:"GATEWAY",env:e,baseUrl:r,protocol:t})},t.setRegionLevelEndpoint=function(e,t,n){var r="//".concat(e,".").concat(t||"ap-shanghai",".tcb-api.tencentcloudapi.com/web");h({env:e,region:t,baseUrl:r,protocol:n,endPointKey:"CLOUD_API"})},t.setSdkName=function(e){c=e,a(e)},t.setSdkVersion=function(e){u=e};var r=n("5c02"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=["ap-shanghai","ap-guangzhou","ap-shenzhen-fsi","ap-shanghai-fsi","ap-nanjing","ap-beijing","ap-chengdu","ap-chongqing","ap-hongkong"],a=r.constants.setSdkName,s=r.constants.setProtocol,u="",c="@cloudbase/js-sdk";t.DATA_VERSION="2020-01-10";var l,d=[],f=["env","endPointKey","region"];function p(e){return d.find((function(t){return f.filter((function(t){return null!=e[t]})).every((function(n){return t[n]===e[n]}))}))}function h(e){var t,n;e.protocol&&!/:$/.test(e.protocol)&&(e.protocol="".concat(e.protocol,":"));var r=p(e);r?(null!=e.baseUrl&&(r.baseUrl=e.baseUrl),null!=e.protocol&&(r.protocol=e.protocol)):d.push(i(i({},e),{protocol:null!==(t=e.protocol)&&void 0!==t?t:"https:"})),"CLOUD_API"===e.endPointKey&&s(null!==(n=e.protocol)&&void 0!==n?n:"https:")}function g(e,t,n){return p({env:e,endPointKey:t,region:n})}t.DEFAULT_PROTOCOL="https:",t.LOGINTYPE=l,function(e){e["NULL"]="NULL",e["ANONYMOUS"]="ANONYMOUS",e["WECHAT"]="WECHAT",e["WECHAT_PUBLIC"]="WECHAT-PUBLIC",e["WECHAT_OPEN"]="WECHAT-OPEN",e["CUSTOM"]="CUSTOM",e["EMAIL"]="EMAIL",e["USERNAME"]="USERNAME",e["PHONE"]="PHONE"}(l||(t.LOGINTYPE=l={}));t.OAUTH2_LOGINTYPE_PREFIX="OAUTH2"},e6b4:function(e,t,n){"use strict";var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentReference=void 0;var i=r(n("3b2d")),o=n("95fb"),a=n("b8e2"),s=n("3e19"),u=n("831e"),c=n("4316"),l=n("3325"),d=n("ae75"),f=n("f208"),p=function(){return p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},p.apply(this,arguments)},h=function(){function e(e,t,n,r){var i=this;void 0===r&&(r={}),this.watch=function(e){var t=(0,f.getWsInstance)(i._db);return t.watch(p(p({},e),{envId:i._db.config.env,collectionName:i._coll,query:JSON.stringify({_id:i.id})}))},this._db=e,this._coll=t,this.id=n,this.request=new a.Db.reqClass(this._db.config),this.projection=r}return e.prototype.create=function(e,t){t=t||(0,o.createPromiseCallback)();var n={collectionName:this._coll,data:(0,c.serialize)(e)};return this.id&&(n["_id"]=this.id),this.request.send("database.addDocument",n).then((function(e){e.code?t(0,e):t(0,{id:e.data._id,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},e.prototype.set=function(e,t){if(t=t||(0,o.createPromiseCallback)(),!this.id)return Promise.resolve({code:"INVALID_PARAM",message:"docId\u4e0d\u80fd\u4e3a\u7a7a"});if(!e||"object"!==(0,i.default)(e))return Promise.resolve({code:"INVALID_PARAM",message:"\u53c2\u6570\u5fc5\u9700\u662f\u975e\u7a7a\u5bf9\u8c61"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"\u4e0d\u80fd\u66f4\u65b0_id\u7684\u503c"});var n=!1;if(function e(t){if("object"===(0,i.default)(t))for(var r in t)t[r]instanceof l.UpdateCommand?n=!0:"object"===(0,i.default)(t[r])&&e(t[r])}(e),n)return Promise.resolve({code:"DATABASE_REQUEST_FAILED",message:"update operator complicit"});var r={collectionName:this._coll,queryType:d.QueryType.DOC,data:(0,c.serialize)(e),multi:!1,merge:!1,upsert:!0};return this.id&&(r["query"]={_id:this.id}),this.request.send("database.updateDocument",r).then((function(e){e.code?t(0,e):t(0,{updated:e.data.updated,upsertedId:e.data.upserted_id,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},e.prototype.update=function(e,t){if(t=t||(0,o.createPromiseCallback)(),!e||"object"!==(0,i.default)(e))return Promise.resolve({code:"INVALID_PARAM",message:"\u53c2\u6570\u5fc5\u9700\u662f\u975e\u7a7a\u5bf9\u8c61"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"\u4e0d\u80fd\u66f4\u65b0_id\u7684\u503c"});var n={_id:this.id},r={collectionName:this._coll,data:u.UpdateSerializer.encode(e),query:n,queryType:d.QueryType.DOC,multi:!1,merge:!0,upsert:!1};return this.request.send("database.updateDocument",r).then((function(e){e.code?t(0,e):t(0,{updated:e.data.updated,upsertedId:e.data.upserted_id,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},e.prototype.remove=function(e){e=e||(0,o.createPromiseCallback)();var t={_id:this.id},n={collectionName:this._coll,query:t,queryType:d.QueryType.DOC,multi:!1};return this.request.send("database.deleteDocument",n).then((function(t){t.code?e(0,t):e(0,{deleted:t.data.deleted,requestId:t.requestId})})).catch((function(t){e(t)})),e.promise},e.prototype.get=function(e){e=e||(0,o.createPromiseCallback)();var t={_id:this.id},n={collectionName:this._coll,query:t,queryType:d.QueryType.DOC,multi:!1,projection:this.projection};return this.request.send("database.queryDocument",n).then((function(t){if(t.code)e(0,t);else{var n=s.Util.formatResDocumentData(t.data.list);e(0,{data:n,requestId:t.requestId})}})).catch((function(t){e(t)})),e.promise},e.prototype.field=function(t){for(var n in t)t[n]?t[n]=1:t[n]=0;return new e(this._db,this._coll,this.id,t)},e}();t.DocumentReference=h},e6db:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[e._$s(1,"i",e.showClone)?n("view",{staticClass:e._$s(1,"sc","modal-overlay"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","modal-content"),attrs:{_i:2}},[n("view",{staticClass:e._$s(3,"sc","modal-header"),attrs:{_i:3}},[n("view",{staticClass:e._$s(4,"sc","modal-title"),attrs:{_i:4}}),n("view",{staticClass:e._$s(5,"sc","close-btn"),attrs:{_i:5},on:{click:e.hideModal}})]),n("view",{staticClass:e._$s(6,"sc","modal-body"),attrs:{_i:6}},[e._$s(7,"i",e.isLoading)?n("view",{staticClass:e._$s(7,"sc","loading-container"),attrs:{_i:7}},[n("view",{staticClass:e._$s(8,"sc","loading-text"),attrs:{_i:8}})]):e._$s(9,"e",e.folders.length>0)?n("view",{staticClass:e._$s(9,"sc","folders-list"),attrs:{_i:9}},e._l(e._$s(10,"f",{forItems:e.folders}),(function(t,r,i,o){return n("view",{key:e._$s(10,"f",{forIndex:i,key:r}),class:e._$s("10-"+o,"c","folder-item "+(e.selectedFolderId===t._id?"selected":"")),attrs:{"data-folder-id":e._$s("10-"+o,"a-data-folder-id",t._id),_i:"10-"+o},on:{click:e.selectFolder}},[n("view",{staticClass:e._$s("11-"+o,"sc","folder-icon"),attrs:{_i:"11-"+o}}),n("view",{staticClass:e._$s("12-"+o,"sc","folder-info"),attrs:{_i:"12-"+o}},[n("view",{staticClass:e._$s("13-"+o,"sc","folder-name"),attrs:{_i:"13-"+o}},[e._v(e._$s("13-"+o,"t0-0",e._s(t.name)))]),n("view",{staticClass:e._$s("14-"+o,"sc","folder-count"),attrs:{_i:"14-"+o}},[e._v(e._$s("14-"+o,"t0-0",e._s(t.itemCount)))])]),e._$s("15-"+o,"i",e.selectedFolderId===t._id)?n("view",{staticClass:e._$s("15-"+o,"sc","selected-icon"),attrs:{_i:"15-"+o}}):e._e()])})),0):n("view",{staticClass:e._$s(16,"sc","empty-state"),attrs:{_i:16}},[n("view",{staticClass:e._$s(17,"sc","empty-icon"),attrs:{_i:17}}),n("view",{staticClass:e._$s(18,"sc","empty-text"),attrs:{_i:18}}),n("view",{staticClass:e._$s(19,"sc","empty-subtext"),attrs:{_i:19}})])]),n("view",{staticClass:e._$s(20,"sc","modal-footer"),attrs:{_i:20}},[n("button",{staticClass:e._$s(21,"sc","modal-btn secondary-btn"),attrs:{_i:21},on:{click:e.createFolder}}),n("button",{staticClass:e._$s(22,"sc","modal-btn primary-btn"),attrs:{disabled:e._$s(22,"a-disabled",!e.selectedFolderId),_i:22},on:{click:e.confirmFavorite}})])])]):e._e(),e._$s(23,"i",e.showCreateModal)?n("view",{staticClass:e._$s(23,"sc","modal-overlay"),attrs:{_i:23}},[n("view",{staticClass:e._$s(24,"sc","modal-content create-modal"),attrs:{_i:24}},[n("view",{staticClass:e._$s(25,"sc","modal-header"),attrs:{_i:25}},[n("view",{staticClass:e._$s(26,"sc","modal-title"),attrs:{_i:26}}),n("view",{staticClass:e._$s(27,"sc","close-btn"),attrs:{_i:27},on:{click:[e.hideCreateModal,function(t){return t.stopPropagation(),t.preventDefault(),e.trueFun(t)}]}})]),n("view",{staticClass:e._$s(28,"sc","modal-body"),attrs:{_i:28}},[n("input",{staticClass:e._$s(29,"sc","folder-name-input"),attrs:{value:e._$s(29,"a-value",e.newFolderName),_i:29},on:{input:e.onFolderNameInput,click:function(t){return t.stopPropagation(),t.preventDefault(),e.trueFun(t)}}})]),n("view",{staticClass:e._$s(30,"sc","modal-footer"),attrs:{_i:30}},[n("button",{staticClass:e._$s(31,"sc","modal-btn secondary-btn"),attrs:{_i:31},on:{click:e.hideCreateModal}}),n("button",{staticClass:e._$s(32,"sc","modal-btn primary-btn"),attrs:{disabled:e._$s(32,"a-disabled",!e.newFolderName),_i:32},on:{click:e.createNewFolder}})])])]):e._e()])},i=[]},e6db4:function(e,t,n){var r=n("3b2d")["default"];e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports["default"]=e.exports},e775:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("382e");Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}));var i=n("2152");Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var o=n("b8f2");Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n("0d22");Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var s=n("bc94");Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var u=n("a42e");Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}))},e7f4:function(e,t,n){var r=n("2b37"),i=n("e868"),o=n("5b20"),a=n("d2e5"),s=n("2256");e.exports=function(e,t,n){var u=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new u(+e);case"[object DataView]":return i(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,n);case"[object Map]":return new u;case"[object Number]":case"[object String]":return new u(e);case"[object RegExp]":return o(e);case"[object Set]":return new u;case"[object Symbol]":return a(e)}}},e868:function(e,t,n){var r=n("2b37");e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},e89e:function(e,t,n){"use strict";n.r(t);var r=n("1ac7"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},e8c8:function(e,t,n){var r=n("6823"),i=n("5271");e.exports=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==r(e)}},eb9b:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.decodeInternalDataType=function(e){return(0,i.deserialize)(e)},t.encodeInternalDataType=function(e){return(0,i.serialize)(e)},t.flattenObject=function(e){return u(e,(function(e){return!1}),[],[e])},t.flattenQueryObject=function(e){return u(e,c,[],[e])},t.isConversionRequired=c,t.mergeConditionAfterEncode=function(t,n,i){n[i]||delete t[i];for(var o in n)t[o]?(0,r.isArray)(t[o])?t[o].push(n[o]):(0,r.isObject)(t[o])?(0,r.isObject)(n[o])?Object.assign(t[o],n[o]):(e("warn","unmergable condition, query is object but condition is "+(0,r.getType)(n)+", can only overwrite",n,i," at node_modules/@cloudbase/database/dist/esm/serializer/common.js:91"),t[o]=n[o]):(e("warn","to-merge query is of type "+(0,r.getType)(t)+", can only overwrite",t,n,i," at node_modules/@cloudbase/database/dist/esm/serializer/common.js:96"),t[o]=n[o]):t[o]=n[o]};var r=n("8539"),i=n("4316"),o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{while((void 0===t||t-- >0)&&!(r=o.next()).done)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a},s=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e};function u(e,t,n,i){var a=o({},e);for(var c in e)if(!/^\$/.test(c)){var l=e[c];if(l&&(0,r.isObject)(l)&&!t(l)){if(i.indexOf(l)>-1)throw new Error("Cannot convert circular structure to JSON");var d=s(n,[c]),f=s(i,[l]),p=u(l,t,d,f);a[c]=p;var h=!1;for(var g in p)/^\$/.test(g)?h=!0:(a[c+"."+g]=p[g],delete a[c][g]);h||delete a[c]}}return a}function c(e){return(0,r.isInternalObject)(e)||(0,r.isDate)(e)||(0,r.isRegExp)(e)}}).call(this,n("f3b9")["default"])},ec46:function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.StorageType=t.AbstractStorage=t.AbstractSDKRequest=void 0,t.StorageType=r,function(e){e["local"]="local",e["none"]="none",e["session"]="session"}(r||(t.StorageType=r={}));var i=function(){return function(){}}();t.AbstractSDKRequest=i;var o=function(){return function(){}}();t.AbstractStorage=o},ecca:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("127e")),o=r(n("7ca3")),a=r(n("ee10"));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=n("139b"),l=c.formatRelativeTime,d=n("8e86"),f=d.previewImage,p=n("11ca"),h=p.cloudCall,g=n("2b90"),v=n("0efe"),m=n("fcd5"),y=m.normalizePostList,_={mixins:[v,g],data:function(){return{folderId:"",folderName:"",favorites:[],pageSize:10,swiperHeights:{},imageClampHeights:{},imgindex:0,img:""}},onLoad:function(t){var n=t.folderId,r=t.folderName||"";if(n){var i=r;try{i=decodeURIComponent(r||"")}catch(o){e("log","CatchClause",o," at pages/favorite-content/favorite-content.vue:179"),e("log","CatchClause",o," at pages/favorite-content/favorite-content.vue:180"),i=r}this.setData({folderId:n,folderName:i,favorites:[]}),uni.setNavigationBarTitle({title:i||"\u6536\u85cf\u5939"}),this.initPagination(this.loadFavorites,{pageSize:this.pageSize})}else uni.showToast({title:"\u53c2\u6570\u9519\u8bef\uff1a\u6536\u85cf\u5939ID\u4e3a\u7a7a",icon:"none"})},onShow:function(){},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h(e,t,Object.assign({pageTag:"favorite-content",context:this,requireAuth:!0},n))},loadFavorites:function(t){var n=this;return(0,a.default)(i.default.mark((function r(){var o,a,s,c,l,d,f,p,h,g,v;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(o=t.page,a=t.isRefresh,n.folderId){r.next=6;break}throw s=new Error("\u53c2\u6570\u9519\u8bef\uff1a\u6536\u85cf\u5939ID\u4e3a\u7a7a"),s.__toastShown=!0,uni.showToast({title:"\u53c2\u6570\u9519\u8bef\uff1a\u6536\u85cf\u5939ID\u4e3a\u7a7a",icon:"none"}),s;case 6:return a&&n.setData({favorites:[],swiperHeights:{},imageClampHeights:{}}),c=o*n.pageSize,1e4,l=null,d=new Promise((function(e,t){l=setTimeout((function(){var e=new Error("\u52a0\u8f7d\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5");e.code="LOAD_TIMEOUT",e.__toastShown=!0,uni.showToast({title:"\u52a0\u8f7d\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5",icon:"none"}),t(e)}),1e4)})),r.prev=11,r.next=14,Promise.race([n.callCloudFunction("getMyProfileData",{action:"getFavoritesByFolder",folderId:n.folderId,skip:c,limit:n.pageSize}),d]);case 14:if(f=r.sent,l&&clearTimeout(l),e("log","\u4e91\u51fd\u6570\u8c03\u7528\u6210\u529f\uff0c\u8fd4\u56de\u7ed3\u679c:",f," at pages/favorite-content/favorite-content.vue:253"),f.result&&!0===f.result.success){r.next=23;break}throw p=f.result&&f.result.message||"\u52a0\u8f7d\u5931\u8d25",uni.showToast({title:p,icon:"none"}),h=new Error(p),h.__toastShown=!0,h;case 23:return g=y(f.result.favorites||[]).map((function(t,r){var i=u({},t);return!i.formattedCreateTime&&i.createTime&&(i.formattedCreateTime=n.formatTime(i.createTime)),i.postCreateTime&&!i.formattedPostCreateTime&&(i.formattedPostCreateTime=n.formatTime(i.postCreateTime)),i.favoriteTime&&!i.formattedFavoriteTime&&(i.formattedFavoriteTime=n.formatTime(i.favoriteTime)),!i.postTitle&&i.title&&(i.postTitle=i.title),!i.postContent&&i.content&&(i.postContent=i.content),!i.postImageUrls&&i.imageUrls&&(i.postImageUrls=i.imageUrls),!i.postOriginalImageUrls&&i.originalImageUrls&&(i.postOriginalImageUrls=i.originalImageUrls),!i.postAuthorAvatar&&i.authorAvatar&&(i.postAuthorAvatar=i.authorAvatar),!i.postAuthorName&&i.authorName&&(i.postAuthorName=i.authorName),!i.imageStyle&&i.imageUrls&&i.imageUrls.length>0&&(i.imageStyle="height: 0; padding-bottom: 75%;"),e("log","\u3010\u6536\u85cf\u5939\u3011\u5e16\u5b50".concat(r,"\u56fe\u7247\u6570\u636e:"),{postId:i._id,postTitle:i.title||i.postTitle,imageUrls:i.imageUrls,originalImageUrls:i.originalImageUrls,hasImageUrls:!!(i.imageUrls&&i.imageUrls.length>0)}," at pages/favorite-content/favorite-content.vue:298"),i})),v=0===o||a?g:n.favorites.concat(g),n.setData({favorites:v}),r.abrupt("return",{list:g,hasMore:g.length===n.pageSize});case 29:throw r.prev=29,r.t0=r["catch"](11),l&&clearTimeout(l),e("error","\u52a0\u8f7d\u6536\u85cf\u6570\u636e\u5931\u8d25:",r.t0," at pages/favorite-content/favorite-content.vue:322"),r.t0&&r.t0.__toastShown||uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"}),r.t0;case 35:return r.prev=35,l&&clearTimeout(l),r.finish(35);case 38:case"end":return r.stop()}}),r,null,[[11,29,35,38]])})))()},manualLoad:function(){this.folderId?this.refresh():uni.showToast({title:"\u6536\u85cf\u5939ID\u4e3a\u7a7a",icon:"none"})},onFavoriteTap:function(e){var t=e.currentTarget.dataset.postId;uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(t)})},onFavoriteLongPress:function(e){var t=this,n=e.currentTarget.dataset.favoriteId,r=e.currentTarget.dataset.postTitle;uni.showActionSheet({itemList:["\u53d6\u6d88\u6536\u85cf"],success:function(e){0===e.tapIndex&&t.removeFavorite(n,r)}})},removeFavorite:function(t){var n=this,r=t.currentTarget.dataset.favoriteId,i=t.currentTarget.dataset.index,o=this.favorites[i],a=o?o.postTitle:"\u672a\u77e5\u6807\u9898";uni.showModal({title:"\u786e\u8ba4\u53d6\u6d88\u6536\u85cf",content:'\u786e\u5b9a\u8981\u53d6\u6d88\u6536\u85cf"'.concat(a,'"\u5417\uff1f'),success:function(t){t.confirm&&(uni.showLoading({title:"\u5904\u7406\u4e2d..."}),n.callCloudFunction("getMyProfileData",{action:"removeFromFavorite",favoriteId:r}).then((function(e){if(uni.hideLoading(),e.result&&e.result.success){uni.showToast({title:"\u53d6\u6d88\u6536\u85cf\u6210\u529f"});var t=n.favorites.filter((function(e){return e._id!==r}));n.setData({favorites:t})}else uni.showToast({title:e.result.message||"\u64cd\u4f5c\u5931\u8d25",icon:"none"})})).catch((function(t){uni.hideLoading(),e("error","\u53d6\u6d88\u6536\u85cf\u5931\u8d25:",t," at pages/favorite-content/favorite-content.vue:407"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})))}})},onImagePreview:function(e){return f(e,{fallbackToast:!1})},handlePreview:function(e){var t=f(e,{fallbackToast:!1});return t||uni.showToast({title:"\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",icon:"none"}),t},onImageError:function(t){e("error","\u3010\u6536\u85cf\u5939\u3011\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",t," at pages/favorite-content/favorite-content.vue:437");var n=t.detail.src;e("error","\u3010\u6536\u85cf\u5939\u3011\u5931\u8d25\u7684\u56fe\u7247URL:",n," at pages/favorite-content/favorite-content.vue:439");var r=t.currentTarget.dataset,i=r.postindex,o=r.imgindex;if(void 0!==i&&void 0!==o){var a=this.favorites[i];e("error","\u3010\u6536\u85cf\u5939\u3011\u56fe\u7247\u52a0\u8f7d\u5931\u8d25\u7684\u4e0a\u4e0b\u6587:",{postId:a?a._id:"unknown",postTitle:a?a.title:"unknown",imageIndex:o,imageUrl:n,allImageUrls:a?a.imageUrls:"unknown"}," at pages/favorite-content/favorite-content.vue:444")}e("error","\u3010\u6536\u85cf\u5939\u3011\u56fe\u7247\u52a0\u8f7d\u5931\u8d25\u8be6\u60c5:",{error:t.detail,src:n,dataset:t.currentTarget.dataset}," at pages/favorite-content/favorite-content.vue:453")},formatTime:function(e){return l(e)},onAvatarError:function(t){e("error","\u5934\u50cf\u52a0\u8f7d\u5931\u8d25:",t," at pages/favorite-content/favorite-content.vue:467");var n=t.currentTarget.dataset.postindex;if(void 0!==n){var r=this.favorites;r[n]&&(r[n].postAuthorAvatar="/static/images/avatar.png",this.setData({favorites:r}))}},onAvatarLoad:function(e){},navigateToUserProfile:function(e){var t=e.currentTarget.dataset.userId;t&&uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(t)})},onTagClick:function(e){var t=e.currentTarget.dataset.tag;t&&uni.navigateTo({url:"/pages/search/search?keyword=".concat(encodeURIComponent(t))})}}};t.default=_}).call(this,n("f3b9")["default"])},ecf3:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n("11ca"),i=r.cloudCall,o={data:function(){return{folders:[],isLoading:!0,showCreateModal:!1,newFolderName:"",editingFolder:null,showEditModal:!1,editFolderName:""}},onLoad:function(){e("log","=== \u6536\u85cf\u5939\u5217\u8868\u9875\u9762 onLoad ==="," at pages/favorite-folders/favorite-folders.vue:89"),this.loadFolders()},onShow:function(){e("log","=== \u6536\u85cf\u5939\u5217\u8868\u9875\u9762 onShow ==="," at pages/favorite-folders/favorite-folders.vue:93"),this.loadFolders()},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(e,t,Object.assign({pageTag:"favorite-folders",context:this,requireAuth:!0},n))},loadFolders:function(){var t=this;this.setData({isLoading:!0}),this.callCloudFunction("getMyProfileData",{action:"getFavoriteFolders"}).then((function(n){if(e("log","\u83b7\u53d6\u6536\u85cf\u5939\u8fd4\u56de\u6570\u636e:",n," at pages/favorite-folders/favorite-folders.vue:108"),n.result&&n.result.success){var r=n.result.folders||[];e("log","\u6536\u85cf\u5939\u6570\u636e:",r," at pages/favorite-folders/favorite-folders.vue:111"),r.forEach((function(t,n){e("log","\u6536\u85cf\u5939".concat(n,":"),{_id:t._id,name:t.name,itemCount:t.itemCount,createTime:t.createTime}," at pages/favorite-folders/favorite-folders.vue:115")})),t.setData({folders:r,isLoading:!1})}else{var i;e("error","\u83b7\u53d6\u6536\u85cf\u5939\u5931\u8d25:",n.result," at pages/favorite-folders/favorite-folders.vue:127"),uni.showToast({title:(null===(i=n.result)||void 0===i?void 0:i.message)||"\u52a0\u8f7d\u5931\u8d25",icon:"none"}),t.setData({isLoading:!1,folders:[]})}})).catch((function(n){e("error","\u83b7\u53d6\u6536\u85cf\u5939\u5931\u8d25:",n," at pages/favorite-folders/favorite-folders.vue:138"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"}),t.setData({isLoading:!1})}))},showCreateFolder:function(){this.setData({showCreateModal:!0,newFolderName:""})},hideCreateModal:function(){this.setData({showCreateModal:!1})},onFolderNameInput:function(e){this.setData({newFolderName:e.detail.value})},createFolder:function(){var t=this,n=this.newFolderName.trim();n?(e("log","\u5f00\u59cb\u521b\u5efa\u6536\u85cf\u5939\uff0c\u540d\u79f0:",n," at pages/favorite-folders/favorite-folders.vue:181"),uni.showLoading({title:"\u521b\u5efa\u4e2d..."}),this.callCloudFunction("getMyProfileData",{action:"createFavoriteFolder",folderName:n}).then((function(n){uni.hideLoading(),e("log","\u521b\u5efa\u6536\u85cf\u5939\u4e91\u51fd\u6570\u8fd4\u56de:",n," at pages/favorite-folders/favorite-folders.vue:190"),n&&n.result?n.result.success?(uni.showToast({title:"\u521b\u5efa\u6210\u529f"}),t.setData({showCreateModal:!1,newFolderName:""}),setTimeout((function(){t.loadFolders()}),300)):(e("error","\u521b\u5efa\u6536\u85cf\u5939\u4e1a\u52a1\u5931\u8d25:",n.result," at pages/favorite-folders/favorite-folders.vue:208"),uni.showToast({title:n.result.message||"\u521b\u5efa\u5931\u8d25",icon:"none"})):(e("error","\u521b\u5efa\u6536\u85cf\u5939\u8fd4\u56de\u683c\u5f0f\u5f02\u5e38:",n," at pages/favorite-folders/favorite-folders.vue:215"),uni.showToast({title:"\u521b\u5efa\u5931\u8d25\uff1a\u8fd4\u56de\u683c\u5f0f\u9519\u8bef",icon:"none"}))})).catch((function(t){uni.hideLoading(),e("error","\u521b\u5efa\u6536\u85cf\u5939\u4e91\u51fd\u6570\u8c03\u7528\u5931\u8d25:",t," at pages/favorite-folders/favorite-folders.vue:223"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef\uff1a"+(t.errMsg||"\u672a\u77e5\u9519\u8bef"),icon:"none"})}))):uni.showToast({title:"\u8bf7\u8f93\u5165\u6536\u85cf\u5939\u540d\u79f0",icon:"none"})},enterFolder:function(t){e("log","=== \u70b9\u51fb\u6536\u85cf\u5939\u9879 ==="," at pages/favorite-folders/favorite-folders.vue:233"),e("log","\u4e8b\u4ef6\u5bf9\u8c61:",t," at pages/favorite-folders/favorite-folders.vue:234"),e("log","dataset:",t.currentTarget.dataset," at pages/favorite-folders/favorite-folders.vue:235");var n=t.currentTarget.dataset.folderId,r=t.currentTarget.dataset.folderName;if(e("log","\u63d0\u53d6\u7684folderId:",n," at pages/favorite-folders/favorite-folders.vue:238"),e("log","\u63d0\u53d6\u7684folderName:",r," at pages/favorite-folders/favorite-folders.vue:239"),!n)return e("error","\u9519\u8bef\uff1afolderId \u4e3a\u7a7a"," at pages/favorite-folders/favorite-folders.vue:241"),void uni.showToast({title:"\u6536\u85cf\u5939ID\u4e3a\u7a7a",icon:"none"});var i="/pages/favorite-content/favorite-content?folderId=".concat(n,"&folderName=").concat(encodeURIComponent(r||""));e("log","\u8df3\u8f6cURL:",i," at pages/favorite-folders/favorite-folders.vue:249"),uni.navigateTo({url:i,success:function(){e("log","\u8df3\u8f6c\u6210\u529f"," at pages/favorite-folders/favorite-folders.vue:253")},fail:function(t){e("error","\u8df3\u8f6c\u5931\u8d25:",t," at pages/favorite-folders/favorite-folders.vue:256")}})},onFolderLongPress:function(e){var t=this,n=e.currentTarget.dataset.folderId,r=e.currentTarget.dataset.folderName;uni.showActionSheet({itemList:["\u91cd\u547d\u540d","\u5220\u9664"],success:function(e){0===e.tapIndex?t.showEditFolder(n,r):1===e.tapIndex&&t.deleteFolder(n,r)}})},showEditFolder:function(e,t){this.setData({showEditModal:!0,editingFolder:e,editFolderName:t})},hideEditModal:function(){this.setData({showEditModal:!1,editingFolder:null,editFolderName:""})},onEditFolderNameInput:function(e){this.setData({editFolderName:e.detail.value})},updateFolderName:function(){var e=this.editFolderName.trim();e?(uni.showToast({title:"\u91cd\u547d\u540d\u529f\u80fd\u5f85\u5b9e\u73b0",icon:"none"}),this.hideEditModal()):uni.showToast({title:"\u8bf7\u8f93\u5165\u6536\u85cf\u5939\u540d\u79f0",icon:"none"})},deleteFolder:function(e,t){uni.showModal({title:"\u786e\u8ba4\u5220\u9664",content:'\u786e\u5b9a\u8981\u5220\u9664\u6536\u85cf\u5939"'.concat(t,'"\u5417\uff1f\u5220\u9664\u540e\u5176\u4e2d\u7684\u6240\u6709\u6536\u85cf\u5185\u5bb9\u4e5f\u4f1a\u88ab\u5220\u9664\u3002'),success:function(e){e.confirm&&uni.showToast({title:"\u5220\u9664\u529f\u80fd\u5f85\u5b9e\u73b0",icon:"none"})}})},trueFun:function(){e("log","\u5360\u4f4d\uff1a\u51fd\u6570 true \u672a\u58f0\u660e"," at pages/favorite-folders/favorite-folders.vue:341")}}};t.default=o}).call(this,n("f3b9")["default"])},ed45:function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports["default"]=e.exports},ed83:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.Behavior=function(e){return e},t.Component=function(t){var n=function(t){var n=t.data,r=t.options,i=t.methods,o=t.behaviors,a=t.lifetimes,s=t.observers,l=t.relations,d=t.properties,p=t.pageLifetimes,h=t.externalClasses,g={mixins:[],props:{},watch:{},mpOptions:{mpObservers:[]}};return c(g),u(n,g),function(e,t){if(!e)return;t.mpOptions.options=e}(r,g),C(i,g),P(o,g),function(e,t){if(!e)return;T(e,t)}(a,g),function(e,t){if(!e)return;var n=t.mpOptions.mpObservers;Object.keys(e).forEach((function(t){n.push({paths:k(t),observer:e[t]})}))}(s,g),function(t,n){if(!t)return;Object.keys(t).forEach((function(n){var r=t[n];r.name=n,r.target=r.target?String(r.target):function(e,t){0===t.indexOf("/")&&(e="");var n=e.split("/"),r=t.split("/");n.pop();while(r.length){var i=r.shift();""!==i&&"."!==i&&(".."!==i?n.push(i):n.pop())}return n.join("/")}(e.__wxRoute,n)})),n.mpOptions.relations=t}(l,g),I(d,g),function(e,t){if(!e)return;w.forEach((function(n){var r=e[n];f(r)&&(t[b[n]]=r)}))}(p,g),function(e,t){if(!e)return;Array.isArray(e)||(e=[e]);t.mpOptions.externalClasses=e,t.mpOptions.properties||(t.mpOptions.properties=Object.create(null));e.forEach((function(e){t.mpOptions.properties[m(e)]={type:String,value:""}}))}(h,g),T(t,g),E(t),g}(t);n.mixins.unshift(Q),n.mpOptions.path=e.__wxRoute,function(e){e.onServiceAttached||(e.onServiceAttached=[]);e.onServiceAttached.push((function(){$(this,"linked")}))}(n),e.__wxComponents[e.__wxRoute]=n},t.Page=function(t){var n=function(e){var t={mixins:[],mpOptions:{}};return c(t),u(e.data,t),function(e,t){var n=Object.create(null);Object.keys(e).forEach((function(t){var r=e[t];f(r)&&-1===S.indexOf(t)&&(n[t]=r)})),t.methods=n}(e,t),function(e,t){Object.keys(e).forEach((function(n){-1!==S.indexOf(n)&&(t[n]=e[n])}))}(e,t),t}(t);n.mixins.unshift(Q),n.mpOptions.path=e.__wxRoute,e.__wxComponents[e.__wxRoute]=n},t.nextTick=t.default=void 0;var i,o=r(n("7ca3")),a=r(n("34cf")),s=r(n("951c"));function u(e,t){e&&(t.mpOptions.data=e)}function c(t){t.components=e.__wxVueOptions.components}var l=Object.prototype.toString,d=Object.prototype.hasOwnProperty;function f(e){return"function"===typeof e}function p(e){return"[object Object]"===l.call(e)}function h(e,t){return d.call(e,t)}function g(){}var v=/-(\w)/g,m=function(e){var t=Object.create(null);return function(n){var r=t[n];return r||(t[n]=e(n))}}((function(e){return e.replace(v,(function(e,t){return t?t.toUpperCase():""}))})),y={created:"onServiceCreated",attached:"onServiceAttached",ready:"mounted",moved:"moved",detached:"destroyed"},_=Object.keys(y),b={show:"onPageShow",hide:"onPageHide",resize:"onPageResize"},w=Object.keys(b),S=["onLoad","onShow","onReady","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll","onResize","onTabItemTap"];function I(e,t){e&&(t.mpOptions.properties=e)}function C(e,t){e&&(e.$emit&&(console.warn('Method "$emit" conflicts with an existing Vue instance method'),delete e.$emit),t.methods=e)}function T(e,t){_.forEach((function(n){h(e,n)&&(t[y[n]]||(t[y[n]]=[])).push(e[n])}))}var O={"wx://form-field":{},"wx://component-export":{}};function E(e,t){(function(e){var t=e.behaviors,n=e.definitionFilter,r=[];if(Array.isArray(t)&&t.forEach((function(t){t="string"===typeof t?O[t]:t,t.definitionFilter&&(r.push(t.definitionFilter),t.definitionFilter.call(null,e,[]))})),f(n));})(e)}var x={"wx://form-field":{beforeCreate:function(){var e=this.$options.mpOptions;e.properties||(e.properties=Object.create(null));var t=e.properties;h(t,"name")||(t.name={type:String}),h(t,"value")||(t.value={type:String})}}};function P(e,t){e&&e.forEach((function(e){"string"===typeof e?x[e]&&t.mixins.push(x[e]):t.mixins.push(function(e){var t=e.data,n=e.methods,r=e.behaviors,i=e.properties,o={watch:{},mpOptions:{mpObservers:[]}};return u(t,o),C(n,o),P(r,o),I(i,o),T(e,o),E(e),o}(e))}))}function k(e){return e.split(",").map((function(e){return function(e){return e.split(".")}(e)}))}function A(e,t,n,r){if(t){var i="_$".concat(e,"Handlers");(r[i]||(r[i]=[])).push((function(){t.call(r,n)}))}}function R(e,t,n){var r=e.name,i=n._$relationNodes||(n._$relationNodes=Object.create(null));(i[r]||(i[r]=[])).push(t),A("linked",e["linked"],t,n)}function D(e,t,n){A("unlinked",e["unlinked"],t,n)}function L(e,t,n){var r=e&&e.$options.mpOptions&&e.$options.mpOptions.relations;if(!r)return[];var i=Object.keys(r).find((function(e){var i=r[e];return i.target===t&&i.type===n}));return i?[r[i],e]:[]}function N(e,t,n){var r=n(e,e.$options.mpOptions.path),i=(0,a.default)(r,2),o=i[0],s=i[1];o&&(R(o,e,s),R(t,s,e),D(o,e,s),D(t,s,e))}function M(e){var t=e.$options.mpOptions||{},n=t.relations;n&&Object.keys(n).forEach((function(t){(function(e,t){var n=e.type;"parent"===n?N(t,e,(function(e,t){return L(e.$parent,t,"child")})):"ancestor"===n&&N(t,e,(function(e,t){var n=e.$parent;while(n){var r=L(n,t,"descendant");if(r.length)return r;n=n.$parent}return[]}))})(n[t],e)}))}function $(e,t){var n=e["_$".concat(t,"Handlers")];n&&n.forEach((function(e){return e()}))}var j={enumerable:!0,configurable:!0,get:g,set:g};function U(e,t,n){j.get=function(){return this[t][n]},j.set=function(e){this[t][n]=e},Object.defineProperty(e,n,j)}function F(e,t){var n=this;p(e)&&(Object.keys(e).forEach((function(t){(function(e,t,n){var r=e.replace(/\[(\d+?)\]/g,".$1").split(".");return r.reduce((function(e,n,i){if(i!==r.length-1)return"undefined"===typeof e[n]&&(e[n]={}),e[n];e[n]=t}),n),1===r.length})(t,e[t],n.data)&&!h(n,t)&&U(n,"__data__",t)})),this.$forceUpdate(),f(t)&&this.$nextTick(t))}var B=Object.prototype.toString,q=function(e){return function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=B.call(n);if("[object Array]"===r)return t=n.slice(0),t;if("[object Object]"===r){for(var i in n)t[i]=e(t[i],n[i]);return t}if("[object Date]"===r)return new Date(n.getTime());if("[object RegExp]"===r){var o=String(n),a=o.lastIndexOf("/");return new RegExp(o.slice(1,a),o.slice(a+1))}return n}("[object Array]"===B.call(e)?[]:{},e)},W=(i={},(0,o.default)(i,String,""),(0,o.default)(i,Number,0),(0,o.default)(i,Boolean,!1),(0,o.default)(i,Object,null),(0,o.default)(i,Array,[]),(0,o.default)(i,null,null),i);function H(e){return W[e]}function V(e){return p(e)?e.type:e}function G(e,t,n,r){var i=n[e];if(void 0!==i){var o=t[e],a=V(o);i=Y(i,a);var s=o&&o.observer;return s&&setTimeout((function(){K(s,r,i)}),4),i}return function(e){return p(e)?h(e,"value")?e.value:H(e.type):H(e)}(t[e])}function Y(e,t){return t===Boolean?!!e:t===String?String(e):e}function K(e,t,n,r){try{"function"===typeof e?e.call(t,n,r):"string"===typeof e&&"function"===typeof t[e]&&t[e](n,r)}catch(i){console.error("execute observer ".concat(e," callback fail! err: ").concat(i))}}function z(e){var t=e.$options.mpOptions&&e.$options.mpOptions.properties,n=e.$options.propsData;n&&t&&Object.keys(t).forEach((function(r){h(n,r)&&(e[r]=Y(n[r],V(t[r])))}))}function J(e){var t=JSON.parse(JSON.stringify(e.$options.mpOptions.data||{}));e["__data__"]=t;var n={get:function(){return e["__data__"]},set:function(t){e["__data__"]=t}};Object.defineProperties(e,{data:n,properties:n}),e.setData=F,function(e,t){var n=e.$options.mpOptions.properties;if(n){var r=q(e.$options.propsData)||{},i=function(i){var o=!!p(n[i])&&n[i].observer,a=G(i,n,r,e);Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){return a},set:function(t){var n=a;t===a||t!==t&&a!==a||(a=Array.isArray(t)?t.slice(0):t,o&&K(o,e,t,n),e.$forceUpdate())}})};for(var o in n)i(o)}}(e,t),Object.keys(t).forEach((function(t){U(e,"__data__",t)}))}var Q={beforeCreate:function(){this._renderProxy=this,this._$self=this,this._$noop=g},created:function(){J(this),function(e){var t=e.$emit;e.triggerEvent=function(n,r,i){var o={dataset:e.$el.dataset},a={target:o,currentTarget:o,detail:r,preventDefault:g,stopPropagation:g};t.call(e,n,a)},e.$emit=function(){e.triggerEvent.apply(e,arguments)},e.getRelationNodes=function(t){return(e._$relationNodes&&e._$relationNodes[t]||[]).filter((function(e){return!e._isDestroyed}))},e._$updateProperties=z}(this),M(this)},mounted:function(){(function(e){var t=e.$options.watch;t&&Object.keys(t).forEach((function(n){var r=t[n];if(r.mounted){var i=e[n],o=r.handler;"string"===typeof o&&(o=e[o]),o&&o.call(e,i,i)}}))})(this)},destroyed:function(){$(this,"unlinked")}};e.__wxRoute="",e.__wxComponents=Object.create(null),e.__wxVueOptions=Object.create(null);var X=s.default.nextTick;t.nextTick=X;var Z=uni.__$wx__,ee=Z;t.default=ee}).call(this,n("0ee4"))},edb3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArkSimpleModel=void 0;var r=n("7a9b"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};function s(e){var t=e.messages,n=e.model,r=e.temperature,o=e.tools,a=e.top_p;return i(i({},e),{messages:t,model:n,tools:o,top_p:a,temperature:r})}var u=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="ark/api/v3/chat/completions",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,this.req({url:this.url,data:i(i({},s(e)),{stream:!1}),stream:!1,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,i(i({},n),{rawResponse:n})]}}))}))},e.prototype.doStream=function(e,t){return o(this,void 0,void 0,(function(){var n,o,u,c,l;return a(this,(function(a){switch(a.label){case 0:return n=null,[4,this.req({url:this.url,data:i(i({},s(e)),{stream:!0}),stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return o=a.sent(),u=(0,r.toPolyfillReadable)(o),c=(0,r.intoStandardStream)(u),l=c.pipeThrough(new r.TransformStream({transform:function(e,t){var o=e.choices.map((function(e){var t=e.delta;return null==n&&(n=(0,r.isToolCallAssistantMessage)(t)),n?i(i({},e),{finish_reason:"tool_calls",delta:t}):e})),a=i(i({},e),{choices:o});t.enqueue(i(i({},a),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(l)]}}))}))},e}();t.ArkSimpleModel=u},edee:function(e,t,n){var r=n("ba27"),i=n("d586"),o=n("3461"),a=n("8203"),s=n("6468"),u=n("62c5"),c=Object.prototype,l=c.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&i(e),d=!n&&!c&&a(e),f=!n&&!c&&!d&&u(e),p=n||c||d||f,h=p?r(e.length,String):[],g=h.length;for(var v in e)!t&&!l.call(e,v)||p&&("length"==v||d&&("offset"==v||"parent"==v)||f&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,g))||h.push(v);return h}},ee05:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={skeleton:n("8cb3").default},i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",[n("view",{staticClass:e._$s(1,"sc","container"),attrs:{_i:1},on:{touchstart:e.touchStart,touchend:e.touchEnd}},[e._$s(2,"i",e.showPageIndicator)?n("view",{staticClass:e._$s(2,"sc","page-indicator"),attrs:{_i:2}},[n("view",{staticClass:e._$s(3,"sc","page-indicator-text"),attrs:{_i:3}},[e._v(e._$s(3,"t0-0",e._s(e.pageIndicatorText)))])]):e._e(),n("view",{staticClass:e._$s(4,"sc","message-icon-container"),attrs:{_i:4},on:{click:e.navigateToMessages}},[n("view",{staticClass:e._$s(5,"sc","message-icon"),attrs:{_i:5}}),e._$s(6,"i",e.unreadMessageCount>0)?n("view",{staticClass:e._$s(6,"sc","unread-dot"),attrs:{_i:6}}):e._e()]),n("view",{staticClass:e._$s(7,"sc","search-box-container"),attrs:{_i:7}},[n("view",{staticClass:e._$s(8,"sc","search-box"),attrs:{_i:8},on:{click:e.navigateToSearch}},[n("view",{staticClass:e._$s(9,"sc","search-icon"),attrs:{_i:9}}),n("view",{staticClass:e._$s(10,"sc","search-placeholder"),attrs:{_i:10}})])]),e._$s(11,"i",e.isLoading)?n("view",{attrs:{_i:11}},[n("skeleton",{attrs:{_i:12}})],1):n("view",{staticClass:e._$s(13,"sc","square-mode-container"),attrs:{_i:13}},[e._$s(14,"i",0===e.postList.length&&!e.isLoading)?n("view",{staticClass:e._$s(14,"sc","empty-state"),attrs:{_i:14}},[n("view",{staticClass:e._$s(15,"sc","empty-icon"),attrs:{_i:15}}),n("view",{staticClass:e._$s(16,"sc","empty-text"),attrs:{_i:16}}),n("view",{staticClass:e._$s(17,"sc","empty-subtext"),attrs:{_i:17}})]):e._e(),n("view",{attrs:{id:"post-list-container",_i:18}},[e._$s(19,"i","home"===e.currentPage)?n("view",{attrs:{_i:19}},e._l(e._$s(20,"f",{forItems:e.postList}),(function(t,r,i,o){return n("view",{key:e._$s(20,"f",{forIndex:i,key:r}),class:e._$s("20-"+o,"c","post-item-wrapper "+(t.isOriginal?"original-post":"")),attrs:{_i:"20-"+o}},[n("view",{staticClass:e._$s("21-"+o,"sc","author-info-outside"),attrs:{_i:"21-"+o}},[e._$s("22-"+o,"i",t.authorAvatar)?n("image",{staticClass:e._$s("22-"+o,"sc","author-avatar"),attrs:{src:e._$s("22-"+o,"a-src",t.authorAvatar),"data-postindex":e._$s("22-"+o,"a-data-postindex",r),"data-user-id":e._$s("22-"+o,"a-data-user-id",t._openid),_i:"22-"+o},on:{error:e.onAvatarError,load:e.onAvatarLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.navigateToUserProfile(t)}}}):e._e(),n("text",{staticClass:e._$s("23-"+o,"sc","author-name"),attrs:{_i:"23-"+o}},[e._v(e._$s("23-"+o,"t0-0",e._s(t.authorName)))])]),n("navigator",{staticClass:e._$s("24-"+o,"sc","post-content-navigator"),attrs:{url:e._$s("24-"+o,"a-url","/pages/post-detail/post-detail?id="+t._id),_i:"24-"+o}},[n("view",{staticClass:e._$s("25-"+o,"sc","post-item"),attrs:{_i:"25-"+o}},[n("view",{staticClass:e._$s("26-"+o,"sc","post-title"),attrs:{_i:"26-"+o}},[e._v(e._$s("26-"+o,"t0-0",e._s(t.title)))]),e._$s("27-"+o,"i",t.isPoem&&t.author)?n("view",{staticClass:e._$s("27-"+o,"sc","poem-author"),attrs:{_i:"27-"+o}},[e._v(e._$s("27-"+o,"t0-0",e._s(t.author)))]):e._e(),e._$s("28-"+o,"i",t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("28-"+o,"sc","image-container-wrapper"),style:e._$s("28-"+o,"s",t.imageStyle),attrs:{"data-src":e._$s("28-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("28-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"28-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}},[e._$s("29-"+o,"i",1===t.imageUrls.length)?[n("image",{staticClass:e._$s("30-"+o,"sc","post-image"),attrs:{src:e._$s("30-"+o,"a-src",t.imageUrls[0]),"data-src":e._$s("30-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("30-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"30-"+o},on:{error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})]:e._$s("31-"+o,"e",t.imageUrls.length>1)?[n("swiper",{staticClass:e._$s("32-"+o,"sc","image-swiper"),attrs:{_i:"32-"+o}},[e._l(e._$s("33-"+o,"f",{forItems:t.imageUrls}),(function(r,i,a,s){return[n("swiper-item",{key:e._$s("33-"+o,"f",{forIndex:a,keyIndex:0,key:i+"_0"})},[n("image",{staticClass:e._$s("35-"+o+"-"+s,"sc","post-image"),attrs:{src:e._$s("35-"+o+"-"+s,"a-src",r),"data-src":e._$s("35-"+o+"-"+s,"a-data-src",r),"data-original-image-urls":e._$s("35-"+o+"-"+s,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"35-"+o+"-"+s},on:{error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._e()],2):e._e(),e._$s("36-"+o,"i",t.content)?n("view",{staticClass:e._$s("36-"+o,"sc","post-content"),attrs:{_i:"36-"+o}},[e._v(e._$s("36-"+o,"t0-0",e._s(t.content)))]):e._e(),e._$s("37-"+o,"i",t.tags&&t.tags.length>0)?n("view",{staticClass:e._$s("37-"+o,"sc","post-tags"),attrs:{_i:"37-"+o}},e._l(e._$s("38-"+o,"f",{forItems:t.tags}),(function(t,r,i,a){return n("text",{key:e._$s("38-"+o,"f",{forIndex:i,key:r}),staticClass:e._$s("38-"+o+"-"+a,"sc","post-tag"),attrs:{"data-tag":e._$s("38-"+o+"-"+a,"a-data-tag",t),_i:"38-"+o+"-"+a},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onTagClick(t)}}},[e._v(e._$s("38-"+o+"-"+a,"t0-0",e._s(t)))])})),0):e._e()])]),n("view",{staticClass:e._$s("39-"+o,"sc","vote-section"),attrs:{_i:"39-"+o}},[n("view",{staticClass:e._$s("40-"+o,"sc","actions-left"),attrs:{_i:"40-"+o}}),n("view",{staticClass:e._$s("41-"+o,"sc","button-group"),attrs:{_i:"41-"+o}},[n("view",{staticClass:e._$s("42-"+o,"sc","comment-count"),attrs:{"data-postid":e._$s("42-"+o,"a-data-postid",t._id),_i:"42-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onCommentClick(t)}}},[n("text",{staticClass:e._$s("43-"+o,"sc","action-emoji"),attrs:{_i:"43-"+o}}),n("text",{staticClass:e._$s("44-"+o,"sc","action-text"),attrs:{_i:"44-"+o}},[e._v(e._$s("44-"+o,"t0-0",e._s(t.commentCount||0)))])]),n("view",{staticClass:e._$s("45-"+o,"sc","like-icon-container"),attrs:{"data-postid":e._$s("45-"+o,"a-data-postid",t._id),"data-index":e._$s("45-"+o,"a-data-index",r),_i:"45-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onVote(t)}}},[n("image",{staticClass:e._$s("46-"+o,"sc","like-icon"),attrs:{src:e._$s("46-"+o,"a-src",t.likeIcon||"/static/images/seed.png"),_i:"46-"+o},on:{error:e.onLikeIconError}})]),n("view",{class:e._$s("47-"+o,"c","vote-count "+(t.isVoted?"voted":"")),attrs:{_i:"47-"+o}},[n("text",{staticClass:e._$s("48-"+o,"sc","action-text"),attrs:{_i:"48-"+o}},[e._v(e._$s("48-"+o,"t0-0",e._s(t.votes||0)))])])])])])})),0):e._$s(49,"e","discover"===e.currentPage)?n("view",{attrs:{_i:49}},[e._$s(50,"i",0===e.discoverPostList.length&&!e.isLoading)?n("view",{staticClass:e._$s(50,"sc","empty-state"),attrs:{_i:50}},[n("view",{staticClass:e._$s(51,"sc","empty-icon"),attrs:{_i:51}}),n("view",{staticClass:e._$s(52,"sc","empty-text"),attrs:{_i:52}}),n("view",{staticClass:e._$s(53,"sc","empty-subtext"),attrs:{_i:53}})]):e._e(),e._l(e._$s(54,"f",{forItems:e.discoverPostList}),(function(t,r,i,o){return n("view",{key:e._$s(54,"f",{forIndex:i,key:r}),class:e._$s("54-"+o,"c","post-item-wrapper "+(t.isOriginal?"original-post":"")),attrs:{_i:"54-"+o}},[n("view",{staticClass:e._$s("55-"+o,"sc","author-info-outside"),attrs:{_i:"55-"+o}},[e._$s("56-"+o,"i",t.authorAvatar)?n("image",{staticClass:e._$s("56-"+o,"sc","author-avatar"),attrs:{src:e._$s("56-"+o,"a-src",t.authorAvatar),"data-postindex":e._$s("56-"+o,"a-data-postindex",r),"data-user-id":e._$s("56-"+o,"a-data-user-id",t._openid),_i:"56-"+o},on:{error:e.onAvatarError,load:e.onAvatarLoad,click:function(t){return t.stopPropagation(),t.preventDefault(),e.navigateToUserProfile(t)}}}):e._e(),n("text",{staticClass:e._$s("57-"+o,"sc","author-name"),attrs:{_i:"57-"+o}},[e._v(e._$s("57-"+o,"t0-0",e._s(t.authorName)))])]),n("navigator",{staticClass:e._$s("58-"+o,"sc","post-content-navigator"),attrs:{url:e._$s("58-"+o,"a-url","/pages/post-detail/post-detail?id="+t._id),_i:"58-"+o}},[n("view",{staticClass:e._$s("59-"+o,"sc","post-item"),attrs:{_i:"59-"+o}},[n("view",{staticClass:e._$s("60-"+o,"sc","post-title"),attrs:{_i:"60-"+o}},[e._v(e._$s("60-"+o,"t0-0",e._s(t.title)))]),e._$s("61-"+o,"i",t.isPoem&&t.author)?n("view",{staticClass:e._$s("61-"+o,"sc","poem-author"),attrs:{_i:"61-"+o}},[e._v(e._$s("61-"+o,"t0-0",e._s(t.author)))]):e._e(),e._$s("62-"+o,"i",t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("62-"+o,"sc","image-container-wrapper"),style:e._$s("62-"+o,"s",t.imageStyle),attrs:{"data-src":e._$s("62-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("62-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"62-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}},[e._$s("63-"+o,"i",1===t.imageUrls.length)?[n("image",{staticClass:e._$s("64-"+o,"sc","post-image"),attrs:{src:e._$s("64-"+o,"a-src",t.imageUrls[0]),"data-src":e._$s("64-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("64-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"64-"+o},on:{error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})]:e._$s("65-"+o,"e",t.imageUrls.length>1)?[n("swiper",{staticClass:e._$s("66-"+o,"sc","image-swiper"),attrs:{_i:"66-"+o}},[e._l(e._$s("67-"+o,"f",{forItems:t.imageUrls}),(function(r,i,a,s){return[n("swiper-item",{key:e._$s("67-"+o,"f",{forIndex:a,keyIndex:0,key:i+"_0"})},[n("image",{staticClass:e._$s("69-"+o+"-"+s,"sc","post-image"),attrs:{src:e._$s("69-"+o+"-"+s,"a-src",r),"data-src":e._$s("69-"+o+"-"+s,"a-data-src",r),"data-original-image-urls":e._$s("69-"+o+"-"+s,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"69-"+o+"-"+s},on:{error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._e()],2):e._e(),e._$s("70-"+o,"i",t.content)?n("view",{staticClass:e._$s("70-"+o,"sc","post-content"),attrs:{_i:"70-"+o}},[e._v(e._$s("70-"+o,"t0-0",e._s(t.content)))]):e._e(),e._$s("71-"+o,"i",t.tags&&t.tags.length>0)?n("view",{staticClass:e._$s("71-"+o,"sc","post-tags"),attrs:{_i:"71-"+o}},e._l(e._$s("72-"+o,"f",{forItems:t.tags}),(function(t,r,i,a){return n("text",{key:e._$s("72-"+o,"f",{forIndex:i,key:r}),staticClass:e._$s("72-"+o+"-"+a,"sc","post-tag"),attrs:{"data-tag":e._$s("72-"+o+"-"+a,"a-data-tag",t),_i:"72-"+o+"-"+a},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onTagClick(t)}}},[e._v(e._$s("72-"+o+"-"+a,"t0-0",e._s(t)))])})),0):e._e()])]),n("view",{staticClass:e._$s("73-"+o,"sc","vote-section"),attrs:{_i:"73-"+o}},[n("view",{staticClass:e._$s("74-"+o,"sc","actions-left"),attrs:{_i:"74-"+o}}),n("view",{staticClass:e._$s("75-"+o,"sc","button-group"),attrs:{_i:"75-"+o}},[n("view",{staticClass:e._$s("76-"+o,"sc","comment-count"),attrs:{"data-postid":e._$s("76-"+o,"a-data-postid",t._id),_i:"76-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onCommentClick(t)}}},[n("text",{staticClass:e._$s("77-"+o,"sc","action-emoji"),attrs:{_i:"77-"+o}}),n("text",{staticClass:e._$s("78-"+o,"sc","action-text"),attrs:{_i:"78-"+o}},[e._v(e._$s("78-"+o,"t0-0",e._s(t.commentCount||0)))])]),n("view",{staticClass:e._$s("79-"+o,"sc","like-icon-container"),attrs:{"data-postid":e._$s("79-"+o,"a-data-postid",t._id),"data-index":e._$s("79-"+o,"a-data-index",r),_i:"79-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onVote(t)}}},[n("image",{staticClass:e._$s("80-"+o,"sc","like-icon"),attrs:{src:e._$s("80-"+o,"a-src",t.likeIcon||"/static/images/seed.png"),_i:"80-"+o},on:{error:e.onLikeIconError}})]),n("view",{class:e._$s("81-"+o,"c","vote-count "+(t.isVoted?"voted":"")),attrs:{_i:"81-"+o}},[n("text",{staticClass:e._$s("82-"+o,"sc","action-text"),attrs:{_i:"82-"+o}},[e._v(e._$s("82-"+o,"t0-0",e._s(t.votes||0)))])])])])])}))],2):e._e()]),n("view",{staticClass:e._$s(83,"sc","loading-footer"),attrs:{_i:83}},[e._$s(84,"i",e.isLoadingMore)||e._$s(86,"e","home"===e.currentPage&&!e.hasMore&&e.postList.length>0)?[n("text")]:e._$s(88,"e","discover"===e.currentPage&&!e.discoverHasMore&&e.discoverPostList.length>0)?[n("view",{staticClass:e._$s(89,"sc","discover-end-tip"),attrs:{_i:89}},[n("text",{staticClass:e._$s(90,"sc","end-text"),attrs:{_i:90}}),n("view",{staticClass:e._$s(91,"sc","refresh-tip"),attrs:{_i:91}},[n("text",{staticClass:e._$s(92,"sc","refresh-text"),attrs:{_i:92}})])])]:e._e()],2)]),n("navigator",{staticClass:e._$s(93,"sc","add-button"),attrs:{_i:93}},[n("view")])])])},o=[]},ee10:function(e,t){function n(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var a=e.apply(t,r);function s(e){n(a,i,o,s,u,"next",e)}function u(e){n(a,i,o,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports["default"]=e.exports},ee49:function(e,t,n){"use strict";n.r(t);var r=n("42d8"),i=n("f37a");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},eeaa:function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("127e")),a=i(n("ee10")),s=i(n("7ca3")),u=i(n("3b2d")),c=i(n("f7a1")),l=i(n("84be")),d=i(n("f7a1")),f=i(n("84be"));function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}getApp();var g=n("fe58"),v=n("df61"),m=v.togglePostLike,y=n("8e86"),_=y.previewImage,b=n("139b"),w=b.formatRelativeTime,S=(n("a7cb"),n("05f6")),I=n("11ca"),C=I.cloudCall,T=n("2b90"),O={components:{cloudTipModal:c.default,folderSelector:l.default},mixins:[T],data:function(){return{post:null,comments:[],newComment:"",commentCount:0,isLoading:!0,isSubmitDisabled:!0,replyToComment:null,replyToAuthor:"",showUploadTip:!1,votingInProgress:!1,imageContainerHeight:null,swiperHeights:{},imageClampHeights:{},showFavoriteModal:!1,isInputExpanded:!1,keyboardHeight:0,isFocus:!1,viewStartTime:0,currentPostId:null,isFavorited:!1,favoriteButtonText:"\u6536\u85cf",favoriteButtonClass:"favorite-button",showFollowButton:!1,isFollowing:!1,followPending:!1,isFollowedByAuthor:!1,isMutualFollow:!1,commentImages:[],maxCommentImages:3,showEmojiPanel:!1,emojiList:["\ud83d\ude00","\ud83d\ude01","\ud83d\ude02","\ud83e\udd23","\ud83d\ude0a","\ud83d\ude0d","\ud83d\ude0e","\ud83e\udd14","\ud83d\ude22","\ud83d\ude4f","\ud83d\udc4d","\ud83d\udc4e"],isSubmittingComment:!1,imgindex:0,img:"",commentIndex:0,commentImage:"",imageIndex:0,replyIndex:0,reply:{authorAvatar:"",_openid:"",authorName:"",content:"",imageUrls:"",formattedCreateTime:"",_id:"",liked:"",likeIcon:"",likes:"",canDelete:""},replyImage:"",replyImageIndex:0}},onLoad:function(e){var t=e.id;t?(this.setData({currentPostId:t}),this.loadPostDetail(t)):(this.setData({isLoading:!1}),uni.showToast({title:"\u65e0\u6548\u7684\u5e16\u5b50ID",icon:"none"}))},onShow:function(){this.setData({viewStartTime:Date.now()})},onUnload:function(){this.recordViewBehavior()},onHide:function(){this.isInputExpanded&&this.collapseInput(),this.recordViewBehavior()},methods:{callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return C(e,t,Object.assign({pageTag:"post-detail",context:this},n))},loadPostDetail:function(t){var n=this;uni.showLoading({title:"\u52a0\u8f7d\u4e2d..."}),this.callCloudFunction("getPostDetail",{postId:t},{injectOpenId:!1}).then((function(t){if(t.result&&t.result.post){var r=t.result.post;r.formattedCreateTime=n.formatTime(r.createTime),r.likeIcon=g.getLikeIcon(r.votes||0,r.isVoted||!1),e("log","loadPostDetail\u5b8c\u6574\u8fd4\u56de\u6570\u636e:",t.result," at pages/post-detail/post-detail.vue:471"),e("log","loadPostDetail\u83b7\u53d6\u5230\u7684commentCount:",t.result.commentCount,"\u7c7b\u578b:",(0,u.default)(t.result.commentCount)," at pages/post-detail/post-detail.vue:472"),e("log","loadPostDetail\u83b7\u53d6\u5230\u7684post.commentCount:",r.commentCount,"\u7c7b\u578b:",(0,u.default)(r.commentCount)," at pages/post-detail/post-detail.vue:473");var i=t.result.commentCount||r.commentCount||0;e("log","\u6700\u7ec8\u4f7f\u7528\u7684commentCount:",i," at pages/post-detail/post-detail.vue:475"),n.setData({post:r,commentCount:i}),e("log","loadPostDetail\u8bbe\u7f6e\u540e\u7684commentCount:",n.commentCount," at pages/post-detail/post-detail.vue:480"),n.getComments(r&&r._id?r._id:""),n.prepareFollowState(r._openid)}else uni.showToast({title:"\u5e16\u5b50\u52a0\u8f7d\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","Failed to get post detail",t," at pages/post-detail/post-detail.vue:490"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){n.setData({isLoading:!1}),uni.hideLoading()}))},getComments:function(t){var n=this;this.callCloudFunction("getComments",{postId:t},{injectOpenId:!1}).then((function(t){if(t.result&&t.result.comments){var r=n.openid||uni.getStorageSync("openid"),i=t.result.comments.map((function(e){var t=h(h({},e),{},{formattedCreateTime:n.formatTime(e.createTime),likeIcon:g.getLikeIcon(e.likes||0,e.liked||!1),canDelete:e._openid===r,imageUrls:e.imageUrls||[],originalImageUrls:e.originalImageUrls||[]});return e.replies&&(t.replies=e.replies.map((function(e){return h(h({},e),{},{formattedCreateTime:n.formatTime(e.createTime),likeIcon:g.getLikeIcon(e.likes||0,e.liked||!1),canDelete:e._openid===r,imageUrls:e.imageUrls||[],originalImageUrls:e.originalImageUrls||[]})}))),t}));e("log","getComments\u8fd4\u56de\u7684commentCount:",t.result.commentCount," at pages/post-detail/post-detail.vue:536"),e("log","comments\u6570\u7ec4\u957f\u5ea6:",i.length," at pages/post-detail/post-detail.vue:537"),e("log","\u5f53\u524d\u9875\u9762\u7684commentCount:",n.commentCount," at pages/post-detail/post-detail.vue:538");var o=t.result.commentCount||i.length,a=o>n.commentCount;n.setData({comments:i,commentCount:a?o:n.commentCount}),e("log","\u66f4\u65b0\u540e\u7684commentCount:",n.commentCount," at pages/post-detail/post-detail.vue:545")}else uni.showToast({title:"\u8bc4\u8bba\u52a0\u8f7d\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","Failed to get comments",t," at pages/post-detail/post-detail.vue:553"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})}))},onVote:function(t){var n=this,r=t.currentTarget.dataset.postid;if(!this.votingInProgress){this.setData({votingInProgress:!0});var i=this.post,o=i.votes,a=i.isVoted,s=a?o-1:o+1,u=!a,c=g.getLikeIcon(s,u);this.setData({"post.votes":s,"post.isVoted":u,"post.likeIcon":c}),m(r,{pageTag:"post-detail",context:this,currentVotes:o,currentIsLiked:a,requireAuth:!0}).then((function(e){if(e.success)n.setData({"post.votes":e.votes,"post.isVoted":e.isLiked,"post.likeIcon":e.likeIcon});else{var t=e.rollback||{votes:o,isLiked:a,likeIcon:g.getLikeIcon(o,a)};n.setData({"post.votes":t.votes,"post.isVoted":t.isLiked,"post.likeIcon":t.likeIcon})}})).catch((function(t){e("error","\u3010\u5e16\u5b50\u8be6\u60c5\u70b9\u8d5e\u3011\u8c03\u7528 likeService \u5931\u8d25",t," at pages/post-detail/post-detail.vue:607"),n.setData({"post.votes":o,"post.isVoted":a,"post.likeIcon":g.getLikeIcon(o,a)})})).finally((function(){n.setData({votingInProgress:!1})}))}},onFavorite:function(){this.isFavorited?uni.showToast({title:"\u5df2\u7ecf\u6536\u85cf\u8fc7\u4e86",icon:"none"}):this.setData({showFavoriteModal:!0})},hideFavoriteModal:function(){this.setData({showFavoriteModal:!1})},onFavoriteSuccess:function(){this.hideFavoriteModal(),this.setData({isFavorited:!0,favoriteButtonText:"\u5df2\u6536\u85cf",favoriteButtonClass:"favorite-button favorited"}),uni.showToast({title:"\u6536\u85cf\u6210\u529f",icon:"success"})},handlePreview:function(e){var t=_(e,{fallbackToast:!1});return t||uni.showToast({title:"\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",icon:"none"}),t},onImageError:function(t){e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",t," at pages/post-detail/post-detail.vue:664")},onAvatarError:function(t){e("error","\u5934\u50cf\u52a0\u8f7d\u5931\u8d25",t," at pages/post-detail/post-detail.vue:668")},updateSubmitState:function(){var e=(this.newComment||"").trim().length>0,t=Array.isArray(this.commentImages)&&this.commentImages.length>0,n=!e&&!t||this.isSubmittingComment;this.isSubmitDisabled!==n&&this.setData({isSubmitDisabled:n})},onCommentInput:function(e){var t=this;this.setData({newComment:e.detail.value},(function(){t.updateSubmitState()}))},toggleEmojiPanel:function(){var e=!this.showEmojiPanel,t={showEmojiPanel:e,isFocus:!e};e&&(t.keyboardHeight=0,uni.hideKeyboard()),this.setData(t)},insertEmoji:function(e){var t=this,n=e.currentTarget.dataset.emoji;if(n){var r=(this.newComment||"")+n;this.setData({newComment:r},(function(){t.updateSubmitState()}))}},closeEmojiPanel:function(){this.showEmojiPanel&&this.setData({showEmojiPanel:!1})},chooseCommentImages:function(){var t=this;this.closeEmojiPanel();var n=this.commentImages?this.commentImages.length:0,r=this.maxCommentImages-n;r<=0?uni.showToast({title:"\u6700\u591a\u9009\u62e93\u5f20\u56fe\u7247",icon:"none"}):(this.isInputExpanded||this.expandInput(),uni.chooseImage({count:r,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(n){var r=n.tempFiles||(n.tempFilePaths||[]).map((function(e){return{tempFilePath:e,size:0}})),i=r.map((function(e){return t.prepareCommentImage(e)}));Promise.all(i).then((function(e){var n=e.filter((function(e){return!!e}));if(0!==n.length){var r=(t.commentImages||[]).concat(n);t.setData({commentImages:r.slice(0,t.maxCommentImages)},(function(){t.updateSubmitState(),t.setData({isInputExpanded:!0,isFocus:!1})}))}})).catch((function(t){e("error","\u8bc4\u8bba\u56fe\u7247\u5904\u7406\u5931\u8d25:",t," at pages/post-detail/post-detail.vue:780"),uni.showToast({title:"\u56fe\u7247\u5904\u7406\u5931\u8d25",icon:"none"})}))},fail:function(t){t&&t.errMsg&&-1===t.errMsg.indexOf("cancel")&&(e("error","\u9009\u62e9\u8bc4\u8bba\u56fe\u7247\u5931\u8d25:",t," at pages/post-detail/post-detail.vue:789"),uni.showToast({title:"\u65e0\u6cd5\u9009\u62e9\u56fe\u7247",icon:"none"}))}}))},prepareCommentImage:function(t){var n=this;return new Promise((function(r){var i=t.tempFilePath||t.path||(Array.isArray(t.tempFilePaths)?t.tempFilePaths[0]:"");if(i){var o=t.size||0,a=o>204800,s={id:"comment_"+Date.now()+"_"+Math.floor(1e5*Math.random()),originalPath:i,previewUrl:i,compressedPath:i,size:o,needCompression:a};a?n.compressCommentImage(s).then((function(e){r(e)})).catch((function(t){e("warn","\u8bc4\u8bba\u56fe\u7247\u538b\u7f29\u5f02\u5e38:",t," at pages/post-detail/post-detail.vue:826"),s.compressedPath=s.originalPath,s.previewUrl=s.originalPath,s.needCompression=!1,r(s)})):r(s)}else r(null)}))},compressCommentImage:function(t){return new Promise((function(n){(function r(i){uni.compressImage({src:t.originalPath,quality:i,success:function(o){uni.getFileInfo({filePath:o.tempFilePath,success:function(a){var s=a.size;e("log","\u538b\u7f29\u8d28\u91cf".concat(i,"%\uff0c\u6587\u4ef6\u5927\u5c0f: ").concat((s/1024).toFixed(2),"KB")," at pages/post-detail/post-detail.vue:848"),s>204800&&i>30?(e("log","\u6587\u4ef6\u5927\u5c0f".concat((s/1024).toFixed(2),"KB\u8d85\u8fc7200KB\uff0c\u7ee7\u7eed\u538b\u7f29...")," at pages/post-detail/post-detail.vue:852"),r(i-10)):(t.compressedPath=o.tempFilePath,t.previewUrl=o.tempFilePath,t.compressedSize=s,e("log","\u6700\u7ec8\u538b\u7f29\u8d28\u91cf".concat(i,"%\uff0c\u6587\u4ef6\u5927\u5c0f: ").concat((s/1024).toFixed(2),"KB")," at pages/post-detail/post-detail.vue:858"),n(t))},fail:function(){t.compressedPath=o.tempFilePath,t.previewUrl=o.tempFilePath,n(t)}})},fail:function(o){e("warn","\u538b\u7f29\u8d28\u91cf".concat(i,"%\u5931\u8d25:"),o," at pages/post-detail/post-detail.vue:871"),i>30?r(i-10):(t.compressedPath=t.originalPath,t.previewUrl=t.originalPath,t.needCompression=!1,n(t))}})})(60)}))},removeCommentImage:function(e){var t=this,n=e.currentTarget.dataset.index;if(void 0!==n){var r=(this.commentImages||[]).slice();r.splice(n,1),this.setData({commentImages:r},(function(){t.updateSubmitState()}))}},previewSelectedCommentImage:function(e){var t=e.currentTarget.dataset.index||0,n=this.commentImages||[];if(n.length){var r=n.map((function(e){return e.previewUrl})).filter(Boolean);if(r.length){var i=r[t]||r[0];return _({current:i,urls:r},{fallbackToast:!1})}}},uploadCommentImages:function(){var e=this,t=this.commentImages||[];if(!t.length)return Promise.resolve([]);var n=this.getCurrentUserId()||"guest",r=Date.now();return Promise.all(t.map((function(t,i){var o=(n||"guest")+"_"+r+"_"+i,a="comment_images/"+o+"_compressed.jpg";return e.uploadFile(a,t.compressedPath||t.previewUrl||t.originalPath).then((function(n){if(t.needCompression){var r="comment_images/"+o+"_original.jpg";return e.uploadFile(r,t.originalPath).then((function(e){return{compressedUrl:n.fileID,originalUrl:e.fileID}}))}return{compressedUrl:n.fileID,originalUrl:n.fileID}}))})))},previewCommentImageFromList:function(e){var t=Number(e.currentTarget.dataset.commentIndex),n=e.currentTarget.dataset.replyIndex,r="undefined"===typeof n?-1:Number(n),i=Number(e.currentTarget.dataset.imageIndex)||0,o=e.currentTarget.dataset.isReply,a=!0===o||"true"===o,s=[];if(!Number.isNaN(t)&&t>=0){var u=this.comments[t];if(u)if(a&&Array.isArray(u.replies)&&r>=0){var c=u.replies[r];c&&(Array.isArray(c.originalImageUrls)&&c.originalImageUrls.length>0?s=c.originalImageUrls:Array.isArray(c.imageUrls)&&(s=c.imageUrls))}else Array.isArray(u.originalImageUrls)&&u.originalImageUrls.length>0?s=u.originalImageUrls:Array.isArray(u.imageUrls)&&(s=u.imageUrls)}if(s&&s.length){var l=s.filter(Boolean);if(l.length){var d=l[i]||l[0];return _({current:d,urls:l},{fallbackToast:!1})}}},onSubmitComment:function(){var t=(0,a.default)(o.default.mark((function t(){var n,r,i,a,s,u,c,l,d,f,p,h,g;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.isSubmitDisabled&&!this.isSubmittingComment){t.next=2;break}return t.abrupt("return");case 2:if(n=(this.newComment||"").trim(),r=n.length>0,i=Array.isArray(this.commentImages)&&this.commentImages.length>0,r||i){t.next=8;break}return uni.showToast({title:"\u8bf7\u8f93\u5165\u5185\u5bb9\u6216\u6dfb\u52a0\u56fe\u7247",icon:"none"}),t.abrupt("return");case 8:if(a=this.post&&this.post._id?this.post._id:"",a){t.next=12;break}return uni.showToast({title:"\u5e16\u5b50\u4fe1\u606f\u7f3a\u5931",icon:"none"}),t.abrupt("return");case 12:return s=this.replyToComment,u=this.replyToAuthor,this.setData({isSubmittingComment:!0}),this.updateSubmitState(),uni.showLoading({title:"\u63d0\u4ea4\u4e2d..."}),t.prev=17,t.next=20,this.uploadCommentImages();case 20:return c=t.sent,l=c.map((function(e){return e.compressedUrl})),d=c.map((function(e){return e.originalUrl})),t.next=25,this.callCloudFunction("addComment",{postId:a,content:n,parentId:s,replyToAuthorName:u,imageUrls:l,originalImageUrls:d},{requireAuth:!0});case 25:f=t.sent,uni.hideLoading(),f.result&&f.result.success?(uni.showToast({title:"\u8bc4\u8bba\u6210\u529f"}),p=this.commentCount+1,this.setData({newComment:"",commentImages:[],showEmojiPanel:!1,commentCount:p}),this.updateSubmitState(),this.collapseInput(),this.getComments(a),h=getCurrentPages(),h.length>1&&(g=h[h.length-2],"pages/index/index"!==g.route&&"pages/profile/profile"!==g.route||"function"!==typeof g.updatePostCommentCount||g.updatePostCommentCount(a,p))):uni.showToast({title:f.result&&f.result.message||"\u8bc4\u8bba\u5931\u8d25",icon:"none"}),t.next=37;break;case 30:t.prev=30,t.t0=t["catch"](17),e("log","CatchClause",t.t0," at pages/post-detail/post-detail.vue:1072"),e("log","CatchClause",t.t0," at pages/post-detail/post-detail.vue:1073"),uni.hideLoading(),e("error","Failed to add comment with media:",t.t0," at pages/post-detail/post-detail.vue:1075"),uni.showToast({title:"\u8bc4\u8bba\u5931\u8d25",icon:"none"});case 37:return t.prev=37,this.setData({isSubmittingComment:!1}),this.updateSubmitState(),t.finish(37);case 41:case"end":return t.stop()}}),t,this,[[17,30,37,41]])})));return function(){return t.apply(this,arguments)}}(),showReplyInput:function(t){e("log","--- showReplyInput function triggered ---"," at pages/post-detail/post-detail.vue:1089"),e("log","\u6536\u5230\u7684 data- attributes:",t.currentTarget.dataset," at pages/post-detail/post-detail.vue:1090");var n=t.currentTarget.dataset.commentId,r=t.currentTarget.dataset.authorName;this.setData({replyToComment:n,replyToAuthor:r}),e("log","\u8bbe\u7f6e\u540e\u7684\u56de\u590d\u72b6\u6001:",{replyToComment:this.replyToComment,replyToAuthor:this.replyToAuthor}," at pages/post-detail/post-detail.vue:1097"),this.expandInput()},cancelReply:function(){this.setData({replyToComment:null,replyToAuthor:""}),e("log","\u56de\u590d\u72b6\u6001\u5df2\u88ab\u53d6\u6d88"," at pages/post-detail/post-detail.vue:1109")},onDeleteComment:function(t){var n=this,r=t.currentTarget.dataset,i=r.commentId,o=r.parentId;i&&uni.showModal({title:"\u5220\u9664\u8bc4\u8bba",content:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f",confirmColor:"#ff4d4f",success:function(t){t.confirm&&(uni.showLoading({title:"\u6b63\u5728\u5220\u9664",mask:!0}),n.callCloudFunction("deleteComment",{commentId:i},{requireAuth:!0}).then((function(e){if(e.result&&e.result.success){var t,r=Math.max(1,e.result.deletedCount||1);if(o){t=n.comments.map((function(e){return h(h({},e),{},{replies:e.replies?e.replies.slice():[]})}));var a=t.findIndex((function(e){return e._id===o}));-1!==a&&(t[a].replies=t[a].replies.filter((function(e){return e._id!==i})))}else t=n.comments.filter((function(e){return e._id!==i}));var s=Math.max(0,n.commentCount-r);n.setData({comments:t,commentCount:s});var u=getCurrentPages();if(u.length>1){var c=u[u.length-2];"function"===typeof c.updatePostCommentCount&&c.updatePostCommentCount(n.post&&n.post._id?n.post._id:"",s)}uni.showToast({title:"\u5df2\u5220\u9664",icon:"success"})}else uni.showToast({title:e.result&&e.result.message||"\u5220\u9664\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","Failed to delete comment",t," at pages/post-detail/post-detail.vue:1174"),uni.showToast({title:"\u5220\u9664\u5931\u8d25",icon:"none"})})).finally((function(){uni.hideLoading()})))}})},toggleLikeComment:function(t){var n=this,r=t.currentTarget.dataset.commentId,i=this.post&&this.post._id?this.post._id:"",o=this.comments,a=this.findComment(o,r),s=a.comment;a.isReply;if(s){var u=!s.liked,c=s.likes||0;s.liked=u,s.likes=c+(u?1:-1),s.likeIcon=g.getLikeIcon(s.likes,s.liked),this.setData({comments:o}),this.callCloudFunction("likeComment",{commentId:r,postId:i},{requireAuth:!0}).then((function(e){e.result&&e.result.success?s.likes!==e.result.likes&&n.updateCommentLikeStatus(r,u,e.result.likes):(n.updateCommentLikeStatus(r,!u,c),uni.showToast({title:"\u64cd\u4f5c\u5931\u8d25",icon:"none"}))})).catch((function(t){n.updateCommentLikeStatus(r,!u,c),e("error","Failed to like comment",t," at pages/post-detail/post-detail.vue:1223"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})}))}},updateCommentLikeStatus:function(e,t,n){var r=this.comments,i=this.findComment(r,e),o=i.comment;i.isReply;o&&(o.liked=t,o.likes=n,o.likeIcon=g.getLikeIcon(o.likes,o.liked),this.setData({comments:r}))},findComment:function(e,t){for(var n=0;n<e.length;n++){if(e[n]._id===t)return{comment:e[n],isReply:!1};if(e[n].replies)for(var r=0;r<e[n].replies.length;r++)if(e[n].replies[r]._id===t)return{comment:e[n].replies[r],isReply:!0}}return{comment:null,isReply:!1}},toggleShowAllReplies:function(e){var t=e.currentTarget.dataset.commentId,n=this.comments,r=n.find((function(e){return e._id===t}));r&&(r.showAllReplies=!r.showAllReplies,this.setData({comments:n}))},formatTime:function(e){return w(e)},prepareFollowState:function(t){var n=this.getCurrentUserId();if(e("log","\u3010\u5173\u6ce8\u72b6\u6001\u3011prepareFollowState\u8c03\u7528:",{authorOpenid:t,currentUserId:n,isSameUser:t===n}," at pages/post-detail/post-detail.vue:1287"),!t||!n||t===n)return e("log","\u3010\u5173\u6ce8\u72b6\u6001\u3011\u4e0d\u663e\u793a\u5173\u6ce8\u6309\u94ae - \u81ea\u5df1\u6216\u65e0\u6548\u7528\u6237"," at pages/post-detail/post-detail.vue:1293"),void this.setData({showFollowButton:!1,isFollowing:!1,isFollowedByAuthor:!1,isMutualFollow:!1});e("log","\u3010\u5173\u6ce8\u72b6\u6001\u3011\u663e\u793a\u5173\u6ce8\u6309\u94ae"," at pages/post-detail/post-detail.vue:1302"),this.setData({showFollowButton:!0,isFollowing:!1,isFollowedByAuthor:!1,isMutualFollow:!1}),this.fetchFollowStatusWithCache(t)},fetchFollowStatusWithCache:function(e){var t=this;if(e){var n=this.getCurrentUserId();n&&S.getFollowStatus(n,e).then((function(e){e&&t.setData({isFollowing:e.isFollowing,isFollowedByAuthor:e.isFollowedByAuthor,isMutualFollow:e.isMutualFollow})}))}},fetchFollowStatus:function(t){var n=this;t&&this.callCloudFunction("follow",{action:"checkFollow",targetOpenid:t},{requireAuth:!0}).then((function(t){t.result&&t.result.success?n.setData({isFollowing:!!t.result.isFollowing,isFollowedByAuthor:!!t.result.isFollower,isMutualFollow:!!t.result.isMutual}):e("warn","\u68c0\u67e5\u5173\u6ce8\u72b6\u6001\u5931\u8d25",t.result," at pages/post-detail/post-detail.vue:1352")})).catch((function(t){e("error","\u68c0\u67e5\u5173\u6ce8\u72b6\u6001\u8c03\u7528\u5931\u8d25:",t," at pages/post-detail/post-detail.vue:1355")}))},onFollowTap:function(){var t=this;if(!this.followPending&&this.post){var n=this.post._openid;if(n){var r=this.getCurrentUserId();r?(this.setData({followPending:!0}),S.toggleFollowStatus(r,n).then((function(e){e?(t.setData({isFollowing:e.isFollowing,isFollowedByAuthor:e.isFollowedByAuthor,isMutualFollow:e.isMutualFollow}),uni.showToast({title:e.isFollowing?"\u5173\u6ce8\u6210\u529f":"\u5df2\u53d6\u6d88\u5173\u6ce8",icon:"success"})):uni.showToast({title:"\u64cd\u4f5c\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u5207\u6362\u5173\u6ce8\u72b6\u6001\u5931\u8d25:",t," at pages/post-detail/post-detail.vue:1401"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})})).finally((function(){t.setData({followPending:!1})}))):uni.showToast({title:"\u8bf7\u5148\u767b\u5f55",icon:"none"})}}},getCurrentUserId:function(){return this.openid||uni.getStorageSync("openid")||uni.getStorageSync("userOpenId")},retryLoad:function(){this.currentPostId&&(this.setData({isLoading:!0,post:null}),this.loadPostDetail(this.currentPostId))},navigateToUserProfile:function(t){var n=t.currentTarget.dataset.userId;if(n){var r=this.openid;n===r?(e("log","\u3010\u5e16\u5b50\u8be6\u60c5\u3011\u70b9\u51fb\u7684\u662f\u81ea\u5df1\u5934\u50cf\uff0c\u5207\u6362\u5230\u6211\u7684\u9875\u9762"," at pages/post-detail/post-detail.vue:1433"),uni.switchTab({url:"/pages/profile/profile"})):(e("log","\u3010\u5e16\u5b50\u8be6\u60c5\u3011\u70b9\u51fb\u7684\u662f\u4ed6\u4eba\u5934\u50cf\uff0c\u8df3\u8f6c\u5230\u7528\u6237\u4e3b\u9875"," at pages/post-detail/post-detail.vue:1438"),uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(n)}))}},preventBubble:function(){},expandInput:function(){this.setData({isInputExpanded:!0,isFocus:!0,showEmojiPanel:!1})},onInputFocus:function(t){e("log","\u952e\u76d8\u5f39\u8d77\uff0c\u9ad8\u5ea6\u4e3a:",t.detail.height," at pages/post-detail/post-detail.vue:1459"),this.setData({keyboardHeight:t.detail.height,showEmojiPanel:!1})},onInputBlur:function(){var e=this;setTimeout((function(){e.setData({isFocus:!1,keyboardHeight:0})}),100)},collapseInput:function(){this.setData({isInputExpanded:!1,isFocus:!1,keyboardHeight:0,replyToComment:null,replyToAuthor:"",showEmojiPanel:!1})},recordViewBehavior:function(){if(this.currentPostId&&this.viewStartTime){var t=Math.floor((Date.now()-this.viewStartTime)/1e3);t<3||this.callCloudFunction("recordView",{postId:this.currentPostId,viewDuration:t}).then((function(t){e("log","\u6d4f\u89c8\u8bb0\u5f55\u5df2\u4fdd\u5b58",t," at pages/post-detail/post-detail.vue:1498")})).catch((function(t){e("error","\u6d4f\u89c8\u8bb0\u5f55\u4fdd\u5b58\u5931\u8d25:",t," at pages/post-detail/post-detail.vue:1500")}))}},onTagClick:function(t){var n=t.currentTarget.dataset.tag;e("log","\u70b9\u51fb\u6807\u7b7e:",n," at pages/post-detail/post-detail.vue:1506"),uni.navigateTo({url:"/pages/tag-filter/tag-filter?tag=".concat(encodeURIComponent(n)),success:function(){e("log","\u8df3\u8f6c\u5230\u6807\u7b7e\u7b5b\u9009\u9875\u9762\u6210\u529f"," at pages/post-detail/post-detail.vue:1510")},fail:function(t){e("error","\u8df3\u8f6c\u5230\u6807\u7b7e\u7b5b\u9009\u9875\u9762\u5931\u8d25",t," at pages/post-detail/post-detail.vue:1513"),uni.showToast({title:"\u8df3\u8f6c\u5931\u8d25",icon:"none"})}})},uploadFile:function(t,i){var o=this;return e("log","\ud83d\udd0d [\u5e16\u5b50\u8be6\u60c5\u9875] \u4e0a\u4f20\u6587\u4ef6: ".concat(t),i," at pages/post-detail/post-detail.vue:1524"),new Promise((function(a,s){var u=n("fd09"),c=u.getCurrentPlatform,l=u.getCloudFunctionMethod,d=c(),f=l();e("log","\ud83d\udd0d [\u5e16\u5b50\u8be6\u60c5\u9875] \u8fd0\u884c\u73af\u5883\u68c0\u6d4b - \u5e73\u53f0: ".concat(d,", \u65b9\u6cd5: ").concat(f)," at pages/post-detail/post-detail.vue:1533"),"tcb"===f?o.$tcb&&o.$tcb.uploadFile?(e("log","\ud83d\udd0d [\u5e16\u5b50\u8be6\u60c5\u9875] TCB\u73af\u5883\u4e0a\u4f20\u6587\u4ef6: ".concat(t)," at pages/post-detail/post-detail.vue:1538"),o.$tcb.uploadFile({cloudPath:t,filePath:i}).then(a).catch(s)):(e("error","\u274c [\u5e16\u5b50\u8be6\u60c5\u9875] TCB\u5b9e\u4f8b\u4e0d\u53ef\u7528"," at pages/post-detail/post-detail.vue:1544"),s(new Error("TCB\u5b9e\u4f8b\u4e0d\u53ef\u7528"))):"wx-cloud"===f?r.cloud&&r.cloud.uploadFile?(e("log","\ud83d\udd0d [\u5e16\u5b50\u8be6\u60c5\u9875] \u5c0f\u7a0b\u5e8f\u73af\u5883\u4e0a\u4f20\u6587\u4ef6: ".concat(t)," at pages/post-detail/post-detail.vue:1550"),r.cloud.uploadFile({cloudPath:t,filePath:i,success:function(n){e("log","\u2705 [\u5e16\u5b50\u8be6\u60c5\u9875] \u6587\u4ef6\u4e0a\u4f20\u6210\u529f: ".concat(t),n," at pages/post-detail/post-detail.vue:1555"),a(n)},fail:function(n){e("error","\u274c [\u5e16\u5b50\u8be6\u60c5\u9875] \u6587\u4ef6\u4e0a\u4f20\u5931\u8d25: ".concat(t),n," at pages/post-detail/post-detail.vue:1559"),s(n)}})):(e("error","\u274c [\u5e16\u5b50\u8be6\u60c5\u9875] \u5fae\u4fe1\u4e91\u5f00\u53d1\u4e0d\u53ef\u7528"," at pages/post-detail/post-detail.vue:1564"),s(new Error("\u5fae\u4fe1\u4e91\u5f00\u53d1\u4e0d\u53ef\u7528"))):(e("error","\u274c [\u5e16\u5b50\u8be6\u60c5\u9875] \u4e0d\u652f\u6301\u7684\u6587\u4ef6\u4e0a\u4f20\u65b9\u5f0f: ".concat(f)," at pages/post-detail/post-detail.vue:1568"),s(new Error("\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u4e0a\u4f20\u65b9\u5f0f: ".concat(f))))}))}}};t.default=O,t.default.components=Object.assign({"cloud-tip-modal":d.default,"folder-selector":f.default},t.default.components||{})}).call(this,n("f3b9")["default"],n("ed83")["default"])},eed6:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("view",{staticClass:e._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:e._$s(1,"sc","search-header"),attrs:{_i:1}},[n("view",{staticClass:e._$s(2,"sc","search-input-container"),attrs:{_i:2}},[n("view",{staticClass:e._$s(3,"sc","search-icon"),attrs:{_i:3}}),n("input",{staticClass:e._$s(4,"sc","search-input"),attrs:{value:e._$s(4,"a-value",e.searchKeyword),_i:4},on:{input:e.onSearchInput,confirm:e.onSearchConfirm}}),e._$s(5,"i",e.searchKeyword)?n("view",{staticClass:e._$s(5,"sc","clear-btn"),attrs:{_i:5},on:{click:e.clearSearch}}):e._e()]),n("view",{staticClass:e._$s(6,"sc","cancel-btn"),attrs:{_i:6},on:{click:e.goBack}})]),e._$s(7,"i",e.searchKeyword&&!e.isSearching&&e.searchResults.length>0)?n("view",{staticClass:e._$s(7,"sc","search-results"),attrs:{_i:7}},[n("view",{staticClass:e._$s(8,"sc","results-header"),attrs:{_i:8}},[n("text",{staticClass:e._$s(9,"sc","results-count"),attrs:{_i:9}},[e._v(e._$s(9,"t0-0",e._s(e.searchResults.length)))])]),n("view",{staticClass:e._$s(10,"sc","post-list"),attrs:{_i:10}},e._l(e._$s(11,"f",{forItems:e.searchResults}),(function(t,r,i,o){return n("view",{key:e._$s(11,"f",{forIndex:i,key:r}),staticClass:e._$s("11-"+o,"sc","post-item-wrapper"),attrs:{_i:"11-"+o}},[n("view",{staticClass:e._$s("12-"+o,"sc","author-info-outside"),attrs:{_i:"12-"+o}},[e._$s("13-"+o,"i",t.authorAvatar)?n("image",{staticClass:e._$s("13-"+o,"sc","author-avatar"),attrs:{src:e._$s("13-"+o,"a-src",t.authorAvatar),"data-user-id":e._$s("13-"+o,"a-data-user-id",t._openid),_i:"13-"+o},on:{error:e.onAvatarError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.navigateToUserProfile(t)}}}):e._e(),n("text",{staticClass:e._$s("14-"+o,"sc","author-name"),attrs:{_i:"14-"+o}},[e._v(e._$s("14-"+o,"t0-0",e._s(t.authorName)))])]),n("view",{staticClass:e._$s("15-"+o,"sc","post-item"),attrs:{"data-postid":e._$s("15-"+o,"a-data-postid",t._id),_i:"15-"+o},on:{click:e.onPostTap}},[n("view",{staticClass:e._$s("16-"+o,"sc","post-title"),attrs:{_i:"16-"+o}},[e._v(e._$s("16-"+o,"t0-0",e._s(t.title)))]),e._$s("17-"+o,"i",t.imageUrls&&t.imageUrls.length>0)?n("view",{staticClass:e._$s("17-"+o,"sc","image-container-wrapper"),style:e._$s("17-"+o,"s",t.imageStyle),attrs:{"data-src":e._$s("17-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("17-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"17-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}},[e._$s("18-"+o,"i",1===t.imageUrls.length)?[n("image",{staticClass:e._$s("19-"+o,"sc","post-image"),attrs:{src:e._$s("19-"+o,"a-src",t.imageUrls[0]),"data-src":e._$s("19-"+o,"a-data-src",t.imageUrls[0]),"data-original-image-urls":e._$s("19-"+o,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"19-"+o},on:{error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})]:e._$s("20-"+o,"e",t.imageUrls.length>1)?[n("swiper",{staticClass:e._$s("21-"+o,"sc","image-swiper"),attrs:{_i:"21-"+o}},[e._l(e._$s("22-"+o,"f",{forItems:t.imageUrls}),(function(r,i,a,s){return[n("swiper-item",{key:e._$s("22-"+o,"f",{forIndex:a,keyIndex:0,key:i+"_0"})},[n("image",{staticClass:e._$s("24-"+o+"-"+s,"sc","post-image"),attrs:{src:e._$s("24-"+o+"-"+s,"a-src",r),"data-src":e._$s("24-"+o+"-"+s,"a-data-src",r),"data-original-image-urls":e._$s("24-"+o+"-"+s,"a-data-original-image-urls",t.originalImageUrls||t.imageUrls),_i:"24-"+o+"-"+s},on:{error:e.onImageError,click:function(t){return t.stopPropagation(),t.preventDefault(),e.handlePreview(t)}}})])]}))],2)]:e._e()],2):e._e(),e._$s("25-"+o,"i",t.content)?n("view",{staticClass:e._$s("25-"+o,"sc","post-content"),attrs:{_i:"25-"+o}},[e._v(e._$s("25-"+o,"t0-0",e._s(t.content)))]):e._e(),e._$s("26-"+o,"i",t.tags&&t.tags.length>0)?n("view",{staticClass:e._$s("26-"+o,"sc","post-tags"),attrs:{_i:"26-"+o}},e._l(e._$s("27-"+o,"f",{forItems:t.tags}),(function(t,r,i,a){return n("text",{key:e._$s("27-"+o,"f",{forIndex:i,key:r}),staticClass:e._$s("27-"+o+"-"+a,"sc","post-tag"),attrs:{"data-tag":e._$s("27-"+o+"-"+a,"a-data-tag",t),_i:"27-"+o+"-"+a},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onTagClick(t)}}},[e._v(e._$s("27-"+o+"-"+a,"t0-0",e._s(t)))])})),0):e._e()]),n("view",{staticClass:e._$s("28-"+o,"sc","vote-section"),attrs:{_i:"28-"+o}},[n("view",{staticClass:e._$s("29-"+o,"sc","actions-left"),attrs:{_i:"29-"+o}}),n("view",{staticClass:e._$s("30-"+o,"sc","actions-right"),attrs:{_i:"30-"+o}},[n("view",{staticClass:e._$s("31-"+o,"sc","action-item"),attrs:{"data-postid":e._$s("31-"+o,"a-data-postid",t._id),_i:"31-"+o},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.onCommentClick(t)}}},[n("text",{staticClass:e._$s("32-"+o,"sc","action-emoji"),attrs:{_i:"32-"+o}}),n("text",{staticClass:e._$s("33-"+o,"sc","action-text"),attrs:{_i:"33-"+o}},[e._v(e._$s("33-"+o,"t0-0",e._s(t.commentCount||0)))])]),n("view",{staticClass:e._$s("34-"+o,"sc","action-item"),attrs:{_i:"34-"+o}},[n("text",{staticClass:e._$s("35-"+o,"sc","action-text"),attrs:{_i:"35-"+o}},[e._v(e._$s("35-"+o,"t0-0",e._s(t.votes||0)))])])])])])})),0)]):e._e(),e._$s(36,"i",e.searchKeyword&&!e.isSearching&&0===e.searchResults.length)?n("view",{staticClass:e._$s(36,"sc","empty-state"),attrs:{_i:36}},[n("view",{staticClass:e._$s(37,"sc","empty-icon"),attrs:{_i:37}}),n("view",{staticClass:e._$s(38,"sc","empty-text"),attrs:{_i:38}}),n("view",{staticClass:e._$s(39,"sc","empty-subtext"),attrs:{_i:39}})]):e._e(),e._$s(40,"i",!e.searchKeyword&&!e.isSearching&&e.searchHistory.length>0)?n("view",{staticClass:e._$s(40,"sc","search-suggestions"),attrs:{_i:40}},[n("view",{staticClass:e._$s(41,"sc","suggestions-header"),attrs:{_i:41}},[n("text",{staticClass:e._$s(42,"sc","suggestions-title"),attrs:{_i:42}}),n("text",{staticClass:e._$s(43,"sc","clear-history"),attrs:{_i:43},on:{click:e.clearHistory}})]),n("view",{staticClass:e._$s(44,"sc","suggestions-list"),attrs:{_i:44}},e._l(e._$s(45,"f",{forItems:e.searchHistory}),(function(t,r,i,o){return n("view",{key:e._$s(45,"f",{forIndex:i,key:r}),staticClass:e._$s("45-"+o,"sc","suggestion-item"),attrs:{"data-keyword":e._$s("45-"+o,"a-data-keyword",t),_i:"45-"+o},on:{click:e.selectHistoryKeyword}},[n("text",{staticClass:e._$s("46-"+o,"sc","suggestion-text"),attrs:{_i:"46-"+o}},[e._v(e._$s("46-"+o,"t0-0",e._s(t)))])])})),0)]):e._e(),e._$s(47,"i",!e.searchKeyword&&!e.isSearching&&0===e.searchHistory.length)?n("view",{staticClass:e._$s(47,"sc","hot-searches"),attrs:{_i:47}},[n("view",{staticClass:e._$s(48,"sc","hot-header"),attrs:{_i:48}},[n("text",{staticClass:e._$s(49,"sc","hot-title"),attrs:{_i:49}})]),n("view",{staticClass:e._$s(50,"sc","hot-list"),attrs:{_i:50}},e._l(e._$s(51,"f",{forItems:e.hotSearches}),(function(t,r,i,o){return n("view",{key:e._$s(51,"f",{forIndex:i,key:r}),staticClass:e._$s("51-"+o,"sc","hot-item"),attrs:{"data-keyword":e._$s("51-"+o,"a-data-keyword",t),_i:"51-"+o},on:{click:e.selectHotKeyword}},[n("text",{staticClass:e._$s("52-"+o,"sc","hot-text"),attrs:{_i:"52-"+o}},[e._v(e._$s("52-"+o,"t0-0",e._s(t)))])])})),0)]):e._e(),e._$s(53,"i",e.isSearching)?n("view",{staticClass:e._$s(53,"sc","loading-state"),attrs:{_i:53}},[n("view",{staticClass:e._$s(54,"sc","loading-text"),attrs:{_i:54}})]):e._e()])},i=[]},ef55:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeepSeekSimpleModel=void 0;var r=n("7a9b"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=function(){function e(e,t,n){this.req=e,this.baseUrl=t,this.subUrl="deepseek/chat/completions",null!=n&&(this.subUrl=n)}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,this.req({url:this.url,data:i(i({},e),{stream:!1}),stream:!1,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return n=r.sent(),[2,i(i({},n),{rawResponse:n})]}}))}))},e.prototype.doStream=function(e,t){return o(this,void 0,void 0,(function(){var n,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:return n=null,[4,this.req({url:this.url,data:i(i({},e),{stream:!0}),stream:!0,timeout:null===t||void 0===t?void 0:t.timeout})];case 1:return o=a.sent(),s=(0,r.toPolyfillReadable)(o),u=(0,r.intoStandardStream)(s),c=u.pipeThrough(new r.TransformStream({transform:function(e,t){var o=e.choices.map((function(e){var t=e.delta;return null==n&&(n=(0,r.isToolCallAssistantMessage)(t)),n?i(i({},e),{finish_reason:"tool_calls",delta:t}):e})),a=i(i({},e),{choices:o});t.enqueue(i(i({},a),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(c)]}}))}))},e}();t.DeepSeekSimpleModel=s},f16f:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultSimpleModel=void 0;var r=n("7a9b"),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=function(){function e(e,t,n){void 0===n&&(n=""),this.req=e,this.baseUrl=t,this.subUrl=n}return Object.defineProperty(e.prototype,"url",{get:function(){return"".concat(this.baseUrl,"/").concat(this.subUrl)},enumerable:!1,configurable:!0}),e.prototype.doGenerate=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,this.req({url:this.url,data:i(i({},e),{stream:!1}),stream:!1})];case 1:return t=n.sent(),[2,i(i({},t),{rawResponse:t})]}}))}))},e.prototype.doStream=function(e){return o(this,void 0,void 0,(function(){var t,n,o,s,u;return a(this,(function(a){switch(a.label){case 0:return t=null,[4,this.req({url:this.url,data:i(i({},e),{stream:!0}),stream:!0})];case 1:return n=a.sent(),o=(0,r.toPolyfillReadable)(n),s=(0,r.intoStandardStream)(o),u=s.pipeThrough(new r.TransformStream({transform:function(e,n){var o=e.choices.map((function(e){var n=e.delta;return null==t&&(t=(0,r.isToolCallAssistantMessage)(n)),t?i(i({},e),{finish_reason:"tool_calls",delta:n}):e})),a=i(i({},e),{choices:o});n.enqueue(i(i({},a),{rawResponse:e}))}})),[2,(0,r.createAsyncIterable)(u)]}}))}))},e}();t.DefaultSimpleModel=s},f1fb:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("af34")),o=r(n("7ca3")),a=r(n("8cb3")),s=r(n("8cb3"));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=n("b99c"),d=n("f806"),f=n("fe58"),p=n("df61"),h=p.togglePostLike,g=n("a7cb"),v=n("05f6"),m=n("8e86"),y=m.previewImage,_=n("fcd5"),b=_.normalizePostList,w=n("11ca"),S=w.cloudCall,I=n("2b90"),C={components:{skeleton:a.default},mixins:[I],data:function(){return{postList:[],votingInProgress:{},page:0,hasMore:!0,isLoading:!1,isLoadingMore:!1,swiperHeights:{},imageClampHeights:{},displayMode:"square",imageCache:{},visiblePosts:new Set,unreadMessageCount:0,currentPage:"home",showPageIndicator:!1,pageIndicatorText:"",discoverPostList:[],discoverPage:0,discoverHasMore:!0,discoverShownPostIds:[],discoverRefreshTime:0,touchStartX:0,touchStartY:0,touchEndX:0,touchEndY:0,selected:0,img:""}},onLoad:function(e){this.setData({displayMode:"square"}),this.pageLoadStartTime=Date.now(),this.waitForLoginThenInit()},onShow:function(){var t=n("d87a"),r=t.updateTabBarStatus;r(this,0);try{var i=uni.getStorageSync("shouldRefreshIndex");i&&(e("log","\u3010index\u3011\u68c0\u6d4b\u5230\u53d1\u5e03\u6807\u8bb0\uff0c\u5237\u65b0\u6570\u636e"," at pages/index/index.vue:389"),uni.removeStorageSync("shouldRefreshIndex"),this.refreshIndexData())}catch(o){e("log","CatchClause",o," at pages/index/index.vue:394"),e("log","CatchClause",o," at pages/index/index.vue:395"),e("error","\u68c0\u67e5\u5237\u65b0\u6807\u8bb0\u5931\u8d25:",o," at pages/index/index.vue:396")}this.syncLikeStatusFromCache(),this.checkUnreadMessageCount()},onPullDownRefresh:function(){var t=this;e("log","\ud83d\udd0d [\u9996\u9875] \u4e0b\u62c9\u5237\u65b0\u89e6\u53d1\uff0c\u5f53\u524d\u9875\u9762:",this.currentPage," at pages/index/index.vue:406"),l.remove("index_postList_cache"),"home"===this.currentPage?(e("log","\ud83d\udd0d [\u9996\u9875] \u6267\u884c\u4e3b\u9875\u5237\u65b0"," at pages/index/index.vue:411"),this.setData({postList:[],swiperHeights:{},page:0,hasMore:!0},(function(){e("log","\ud83d\udd0d [\u9996\u9875] \u72b6\u6001\u91cd\u7f6e\u5b8c\u6210\uff0c\u5f00\u59cb\u83b7\u53d6\u6570\u636e"," at pages/index/index.vue:420"),t.getPostList((function(){e("log","\u2705 [\u9996\u9875] \u4e0b\u62c9\u5237\u65b0\u5b8c\u6210"," at pages/index/index.vue:422"),uni.stopPullDownRefresh()}))}))):"discover"===this.currentPage&&(e("log","\ud83d\udd0d [\u9996\u9875] \u6267\u884c\u53d1\u73b0\u9875\u5237\u65b0"," at pages/index/index.vue:429"),this.refreshDiscoverPosts(),uni.stopPullDownRefresh())},onPageScroll:function(t){var n=this;this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout((function(){if("home"===n.currentPage)if(!n.hasMore||n.isLoading||n.isLoadingMore)e("log","\u3010\u9996\u9875\u3011\u6eda\u52a8\u68c0\u6d4b\u88ab\u963b\u6b62:",{hasMore:n.hasMore,isLoading:n.isLoading,isLoadingMore:n.isLoadingMore}," at pages/index/index.vue:458");else{var r=uni.getWindowInfo(),i=r.windowHeight;e("log","\u3010\u9996\u9875\u3011\u6eda\u52a8\u68c0\u6d4b - scrollTop:",t.scrollTop,"windowHeight:",i," at pages/index/index.vue:469"),uni.createSelectorQuery().in(n).select("#post-list-container").boundingClientRect((function(r){if(r&&r.height>0){var o=r.height,a=t.scrollTop,s=o-a-i,u=1.5*i;e("log","\u3010\u9996\u9875\u3011\u6eda\u52a8\u8ba1\u7b97:",{scrollHeight:o,scrollTop:a,windowHeight:i,distanceToBottom:s,preloadThreshold:u}," at pages/index/index.vue:482"),s<u&&(e("log","\u3010\u9996\u9875\u3011\u89e6\u53d1\u9884\u52a0\u8f7d"," at pages/index/index.vue:491"),n.getPostList())}else e("log","\u3010\u9996\u9875\u3011\u5bb9\u5668\u9ad8\u5ea6\u83b7\u53d6\u5931\u8d25"," at pages/index/index.vue:495")})).exec()}}),100)},methods:{waitForLoginThenInit:function(){var t=this,n=Date.now();(function r(){try{var i=getApp(),o=i&&i.globalData&&i.globalData._loginProcessCompleted,a=i&&i.globalData&&i.globalData.openid;if(o&&a)return e("log","\ud83d\udd10 [\u9996\u9875] \u68c0\u6d4b\u5230\u767b\u5f55\u5b8c\u6210\u4e14\u5df2\u83b7\u53d6 openid\uff0c\u5f00\u59cb\u62c9\u53d6\u6570\u636e"," at pages/index/index.vue:513"),void t.getIndexData()}catch(s){e("log","\ud83d\udd10 [\u9996\u9875] \u767b\u5f55\u68c0\u6d4b\u5f02\u5e38\uff08\u5ffd\u7565\u7ee7\u7eed\u7b49\u5f85\uff09",s," at pages/index/index.vue:518")}if(Date.now()-n>=5e3)return e("log","\u23f1\ufe0f [\u9996\u9875] \u767b\u5f55\u7b49\u5f85\u8d85\u65f6\uff0c\u515c\u5e95\u76f4\u63a5\u62c9\u53d6\u6570\u636e"," at pages/index/index.vue:521"),void t.getIndexData();setTimeout(r,100)})()},getIndexData:function(){var t=l.get("index_postList_cache");if(t)return e("log","Index: \u4f7f\u7528\u7f13\u5b58\u6570\u636e"," at pages/index/index.vue:533"),void this.setData({postList:t,page:Math.ceil(t.length/5),isLoading:!1});this.getPostList()},refreshData:function(){var e=this;l.remove("index_postList_cache"),this.setData({postList:[],swiperHeights:{},imageClampHeights:{},page:0,hasMore:!0},(function(){e.getPostList()}))},handlePreview:function(t){e("log","\u3010\u56fe\u7247\u9884\u89c8\u3011handlePreview\u4e8b\u4ef6\u89e6\u53d1"," at pages/index/index.vue:566");var n=t&&t.currentTarget?t.currentTarget.dataset:{};e("log","\u3010\u56fe\u7247\u9884\u89c8\u3011event.currentTarget.dataset:",n," at pages/index/index.vue:568");var r=y(t);return r||e("error","\u3010\u56fe\u7247\u9884\u89c8\u3011\u9884\u89c8\u6761\u4ef6\u4e0d\u6ee1\u8db3",n," at pages/index/index.vue:571"),r},onVote:function(t){var n=this;e("log","\u3010\u70b9\u8d5e\u3011onVote\u4e8b\u4ef6\u89e6\u53d1",t.currentTarget.dataset," at pages/index/index.vue:578");var r=t.currentTarget.dataset.postid,i=t.currentTarget.dataset.index;if(e("log","\u3010\u70b9\u8d5e\u3011postId:",r,"index:",i," at pages/index/index.vue:581"),this.votingInProgress[r])e("log","\u3010\u70b9\u8d5e\u3011\u6b63\u5728\u6295\u7968\u4e2d\uff0c\u8df3\u8fc7"," at pages/index/index.vue:583");else{this.setData((0,o.default)({},"votingInProgress.".concat(r),!0));var a=this.postList,s=a[i].votes,u=a[i].isVoted;e("log","\u3010\u70b9\u8d5e\u3011\u539f\u59cb\u72b6\u6001 - votes:",s,"isVoted:",u," at pages/index/index.vue:592"),a[i].votes=u?s-1:s+1,a[i].isVoted=!u,a[i].likeIcon=f.getLikeIcon(a[i].votes,a[i].isVoted),e("log","\u3010\u70b9\u8d5e\u3011\u66f4\u65b0\u540e\u72b6\u6001 - votes:",a[i].votes,"isVoted:",a[i].isVoted," at pages/index/index.vue:598"),e("log","\u3010\u70b9\u8d5e\u3011\u65b0\u7684likeIcon:",a[i].likeIcon," at pages/index/index.vue:599"),this.setData({postList:a}),h(r,{pageTag:"index",context:this,currentVotes:s,currentIsLiked:u,requireAuth:!0}).then((function(t){if(e("log","\u3010\u70b9\u8d5e\u3011\u670d\u52a1\u8fd4\u56de\u7ed3\u679c:",t," at pages/index/index.vue:611"),t.success)return a[i].votes=t.votes,a[i].isVoted=t.isLiked,a[i].likeIcon=t.likeIcon,n.setData({postList:a}),void e("log","\u3010\u70b9\u8d5e\u3011\u670d\u52a1\u8c03\u7528\u6210\u529f\uff0c\u6570\u636e\u5df2\u540c\u6b65"," at pages/index/index.vue:619");var r=t.rollback||{votes:s,isLiked:u,likeIcon:f.getLikeIcon(s,u)};e("warn","\u3010\u70b9\u8d5e\u3011\u670d\u52a1\u8fd4\u56de\u5931\u8d25\uff0c\u56de\u6edaUI"," at pages/index/index.vue:628"),a[i].votes=r.votes,a[i].isVoted=r.isLiked,a[i].likeIcon=r.likeIcon,n.setData({postList:a})})).catch((function(t){e("error","\u3010\u70b9\u8d5e\u3011\u8c03\u7528 likeService \u5931\u8d25:",t," at pages/index/index.vue:636"),a[i].votes=s,a[i].isVoted=u,a[i].likeIcon=f.getLikeIcon(s,u),n.setData({postList:a})})).finally((function(){e("log","\u3010\u70b9\u8d5e\u3011\u670d\u52a1\u8c03\u7528\u5b8c\u6210"," at pages/index/index.vue:644"),n.setData((0,o.default)({},"votingInProgress.".concat(r),!1))}))}},updatePostCommentCount:function(e,t){var n=this.postList,r=n.findIndex((function(t){return t._id===e}));r>-1&&this.setData((0,o.default)({},"postList[".concat(r,"].commentCount"),t))},onImageError:function(t){e("error","\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",t.detail," at pages/index/index.vue:662")},onAvatarError:function(t){e("error","\u5934\u50cf\u52a0\u8f7d\u5931\u8d25",t.detail," at pages/index/index.vue:666")},onAvatarLoad:function(t){e("log","\u5934\u50cf\u52a0\u8f7d\u6210\u529f",t.detail," at pages/index/index.vue:671")},onLikeIconError:function(t){e("error","\u70b9\u8d5e\u56fe\u6807\u52a0\u8f7d\u5931\u8d25",t.detail,"\u56fe\u6807\u8def\u5f84:",t.currentTarget.dataset.src," at pages/index/index.vue:675")},preloadImages:function(t){var n=t.filter((function(e){return e.imageUrls&&e.imageUrls.length>0})).map((function(e){return e.imageUrls[0]})).slice(0,3);n.length>0&&d.preloadImages(n,(function(t,n){n&&e("log","\u56fe\u7247\u9884\u52a0\u8f7d\u6210\u529f:",t," at pages/index/index.vue:688")}))},preloadUserData:function(e){if(e&&0!==e.length){var t=this.getCurrentUserId();t&&(g.preloadAvatarsFromPosts(e),v.preloadFollowStatusFromPosts(e,t))}},getCurrentUserId:function(){return this.openid||uni.getStorageSync("openid")||uni.getStorageSync("userOpenId")},navigateToUserProfile:function(t){e("log","\u3010\u5934\u50cf\u70b9\u51fb\u3011\u4e8b\u4ef6\u89e6\u53d1",t," at pages/index/index.vue:718"),e("log","\u3010\u5934\u50cf\u70b9\u51fb\u3011dataset:",t.currentTarget.dataset," at pages/index/index.vue:719");var n=t.currentTarget.dataset.userId;if(e("log","\u3010\u5934\u50cf\u70b9\u51fb\u3011\u63d0\u53d6\u7684userId:",n," at pages/index/index.vue:721"),n){var r=this.openid;n===r?(e("log","\u3010\u5934\u50cf\u70b9\u51fb\u3011\u70b9\u51fb\u7684\u662f\u81ea\u5df1\u5934\u50cf\uff0c\u5207\u6362\u5230\u6211\u7684\u9875\u9762"," at pages/index/index.vue:727"),uni.switchTab({url:"/pages/profile/profile"})):(e("log","\u3010\u5934\u50cf\u70b9\u51fb\u3011\u70b9\u51fb\u7684\u662f\u4ed6\u4eba\u5934\u50cf\uff0c\u8df3\u8f6c\u5230\u7528\u6237\u4e3b\u9875"," at pages/index/index.vue:732"),uni.navigateTo({url:"/pages/user-profile/user-profile?userId=".concat(n),success:function(){e("log","\u3010\u5934\u50cf\u70b9\u51fb\u3011\u8df3\u8f6c\u6210\u529f"," at pages/index/index.vue:736")},fail:function(t){e("error","\u3010\u5934\u50cf\u70b9\u51fb\u3011\u8df3\u8f6c\u5931\u8d25:",t," at pages/index/index.vue:739"),uni.showToast({title:"\u8df3\u8f6c\u5931\u8d25",icon:"none"})}}))}else e("error","\u3010\u5934\u50cf\u70b9\u51fb\u3011userId\u4e3a\u7a7a\uff0c\u65e0\u6cd5\u8df3\u8f6c"," at pages/index/index.vue:748"),uni.showToast({title:"\u7528\u6237\u4fe1\u606f\u83b7\u53d6\u5931\u8d25",icon:"none"})},getPostList:function(t){var n=this;if(e("log","\ud83d\udd0d [\u9996\u9875] getPostList \u5f00\u59cb\u8c03\u7528"," at pages/index/index.vue:758"),e("log","\ud83d\udd0d [\u9996\u9875] \u5f53\u524d\u72b6\u6001:",{isLoading:this.isLoading,isLoadingMore:this.isLoadingMore,hasMore:this.hasMore,page:this.page,postListLength:this.postList.length}," at pages/index/index.vue:759"),this.isLoading||this.isLoadingMore||!this.hasMore)return e("log","\u3010\u9996\u9875\u3011getPostList\u88ab\u963b\u6b62\uff1a\u6b63\u5728\u52a0\u8f7d\u4e2d\u6216\u6ca1\u6709\u66f4\u591a\u6570\u636e"," at pages/index/index.vue:769"),void("function"===typeof t&&t());var r=5*this.page,i=0===this.page;e("log","\ud83d\udd0d [\u9996\u9875] \u8bf7\u6c42\u53c2\u6570:",{skip:r,page:this.page,isFirstLoad:i,PAGE_SIZE:5}," at pages/index/index.vue:778"),i?this.setData({isLoading:!0}):this.setData({isLoadingMore:!0});Date.now();this.$tcb.callFunction({name:"getPostList",data:{skip:r,limit:5}}).then((function(t){if(e("log","\u2705 [\u9996\u9875] \u4e91\u51fd\u6570\u8c03\u7528\u6210\u529f\uff0c\u539f\u59cb\u54cd\u5e94:",t," at pages/index/index.vue:805"),t.result&&t.result.success){var r=t.result.posts||[];e("log","\u2705 [\u9996\u9875] \u83b7\u53d6\u5230\u5e16\u5b50\u6570\u91cf:",r.length," at pages/index/index.vue:808"),e("log","\u2705 [\u9996\u9875] \u5b8c\u6574\u54cd\u5e94\u6570\u636e:",t.result," at pages/index/index.vue:809"),r=b(r).map((function(e){return c(c({},e),{},{likeIcon:f.getLikeIcon(e.votes||0,e.isVoted||!1)})})),setTimeout((function(){n.preloadUserData(r)}),500);var o=r.length,a=n.postList,s=a.concat(r),u={postList:s,page:n.page+1,hasMore:5===o};e("log","\u2705 [\u9996\u9875] \u66f4\u65b0\u6570\u636e:",{newPostListLength:s.length,currentPage:n.page,newPage:n.page+1,hasMore:u.hasMore,newPostsCount:o}," at pages/index/index.vue:830"),n.setData(u),i&&(l.set("index_postList_cache",s),n.preloadImages(r))}else 0===n.page?uni.showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"}):n.setData({hasMore:!1})})).catch((function(t){e("error","\u3010\u9996\u9875\u3011getPostList\u4e91\u51fd\u6570\u8c03\u7528\u5931\u8d25:",t," at pages/index/index.vue:858"),i?uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"}):e("log","\u3010\u9996\u9875\u3011\u52a0\u8f7d\u66f4\u591a\u65f6\u7f51\u7edc\u9519\u8bef\uff0c\u9759\u9ed8\u5904\u7406"," at pages/index/index.vue:867")})).finally((function(){i?n.setData({isLoading:!1}):n.setData({isLoadingMore:!1}),"function"===typeof t&&t()}))},checkUnreadMessageCount:function(){var t=this;this.$tcb.callFunction({name:"getUnreadMessageCount"}).then((function(e){e.result&&e.result.success&&t.setData({unreadMessageCount:e.result.count||0})})).catch((function(t){e("error","\u83b7\u53d6\u672a\u8bfb\u6d88\u606f\u6570\u91cf\u5931\u8d25:",t," at pages/index/index.vue:899")}))},syncLikeStatusFromCache:function(){e("log","\u3010\u9996\u9875\u3011\u540c\u6b65\u70b9\u8d5e\u72b6\u6001\u4ece\u7f13\u5b58"," at pages/index/index.vue:905");var t=l.get("index_postList_cache");if(t&&Array.isArray(t)&&this.postList.length>0){e("log","\u3010\u9996\u9875\u3011\u53d1\u73b0\u7f13\u5b58\u6570\u636e\uff0c\u5f00\u59cb\u540c\u6b65\u70b9\u8d5e\u72b6\u6001"," at pages/index/index.vue:908");var n=!1,r=this.postList.map((function(r){var i=t.find((function(e){return e._id===r._id}));return!i||i.votes===r.votes&&i.isVoted===r.isVoted&&i.likeIcon===r.likeIcon?r:(e("log","\u3010\u9996\u9875\u3011\u540c\u6b65\u5e16\u5b50 ".concat(r._id," \u7684\u70b9\u8d5e\u72b6\u6001:"),{votes:"".concat(r.votes," -> ").concat(i.votes),isVoted:"".concat(r.isVoted," -> ").concat(i.isVoted)}," at pages/index/index.vue:917"),n=!0,c(c({},r),{},{votes:i.votes,isVoted:i.isVoted,likeIcon:i.likeIcon}))}));n?(e("log","\u3010\u9996\u9875\u3011\u70b9\u8d5e\u72b6\u6001\u5df2\u540c\u6b65\uff0c\u66f4\u65b0UI"," at pages/index/index.vue:933"),this.setData({postList:r})):e("log","\u3010\u9996\u9875\u3011\u70b9\u8d5e\u72b6\u6001\u65e0\u9700\u540c\u6b65"," at pages/index/index.vue:938")}else e("log","\u3010\u9996\u9875\u3011\u65e0\u7f13\u5b58\u6570\u636e\u6216\u5f53\u524d\u65e0\u5e16\u5b50\uff0c\u8df3\u8fc7\u540c\u6b65"," at pages/index/index.vue:941")},navigateToMessages:function(){uni.navigateTo({url:"/pages/messages/messages",success:function(){e("log","\u8df3\u8f6c\u5230\u6d88\u606f\u9875\u9762\u6210\u529f"," at pages/index/index.vue:950")},fail:function(t){e("error","\u8df3\u8f6c\u5230\u6d88\u606f\u9875\u9762\u5931\u8d25:",t," at pages/index/index.vue:953"),uni.showToast({title:"\u8df3\u8f6c\u5931\u8d25",icon:"none"})}})},onTagClick:function(t){var n=t.currentTarget.dataset.tag;e("log","\u70b9\u51fb\u6807\u7b7e:",n," at pages/index/index.vue:965"),uni.navigateTo({url:"/pages/tag-filter/tag-filter?tag=".concat(encodeURIComponent(n)),success:function(){e("log","\u8df3\u8f6c\u5230\u6807\u7b7e\u7b5b\u9009\u9875\u9762\u6210\u529f"," at pages/index/index.vue:971")},fail:function(t){e("error","\u8df3\u8f6c\u5230\u6807\u7b7e\u7b5b\u9009\u9875\u9762\u5931\u8d25:",t," at pages/index/index.vue:974"),uni.showToast({title:"\u8df3\u8f6c\u5931\u8d25",icon:"none"})}})},onCommentClick:function(t){var n=t.currentTarget.dataset.postid;e("log","\u70b9\u51fb\u8bc4\u8bba\uff0c\u8df3\u8f6c\u5230\u8be6\u60c5\u9875:",n," at pages/index/index.vue:986"),uni.navigateTo({url:"/pages/post-detail/post-detail?id=".concat(n),success:function(){e("log","\u8df3\u8f6c\u5230\u8be6\u60c5\u9875\u6210\u529f"," at pages/index/index.vue:990")},fail:function(t){e("error","\u8df3\u8f6c\u5230\u8be6\u60c5\u9875\u5931\u8d25:",t," at pages/index/index.vue:993"),uni.showToast({title:"\u8df3\u8f6c\u5931\u8d25",icon:"none"})}})},navigateToSearch:function(){e("log","\u70b9\u51fb\u641c\u7d22\u6846\uff0c\u8df3\u8f6c\u5230\u641c\u7d22\u9875\u9762"," at pages/index/index.vue:1004"),uni.navigateTo({url:"/pages/search/search",success:function(){e("log","\u8df3\u8f6c\u5230\u641c\u7d22\u9875\u9762\u6210\u529f"," at pages/index/index.vue:1008")},fail:function(t){e("error","\u8df3\u8f6c\u5230\u641c\u7d22\u9875\u9762\u5931\u8d25:",t," at pages/index/index.vue:1011"),uni.showToast({title:"\u8df3\u8f6c\u5931\u8d25",icon:"none"})}})},touchStart:function(e){this.setData({touchStartX:e.touches[0].clientX,touchStartY:e.touches[0].clientY})},touchEnd:function(t){var n=t.changedTouches[0].clientX,r=t.changedTouches[0].clientY,i=this.touchStartX-n,o=this.touchStartY-r,a=Math.sqrt(i*i+o*o),s=Math.abs(180*Math.atan2(Math.abs(o),Math.abs(i))/Math.PI);a>80&&Math.abs(i)>50&&s<45&&(i>0?(e("log","\u5de6\u6ed1\u5207\u6362\u56de\u4e3b\u9875"," at pages/index/index.vue:1046"),this.switchToHome()):(e("log","\u53f3\u6ed1\u5207\u6362\u5230\u53d1\u73b0\u9875"," at pages/index/index.vue:1050"),this.switchToDiscover()))},switchToDiscover:function(){var t=this;"discover"!==this.currentPage?(e("log","\u5207\u6362\u5230\u53d1\u73b0\u9875"," at pages/index/index.vue:1062"),this.setData({currentPage:"discover",showPageIndicator:!0,pageIndicatorText:"\u53d1\u73b0\u9875"}),0===this.discoverPostList.length?(e("log","\u5f00\u59cb\u52a0\u8f7d\u53d1\u73b0\u9875\u6570\u636e"," at pages/index/index.vue:1071"),this.loadDiscoverPosts()):e("log","\u53d1\u73b0\u9875\u5df2\u6709\u6570\u636e\uff0c\u76f4\u63a5\u5207\u6362"," at pages/index/index.vue:1074"),setTimeout((function(){t.setData({showPageIndicator:!1})}),3e3)):e("log","\u5df2\u7ecf\u5728\u53d1\u73b0\u9875\uff0c\u65e0\u9700\u5207\u6362"," at pages/index/index.vue:1059")},switchToHome:function(){var t=this;"home"!==this.currentPage?(e("log","\u5207\u6362\u56de\u4e3b\u9875"," at pages/index/index.vue:1091"),this.setData({currentPage:"home",showPageIndicator:!0,pageIndicatorText:"\u4e3b\u9875"}),setTimeout((function(){t.setData({showPageIndicator:!1})}),3e3)):e("log","\u5df2\u7ecf\u5728\u4e3b\u9875\uff0c\u65e0\u9700\u5207\u6362"," at pages/index/index.vue:1088")},loadDiscoverPosts:function(){e("log","\u5f00\u59cb\u52a0\u8f7d\u53d1\u73b0\u9875\u63a8\u8350\u6570\u636e"," at pages/index/index.vue:1108"),this.loadRecommendationPosts()},loadRecommendationPosts:function(){var t=this;e("log","\u4f7f\u7528\u63a8\u8350\u7b97\u6cd5\u52a0\u8f7d\u53d1\u73b0\u9875\u6570\u636e"," at pages/index/index.vue:1116"),this.$tcb.callFunction({name:"getRecommendationFeed",data:{personalizedLimit:3,hotLimit:2,skip:0,excludePostIds:this.discoverShownPostIds}}).then((function(n){if(e("log","\u83b7\u53d6\u63a8\u8350\u6570\u636e\u7ed3\u679c:",n," at pages/index/index.vue:1128"),n.result&&n.result.success){var r=n.result.posts||[];e("log","\u83b7\u53d6\u5230\u63a8\u8350\u5e16\u5b50\u6570\u91cf: ".concat(r.length," (\u4e2a\u6027\u5316: ").concat(n.result.personalizedCount,", \u6309\u6807\u7b7e: ").concat(n.result.tagBasedCount,", \u70ed\u95e8: ").concat(n.result.hotCount,", \u6700\u65b0: ").concat(n.result.latestCount,")")," at pages/index/index.vue:1131");var o=b(r).map((function(e){return c(c({},e),{},{likeIcon:f.getLikeIcon(e.votes||0,e.isVoted||!1)})})),a=o.map((function(e){return e._id})),s=[].concat((0,i.default)(t.discoverShownPostIds),(0,i.default)(a));t.setData({discoverPostList:o,discoverPage:1,discoverHasMore:!1,discoverShownPostIds:s,discoverRefreshTime:Date.now()}),e("log","\u53d1\u73b0\u9875\u63a8\u8350\u6570\u636e\u8bbe\u7f6e\u5b8c\u6210\uff0c\u5e16\u5b50\u6570\u91cf:",o.length," at pages/index/index.vue:1151")}else e("error","\u83b7\u53d6\u63a8\u8350\u6570\u636e\u5931\u8d25:",n," at pages/index/index.vue:1153"),uni.showToast({title:"\u63a8\u8350\u52a0\u8f7d\u5931\u8d25",icon:"none"})})).catch((function(t){e("error","\u63a8\u8350\u6570\u636e\u8bf7\u6c42\u5931\u8d25:",t," at pages/index/index.vue:1160"),uni.showToast({title:"\u7f51\u7edc\u9519\u8bef",icon:"none"})}))},refreshDiscoverPosts:function(){e("log","\u5237\u65b0\u53d1\u73b0\u9875\u63a8\u8350"," at pages/index/index.vue:1170"),this.setData({discoverPostList:[],discoverPage:0,discoverHasMore:!0,discoverShownPostIds:[],discoverRefreshTime:0}),this.loadRecommendationPosts()},refreshIndexData:function(){e("log","\u3010index\u3011\u5f00\u59cb\u5237\u65b0\u5e7f\u573a\u9875\u6570\u636e"," at pages/index/index.vue:1187"),l.clear("index_postList_cache"),this.setData({postList:[],page:0,hasMore:!0,isLoading:!1}),this.getIndexData()},callCloudFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return S(e,t,Object.assign({pageTag:"index",context:this},n))}}};t.default=C,t.default.components=Object.assign({skeleton:s.default},t.default.components||{})}).call(this,n("f3b9")["default"])},f202:function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},f208:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autoCount=void 0,t.getWsInstance=function(e){if(!r.Db.wsClientClass)throw new Error("to use realtime you must import realtime module first");var t=e.config.env;o[t]||(o[t]=new r.Db.wsClientClass({context:{appConfig:{docSizeLimit:1e3,realtimePingInterval:1e4,realtimePongWaitTimeout:5e3,request:new r.Db.reqClass(e.config)}}}));return o[t]},t.sleep=void 0;var r=n("b8e2");t.sleep=function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))};var i={};t.autoCount=function(e){return void 0===e&&(e="any"),i[e]||(i[e]=0),i[e]++};var o={}},f37a:function(e,t,n){"use strict";n.r(t);var r=n("a637"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},f37f:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.WritableStreamDefaultWriter=t.WritableStreamDefaultController=t.WritableStream=t.TransformStreamDefaultController=t.TransformStream=t.ReadableStreamDefaultReader=t.ReadableStreamDefaultController=t.ReadableStreamBYOBRequest=t.ReadableStreamBYOBReader=t.ReadableStream=t.ReadableByteStreamController=t.CountQueuingStrategy=t.ByteLengthQueuingStrategy=void 0;var i=r(n("7ca3")),o=r(n("67ad")),a=r(n("0bdb")),s=r(n("3b2d"));
/**
 * @license
 * web-streams-polyfill v4.2.0
 * Copyright 2025 Mattias Buelens, Diwank Singh Tomer and other contributors.
 * This code is released under the MIT license.
 * SPDX-License-Identifier: MIT
 */
function u(){}function c(e){return"object"==(0,s.default)(e)&&null!==e||"function"==typeof e}var l=u;function d(e,t){try{Object.defineProperty(e,"name",{value:t,configurable:!0})}catch(e){}}var f=Promise,p=Promise.resolve.bind(f),h=Promise.prototype.then,g=Promise.reject.bind(f),v=p;function m(e){return new f(e)}function y(e){return m((function(t){return t(e)}))}function _(e){return g(e)}function b(e,t,n){return h.call(e,t,n)}function w(e,t,n){b(b(e,t,n),void 0,l)}function S(e,t){w(e,t)}function I(e,t){w(e,void 0,t)}function C(e,t,n){return b(e,t,n)}function T(e){b(e,void 0,l)}var O=function(e){if("function"==typeof queueMicrotask)O=queueMicrotask;else{var t=y(void 0);O=function(e){return b(t,e)}}return O(e)};function E(e,t,n){if("function"!=typeof e)throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,n)}function x(e,t,n){try{return y(E(e,t,n))}catch(e){return _(e)}}var P=function(){function e(){(0,o.default)(this,e),this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}return(0,a.default)(e,[{key:"length",get:function(){return this._size}},{key:"push",value:function(e){var t=this._back,n=t;16383===t._elements.length&&(n={_elements:[],_next:void 0}),t._elements.push(e),n!==t&&(this._back=n,t._next=n),++this._size}},{key:"shift",value:function(){var e=this._front,t=e,n=this._cursor,r=n+1,i=e._elements,o=i[n];return 16384===r&&(t=e._next,r=0),--this._size,this._cursor=r,e!==t&&(this._front=t),i[n]=void 0,o}},{key:"forEach",value:function(e){for(var t=this._cursor,n=this._front,r=n._elements;!(t===r.length&&void 0===n._next||t===r.length&&(n=n._next,r=n._elements,t=0,0===r.length));)e(r[t]),++t}},{key:"peek",value:function(){var e=this._front,t=this._cursor;return e._elements[t]}}]),e}(),k=Symbol("[[AbortSteps]]"),A=Symbol("[[ErrorSteps]]"),R=Symbol("[[CancelSteps]]"),D=Symbol("[[PullSteps]]"),L=Symbol("[[ReleaseSteps]]");function N(e,t){e._ownerReadableStream=t,t._reader=e,"readable"===t._state?U(e):"closed"===t._state?function(e){U(e),q(e)}(e):F(e,t._storedError)}function M(e,t){return Hn(e._ownerReadableStream,t)}function $(e){var t=e._ownerReadableStream;"readable"===t._state?B(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):function(e,t){F(e,t)}(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),t._readableStreamController[L](),t._reader=void 0,e._ownerReadableStream=void 0}function j(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function U(e){e._closedPromise=m((function(t,n){e._closedPromise_resolve=t,e._closedPromise_reject=n}))}function F(e,t){U(e),B(e,t)}function B(e,t){void 0!==e._closedPromise_reject&&(T(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function q(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}var W=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},H=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function V(e,t){if(void 0!==e&&"object"!=(0,s.default)(n=e)&&"function"!=typeof n)throw new TypeError("".concat(t," is not an object."));var n}function G(e,t){if("function"!=typeof e)throw new TypeError("".concat(t," is not a function."))}function Y(e,t){if(!function(e){return"object"==(0,s.default)(e)&&null!==e||"function"==typeof e}(e))throw new TypeError("".concat(t," is not an object."))}function K(e,t,n){if(void 0===e)throw new TypeError("Parameter ".concat(t," is required in '").concat(n,"'."))}function z(e,t,n){if(void 0===e)throw new TypeError("".concat(t," is required in '").concat(n,"'."))}function J(e){return Number(e)}function Q(e){return 0===e?0:e}function X(e,t){var n=Number.MAX_SAFE_INTEGER,r=Number(e);if(r=Q(r),!W(r))throw new TypeError("".concat(t," is not a finite number"));if(r=function(e){return Q(H(e))}(r),r<0||r>n)throw new TypeError("".concat(t," is outside the accepted range of 0 to ").concat(n,", inclusive"));return W(r)&&0!==r?r:0}function Z(e,t){if(!qn(e))throw new TypeError("".concat(t," is not a ReadableStream."))}function ee(e){return new ue(e)}function te(e,t){e._reader._readRequests.push(t)}function ne(e,t,n){var r=e._reader._readRequests.shift();n?r._closeSteps():r._chunkSteps(t)}function re(e){return e._reader._readRequests.length}function ie(e){var t=e._reader;return void 0!==t&&!!ce(t)}var oe,ae,se,ue=function(){function e(t){if((0,o.default)(this,e),K(t,1,"ReadableStreamDefaultReader"),Z(t,"First parameter"),Wn(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");N(this,t),this._readRequests=new P}return(0,a.default)(e,[{key:"closed",get:function(){return ce(this)?this._closedPromise:_(fe("closed"))}},{key:"cancel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return ce(this)?void 0===this._ownerReadableStream?_(j("cancel")):M(this,e):_(fe("cancel"))}},{key:"read",value:function(){if(!ce(this))return _(fe("read"));if(void 0===this._ownerReadableStream)return _(j("read from"));var e,t,n=m((function(n,r){e=n,t=r}));return le(this,{_chunkSteps:function(t){return e({value:t,done:!1})},_closeSteps:function(){return e({value:void 0,done:!0})},_errorSteps:function(e){return t(e)}}),n}},{key:"releaseLock",value:function(){if(!ce(this))throw fe("releaseLock");void 0!==this._ownerReadableStream&&function(e){$(e);var t=new TypeError("Reader was released");de(e,t)}(this)}}]),e}();function ce(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readRequests")&&e instanceof ue}function le(e,t){var n=e._ownerReadableStream;n._disturbed=!0,"closed"===n._state?t._closeSteps():"errored"===n._state?t._errorSteps(n._storedError):n._readableStreamController[D](t)}function de(e,t){var n=e._readRequests;e._readRequests=new P,n.forEach((function(e){e._errorSteps(t)}))}function fe(e){return new TypeError("ReadableStreamDefaultReader.prototype.".concat(e," can only be used on a ReadableStreamDefaultReader"))}function pe(e){return e.slice()}function he(e,t,n,r,i){new Uint8Array(e).set(new Uint8Array(n,r,i),t)}t.ReadableStreamDefaultReader=ue,Object.defineProperties(ue.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),d(ue.prototype.cancel,"cancel"),d(ue.prototype.read,"read"),d(ue.prototype.releaseLock,"releaseLock"),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(ue.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});var ge=function(e){return ge="function"==typeof e.transfer?function(e){return e.transfer()}:"function"==typeof structuredClone?function(e){return structuredClone(e,{transfer:[e]})}:function(e){return e},ge(e)},ve=function(e){return ve="boolean"==typeof e.detached?function(e){return e.detached}:function(e){return 0===e.byteLength},ve(e)};function me(e,t,n){if(e.slice)return e.slice(t,n);var r=n-t,i=new ArrayBuffer(r);return he(i,0,e,t,r),i}function ye(e,t){var n=e[t];if(null!=n){if("function"!=typeof n)throw new TypeError("".concat(String(t)," is not a function"));return n}}function _e(e){try{var t=e.done,n=e.value;return b(v(n),(function(e){return{done:t,value:e}}))}catch(e){return _(e)}}var be=null!==(se=null!==(oe=Symbol.asyncIterator)&&void 0!==oe?oe:null===(ae=Symbol.for)||void 0===ae?void 0:ae.call(Symbol,"Symbol.asyncIterator"))&&void 0!==se?se:"@@asyncIterator";function we(e){var t=E(e.nextMethod,e.iterator,[]);if(!c(t))throw new TypeError("The iterator.next() method must return an object");return t}var Se=function(){function e(t,n){(0,o.default)(this,e),this._ongoingPromise=void 0,this._isFinished=!1,this._reader=t,this._preventCancel=n}return(0,a.default)(e,[{key:"next",value:function(){var e=this,t=function(){return e._nextSteps()};return this._ongoingPromise=this._ongoingPromise?C(this._ongoingPromise,t,t):t(),this._ongoingPromise}},{key:"return",value:function(e){var t=this,n=function(){return t._returnSteps(e)};return this._ongoingPromise=this._ongoingPromise?C(this._ongoingPromise,n,n):n(),this._ongoingPromise}},{key:"_nextSteps",value:function(){var e=this;if(this._isFinished)return Promise.resolve({value:void 0,done:!0});var t,n,r=this._reader,i=m((function(e,r){t=e,n=r}));return le(r,{_chunkSteps:function(n){e._ongoingPromise=void 0,O((function(){return t({value:n,done:!1})}))},_closeSteps:function(){e._ongoingPromise=void 0,e._isFinished=!0,$(r),t({value:void 0,done:!0})},_errorSteps:function(t){e._ongoingPromise=void 0,e._isFinished=!0,$(r),n(t)}}),i}},{key:"_returnSteps",value:function(e){if(this._isFinished)return Promise.resolve({value:e,done:!0});this._isFinished=!0;var t=this._reader;if(!this._preventCancel){var n=M(t,e);return $(t),C(n,(function(){return{value:e,done:!0}}))}return $(t),y({value:e,done:!0})}}]),e}(),Ie=(0,i.default)({next:function(){return Ce(this)?this._asyncIteratorImpl.next():_(Te("next"))},return:function(e){return Ce(this)?this._asyncIteratorImpl.return(e):_(Te("return"))}},be,(function(){return this}));function Ce(e){if(!c(e))return!1;if(!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof Se}catch(e){return!1}}function Te(e){return new TypeError("ReadableStreamAsyncIterator.".concat(e," can only be used on a ReadableSteamAsyncIterator"))}Object.defineProperty(Ie,be,{enumerable:!1});var Oe=Number.isNaN||function(e){return e!=e};function Ee(e){var t=me(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function xe(e){var t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function Pe(e,t,n){if("number"!=typeof(r=n)||Oe(r)||r<0||n===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");var r;e._queue.push({value:t,size:n}),e._queueTotalSize+=n}function ke(e){e._queue=new P,e._queueTotalSize=0}function Ae(e){return e===DataView}var Re=function(){function e(){throw(0,o.default)(this,e),new TypeError("Illegal constructor")}return(0,a.default)(e,[{key:"view",get:function(){if(!Ne(this))throw st("view");return this._view}},{key:"respond",value:function(e){if(!Ne(this))throw st("respond");if(K(e,1,"respond"),e=X(e,"First parameter"),void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");if(ve(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");it(this._associatedReadableByteStreamController,e)}},{key:"respondWithNewView",value:function(e){if(!Ne(this))throw st("respondWithNewView");if(K(e,1,"respondWithNewView"),!ArrayBuffer.isView(e))throw new TypeError("You can only respond with array buffer views");if(void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");if(ve(e.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");ot(this._associatedReadableByteStreamController,e)}}]),e}();t.ReadableStreamBYOBRequest=Re,Object.defineProperties(Re.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),d(Re.prototype.respond,"respond"),d(Re.prototype.respondWithNewView,"respondWithNewView"),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(Re.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});var De=function(){function e(){throw(0,o.default)(this,e),new TypeError("Illegal constructor")}return(0,a.default)(e,[{key:"byobRequest",get:function(){if(!Le(this))throw ut("byobRequest");return nt(this)}},{key:"desiredSize",get:function(){if(!Le(this))throw ut("desiredSize");return rt(this)}},{key:"close",value:function(){if(!Le(this))throw ut("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");var e=this._controlledReadableByteStream._state;if("readable"!==e)throw new TypeError("The stream (in ".concat(e," state) is not in the readable state and cannot be closed"));Xe(this)}},{key:"enqueue",value:function(e){if(!Le(this))throw ut("enqueue");if(K(e,1,"enqueue"),!ArrayBuffer.isView(e))throw new TypeError("chunk must be an array buffer view");if(0===e.byteLength)throw new TypeError("chunk must have non-zero byteLength");if(0===e.buffer.byteLength)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");var t=this._controlledReadableByteStream._state;if("readable"!==t)throw new TypeError("The stream (in ".concat(t," state) is not in the readable state and cannot be enqueued to"));Ze(this,e)}},{key:"error",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!Le(this))throw ut("error");et(this,e)}},{key:R,value:function(e){$e(this),ke(this);var t=this._cancelAlgorithm(e);return Qe(this),t}},{key:D,value:function(e){var t=this._controlledReadableByteStream;if(this._queueTotalSize>0)tt(this,e);else{var n=this._autoAllocateChunkSize;if(void 0!==n){var r;try{r=new ArrayBuffer(n)}catch(t){return void e._errorSteps(t)}var i={buffer:r,bufferByteLength:n,byteOffset:0,byteLength:n,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(i)}te(t,e),Me(this)}}},{key:L,value:function(){if(this._pendingPullIntos.length>0){var e=this._pendingPullIntos.peek();e.readerType="none",this._pendingPullIntos=new P,this._pendingPullIntos.push(e)}}}]),e}();function Le(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")&&e instanceof De}function Ne(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")&&e instanceof Re}function Me(e){var t=function(e){var t=e._controlledReadableByteStream;if("readable"!==t._state)return!1;if(e._closeRequested)return!1;if(!e._started)return!1;if(ie(t)&&re(t)>0)return!0;if(pt(t)&&ft(t)>0)return!0;var n=rt(e);return n>0}(e);t&&(e._pulling?e._pullAgain=!0:(e._pulling=!0,w(e._pullAlgorithm(),(function(){return e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Me(e)),null}),(function(t){return et(e,t),null}))))}function $e(e){Ye(e),e._pendingPullIntos=new P}function je(e,t){var n=!1;"closed"===e._state&&(n=!0);var r=Fe(t);"default"===t.readerType?ne(e,r,n):function(e,t,n){var r=e._reader,i=r._readIntoRequests.shift();n?i._closeSteps(t):i._chunkSteps(t)}(e,r,n)}function Ue(e,t){for(var n=0;n<t.length;++n)je(e,t[n])}function Fe(e){var t=e.bytesFilled,n=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/n)}function Be(e,t,n,r){e._queue.push({buffer:t,byteOffset:n,byteLength:r}),e._queueTotalSize+=r}function qe(e,t,n,r){var i;try{i=me(t,n,n+r)}catch(t){throw et(e,t),t}Be(e,i,0,r)}function We(e,t){t.bytesFilled>0&&qe(e,t.buffer,t.byteOffset,t.bytesFilled),Je(e)}function He(e,t){var n=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),r=t.bytesFilled+n,i=n,o=!1,a=r-r%t.elementSize;a>=t.minimumFill&&(i=a-t.bytesFilled,o=!0);for(var s=e._queue;i>0;){var u=s.peek(),c=Math.min(i,u.byteLength),l=t.byteOffset+t.bytesFilled;he(t.buffer,l,u.buffer,u.byteOffset,c),u.byteLength===c?s.shift():(u.byteOffset+=c,u.byteLength-=c),e._queueTotalSize-=c,Ve(e,c,t),i-=c}return o}function Ve(e,t,n){n.bytesFilled+=t}function Ge(e){0===e._queueTotalSize&&e._closeRequested?(Qe(e),Vn(e._controlledReadableByteStream)):Me(e)}function Ye(e){null!==e._byobRequest&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Ke(e){for(var t=[];e._pendingPullIntos.length>0&&0!==e._queueTotalSize;){var n=e._pendingPullIntos.peek();He(e,n)&&(Je(e),t.push(n))}return t}function ze(e,t){var n=e._pendingPullIntos.peek();Ye(e),"closed"===e._controlledReadableByteStream._state?function(e,t){"none"===t.readerType&&Je(e);var n=e._controlledReadableByteStream;if(pt(n)){for(var r=[];r.length<ft(n);)r.push(Je(e));Ue(n,r)}}(e,n):function(e,t,n){if(Ve(0,t,n),"none"!==n.readerType){if(!(n.bytesFilled<n.minimumFill)){Je(e);var r=n.bytesFilled%n.elementSize;if(r>0){var i=n.byteOffset+n.bytesFilled;qe(e,n.buffer,i-r,r)}n.bytesFilled-=r;var o=Ke(e);je(e._controlledReadableByteStream,n),Ue(e._controlledReadableByteStream,o)}}else{We(e,n);var a=Ke(e);Ue(e._controlledReadableByteStream,a)}}(e,t,n),Me(e)}function Je(e){return e._pendingPullIntos.shift()}function Qe(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function Xe(e){var t=e._controlledReadableByteStream;if(!e._closeRequested&&"readable"===t._state)if(e._queueTotalSize>0)e._closeRequested=!0;else{if(e._pendingPullIntos.length>0){var n=e._pendingPullIntos.peek();if(n.bytesFilled%n.elementSize!==0){var r=new TypeError("Insufficient bytes to fill elements in the given buffer");throw et(e,r),r}}Qe(e),Vn(t)}}function Ze(e,t){var n=e._controlledReadableByteStream;if(!e._closeRequested&&"readable"===n._state){var r=t.buffer,i=t.byteOffset,o=t.byteLength;if(ve(r))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");var a=ge(r);if(e._pendingPullIntos.length>0){var s=e._pendingPullIntos.peek();if(ve(s.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Ye(e),s.buffer=ge(s.buffer),"none"===s.readerType&&We(e,s)}ie(n)?(function(e){for(var t=e._controlledReadableByteStream._reader;t._readRequests.length>0;){if(0===e._queueTotalSize)return;tt(e,t._readRequests.shift())}}(e),0===re(n)?Be(e,a,i,o):(e._pendingPullIntos.length>0&&Je(e),ne(n,new Uint8Array(a,i,o),!1))):pt(n)?(Be(e,a,i,o),Ue(n,Ke(e))):Be(e,a,i,o),Me(e)}}function et(e,t){var n=e._controlledReadableByteStream;"readable"===n._state&&($e(e),ke(e),Qe(e),Gn(n,t))}function tt(e,t){var n=e._queue.shift();e._queueTotalSize-=n.byteLength,Ge(e);var r=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);t._chunkSteps(r)}function nt(e){if(null===e._byobRequest&&e._pendingPullIntos.length>0){var t=e._pendingPullIntos.peek(),n=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),r=Object.create(Re.prototype);!function(e,t,n){e._associatedReadableByteStreamController=t,e._view=n}(r,e,n),e._byobRequest=r}return e._byobRequest}function rt(e){var t=e._controlledReadableByteStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function it(e,t){var n=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(0===t)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(n.bytesFilled+t>n.byteLength)throw new RangeError("bytesWritten out of range")}n.buffer=ge(n.buffer),ze(e,t)}function ot(e,t){var n=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t.byteLength)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(0===t.byteLength)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(n.byteOffset+n.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(n.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(n.bytesFilled+t.byteLength>n.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");var r=t.byteLength;n.buffer=ge(t.buffer),ze(e,r)}function at(e,t,n,r,i,o,a){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,ke(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=o,t._pullAlgorithm=r,t._cancelAlgorithm=i,t._autoAllocateChunkSize=a,t._pendingPullIntos=new P,e._readableStreamController=t,w(y(n()),(function(){return t._started=!0,Me(t),null}),(function(e){return et(t,e),null}))}function st(e){return new TypeError("ReadableStreamBYOBRequest.prototype.".concat(e," can only be used on a ReadableStreamBYOBRequest"))}function ut(e){return new TypeError("ReadableByteStreamController.prototype.".concat(e," can only be used on a ReadableByteStreamController"))}function ct(e,t){if("byob"!==(e="".concat(e)))throw new TypeError("".concat(t," '").concat(e,"' is not a valid enumeration value for ReadableStreamReaderMode"));return e}function lt(e){return new ht(e)}function dt(e,t){e._reader._readIntoRequests.push(t)}function ft(e){return e._reader._readIntoRequests.length}function pt(e){var t=e._reader;return void 0!==t&&!!gt(t)}t.ReadableByteStreamController=De,Object.defineProperties(De.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),d(De.prototype.close,"close"),d(De.prototype.enqueue,"enqueue"),d(De.prototype.error,"error"),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(De.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});var ht=function(){function e(t){if((0,o.default)(this,e),K(t,1,"ReadableStreamBYOBReader"),Z(t,"First parameter"),Wn(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Le(t._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");N(this,t),this._readIntoRequests=new P}return(0,a.default)(e,[{key:"closed",get:function(){return gt(this)?this._closedPromise:_(yt("closed"))}},{key:"cancel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return gt(this)?void 0===this._ownerReadableStream?_(j("cancel")):M(this,e):_(yt("cancel"))}},{key:"read",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!gt(this))return _(yt("read"));if(!ArrayBuffer.isView(e))return _(new TypeError("view must be an array buffer view"));if(0===e.byteLength)return _(new TypeError("view must have non-zero byteLength"));if(0===e.buffer.byteLength)return _(new TypeError("view's buffer must have non-zero byteLength"));if(ve(e.buffer))return _(new TypeError("view's buffer has been detached"));try{t=function(e,t){var n;return V(e,t),{min:X(null!==(n=null==e?void 0:e.min)&&void 0!==n?n:1,"".concat(t," has member 'min' that"))}}(n,"options")}catch(e){return _(e)}var r,i,o=t.min;if(0===o)return _(new TypeError("options.min must be greater than 0"));if(function(e){return Ae(e.constructor)}(e)){if(o>e.byteLength)return _(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(o>e.length)return _(new RangeError("options.min must be less than or equal to view's length"));if(void 0===this._ownerReadableStream)return _(j("read from"));var a=m((function(e,t){r=e,i=t}));return vt(this,e,o,{_chunkSteps:function(e){return r({value:e,done:!1})},_closeSteps:function(e){return r({value:e,done:!0})},_errorSteps:function(e){return i(e)}}),a}},{key:"releaseLock",value:function(){if(!gt(this))throw yt("releaseLock");void 0!==this._ownerReadableStream&&function(e){$(e);var t=new TypeError("Reader was released");mt(e,t)}(this)}}]),e}();function gt(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")&&e instanceof ht}function vt(e,t,n,r){var i=e._ownerReadableStream;i._disturbed=!0,"errored"===i._state?r._errorSteps(i._storedError):function(e,t,n,r){var i,o=e._controlledReadableByteStream,a=t.constructor,s=function(e){return Ae(e)?1:e.BYTES_PER_ELEMENT}(a),u=t.byteOffset,c=t.byteLength,l=n*s;try{i=ge(t.buffer)}catch(e){return void r._errorSteps(e)}var d={buffer:i,bufferByteLength:i.byteLength,byteOffset:u,byteLength:c,bytesFilled:0,minimumFill:l,elementSize:s,viewConstructor:a,readerType:"byob"};if(e._pendingPullIntos.length>0)return e._pendingPullIntos.push(d),void dt(o,r);if("closed"!==o._state){if(e._queueTotalSize>0){if(He(e,d)){var f=Fe(d);return Ge(e),void r._chunkSteps(f)}if(e._closeRequested){var p=new TypeError("Insufficient bytes to fill elements in the given buffer");return et(e,p),void r._errorSteps(p)}}e._pendingPullIntos.push(d),dt(o,r),Me(e)}else{var h=new a(d.buffer,d.byteOffset,0);r._closeSteps(h)}}(i._readableStreamController,t,n,r)}function mt(e,t){var n=e._readIntoRequests;e._readIntoRequests=new P,n.forEach((function(e){e._errorSteps(t)}))}function yt(e){return new TypeError("ReadableStreamBYOBReader.prototype.".concat(e," can only be used on a ReadableStreamBYOBReader"))}function _t(e,t){var n=e.highWaterMark;if(void 0===n)return t;if(Oe(n)||n<0)throw new RangeError("Invalid highWaterMark");return n}function bt(e){var t=e.size;return t||function(){return 1}}function wt(e,t){V(e,t);var n=null==e?void 0:e.highWaterMark,r=null==e?void 0:e.size;return{highWaterMark:void 0===n?void 0:J(n),size:void 0===r?void 0:St(r,"".concat(t," has member 'size' that"))}}function St(e,t){return G(e,t),function(t){return J(e(t))}}function It(e,t,n){return G(e,n),function(n){return x(e,t,[n])}}function Ct(e,t,n){return G(e,n),function(){return x(e,t,[])}}function Tt(e,t,n){return G(e,n),function(n){return E(e,t,[n])}}function Ot(e,t,n){return G(e,n),function(n,r){return x(e,t,[n,r])}}function Et(e,t){if(!At(e))throw new TypeError("".concat(t," is not a WritableStream."))}t.ReadableStreamBYOBReader=ht,Object.defineProperties(ht.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),d(ht.prototype.cancel,"cancel"),d(ht.prototype.read,"read"),d(ht.prototype.releaseLock,"releaseLock"),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(ht.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});var xt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.default)(this,e),void 0===t?t=null:Y(t,"First parameter");var r=wt(n,"Second parameter"),i=function(e,t){V(e,t);var n=null==e?void 0:e.abort,r=null==e?void 0:e.close,i=null==e?void 0:e.start,o=null==e?void 0:e.type,a=null==e?void 0:e.write;return{abort:void 0===n?void 0:It(n,e,"".concat(t," has member 'abort' that")),close:void 0===r?void 0:Ct(r,e,"".concat(t," has member 'close' that")),start:void 0===i?void 0:Tt(i,e,"".concat(t," has member 'start' that")),write:void 0===a?void 0:Ot(a,e,"".concat(t," has member 'write' that")),type:o}}(t,"First parameter");if(kt(this),void 0!==i.type)throw new RangeError("Invalid type is specified");var a=bt(r);!function(e,t,n,r){var i,o,a,s,u=Object.create(Kt.prototype);i=void 0!==t.start?function(){return t.start(u)}:function(){},o=void 0!==t.write?function(e){return t.write(e,u)}:function(){return y(void 0)},a=void 0!==t.close?function(){return t.close()}:function(){return y(void 0)},s=void 0!==t.abort?function(e){return t.abort(e)}:function(){return y(void 0)},Jt(e,u,i,o,a,s,n,r)}(this,i,_t(r,1),a)}return(0,a.default)(e,[{key:"locked",get:function(){if(!At(this))throw rn("locked");return Rt(this)}},{key:"abort",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return At(this)?Rt(this)?_(new TypeError("Cannot abort a stream that already has a writer")):Dt(this,e):_(rn("abort"))}},{key:"close",value:function(){return At(this)?Rt(this)?_(new TypeError("Cannot close a stream that already has a writer")):jt(this)?_(new TypeError("Cannot close an already-closing stream")):Lt(this):_(rn("close"))}},{key:"getWriter",value:function(){if(!At(this))throw rn("getWriter");return Pt(this)}}]),e}();function Pt(e){return new Bt(e)}function kt(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new P,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function At(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")&&e instanceof xt}function Rt(e){return void 0!==e._writer}function Dt(e,t){var n;if("closed"===e._state||"errored"===e._state)return y(void 0);e._writableStreamController._abortReason=t,null===(n=e._writableStreamController._abortController)||void 0===n||n.abort(t);var r=e._state;if("closed"===r||"errored"===r)return y(void 0);if(void 0!==e._pendingAbortRequest)return e._pendingAbortRequest._promise;var i=!1;"erroring"===r&&(i=!0,t=void 0);var o=m((function(n,r){e._pendingAbortRequest={_promise:void 0,_resolve:n,_reject:r,_reason:t,_wasAlreadyErroring:i}}));return e._pendingAbortRequest._promise=o,i||Mt(e,t),o}function Lt(e){var t=e._state;if("closed"===t||"errored"===t)return _(new TypeError("The stream (in ".concat(t," state) is not in the writable state and cannot be closed")));var n,r=m((function(t,n){var r={_resolve:t,_reject:n};e._closeRequest=r})),i=e._writer;return void 0!==i&&e._backpressure&&"writable"===t&&vn(i),Pe(n=e._writableStreamController,Yt,0),Zt(n),r}function Nt(e,t){"writable"!==e._state?$t(e):Mt(e,t)}function Mt(e,t){var n=e._writableStreamController;e._state="erroring",e._storedError=t;var r=e._writer;void 0!==r&&Ht(r,t),!function(e){return void 0!==e._inFlightWriteRequest||void 0!==e._inFlightCloseRequest}(e)&&n._started&&$t(e)}function $t(e){e._state="errored",e._writableStreamController[A]();var t=e._storedError;if(e._writeRequests.forEach((function(e){e._reject(t)})),e._writeRequests=new P,void 0!==e._pendingAbortRequest){var n=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,n._wasAlreadyErroring)return n._reject(t),void Ut(e);w(e._writableStreamController[k](n._reason),(function(){return n._resolve(),Ut(e),null}),(function(t){return n._reject(t),Ut(e),null}))}else Ut(e)}function jt(e){return void 0!==e._closeRequest||void 0!==e._inFlightCloseRequest}function Ut(e){void 0!==e._closeRequest&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);var t=e._writer;void 0!==t&&ln(t,e._storedError)}function Ft(e,t){var n=e._writer;void 0!==n&&t!==e._backpressure&&(t?function(e){fn(e)}(n):vn(n)),e._backpressure=t}t.WritableStream=xt,Object.defineProperties(xt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),d(xt.prototype.abort,"abort"),d(xt.prototype.close,"close"),d(xt.prototype.getWriter,"getWriter"),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(xt.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});var Bt=function(){function e(t){if((0,o.default)(this,e),K(t,1,"WritableStreamDefaultWriter"),Et(t,"First parameter"),Rt(t))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=t,t._writer=this;var n=t._state;if("writable"===n)!jt(t)&&t._backpressure?fn(this):hn(this),un(this);else if("erroring"===n)pn(this,t._storedError),un(this);else if("closed"===n)hn(this),un(this),dn(this);else{var r=t._storedError;pn(this,r),cn(this,r)}}return(0,a.default)(e,[{key:"closed",get:function(){return qt(this)?this._closedPromise:_(an("closed"))}},{key:"desiredSize",get:function(){if(!qt(this))throw an("desiredSize");if(void 0===this._ownerWritableStream)throw sn("desiredSize");return function(e){var t=e._ownerWritableStream,n=t._state;return"errored"===n||"erroring"===n?null:"closed"===n?0:Xt(t._writableStreamController)}(this)}},{key:"ready",get:function(){return qt(this)?this._readyPromise:_(an("ready"))}},{key:"abort",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return qt(this)?void 0===this._ownerWritableStream?_(sn("abort")):function(e,t){return Dt(e._ownerWritableStream,t)}(this,e):_(an("abort"))}},{key:"close",value:function(){if(!qt(this))return _(an("close"));var e=this._ownerWritableStream;return void 0===e?_(sn("close")):jt(e)?_(new TypeError("Cannot close an already-closing stream")):Wt(this)}},{key:"releaseLock",value:function(){if(!qt(this))throw an("releaseLock");void 0!==this._ownerWritableStream&&Vt(this)}},{key:"write",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return qt(this)?void 0===this._ownerWritableStream?_(sn("write to")):Gt(this,e):_(an("write"))}}]),e}();function qt(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")&&e instanceof Bt}function Wt(e){return Lt(e._ownerWritableStream)}function Ht(e,t){"pending"===e._readyPromiseState?gn(e,t):function(e,t){pn(e,t)}(e,t)}function Vt(e){var t=e._ownerWritableStream,n=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Ht(e,n),function(e,t){"pending"===e._closedPromiseState?ln(e,t):function(e,t){cn(e,t)}(e,t)}(e,n),t._writer=void 0,e._ownerWritableStream=void 0}function Gt(e,t){var n=e._ownerWritableStream,r=n._writableStreamController,i=function(e,t){if(void 0===e._strategySizeAlgorithm)return 1;try{return e._strategySizeAlgorithm(t)}catch(t){return en(e,t),1}}(r,t);if(n!==e._ownerWritableStream)return _(sn("write to"));var o=n._state;if("errored"===o)return _(n._storedError);if(jt(n)||"closed"===o)return _(new TypeError("The stream is closing or closed and cannot be written to"));if("erroring"===o)return _(n._storedError);var a=function(e){return m((function(t,n){var r={_resolve:t,_reject:n};e._writeRequests.push(r)}))}(n);return function(e,t,n){try{Pe(e,t,n)}catch(t){return void en(e,t)}var r=e._controlledWritableStream;jt(r)||"writable"!==r._state||Ft(r,tn(e)),Zt(e)}(r,t,i),a}t.WritableStreamDefaultWriter=Bt,Object.defineProperties(Bt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),d(Bt.prototype.abort,"abort"),d(Bt.prototype.close,"close"),d(Bt.prototype.releaseLock,"releaseLock"),d(Bt.prototype.write,"write"),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(Bt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});var Yt={},Kt=function(){function e(){throw(0,o.default)(this,e),new TypeError("Illegal constructor")}return(0,a.default)(e,[{key:"abortReason",get:function(){if(!zt(this))throw on("abortReason");return this._abortReason}},{key:"signal",get:function(){if(!zt(this))throw on("signal");if(void 0===this._abortController)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}},{key:"error",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!zt(this))throw on("error");"writable"===this._controlledWritableStream._state&&nn(this,e)}},{key:k,value:function(e){var t=this._abortAlgorithm(e);return Qt(this),t}},{key:A,value:function(){ke(this)}}]),e}();function zt(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")&&e instanceof Kt}function Jt(e,t,n,r,i,o,a,s){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,ke(t),t._abortReason=void 0,t._abortController=function(){if("function"==typeof AbortController)return new AbortController}(),t._started=!1,t._strategySizeAlgorithm=s,t._strategyHWM=a,t._writeAlgorithm=r,t._closeAlgorithm=i,t._abortAlgorithm=o;var u=tn(t);Ft(e,u),w(y(n()),(function(){return t._started=!0,Zt(t),null}),(function(n){return t._started=!0,Nt(e,n),null}))}function Qt(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Xt(e){return e._strategyHWM-e._queueTotalSize}function Zt(e){var t=e._controlledWritableStream;if(e._started&&void 0===t._inFlightWriteRequest)if("erroring"!==t._state){if(0!==e._queue.length){var n=e._queue.peek().value;n===Yt?function(e){var t=e._controlledWritableStream;(function(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0})(t),xe(e);var n=e._closeAlgorithm();Qt(e),w(n,(function(){return function(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,"erroring"===e._state&&(e._storedError=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";var t=e._writer;void 0!==t&&dn(t)}(t),null}),(function(e){return function(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),Nt(e,t)}(t,e),null}))}(e):function(e,t){var n=e._controlledWritableStream;!function(e){e._inFlightWriteRequest=e._writeRequests.shift()}(n);var r=e._writeAlgorithm(t);w(r,(function(){!function(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}(n);var t=n._state;if(xe(e),!jt(n)&&"writable"===t){var r=tn(e);Ft(n,r)}return Zt(e),null}),(function(t){return"writable"===n._state&&Qt(e),function(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,Nt(e,t)}(n,t),null}))}(e,n)}}else $t(t)}function en(e,t){"writable"===e._controlledWritableStream._state&&nn(e,t)}function tn(e){return Xt(e)<=0}function nn(e,t){var n=e._controlledWritableStream;Qt(e),Mt(n,t)}function rn(e){return new TypeError("WritableStream.prototype.".concat(e," can only be used on a WritableStream"))}function on(e){return new TypeError("WritableStreamDefaultController.prototype.".concat(e," can only be used on a WritableStreamDefaultController"))}function an(e){return new TypeError("WritableStreamDefaultWriter.prototype.".concat(e," can only be used on a WritableStreamDefaultWriter"))}function sn(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function un(e){e._closedPromise=m((function(t,n){e._closedPromise_resolve=t,e._closedPromise_reject=n,e._closedPromiseState="pending"}))}function cn(e,t){un(e),ln(e,t)}function ln(e,t){void 0!==e._closedPromise_reject&&(T(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function dn(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function fn(e){e._readyPromise=m((function(t,n){e._readyPromise_resolve=t,e._readyPromise_reject=n})),e._readyPromiseState="pending"}function pn(e,t){fn(e),gn(e,t)}function hn(e){fn(e),vn(e)}function gn(e,t){void 0!==e._readyPromise_reject&&(T(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function vn(e){void 0!==e._readyPromise_resolve&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}t.WritableStreamDefaultController=Kt,Object.defineProperties(Kt.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(Kt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});var mn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof e?e:void 0,yn=function(){var e=null==mn?void 0:mn.DOMException;return function(e){if("function"!=typeof e&&"object"!=(0,s.default)(e))return!1;if("DOMException"!==e.name)return!1;try{return new e,!0}catch(e){return!1}}(e)?e:void 0}()||function(){var e=function(e,t){this.message=e||"",this.name=t||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return d(e,"DOMException"),e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}();function _n(e,t,n,r,i,o){var a=ee(e),s=Pt(t);e._disturbed=!0;var c=!1,l=y(void 0);return m((function(d,f){var p,h,g,v;if(void 0!==o){if(p=function(){var n=void 0!==o.reason?o.reason:new yn("Aborted","AbortError"),a=[];r||a.push((function(){return"writable"===t._state?Dt(t,n):y(void 0)})),i||a.push((function(){return"readable"===e._state?Hn(e,n):y(void 0)})),x((function(){return Promise.all(a.map((function(e){return e()})))}),!0,n)},o.aborted)return void p();o.addEventListener("abort",p)}if(E(e,a._closedPromise,(function(e){return r?P(!0,e):x((function(){return Dt(t,e)}),!0,e),null})),E(t,s._closedPromise,(function(t){return i?P(!0,t):x((function(){return Hn(e,t)}),!0,t),null})),h=e,g=a._closedPromise,v=function(){return n?P():x((function(){return function(e){var t=e._ownerWritableStream,n=t._state;return jt(t)||"closed"===n?y(void 0):"errored"===n?_(t._storedError):Wt(e)}(s)})),null},"closed"===h._state?v():S(g,v),jt(t)||"closed"===t._state){var C=new TypeError("the destination writable stream closed before all data could be piped to it");i?P(!0,C):x((function(){return Hn(e,C)}),!0,C)}function O(){var e=l;return b(l,(function(){return e!==l?O():void 0}))}function E(e,t,n){"errored"===e._state?n(e._storedError):I(t,n)}function x(e,n,r){function i(){return w(e(),(function(){return k(n,r)}),(function(e){return k(!0,e)})),null}c||(c=!0,"writable"!==t._state||jt(t)?i():S(O(),i))}function P(e,n){c||(c=!0,"writable"!==t._state||jt(t)?k(e,n):S(O(),(function(){return k(e,n)})))}function k(e,t){return Vt(s),$(a),void 0!==o&&o.removeEventListener("abort",p),e?f(t):d(void 0),null}T(m((function(e,t){!function n(r){r?e():b(c?y(!0):b(s._readyPromise,(function(){return m((function(e,t){le(a,{_chunkSteps:function(t){l=b(Gt(s,t),void 0,u),e(!1)},_closeSteps:function(){return e(!0)},_errorSteps:t})}))})),n,t)}(!1)})))}))}var bn=function(){function e(){throw(0,o.default)(this,e),new TypeError("Illegal constructor")}return(0,a.default)(e,[{key:"desiredSize",get:function(){if(!wn(this))throw An("desiredSize");return xn(this)}},{key:"close",value:function(){if(!wn(this))throw An("close");if(!Pn(this))throw new TypeError("The stream is not in a state that permits close");Tn(this)}},{key:"enqueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!wn(this))throw An("enqueue");if(!Pn(this))throw new TypeError("The stream is not in a state that permits enqueue");return On(this,e)}},{key:"error",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!wn(this))throw An("error");En(this,e)}},{key:R,value:function(e){ke(this);var t=this._cancelAlgorithm(e);return Cn(this),t}},{key:D,value:function(e){var t=this._controlledReadableStream;if(this._queue.length>0){var n=xe(this);this._closeRequested&&0===this._queue.length?(Cn(this),Vn(t)):Sn(this),e._chunkSteps(n)}else te(t,e),Sn(this)}},{key:L,value:function(){}}]),e}();function wn(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")&&e instanceof bn}function Sn(e){In(e)&&(e._pulling?e._pullAgain=!0:(e._pulling=!0,w(e._pullAlgorithm(),(function(){return e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Sn(e)),null}),(function(t){return En(e,t),null}))))}function In(e){var t=e._controlledReadableStream;return!!Pn(e)&&(!!e._started&&(!!(Wn(t)&&re(t)>0)||xn(e)>0))}function Cn(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Tn(e){if(Pn(e)){var t=e._controlledReadableStream;e._closeRequested=!0,0===e._queue.length&&(Cn(e),Vn(t))}}function On(e,t){if(Pn(e)){var n=e._controlledReadableStream;if(Wn(n)&&re(n)>0)ne(n,t,!1);else{var r;try{r=e._strategySizeAlgorithm(t)}catch(t){throw En(e,t),t}try{Pe(e,t,r)}catch(t){throw En(e,t),t}}Sn(e)}}function En(e,t){var n=e._controlledReadableStream;"readable"===n._state&&(ke(e),Cn(e),Gn(n,t))}function xn(e){var t=e._controlledReadableStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function Pn(e){var t=e._controlledReadableStream._state;return!e._closeRequested&&"readable"===t}function kn(e,t,n,r,i,o,a){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,ke(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=a,t._strategyHWM=o,t._pullAlgorithm=r,t._cancelAlgorithm=i,e._readableStreamController=t,w(y(n()),(function(){return t._started=!0,Sn(t),null}),(function(e){return En(t,e),null}))}function An(e){return new TypeError("ReadableStreamDefaultController.prototype.".concat(e," can only be used on a ReadableStreamDefaultController"))}function Rn(e){return c(t=e)&&void 0!==t.getReader?function(e){var t;return t=Un(u,(function(){var n;try{n=e.read()}catch(n){return _(n)}return C(n,(function(e){if(!c(e))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(e.done)Tn(t._readableStreamController);else{var n=e.value;On(t._readableStreamController,n)}}))}),(function(t){try{return y(e.cancel(t))}catch(t){return _(t)}}),0),t}(e.getReader()):function(e){var t,n=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sync",r=arguments.length>2?arguments[2]:void 0;if(void 0===r)if("async"===n){if(void 0===(r=ye(t,be)))return function(e){var t={next:function(){var t;try{t=we(e)}catch(e){return _(e)}return _e(t)},return:function(t){var n;try{var r=ye(e.iterator,"return");if(void 0===r)return y({done:!0,value:t});n=E(r,e.iterator,[t])}catch(e){return _(e)}return c(n)?_e(n):_(new TypeError("The iterator.return() method must return an object"))}};return{iterator:t,nextMethod:t.next,done:!1}}(e(t,"sync",ye(t,Symbol.iterator)))}else r=ye(t,Symbol.iterator);if(void 0===r)throw new TypeError("The object is not iterable");var i=E(r,t,[]);if(!c(i))throw new TypeError("The iterator method must return an object");return{iterator:i,nextMethod:i.next,done:!1}}(e,"async");return t=Un(u,(function(){var e;try{e=we(n)}catch(e){return _(e)}return C(y(e),(function(e){if(!c(e))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(e.done)Tn(t._readableStreamController);else{var n=e.value;On(t._readableStreamController,n)}}))}),(function(e){var t,r=n.iterator;try{t=ye(r,"return")}catch(e){return _(e)}return void 0===t?y(void 0):C(x(t,r,[e]),(function(e){if(!c(e))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")}))}),0),t}(e);var t}function Dn(e,t,n){return G(e,n),function(n){return x(e,t,[n])}}function Ln(e,t,n){return G(e,n),function(n){return x(e,t,[n])}}function Nn(e,t,n){return G(e,n),function(n){return E(e,t,[n])}}function Mn(e,t){if("bytes"!==(e="".concat(e)))throw new TypeError("".concat(t," '").concat(e,"' is not a valid enumeration value for ReadableStreamType"));return e}function $n(e,t){V(e,t);var n=null==e?void 0:e.preventAbort,r=null==e?void 0:e.preventCancel,i=null==e?void 0:e.preventClose,o=null==e?void 0:e.signal;return void 0!==o&&function(e,t){if(!function(e){if("object"!=(0,s.default)(e)||null===e)return!1;try{return"boolean"==typeof e.aborted}catch(e){return!1}}(e))throw new TypeError("".concat(t," is not an AbortSignal."))}(o,"".concat(t," has member 'signal' that")),{preventAbort:Boolean(n),preventCancel:Boolean(r),preventClose:Boolean(i),signal:o}}t.ReadableStreamDefaultController=bn,Object.defineProperties(bn.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),d(bn.prototype.close,"close"),d(bn.prototype.enqueue,"enqueue"),d(bn.prototype.error,"error"),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(bn.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});var jn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.default)(this,e),void 0===t?t=null:Y(t,"First parameter");var r=wt(n,"Second parameter"),i=function(e,t){V(e,t);var n=e,r=null==n?void 0:n.autoAllocateChunkSize,i=null==n?void 0:n.cancel,o=null==n?void 0:n.pull,a=null==n?void 0:n.start,s=null==n?void 0:n.type;return{autoAllocateChunkSize:void 0===r?void 0:X(r,"".concat(t," has member 'autoAllocateChunkSize' that")),cancel:void 0===i?void 0:Dn(i,n,"".concat(t," has member 'cancel' that")),pull:void 0===o?void 0:Ln(o,n,"".concat(t," has member 'pull' that")),start:void 0===a?void 0:Nn(a,n,"".concat(t," has member 'start' that")),type:void 0===s?void 0:Mn(s,"".concat(t," has member 'type' that"))}}(t,"First parameter");if(Bn(this),"bytes"===i.type){if(void 0!==r.size)throw new RangeError("The strategy for a byte stream cannot have a size function");!function(e,t,n){var r,i,o,a=Object.create(De.prototype);r=void 0!==t.start?function(){return t.start(a)}:function(){},i=void 0!==t.pull?function(){return t.pull(a)}:function(){return y(void 0)},o=void 0!==t.cancel?function(e){return t.cancel(e)}:function(){return y(void 0)};var s=t.autoAllocateChunkSize;if(0===s)throw new TypeError("autoAllocateChunkSize must be greater than 0");at(e,a,r,i,o,n,s)}(this,i,_t(r,0))}else{var a=bt(r);!function(e,t,n,r){var i,o,a,s=Object.create(bn.prototype);i=void 0!==t.start?function(){return t.start(s)}:function(){},o=void 0!==t.pull?function(){return t.pull(s)}:function(){return y(void 0)},a=void 0!==t.cancel?function(e){return t.cancel(e)}:function(){return y(void 0)},kn(e,s,i,o,a,n,r)}(this,i,_t(r,1),a)}}return(0,a.default)(e,[{key:"locked",get:function(){if(!qn(this))throw Yn("locked");return Wn(this)}},{key:"cancel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return qn(this)?Wn(this)?_(new TypeError("Cannot cancel a stream that already has a reader")):Hn(this,e):_(Yn("cancel"))}},{key:"getReader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!qn(this))throw Yn("getReader");return void 0===function(e,t){V(e,t);var n=null==e?void 0:e.mode;return{mode:void 0===n?void 0:ct(n,"".concat(t," has member 'mode' that"))}}(e,"First parameter").mode?ee(this):lt(this)}},{key:"pipeThrough",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!qn(this))throw Yn("pipeThrough");K(e,1,"pipeThrough");var n=function(e,t){V(e,t);var n=null==e?void 0:e.readable;z(n,"readable","ReadableWritablePair"),Z(n,"".concat(t," has member 'readable' that"));var r=null==e?void 0:e.writable;return z(r,"writable","ReadableWritablePair"),Et(r,"".concat(t," has member 'writable' that")),{readable:n,writable:r}}(e,"First parameter"),r=$n(t,"Second parameter");if(Wn(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Rt(n.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return T(_n(this,n.writable,r.preventClose,r.preventAbort,r.preventCancel,r.signal)),n.readable}},{key:"pipeTo",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!qn(this))return _(Yn("pipeTo"));if(void 0===e)return _("Parameter 1 is required in 'pipeTo'.");if(!At(e))return _(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));try{t=$n(n,"Second parameter")}catch(e){return _(e)}return Wn(this)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Rt(e)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):_n(this,e,t.preventClose,t.preventAbort,t.preventCancel,t.signal)}},{key:"tee",value:function(){if(!qn(this))throw Yn("tee");return pe(function(e,t){return Le(e._readableStreamController)?function(e){var t,n,r,i,o,a=ee(e),s=!1,u=!1,c=!1,l=!1,d=!1,f=m((function(e){o=e}));function p(e){I(e._closedPromise,(function(t){return e!==a||(et(r._readableStreamController,t),et(i._readableStreamController,t),l&&d||o(void 0)),null}))}function h(){gt(a)&&($(a),a=ee(e),p(a)),le(a,{_chunkSteps:function(t){O((function(){u=!1,c=!1;var n=t,a=t;if(!l&&!d)try{a=Ee(t)}catch(t){return et(r._readableStreamController,t),et(i._readableStreamController,t),void o(Hn(e,t))}l||Ze(r._readableStreamController,n),d||Ze(i._readableStreamController,a),s=!1,u?v():c&&_()}))},_closeSteps:function(){s=!1,l||Xe(r._readableStreamController),d||Xe(i._readableStreamController),r._readableStreamController._pendingPullIntos.length>0&&it(r._readableStreamController,0),i._readableStreamController._pendingPullIntos.length>0&&it(i._readableStreamController,0),l&&d||o(void 0)},_errorSteps:function(){s=!1}})}function g(t,n){ce(a)&&($(a),a=lt(e),p(a));var f=n?i:r,h=n?r:i;vt(a,t,1,{_chunkSteps:function(t){O((function(){u=!1,c=!1;var r=n?d:l;if(n?l:d)r||ot(f._readableStreamController,t);else{var i;try{i=Ee(t)}catch(t){return et(f._readableStreamController,t),et(h._readableStreamController,t),void o(Hn(e,t))}r||ot(f._readableStreamController,t),Ze(h._readableStreamController,i)}s=!1,u?v():c&&_()}))},_closeSteps:function(e){s=!1;var t=n?d:l,r=n?l:d;t||Xe(f._readableStreamController),r||Xe(h._readableStreamController),void 0!==e&&(t||ot(f._readableStreamController,e),!r&&h._readableStreamController._pendingPullIntos.length>0&&it(h._readableStreamController,0)),t&&r||o(void 0)},_errorSteps:function(){s=!1}})}function v(){if(s)return u=!0,y(void 0);s=!0;var e=nt(r._readableStreamController);return null===e?h():g(e._view,!1),y(void 0)}function _(){if(s)return c=!0,y(void 0);s=!0;var e=nt(i._readableStreamController);return null===e?h():g(e._view,!0),y(void 0)}function b(){}return r=Fn(b,v,(function(r){if(l=!0,t=r,d){var i=pe([t,n]),a=Hn(e,i);o(a)}return f})),i=Fn(b,_,(function(r){if(d=!0,n=r,l){var i=pe([t,n]),a=Hn(e,i);o(a)}return f})),p(a),[r,i]}(e):function(e){var t,n,r,i,o,a=ee(e),s=!1,u=!1,c=!1,l=!1,d=m((function(e){o=e}));function f(){return s?(u=!0,y(void 0)):(s=!0,le(a,{_chunkSteps:function(e){O((function(){u=!1;var t=e,n=e;c||On(r._readableStreamController,t),l||On(i._readableStreamController,n),s=!1,u&&f()}))},_closeSteps:function(){s=!1,c||Tn(r._readableStreamController),l||Tn(i._readableStreamController),c&&l||o(void 0)},_errorSteps:function(){s=!1}}),y(void 0))}function p(){}return r=Un(p,f,(function(r){if(c=!0,t=r,l){var i=pe([t,n]),a=Hn(e,i);o(a)}return d})),i=Un(p,f,(function(r){if(l=!0,n=r,c){var i=pe([t,n]),a=Hn(e,i);o(a)}return d})),I(a._closedPromise,(function(e){return En(r._readableStreamController,e),En(i._readableStreamController,e),c&&l||o(void 0),null})),[r,i]}(e)}(this))}},{key:"values",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!qn(this))throw Yn("values");return function(e,t){var n=ee(e),r=new Se(n,t),i=Object.create(Ie);return i._asyncIteratorImpl=r,i}(this,function(e,t){V(e,"First parameter");var n=null==e?void 0:e.preventCancel;return{preventCancel:Boolean(n)}}(e).preventCancel)}},{key:be,value:function(e){return this.values(e)}}],[{key:"from",value:function(e){return Rn(e)}}]),e}();function Un(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){return 1},o=Object.create(jn.prototype);return Bn(o),kn(o,Object.create(bn.prototype),e,t,n,r,i),o}function Fn(e,t,n){var r=Object.create(jn.prototype);return Bn(r),at(r,Object.create(De.prototype),e,t,n,0,void 0),r}function Bn(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function qn(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")&&e instanceof jn}function Wn(e){return void 0!==e._reader}function Hn(e,t){if(e._disturbed=!0,"closed"===e._state)return y(void 0);if("errored"===e._state)return _(e._storedError);Vn(e);var n=e._reader;if(void 0!==n&&gt(n)){var r=n._readIntoRequests;n._readIntoRequests=new P,r.forEach((function(e){e._closeSteps(void 0)}))}return C(e._readableStreamController[R](t),u)}function Vn(e){e._state="closed";var t=e._reader;if(void 0!==t&&(q(t),ce(t))){var n=t._readRequests;t._readRequests=new P,n.forEach((function(e){e._closeSteps()}))}}function Gn(e,t){e._state="errored",e._storedError=t;var n=e._reader;void 0!==n&&(B(n,t),ce(n)?de(n,t):mt(n,t))}function Yn(e){return new TypeError("ReadableStream.prototype.".concat(e," can only be used on a ReadableStream"))}function Kn(e,t){V(e,t);var n=null==e?void 0:e.highWaterMark;return z(n,"highWaterMark","QueuingStrategyInit"),{highWaterMark:J(n)}}t.ReadableStream=jn,Object.defineProperties(jn,{from:{enumerable:!0}}),Object.defineProperties(jn.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),d(jn.from,"from"),d(jn.prototype.cancel,"cancel"),d(jn.prototype.getReader,"getReader"),d(jn.prototype.pipeThrough,"pipeThrough"),d(jn.prototype.pipeTo,"pipeTo"),d(jn.prototype.tee,"tee"),d(jn.prototype.values,"values"),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(jn.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(jn.prototype,be,{value:jn.prototype.values,writable:!0,configurable:!0});var zn=function(e){return e.byteLength};d(zn,"size");var Jn=function(){function e(t){(0,o.default)(this,e),K(t,1,"ByteLengthQueuingStrategy"),t=Kn(t,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=t.highWaterMark}return(0,a.default)(e,[{key:"highWaterMark",get:function(){if(!Xn(this))throw Qn("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}},{key:"size",get:function(){if(!Xn(this))throw Qn("size");return zn}}]),e}();function Qn(e){return new TypeError("ByteLengthQueuingStrategy.prototype.".concat(e," can only be used on a ByteLengthQueuingStrategy"))}function Xn(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")&&e instanceof Jn}t.ByteLengthQueuingStrategy=Jn,Object.defineProperties(Jn.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(Jn.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});var Zn=function(){return 1};d(Zn,"size");var er=function(){function e(t){(0,o.default)(this,e),K(t,1,"CountQueuingStrategy"),t=Kn(t,"First parameter"),this._countQueuingStrategyHighWaterMark=t.highWaterMark}return(0,a.default)(e,[{key:"highWaterMark",get:function(){if(!nr(this))throw tr("highWaterMark");return this._countQueuingStrategyHighWaterMark}},{key:"size",get:function(){if(!nr(this))throw tr("size");return Zn}}]),e}();function tr(e){return new TypeError("CountQueuingStrategy.prototype.".concat(e," can only be used on a CountQueuingStrategy"))}function nr(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")&&e instanceof er}function rr(e,t,n){return G(e,n),function(n){return x(e,t,[n])}}function ir(e,t,n){return G(e,n),function(n){return E(e,t,[n])}}function or(e,t,n){return G(e,n),function(n,r){return x(e,t,[n,r])}}function ar(e,t,n){return G(e,n),function(n){return x(e,t,[n])}}t.CountQueuingStrategy=er,Object.defineProperties(er.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(er.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});var sr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,o.default)(this,e),void 0===t&&(t=null);var i=wt(n,"Second parameter"),a=wt(r,"Third parameter"),s=function(e,t){V(e,t);var n=null==e?void 0:e.cancel,r=null==e?void 0:e.flush,i=null==e?void 0:e.readableType,o=null==e?void 0:e.start,a=null==e?void 0:e.transform,s=null==e?void 0:e.writableType;return{cancel:void 0===n?void 0:ar(n,e,"".concat(t," has member 'cancel' that")),flush:void 0===r?void 0:rr(r,e,"".concat(t," has member 'flush' that")),readableType:i,start:void 0===o?void 0:ir(o,e,"".concat(t," has member 'start' that")),transform:void 0===a?void 0:or(a,e,"".concat(t," has member 'transform' that")),writableType:s}}(t,"First parameter");if(void 0!==s.readableType)throw new RangeError("Invalid readableType specified");if(void 0!==s.writableType)throw new RangeError("Invalid writableType specified");var u,c=_t(a,0),l=bt(a),d=_t(i,1),f=bt(i);!function(e,t,n,r,i,o){function a(){return t}e._writable=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){return 1},a=Object.create(xt.prototype);return kt(a),Jt(a,Object.create(Kt.prototype),e,t,n,r,i,o),a}(a,(function(t){return function(e,t){var n=e._transformStreamController;return e._backpressure?C(e._backpressureChangePromise,(function(){var r=e._writable;if("erroring"===r._state)throw r._storedError;return mr(n,t)})):mr(n,t)}(e,t)}),(function(){return function(e){var t=e._transformStreamController;if(void 0!==t._finishPromise)return t._finishPromise;var n=e._readable;t._finishPromise=m((function(e,n){t._finishPromise_resolve=e,t._finishPromise_reject=n}));var r=t._flushAlgorithm();return gr(t),w(r,(function(){return"errored"===n._state?br(t,n._storedError):(Tn(n._readableStreamController),_r(t)),null}),(function(e){return En(n._readableStreamController,e),br(t,e),null})),t._finishPromise}(e)}),(function(t){return function(e,t){var n=e._transformStreamController;if(void 0!==n._finishPromise)return n._finishPromise;var r=e._readable;n._finishPromise=m((function(e,t){n._finishPromise_resolve=e,n._finishPromise_reject=t}));var i=n._cancelAlgorithm(t);return gr(n),w(i,(function(){return"errored"===r._state?br(n,r._storedError):(En(r._readableStreamController,t),_r(n)),null}),(function(e){return En(r._readableStreamController,e),br(n,e),null})),n._finishPromise}(e,t)}),n,r),e._readable=Un(a,(function(){return function(e){return fr(e,!1),e._backpressureChangePromise}(e)}),(function(t){return function(e,t){var n=e._transformStreamController;if(void 0!==n._finishPromise)return n._finishPromise;var r=e._writable;n._finishPromise=m((function(e,t){n._finishPromise_resolve=e,n._finishPromise_reject=t}));var i=n._cancelAlgorithm(t);return gr(n),w(i,(function(){return"errored"===r._state?br(n,r._storedError):(en(r._writableStreamController,t),dr(e),_r(n)),null}),(function(t){return en(r._writableStreamController,t),dr(e),br(n,t),null})),n._finishPromise}(e,t)}),i,o),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,fr(e,!0),e._transformStreamController=void 0}(this,m((function(e){u=e})),d,f,c,l),function(e,t){var n,r,i,o=Object.create(pr.prototype);n=void 0!==t.transform?function(e){return t.transform(e,o)}:function(e){try{return vr(o,e),y(void 0)}catch(e){return _(e)}},r=void 0!==t.flush?function(){return t.flush(o)}:function(){return y(void 0)},i=void 0!==t.cancel?function(e){return t.cancel(e)}:function(){return y(void 0)},function(e,t,n,r,i){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=n,t._flushAlgorithm=r,t._cancelAlgorithm=i,t._finishPromise=void 0,t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0}(e,o,n,r,i)}(this,s),void 0!==s.start?u(s.start(this._transformStreamController)):u(void 0)}return(0,a.default)(e,[{key:"readable",get:function(){if(!ur(this))throw wr("readable");return this._readable}},{key:"writable",get:function(){if(!ur(this))throw wr("writable");return this._writable}}]),e}();function ur(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")&&e instanceof sr}function cr(e,t){En(e._readable._readableStreamController,t),lr(e,t)}function lr(e,t){gr(e._transformStreamController),en(e._writable._writableStreamController,t),dr(e)}function dr(e){e._backpressure&&fr(e,!1)}function fr(e,t){void 0!==e._backpressureChangePromise&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=m((function(t){e._backpressureChangePromise_resolve=t})),e._backpressure=t}t.TransformStream=sr,Object.defineProperties(sr.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(sr.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});var pr=function(){function e(){throw(0,o.default)(this,e),new TypeError("Illegal constructor")}return(0,a.default)(e,[{key:"desiredSize",get:function(){if(!hr(this))throw yr("desiredSize");return xn(this._controlledTransformStream._readable._readableStreamController)}},{key:"enqueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!hr(this))throw yr("enqueue");vr(this,e)}},{key:"error",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!hr(this))throw yr("error");e=t,cr(this._controlledTransformStream,e)}},{key:"terminate",value:function(){if(!hr(this))throw yr("terminate");!function(e){var t=e._controlledTransformStream;Tn(t._readable._readableStreamController);var n=new TypeError("TransformStream terminated");lr(t,n)}(this)}}]),e}();function hr(e){return!!c(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")&&e instanceof pr}function gr(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0,e._cancelAlgorithm=void 0}function vr(e,t){var n=e._controlledTransformStream,r=n._readable._readableStreamController;if(!Pn(r))throw new TypeError("Readable side is not in a state that permits enqueue");try{On(r,t)}catch(e){throw lr(n,e),n._readable._storedError}var i=function(e){return!In(e)}(r);i!==n._backpressure&&fr(n,!0)}function mr(e,t){return C(e._transformAlgorithm(t),void 0,(function(t){throw cr(e._controlledTransformStream,t),t}))}function yr(e){return new TypeError("TransformStreamDefaultController.prototype.".concat(e," can only be used on a TransformStreamDefaultController"))}function _r(e){void 0!==e._finishPromise_resolve&&(e._finishPromise_resolve(),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function br(e,t){void 0!==e._finishPromise_reject&&(T(e._finishPromise),e._finishPromise_reject(t),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function wr(e){return new TypeError("TransformStream.prototype.".concat(e," can only be used on a TransformStream"))}t.TransformStreamDefaultController=pr,Object.defineProperties(pr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),d(pr.prototype.enqueue,"enqueue"),d(pr.prototype.error,"error"),d(pr.prototype.terminate,"terminate"),"symbol"==(0,s.default)(Symbol.toStringTag)&&Object.defineProperty(pr.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0})}).call(this,n("0ee4"))},f3ab:function(e,t,n){var r=n("8073"),i=n("5271");e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},f3b9:function(e,t,n){"use strict";function r(e){var t=Object.prototype.toString.call(e);return t.substring(8,t.length-1)}function i(){return"string"===typeof __channelId__&&__channelId__}function o(e,t){switch(r(t)){case"Function":return"function() { [native code] }";default:return t}}function a(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];console[e].apply(console,n)}function s(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t.shift();if(i())return t.push(t.pop().replace("at ","uni-app:///")),console[a].apply(console,t);var s=t.map((function(e){var t=Object.prototype.toString.call(e).toLowerCase();if("[object object]"===t||"[object array]"===t)try{e="---BEGIN:JSON---"+JSON.stringify(e,o)+"---END:JSON---"}catch(i){e=t}else if(null===e)e="---NULL---";else if(void 0===e)e="---UNDEFINED---";else{var n=r(e).toUpperCase();e="NUMBER"===n||"BOOLEAN"===n?"---BEGIN:"+n+"---"+e+"---END:"+n+"---":String(e)}return e})),u="";if(s.length>1){var c=s.pop();u=s.join("---COMMA---"),0===c.indexOf(" at ")?u+=c:u+="---COMMA---"+c}else u=s[0];console[a](u)}n.r(t),n.d(t,"log",(function(){return a})),n.d(t,"default",(function(){return s}))},f442:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OperatorMap=void 0,t.operatorToString=function(e){return a[e]||"$"+e};var r=n("3b92"),i=n("c9ca"),o=n("3325"),a={};for(var s in t.OperatorMap=a,r.QUERY_COMMANDS_LITERAL)a[s]="$"+s;for(var s in i.LOGIC_COMMANDS_LITERAL)a[s]="$"+s;for(var s in o.UPDATE_COMMANDS_LITERAL)a[s]="$"+s;a[r.QUERY_COMMANDS_LITERAL.NEQ]="$ne",a[o.UPDATE_COMMANDS_LITERAL.REMOVE]="$unset",a[o.UPDATE_COMMANDS_LITERAL.SHIFT]="$pop",a[o.UPDATE_COMMANDS_LITERAL.UNSHIFT]="$push"},f78b:function(e,t,n){var r=n("7426");e.exports=function(){this.__data__=r?r(null):{},this.size=0}},f7a1:function(e,t,n){"use strict";n.r(t);var r=n("0101"),i=n("3ccb");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n("828b"),s=Object(a["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},f7d7:function(e,t,n){"use strict";(function(e,r){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.LoginState=t.Auth=void 0,t.generateAuthInstance=w,t.registerAuth=function(e){try{e.registerComponent(S)}catch(t){r("warn",t," at node_modules/@cloudbase/auth/dist/esm/index.js:1792")}};var o=i(n("3b2d")),a=n("9c82"),s=n("631c"),u=n("264a"),c=function(){return c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},c.apply(this,arguments)},l=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":(0,o.default)(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},d=function(e,t){if("object"===("undefined"===typeof Reflect?"undefined":(0,o.default)(Reflect))&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},p=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},h={SIGN_OUT:"sign_out",SIGN_IN:"sign_in",CREDENTIALS_ERROR:"credentials_error"},g={LOGIN_STATE_CHANGED:"loginStateChanged"},v=new u.CloudbaseEventEmitter,m=function(e){v.fire(g.LOGIN_STATE_CHANGED,c(c({},e),{eventType:h.CREDENTIALS_ERROR}))},y=function(){function e(e){var t=e.cache,n=e.oauthInstance;this.cache=t,this.oauthInstance=n,this.setUserInfo()}return e.prototype.checkLocalInfo=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){return this.uid=this.getLocalUserInfo("uid"),this.gender=this.getLocalUserInfo("gender"),this.picture=this.getLocalUserInfo("picture"),this.email=this.getLocalUserInfo("email"),this.emailVerified=this.getLocalUserInfo("email_verified"),this.phoneNumber=this.getLocalUserInfo("phone_number"),this.username=this.getLocalUserInfo("username"),this.name=this.getLocalUserInfo("name"),this.birthdate=this.getLocalUserInfo("birthdate"),this.zoneinfo=this.getLocalUserInfo("zoneinfo"),this.locale=this.getLocalUserInfo("locale"),this.sub=this.getLocalUserInfo("sub"),this.createdFrom=this.getLocalUserInfo("created_from"),this.providers=this.getLocalUserInfo("providers"),[2]}))}))},e.prototype.checkLocalInfoAsync=function(){return f(this,void 0,void 0,(function(){var e,t,n,r;return p(this,(function(i){switch(i.label){case 0:return e=this,[4,this.getLocalUserInfoAsync("uid")];case 1:return e.uid=i.sent(),t=this,[4,this.getLocalUserInfoAsync("gender")];case 2:return t.gender=i.sent(),this.picture=this.getLocalUserInfo("picture"),n=this,[4,this.getLocalUserInfoAsync("email")];case 3:return n.email=i.sent(),this.emailVerified=this.getLocalUserInfo("email_verified"),this.phoneNumber=this.getLocalUserInfo("phone_number"),r=this,[4,this.getLocalUserInfoAsync("username")];case 4:return r.username=i.sent(),this.name=this.getLocalUserInfo("name"),this.birthdate=this.getLocalUserInfo("birthdate"),this.zoneinfo=this.getLocalUserInfo("zoneinfo"),this.locale=this.getLocalUserInfo("locale"),this.sub=this.getLocalUserInfo("sub"),this.createdFrom=this.getLocalUserInfo("created_from"),this.providers=this.getLocalUserInfo("providers"),[2]}}))}))},e.prototype.update=function(e){return f(this,void 0,void 0,(function(){var t;return p(this,(function(n){switch(n.label){case 0:return[4,this.oauthInstance.authApi.setUserProfile(c({},e))];case 1:return t=n.sent(),this.setLocalUserInfo(t),[2]}}))}))},e.prototype.updateUserBasicInfo=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.oauthInstance.authApi.updateUserBasicInfo(c({},e))];case 1:return t.sent(),this.setLocalUserInfo({username:e.username}),[2]}}))}))},e.prototype.updatePassword=function(e,t){return this.oauthInstance.authApi.updatePasswordByOld({old_password:t,new_password:e})},e.prototype.updateUsername=function(e){return"string"!==typeof e&&(0,u.throwError)(u.ERRORS.INVALID_PARAMS,"username must be a string"),this.update({username:e})},e.prototype.refresh=function(e){return f(this,void 0,void 0,(function(){var t;return p(this,(function(n){switch(n.label){case 0:return[4,this.oauthInstance.authApi.getUserInfo(e)];case 1:if(t=n.sent(),"INVALID_ACCESS_TOKEN"===t.code)throw this.setLocalUserInfo({}),t;return this.setLocalUserInfo(t),[2,t]}}))}))},e.prototype.getLocalUserInfo=function(e){var t=this.cache.keys.userInfoKey,n=this.cache.getStore(t);return n[e]},e.prototype.getLocalUserInfoAsync=function(e){return f(this,void 0,void 0,(function(){var t,n;return p(this,(function(r){switch(r.label){case 0:return t=this.cache.keys.userInfoKey,[4,this.cache.getStoreAsync(t)];case 1:return n=r.sent(),[2,n[e]]}}))}))},e.prototype.setUserInfo=function(){var e=this,t=this.cache.keys.userInfoKey,n=this.cache.getStore(t);["uid","email","name","gender","picture","email_verified","phone_number","birthdate","zoneinfo","locale","sub","created_from","providers","username"].forEach((function(t){e[t]=n[t]}))},e.prototype.setLocalUserInfo=function(e){var t=this.cache.keys.userInfoKey;this.cache.setStore(t,e),this.setUserInfo()},l([(0,u.catchErrorsDecorator)({title:"\u66f4\u65b0\u7528\u6237\u4fe1\u606f\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 User.update() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u7528\u6237\u4fe1\u606f\u4e2d\u662f\u5426\u5305\u542b\u975e\u6cd5\u503c","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],e.prototype,"update",null),l([(0,u.catchErrorsDecorator)({title:"\u66f4\u65b0\u5bc6\u7801\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 User.updatePassword() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  3 - \u65b0\u5bc6\u7801\u4e2d\u662f\u5426\u5305\u542b\u975e\u6cd5\u5b57\u7b26","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[String,String]),d("design:returntype",void 0)],e.prototype,"updatePassword",null),l([(0,u.catchErrorsDecorator)({title:"\u66f4\u65b0\u7528\u6237\u540d\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 User.updateUsername() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u901a\u4e86\u7528\u6237\u540d\u5bc6\u7801\u767b\u5f55","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[String]),d("design:returntype",void 0)],e.prototype,"updateUsername",null),l([(0,u.catchErrorsDecorator)({title:"\u5237\u65b0\u672c\u5730\u7528\u6237\u4fe1\u606f\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 User.refresh() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],e.prototype,"refresh",null),e}(),_=function(){function e(e){var t=e.envId,n=e.cache,r=e.oauthInstance;t||(0,u.throwError)(u.ERRORS.INVALID_PARAMS,"envId is not defined"),this.cache=n,this.oauthInstance=r,this.user=new y({cache:this.cache,oauthInstance:r})}return e.prototype.checkLocalState=function(){var e;this.oauthLoginState=null===(e=this.oauthInstance)||void 0===e?void 0:e.authApi.hasLoginStateSync(),this.user.checkLocalInfo()},e.prototype.checkLocalStateAsync=function(){var e;return f(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,null===(e=this.oauthInstance)||void 0===e?void 0:e.authApi.getLoginState()];case 1:return t.sent(),[4,this.user.checkLocalInfoAsync()];case 2:return t.sent(),[2]}}))}))},e}();t.LoginState=_;var b=function(){function t(e){this.config=e,this.cache=e.cache,this.oauthInstance=e.oauthInstance,this.setAccessKey()}return t.prototype.bindPhoneNumber=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.editContact(e)]}))}))},t.prototype.unbindProvider=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.unbindProvider(e)]}))}))},t.prototype.bindEmail=function(e){return this.oauthInstance.authApi.editContact(e)},t.prototype.verify=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.verify(e)]}))}))},t.prototype.getVerification=function(e,t){return f(this,void 0,void 0,(function(){return p(this,(function(n){return[2,this.oauthInstance.authApi.getVerification(e,t)]}))}))},Object.defineProperty(t.prototype,"currentUser",{get:function(){if("async"!==this.cache.mode){var e=this.hasLoginState();return e&&e.user||null}(0,u.printWarn)(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getCurrentUser instead")},enumerable:!1,configurable:!0}),t.prototype.getCurrentUser=function(){return f(this,void 0,void 0,(function(){var e;return p(this,(function(t){switch(t.label){case 0:return[4,this.getLoginState()];case 1:return e=t.sent(),e?[4,e.user.checkLocalInfoAsync()]:[3,3];case 2:return t.sent(),[2,e.user||null];case 3:return[2,null]}}))}))},t.prototype.signInAnonymously=function(e){return void 0===e&&(e={}),f(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.oauthInstance.authApi.signInAnonymously(e)];case 1:return t.sent(),[2,this.createLoginState()]}}))}))},t.prototype.signInAnonymouslyInWx=function(t){var n=void 0===t?{}:t,r=n.useWxCloud;return f(this,void 0,void 0,(function(){var t,n,i=this;return p(this,(function(o){switch(o.label){case 0:if(!u.adapterForWxMp.isMatch())throw Error("wx api undefined");return t=e.getAccountInfoSync().miniProgram,n=function(e){return f(i,void 0,void 0,(function(){var n,i,o;return p(this,(function(a){switch(a.label){case 0:n=void 0,i=void 0,a.label=1;case 1:return a.trys.push([1,4,,5]),[4,this.oauthInstance.authApi.grantProviderToken({provider_id:null===t||void 0===t?void 0:t.appId,provider_code:e,provider_params:{provider_code_type:"open_id",appid:null===t||void 0===t?void 0:t.appId}},r)];case 2:if(n=a.sent(),(null===n||void 0===n?void 0:n.error_code)||!n.provider_token)throw n;return[4,this.oauthInstance.authApi.signInAnonymously({provider_token:n.provider_token},r)];case 3:if(i=a.sent(),null===i||void 0===i?void 0:i.error_code)throw i;return[3,5];case 4:throw o=a.sent(),o;case 5:return[2]}}))}))},[4,new Promise((function(t,r){e.login({success:function(e){return f(i,void 0,void 0,(function(){var i;return p(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,n(e.code)];case 1:return o.sent(),t(!0),[3,3];case 2:return i=o.sent(),r(i),[3,3];case 3:return[2]}}))}))},fail:function(e){var t=new Error(null===e||void 0===e?void 0:e.errMsg);t.code=null===e||void 0===e?void 0:e.errno,r(t)}})}))];case 1:return o.sent(),[2,this.createLoginState(void 0,{asyncRefreshUser:!0})]}}))}))},t.prototype.bindOpenId=function(){return f(this,void 0,void 0,(function(){var t,n,r=this;return p(this,(function(i){switch(i.label){case 0:if(!u.adapterForWxMp.isMatch())throw Error("wx api undefined");return t=e.getAccountInfoSync().miniProgram,n=function(e){return f(r,void 0,void 0,(function(){var n,r;return p(this,(function(i){switch(i.label){case 0:n=void 0,i.label=1;case 1:return i.trys.push([1,4,,5]),[4,this.oauthInstance.authApi.grantProviderToken({provider_id:null===t||void 0===t?void 0:t.appId,provider_code:e,provider_params:{provider_code_type:"open_id",appid:null===t||void 0===t?void 0:t.appId}})];case 2:if(n=i.sent(),(null===n||void 0===n?void 0:n.error_code)||!n.provider_token)throw n;return[4,this.oauthInstance.authApi.bindWithProvider({provider_token:n.provider_token})];case 3:return i.sent(),[3,5];case 4:throw r=i.sent(),r;case 5:return[2]}}))}))},[4,new Promise((function(t,i){e.login({success:function(e){return f(r,void 0,void 0,(function(){var r;return p(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,n(e.code)];case 1:return o.sent(),t(!0),[3,3];case 2:return r=o.sent(),i(r),[3,3];case 3:return[2]}}))}))},fail:function(e){var t=new Error(null===e||void 0===e?void 0:e.errMsg);t.code=null===e||void 0===e?void 0:e.errno,i(t)}})}))];case 1:return i.sent(),[2]}}))}))},t.prototype.signInWithOpenId=function(t){var n=void 0===t?{}:t,r=n.useWxCloud,i=void 0===r||r;return f(this,void 0,void 0,(function(){var t,n,r=this;return p(this,(function(o){switch(o.label){case 0:if(!u.adapterForWxMp.isMatch())throw Error("wx api undefined");return t=e.getAccountInfoSync().miniProgram,n=function(e){return f(r,void 0,void 0,(function(){var n,r,o;return p(this,(function(a){switch(a.label){case 0:n=void 0,r=void 0,a.label=1;case 1:return a.trys.push([1,4,,5]),[4,this.oauthInstance.authApi.grantProviderToken({provider_id:null===t||void 0===t?void 0:t.appId,provider_code:e,provider_params:{provider_code_type:"open_id",appid:null===t||void 0===t?void 0:t.appId}},i)];case 2:if(n=a.sent(),(null===n||void 0===n?void 0:n.error_code)||!n.provider_token)throw n;return[4,this.oauthInstance.authApi.signInWithProvider({provider_token:n.provider_token},i)];case 3:if(r=a.sent(),null===r||void 0===r?void 0:r.error_code)throw r;return[3,5];case 4:throw o=a.sent(),o;case 5:return[4,this.oauthInstance.oauth2client.setCredentials(r)];case 6:return a.sent(),[2]}}))}))},[4,new Promise((function(t,i){e.login({success:function(e){return f(r,void 0,void 0,(function(){var r;return p(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,n(e.code)];case 1:return o.sent(),t(!0),[3,3];case 2:return r=o.sent(),i(r),[3,3];case 3:return[2]}}))}))},fail:function(e){var t=new Error(null===e||void 0===e?void 0:e.errMsg);t.code=null===e||void 0===e?void 0:e.errno,i(t)}})}))];case 1:return o.sent(),[2,this.createLoginState()]}}))}))},t.prototype.signInWithUnionId=function(){return f(this,void 0,void 0,(function(){var t,n=this;return p(this,(function(r){switch(r.label){case 0:if(!u.adapterForWxMp.isMatch())throw Error("wx api undefined");r.label=1;case 1:return r.trys.push([1,3,,4]),[4,new Promise((function(t,r){var i=e.getAccountInfoSync().miniProgram;e.login({success:function(e){return f(n,void 0,void 0,(function(){var n,o,a,s,u;return p(this,(function(c){switch(c.label){case 0:n=null===i||void 0===i?void 0:i.appId,c.label=1;case 1:return c.trys.push([1,4,,5]),[4,this.oauthInstance.authApi.grantProviderToken({provider_code:e.code,provider_id:n,provider_params:{provider_code_type:"union_id",appid:null===i||void 0===i?void 0:i.appId}})];case 2:return o=c.sent(),a=o.provider_token,a?[4,this.oauthInstance.authApi.signInWithProvider({provider_id:n,provider_token:a})]:(r(o),[2]);case 3:return s=c.sent(),(null===s||void 0===s?void 0:s.error_code)?(r(s),[2]):(t(!0),[3,5]);case 4:return u=c.sent(),r(u),[3,5];case 5:return[2]}}))}))},fail:function(e){var t=new Error(null===e||void 0===e?void 0:e.errMsg);t.code=null===e||void 0===e?void 0:e.errno,r(t)}})}))];case 2:return r.sent(),[3,4];case 3:throw t=r.sent(),t;case 4:return[2,this.createLoginState()]}}))}))},t.prototype.signInWithPhoneAuth=function(t){var n=t.phoneCode,r=void 0===n?"":n;return f(this,void 0,void 0,(function(){var t,n,i,o,a,s;return p(this,(function(c){switch(c.label){case 0:if(!u.adapterForWxMp.isMatch())throw Error("wx api undefined");return t=e.getAccountInfoSync().miniProgram,n={provider_params:{provider_code_type:"phone"},provider_id:t.appId},[4,e.login()];case 1:i=c.sent().code,n.provider_code=i,c.label=2;case 2:return c.trys.push([2,6,,7]),[4,this.oauthInstance.authApi.grantProviderToken(n)];case 3:if(o=c.sent(),o.error_code)throw o;return[4,this.oauthInstance.authApi.patchProviderToken({provider_token:o.provider_token,provider_id:t.appId,provider_params:{code:r,provider_code_type:"phone"}})];case 4:if(o=c.sent(),o.error_code)throw o;return[4,this.oauthInstance.authApi.signInWithProvider({provider_token:o.provider_token})];case 5:if(a=c.sent(),null===a||void 0===a?void 0:a.error_code)throw a;return[3,7];case 6:throw s=c.sent(),s;case 7:return[2,this.createLoginState()]}}))}))},t.prototype.signInWithSms=function(e){var t=e.verificationInfo,n=void 0===t?{verification_id:"",is_user:!1}:t,r=e.verificationCode,i=void 0===r?"":r,o=e.phoneNum,a=void 0===o?"":o,s=e.bindInfo,u=void 0===s?void 0:s;return f(this,void 0,void 0,(function(){return p(this,(function(e){try{return[2,this.signInWithUsername({verificationInfo:n,verificationCode:i,bindInfo:u,username:a,loginType:"sms"})]}catch(t){throw t}return[2]}))}))},t.prototype.signInWithEmail=function(e){var t=e.verificationInfo,n=void 0===t?{verification_id:"",is_user:!1}:t,r=e.verificationCode,i=void 0===r?"":r,o=e.bindInfo,a=void 0===o?void 0:o,s=e.email,u=void 0===s?"":s;return f(this,void 0,void 0,(function(){return p(this,(function(e){try{return[2,this.signInWithUsername({verificationInfo:n,verificationCode:i,bindInfo:a,username:u,loginType:"email"})]}catch(t){throw t}return[2]}))}))},t.prototype.setCustomSignFunc=function(e){this.oauthInstance.authApi.setCustomSignFunc(e)},t.prototype.signInWithCustomTicket=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){switch(e.label){case 0:return[4,this.oauthInstance.authApi.signInWithCustomTicket()];case 1:return e.sent(),[2,this.createLoginState()]}}))}))},t.prototype.signIn=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.oauthInstance.authApi.signIn(e)];case 1:return t.sent(),[2,this.createLoginState(e)]}}))}))},t.prototype.signUp=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.oauthInstance.authApi.signUp(e)];case 1:return t.sent(),[2,this.createLoginState()]}}))}))},t.prototype.setPassword=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.setPassword(e)]}))}))},t.prototype.isUsernameRegistered=function(e){return f(this,void 0,void 0,(function(){var t;return p(this,(function(n){switch(n.label){case 0:return"string"!==typeof e&&(0,u.throwError)(u.ERRORS.INVALID_PARAMS,"username must be a string"),[4,this.oauthInstance.authApi.checkIfUserExist({username:e})];case 1:return t=n.sent().exist,[2,t]}}))}))},t.prototype.signOut=function(e){return f(this,void 0,void 0,(function(){var t,n;return p(this,(function(r){switch(r.label){case 0:return t=this.cache.keys.userInfoKey,[4,this.oauthInstance.authApi.signOut(e)];case 1:return n=r.sent(),[4,this.cache.removeStoreAsync(t)];case 2:return r.sent(),v.fire(g.LOGIN_STATE_CHANGED,{eventType:h.SIGN_OUT}),[2,n]}}))}))},t.prototype.hasLoginState=function(){var e;if("async"!==this.cache.mode){var t=null===(e=this.oauthInstance)||void 0===e?void 0:e.authApi.hasLoginStateSync();if(t){var n=new _({envId:this.config.env,cache:this.cache,oauthInstance:this.oauthInstance});return n}return null}(0,u.printWarn)(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getLoginState insteed")},t.prototype.getLoginState=function(){return f(this,void 0,void 0,(function(){var e,t;return p(this,(function(n){switch(n.label){case 0:e=null,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.oauthInstance.authApi.getLoginState()];case 2:return e=n.sent(),[3,4];case 3:return n.sent(),[2,null];case 4:return e?(t=new _({envId:this.config.env,cache:this.cache,oauthInstance:this.oauthInstance}),[2,t]):[2,null]}}))}))},t.prototype.getUserInfo=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.getUserInfo(e)]}))}))},t.prototype.getWedaUserInfo=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this.oauthInstance.authApi.getWedaUserInfo()]}))}))},t.prototype.updateUserBasicInfo=function(e){return f(this,void 0,void 0,(function(){var t;return p(this,(function(n){switch(n.label){case 0:return[4,this.getLoginState()];case 1:return t=n.sent(),t?[4,t.user.updateUserBasicInfo(e)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.getAuthHeader=function(){return r("error","Auth.getAuthHeader API \u5df2\u5e9f\u5f03"," at node_modules/@cloudbase/auth/dist/esm/index.js:1012"),{}},t.prototype.bindWithProvider=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.bindWithProvider(e)]}))}))},t.prototype.queryUser=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.queryUserProfile(e)]}))}))},t.prototype.getAccessToken=function(){return f(this,void 0,void 0,(function(){var e;return p(this,(function(t){switch(t.label){case 0:return[4,this.oauthInstance.oauth2client.getAccessToken()];case 1:return e=t.sent(),[2,{accessToken:e,env:this.config.env}]}}))}))},t.prototype.grantProviderToken=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.grantProviderToken(e)]}))}))},t.prototype.patchProviderToken=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.patchProviderToken(e)]}))}))},t.prototype.signInWithProvider=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.oauthInstance.authApi.signInWithProvider(e)];case 1:return t.sent(),[2,this.createLoginState(e)]}}))}))},t.prototype.signInWithWechat=function(e){return void 0===e&&(e={}),f(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.oauthInstance.authApi.signInWithWechat(e)];case 1:return t.sent(),[2,this.createLoginState(e)]}}))}))},t.prototype.grantToken=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.oauthInstance.authApi.grantToken(e)];case 1:return t.sent(),[2,this.createLoginState()]}}))}))},t.prototype.genProviderRedirectUri=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.genProviderRedirectUri(e)]}))}))},t.prototype.resetPassword=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.resetPassword(e)]}))}))},t.prototype.deviceAuthorize=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.deviceAuthorize(e)]}))}))},t.prototype.sudo=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.sudo(e)]}))}))},t.prototype.deleteMe=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.deleteMe(e)]}))}))},t.prototype.getProviders=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this.oauthInstance.authApi.getProviders()]}))}))},t.prototype.loginScope=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this.oauthInstance.authApi.loginScope()]}))}))},t.prototype.loginGroups=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this.oauthInstance.authApi.loginGroups()]}))}))},t.prototype.onLoginStateChanged=function(e){return f(this,void 0,void 0,(function(){var t,n=this;return p(this,(function(r){switch(r.label){case 0:return v.on(g.LOGIN_STATE_CHANGED,(function(t){return f(n,void 0,void 0,(function(){var n,r,i;return p(this,(function(o){switch(o.label){case 0:return(null===(i=null===t||void 0===t?void 0:t.data)||void 0===i?void 0:i.eventType)===h.CREDENTIALS_ERROR?[3,2]:[4,this.getLoginState()];case 1:return r=o.sent(),[3,3];case 2:r={},o.label=3;case 3:return n=r,e.call(this,c(c({},t),n)),[2]}}))}))})),[4,this.getLoginState()];case 1:return t=r.sent(),e.call(this,t),[2]}}))}))},t.prototype.refreshTokenForce=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.refreshTokenForce(e)]}))}))},t.prototype.getCredentials=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this.oauthInstance.authApi.getCredentials()]}))}))},t.prototype.setCredentials=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.oauthInstance.oauth2client.setCredentials(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.getProviderSubType=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this.oauthInstance.authApi.getProviderSubType()]}))}))},t.prototype.createCaptchaData=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.createCaptchaData(e)]}))}))},t.prototype.verifyCaptchaData=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.verifyCaptchaData(e)]}))}))},t.prototype.getMiniProgramQrCode=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.getMiniProgramCode(e)]}))}))},t.prototype.getMiniProgramQrCodeStatus=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.getMiniProgramQrCodeStatus(e)]}))}))},t.prototype.modifyPassword=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.modifyPassword(e)]}))}))},t.prototype.modifyPasswordWithoutLogin=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.modifyPasswordWithoutLogin(e)]}))}))},t.prototype.getUserBehaviorLog=function(e){return f(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.oauthInstance.authApi.getUserBehaviorLog(e)]}))}))},t.prototype.toDefaultLoginPage=function(t){return void 0===t&&(t={}),f(this,void 0,void 0,(function(){var n,r,i,o,a;return p(this,(function(s){return n=t.config_version||"env",r=Object.keys(t.query||{}).map((function(e){return"".concat(e,"=").concat(t.query[e])})).join("&"),u.adapterForWxMp.isMatch()?e.navigateTo({url:"/packages/$wd_system/pages/login/index".concat(r?"?".concat(r):"")}):(i=t.redirect_uri||window.location.href,o=new URL(i),a="".concat(o.origin,"/__auth/?app_id=").concat(t.app_id||"","&env_id=").concat(this.config.env,"&client_id=").concat(this.config.clientId||this.config.env,"&config_version=").concat(n,"&redirect_uri=").concat(encodeURIComponent(i)).concat(r?"&".concat(r):""),window.location.href=a),[2]}))}))},t.prototype.createLoginState=function(e,t){return f(this,void 0,void 0,(function(){var n;return p(this,(function(r){switch(r.label){case 0:return n=new _({envId:this.config.env,cache:this.cache,oauthInstance:this.oauthInstance}),[4,n.checkLocalStateAsync()];case 1:return r.sent(),(null===t||void 0===t?void 0:t.asyncRefreshUser)?(n.user.refresh(e),[3,4]):[3,2];case 2:return[4,n.user.refresh(e)];case 3:r.sent(),r.label=4;case 4:return v.fire(g.LOGIN_STATE_CHANGED,{eventType:h.SIGN_IN}),[2,n]}}))}))},t.prototype.signInWithUsername=function(e){var t=e.verificationInfo,n=void 0===t?{verification_id:"",is_user:!1}:t,r=e.verificationCode,i=void 0===r?"":r,o=e.username,a=void 0===o?"":o,s=e.bindInfo,u=void 0===s?void 0:s,l=e.loginType,d=void 0===l?"":l;return f(this,void 0,void 0,(function(){var e,t,r,o,s,l,f,h;return p(this,(function(p){switch(p.label){case 0:return p.trys.push([0,8,,9]),[4,this.oauthInstance.authApi.verify({verification_id:n.verification_id,verification_code:i})];case 1:if(e=p.sent(),null===e||void 0===e?void 0:e.error_code)throw e;return t=e.verification_token,r="+86 ".concat(a),o={phone_number:r},"email"===d&&(r=a,o={email:r}),n.is_user?[4,this.oauthInstance.authApi.signIn({username:r,verification_token:t})]:[3,5];case 2:if(s=p.sent(),null===s||void 0===s?void 0:s.error_code)throw s;return u?[4,this.oauthInstance.authApi.bindWithProvider({provider_token:null===u||void 0===u?void 0:u.providerToken})]:[3,4];case 3:if(l=p.sent(),null===l||void 0===l?void 0:l.error_code)throw l;p.label=4;case 4:return[3,7];case 5:return[4,this.oauthInstance.authApi.signUp(c(c({},o),{verification_token:t,provider_token:null===u||void 0===u?void 0:u.providerId}))];case 6:if(f=p.sent(),null===f||void 0===f?void 0:f.error_code)throw f;p.label=7;case 7:return[2,this.createLoginState()];case 8:throw h=p.sent(),h;case 9:return[2]}}))}))},t.prototype.setAccessKey=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){if(this.config.accessKey)try{this.oauthInstance.oauth2client.setAccessKeyCredentials({access_token:this.config.accessKey,token_type:"Bearer",scope:"accessKey",expires_at:new Date(+new Date+ +new Date),expires_in:+new Date+ +new Date})}catch(t){r("warn","accessKey error: ",t," at node_modules/@cloudbase/auth/dist/esm/index.js:1396")}return[2]}))}))},l([(0,u.catchErrorsDecorator)({title:"\u7ed1\u5b9a\u624b\u673a\u53f7\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().bindPhoneNumber() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u901a\u4e86\u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u5f55","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"bindPhoneNumber",null),l([(0,u.catchErrorsDecorator)({title:"\u89e3\u9664\u4e09\u65b9\u7ed1\u5b9a\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().unbindProvider() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u8d26\u6237\u662f\u5426\u5df2\u7ecf\u4e0e\u6b64\u767b\u5f55\u65b9\u5f0f\u89e3\u7ed1","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"unbindProvider",null),l([(0,u.catchErrorsDecorator)({title:"\u7ed1\u5b9a\u90ae\u7bb1\u5730\u5740\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().bindEmail() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u901a\u4e86\u90ae\u7bb1\u5bc6\u7801\u767b\u5f55","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",void 0)],t.prototype,"bindEmail",null),l([(0,u.catchErrorsDecorator)({title:"\u9a8c\u8bc1\u7801\u9a8c\u8bc1\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().verify() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u901a\u4e86\u624b\u673a\u9a8c\u8bc1\u7801/\u90ae\u7bb1\u767b\u5f55","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"verify",null),l([(0,u.catchErrorsDecorator)({title:"\u83b7\u53d6\u9a8c\u8bc1\u7801\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().getVerification() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u901a\u4e86\u624b\u673a\u9a8c\u8bc1\u7801/\u90ae\u7bb1\u767b\u5f55","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object,Object]),d("design:returntype",Promise)],t.prototype,"getVerification",null),l([(0,u.catchErrorsDecorator)({title:"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().getCurrentUser() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[]),d("design:returntype",Promise)],t.prototype,"getCurrentUser",null),l([(0,u.catchErrorsDecorator)({title:"\u533f\u540d\u767b\u5f55\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u533f\u540d\u767b\u5f55","  2 - \u8c03\u7528 auth().signInAnonymously() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"signInAnonymously",null),l([(0,u.catchErrorsDecorator)({title:"\u5c0f\u7a0b\u5e8f\u533f\u540d\u767b\u5f55\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u533f\u540d\u767b\u5f55","  2 - \u8c03\u7528 auth().signInAnonymouslyInWx() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"signInAnonymouslyInWx",null),l([(0,u.catchErrorsDecorator)({title:"\u5c0f\u7a0b\u5e8f\u7ed1\u5b9aOpenID\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u5c0f\u7a0b\u5e8fopenId\u9759\u9ed8\u767b\u5f55","  2 - \u8c03\u7528 auth().bindOpenId() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[]),d("design:returntype",Promise)],t.prototype,"bindOpenId",null),l([(0,u.catchErrorsDecorator)({title:"\u5c0f\u7a0b\u5e8fopenId\u9759\u9ed8\u767b\u5f55\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u5c0f\u7a0b\u5e8fopenId\u9759\u9ed8\u767b\u5f55","  2 - \u8c03\u7528 auth().signInWithOpenId() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"signInWithOpenId",null),l([(0,u.catchErrorsDecorator)({title:"\u5c0f\u7a0b\u5e8funionId\u9759\u9ed8\u767b\u5f55\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u5c0f\u7a0b\u5e8funionId\u9759\u9ed8\u767b\u5f55","  2 - \u8c03\u7528 auth().signInWithUnionId() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[]),d("design:returntype",Promise)],t.prototype,"signInWithUnionId",null),l([(0,u.catchErrorsDecorator)({title:"\u5c0f\u7a0b\u5e8f\u624b\u673a\u53f7\u6388\u6743\u767b\u5f55\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u5c0f\u7a0b\u5e8f\u624b\u673a\u53f7\u6388\u6743\u767b\u5f55","  2 - \u8c03\u7528 auth().signInWithPhoneAuth() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"signInWithPhoneAuth",null),l([(0,u.catchErrorsDecorator)({title:"\u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u9646",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u5c0f\u7a0b\u5e8f\u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u9646","  2 - \u8c03\u7528 auth().signInWithSms() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"signInWithSms",null),l([(0,u.catchErrorsDecorator)({title:"\u90ae\u7bb1\u9a8c\u8bc1\u7801\u767b\u9646",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u90ae\u7bb1\u767b\u9646","  2 - \u8c03\u7528 auth().signInWithEmail() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"signInWithEmail",null),l([(0,u.catchErrorsDecorator)({title:"\u81ea\u5b9a\u4e49\u767b\u5f55\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u81ea\u5b9a\u4e49\u767b\u5f55","  2 - \u8c03\u7528 auth().signInWithCustomTicket() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  3 - ticket \u662f\u5426\u5f52\u5c5e\u4e8e\u5f53\u524d\u73af\u5883","  4 - \u521b\u5efa ticket \u7684\u81ea\u5b9a\u4e49\u767b\u5f55\u79c1\u94a5\u662f\u5426\u8fc7\u671f","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[]),d("design:returntype",Promise)],t.prototype,"signInWithCustomTicket",null),l([(0,u.catchErrorsDecorator)({title:"\u6ce8\u518c\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u5f53\u524d\u73af\u5883\u662f\u5426\u5f00\u542f\u4e86\u6307\u5b9a\u767b\u5f55\u65b9\u5f0f","  2 - \u8c03\u7528 auth().signUp() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"signUp",null),l([(0,u.catchErrorsDecorator)({title:"\u83b7\u53d6\u7528\u6237\u662f\u5426\u88ab\u5360\u7528\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().isUsernameRegistered() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[String]),d("design:returntype",Promise)],t.prototype,"isUsernameRegistered",null),l([(0,u.catchErrorsDecorator)({title:"\u7528\u6237\u767b\u51fa\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().signOut() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u5f53\u524d\u7528\u6237\u662f\u5426\u4e3a\u533f\u540d\u767b\u5f55\uff08\u533f\u540d\u767b\u5f55\u4e0d\u652f\u6301signOut\uff09","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"signOut",null),l([(0,u.catchErrorsDecorator)({title:"\u83b7\u53d6\u672c\u5730\u767b\u5f55\u6001\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().getLoginState() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[]),d("design:returntype",Promise)],t.prototype,"getLoginState",null),l([(0,u.catchErrorsDecorator)({title:"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u662f\u5426\u5df2\u767b\u5f55","  2 - \u8c03\u7528 auth().getUserInfo() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"getUserInfo",null),l([(0,u.catchErrorsDecorator)({title:"\u83b7\u53d6\u5fae\u642d\u63d2\u4ef6\u7528\u6237\u4fe1\u606f\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u662f\u5426\u5df2\u767b\u5f55","  2 - \u8c03\u7528 auth().getWedaUserInfo() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[]),d("design:returntype",Promise)],t.prototype,"getWedaUserInfo",null),l([(0,u.catchErrorsDecorator)({title:"\u7ed1\u5b9a\u7b2c\u4e09\u65b9\u767b\u5f55\u65b9\u5f0f\u5931\u8d25",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().bindWithProvider() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","  2 - \u6b64\u8d26\u6237\u662f\u5426\u5df2\u7ecf\u7ed1\u5b9a\u6b64\u7b2c\u4e09\u65b9","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"bindWithProvider",null),l([(0,u.catchErrorsDecorator)({title:"\u83b7\u53d6\u8eab\u4efd\u6e90\u7c7b\u578b",messages:["\u8bf7\u786e\u8ba4\u4ee5\u4e0b\u5404\u9879\uff1a","  1 - \u8c03\u7528 auth().getProviderSubType() \u7684\u8bed\u6cd5\u6216\u53c2\u6570\u662f\u5426\u6b63\u786e","\u5982\u679c\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u5efa\u8bae\u5230\u5b98\u65b9\u95ee\u7b54\u793e\u533a\u63d0\u95ee\u6216\u5bfb\u627e\u5e2e\u52a9\uff1a".concat(u.COMMUNITY_SITE_URL)]}),d("design:type",Function),d("design:paramtypes",[]),d("design:returntype",Promise)],t.prototype,"getProviderSubType",null),t}();function w(e,t){var n=e.region,r=void 0===n?"ap-shanghai":n,i=e.i18n,o=e.accessKey,l=e.useWxCloud,d=(null===t||void 0===t?void 0:t.platform)||(0,u.useDefaultAdapter)(),f=d.runtime,p=d.adapter,h=t||{},g=h.env,v=h.clientId,y=h.debug,_=h.cache,w=h.app,S=(t||{}).apiOrigin;S||(S="https://".concat(g,".").concat(r,".tcb-api.tencentcloudapi.com"));var I={env:g,clientId:v,i18n:i,accessKey:o,useWxCloud:l},C=new a.CloudbaseOAuth((0,s.useAuthAdapter)(c(c({},I),{apiOrigin:S,apiPath:(null===e||void 0===e?void 0:e.apiPath)||a.AUTH_API_PREFIX,storage:null===e||void 0===e?void 0:e.storage,baseRequest:null===e||void 0===e?void 0:e.baseRequest,request:null===e||void 0===e?void 0:e.request,anonymousSignInFunc:null===e||void 0===e?void 0:e.anonymousSignInFunc,captchaOptions:null===e||void 0===e?void 0:e.captchaOptions,wxCloud:null===e||void 0===e?void 0:e.wxCloud,adapter:p,onCredentialsError:m,headers:e.headers||{}}))),T=new b(c(c({},I),{region:r,persistence:e.persistence,debug:y,cache:_||new u.CloudbaseCache({persistence:e.persistence,keys:{userInfoKey:"user_info_".concat(g)},platformInfo:d}),runtime:f||"web",_fromApp:w,oauthInstance:C}));return{authInstance:T,oauthInstance:C}}t.Auth=b;var S={name:"auth",namespace:"auth",entity:function(e){if(void 0===e&&(e={region:"",persistence:"local",apiPath:a.AUTH_API_PREFIX}),this.authInstance)return(0,u.printWarn)(u.ERRORS.INVALID_OPERATION,"every cloudbase instance should has only one auth object"),this.authInstance;var t=this.platform.adapter,n=e.persistence||t.primaryStorage;n&&n!==this.config.persistence&&this.updateConfig({persistence:n});var r=w(c(c({wxCloud:this.config.wxCloud,storage:this.config.storage},e),{persistence:this.config.persistence,i18n:this.config.i18n,accessKey:this.config.accessKey,useWxCloud:this.config.useWxCloud}),{env:this.config.env,clientId:this.config.clientId,apiOrigin:this.request.getBaseEndPoint(this.config.endPointMode||"CLOUD_API"),platform:this.platform,cache:this.cache,app:this,debug:this.config.debug}),i=r.authInstance,o=r.oauthInstance;return this.oauthInstance=o,this.authInstance=i,this.authInstance}};try{cloudbase.registerComponent(S)}catch(I){}}).call(this,n("ed83")["default"],n("f3b9")["default"])},f806:function(e,t,n){(function(t){var r=n("127e"),i=n("ee10"),o=n("67ad"),a=n("0bdb");function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=n("1d0b"),l=function(){"use strict";function e(){o(this,e),this.cache=new Map,this.preloadQueue=[],this.maxPreloadCount=3,this.isH5="undefined"!==typeof window}return a(e,[{key:"preloadImages",value:function(){var e=i(r.mark((function e(n,i){var o,a,u,l,d;return r.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Array.isArray(n)&&0!==n.length){e.next=2;break}return e.abrupt("return");case 2:o=n.slice(0,this.maxPreloadCount),a=s(o),e.prev=4,a.s();case 6:if((u=a.n()).done){e.next=24;break}if(l=u.value,!this.cache.has(l)){e.next=11;break}return i&&i(l,!0),e.abrupt("continue",22);case 11:return e.prev=11,e.next=14,c.loadImage(l,{useCache:!0,fallbackToOriginal:!0});case 14:d=e.sent,d.success?(this.cache.set(l,d.url),i&&i(l,!0)):(t("error","\u56fe\u7247\u9884\u52a0\u8f7d\u5931\u8d25:",l,d.error," at utils/imageOptimizer.js:40"),i&&i(l,!1)),e.next=22;break;case 18:e.prev=18,e.t0=e["catch"](11),t("error","\u56fe\u7247\u9884\u52a0\u8f7d\u5f02\u5e38:",l,e.t0," at utils/imageOptimizer.js:46"),i&&i(l,!1);case 22:e.next=6;break;case 24:e.next=29;break;case 26:e.prev=26,e.t1=e["catch"](4),a.e(e.t1);case 29:return e.prev=29,a.f(),e.finish(29);case 32:case"end":return e.stop()}}),e,this,[[4,26,29,32],[11,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCachedImage",value:function(e){return this.cache.get(e)||e}},{key:"clearCache",value:function(){this.cache.clear()}},{key:"getCacheSize",value:function(){return this.cache.size}}]),e}(),d=new l;e.exports=d}).call(this,n("f3b9")["default"])},fa08:function(e,t,n){var r=n("4d0d"),i=r["__core-js_shared__"];e.exports=i},fb85:function(e,t,n){"use strict";n.r(t);var r=n("cb25"),i=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=i.a},fbae:function(e,t){var n=Object.prototype,r=n.toString;e.exports=function(e){return r.call(e)}},fbea:function(e,t,n){"use strict";(function(e){var r=n("47a9"),i=n("3b2d");Object.defineProperty(t,"__esModule",{value:!0}),t.AI=void 0;var o=r(n("3b2d")),a=n("3210"),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!==typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n("a212")),u=n("7a9b"),c=n("5c02");function l(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}var d=function(){return d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},d.apply(this,arguments)},f=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},p=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},h=s.MODELS,g=function(){function t(e,t,n){var r=this;this.req=e,this.baseUrl=t,this.modelRequest=function(e){var t=e.url,n=e.data,i=e.headers,o=e.stream,a=e.timeout;return f(r,void 0,void 0,(function(){var e,r,s,u,c,l,f;return p(this,(function(p){switch(p.label){case 0:return e={"Content-Type":"application/json"},o&&Object.assign(e,{Accept:"text/event-stream"}),[4,this.req.fetch({method:"post",headers:d(d((c={},c[null===(l=this.i18n)||void 0===l?void 0:l.LANG_HEADER_KEY]=null===(f=this.i18n)||void 0===f?void 0:f.lang,c),e),i),body:JSON.stringify(n),url:t,stream:o,timeout:a})];case 1:return r=p.sent(),s=r.data,u=r.header,[2,this.handleResponseData(s,u)]}}))}))},this.botRequest=function(e){var t=e.method,n=e.url,i=e.data,o=void 0===i?{}:i,a=e.headers,s=e.stream,u=e.timeout;return f(r,void 0,void 0,(function(){function e(e){return Object.entries(e).map((function(e){var t=e[0],n=e[1];return"".concat(t,"=").concat(n)})).join("&")}var r,i,c,l,f,h,g,v;return p(this,(function(p){switch(p.label){case 0:return"get"!==t?[3,2]:(r=this.handleResponseData,[4,this.req.fetch({url:"".concat(n,"?").concat(e(o)),method:t,headers:a,stream:s,timeout:u})]);case 1:return[2,r.apply(this,[p.sent().data])];case 2:return i={"Content-Type":"application/json"},s&&Object.assign(i,{Accept:"text/event-stream"}),[4,this.req.fetch({url:n,body:JSON.stringify(o),headers:d(d((h={},h[null===(g=this.i18n)||void 0===g?void 0:g.LANG_HEADER_KEY]=null===(v=this.i18n)||void 0===v?void 0:v.lang,h),i),a),stream:s,method:t,timeout:u})];case 3:return c=p.sent(),l=c.data,f=c.header,[2,this.handleResponseData(l,f)]}}))}))},this.aiBaseUrl="".concat(t,"/ai"),this.aiBotBaseUrl="".concat(t,"/aibot"),this.bot=new a.Bot(this.botRequest,this.aiBotBaseUrl),this.i18n=n,c.langEvent.bus.on(c.langEvent.LANG_CHANGE_EVENT,(function(e){var t;r.i18n=(null===(t=e.data)||void 0===t?void 0:t.i18n)||r.i18n}))}return t.prototype.handleResponseData=function(e,t){var n,r;return f(this,void 0,void 0,(function(){var i,a;return p(this,(function(s){switch(s.label){case 0:return i="".concat(this.i18n.t("\u8bf7\u68c0\u67e5\u8c03\u7528\u65b9\u5f0f\uff0c\u6216\u524d\u5f80\u4e91\u5f00\u53d1 AI+ \u9996\u9875\u67e5\u770b\u6587\u6863"),"\uff1ahttps://tcb.cloud.tencent.com/dev#/ai"),"object"===(0,o.default)(e)&&e&&"then"in e?[4,e]:[3,2];case 1:if(a=s.sent(),"object"===(0,o.default)(a)&&a&&"code"in a&&"NORMAL"!==a.code)throw new Error("".concat(this.i18n.t("AI+ \u8bf7\u6c42\u51fa\u9519\uff0c\u9519\u8bef\u7801"),"\uff1a").concat(a.code,"\uff0c").concat(this.i18n.t("\u9519\u8bef\u4fe1\u606f"),"\uff1a").concat(a.message,"\n").concat(i,"\n").concat(JSON.stringify(a,null,2)));return[2,e];case 2:return(null===(r=null===(n=null===t||void 0===t?void 0:t.get)||void 0===n?void 0:n.call(t,"content-type"))||void 0===r?void 0:r.includes("application/json"))?[4,(0,u.readableStream2JsonObject)(e)]:[3,4];case 3:if(a=s.sent(),"object"===(0,o.default)(a)&&a&&"code"in a&&"NORMAL"!==a.code)throw new Error("".concat(this.i18n.t("AI+ \u8bf7\u6c42\u51fa\u9519\uff0c\u9519\u8bef\u7801"),"\uff1a").concat(a.code,"\uff0c").concat(this.i18n.t("\u9519\u8bef\u4fe1\u606f"),"\uff1a").concat(a.message,"\n").concat(i,"\n").concat(JSON.stringify(a,null,2)));s.label=4;case 4:return[2,e]}}))}))},t.prototype.createModel=function(e,t){var n,r=h[e];if(r)n=new r(this.modelRequest,this.aiBaseUrl);else{var i="string"===typeof(null===t||void 0===t?void 0:t.defaultModelSubUrl)?t.defaultModelSubUrl:"/chat/completions";n=new s.DefaultSimpleModel(this.modelRequest,this.aiBaseUrl,"".concat(e).concat(i))}var o=new s.ReactModel(n);return o},t.prototype.registerModel=function(t,n){null==h[t]?h[t]=n:e("warn","AI model ".concat(t," already exists!")," at node_modules/@cloudbase/ai/dist/esm/AI.js:181")},t.prototype.registerFunctionTool=function(t){s.toolMap.has(t.name)&&e("warn","AI function tool ".concat(t.name," already exists and will be overwritten!")," at node_modules/@cloudbase/ai/dist/esm/AI.js:188"),s.toolMap.set(t.name,t.fn)},t}();t.AI=g}).call(this,n("f3b9")["default"])},fc69:function(e,t,n){var r=n("1d3e"),i=n("5b9d"),o=Object.prototype,a=o.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))a.call(e,n)&&"constructor"!=n&&t.push(n);return t}},fc8d:function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},fc99:function(e,t,n){"use strict";(function(e){var r=n("3b2d");Object.defineProperty(t,"__esModule",{value:!0});var i={createAi:!0,models:!0,registerAi:!0,AI:!0,Bot:!0,utils:!0};Object.defineProperty(t,"AI",{enumerable:!0,get:function(){return o.AI}}),Object.defineProperty(t,"Bot",{enumerable:!0,get:function(){return a.Bot}}),t.createAi=m,t.models=void 0,t.registerAi=function(t){try{t.registerComponent(y)}catch(n){e("warn",n," at node_modules/@cloudbase/ai/dist/esm/index.js:142")}},t.utils=void 0;var o=n("fbea"),a=n("3210"),s=d(n("a212")),u=d(n("7a9b"));t.utils=u;var c=n("a919");function l(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(i,a,s):i[a]=e[a]}return i.default=e,n&&n.set(e,i),i}Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var f=function(){return f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},f.apply(this,arguments)},p=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},h=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,s[0]&&(a=0)),a)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},g=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},v=(s.MODELS,g(s,["MODELS"]));t.models=v;function m(e){var t=e.env,n=e.baseUrl,r=e.req,i=e.getAccessToken,a=e.handleReqInstance,s=e.i18n;return new o.AI(function(){if(null==a){if(null==i)throw new Error("`getAccessToken` is required when `handleReqInstance` is not provided!");return function(e){var t=e.getAccessToken,n=e.req;return{download:n.download,post:n.post,upload:n.upload,fetch:function(e){return p(void 0,void 0,void 0,(function(){var r,i,o,a,s;return h(this,(function(u){switch(u.label){case 0:if("function"!==typeof n.fetch)throw new Error("req.fetch is not a function");return r=e.token,i=e.headers,o=void 0===i?{}:i,a=g(e,["token","headers"]),null==r?[3,1]:(s=r,[3,3]);case 1:return[4,t()];case 2:s=u.sent().accessToken,u.label=3;case 3:return[2,n.fetch(f({headers:f({Authorization:"Bearer ".concat(s)},o)},a))]}}))}))}}}({req:r,getAccessToken:i})}return a({req:r})}(),function(){if(null!=n)return n;if(null==t)throw new Error("`env` is required when `baseUrl` is not provided!");return"https://".concat(t,".api.tcloudbasegateway.com/v1")}(),s)}var y={name:"ai",entity:{ai:function(e){var t,n=this,r=this.request;if(null==r.fetch)throw new Error("cloudbase.request.fetch() unimplemented!");var i=null!==(t=null===e||void 0===e?void 0:e.baseUrl)&&void 0!==t?t:function(){var e=n.getEndPointWithKey("GATEWAY"),t=e.BASE_URL,r=e.PROTOCOL;return"".concat(r).concat(t)}();return m({req:r,baseUrl:i,handleReqInstance:function(e){var t=e.req;return t},i18n:this.config.i18n})}}}}).call(this,n("f3b9")["default"])},fcd5:function(e,t,n){var r=n("7ca3"),i=n("af34");function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=n("139b"),l=c.formatRelativeTime,d=["createTime","postCreateTime","publishTime","createdAt","updateTime"],f=function(e){return e?Array.isArray(e)?e.filter(Boolean):[e].filter(Boolean):[]},p=function(e){var t,n=s(d);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e[r])return{key:r,value:e[r]}}}catch(i){n.e(i)}finally{n.f()}return null},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.withTime,r=void 0===n||n,o=f(e.imageUrls);0===o.length&&o.push.apply(o,i(f(e.imageUrl)));var s=f(e.originalImageUrls);0===s.length&&s.push.apply(s,i(f(e.originalImageUrl))),0===s.length&&o.length>0&&s.push.apply(s,i(o));var u=a(a({},e),{},{imageUrls:o,originalImageUrls:s,authorName:e.authorName||"\u533f\u540d\u7528\u6237",authorAvatar:"string"===typeof e.authorAvatar?e.authorAvatar:""});if(!u.imageStyle&&o.length>0&&(u.imageStyle="height: 0; padding-bottom: 75%;"),r)if(e.formattedCreateTime)u.formattedCreateTime=e.formattedCreateTime;else{var c=p(e);c&&(u.formattedCreateTime=l(c.value))}return u};e.exports={normalizePost:h,normalizePostList:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Array.isArray(e)?e.map((function(e){return h(e,t)})):[]}}},fd09:function(e,t,n){(function(t,n){function r(){var e={platform:"unknown",isH5:!1,isApp:!1,isMiniProgram:!1,isAndroid:!1,isIOS:!1,isWeixin:!1,details:{}};try{if("undefined"!==typeof window&&"undefined"!==typeof document){e.platform="h5",e.isH5=!0;try{e.details.userAgent=navigator.userAgent||"unknown"}catch(s){e.details.userAgent="unknown"}return e}if("undefined"!==typeof uni)try{var r=uni.getSystemInfoSync();if(e.details.systemInfo=r,"undefined"!==typeof t&&t.getAccountInfoSync)try{var i=t.getAccountInfoSync();if(i.miniProgram)return e.platform="mp-weixin",e.isMiniProgram=!0,e.isWeixin=!0,e.details.accountInfo=i,e}catch(s){}if("undefined"!==typeof plus||r.platform)return e.platform="app",e.isApp=!0,"android"===r.platform?e.isAndroid=!0:"ios"===r.platform&&(e.isIOS=!0),e}catch(s){n("warn","\u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\u5931\u8d25:",s," at utils/platformDetector.js:72")}if("undefined"!==typeof t&&t.getSystemInfoSync)try{var o=t.getSystemInfoSync(),a=t.getAccountInfoSync();if(a.miniProgram)return e.platform="mp-weixin",e.isMiniProgram=!0,e.isWeixin=!0,e.details.systemInfo=o,e.details.accountInfo=a,e}catch(s){}}catch(u){n("error","\u5e73\u53f0\u68c0\u6d4b\u5931\u8d25:",u," at utils/platformDetector.js:96")}return e}e.exports={getPlatformInfo:r,getCurrentPlatform:function(){var e=r();return e.platform},isPlatform:function(e){var t=r();return t.platform===e},supportsCloudFunction:function(){var e=r();return e.isH5||e.isApp?"undefined"!==typeof getApp&&getApp().$tcb:!!e.isMiniProgram&&("undefined"!==typeof t&&t.cloud)},getCloudFunctionMethod:function(){var e=r();return e.isH5||e.isApp?"tcb":e.isMiniProgram?"wx-cloud":"none"},logPlatformInfo:function(){}}}).call(this,n("ed83")["default"],n("f3b9")["default"])},fe58:function(e,t){e.exports={getLikeIcon:function(e,t){var n="";return n=e<=3?t?"seedplus.png":"seed.png":e<=7?t?"leafplus.png":"leaf.png":e<=15?t?"flowerplus .png":"flower.png":t?"peachplus.png":"peach.png","/static/images/"+n},getLikeIconDescription:function(e){return e<=3?"\u79cd\u5b50":e<=7?"\u53f6\u5b50":e<=15?"\u82b1":"\u679c\u5b9e"}}}},[["9ed9","app-config"]]]);