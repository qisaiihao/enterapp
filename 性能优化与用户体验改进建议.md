# å›è½¦é”®é¡¹ç›®æ€§èƒ½ä¼˜åŒ–ä¸ç”¨æˆ·ä½“éªŒæ”¹è¿›å»ºè®®

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºå¯¹å›è½¦é”®é¡¹ç›®çš„æ·±å…¥åˆ†æï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºuni-app + è…¾è®¯äº‘å¼€å‘çš„å¤šå¹³å°åº”ç”¨ï¼ŒåŒ…å«è¯—æ­Œåˆ›ä½œã€ç¤¾äº¤äº’åŠ¨ç­‰åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä»æ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒè§’åº¦æå‡ºçš„æ”¹è¿›å»ºè®®ã€‚

## ğŸš€ å‰ç«¯æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å›¾ç‰‡åŠ è½½ä¼˜åŒ–

#### å½“å‰é—®é¢˜
- å›¾ç‰‡é¢„åŠ è½½æœºåˆ¶ä¸å¤Ÿå®Œå–„
- ç¼ºä¹å›¾ç‰‡æ‡’åŠ è½½
- ä¸´æ—¶URLè·å–é¢‘ç¹ï¼Œå½±å“æ€§èƒ½

#### ä¼˜åŒ–æ–¹æ¡ˆ

**1.1 å®ç°æ™ºèƒ½å›¾ç‰‡æ‡’åŠ è½½**
```javascript
// åœ¨ utils/imageLazyLoader.js ä¸­å®ç°
class ImageLazyLoader {
    constructor() {
        this.observer = null;
        this.loadedImages = new Set();
        this.initIntersectionObserver();
    }
    
    initIntersectionObserver() {
        if (typeof IntersectionObserver !== 'undefined') {
            this.observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        this.loadImage(entry.target);
                    }
                });
            }, {
                rootMargin: '50px 0px', // æå‰50pxå¼€å§‹åŠ è½½
                threshold: 0.1
            });
        }
    }
    
    observeImage(imgElement, src) {
        if (this.observer) {
            imgElement.dataset.src = src;
            this.observer.observe(imgElement);
        } else {
            // é™çº§æ–¹æ¡ˆï¼šç›´æ¥åŠ è½½
            imgElement.src = src;
        }
    }
}
```

**1.2 ä¼˜åŒ–å›¾ç‰‡é¢„åŠ è½½ç­–ç•¥**
```javascript
// æ”¹è¿›ç°æœ‰çš„ imageOptimizer.js
class ImageOptimizer {
    constructor() {
        this.cache = new Map();
        this.preloadQueue = [];
        this.maxConcurrent = 3; // é™åˆ¶å¹¶å‘æ•°
        this.currentLoading = 0;
    }
    
    async preloadImages(urls, priority = 'normal') {
        const urlsToPreload = urls.slice(0, 10); // é™åˆ¶é¢„åŠ è½½æ•°é‡
        
        for (const url of urlsToPreload) {
            if (this.cache.has(url)) continue;
            
            // æ§åˆ¶å¹¶å‘æ•°
            while (this.currentLoading >= this.maxConcurrent) {
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            this.currentLoading++;
            this.loadImageWithRetry(url, 3).finally(() => {
                this.currentLoading--;
            });
        }
    }
    
    async loadImageWithRetry(url, retries) {
        for (let i = 0; i < retries; i++) {
            try {
                const result = await this.loadImage(url);
                if (result.success) {
                    this.cache.set(url, result.url);
                    return result;
                }
            } catch (error) {
                if (i === retries - 1) throw error;
                await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
            }
        }
    }
}
```

### 2. æ•°æ®ç¼“å­˜ä¼˜åŒ–

#### å½“å‰é—®é¢˜
- ç¼“å­˜ç­–ç•¥è¿‡äºç®€å•
- ç¼ºä¹ç¼“å­˜å¤±æ•ˆæœºåˆ¶
- å†…å­˜ç¼“å­˜ä¸è¶³

#### ä¼˜åŒ–æ–¹æ¡ˆ

**2.1 å®ç°å¤šçº§ç¼“å­˜ç­–ç•¥**
```javascript
// æ”¹è¿› dataCache.js
class AdvancedDataCache {
    constructor() {
        this.memoryCache = new Map();
        this.storageCache = new Map();
        this.cacheStats = new Map();
        this.maxMemorySize = 50; // æœ€å¤§å†…å­˜ç¼“å­˜é¡¹æ•°
    }
    
    set(key, data, options = {}) {
        const {
            expiry = 300000, // 5åˆ†é’Ÿ
            priority = 'normal', // low, normal, high
            persist = true // æ˜¯å¦æŒä¹…åŒ–
        } = options;
        
        const cacheItem = {
            data,
            timestamp: Date.now(),
            expiry,
            priority,
            accessCount: 0,
            lastAccess: Date.now()
        };
        
        // å†…å­˜ç¼“å­˜
        this.memoryCache.set(key, cacheItem);
        this.cacheStats.set(key, { hits: 0, misses: 0 });
        
        // æŒä¹…åŒ–ç¼“å­˜
        if (persist) {
            try {
                uni.setStorageSync(key, cacheItem);
            } catch (e) {
                console.warn('æŒä¹…åŒ–ç¼“å­˜å¤±è´¥:', e);
            }
        }
        
        // æ¸…ç†è¿‡æœŸç¼“å­˜
        this.cleanup();
    }
    
    get(key) {
        // å…ˆæ£€æŸ¥å†…å­˜ç¼“å­˜
        let item = this.memoryCache.get(key);
        
        if (!item) {
            // ä»æŒä¹…åŒ–ç¼“å­˜æ¢å¤
            try {
                item = uni.getStorageSync(key);
                if (item) {
                    this.memoryCache.set(key, item);
                }
            } catch (e) {
                console.warn('è¯»å–æŒä¹…åŒ–ç¼“å­˜å¤±è´¥:', e);
            }
        }
        
        if (!item) {
            this.recordMiss(key);
            return null;
        }
        
        // æ£€æŸ¥è¿‡æœŸ
        if (Date.now() - item.timestamp > item.expiry) {
            this.remove(key);
            this.recordMiss(key);
            return null;
        }
        
        // æ›´æ–°è®¿é—®ç»Ÿè®¡
        item.accessCount++;
        item.lastAccess = Date.now();
        this.recordHit(key);
        
        return item.data;
    }
    
    cleanup() {
        if (this.memoryCache.size <= this.maxMemorySize) return;
        
        // LRUæ¸…ç†ç­–ç•¥
        const entries = Array.from(this.memoryCache.entries());
        entries.sort((a, b) => a[1].lastAccess - b[1].lastAccess);
        
        const toRemove = entries.slice(0, entries.length - this.maxMemorySize);
        toRemove.forEach(([key]) => this.memoryCache.delete(key));
    }
}
```

### 3. é¡µé¢æ¸²æŸ“ä¼˜åŒ–

#### å½“å‰é—®é¢˜
- é¡µé¢åˆ‡æ¢æ—¶é‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶
- ç¼ºä¹è™šæ‹Ÿæ»šåŠ¨
- éª¨æ¶å±æ˜¾ç¤ºæ—¶é—´è¿‡é•¿

#### ä¼˜åŒ–æ–¹æ¡ˆ

**3.1 å®ç°ç»„ä»¶å¤ç”¨å’ŒçŠ¶æ€ä¿æŒ**
```javascript
// åœ¨é¡µé¢ç»„ä»¶ä¸­å®ç°
export default {
    data() {
        return {
            // ä½¿ç”¨å¯¹è±¡æ± ç®¡ç†ç»„ä»¶å®ä¾‹
            componentPool: new Map(),
            // é¢„æ¸²æŸ“çš„ç»„ä»¶æ•°é‡
            preRenderCount: 3
        };
    },
    
    methods: {
        // ä¼˜åŒ–é¡µé¢åˆ‡æ¢
        switchToPost(index) {
            // ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨ç»„ä»¶
            const postComponent = this.getOrCreatePostComponent(index);
            this.updatePostContent(postComponent, this.postList[index]);
        },
        
        getOrCreatePostComponent(index) {
            if (this.componentPool.has(index)) {
                return this.componentPool.get(index);
            }
            
            const component = this.createPostComponent();
            this.componentPool.set(index, component);
            return component;
        },
        
        // é¢„æ¸²æŸ“ä¸‹ä¸€é¡µå†…å®¹
        preRenderNext() {
            const nextIndex = this.currentPostIndex + 1;
            if (nextIndex < this.postList.length) {
                this.preloadPostContent(nextIndex);
            }
        }
    }
};
```

**3.2 ä¼˜åŒ–éª¨æ¶å±æ˜¾ç¤º**
```javascript
// æ”¹è¿›éª¨æ¶å±é€»è¾‘
export default {
    data() {
        return {
            skeletonMinTime: 800, // æœ€å°æ˜¾ç¤ºæ—¶é—´
            skeletonStartTime: 0
        };
    },
    
    methods: {
        showSkeleton() {
            this.skeletonStartTime = Date.now();
            this.setData({ isLoading: true });
        },
        
        hideSkeleton() {
            const elapsed = Date.now() - this.skeletonStartTime;
            const remaining = Math.max(0, this.skeletonMinTime - elapsed);
            
            setTimeout(() => {
                this.setData({ isLoading: false });
            }, remaining);
        }
    }
};
```

## âš¡ åç«¯æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. äº‘å‡½æ•°ä¼˜åŒ–

#### å½“å‰é—®é¢˜
- äº‘å‡½æ•°æŸ¥è¯¢å¤æ‚åº¦è¿‡é«˜
- ç¼ºä¹æ•°æ®é¢„èšåˆ
- ä¸´æ—¶URLè·å–æ•ˆç‡ä½

#### ä¼˜åŒ–æ–¹æ¡ˆ

**1.1 å®ç°æ•°æ®é¢„èšåˆ**
```javascript
// åœ¨äº‘å‡½æ•°ä¸­å®ç°æ•°æ®é¢„èšåˆ
exports.main = async (event, context) => {
    const { skip = 0, limit = 10 } = event;
    
    // ä½¿ç”¨èšåˆç®¡é“ä¼˜åŒ–æŸ¥è¯¢
    const result = await db.collection('posts').aggregate()
        .match({ isOriginal: true })
        .addFields({
            // é¢„è®¡ç®—çƒ­åº¦åˆ†
            hotScore: {
                $add: [
                    { $multiply: ['$votes', 2] },
                    { $multiply: ['$commentCount', 5] }
                ]
            },
            // é¢„è®¡ç®—æ—¶é—´æƒé‡
            timeWeight: {
                $divide: [
                    { $subtract: [new Date(), '$createTime'] },
                    86400000 // ä¸€å¤©æ¯«ç§’æ•°
                ]
            }
        })
        .sort({ hotScore: -1, createTime: -1 })
        .skip(skip)
        .limit(limit)
        .lookup({
            from: 'users',
            localField: '_openid',
            foreignField: '_openid',
            as: 'author',
            pipeline: [
                { $project: { nickName: 1, avatarUrl: 1 } }
            ]
        })
        .project({
            _id: 1,
            content: 1,
            imageUrls: 1,
            votes: 1,
            commentCount: 1,
            createTime: 1,
            hotScore: 1,
            'author.nickName': 1,
            'author.avatarUrl': 1
        })
        .end();
    
    return { success: true, posts: result.list };
};
```

**1.2 å®ç°æ‰¹é‡ä¸´æ—¶URLè·å–**
```javascript
// æ‰¹é‡è·å–ä¸´æ—¶URLï¼Œå‡å°‘APIè°ƒç”¨æ¬¡æ•°
async function batchGetTempUrls(fileIds) {
    const batchSize = 20; // æ¯æ‰¹å¤„ç†20ä¸ª
    const batches = [];
    
    for (let i = 0; i < fileIds.length; i += batchSize) {
        batches.push(fileIds.slice(i, i + batchSize));
    }
    
    const results = await Promise.all(
        batches.map(batch => 
            cloud.getTempFileURL({ fileList: batch })
        )
    );
    
    return results.flatMap(result => result.fileList);
}
```

### 2. æ•°æ®åº“ä¼˜åŒ–

#### å½“å‰é—®é¢˜
- æŸ¥è¯¢ç¼ºä¹ç´¢å¼•ä¼˜åŒ–
- æ•°æ®å†—ä½™å­˜å‚¨
- ç¼ºä¹æŸ¥è¯¢ç¼“å­˜

#### ä¼˜åŒ–æ–¹æ¡ˆ

**2.1 å»ºç«‹åˆé€‚çš„æ•°æ®åº“ç´¢å¼•**
```javascript
// å»ºè®®çš„ç´¢å¼•é…ç½®
const indexes = {
    posts: [
        { isOriginal: 1, createTime: -1 }, // åŸåˆ›å†…å®¹æŒ‰æ—¶é—´æ’åº
        { _openid: 1, createTime: -1 },    // ç”¨æˆ·å¸–å­æŒ‰æ—¶é—´æ’åº
        { votes: -1, createTime: -1 },     // çƒ­é—¨å†…å®¹æ’åº
        { tags: 1, createTime: -1 }        // æ ‡ç­¾æŸ¥è¯¢
    ],
    users: [
        { _openid: 1 },                    // ç”¨æˆ·æŸ¥è¯¢
        { poemId: 1 }                      // Poem IDæŸ¥è¯¢
    ],
    comments: [
        { postId: 1, createTime: -1 },     // å¸–å­è¯„è®ºæŒ‰æ—¶é—´æ’åº
        { _openid: 1, createTime: -1 }     // ç”¨æˆ·è¯„è®ºæŒ‰æ—¶é—´æ’åº
    ]
};
```

**2.2 å®ç°æŸ¥è¯¢ç»“æœç¼“å­˜**
```javascript
// åœ¨äº‘å‡½æ•°ä¸­å®ç°æŸ¥è¯¢ç¼“å­˜
const queryCache = new Map();

async function cachedQuery(collection, query, options = {}) {
    const cacheKey = JSON.stringify({ collection, query, options });
    const cacheExpiry = 300000; // 5åˆ†é’Ÿç¼“å­˜
    
    if (queryCache.has(cacheKey)) {
        const cached = queryCache.get(cacheKey);
        if (Date.now() - cached.timestamp < cacheExpiry) {
            return cached.data;
        }
    }
    
    const result = await db.collection(collection)
        .where(query)
        .orderBy(options.orderBy || {})
        .skip(options.skip || 0)
        .limit(options.limit || 20)
        .get();
    
    queryCache.set(cacheKey, {
        data: result,
        timestamp: Date.now()
    });
    
    return result;
}
```

## ğŸ¨ ç”¨æˆ·ä½“éªŒæ”¹è¿›å»ºè®®

### 1. äº¤äº’ä½“éªŒä¼˜åŒ–

#### 1.1 é¡µé¢åˆ‡æ¢åŠ¨ç”»ä¼˜åŒ–
```css
/* ä¼˜åŒ–é¡µé¢åˆ‡æ¢åŠ¨ç”» */
.page-transition {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.page-enter {
    transform: translateX(100%);
}

.page-enter-active {
    transform: translateX(0);
}

.page-leave {
    transform: translateX(0);
}

.page-leave-active {
    transform: translateX(-100%);
}
```

#### 1.2 æ‰‹åŠ¿æ“ä½œä¼˜åŒ–
```javascript
// æ”¹è¿›æ‰‹åŠ¿è¯†åˆ«
export default {
    data() {
        return {
            touchStartX: 0,
            touchStartY: 0,
            touchStartTime: 0,
            swipeThreshold: 50,
            swipeTimeThreshold: 300
        };
    },
    
    methods: {
        touchStart(e) {
            this.touchStartX = e.touches[0].clientX;
            this.touchStartY = e.touches[0].clientY;
            this.touchStartTime = Date.now();
        },
        
        touchEnd(e) {
            const deltaX = e.changedTouches[0].clientX - this.touchStartX;
            const deltaY = e.changedTouches[0].clientY - this.touchStartY;
            const deltaTime = Date.now() - this.touchStartTime;
            
            // åˆ¤æ–­æ˜¯å¦ä¸ºæœ‰æ•ˆæ»‘åŠ¨
            if (Math.abs(deltaX) > Math.abs(deltaY) && 
                Math.abs(deltaX) > this.swipeThreshold && 
                deltaTime < this.swipeTimeThreshold) {
                
                if (deltaX > 0) {
                    this.swipeRight();
                } else {
                    this.swipeLeft();
                }
            }
        }
    }
};
```

### 2. åŠ è½½çŠ¶æ€ä¼˜åŒ–

#### 2.1 æ™ºèƒ½åŠ è½½æç¤º
```javascript
// å®ç°æ™ºèƒ½åŠ è½½æç¤º
class LoadingManager {
    constructor() {
        this.loadingStates = new Map();
        this.timeouts = new Map();
    }
    
    showLoading(key, message = 'åŠ è½½ä¸­...', timeout = 10000) {
        // é¿å…é‡å¤æ˜¾ç¤º
        if (this.loadingStates.has(key)) return;
        
        this.loadingStates.set(key, true);
        
        // å»¶è¿Ÿæ˜¾ç¤ºï¼Œé¿å…é—ªçƒ
        const timeoutId = setTimeout(() => {
            uni.showLoading({
                title: message,
                mask: true
            });
        }, 300);
        
        this.timeouts.set(key, timeoutId);
        
        // è¶…æ—¶è‡ªåŠ¨éšè—
        setTimeout(() => {
            this.hideLoading(key);
        }, timeout);
    }
    
    hideLoading(key) {
        if (!this.loadingStates.has(key)) return;
        
        const timeoutId = this.timeouts.get(key);
        if (timeoutId) {
            clearTimeout(timeoutId);
            this.timeouts.delete(key);
        }
        
        uni.hideLoading();
        this.loadingStates.delete(key);
    }
}
```

#### 2.2 é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
```javascript
// å®ç°æ™ºèƒ½é‡è¯•æœºåˆ¶
class RetryManager {
    constructor() {
        this.retryConfig = {
            maxRetries: 3,
            baseDelay: 1000,
            maxDelay: 10000
        };
    }
    
    async executeWithRetry(operation, context = '') {
        let lastError;
        
        for (let attempt = 1; attempt <= this.retryConfig.maxRetries; attempt++) {
            try {
                return await operation();
            } catch (error) {
                lastError = error;
                console.warn(`${context} ç¬¬${attempt}æ¬¡å°è¯•å¤±è´¥:`, error);
                
                if (attempt < this.retryConfig.maxRetries) {
                    const delay = Math.min(
                        this.retryConfig.baseDelay * Math.pow(2, attempt - 1),
                        this.retryConfig.maxDelay
                    );
                    
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        throw lastError;
    }
}
```

### 3. å†…å®¹å±•ç¤ºä¼˜åŒ–

#### 3.1 å®ç°æ¸è¿›å¼å›¾ç‰‡åŠ è½½
```javascript
// æ¸è¿›å¼å›¾ç‰‡åŠ è½½
class ProgressiveImageLoader {
    constructor() {
        this.placeholderCache = new Map();
    }
    
    async loadProgressiveImage(originalUrl, placeholderUrl) {
        // å…ˆæ˜¾ç¤ºå ä½å›¾
        const placeholder = await this.loadPlaceholder(placeholderUrl);
        
        // å¼‚æ­¥åŠ è½½åŸå›¾
        const original = await this.loadOriginal(originalUrl);
        
        return {
            placeholder,
            original,
            isLoaded: true
        };
    }
    
    async loadPlaceholder(url) {
        if (this.placeholderCache.has(url)) {
            return this.placeholderCache.get(url);
        }
        
        // ç”Ÿæˆä½è´¨é‡å ä½å›¾
        const placeholder = await this.generatePlaceholder(url);
        this.placeholderCache.set(url, placeholder);
        
        return placeholder;
    }
}
```

#### 3.2 ä¼˜åŒ–æ–‡æœ¬æ¸²æŸ“
```css
/* ä¼˜åŒ–æ–‡æœ¬æ¸²æŸ“æ€§èƒ½ */
.text-content {
    /* å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ */
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    
    /* ä¼˜åŒ–å­—ä½“æ¸²æŸ“ */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    
    /* æ–‡æœ¬é€‰æ‹©ä¼˜åŒ– */
    -webkit-user-select: none;
    user-select: none;
    
    /* é¿å…é‡æ’ */
    contain: layout style paint;
}

/* é•¿æ–‡æœ¬ä¼˜åŒ– */
.long-text {
    /* ä½¿ç”¨CSSå¤šåˆ—å¸ƒå±€ */
    column-count: 2;
    column-gap: 20px;
    column-rule: 1px solid #eee;
    
    /* æ–‡æœ¬æº¢å‡ºå¤„ç† */
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
}
```

## ğŸ“± å¤šå¹³å°å…¼å®¹æ€§ä¼˜åŒ–

### 1. å¹³å°ç‰¹å®šä¼˜åŒ–

#### 1.1 H5å¹³å°ä¼˜åŒ–
```javascript
// H5ç‰¹å®šä¼˜åŒ–
if (typeof window !== 'undefined') {
    // å¯ç”¨Service Workerç¼“å­˜
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js');
    }
    
    // é¢„åŠ è½½å…³é”®èµ„æº
    const preloadLinks = [
        '/static/images/logo.png',
        '/static/css/critical.css'
    ];
    
    preloadLinks.forEach(href => {
        const link = document.createElement('link');
        link.rel = 'preload';
        link.href = href;
        link.as = href.endsWith('.css') ? 'style' : 'image';
        document.head.appendChild(link);
    });
}
```

#### 1.2 å°ç¨‹åºå¹³å°ä¼˜åŒ–
```javascript
// å°ç¨‹åºç‰¹å®šä¼˜åŒ–
if (typeof wx !== 'undefined') {
    // å¯ç”¨åˆ†åŒ…åŠ è½½
    const subPackages = [
        'pages/poem/poem',
        'pages/mountain/mountain'
    ];
    
    // é¢„åŠ è½½åˆ†åŒ…
    subPackages.forEach(packagePath => {
        wx.preloadSubPackage({
            root: packagePath
        });
    });
}
```

### 2. ç½‘ç»œä¼˜åŒ–

#### 2.1 å®ç°è¯·æ±‚å»é‡
```javascript
// è¯·æ±‚å»é‡ç®¡ç†
class RequestDeduplicator {
    constructor() {
        this.pendingRequests = new Map();
    }
    
    async deduplicate(key, requestFn) {
        if (this.pendingRequests.has(key)) {
            return this.pendingRequests.get(key);
        }
        
        const promise = requestFn().finally(() => {
            this.pendingRequests.delete(key);
        });
        
        this.pendingRequests.set(key, promise);
        return promise;
    }
}
```

#### 2.2 å®ç°è¯·æ±‚ä¼˜å…ˆçº§ç®¡ç†
```javascript
// è¯·æ±‚ä¼˜å…ˆçº§ç®¡ç†
class RequestPriorityManager {
    constructor() {
        this.queues = {
            high: [],
            normal: [],
            low: []
        };
        this.isProcessing = false;
    }
    
    addRequest(request, priority = 'normal') {
        this.queues[priority].push(request);
        this.processQueue();
    }
    
    async processQueue() {
        if (this.isProcessing) return;
        
        this.isProcessing = true;
        
        while (this.hasRequests()) {
            const request = this.getNextRequest();
            if (request) {
                try {
                    await request.execute();
                } catch (error) {
                    console.error('è¯·æ±‚æ‰§è¡Œå¤±è´¥:', error);
                }
            }
        }
        
        this.isProcessing = false;
    }
}
```

## ğŸ”§ å¼€å‘å·¥å…·å’Œç›‘æ§

### 1. æ€§èƒ½ç›‘æ§

#### 1.1 å®ç°æ€§èƒ½æŒ‡æ ‡æ”¶é›†
```javascript
// æ€§èƒ½ç›‘æ§å·¥å…·
class PerformanceMonitor {
    constructor() {
        this.metrics = new Map();
        this.reportEndpoint = '/api/performance';
    }
    
    startTiming(key) {
        this.metrics.set(key, {
            startTime: Date.now(),
            endTime: null,
            duration: null
        });
    }
    
    endTiming(key) {
        const metric = this.metrics.get(key);
        if (metric) {
            metric.endTime = Date.now();
            metric.duration = metric.endTime - metric.startTime;
        }
    }
    
    reportMetrics() {
        const report = Array.from(this.metrics.entries()).map(([key, metric]) => ({
            key,
            duration: metric.duration,
            timestamp: Date.now()
        }));
        
        // å‘é€åˆ°ç›‘æ§æœåŠ¡
        this.sendReport(report);
    }
}
```

#### 1.2 å®ç°é”™è¯¯ç›‘æ§
```javascript
// é”™è¯¯ç›‘æ§å·¥å…·
class ErrorMonitor {
    constructor() {
        this.errors = [];
        this.maxErrors = 100;
    }
    
    captureError(error, context = {}) {
        const errorInfo = {
            message: error.message,
            stack: error.stack,
            context,
            timestamp: Date.now(),
            userAgent: navigator.userAgent,
            url: window.location.href
        };
        
        this.errors.push(errorInfo);
        
        // é™åˆ¶é”™è¯¯æ•°é‡
        if (this.errors.length > this.maxErrors) {
            this.errors.shift();
        }
        
        // å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
        this.sendError(errorInfo);
    }
    
    setupGlobalErrorHandling() {
        window.addEventListener('error', (event) => {
            this.captureError(event.error, {
                type: 'javascript',
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno
            });
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            this.captureError(event.reason, {
                type: 'promise',
                promise: event.promise
            });
        });
    }
}
```

## ğŸ“Š å®æ–½ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®æ–½ï¼‰
1. **å›¾ç‰‡æ‡’åŠ è½½å®ç°** - æ˜¾è‘—å‡å°‘åˆå§‹åŠ è½½æ—¶é—´
2. **æ•°æ®ç¼“å­˜ä¼˜åŒ–** - æå‡é¡µé¢åˆ‡æ¢é€Ÿåº¦
3. **äº‘å‡½æ•°æŸ¥è¯¢ä¼˜åŒ–** - å‡å°‘æœåŠ¡å™¨å“åº”æ—¶é—´
4. **é”™è¯¯å¤„ç†å®Œå–„** - æå‡åº”ç”¨ç¨³å®šæ€§

### ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸå®æ–½ï¼‰
1. **é¡µé¢æ¸²æŸ“ä¼˜åŒ–** - æå‡äº¤äº’æµç•…åº¦
2. **ç½‘ç»œè¯·æ±‚ä¼˜åŒ–** - å‡å°‘é‡å¤è¯·æ±‚
3. **ç”¨æˆ·ä½“éªŒæ”¹è¿›** - æå‡ç”¨æˆ·æ»¡æ„åº¦
4. **æ€§èƒ½ç›‘æ§å®ç°** - æŒç»­ä¼˜åŒ–åŸºç¡€

### ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸè§„åˆ’ï¼‰
1. **é«˜çº§ç¼“å­˜ç­–ç•¥** - è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½
2. **æ™ºèƒ½é¢„åŠ è½½** - é¢„æµ‹ç”¨æˆ·è¡Œä¸º
3. **ä¸ªæ€§åŒ–æ¨èä¼˜åŒ–** - æå‡å†…å®¹è´¨é‡
4. **å¤šå¹³å°æ·±åº¦ä¼˜åŒ–** - å¹³å°ç‰¹å®šä¼˜åŒ–

## ğŸ¯ é¢„æœŸæ•ˆæœ

å®æ–½ä»¥ä¸Šä¼˜åŒ–å»ºè®®åï¼Œé¢„æœŸå¯ä»¥è·å¾—ä»¥ä¸‹æ”¹è¿›ï¼š

### æ€§èƒ½æå‡
- **é¡µé¢åŠ è½½æ—¶é—´å‡å°‘ 40-60%**
- **å›¾ç‰‡åŠ è½½é€Ÿåº¦æå‡ 50%**
- **äº‘å‡½æ•°å“åº”æ—¶é—´å‡å°‘ 30%**
- **å†…å­˜ä½¿ç”¨ä¼˜åŒ– 25%**

### ç”¨æˆ·ä½“éªŒæå‡
- **é¡µé¢åˆ‡æ¢æ›´æµç•…**
- **åŠ è½½çŠ¶æ€æ›´å‹å¥½**
- **é”™è¯¯å¤„ç†æ›´å®Œå–„**
- **äº¤äº’å“åº”æ›´åŠæ—¶**

### å¼€å‘æ•ˆç‡æå‡
- **ä»£ç å¤ç”¨ç‡æé«˜**
- **è°ƒè¯•æ•ˆç‡æå‡**
- **ç»´æŠ¤æˆæœ¬é™ä½**
- **æ‰©å±•æ€§å¢å¼º**

---

*æœ¬å»ºè®®æ–‡æ¡£åŸºäºå¯¹å›è½¦é”®é¡¹ç›®çš„æ·±å…¥åˆ†æï¼Œå»ºè®®æŒ‰ä¼˜å…ˆçº§é€æ­¥å®æ–½ï¼Œå¹¶åœ¨å®æ–½è¿‡ç¨‹ä¸­æŒç»­ç›‘æ§æ•ˆæœï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ä¼˜åŒ–ç­–ç•¥ã€‚*
